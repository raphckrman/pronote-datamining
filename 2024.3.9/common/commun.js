IE.fModule({
  f: function (exports, require, module, global) {
    require('curseur.css');
  },
  fn: 'declarationcurseurpn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    if (typeof Object.assign !== 'function') {
      (function () {
        Object.assign = function (target) {
          'use strict';
          if (target === undefined || target === null) {
            throw new TypeError('Cannot convert undefined or null to object');
          }
          var output = Object(target);
          for (var index = 1; index < arguments.length; index++) {
            var source = arguments[index];
            if (source !== undefined && source !== null) {
              for (var nextKey in source) {
                if (source.hasOwnProperty(nextKey)) {
                  output[nextKey] = source[nextKey];
                }
              }
            }
          }
          return output;
        };
      })();
    }
  },
  fn: 'object.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    String.prototype.ucfirst = function () {
      return this.replace(this.charAt(0), this.charAt(0).toUpperCase());
    };
    if (!String.prototype.trim) {
      String.prototype.trim = function () {
        return this.replace(/^\s+|\s+$/g, '');
      };
    }
    if (!String.prototype.trimStart) {
      String.prototype.trimStart = function () {
        return this.replace(/^\s+/, '');
      };
    }
    if (!String.prototype.trimEnd) {
      String.prototype.trimEnd = function () {
        return this.replace(/\s+$/, '');
      };
    }
    String.prototype.avecQuotes = function () {
      return '&quot;' + this + '&quot;';
    };
    String.prototype.enleverZero = function () {
      return parseFloat(this.replace(/,/g, '.')).toString();
    };
    String.prototype.escapeJQ = function () {
      return this.replace(/(:|\.|\[|\]|\/|#)/g, '\\$1');
    };
    String.prototype.replaceRCToHTML = function (aChaineRemplacement) {
      return !!this
        ? this.replace(/\r\n|\n|\r|&#32;/g, aChaineRemplacement || '<br>')
        : '';
    };
    String.prototype.toAttrValue = function () {
      return this.replace(/"/g, '&quot;');
    };
    String.prototype.toTitle = function () {
      return this.replace(/\r\n|\n|\r/g, '&#010;').toAttrValue();
    };
    String.prototype.ajouterEntites = function (aSansQuote) {
      let re = aSansQuote ? /([<>'&])/g : /([<>"'&])/g;
      return this.replace(re, (m) => {
        if (m === '<') {
          return '&lt;';
        }
        if (m === '>') {
          return '&gt;';
        }
        if (m === '"') {
          return '&quot;';
        }
        if (m === "'") {
          return '&#039;';
        }
        if (m === '&') {
          return '&amp;';
        }
        return m;
      });
    };
    String.prototype.enleverEntites = function () {
      let re = /&(lt|gt|quot|#039|amp);/g;
      return this.replace(re, (m) => {
        if (m === '&lt;') {
          return '<';
        }
        if (m === '&gt;') {
          return '>';
        }
        if (m === '&quot;') {
          return '"';
        }
        if (m === '&#039;') {
          return "'";
        }
        if (m === '&amp;') {
          return '&';
        }
        return m;
      });
    };
    String.prototype.format = function (aTabElements) {
      if (!Array.isArray(aTabElements)) {
        if (
          typeof aTabElements !== 'number' &&
          typeof aTabElements !== 'string'
        ) {
          return this;
        }
        aTabElements = [aTabElements];
      }
      const lMapElements = aTabElements.map((aElement) => {
        if (typeof aElement === 'function') {
          try {
            return aElement();
          } catch (e) {
            return '';
          }
        }
        return aElement;
      });
      const lFuncSubst = (aSubst, aCarSuiv) => {
        let lSubst = aSubst;
        if (aCarSuiv === 'd') {
          lSubst = parseInt(lSubst);
          if (isNaN(lSubst)) {
            lSubst = '';
          }
        }
        return lSubst;
      };
      let lIndex = 0;
      let lStrResult = '';
      let lCar;
      let lCarSuiv;
      let lIndexSubsSansNumero = 0;
      let lDieseEnCours = false;
      let lStrPourcentEnCours = '';
      let lStrNumeroSubst = '';
      let lNumeroSubst;
      const lRegNumber = new RegExp('[0-9]');
      const lRegExType = new RegExp('(s|d|e|f|g|n|m)');
      while (lIndex < this.length) {
        lCar = this[lIndex];
        lCarSuiv = this[lIndex + 1];
        if (lStrPourcentEnCours) {
          if (lCarSuiv && lCar === ':' && lCarSuiv.match(lRegExType)) {
            lNumeroSubst = parseInt(lStrPourcentEnCours);
            if (lNumeroSubst < lMapElements.length) {
              lStrResult += lFuncSubst(lMapElements[lNumeroSubst], lCarSuiv);
            }
            lIndex += 1;
            lStrPourcentEnCours = '';
          } else if (lCarSuiv && lCarSuiv.match(lRegNumber)) {
            lStrPourcentEnCours += lCarSuiv;
          } else {
            lStrResult += '%' + lStrPourcentEnCours + lCar;
            lStrPourcentEnCours = '';
          }
        } else if (lDieseEnCours) {
          lStrNumeroSubst += lCar;
          if (!lCarSuiv || !lCarSuiv.match(lRegNumber)) {
            lDieseEnCours = false;
            lNumeroSubst = parseInt(lStrNumeroSubst) - 1;
            if (lNumeroSubst < lMapElements.length) {
              lStrResult += lMapElements[lNumeroSubst];
            }
            lStrNumeroSubst = '';
          }
        } else {
          switch (lCar) {
            case '#':
              if (lCarSuiv.match(lRegNumber)) {
                lDieseEnCours = true;
              }
              break;
            case '%':
              if (lCarSuiv === 's' || lCarSuiv === 'd') {
                lIndex += 1;
                if (lIndexSubsSansNumero < lMapElements.length) {
                  lStrResult += lFuncSubst(
                    lMapElements[lIndexSubsSansNumero],
                    lCarSuiv,
                  );
                }
                lIndexSubsSansNumero += 1;
              } else if (lCarSuiv.match(lRegNumber)) {
                lStrPourcentEnCours = lCarSuiv;
                lIndex += 1;
              } else {
                lStrResult += lCar;
              }
              break;
            default:
              lStrResult += lCar;
          }
        }
        lIndex += 1;
      }
      return lStrResult;
    };
    if (!String.prototype.startsWith) {
      String.prototype.startsWith = function (searchString, position) {
        position = position || 0;
        return this.substr(position, searchString.length) === searchString;
      };
    }
    if (!String.prototype.endsWith) {
      String.prototype.endsWith = function (searchString, position) {
        let subjectString = this.toString();
        if (
          typeof position !== 'number' ||
          !isFinite(position) ||
          Math.floor(position) !== position ||
          position > subjectString.length
        ) {
          position = subjectString.length;
        }
        position -= searchString.length;
        let lastIndex = subjectString.indexOf(searchString, position);
        return lastIndex !== -1 && lastIndex === position;
      };
    }
    if (!String.prototype.includes) {
      String.prototype.includes = function (search, start) {
        if (typeof start !== 'number') {
          start = 0;
        }
        if (start + search.length > this.length) {
          return false;
        } else {
          return this.indexOf(search, start) !== -1;
        }
      };
    }
  },
  fn: 'string.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    Math.borner = function (aValeur, aMin, aMax) {
      return Math.max(Math.min(aValeur, aMax), aMin);
    };
    Math.log10 =
      Math.log10 ||
      function (x) {
        return Math.log(x) * Math.LOG10E;
      };
    (function () {
      function decimalAdjust(type, value, exp) {
        if (typeof exp === 'undefined' || +exp === 0) {
          return Math[type](value);
        }
        value = +value;
        exp = +exp;
        if (
          value === null ||
          isNaN(value) ||
          !(typeof exp === 'number' && exp % 1 === 0)
        ) {
          return NaN;
        }
        if (value < 0) {
          return -decimalAdjust(type, -value, exp);
        }
        value = value.toString().split('e');
        value = Math[type](
          +(value[0] + 'e' + (value[1] ? +value[1] - exp : -exp)),
        );
        value = value.toString().split('e');
        return +(value[0] + 'e' + (value[1] ? +value[1] + exp : exp));
      }
      if (!Math.round10) {
        Math.round10 = function (value, exp) {
          return decimalAdjust('round', value, exp);
        };
      }
      if (!Math.floor10) {
        Math.floor10 = function (value, exp) {
          return decimalAdjust('floor', value, exp);
        };
      }
      if (!Math.ceil10) {
        Math.ceil10 = function (value, exp) {
          return decimalAdjust('ceil', value, exp);
        };
      }
    })();
  },
  fn: 'math.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('es6-promise.auto.min.js');
    require('es6-promise.auto.js');
    if (!Promise.prototype['finally']) {
      Promise.prototype['finally'] = function finallyPolyfill(callback) {
        let { constructor } = this;
        return this.then(
          (value) => {
            return constructor.resolve(callback()).then(() => {
              return value;
            });
          },
          (reason) => {
            return constructor.resolve(callback()).then(() => {
              throw reason;
            });
          },
        );
      };
    }
  },
  fn: 'promise.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    (function (n, l) {
      'object' === typeof exports && 'undefined' !== typeof module
        ? (module.exports = l())
        : 'function' === typeof define && define.amd
          ? define(l)
          : (n.ResizeObserver = l());
    })(this, function () {
      function n(b) {
        for (var a = [], c = arguments.length - 1; 0 < c--; )
          a[c] = arguments[c + 1];
        return a.reduce(function (a, c) {
          return a + (parseFloat(b['border-' + c + '-width']) || 0);
        }, 0);
      }
      var l = (function () {
          function b(b, c) {
            var a = -1;
            b.some(function (b, e) {
              return b[0] === c ? ((a = e), !0) : !1;
            });
            return a;
          }
          return 'undefined' !== typeof Map
            ? Map
            : (function () {
                function a() {
                  this.__entries__ = [];
                }
                var c = { size: { configurable: !0 } };
                c.size.get = function () {
                  return this.__entries__.length;
                };
                a.prototype.get = function (a) {
                  a = b(this.__entries__, a);
                  return (a = this.__entries__[a]) && a[1];
                };
                a.prototype.set = function (a, c) {
                  var e = b(this.__entries__, a);
                  ~e
                    ? (this.__entries__[e][1] = c)
                    : this.__entries__.push([a, c]);
                };
                a.prototype['delete'] = function (a) {
                  var c = this.__entries__;
                  a = b(c, a);
                  ~a && c.splice(a, 1);
                };
                a.prototype.has = function (a) {
                  return !!~b(this.__entries__, a);
                };
                a.prototype.clear = function () {
                  this.__entries__.splice(0);
                };
                a.prototype.forEach = function (a, b) {
                  void 0 === b && (b = null);
                  for (var c = 0, e = this.__entries__; c < e.length; c += 1) {
                    var g = e[c];
                    a.call(b, g[1], g[0]);
                  }
                };
                Object.defineProperties(a.prototype, c);
                return a;
              })();
        })(),
        q =
          'undefined' !== typeof window &&
          'undefined' !== typeof document &&
          window.document === document,
        p =
          'undefined' !== typeof global && global.Math === Math
            ? global
            : 'undefined' !== typeof self && self.Math === Math
              ? self
              : 'undefined' !== typeof window && Math === Math
                ? window
                : Function('return this')(),
        x = (function () {
          return 'function' === typeof requestAnimationFrame
            ? requestAnimationFrame.bind(p)
            : function (b) {
                return setTimeout(function () {
                  return b(Date.now());
                }, 1e3 / 60);
              };
        })(),
        y = function (b, a) {
          function c() {
            f && ((f = !1), b());
            h && g();
          }
          function e() {
            x(c);
          }
          function g() {
            var b = Date.now();
            if (f) {
              if (2 > b - d) return;
              h = !0;
            } else (f = !0), (h = !1), setTimeout(e, a);
            d = b;
          }
          var f = !1,
            h = !1,
            d = 0;
          return g;
        },
        z = 'top right bottom left width height size weight'.split(' '),
        A = 'undefined' !== typeof MutationObserver,
        d = function () {
          this.mutationEventsAdded_ = this.connected_ = !1;
          this.mutationsObserver_ = null;
          this.observers_ = [];
          this.onTransitionEnd_ = this.onTransitionEnd_.bind(this);
          this.refresh = y(this.refresh.bind(this), 20);
        };
      d.prototype.addObserver = function (b) {
        ~this.observers_.indexOf(b) || this.observers_.push(b);
        this.connected_ || this.connect_();
      };
      d.prototype.removeObserver = function (b) {
        var a = this.observers_;
        b = a.indexOf(b);
        ~b && a.splice(b, 1);
        !a.length && this.connected_ && this.disconnect_();
      };
      d.prototype.refresh = function () {
        this.updateObservers_() && this.refresh();
      };
      d.prototype.updateObservers_ = function () {
        var b = this.observers_.filter(function (a) {
          return a.gatherActive(), a.hasActive();
        });
        b.forEach(function (a) {
          return a.broadcastActive();
        });
        return 0 < b.length;
      };
      d.prototype.connect_ = function () {
        q &&
          !this.connected_ &&
          (document.addEventListener('transitionend', this.onTransitionEnd_),
          window.addEventListener('resize', this.refresh),
          A
            ? ((this.mutationsObserver_ = new MutationObserver(this.refresh)),
              this.mutationsObserver_.observe(document, {
                attributes: !0,
                childList: !0,
                characterData: !0,
                subtree: !0,
              }))
            : (document.addEventListener('DOMSubtreeModified', this.refresh),
              (this.mutationEventsAdded_ = !0)),
          (this.connected_ = !0));
      };
      d.prototype.disconnect_ = function () {
        q &&
          this.connected_ &&
          (document.removeEventListener('transitionend', this.onTransitionEnd_),
          window.removeEventListener('resize', this.refresh),
          this.mutationsObserver_ && this.mutationsObserver_.disconnect(),
          this.mutationEventsAdded_ &&
            document.removeEventListener('DOMSubtreeModified', this.refresh),
          (this.mutationsObserver_ = null),
          (this.connected_ = this.mutationEventsAdded_ = !1));
      };
      d.prototype.onTransitionEnd_ = function (b) {
        var a = b.propertyName;
        void 0 === a && (a = '');
        z.some(function (b) {
          return !!~a.indexOf(b);
        }) && this.refresh();
      };
      d.getInstance = function () {
        this.instance_ || (this.instance_ = new d());
        return this.instance_;
      };
      d.instance_ = null;
      var u = function (b, a) {
          for (var c = 0, e = Object.keys(a); c < e.length; c += 1) {
            var g = e[c];
            Object.defineProperty(b, g, {
              value: a[g],
              enumerable: !1,
              writable: !1,
              configurable: !0,
            });
          }
          return b;
        },
        m = function (b) {
          return (b && b.ownerDocument && b.ownerDocument.defaultView) || p;
        },
        v = { x: 0, y: 0, width: 0, height: 0 },
        B = (function () {
          return 'undefined' !== typeof SVGGraphicsElement
            ? function (b) {
                return b instanceof m(b).SVGGraphicsElement;
              }
            : function (b) {
                return (
                  b instanceof m(b).SVGElement &&
                  'function' === typeof b.getBBox
                );
              };
        })(),
        r = function (b) {
          this.broadcastHeight = this.broadcastWidth = 0;
          this.contentRect_ = { x: 0, y: 0, width: 0, height: 0 };
          this.target = b;
        };
      r.prototype.isActive = function () {
        var b = this.target;
        if (q)
          if (B(b)) {
            var a = b.getBBox();
            a = { x: 0, y: 0, width: a.width, height: a.height };
          } else {
            var c = b.clientWidth,
              e = b.clientHeight;
            if (c || e) {
              var g = m(b).getComputedStyle(b);
              a = {};
              for (
                var f = 0, h = ['top', 'right', 'bottom', 'left'];
                f < h.length;
                f += 1
              ) {
                var d = h[f];
                a[d] = parseFloat(g['padding-' + d]) || 0;
              }
              var k = a.left + a.right;
              d = a.top + a.bottom;
              f = parseFloat(g.width) || 0;
              h = parseFloat(g.height) || 0;
              'border-box' === g.boxSizing &&
                (Math.round(f + k) !== c && (f -= n(g, 'left', 'right') + k),
                Math.round(h + d) !== e && (h -= n(g, 'top', 'bottom') + d));
              b !== m(b).document.documentElement &&
                ((b = Math.round(f + k) - c),
                (e = Math.round(h + d) - e),
                1 !== Math.abs(b) && (f -= b),
                1 !== Math.abs(e) && (h -= e));
              a = { x: a.left, y: a.top, width: f, height: h };
            } else a = v;
          }
        else a = v;
        this.contentRect_ = a;
        return (
          a.width !== this.broadcastWidth || a.height !== this.broadcastHeight
        );
      };
      r.prototype.broadcastRect = function () {
        var b = this.contentRect_;
        this.broadcastWidth = b.width;
        this.broadcastHeight = b.height;
        return b;
      };
      var C = function (b, a) {
          var c = a.x,
            e = a.y,
            d = a.width,
            f = a.height,
            h = Object.create(
              ('undefined' !== typeof DOMRectReadOnly
                ? DOMRectReadOnly
                : Object
              ).prototype,
            );
          u(h, {
            x: c,
            y: e,
            width: d,
            height: f,
            top: e,
            right: c + d,
            bottom: f + e,
            left: c,
          });
          u(this, { target: b, contentRect: h });
        },
        k = function (b, a, c) {
          this.activeObservations_ = [];
          this.observations_ = new l();
          if ('function' !== typeof b)
            throw new TypeError(
              'The callback provided as parameter 1 is not a function.',
            );
          this.callback_ = b;
          this.controller_ = a;
          this.callbackCtx_ = c;
        };
      k.prototype.observe = function (b) {
        if (!arguments.length)
          throw new TypeError('1 argument required, but only 0 present.');
        if ('undefined' !== typeof Element && Element instanceof Object) {
          if (!(b instanceof m(b).Element))
            throw new TypeError('parameter 1 is not of type "Element".');
          var a = this.observations_;
          a.has(b) ||
            (a.set(b, new r(b)),
            this.controller_.addObserver(this),
            this.controller_.refresh());
        }
      };
      k.prototype.unobserve = function (b) {
        if (!arguments.length)
          throw new TypeError('1 argument required, but only 0 present.');
        if ('undefined' !== typeof Element && Element instanceof Object) {
          if (!(b instanceof m(b).Element))
            throw new TypeError('parameter 1 is not of type "Element".');
          var a = this.observations_;
          a.has(b) &&
            (a['delete'](b), a.size || this.controller_.removeObserver(this));
        }
      };
      k.prototype.disconnect = function () {
        this.clearActive();
        this.observations_.clear();
        this.controller_.removeObserver(this);
      };
      k.prototype.gatherActive = function () {
        var b = this;
        this.clearActive();
        this.observations_.forEach(function (a) {
          a.isActive() && b.activeObservations_.push(a);
        });
      };
      k.prototype.broadcastActive = function () {
        if (this.hasActive()) {
          var b = this.callbackCtx_,
            a = this.activeObservations_.map(function (a) {
              return new C(a.target, a.broadcastRect());
            });
          this.callback_.call(b, a, b);
          this.clearActive();
        }
      };
      k.prototype.clearActive = function () {
        this.activeObservations_.splice(0);
      };
      k.prototype.hasActive = function () {
        return 0 < this.activeObservations_.length;
      };
      var w = 'undefined' !== typeof WeakMap ? new WeakMap() : new l(),
        t = function (b) {
          if (!(this instanceof t))
            throw new TypeError('Cannot call a class as a function.');
          if (!arguments.length)
            throw new TypeError('1 argument required, but only 0 present.');
          var a = d.getInstance();
          a = new k(b, a, this);
          w.set(this, a);
        };
      ['observe', 'unobserve', 'disconnect'].forEach(function (b) {
        t.prototype[b] = function () {
          var a;
          return (a = w.get(this))[b].apply(a, arguments);
        };
      });
      var D = 'undefined' !== typeof p.ResizeObserver ? p.ResizeObserver : t;
      return D;
    });
  },
  fn: 'resizeobserver_polyfill.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    (function () {
      function l(a) {
        try {
          return (a.defaultView && a.defaultView.frameElement) || null;
        } catch (b) {
          return null;
        }
      }
      function v(a) {
        this.time = a.time;
        this.target = a.target;
        this.rootBounds = u(a.rootBounds);
        this.boundingClientRect = u(a.boundingClientRect);
        this.intersectionRect = u(a.intersectionRect || m());
        this.isIntersecting = !!a.intersectionRect;
        a = this.boundingClientRect;
        a = a.width * a.height;
        var b = this.intersectionRect;
        b = b.width * b.height;
        this.intersectionRatio = a
          ? Number((b / a).toFixed(4))
          : this.isIntersecting
            ? 1
            : 0;
      }
      function g(a, b) {
        var c = b || {};
        if ('function' != typeof a) throw Error('callback must be a function');
        if (c.root && 1 != c.root.nodeType && 9 != c.root.nodeType)
          throw Error('root must be a Document or Element');
        this.l = A(this.l.bind(this), this.F);
        this.H = a;
        this.g = [];
        this.h = [];
        this.v = this.M(c.rootMargin);
        this.thresholds = this.L(c.threshold);
        this.root = c.root || null;
        this.rootMargin = this.v
          .map(function (d) {
            return d.value + d.D;
          })
          .join(' ');
        this.i = [];
        this.j = [];
      }
      function A(a, b) {
        var c = null;
        return function () {
          c ||
            (c = setTimeout(function () {
              a();
              c = null;
            }, b));
        };
      }
      function w(a, b, c, d) {
        'function' == typeof a.addEventListener
          ? a.addEventListener(b, c, d || !1)
          : 'function' == typeof a.attachEvent && a.attachEvent('on' + b, c);
      }
      function x(a, b, c, d) {
        'function' == typeof a.removeEventListener
          ? a.removeEventListener(b, c, d || !1)
          : 'function' == typeof a.R && a.R('on' + b, c);
      }
      function n(a) {
        try {
          var b = a.getBoundingClientRect();
        } catch (c) {}
        if (!b) return m();
        (b.width && b.height) ||
          (b = {
            top: b.top,
            right: b.right,
            bottom: b.bottom,
            left: b.left,
            width: b.right - b.left,
            height: b.bottom - b.top,
          });
        return b;
      }
      function m() {
        return { top: 0, bottom: 0, left: 0, right: 0, width: 0, height: 0 };
      }
      function u(a) {
        return !a || 'x' in a
          ? a
          : {
              top: a.top,
              y: a.top,
              bottom: a.bottom,
              left: a.left,
              x: a.left,
              right: a.right,
              width: a.width,
              height: a.height,
            };
      }
      function y(a, b) {
        for (var c = b; c; ) {
          if (c == a) return !0;
          c = p(c);
        }
        return !1;
      }
      function p(a) {
        var b = a.parentNode;
        if (9 == a.nodeType && a != k) return l(a);
        b && b.assignedSlot && (b = b.assignedSlot.parentNode);
        return b && 11 == b.nodeType && b.host ? b.host : b;
      }
      function z(a) {
        return a && 9 === a.nodeType;
      }
      if ('object' === typeof window)
        if (
          'IntersectionObserver' in window &&
          'IntersectionObserverEntry' in window &&
          'intersectionRatio' in window.IntersectionObserverEntry.prototype
        )
          'isIntersecting' in window.IntersectionObserverEntry.prototype ||
            Object.defineProperty(
              window.IntersectionObserverEntry.prototype,
              'isIntersecting',
              {
                get: function () {
                  return 0 < this.intersectionRatio;
                },
              },
            );
        else {
          var k = (function (a) {
              for (var b = l(a); b; ) (a = b.ownerDocument), (b = l(a));
              return a;
            })(window.document),
            q = [];
          g.prototype.F = 100;
          g.prototype.m = null;
          g.prototype.G = !0;
          g.prototype.observe = function (a) {
            if (
              !this.g.some(function (b) {
                return b.element == a;
              })
            ) {
              if (!a || 1 != a.nodeType)
                throw Error('target must be an Element');
              this.N();
              this.g.push({ element: a, C: null });
              this.s(a.ownerDocument);
              this.l();
            }
          };
          g.prototype.unobserve = function (a) {
            this.g = this.g.filter(function (b) {
              return b.element != a;
            });
            this.A(a.ownerDocument);
            0 == this.g.length && this.B();
          };
          g.prototype.disconnect = function () {
            this.g = [];
            this.P();
            this.B();
          };
          g.prototype.takeRecords = function () {
            var a = this.h.slice();
            this.h = [];
            return a;
          };
          g.prototype.L = function (a) {
            a = a || [0];
            Array.isArray(a) || (a = [a]);
            return a.sort().filter(function (b, c, d) {
              if ('number' != typeof b || isNaN(b) || 0 > b || 1 < b)
                throw Error(
                  'threshold must be a number between 0 and 1 inclusively',
                );
              return b !== d[c - 1];
            });
          };
          g.prototype.M = function (a) {
            a = (a || '0px').split(/\s+/).map(function (b) {
              b = /^(-?\d*\.?\d+)(px|%)$/.exec(b);
              if (!b)
                throw Error(
                  'rootMargin must be specified in pixels or percent',
                );
              return { value: parseFloat(b[1]), D: b[2] };
            });
            a[1] = a[1] || a[0];
            a[2] = a[2] || a[0];
            a[3] = a[3] || a[1];
            return a;
          };
          g.prototype.s = function (a) {
            var b = a.defaultView;
            if (b && -1 == this.i.indexOf(a)) {
              var c = this.l,
                d = null,
                e = null;
              this.m
                ? (d = b.setInterval(c, this.m))
                : (w(b, 'resize', c, !0),
                  w(a, 'scroll', c, !0),
                  this.G &&
                    'MutationObserver' in b &&
                    ((e = new b.MutationObserver(c)),
                    e.observe(a, {
                      attributes: !0,
                      childList: !0,
                      characterData: !0,
                      subtree: !0,
                    })));
              this.i.push(a);
              this.j.push(function () {
                var f = a.defaultView;
                f && (d && f.clearInterval(d), x(f, 'resize', c, !0));
                x(a, 'scroll', c, !0);
                e && e.disconnect();
              });
              a !=
                ((this.root && (this.root.ownerDocument || this.root)) || k) &&
                (b = l(a)) &&
                this.s(b.ownerDocument);
            }
          };
          g.prototype.A = function (a) {
            var b = this.i.indexOf(a);
            if (-1 != b) {
              var c =
                (this.root && (this.root.ownerDocument || this.root)) || k;
              if (
                !this.g.some(function (e) {
                  e = e.element.ownerDocument;
                  if (e == a) return !0;
                  for (; e && e != c; )
                    if (((e = (e = l(e)) && e.ownerDocument), e == a))
                      return !0;
                  return !1;
                })
              ) {
                var d = this.j[b];
                this.i.splice(b, 1);
                this.j.splice(b, 1);
                d();
                a != c && (b = l(a)) && this.A(b.ownerDocument);
              }
            }
          };
          g.prototype.P = function () {
            var a = this.j.slice(0);
            this.i.length = 0;
            for (var b = (this.j.length = 0); b < a.length; b++) a[b]();
          };
          g.prototype.l = function () {
            var a = this.O(),
              b = a ? this.J() : m();
            this.g.forEach(function (c) {
              var d = c.element,
                e = n(d),
                f = this.u(d),
                h = c.C,
                r = a && f && this.o(d, e, b);
              var t = this.u(d) ? b : m();
              c = c.C = new v({
                time:
                  window.performance && performance.now && performance.now(),
                target: d,
                boundingClientRect: e,
                rootBounds: t,
                intersectionRect: r,
              });
              h
                ? a && f
                  ? this.K(h, c) && this.h.push(c)
                  : h && h.isIntersecting && this.h.push(c)
                : this.h.push(c);
            }, this);
            this.h.length && this.H(this.takeRecords(), this);
          };
          g.prototype.o = function (a, b, c) {
            if ('none' != window.getComputedStyle(a).display) {
              var d = b;
              b = p(a);
              for (a = !1; !a && b; ) {
                var e = null,
                  f = 1 == b.nodeType ? window.getComputedStyle(b) : {};
                if ('none' == f.display) return null;
                if (b == this.root || 9 == b.nodeType)
                  if (((a = !0), b == this.root || b == k)) e = c;
                  else {
                    var h = (b = p(b)) && n(b);
                    f = b && this.o(b, h, c);
                    h && f
                      ? ((e = f.top - h.top),
                        (h = f.left - h.left),
                        (e = {
                          top: e,
                          left: h,
                          height: f.height,
                          width: f.width,
                          bottom: e + f.height,
                          right: h + f.width,
                        }))
                      : (d = b = null);
                  }
                else
                  (h = b.ownerDocument),
                    b != h.body &&
                      b != h.documentElement &&
                      'visible' != f.overflow &&
                      (e = n(b));
                if (e) {
                  f = Math.max(e.top, d.top);
                  h = Math.min(e.bottom, d.bottom);
                  var r = Math.max(e.left, d.left);
                  d = Math.min(e.right, d.right);
                  e = d - r;
                  var t = h - f;
                  d =
                    (0 <= e &&
                      0 <= t && {
                        top: f,
                        bottom: h,
                        left: r,
                        right: d,
                        width: e,
                        height: t,
                      }) ||
                    null;
                }
                if (!d) break;
                b = b && p(b);
              }
              return d;
            }
          };
          g.prototype.J = function () {
            if (this.root && !z(this.root)) var a = n(this.root);
            else {
              var b = z(this.root) ? this.root : k;
              a = b.documentElement;
              b = b.body;
              a = {
                top: 0,
                left: 0,
                right: a.clientWidth || b.clientWidth,
                width: a.clientWidth || b.clientWidth,
                bottom: a.clientHeight || b.clientHeight,
                height: a.clientHeight || b.clientHeight,
              };
            }
            return this.I(a);
          };
          g.prototype.I = function (a) {
            var b = this.v.map(function (c, d) {
              return 'px' == c.D
                ? c.value
                : (c.value * (d % 2 ? a.width : a.height)) / 100;
            });
            b = {
              top: a.top - b[0],
              right: a.right + b[1],
              bottom: a.bottom + b[2],
              left: a.left - b[3],
            };
            b.width = b.right - b.left;
            b.height = b.bottom - b.top;
            return b;
          };
          g.prototype.K = function (a, b) {
            var c = a && a.isIntersecting ? a.intersectionRatio || 0 : -1,
              d = b.isIntersecting ? b.intersectionRatio || 0 : -1;
            if (c !== d)
              for (var e = 0; e < this.thresholds.length; e++) {
                var f = this.thresholds[e];
                if (f == c || f == d || f < c !== f < d) return !0;
              }
          };
          g.prototype.O = function () {
            return !this.root || y(k, this.root);
          };
          g.prototype.u = function (a) {
            var b = (this.root && (this.root.ownerDocument || this.root)) || k;
            return y(b, a) && (!this.root || b == a.ownerDocument);
          };
          g.prototype.N = function () {
            0 > q.indexOf(this) && q.push(this);
          };
          g.prototype.B = function () {
            var a = q.indexOf(this);
            -1 != a && q.splice(a, 1);
          };
          window.IntersectionObserver = g;
          window.IntersectionObserverEntry = v;
        }
    })();
  },
  fn: 'intersectionobserver_polyfill.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('Object.js');
    require('String');
    require('Math');
    require('Promise.js');
    if (!global.ResizeObserver) {
      global.ResizeObserver = require('ResizeObserver_polyfill.js');
    }
    require('IntersectionObserver_polyfill.js');
  },
  fn: 'declarationextensionsobjetnatif.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.assert = void 0;
    exports.breakpoint = breakpoint;
    require('DeclarationExtensionsObjetNatif');
    const assert = (aIgnorer, aMessage) => {};
    exports.assert = assert;
    global.assert = assert;
    function breakpoint() {}
  },
  fn: 'divers.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GUID = exports.GenerateurGUID = void 0;
    require('NamespaceIE');
    let lGUID_id = 1;
    let lGUID_ClassCss = 1;
    class GenerateurGUID {
      constructor() {
        this.fGUID = 1;
        this.fCompteur = 0;
      }
      get() {
        let lResult = 'g';
        if (this.fCompteur > 0) {
          lResult += this.fCompteur + 'x';
        }
        lResult += this.fGUID;
        if (this.fGUID === Number.MAX_VALUE) {
          this.fGUID = 1;
          this.fCompteur += 1;
        } else {
          this.fGUID += 1;
        }
        return lResult;
      }
    }
    exports.GenerateurGUID = GenerateurGUID;
    let GUID = {
      getId() {
        const lResult = 'id_' + lGUID_id;
        lGUID_id += 1;
        return lResult;
      },
      getClassCss() {
        const lResult = 'c_' + lGUID_ClassCss;
        lGUID_ClassCss += 1;
        return lResult;
      },
      generateur: GenerateurGUID,
      getGUIDDelphiVide() {
        return '{00000000-0000-0000-0000-000000000000}';
      },
    };
    exports.GUID = GUID;
  },
  fn: 'guid.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.MethodesObjet = MethodesObjet;
    require('NamespaceIE');
    require('DeclarationExtensionsObjetNatif');
    function MethodesObjet() {}
    MethodesObjet.getObjectClass = function (aObjet) {
      if (aObjet && aObjet.constructor) {
        return MethodesObjet.getNomClassDeConstructeur(aObjet.constructor);
      }
      return undefined;
    };
    MethodesObjet.getNomClassDeConstructeur = function (aConstructeur) {
      if (aConstructeur && aConstructeur.name) {
        return aConstructeur.name;
      }
      if (
        aConstructeur &&
        aConstructeur.toString &&
        MethodesObjet.isFunction(aConstructeur)
      ) {
        const T = aConstructeur.toString().match(/function\s*(\w+)/);
        if (T && T.length === 2) {
          return T[1];
        }
      }
      return undefined;
    };
    function _dupliquer(
      aObjet,
      _aProfondeur,
      _aDuplicationParesseuse,
      aProprietaires,
      aProprietairesCopie,
    ) {
      if (!aObjet || !MethodesObjet.isObject(aObjet)) {
        return aObjet;
      }
      if ('dupliquer' in aObjet && MethodesObjet.isFunction(aObjet.dupliquer)) {
        return aObjet.dupliquer();
      }
      if (Object.prototype.toString.call(aObjet) === '[object File]') {
        return aObjet;
      }
      if (_aProfondeur > 1000) {
        return aObjet;
      }
      let lIndice = -1;
      if (aProprietaires.length > 0) {
        lIndice = aProprietaires.indexOf(aObjet);
      }
      if (lIndice >= 0) {
        return aProprietairesCopie[lIndice];
      }
      let lObjetDuplique, lProp;
      if (MethodesObjet.isArray(aObjet)) {
        lObjetDuplique = new Array(aObjet.length);
      } else if (MethodesObjet.isDate(aObjet)) {
        lObjetDuplique = new Date();
        lObjetDuplique.setTime(aObjet.getTime());
      } else if (MethodesObjet.isBlob(aObjet)) {
        lObjetDuplique = new Blob([aObjet], { type: aObjet.type });
      } else {
        lObjetDuplique = Object.create(aObjet.constructor.prototype);
      }
      const lProfondeur = _aProfondeur + 1;
      aProprietaires.push(aObjet);
      aProprietairesCopie.push(lObjetDuplique);
      try {
        const lKeys = Object.keys(aObjet);
        for (let i = 0; i < lKeys.length; i++) {
          lProp = lKeys[i];
          const lValeur = aObjet[lProp];
          if (MethodesObjet.isObject(lValeur)) {
            if (_aDuplicationParesseuse && _aProfondeur === 0) {
              lObjetDuplique[lProp] = lValeur;
            } else {
              lObjetDuplique[lProp] = _dupliquer(
                lValeur,
                lProfondeur,
                false,
                aProprietaires,
                aProprietairesCopie,
              );
            }
          } else {
            lObjetDuplique[lProp] = lValeur;
          }
        }
      } finally {
        aProprietaires.pop();
        aProprietairesCopie.pop();
      }
      return lObjetDuplique;
    }
    MethodesObjet.dupliquer = function (aObjet, aDuplicationParesseuse) {
      return _dupliquer(aObjet, 0, aDuplicationParesseuse, [], []);
    };
    MethodesObjet.isArray = function (object) {
      return Array.isArray(object);
    };
    MethodesObjet.isFunction = function (object) {
      return typeof object === 'function';
    };
    MethodesObjet.isString = function (object) {
      return Object.prototype.toString.call(object) === '[object String]';
    };
    MethodesObjet.isNumber = function (object) {
      return (
        !isNaN(object) &&
        Object.prototype.toString.call(object) === '[object Number]'
      );
    };
    MethodesObjet.isUndefined = function (object) {
      return typeof object === 'undefined';
    };
    MethodesObjet.isObject = function (object) {
      return !!object && typeof object === 'object';
    };
    MethodesObjet.isDate = function (object) {
      return Object.prototype.toString.call(object) === '[object Date]';
    };
    MethodesObjet.isNan = function (object) {
      const rdigit = /\d/;
      return (
        object === null ||
        object === undefined ||
        !rdigit.test(object) ||
        isNaN(object)
      );
    };
    MethodesObjet.isNumeric = function (object) {
      return !isNaN(parseFloat(object)) && isFinite(object);
    };
    MethodesObjet.isBoolean = function (object) {
      return object === true || object === false;
    };
    MethodesObjet.isWindow = function (object) {
      return !!object && typeof object === 'object' && 'setInterval' in object;
    };
    MethodesObjet.isBlob = function (object) {
      return Object.prototype.toString.call(object) === '[object Blob]';
    };
    MethodesObjet.get = function (aObjet, aAccesseur) {
      let lObjet, i, lNomProp, lIndexProp;
      if (!aObjet || !aAccesseur || !aAccesseur.length) {
        return aObjet;
      }
      if (typeof aAccesseur === 'string') {
        aAccesseur = aAccesseur.split('.');
      }
      const lLength = aAccesseur.length;
      if (lLength === 0) {
        return aObjet;
      }
      lObjet = aObjet;
      for (i = 0; i < lLength; i++) {
        if (!lObjet) {
          return undefined;
        }
        lNomProp = aAccesseur[i];
        lIndexProp = false;
        if (
          lNomProp.indexOf('[') > 0 &&
          lNomProp.indexOf(']') === lNomProp.length - 1
        ) {
          lIndexProp = lNomProp.match(/\[['"]?(.*)['"]?\]$/)[1];
          lNomProp = lNomProp.replace(/\[['"]?(.*)['"]?\]$/, '');
        }
        lObjet = lObjet[lNomProp];
        if (lIndexProp) {
          lObjet = lObjet[lIndexProp];
        }
      }
      return lObjet;
    };
    MethodesObjet.set = function (aObjet, aAccesseur, aValue) {
      if (aAccesseur && typeof aAccesseur === 'string') {
        aAccesseur = aAccesseur.split('.');
      }
      let lConteneur;
      let lNomProp;
      if (!aAccesseur || !aAccesseur.length) {
        return false;
      }
      lNomProp = aAccesseur[aAccesseur.length - 1];
      if (aAccesseur.length === 1) {
        lConteneur = aObjet;
      } else {
        lConteneur = MethodesObjet.get(
          aObjet,
          aAccesseur.slice(0, aAccesseur.length - 1),
        );
      }
      if (lConteneur && lNomProp) {
        lConteneur[lNomProp] = aValue;
        return true;
      }
      return false;
    };
    MethodesObjet.nomProprieteDeValeur = function (aObjet, aValeur) {
      const lKeys = Object.keys(aObjet);
      for (let i = 0; i < lKeys.length; i++) {
        if (aValeur === aObjet[lKeys[i]]) {
          return lKeys[i];
        }
      }
      return '';
    };
    function _indenterEnumere(aEnumere, aParam) {
      let lProp;
      if (!aParam) {
        aParam = {};
      }
      aParam.indice = aParam.indice || 0;
      if (!aEnumere) {
        return;
      }
      for (lProp in aEnumere) {
        if (MethodesObjet.isNumber(aEnumere[lProp])) {
          aEnumere[lProp] = aParam.indice;
          aParam.indice += 1;
        } else if (MethodesObjet.isObject(aEnumere[lProp])) {
          _indenterEnumere(aEnumere[lProp], aParam);
        }
      }
    }
    MethodesObjet.indenterEnumere = function (aEnumere, aIndiceInitiale) {
      if (MethodesObjet.isObject(aEnumere)) {
        _indenterEnumere(aEnumere, { indice: aIndiceInitiale });
      }
    };
    function _affecterValeurEnumere(aEnumere) {
      let lProp;
      if (!aEnumere) {
        return;
      }
      const lKeys = Object.keys(aEnumere);
      for (let i = 0; i < lKeys.length; i++) {
        lProp = lKeys[i];
        if (MethodesObjet.isObject(aEnumere[lProp])) {
          _affecterValeurEnumere(aEnumere[lProp]);
        } else {
          aEnumere[lProp] = lProp;
        }
      }
    }
    MethodesObjet.affecterValeurEnumere = function (aEnumere) {
      if (MethodesObjet.isObject(aEnumere)) {
        _affecterValeurEnumere(aEnumere);
      }
    };
    MethodesObjet.objetsIdentiques = function (
      aObjet1,
      aObjet2,
      aComparaisonProfonde,
    ) {
      if ((!aObjet1 && aObjet2) || (aObjet1 && !aObjet2)) {
        return false;
      }
      if (!aObjet1 && !aObjet2) {
        return true;
      }
      if (aObjet1 === aObjet2) {
        return true;
      }
      let i;
      let lKeys = Object.keys(aObjet1);
      const lDejaCompare = {};
      for (i = 0; i < lKeys.length; i++) {
        if (aObjet1[lKeys[i]] !== aObjet2[lKeys[i]]) {
          if (
            aComparaisonProfonde === true &&
            MethodesObjet.isObject(aObjet1[lKeys[i]]) &&
            MethodesObjet.isObject(aObjet2[lKeys[i]])
          ) {
            lDejaCompare[lKeys[i]] = true;
            if (
              !MethodesObjet.objetsIdentiques(
                aObjet1[lKeys[i]],
                aObjet2[lKeys[i]],
                true,
              )
            ) {
              return false;
            }
          } else {
            return false;
          }
        }
      }
      lKeys = Object.keys(aObjet2);
      for (i = 0; i < lKeys.length; i++) {
        if (aObjet1[lKeys[i]] !== aObjet2[lKeys[i]]) {
          if (aComparaisonProfonde === true) {
            if (
              !lDejaCompare[lKeys[i]] &&
              MethodesObjet.isObject(aObjet1[lKeys[i]]) &&
              MethodesObjet.isObject(aObjet2[lKeys[i]]) &&
              !MethodesObjet.objetsIdentiques(
                aObjet1[lKeys[i]],
                aObjet2[lKeys[i]],
                true,
              )
            ) {
              return false;
            }
          } else {
            return false;
          }
        }
      }
      return true;
    };
    MethodesObjet.enumKeys = function (aEnum) {
      return Object.keys(aEnum || {}).filter((aVal) => Number.isNaN(+aVal));
    };
    MethodesObjet.valueInEnum = function (aValue, aEnum) {
      for (const lKey of MethodesObjet.enumKeys(aEnum)) {
        const lVal = aEnum[lKey];
        if (lVal === aValue) {
          return true;
        }
      }
      return false;
    };
  },
  fn: 'methodesobjet.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Invocateur = exports.ObjetInvocateur = void 0;
    require('NamespaceIE');
    require('DeclarationJQuery.js');
    require('Divers.js');
    require('String');
    const GUID_1 = require('GUID');
    const MethodesObjet_1 = require('MethodesObjet');
    const lGUID_GlobalNomPile = new GUID_1.GUID.generateur();
    class ObjetInvocateur {
      constructor(aAbonnementInstanceInterdite = false) {
        this.abonnementInstanceInterdite = false;
        this.pile = {};
        this.pileEvents = {};
        this.generateurGUID = new GUID_1.GUID.generateur();
        this.abonnementInstanceInterdite = aAbonnementInstanceInterdite;
        this.nomPileInstance =
          '__pileInvocateur__' +
          (aAbonnementInstanceInterdite ? '' : lGUID_GlobalNomPile.get());
      }
      abonner(aEvent, aCallback, aInstance, aAvecAbonnementUnicite) {
        if (this.abonnementInstanceInterdite && aInstance) {
          throw new Error('interdiction');
        }
        return this._abonnerTous({
          e: aEvent,
          callB: aCallback,
          inst: aInstance,
          unicite: aAvecAbonnementUnicite !== false,
        });
      }
      abonnerUnique(aEvent, aCallback, aInstance, aAvecAbonnementUnicite) {
        return this._abonnerTous({
          e: aEvent,
          callB: aCallback,
          inst: aInstance,
          u: true,
          unicite: aAvecAbonnementUnicite !== false,
        });
      }
      desabonner(aParam1, aParam2, aParam3) {
        if (!aParam1) {
          return;
        }
        let lEvent, lInstance, lCallBack, lEventsASupprimer, lId;
        if (Array.isArray(aParam1)) {
          this._supprimerIds(aParam1);
          return;
        }
        if (typeof aParam1 === 'object') {
          lInstance = aParam1;
          if (typeof aParam2 !== 'object') {
            lCallBack = aParam2;
          }
        } else {
          lEvent = aParam1.toString();
          if (typeof aParam2 === 'object') {
            lInstance = aParam2;
          } else {
            lCallBack = aParam2;
            if (typeof aParam3 === 'object') {
              lInstance = aParam3;
            }
          }
        }
        if (lEvent) {
          const lTab = lEvent.split(' ');
          for (let i = 0; i < lTab.length; i++) {
            this._desabonnerParEvent(lTab[i].trim(), lInstance, lCallBack);
          }
        } else if (this.isInstanceAbonnable(lInstance)) {
          const lPile = lInstance.getPileAbonnement();
          const lPileInstance = lPile[this.nomPileInstance];
          if (lPileInstance) {
            lEventsASupprimer = [];
            for (lId in lPileInstance) {
              if (lPileInstance.hasOwnProperty(lId)) {
                if (lCallBack) {
                  if (this.pile[lId] && this.pile[lId].callB === lCallBack) {
                    lEventsASupprimer.push(lId);
                  }
                } else {
                  lEventsASupprimer.push(lId);
                }
              }
            }
            if (!lCallBack) {
              delete lPile[this.nomPileInstance];
            }
            this._supprimerIds(lEventsASupprimer);
          }
        }
      }
      evenement(aEvent, ...aArgs) {
        if (!aEvent) {
          return;
        }
        const lEvent = aEvent.toString();
        const lEvents = this.pileEvents[lEvent];
        let lId, lElement, lResult;
        const lEventsATraiter = [];
        let lAvecEvenement = false;
        if (lEvents) {
          for (lId in lEvents) {
            lAvecEvenement = true;
            lElement = this.pile[lId];
            if (lElement && lElement.callB) {
              lEventsATraiter.push(lElement);
            }
          }
        }
        if (!lAvecEvenement) {
          delete this.pileEvents[lEvent];
        }
        for (let i = 0, lLength = lEventsATraiter.length; i < lLength; i += 1) {
          lElement = lEventsATraiter[i];
          if (lElement && !lElement.__INACTIF__) {
            if (lElement.u) {
              this._supprimerIds([lElement.id]);
            }
            if (lElement.callB) {
              lResult = lElement.callB.call(lElement.inst, ...aArgs);
              if (lResult === false) {
                return;
              }
            }
          }
        }
      }
      _abonner(aParams) {
        if (!aParams.e || !aParams.e.toString) {
          return null;
        }
        aParams.e = aParams.e.toString();
        if (!aParams.callB) {
          return null;
        }
        const lInstanceAbo = this.isInstanceAbonnable(aParams.inst)
          ? aParams.inst
          : null;
        if (aParams.unicite) {
          this.desabonner(aParams.e, aParams.callB, lInstanceAbo);
        }
        if (!this.pileEvents[aParams.e]) {
          this.pileEvents[aParams.e] = {};
        }
        const lId = this.generateurGUID.get();
        aParams.id = lId;
        this.pile[lId] = aParams;
        this.pileEvents[aParams.e][lId] = true;
        if (lInstanceAbo) {
          const lPile = lInstanceAbo.getPileAbonnement();
          if (!lPile[this.nomPileInstance]) {
            lPile[this.nomPileInstance] = {};
          }
          lPile[this.nomPileInstance][lId] = true;
        }
        return lId;
      }
      _supprimerIds(aIds) {
        if (!aIds) {
          return;
        }
        let lId, i, lElement, lInstance, lLength;
        for (i = 0, lLength = aIds.length; i < lLength; i += 1) {
          lId = aIds[i];
          lElement = this.pile[lId];
          if (lElement) {
            lInstance = lElement.inst;
            if (this.isInstanceAbonnable(lInstance)) {
              const lPile = lInstance.getPileAbonnement();
              if (
                lPile &&
                lPile[this.nomPileInstance] &&
                lPile[this.nomPileInstance][lId]
              ) {
                delete lPile[this.nomPileInstance][lId];
                if ($.isEmptyObject(lPile[this.nomPileInstance])) {
                  delete lPile[this.nomPileInstance];
                }
              }
            }
            if (this.pileEvents[lElement.e]) {
              if (this.pileEvents[lElement.e][lId]) {
                delete this.pileEvents[lElement.e][lId];
              }
            }
            lElement = null;
            if (this.pile[lId]) {
              this.pile[lId].__INACTIF__ = true;
            }
            delete this.pile[lId];
          }
        }
      }
      _abonnerTous(aParam) {
        const lIds = [];
        let lEvent;
        if (aParam.e && aParam.e.split) {
          const lTab = aParam.e.split(' ');
          for (let i = 0, lNb = lTab.length; i < lNb; i++) {
            lEvent = lTab[i].trim();
            lIds.push(
              this._abonner({
                e: lEvent,
                callB: aParam.callB,
                inst: aParam.inst,
                unicite: aParam.unicite,
                u: aParam.u,
              }),
            );
          }
        }
        if (lIds.length === 0) {
          return null;
        }
        if (lIds.length === 1) {
          return lIds[0];
        }
        return lIds;
      }
      _desabonnerParEvent(aEvent, aInstance, aCallback) {
        const lEvents = this.pileEvents[aEvent];
        let lEventsASupprimer, lId, lElement;
        if (!lEvents) {
          return;
        }
        if (aInstance) {
          if (this.isInstanceAbonnable(aInstance)) {
            const lPileInstance =
              aInstance.getPileAbonnement()[this.nomPileInstance];
            if (!lPileInstance) {
              return;
            }
            lEventsASupprimer = [];
            for (lId in lPileInstance) {
              if (lPileInstance.hasOwnProperty(lId)) {
                lElement = this.pile[lId];
                if (lElement && lElement.e === aEvent) {
                  if (!aCallback || aCallback === lElement.callB) {
                    lEventsASupprimer.push(lId);
                  }
                }
              }
            }
          }
        } else if (aCallback) {
          lEventsASupprimer = [];
          for (lId in lEvents) {
            if (this.pile[lId] && this.pile[lId].callB === aCallback) {
              lEventsASupprimer.push(lId);
            }
          }
        } else {
          lEventsASupprimer = lEvents;
          delete this.pileEvents[aEvent];
        }
        if (
          lEventsASupprimer &&
          Array.isArray(lEventsASupprimer) &&
          lEventsASupprimer.length > 0
        ) {
          this._supprimerIds(lEventsASupprimer);
        }
      }
      isInstanceAbonnable(aInstance) {
        return (
          aInstance &&
          'getPileAbonnement' in aInstance &&
          MethodesObjet_1.MethodesObjet.isFunction(aInstance.getPileAbonnement)
        );
      }
    }
    exports.ObjetInvocateur = ObjetInvocateur;
    (function (ObjetInvocateur) {
      let events;
      (function (events) {
        events['initChiffrement'] = 'IIE_initChiffrement';
        events['patience'] = 'IIE_patience';
        events['modificationModeExclusif'] = 'IIE_modification_ModeExclusif';
        events['modeExclusif'] = 'IIE_ModeExclusif';
        events['modificationPresenceUtilisateur'] =
          'IIE_ModificationPresenceUtilisateur';
        events['interruption_Requete'] = 'IIE_Interruption_Requete';
        events['activationImpression'] = 'IIE_Activation_Impression';
        events['choixImpression'] = 'IIE_choix_impression';
        events['autorisationRechargementPage'] =
          'IIE_AutorisationRechargementPage';
        events['surRechargementPage'] = 'IIE_SurRechargementPage';
        events['etatSaisie'] = 'IIE_setEtatSaisie';
        events['fermerFenetres'] = 'IIE_fermer_fenetres';
        events['resizeNavigateur'] = 'IIE_resizeNavigateur';
        events['actualisationAffichage'] = 'IIE_actualisation_affichage';
        events['eventReponseUpload'] = 'IIE_eventReponseUpload';
        events['eventIOAjax'] = 'IIE_eventIOAjax';
        events['refreshIEHtml'] = 'IEE_refreshIEHtml';
        events['erreurCommunication'] = 'IEE_erreurCommunication';
        events['navigationOnglet'] = 'IEE_navigationOnglet';
        events['changerMembre'] = 'IEE_changerMembre';
        events['toucheDEBUG'] = 'IIE_ToucheDEBUG';
        events['DEBUG_log'] = 'IIE_ADDLOG';
        events['DEBUG_logRequete'] = 'IIE_ADDLOG_REQUETE';
      })((events = ObjetInvocateur.events || (ObjetInvocateur.events = {})));
    })(ObjetInvocateur || (exports.ObjetInvocateur = ObjetInvocateur = {}));
    exports.Invocateur = new ObjetInvocateur();
  },
  fn: 'invocateur.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Support = void 0;
    require('DeclarationJQuery.js');
    const MethodesObjet_1 = require('MethodesObjet');
    const GenreNavigateur = { Standard: 1, Webkit: 2, Moz: 3, Opera: 4, IE: 5 };
    let Support = {
      init: false,
      GenreNavigateur: GenreNavigateur,
      supportFilterIE: false,
      supportEventOnPopState: false,
      supportEventPaste: false,
      supportEventInput: false,
      supportTouch: false,
      tactile: false,
      supportBorderRadius: _initTableau(),
      avecBorderRadius: false,
      supportGradient: _initTableau(),
      supportOpacity: _initTableau(),
      avecSupportOpacity: false,
      supportBoxShadow: _initTableau(),
      avecSupportBoxShadow: false,
      supportTransitions: _initTableau(),
      avecSupportTransitions: false,
      transitionEndEvent: '',
      supportTransforms: _initTableau(),
      avecSupportTransform: false,
      supportBackgroundSize: _initTableau(),
      avecBackgroundSize: false,
      bordureExterneDIV: false,
      bordureExterneTD: false,
      div100PourcentDansTDGardeHauteurTD: false,
      tailleScrollBar: 0,
      estOverlayScrollbar: false,
      scrollBarWidth: -1,
      avecSupportFileUpload: false,
      supportPointerEventsNone: false,
      supportCanvas: false,
      supportCanvasText: false,
      supportBlob: false,
      supportNotification: false,
      speechRecognition: false,
      speechSynthesis: false,
      contentEditable: false,
      permissionNotification: {
        defaut: 'default',
        granted: 'granted',
        denied: 'denied',
      },
      refreshNotification: null,
      addInit(aCallback) {
        if (this.init) {
          aCallback();
        } else {
          uPileInit.push(aCallback);
        }
      },
      toString() {
        let lChaine = '';
        let lValeur;
        let lChaineSupport;
        for (const lProp in Support) {
          lValeur = Support[lProp];
          if (MethodesObjet_1.MethodesObjet.isArray(lValeur)) {
            lChaine += lProp + ' - [';
            lChaineSupport = '';
            for (const i in lValeur) {
              if (lValeur[i]) {
                lChaineSupport +=
                  (lChaineSupport.length > 0 ? ', ' : '') +
                  MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
                    GenreNavigateur,
                    parseInt(i, 10),
                  );
              }
            }
            lChaine +=
              (lChaineSupport.length > 0 ? lChaineSupport : 'NON SUPPORTE') +
              ']\n';
          } else if (
            !MethodesObjet_1.MethodesObjet.isFunction(lValeur) &&
            !MethodesObjet_1.MethodesObjet.isObject(lValeur)
          ) {
            lChaine += lProp + ' - ' + Support[lProp] + '\n';
          }
        }
        return lChaine;
      },
    };
    exports.Support = Support;
    function _initTableau() {
      const lTableau = [];
      for (const lProp in GenreNavigateur) {
        lTableau[GenreNavigateur[lProp]] = false;
      }
      return lTableau;
    }
    let uPileInit = [];
    function _testerSupports(aDoc) {
      let lProp;
      const LExtensionsStyle = {};
      LExtensionsStyle[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Standard,
        )
      ] = '';
      LExtensionsStyle[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Webkit,
        )
      ] = 'Webkit';
      LExtensionsStyle[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Moz,
        )
      ] = 'Moz';
      LExtensionsStyle[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Opera,
        )
      ] = 'O';
      LExtensionsStyle[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.IE,
        )
      ] = 'MS';
      const lExtensionsCss = {};
      lExtensionsCss[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Standard,
        )
      ] = '';
      lExtensionsCss[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Webkit,
        )
      ] = '-webkit-';
      lExtensionsCss[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Moz,
        )
      ] = '-moz-';
      lExtensionsCss[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.Opera,
        )
      ] = '-o-';
      lExtensionsCss[
        MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
          GenreNavigateur,
          GenreNavigateur.IE,
        )
      ] = '-ms-';
      const lElement = aDoc.createElement('div');
      function _contains(aChaine, aSousChaine) {
        return ('' + aChaine).indexOf(aSousChaine) !== -1;
      }
      function _getNomPropEtendu(aStyle, aExtension) {
        return aExtension.length > 0 ? aExtension + aStyle.ucfirst() : aStyle;
      }
      function _existeStyle(aStyle, aExtension) {
        return !MethodesObjet_1.MethodesObjet.isUndefined(
          lElement.style[_getNomPropEtendu(aStyle, aExtension)],
        );
      }
      function _leStyleContientLaChaine(aStyle, aExtension, aChaine) {
        const lStyle = lElement.style[_getNomPropEtendu(aStyle, aExtension)];
        return (
          !MethodesObjet_1.MethodesObjet.isUndefined(lStyle) &&
          _contains(lStyle, aChaine)
        );
      }
      Support.supportFilterIE = !MethodesObjet_1.MethodesObjet.isUndefined(
        lElement.style.filter,
      );
      if (!MethodesObjet_1.MethodesObjet.isUndefined(lElement.style.filter)) {
        lElement.style.filter =
          'progid:DXImageTransform.Microsoft.Gradient(gradientType=1,startColorStr=yellow,endColorStr=red);';
        Support.supportFilterIE = lElement.style.filter.length > 0;
      }
      for (lProp in LExtensionsStyle) {
        Support.supportBorderRadius[GenreNavigateur[lProp]] = _existeStyle(
          'borderRadius',
          LExtensionsStyle[lProp],
        );
        if (Support.supportBorderRadius[GenreNavigateur[lProp]]) {
          Support.avecBorderRadius = true;
        }
      }
      lElement.style.cssText =
        'background: linear-gradient(180deg, yellow, blue);';
      Support.supportGradient[GenreNavigateur.Standard] = _contains(
        lElement.style.background,
        'gradient',
      );
      lElement.style.cssText =
        'background: -ms-linear-gradient(180deg, yellow, blue);';
      Support.supportGradient[GenreNavigateur.IE] = _contains(
        lElement.style.background,
        'gradient',
      );
      lElement.style.cssText =
        'background: -webkit-gradient(180deg, left top, right top, from(blue), to(yellow));';
      Support.supportGradient[GenreNavigateur.Webkit] = _contains(
        lElement.style.background,
        'gradient',
      );
      lElement.style.cssText =
        'background: -moz-linear-gradient(180deg, yellow, blue);';
      Support.supportGradient[GenreNavigateur.Moz] = _contains(
        lElement.style.background,
        'gradient',
      );
      for (lProp in LExtensionsStyle) {
        lElement.style.cssText = lExtensionsCss[lProp] + 'opacity:.5;';
        Support.supportOpacity[GenreNavigateur[lProp]] =
          _leStyleContientLaChaine('opacity', LExtensionsStyle[lProp], '0.5');
        if (Support.supportOpacity[GenreNavigateur[lProp]]) {
          Support.avecSupportOpacity = true;
        }
      }
      for (lProp in LExtensionsStyle) {
        Support.supportBoxShadow[GenreNavigateur[lProp]] = _existeStyle(
          'boxShadow',
          LExtensionsStyle[lProp],
        );
        if (Support.supportBoxShadow[GenreNavigateur[lProp]]) {
          Support.avecSupportBoxShadow = true;
        }
      }
      for (lProp in LExtensionsStyle) {
        Support.supportBackgroundSize[GenreNavigateur[lProp]] = _existeStyle(
          'backgroundSize',
          LExtensionsStyle[lProp],
        );
        if (Support.supportBackgroundSize[GenreNavigateur[lProp]]) {
          Support.avecBackgroundSize = true;
        }
      }
      for (lProp in LExtensionsStyle) {
        Support.supportTransitions[GenreNavigateur[lProp]] = _existeStyle(
          'transitionProperty',
          LExtensionsStyle[lProp],
        );
        if (Support.supportTransitions[GenreNavigateur[lProp]]) {
          Support.avecSupportTransitions = true;
        }
      }
      Support.transitionEndEvent = (function () {
        const el = document.createElement('fakeelement');
        const transitions = {
          WebkitTransition: 'webkitTransitionEnd',
          MozTransition: 'transitionend',
          MSTransition: 'msTransitionEnd',
          OTransition: 'oTransitionEnd',
          transition: 'transitionEnd',
        };
        for (const t in transitions) {
          if (el.style[t] !== undefined) {
            return transitions[t];
          }
        }
      })();
      let lNomTransform;
      for (const lProp in LExtensionsStyle) {
        lNomTransform = '';
        switch (GenreNavigateur[lProp]) {
          case GenreNavigateur.Standard:
            lNomTransform = 'transform';
            break;
          case GenreNavigateur.Webkit:
            lNomTransform = 'WebkitTransform';
            break;
          case GenreNavigateur.Moz:
            lNomTransform = 'MozTransform';
            break;
          case GenreNavigateur.Opera:
            lNomTransform = 'OTransform';
            break;
          case GenreNavigateur.IE:
            lNomTransform = 'msTransform';
            break;
        }
        Support.supportTransforms[GenreNavigateur[lProp]] =
          !MethodesObjet_1.MethodesObjet.isUndefined(
            lElement.style[lNomTransform],
          );
        if (Support.supportTransforms[GenreNavigateur[lProp]]) {
          Support.avecSupportTransform = true;
        }
      }
      Support.supportEventOnPopState =
        !MethodesObjet_1.MethodesObjet.isUndefined(window.onpopstate);
      Support.supportEventPaste = 'onpaste' in lElement;
      Support.supportEventInput = 'oninput' in lElement;
      Support.supportTouch =
        'ontouchstart' in window ||
        !!(window.DocumentTouch && document instanceof window.DocumentTouch);
      Support.tactile =
        Support.supportTouch || window.navigator.maxTouchPoints > 0;
      Support.avecSupportFileUpload = (function () {
        if (
          navigator.userAgent.match(
            /(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/,
          )
        ) {
          return false;
        }
        const el = document.createElement('input');
        el.type = 'file';
        return !el.disabled;
      })();
      Support.supportCanvas = !!aDoc.createElement('canvas').getContext;
      Support.supportCanvasText = !!(
        Support.supportCanvas &&
        typeof aDoc.createElement('canvas').getContext('2d').fillText ===
          'function'
      );
      Support.supportBlob = _supportBlob();
      Support.supportNotification = _supportNotif();
      Support.refreshNotification = function () {
        Support.supportNotification = _supportNotif();
      };
      Support.speechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition || null;
      Support.speechSynthesis = !!window.speechSynthesis;
      Support.contentEditable = false;
      if ('contentEditable' in document.documentElement) {
        lElement.contentEditable = 'true';
        Support.contentEditable = lElement.contentEditable === 'true';
      }
    }
    function _supportBlob() {
      let lBlob;
      try {
        lBlob = new Blob(['a'], { type: 'text/plain' });
      } catch (e1) {
        try {
          const BlobBuilder =
            window.MozBlobBuilder ||
            window.WebKitBlobBuilder ||
            window.BlobBuilder;
          if (e1.name === 'TypeError' && window.BlobBuilder) {
            const bb = new BlobBuilder();
            bb.append(['a']);
            lBlob = bb.getBlob('text/plain');
          } else if (e1.name === 'InvalidStateError') {
            lBlob = new Blob(['a'], { type: 'text/plain' });
          }
        } catch (e2) {
          return false;
        }
      }
      if (lBlob) {
        return true;
      }
      return false;
    }
    function _supportNotif() {
      let isSupported = false;
      let windowAny = window;
      try {
        isSupported = !!(
          windowAny.Notification ||
          windowAny.webkitNotifications ||
          navigator.mozNotification
        );
        if (isSupported) {
          if (
            windowAny.Notification &&
            windowAny.Notification.permissionLevel
          ) {
            isSupported = windowAny.Notification.permissionLevel();
          } else if (
            windowAny.webkitNotifications &&
            windowAny.webkitNotifications.checkPermission
          ) {
            if (windowAny.webkitNotifications.checkPermission() === 0) {
              isSupported = Support.permissionNotification.granted;
            } else if (windowAny.webkitNotifications.checkPermission() === 2) {
              isSupported = Support.permissionNotification.denied;
            } else {
              isSupported = Support.permissionNotification.defaut;
            }
          } else if (navigator.mozNotification) {
            isSupported = Support.permissionNotification.granted;
          } else if (
            windowAny.Notification &&
            windowAny.Notification.permission
          ) {
            isSupported = windowAny.Notification.permission;
          }
        }
      } catch (e) {}
      return !!isSupported;
    }
    function _testerSupportHtml() {
      const lBody = document.getElementsByTagName('BODY')[0];
      const lElement = document.createElement('div');
      lBody.appendChild(lElement);
      const lTaille = 50;
      const lId = '_test_';
      lElement.innerHTML =
        '<div id="' +
        lId +
        '" style="height:auto;"><div style="height:' +
        lTaille +
        'px; padding:4px;">&nbsp;</div></div>';
      Support.bordureExterneDIV =
        document.getElementById(lId).offsetHeight === lTaille;
      lElement.innerHTML =
        '<table><tr><td class="PetitEspace" id="' +
        lId +
        '" style="height:' +
        lTaille +
        'px;"><div>&nbsp;</div></td></tr></table>';
      Support.bordureExterneTD =
        document.getElementById(lId).offsetHeight === lTaille;
      lElement.innerHTML =
        '<table style="position:absolute; z-index:-1; visibility:hidden"><tr>' +
        '<td style="height:' +
        lTaille +
        'px;">' +
        '<div id="' +
        lId +
        '" style="height:100%"><div style="height:' +
        (lTaille + 20) +
        'px;"></div></div>' +
        '</td></tr></table>';
      Support.div100PourcentDansTDGardeHauteurTD =
        document.getElementById(lId).offsetHeight === lTaille;
      lElement.innerHTML =
        '<div id="dessous" style="position:absolute;height:10px;width:10px;top:0;left:0;"></div>' +
        '<div id="dessus" style="position:absolute;height:10px;width:10px;top:0;left:0; pointer-events:none;"></div>';
      const lTrouve = document.elementFromPoint
        ? document.elementFromPoint(1, 1)
        : null;
      Support.supportPointerEventsNone = !!lTrouve && lTrouve.id === 'dessous';
      lElement.innerHTML = '<div style="overflow:scroll;"><div></div></div>';
      Support.tailleScrollBar =
        $(lElement).find('>div').get(0).offsetWidth -
        $(lElement).find('>div>div').get(0).offsetWidth;
      Support.estOverlayScrollbar = Support.tailleScrollBar === 0;
      lBody.removeChild(lElement);
    }
    $(window).on('load', () => {
      Support.init = true;
      _testerSupports(window.document);
      _testerSupportHtml();
      uPileInit.forEach((aCallback) => {
        aCallback();
      });
      uPileInit = [];
    });
  },
  fn: 'objetsupport.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('DeclarationJQuery');
    $.fn.extend({
      inputDisabled(aValue) {
        const $this = $(this);
        if (aValue === undefined) {
          return $this.is(':disabled');
        } else {
          $this.attr('disabled', aValue ? 'disabled' : null);
          $this.trigger('IEDisabled');
          return $this;
        }
      },
    });
  },
  fn: 'jinputdisabled.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('DeclarationJQuery');
    $.fn.extend({
      inputChecked(aValue) {
        const $this = $(this);
        if (aValue === undefined) {
          return $this.is(':checked');
        }
        $this.prop('checked', aValue);
        $this.trigger('IEChecked');
        return $this;
      },
    });
  },
  fn: 'jinputchecked.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ControleSaisieEvenement = void 0;
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    let uSaisieEnCours = null,
      uSaisieEnCoursExecution = false;
    const ControleSaisieEvenement = (aCallback, aSansControleNavigation) => {
      if (!aCallback || !MethodesObjet_1.MethodesObjet.isFunction(aCallback)) {
        return;
      }
      if (
        aSansControleNavigation !== true &&
        window.GApplication &&
        !GApplication.getModeExclusif()
      ) {
        let lCallback = null;
        if (_avecSaisieEnCoursActive()) {
          lCallback = uSaisieEnCours.saisie.bind(null, aCallback);
          uSaisieEnCours = null;
        }
        if (
          lCallback ||
          (window.GEtatUtilisateur && window.GEtatUtilisateur.EtatSaisie)
        ) {
          let lPage =
            window.GEtatUtilisateur && window.GEtatUtilisateur.getPageCourante
              ? window.GEtatUtilisateur.getPageCourante()
              : null;
          if (!lPage) {
            lPage =
              window.GInterface && window.GInterface.getPageCourante
                ? window.GInterface.getPageCourante()
                : null;
          }
          if (!lPage || !('setCallbackNavigation' in lPage)) {
            aCallback();
            return;
          }
          if (!lCallback) {
            lCallback = lPage.valider ? lPage.valider.bind(lPage) : null;
          }
          if (!MethodesObjet_1.MethodesObjet.isFunction(lCallback)) {
            aCallback();
            return;
          }
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.etatSaisie,
            false,
          );
          lPage.setCallbackNavigation(null);
          let lCallbackTransmis = false;
          if (!IE.estMobile) {
            lPage.setCallbackNavigation(aCallback);
            lCallbackTransmis = true;
          }
          const lResult = lCallback();
          if (lPage) {
            lPage.focusSurPremierObjet();
          }
          if (!lCallbackTransmis) {
            aCallback();
          }
          return lResult;
        }
      }
      return aCallback();
    };
    exports.ControleSaisieEvenement = ControleSaisieEvenement;
    function _avecSaisieEnCoursActive() {
      if (uSaisieEnCours) {
        if (
          uSaisieEnCours.instance &&
          MethodesObjet_1.MethodesObjet.isFunction(
            uSaisieEnCours.instance.isDestroyed,
          ) &&
          uSaisieEnCours.instance.isDestroyed()
        ) {
          uSaisieEnCours = null;
          return false;
        }
        return (
          MethodesObjet_1.MethodesObjet.isFunction(uSaisieEnCours.saisie) &&
          (!MethodesObjet_1.MethodesObjet.isFunction(uSaisieEnCours.actif) ||
            uSaisieEnCours.actif() === true)
        );
      }
      return false;
    }
    exports.ControleSaisieEvenement.saisieEnCours = (...aParams) => {
      if (window.GApplication && GApplication.getModeExclusif()) {
        uSaisieEnCours = null;
        uSaisieEnCoursExecution = false;
        return false;
      }
      if (_avecSaisieEnCoursActive()) {
        if (!uSaisieEnCoursExecution) {
          uSaisieEnCoursExecution = true;
          const lSaisieEnCours = uSaisieEnCours;
          uSaisieEnCours = null;
          Promise.resolve()
            .then(() => {
              return lSaisieEnCours.saisie(...aParams);
            })
            .catch((e) => {
              IE.log.addLog('erreur saisieEnCours ' + e);
            })
            .then(() => {
              uSaisieEnCoursExecution = false;
            });
        }
        return true;
      }
      return false;
    };
    exports.ControleSaisieEvenement.addSaisieEnCours = (aCallback) => {
      uSaisieEnCoursExecution = false;
      if (window.GApplication && GApplication.getModeExclusif()) {
        uSaisieEnCours = null;
        return;
      }
      const lSaisie = { actif: null, saisie: null, instance: null };
      if (MethodesObjet_1.MethodesObjet.isFunction(aCallback)) {
        lSaisie.saisie = aCallback;
      } else if (
        MethodesObjet_1.MethodesObjet.isObject(aCallback) &&
        MethodesObjet_1.MethodesObjet.isFunction(aCallback.saisie)
      ) {
        lSaisie.saisie = aCallback.saisie;
        lSaisie.actif = aCallback.actif;
        lSaisie.instance = aCallback.instance;
      }
      if (lSaisie.saisie) {
        uSaisieEnCours = lSaisie;
      } else {
        uSaisieEnCours = null;
      }
    };
  },
  fn: 'controlesaisieevenement.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeChampsJSON = void 0;
    const TypeChampsJSON = { type: '_T', valeur: 'V' };
    exports.TypeChampsJSON = TypeChampsJSON;
  },
  fn: 'enumere_champsjson.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreEtat = void 0;
    var EGenreEtat;
    (function (EGenreEtat) {
      EGenreEtat[(EGenreEtat['Aucun'] = 0)] = 'Aucun';
      EGenreEtat[(EGenreEtat['Creation'] = 1)] = 'Creation';
      EGenreEtat[(EGenreEtat['Modification'] = 2)] = 'Modification';
      EGenreEtat[(EGenreEtat['Suppression'] = 3)] = 'Suppression';
      EGenreEtat[(EGenreEtat['FilsModification'] = 4)] = 'FilsModification';
    })(EGenreEtat || (exports.EGenreEtat = EGenreEtat = {}));
  },
  fn: 'enumere_etat.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetElement = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_Etat_1 = require('Enumere_Etat');
    let _numeroCreation = -1000;
    class ObjetElement {
      constructor(aLibelle, aNumero, aGenre, aPosition, aActif) {
        this.Libelle = aLibelle;
        this.Numero = aNumero;
        this.Genre = aGenre;
        this.Position = aPosition;
        this.Actif = aActif === null || aActif === undefined ? true : aActif;
        this.Etat = Enumere_Etat_1.EGenreEtat.Aucun;
        if (
          arguments.length === 1 &&
          MethodesObjet_1.MethodesObjet.isObject(aLibelle)
        ) {
          this.Libelle = undefined;
          Object.assign(this, aLibelle);
        }
      }
      static create(aProps) {
        const lElement = new ObjetElement();
        if (aProps && MethodesObjet_1.MethodesObjet.isObject(aProps)) {
          Object.assign(lElement, aProps);
        }
        return lElement;
      }
      toJSON() {
        return this._toJSON(this);
      }
      toJSONAll() {
        const lJSON = this._toJSON(this);
        return this._propToJSONHorsFormat(this, lJSON);
      }
      fromJSON(aJSON) {
        if (!aJSON) {
          return this;
        }
        const lJSON = aJSON;
        this.Libelle = lJSON[ObjetElement.const_JSON.libelle.JSON] || '';
        this.Numero =
          lJSON[ObjetElement.const_JSON.numero.JSON] === '0'
            ? 0
            : lJSON[ObjetElement.const_JSON.numero.JSON];
        this.Genre = lJSON[ObjetElement.const_JSON.genre.JSON];
        this.Position = lJSON[ObjetElement.const_JSON.position.JSON];
        if (lJSON[ObjetElement.const_JSON.actif.JSON] !== undefined) {
          this.Actif = lJSON[ObjetElement.const_JSON.actif.JSON];
        }
        return this;
      }
      copieJSON(aJSON) {
        for (const lProp in aJSON) {
          if (
            lProp !== ObjetElement.const_JSON.libelle.JSON &&
            lProp !== ObjetElement.const_JSON.numero.JSON &&
            lProp !== ObjetElement.const_JSON.genre.JSON &&
            lProp !== ObjetElement.const_JSON.position.JSON
          ) {
            this[lProp] = aJSON[lProp];
          }
        }
        return this;
      }
      copieToJSON(aJSON) {
        return this._propToJSONHorsFormat(this, aJSON);
      }
      getLibelle() {
        return this.Libelle;
      }
      getNumero() {
        return this.Numero;
      }
      getGenre() {
        return this.Genre;
      }
      getActif() {
        return this.Actif;
      }
      getPosition() {
        return this.Position;
      }
      getEtat() {
        return this.Etat;
      }
      getDonnees() {
        return this.donnees;
      }
      getCleHash() {
        return `${this.Numero}_${this.Genre}`;
      }
      existeNumero() {
        const lNumero = this.getNumero();
        if (
          lNumero &&
          lNumero !== 0 &&
          MethodesObjet_1.MethodesObjet.isNumber(lNumero)
        ) {
          return true;
        }
        if (typeof lNumero === 'string' && lNumero.match) {
          return !!lNumero.match(
            new RegExp(`^${ObjetElement.regexNumeroExiste}$`),
          );
        }
        return false;
      }
      existe() {
        return this.getEtat() !== Enumere_Etat_1.EGenreEtat.Suppression;
      }
      pourValidation() {
        return this._validationSaisie || false;
      }
      setLibelle(aLibelle) {
        this.Libelle = aLibelle;
      }
      setNumero(aNumero) {
        this.Numero = aNumero;
      }
      setActif(aActif) {
        this.Actif = aActif;
      }
      setDonnees(aDonnees) {
        this.donnees = aDonnees;
      }
      getGenreTable() {
        const lNumero = this.getNumero();
        if (typeof lNumero === 'string') {
          const lIndex = lNumero.indexOf(
            ObjetElement.const_JSON.separateurTableNumero,
          );
          if (lIndex > 0) {
            const lGenreTable = parseInt(lNumero.substring(0, lIndex), 10);
            if (MethodesObjet_1.MethodesObjet.isNumber(lGenreTable)) {
              return lGenreTable;
            }
          }
        }
        return 0;
      }
      egalParNumeroEtGenre(aNumero, aGenre, aAvecExiste) {
        if (
          (aNumero === null || aNumero === undefined) &&
          (aGenre === null || aGenre === undefined)
        ) {
          return false;
        }
        return (
          (!aAvecExiste || this.existe()) &&
          (aNumero === null ||
            aNumero === undefined ||
            this.getNumero() === aNumero) &&
          (aGenre === null ||
            aGenre === undefined ||
            this.getGenre() === aGenre)
        );
      }
      getCle() {
        return '_' + this.Genre + '_' + this.Numero;
      }
      setEtat(AEtat) {
        if (this.Etat === AEtat) {
          return this;
        }
        switch (AEtat) {
          case Enumere_Etat_1.EGenreEtat.Aucun:
            delete this._validationSaisie;
            this.Etat = Enumere_Etat_1.EGenreEtat.Aucun;
            break;
          case Enumere_Etat_1.EGenreEtat.Creation:
            if (this.Etat === Enumere_Etat_1.EGenreEtat.Aucun) {
              this._validationSaisie = true;
              this.Etat = Enumere_Etat_1.EGenreEtat.Creation;
              if (this.Numero === null || this.Numero === undefined) {
                this.Numero = ObjetElement.getNumeroCreation();
              }
            }
            break;
          case Enumere_Etat_1.EGenreEtat.Modification:
            if (
              this.Etat === Enumere_Etat_1.EGenreEtat.Aucun ||
              this.Etat === Enumere_Etat_1.EGenreEtat.FilsModification
            ) {
              this._validationSaisie = true;
              this.Etat =
                this.Numero !== 0 &&
                this.Numero !== null &&
                this.Numero !== undefined
                  ? Enumere_Etat_1.EGenreEtat.Modification
                  : Enumere_Etat_1.EGenreEtat.Creation;
              if (this.Numero === null || this.Numero === undefined) {
                this.Numero = ObjetElement.getNumeroCreation();
              }
            }
            break;
          case Enumere_Etat_1.EGenreEtat.Suppression:
            if (this.Etat === Enumere_Etat_1.EGenreEtat.Creation) {
              delete this._validationSaisie;
            } else {
              this._validationSaisie = true;
            }
            this.Etat = Enumere_Etat_1.EGenreEtat.Suppression;
            break;
          case Enumere_Etat_1.EGenreEtat.FilsModification:
            if (this.Etat === Enumere_Etat_1.EGenreEtat.Aucun) {
              this._validationSaisie = true;
              this.Etat = Enumere_Etat_1.EGenreEtat.FilsModification;
            }
            break;
        }
        return this;
      }
      afficher() {}
      static getNumeroCreation() {
        _numeroCreation += -1;
        return _numeroCreation;
      }
      _toJSON(aElement) {
        const lNumero = aElement.getNumero(),
          lGenre = aElement.getGenre(),
          lLibelle = aElement.getLibelle();
        const lJSON = {};
        lJSON[ObjetElement.const_JSON.numero.JSON] = lNumero;
        if (lGenre !== undefined && lGenre !== null) {
          lJSON[ObjetElement.const_JSON.genre.JSON] = lGenre;
        }
        if (lLibelle) {
          lJSON[ObjetElement.const_JSON.libelle.JSON] = lLibelle;
        }
        if (aElement.Etat) {
          lJSON[ObjetElement.const_JSON.etat.JSON] = aElement.Etat;
        }
        return lJSON;
      }
      _propToJSONHorsFormat(aSource, aCible) {
        let lProp;
        const lCible = aCible || {};
        const lKeys = Object.keys(aSource);
        for (let i = 0; i < lKeys.length; i++) {
          lProp = lKeys[i];
          if (
            aSource[lProp] !== undefined &&
            !MethodesObjet_1.MethodesObjet.isFunction(aSource[lProp]) &&
            lProp !== ObjetElement.const_JSON.libelle.champ &&
            lProp !== ObjetElement.const_JSON.numero.champ &&
            lProp !== ObjetElement.const_JSON.genre.champ &&
            lProp !== ObjetElement.const_JSON.position.champ &&
            lProp !== ObjetElement.const_JSON.etat.champ
          ) {
            lCible[lProp] = aSource[lProp];
          }
        }
        return lCible;
      }
    }
    exports.ObjetElement = ObjetElement;
    ObjetElement.const_JSON = {
      numero: { JSON: 'N', champ: 'Numero' },
      libelle: { JSON: 'L', champ: 'Libelle' },
      genre: { JSON: 'G', champ: 'Genre' },
      position: { JSON: 'P', champ: 'Position' },
      etat: { JSON: 'E', champ: 'Etat' },
      actif: { JSON: 'A', champ: 'Actif' },
      separateurTableNumero: '#',
    };
    ObjetElement.regexNumeroExiste = `[0-9]{1,3}${ObjetElement.const_JSON.separateurTableNumero}[a-zA-Z0-9\\-_]{43}`;
    ObjetElement.regexCaptureNumero = `(0|${ObjetElement.regexNumeroExiste})`;
  },
  fn: 'objetelement.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.MethodesTableau = MethodesTableau;
    require('DeclarationExtensionsObjetNatif');
    function MethodesTableau() {}
    MethodesTableau.intersection = function (aTableau1, aTableau2) {
      if (aTableau1 && aTableau1.filter) {
        return aTableau1.filter((aElement) => {
          return aTableau2.indexOf(aElement) !== -1;
        });
      }
      let lResult = [];
      for (let i = 0; i < aTableau1.length; i++) {
        if (aTableau2.includes(aTableau1[i])) {
          lResult.push(aTableau1[i]);
        }
      }
      return lResult;
    };
    MethodesTableau.existeIntersection = function (aTableau1, aTableau2) {
      return MethodesTableau.intersection(aTableau1, aTableau2).length > 0;
    };
    function _everyInclus(aTableauCompare, aElement) {
      return aTableauCompare.indexOf(aElement) !== -1;
    }
    MethodesTableau.inclus = function (aTableau1, aTableau2) {
      if (!Array.isArray(aTableau1) || !Array.isArray(aTableau2)) {
        return false;
      }
      if (aTableau1.every) {
        return !!aTableau1.every(_everyInclus.bind(this, aTableau2));
      }
      for (let I = 0; I < aTableau1.length; I++) {
        if (!_everyInclus(aTableau2, aTableau1[I])) {
          return false;
        }
      }
      return true;
    };
    MethodesTableau.insererElement = function (aValeur, aTableau, aIndex) {
      if (!Array.isArray(aTableau)) {
        return false;
      }
      if (aIndex >= 0) {
        const T = aTableau.slice(aIndex);
        aTableau.length = aIndex;
        aTableau.push(aValeur);
        Array.prototype.push.apply(aTableau, T);
      } else {
        aTableau.push(aValeur);
      }
    };
    MethodesTableau.supprimerElement = function (aTableau, aIndex) {
      aTableau.splice(aIndex, 1);
    };
    MethodesTableau.remove = function (aTableau, aElement) {
      let lIndex = aTableau.indexOf(aElement);
      let lResult = false;
      while (lIndex >= 0) {
        aTableau.splice(lIndex, 1);
        lResult = true;
        lIndex = aTableau.indexOf(aElement);
      }
      return lResult;
    };
    MethodesTableau.nombreElements = function (aTableau) {
      let lNombre = 0;
      for (let i = 0; i < aTableau.length; i++) {
        let lElement = aTableau[i];
        if (lElement !== null || lElement !== undefined) {
          lNombre++;
        }
      }
      return lNombre;
    };
    MethodesTableau.binaryIndexOf = function (aArray, aIndex) {
      if (!Array.isArray(aArray)) {
        return -1;
      }
      let lMinIndex = 0;
      let lMaxIndex = aArray.length - 1;
      let lIndexCourant;
      let lElementCourant;
      while (lMinIndex <= lMaxIndex) {
        lIndexCourant = ((lMinIndex + lMaxIndex) / 2) | 0;
        lElementCourant = aArray[lIndexCourant];
        if (lElementCourant < aIndex) {
          lMinIndex = lIndexCourant + 1;
        } else if (lElementCourant > aIndex) {
          lMaxIndex = lIndexCourant - 1;
        } else {
          return lIndexCourant;
        }
      }
      return -1;
    };
    MethodesTableau.indexOfMask = function (aArray, aMask) {
      let lIndice = -1;
      if (!Array.isArray(aArray)) {
        return lIndice;
      }
      if (!aMask || aArray.length === 0) {
        return lIndice;
      }
      try {
        const lKeys = Object.keys(aMask);
        if (lKeys.length > 0) {
          aArray.every((aElement, aIndice) => {
            let lTrouve = true;
            lKeys.every((aKey) => {
              if (
                aElement &&
                aKey in aMask &&
                aKey in aElement &&
                aMask[aKey] === aElement[aKey]
              ) {
                return true;
              }
              lTrouve = false;
              return false;
            });
            if (lTrouve) {
              lIndice = aIndice;
            }
            return lIndice < 0;
          });
        }
      } catch (e) {
        lIndice = -1;
      }
      return lIndice;
    };
  },
  fn: 'methodestableau.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreTriElement = void 0;
    var EGenreTriElement;
    (function (EGenreTriElement) {
      EGenreTriElement[(EGenreTriElement['Croissant'] = 1)] = 'Croissant';
      EGenreTriElement[(EGenreTriElement['Decroissant'] = -1)] = 'Decroissant';
    })(EGenreTriElement || (exports.EGenreTriElement = EGenreTriElement = {}));
  },
  fn: 'enumere_trielement.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ComparateurChaines = void 0;
    let uSupportLocaleCompare = false,
      uSupportCollator = !!(window.Intl && window.Intl.Collator),
      uLocales,
      uCollator = uSupportCollator
        ? new window.Intl.Collator(uLocales, { sensitivity: 'accent' })
        : null,
      uCollatorCaseSensitive = uSupportCollator
        ? new window.Intl.Collator(uLocales, { sensitivity: 'variant' })
        : null,
      uCollator_NonCaseSensitive_IgnoreAccent = uSupportCollator
        ? new window.Intl.Collator(uLocales, { sensitivity: 'base' })
        : null,
      uCollator_CaseSensitive_IgnoreAccent = uSupportCollator
        ? new window.Intl.Collator(uLocales, { sensitivity: 'case' })
        : null;
    const ComparateurChaines = {
      egal(aStrA, aStrB, aOptions) {
        return ComparateurChaines.compare(aStrA, aStrB, aOptions) === 0;
      },
      compare(aStrA, aStrB, aOptions) {
        const lOptions = Object.assign(
          {
            caseSensitive: false,
            accentSensitive: false,
            avecTrim: false,
            unifierEspacements: false,
            unifierCarWord: false,
          },
          aOptions,
        );
        const lResult = ComparateurChaines.compareChamps(
          ComparateurChaines.getValeurPourTri(aStrA, lOptions),
          ComparateurChaines.getValeurPourTri(aStrB, lOptions),
          lOptions,
        );
        return lResult === false ? 0 : lResult;
      },
      normalize(aChaine) {
        if (typeof aChaine !== 'string') {
          return '';
        }
        if (aChaine && aChaine.normalize) {
          return aChaine.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }
        return ComparateurChaines.latinize(aChaine);
      },
      latinize(aChaine) {
        return aChaine && aChaine.replace
          ? aChaine.replace(
              new RegExp('[' + _latinize() + ']', 'gi'),
              _latinize,
            )
          : '';
      },
      getValeurPourTri(aChamp, aOptions) {
        let lResult = aChamp;
        if (!lResult) {
          return lResult;
        }
        if (lResult.getTime) {
          return lResult.getTime();
        }
        if (lResult.enleverEntites) {
          lResult = lResult.enleverEntites();
          if (
            !uSupportLocaleCompare &&
            !uSupportCollator &&
            !aOptions.accentSensitive
          ) {
            lResult = ComparateurChaines.normalize(lResult);
          }
          if (aOptions.avecTrim) {
            lResult = lResult.trim();
          }
          if (aOptions.unifierEspacements) {
            lResult = lResult.replace(/\s+/gi, ' ');
          }
          if (aOptions.unifierCarWord) {
            lResult = lResult.replace(/’/g, "'").replace(/«|»/g, '"');
          }
        }
        if (
          !aOptions.caseSensitive &&
          !uSupportCollator &&
          !uSupportLocaleCompare &&
          lResult &&
          lResult.toLowerCase
        ) {
          lResult = lResult.toLowerCase();
        }
        return lResult;
      },
      compareChamps: function (aChampA, aChampB, aOptions) {
        const lChampAString = aChampA && aChampA.localeCompare;
        const lChampBString = aChampB && aChampB.localeCompare;
        if (
          (uSupportLocaleCompare || uSupportCollator) &&
          lChampAString &&
          lChampBString
        ) {
          let lResult = 0;
          if (uSupportCollator) {
            const lCollator = aOptions.caseSensitive
              ? aOptions.accentSensitive
                ? uCollatorCaseSensitive
                : uCollator_CaseSensitive_IgnoreAccent
              : aOptions.accentSensitive
                ? uCollator
                : uCollator_NonCaseSensitive_IgnoreAccent;
            if (lCollator) {
              lResult = lCollator.compare(aChampA, aChampB);
            }
          } else {
            lResult = aChampA.localeCompare(aChampB, 'fr', {
              sensitivity: aOptions.caseSensitive
                ? aOptions.accentSensitive
                  ? 'variant'
                  : 'case'
                : aOptions.accentSensitive
                  ? 'accent'
                  : 'base',
            });
          }
          if (lResult < 0) {
            return -1;
          }
          if (lResult > 0) {
            return 1;
          }
          return false;
        }
        const lChampANull = aChampA === undefined || aChampA === null,
          lChampBNull = aChampB === undefined || aChampB === null;
        if (lChampANull && lChampBNull) {
          return false;
        }
        if (lChampAString && aChampB === ComparateurChaines.MAX_STRING) {
          return -1;
        }
        if (lChampBString && aChampA === ComparateurChaines.MAX_STRING) {
          return 1;
        }
        if (aChampA > aChampB || lChampBNull) {
          return 1;
        }
        if (aChampA < aChampB || lChampANull) {
          return -1;
        }
        return false;
      },
      MAX_STRING: { MAX_STRING: true },
    };
    exports.ComparateurChaines = ComparateurChaines;
    try {
      if (''.localeCompare) {
        uSupportLocaleCompare =
          'e'.localeCompare('é', 'fr', { sensitivity: 'base' }) === 0;
      }
    } catch (e) {
      uSupportLocaleCompare = false;
    }
    let uCache_regexLatinize = null;
    function _latinize(aMatch) {
      let x;
      const lTranslate = {
        á: 'a',
        à: 'a',
        â: 'a',
        ä: 'a',
        ã: 'a',
        ç: 'c',
        é: 'e',
        è: 'e',
        ê: 'e',
        ë: 'e',
        í: 'i',
        ì: 'i',
        î: 'i',
        ï: 'i',
        ñ: 'n',
        ó: 'o',
        ò: 'o',
        ô: 'o',
        ö: 'o',
        õ: 'o',
        ő: 'o',
        ß: 'ss',
        š: 'szz',
        ú: 'u',
        ù: 'u',
        û: 'u',
        ü: 'u',
        ű: 'u',
        ý: 'y',
        ÿ: 'y',
        æ: 'ae',
        œ: 'oe',
      };
      if (!aMatch) {
        if (!uCache_regexLatinize) {
          const lRegex = [];
          for (x in lTranslate) {
            lRegex.push(x);
          }
          uCache_regexLatinize = lRegex.join('');
        }
        return uCache_regexLatinize;
      }
      const lMatchLower = aMatch.toLowerCase();
      const lIsUpperCase = lMatchLower !== aMatch;
      return lIsUpperCase
        ? lTranslate[lMatchLower].ucfirst()
        : lTranslate[lMatchLower];
    }
  },
  fn: 'comparateurchaines.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetTri = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    const ComparateurChaines_1 = require('ComparateurChaines');
    class ObjetTri {
      static init(aNomChamp, aGenreTri, aCaseSensitive, aIgnorerAccents) {
        return {
          estFonction: MethodesObjet_1.MethodesObjet.isFunction(aNomChamp),
          estAccesseurChaine:
            typeof aNomChamp === 'string' && aNomChamp.indexOf('.') >= 0,
          nomChamp: aNomChamp,
          ordreTri:
            aGenreTri === Enumere_TriElement_1.EGenreTriElement.Decroissant
              ? aGenreTri
              : Enumere_TriElement_1.EGenreTriElement.Croissant,
          caseSensitive: aCaseSensitive === true,
          accentSensitive: aIgnorerAccents !== true,
        };
      }
      static initRecursif(aNomChampPere, aTris) {
        const lTris = aTris;
        return {
          triRecursif: true,
          nomChampPere: aNomChampPere,
          tris: lTris,
          ordreTri: Enumere_TriElement_1.EGenreTriElement.Croissant,
        };
      }
      static trierTableau(aTableau, aTris) {
        if (!aTableau || !aTableau.sort || !aTris || aTableau.length < 2) {
          return;
        }
        const lLength = aTableau.length;
        const lTableau = new Array(lLength);
        let lValeur;
        for (let i = 0; i < lLength; i++) {
          lValeur = aTableau[i];
          if (lValeur !== undefined || lValeur !== null) {
            lTableau[i] = { contenu: lValeur, cache: [], ordre: i };
          } else {
            lTableau[i] = lValeur;
          }
        }
        lTableau.sort((a, b) => {
          return ObjetTri._comparer(aTris, a, b);
        });
        for (let i = 0; i < lLength; i++) {
          lValeur = lTableau[i];
          if (lValeur !== undefined || lValeur !== null) {
            aTableau[i] = lValeur.contenu;
          } else {
            aTableau[i] = lValeur;
          }
        }
      }
      static _construirePilePere(aValeur, aNomChampePere, aPile) {
        let lObjet = aValeur;
        while (
          lObjet &&
          lObjet[aNomChampePere] &&
          MethodesObjet_1.MethodesObjet.isObject(lObjet[aNomChampePere]) &&
          !aPile.includes(lObjet[aNomChampePere])
        ) {
          lObjet = lObjet[aNomChampePere];
          aPile.push(lObjet);
        }
      }
      static _comparerTriRecursif(A, B, aTri) {
        let lPileParentA = [A.contenu],
          lPileParentB = [B.contenu],
          i,
          lResult,
          j,
          lNb,
          lTri,
          lCount,
          lA,
          lB;
        if (!aTri.tris) {
          return false;
        }
        ObjetTri._construirePilePere(
          A.contenu,
          aTri.nomChampPere,
          lPileParentA,
        );
        ObjetTri._construirePilePere(
          B.contenu,
          aTri.nomChampPere,
          lPileParentB,
        );
        lPileParentA.reverse();
        lPileParentB.reverse();
        lCount = Math.max(lPileParentA.length, lPileParentB.length);
        for (i = 0; i < lCount; i++) {
          lA = lPileParentA[i];
          lB = lPileParentB[i];
          if ((!lA && lB) || (!lA && !lB)) {
            return -aTri.ordreTri;
          } else if (lA && !lB) {
            return aTri.ordreTri;
          } else if (lA === lB) {
            continue;
          }
          for (j = 0, lNb = aTri.tris.length; j < lNb; j++) {
            lTri = aTri.tris[j];
            lResult = ObjetTri._comparerTri(lA, lB, lTri, -1, false, i);
            if (lResult !== false) {
              return lResult;
            }
          }
        }
        return false;
      }
      static _getValeurPourTri(aTri, aElement, aProfondeur) {
        let lResult;
        if (aTri.estFonction) {
          lResult = aTri.nomChamp(aElement, aProfondeur);
        } else if (aTri.estAccesseurChaine) {
          lResult = MethodesObjet_1.MethodesObjet.get(aElement, aTri.nomChamp);
        } else {
          if (!aElement) {
            return aElement;
          }
          lResult = aElement[aTri.nomChamp];
        }
        return ComparateurChaines_1.ComparateurChaines.getValeurPourTri(
          lResult,
          {
            caseSensitive: aTri.caseSensitive,
            accentSensitive: aTri.accentSensitive,
          },
        );
      }
      static _comparerTri(A, B, aTri, aIndiceTri, aAvecCacheTri, aProfondeur) {
        let lChampTriA;
        let lChampTriB;
        if (aAvecCacheTri) {
          if (!A.cache[aIndiceTri]) {
            lChampTriA = ObjetTri._getValeurPourTri(
              aTri,
              A.contenu,
              aProfondeur,
            );
            A.cache[aIndiceTri] = { valeur: lChampTriA };
          } else {
            lChampTriA = A.cache[aIndiceTri].valeur;
          }
          if (!B.cache[aIndiceTri]) {
            lChampTriB = ObjetTri._getValeurPourTri(
              aTri,
              B.contenu,
              aProfondeur,
            );
            B.cache[aIndiceTri] = { valeur: lChampTriB };
          } else {
            lChampTriB = B.cache[aIndiceTri].valeur;
          }
        } else {
          lChampTriA = ObjetTri._getValeurPourTri(aTri, A, aProfondeur);
          lChampTriB = ObjetTri._getValeurPourTri(aTri, B, aProfondeur);
        }
        if (
          lChampTriA === lChampTriB ||
          (lChampTriA === undefined && lChampTriB === null) ||
          (lChampTriB === undefined && lChampTriA === null)
        ) {
          return false;
        }
        const lResult = ComparateurChaines_1.ComparateurChaines.compareChamps(
          lChampTriA,
          lChampTriB,
          {
            caseSensitive: aTri.caseSensitive,
            accentSensitive: aTri.accentSensitive,
          },
        );
        if (lResult === false) {
          return false;
        }
        return lResult * aTri.ordreTri;
      }
      static _comparer(aTris, A, B) {
        let i, lNb, lTri, lResult;
        for (i = 0, lNb = aTris.length; i < lNb; i++) {
          lTri = aTris[i];
          if (!lTri) {
            return 0;
          }
          if (lTri.triRecursif) {
            lResult = ObjetTri._comparerTriRecursif(A, B, lTri);
          } else {
            lResult = ObjetTri._comparerTri(A, B, lTri, i, true, 0);
          }
          if (lResult !== false) {
            return lResult;
          }
        }
        return A.ordre - B.ordre;
      }
    }
    exports.ObjetTri = ObjetTri;
    ObjetTri.genreTri = Enumere_TriElement_1.EGenreTriElement;
  },
  fn: 'objettri.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetListeElements = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const MethodesTableau_1 = require('MethodesTableau');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    const ObjetTri_1 = require('ObjetTri');
    const ObjetElement_1 = require('ObjetElement');
    const ComparateurChaines_1 = require('ComparateurChaines');
    class ObjetListeElements {
      constructor() {
        this.ListeElements = [];
        this._tris = null;
        this.serialisateurJSON = null;
        this.vider();
      }
      add(aElement) {
        if (aElement) {
          if (aElement instanceof ObjetElement_1.ObjetElement) {
            this.ListeElements.push(aElement);
            return this;
          }
          if (aElement instanceof ObjetListeElements) {
            aElement.parcourir((a) => {
              this.add(a);
            });
            return this;
          }
          if (Array.isArray(aElement)) {
            aElement.forEach((a) => {
              this.add(a);
            });
            return this;
          }
        }
        if (IE.log) {
          IE.log.addLog(
            'ObjetListeElements.add : aElement incorrect => ' + aElement,
          );
        }
        return this;
      }
      get(aIndex) {
        return this.ListeElements[aIndex];
      }
      remove(aIndice) {
        if (aIndice >= 0 && MethodesObjet_1.MethodesObjet.isNumber(aIndice)) {
          MethodesTableau_1.MethodesTableau.supprimerElement(
            this.ListeElements,
            aIndice,
          );
        }
        return this;
      }
      pop() {
        return this.ListeElements.pop();
      }
      count() {
        return this.ListeElements.length;
      }
      vider() {
        this.ListeElements = [];
        return this;
      }
      addElement(AElement, I) {
        if (I === null || I === undefined) {
          this.ListeElements.push(AElement);
        } else {
          this.ListeElements[I] = AElement;
        }
        return this;
      }
      insererElement(AElement, I) {
        MethodesTableau_1.MethodesTableau.insererElement(
          AElement,
          this.ListeElements,
          I,
        );
        return this;
      }
      getNbrElementsExistes(aGenre) {
        let N = 0;
        this.ListeElements.forEach((aElement) => {
          if (
            aElement.existe() &&
            (aGenre === null ||
              aGenre === undefined ||
              aElement.getGenre() === aGenre)
          ) {
            N++;
          }
        });
        return N;
      }
      getTabListeElements() {
        return this.ListeElements;
      }
      parcourir(aFunction, aThis) {
        if (
          !aFunction ||
          !MethodesObjet_1.MethodesObjet.isFunction(aFunction)
        ) {
          return this;
        }
        this.ListeElements.every((aElement, aIndex) => {
          return aFunction.call(aThis, aElement, aIndex, this) !== false;
        });
        return this;
      }
      getTableau(aFunction) {
        const T = [];
        if (
          !aFunction ||
          !MethodesObjet_1.MethodesObjet.isFunction(aFunction)
        ) {
          return T;
        }
        this.ListeElements.forEach((aElement, aIndex) => {
          T.push(aFunction(aElement, aIndex));
        });
        return T;
      }
      removeFilter(aFilter) {
        if (aFilter && MethodesObjet_1.MethodesObjet.isFunction(aFilter)) {
          const lTab = [];
          this.ListeElements.forEach((aElement, aIndex) => {
            if (aFilter(aElement, aIndex) !== true) {
              lTab.push(aElement);
            }
          });
          this.ListeElements = lTab;
        }
        return this;
      }
      getTableauLibelles(aGenre, aTrier, aAvecExiste) {
        const T = [];
        if (aTrier) {
          this.trier();
        }
        for (let I = 0; I < this.ListeElements.length; I++) {
          if (
            aGenre === null ||
            aGenre === undefined ||
            (MethodesObjet_1.MethodesObjet.isNumeric(aGenre) &&
              aGenre === this.getGenre(I)) ||
            (Array.isArray(aGenre) && aGenre.includes(this.getGenre(I)))
          ) {
            if (!aAvecExiste || this.existe(I)) {
              T.push(this.getLibelle(I) || '');
            }
          }
        }
        return T;
      }
      getTableauNumeros(aAvecExiste) {
        const T = [];
        for (let I = 0; I < this.ListeElements.length; I++) {
          if (!aAvecExiste || this.existe(I)) {
            T.push(this.getNumero(I));
          }
        }
        return T;
      }
      getTableauGenres() {
        const T = [];
        for (let I = 0; I < this.ListeElements.length; I++) {
          T.push(this.getGenre(I));
        }
        return T;
      }
      getCle() {
        return this.getTableauNumeros().sort().join('_');
      }
      getListeElements(aFiltre) {
        const lListe = new ObjetListeElements();
        for (let I = 0; I < this.ListeElements.length; I++) {
          if (!aFiltre || aFiltre(this.ListeElements[I], I)) {
            lListe.addElement(this.ListeElements[I]);
          }
        }
        return lListe;
      }
      getElementParFiltre(aFiltre) {
        return this.get(this.getIndiceElementParFiltre(aFiltre));
      }
      getIndiceElementParFiltre(aFiltre) {
        let lResult = -1;
        for (let I = 0; I < this.ListeElements.length && lResult < 0; I++) {
          if (!aFiltre || aFiltre(this.ListeElements[I])) {
            lResult = I;
          }
        }
        return lResult;
      }
      getElementParNumero(ANumero) {
        for (let I = 0, lNb = this.count(); I < lNb; I++) {
          if (this.existe(I) && this.getNumero(I) === ANumero) {
            return this.get(I);
          }
        }
      }
      getListeElementsParNumero(aNumero) {
        const lListe = new ObjetListeElements();
        this.parcourir((aElement) => {
          if (
            aElement &&
            aElement.existe() &&
            aElement.getNumero() === aNumero
          ) {
            lListe.addElement(aElement);
          }
        });
        return lListe;
      }
      getElementParGenre(aGenre) {
        for (let I = 0, lNb = this.count(); I < lNb; I++) {
          if (this.existe(I) && this.getGenre(I) === aGenre) {
            return this.get(I);
          }
        }
      }
      getNumero(I) {
        return this.ListeElements[I].Numero;
      }
      getGenre(I) {
        return this.ListeElements[I].Genre;
      }
      getLibelle(I) {
        return this.ListeElements[I].Libelle;
      }
      getActif(I) {
        return this.ListeElements[I].Actif;
      }
      getPosition(I) {
        return this.ListeElements[I].Position;
      }
      existeNumero(I) {
        const N = this.getNumero(I);
        return !!(N && N !== '0');
      }
      existe(I) {
        return this.ListeElements[I].existe();
      }
      pourValidation(I) {
        return this.ListeElements[I].pourValidation();
      }
      setLibelle(I, ALibelle) {
        this.ListeElements[I].Libelle = ALibelle;
      }
      trierPourValidation() {
        ObjetTri_1.ObjetTri.trierTableau(this.ListeElements, [
          ObjetTri_1.ObjetTri.init('Etat'),
        ]);
      }
      existeElementPourValidation() {
        for (let I = 0, lNb = this.count(); I < lNb; I++) {
          if (this.pourValidation(I)) {
            return true;
          }
        }
        return false;
      }
      setTri(aTableauTris) {
        this._tris = aTableauTris;
        return this;
      }
      getTri() {
        return this._tris;
      }
      trier(aGenreTri) {
        if (this.ListeElements) {
          const lGenreTri =
            aGenreTri === Enumere_TriElement_1.EGenreTriElement.Decroissant
              ? aGenreTri
              : Enumere_TriElement_1.EGenreTriElement.Croissant;
          if (!this._tris) {
            this.setTri([
              ObjetTri_1.ObjetTri.init('Position'),
              ObjetTri_1.ObjetTri.init('Libelle'),
            ]);
          }
          const lTris = this._tris !== null ? [].concat(this._tris) : [];
          lTris.unshift(
            ObjetTri_1.ObjetTri.init((aElement) => {
              return (
                aElement.Visible === false ||
                aElement.getEtat() === Enumere_Etat_1.EGenreEtat.Suppression
              );
            }, lGenreTri),
          );
          ObjetTri_1.ObjetTri.trierTableau(this.ListeElements, lTris);
          if (lGenreTri === Enumere_TriElement_1.EGenreTriElement.Decroissant) {
            this.ListeElements.reverse();
          }
        }
        return this;
      }
      getIndiceParNumeroEtGenre(ANumero, AGenre, aAvecExiste) {
        if (
          this.ListeElements &&
          ((ANumero !== null && ANumero !== undefined) ||
            (AGenre !== null && AGenre !== undefined))
        ) {
          const N = this.count();
          for (let I = 0; I < N; I++) {
            const lElement = this.ListeElements[I];
            if (
              lElement &&
              lElement.egalParNumeroEtGenre(ANumero, AGenre, aAvecExiste)
            ) {
              return I;
            }
          }
        }
      }
      getIndiceExisteParNumeroEtGenre(ANumero, AGenre) {
        if (
          this.ListeElements &&
          ((ANumero !== null && ANumero !== undefined) ||
            (AGenre !== null && AGenre !== undefined))
        ) {
          const N = this.count();
          let J = -1;
          for (let I = 0; I < N; I++) {
            if (this.existe(I)) {
              J++;
              if (
                (ANumero === null ||
                  ANumero === undefined ||
                  this.getNumero(I) === ANumero) &&
                (AGenre === null ||
                  AGenre === undefined ||
                  this.getGenre(I) === AGenre)
              ) {
                return J;
              }
            }
          }
        }
      }
      getElementParNumeroEtGenre(ANumero, AGenre, aAvecExiste) {
        const lIndice = this.getIndiceParNumeroEtGenre(
          ANumero,
          AGenre,
          aAvecExiste,
        );
        if (lIndice !== undefined) {
          return this.get(lIndice);
        }
      }
      getIndiceParElement(aElement, aAvecExiste) {
        return aElement
          ? this.getIndiceParNumeroEtGenre(
              aElement.getNumero(),
              aElement.getGenre(),
              aAvecExiste,
            )
          : null;
      }
      getIndiceExisteParElement(aElement) {
        return this.getIndiceExisteParNumeroEtGenre(
          aElement.getNumero(),
          aElement.getGenre(),
        );
      }
      getElementParElement(aElement, aAvecExiste) {
        const lIndice = this.getIndiceParElement(aElement, aAvecExiste);
        if (lIndice !== undefined && lIndice !== null) {
          return this.get(lIndice);
        }
      }
      getIndiceParLibelle(ALibelle) {
        if (this.ListeElements) {
          const N = this.count();
          for (let I = 0; I < N; I++) {
            if (this.getLibelle(I) === ALibelle) {
              return I;
            }
          }
        }
      }
      getIndiceParParsingLibelle(aLibelle) {
        if (!this.ListeElements) {
          return -1;
        }
        if (
          !aLibelle ||
          aLibelle.length === 0 ||
          !MethodesObjet_1.MethodesObjet.isString(aLibelle)
        ) {
          return 0;
        }
        const N = this.count();
        let lIndice = 0;
        for (let I = 0; I < N; I++) {
          const lLibelle = this.getLibelle(I);
          if (
            ComparateurChaines_1.ComparateurChaines.compare(
              lLibelle,
              aLibelle,
            ) < 0
          ) {
            lIndice++;
          } else {
            break;
          }
        }
        return lIndice >= N ? lIndice - 1 : lIndice;
      }
      getElementParLibelle(ALibelle) {
        const lIndice = this.getIndiceParLibelle(ALibelle);
        if (lIndice !== undefined) {
          return this.get(lIndice);
        }
        return undefined;
      }
      getPremierElement() {
        let lResult;
        for (let i = 0, lNb = this.count(); i < lNb && !lResult; i++) {
          if (this.existe(i)) {
            lResult = this.get(i);
          }
        }
        return lResult;
      }
      getDernierElement() {
        return this.get(this.count() - 1);
      }
      listeIdentiqueParElementsOrdonnes(aListeElements) {
        if (!aListeElements || !aListeElements.count) {
          return false;
        }
        if (this === aListeElements) {
          return true;
        }
        if (this.count() !== aListeElements.count()) {
          return false;
        }
        let lResult = true;
        this.parcourir((aElement, aIndice) => {
          const lElement = aListeElements.get(aIndice);
          if (
            lElement &&
            aElement &&
            lElement.egalParNumeroEtGenre(
              aElement.getNumero(),
              aElement.getGenre(),
            )
          ) {
            return;
          }
          lResult = false;
          return false;
        });
        return lResult;
      }
      setSerialisateurJSON(aSerialisateur) {
        if (!this.serialisateurJSON) {
          this.serialisateurJSON = {
            ignorerEtatsElements: false,
            methodeSerialisation: undefined,
            nePasTrierPourValidation: false,
            avecLibelle: true,
          };
        }
        Object.assign(this.serialisateurJSON, aSerialisateur);
        return this;
      }
      toJSON() {
        let I,
          lNb,
          lAvecSerialisation = !!(
            this.serialisateurJSON &&
            this.serialisateurJSON.methodeSerialisation
          ),
          lResult = [],
          lListe = new ObjetListeElements();
        lListe.add(this);
        if (
          !this.serialisateurJSON ||
          !this.serialisateurJSON.nePasTrierPourValidation
        ) {
          lListe.trierPourValidation();
        }
        for (I = 0, lNb = lListe.count(); I < lNb; I++) {
          const lElement = lListe.get(I);
          if (lElement) {
            let lExisteElement =
              (this.serialisateurJSON &&
                this.serialisateurJSON.ignorerEtatsElements) ||
              lElement.pourValidation();
            let lJSONElement = null;
            if (lExisteElement || lAvecSerialisation) {
              lJSONElement = lElement.toJSON();
              if (
                this.serialisateurJSON &&
                !this.serialisateurJSON.avecLibelle
              ) {
                delete lJSONElement[
                  ObjetElement_1.ObjetElement.const_JSON.libelle.JSON
                ];
              }
              if (
                lAvecSerialisation &&
                this.serialisateurJSON &&
                typeof this.serialisateurJSON.methodeSerialisation ===
                  'function'
              ) {
                const lGarderElement =
                  this.serialisateurJSON.methodeSerialisation(
                    lElement,
                    lJSONElement,
                    I,
                  );
                lExisteElement =
                  lGarderElement === null || lGarderElement === undefined
                    ? lExisteElement
                    : lGarderElement;
              }
            }
            if (lExisteElement && lJSONElement) {
              lResult.push(lJSONElement);
            }
          }
        }
        return lResult;
      }
      fromJSON(aJSON, aMethodeDeserialisation, aTrier) {
        if (!aJSON || !MethodesObjet_1.MethodesObjet.isArray(aJSON)) {
          return this;
        }
        for (let i = 0, lNb = aJSON.length; i < lNb; i++) {
          const lElement = new ObjetElement_1.ObjetElement().fromJSON(aJSON[i]);
          if (
            !aMethodeDeserialisation ||
            aMethodeDeserialisation(aJSON[i], lElement, i) !== false
          ) {
            this.addElement(lElement);
          }
        }
        if (aTrier) {
          this.trier();
        }
        return this;
      }
      [Symbol.iterator]() {
        let lIndex = 0;
        return {
          next: () => {
            lIndex += 1;
            const lDone = lIndex > this.ListeElements.length;
            return {
              done: lDone,
              value: lDone ? undefined : this.ListeElements[lIndex - 1],
            };
          },
        };
      }
    }
    exports.ObjetListeElements = ObjetListeElements;
  },
  fn: 'objetlisteelements.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeHttpVariable = void 0;
    var TypeHttpVariable;
    (function (TypeHttpVariable) {
      TypeHttpVariable[(TypeHttpVariable['TypeHttpCategorie'] = 0)] =
        'TypeHttpCategorie';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpCardinal'] = 1)] =
        'TypeHttpCardinal';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpBoolean'] = 2)] =
        'TypeHttpBoolean';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpString'] = 3)] =
        'TypeHttpString';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpColor'] = 4)] =
        'TypeHttpColor';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpAlignment_Inutilise'] = 5)] =
        'TypeHttpAlignment_Inutilise';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpFontStyles_Inutilise'] = 6)] =
        'TypeHttpFontStyles_Inutilise';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpDateTime'] = 7)] =
        'TypeHttpDateTime';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpDomaine'] = 8)] =
        'TypeHttpDomaine';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpTraduction'] = 9)] =
        'TypeHttpTraduction';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpNote'] = 10)] =
        'TypeHttpNote';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpEnsembleCardinal'] = 11)] =
        'TypeHttpEnsembleCardinal';
      TypeHttpVariable[(TypeHttpVariable['_TypeHttpLongNote_Inutilise'] = 12)] =
        '_TypeHttpLongNote_Inutilise';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpDouble'] = 13)] =
        'TypeHttpDouble';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpArrondi'] = 14)] =
        'TypeHttpArrondi';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpEnsemble'] = 15)] =
        'TypeHttpEnsemble';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpIP'] = 16)] = 'TypeHttpIP';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpUrl'] = 17)] = 'TypeHttpUrl';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpSetOf_MrFiche'] = 18)] =
        'TypeHttpSetOf_MrFiche';
      TypeHttpVariable[
        (TypeHttpVariable['_TypeHttpDoubleNote_Inutilise'] = 19)
      ] = '_TypeHttpDoubleNote_Inutilise';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpInteger'] = 20)] =
        'TypeHttpInteger';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpHtml'] = 21)] =
        'TypeHttpHtml';
      TypeHttpVariable[(TypeHttpVariable['_TypeHttpJSON_Inutilise'] = 22)] =
        '_TypeHttpJSON_Inutilise';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpChaineBrute'] = 23)] =
        'TypeHttpChaineBrute';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpElement'] = 24)] =
        'TypeHttpElement';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpFichierBase64'] = 25)] =
        'TypeHttpFichierBase64';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpEnsembleNombre'] = 26)] =
        'TypeHttpEnsembleNombre';
      TypeHttpVariable[(TypeHttpVariable['TypeHttpHtmlSafe'] = 27)] =
        'TypeHttpHtmlSafe';
    })(TypeHttpVariable || (exports.TypeHttpVariable = TypeHttpVariable = {}));
  },
  fn: 'typehttpvariable.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeDomaine = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_ChampsJSON_1 = require('Enumere_ChampsJSON');
    const ObjetElement_1 = require('ObjetElement');
    const TypeHttpVariable_1 = require('TypeHttpVariable');
    const ObjetListeElements_1 = require('ObjetListeElements');
    var ValeurSemaine;
    (function (ValeurSemaine) {
      ValeurSemaine['plein'] = '1';
      ValeurSemaine['vide'] = '0';
    })(ValeurSemaine || (ValeurSemaine = {}));
    class TypeDomaine {
      constructor(AValeurParDefaut, ANombreValeurs) {
        this.nombreValeurs = ANombreValeurs
          ? ANombreValeurs
          : TypeDomaine.C_MaxDomaineCycle;
        AValeurParDefaut =
          AValeurParDefaut === null ||
          AValeurParDefaut === undefined ||
          AValeurParDefaut === ''
            ? '[]'
            : AValeurParDefaut;
        this.Domaine = this._getDomaine(AValeurParDefaut, this.nombreValeurs);
        this.cache = {};
      }
      strToDomaine(aChaine, aNombreValeurs) {
        if (
          !(
            aChaine.charAt(0) === '[' &&
            aChaine.charAt(aChaine.length - 1) === ']'
          )
        ) {
          const lTab = aChaine.split('');
          if (aNombreValeurs !== null && aNombreValeurs >= 0) {
            lTab.length = aNombreValeurs;
          }
          return lTab.map((aVal) =>
            aVal === ValeurSemaine.plein
              ? ValeurSemaine.plein
              : ValeurSemaine.vide,
          );
        }
        aChaine = aChaine.substring(1, aChaine.length - 1);
        const R = new Array(
          aNombreValeurs !== TypeDomaine.CTailleOuverte ? aNombreValeurs : 0,
        );
        const T1 = aChaine.split(',');
        for (let I = 0; I < T1.length; I++) {
          const T2 = T1[I].split('..');
          const V1 = parseInt(T2[0]);
          const V2 = T2.length === 1 ? V1 : parseInt(T2[1]);
          for (let J = V1; J <= V2; J++) {
            R[J - 1] = ValeurSemaine.plein;
          }
        }
        if (this.nombreValeurs !== TypeDomaine.CTailleOuverte) {
          this.nombreValeurs = R.length;
        }
        return R;
      }
      toString() {
        let S = '',
          N = 0;
        for (let I = 0; I <= this.Domaine.length; I++) {
          if (this.Domaine[I] === ValeurSemaine.plein) {
            N++;
          } else if (N > 0) {
            if (S.length) {
              S += ',';
            }
            if (N > 1) {
              S += I + 1 - N + '..';
            }
            S += I;
            N = 0;
          }
        }
        return '[' + S + ']';
      }
      vider() {
        this.cache = {};
        this.setValeur(false, 1, this.getTaille());
        return this;
      }
      estVide() {
        return this.getNbrValeurs(true) === 0;
      }
      setValeur(AValeur, ADeb, AFin) {
        if (
          ADeb > this.getTaille() &&
          this.nombreValeurs !== TypeDomaine.CTailleOuverte
        ) {
          return;
        }
        this.cache = {};
        if (this.nombreValeurs !== TypeDomaine.CTailleOuverte) {
          ADeb = Math.borner(ADeb, 1, this.getTaille());
          AFin = Math.borner(
            AFin === null || AFin === undefined ? ADeb : AFin,
            1,
            this.getTaille(),
          );
        } else {
          ADeb = Math.max(ADeb, 1);
          AFin =
            AFin === null || AFin === undefined ? ADeb : Math.max(ADeb, AFin);
        }
        for (let I = ADeb - 1; I < AFin; I++) {
          this.Domaine[I] = AValeur ? ValeurSemaine.plein : ValeurSemaine.vide;
        }
        return this;
      }
      getValeur(APos) {
        return this.Domaine[APos - 1] === ValeurSemaine.plein;
      }
      getPremierePosition(aValeur) {
        for (let I = 0; I < this.Domaine.length; I++) {
          const lValeur =
            this.Domaine[I] === null || this.Domaine[I] === undefined
              ? ValeurSemaine.vide
              : this.Domaine[I];
          if (
            lValeur ===
            (aValeur === false ? ValeurSemaine.vide : ValeurSemaine.plein)
          ) {
            return I + 1;
          }
        }
        return -1;
      }
      enListeDomainesContinues() {
        const lResult = new ObjetListeElements_1.ObjetListeElements();
        let lValeurPrecedente;
        let lPeriode = new ObjetElement_1.ObjetElement('');
        for (let I = 0; I < this.Domaine.length; I++) {
          const lValeur =
            this.Domaine[I] === null || this.Domaine[I] === undefined
              ? ValeurSemaine.vide
              : this.Domaine[I];
          if (lValeur === ValeurSemaine.plein) {
            if (lPeriode.debut === undefined) {
              lPeriode.debut = I + 1;
            }
            if (
              lValeurPrecedente === ValeurSemaine.plein ||
              lPeriode.fin === undefined
            ) {
              lPeriode.fin = I + 1;
            }
          } else {
            if (lPeriode.debut !== undefined) {
              lResult.addElement(lPeriode);
            }
            lPeriode = new ObjetElement_1.ObjetElement('');
          }
          lValeurPrecedente = lValeur;
        }
        if (lPeriode.debut !== undefined) {
          lResult.addElement(lPeriode);
        }
        return lResult;
      }
      getDernierePosition(aValeur) {
        for (let I = this.Domaine.length - 1; I >= 0; I--) {
          const lValeur =
            this.Domaine[I] === null || this.Domaine[I] === undefined
              ? ValeurSemaine.vide
              : this.Domaine[I];
          if (
            lValeur ===
            (aValeur === false ? ValeurSemaine.vide : ValeurSemaine.plein)
          ) {
            return I + 1;
          }
        }
        return -1;
      }
      getNbrValeurs(AValeur) {
        let N = 0;
        const LValeur =
          AValeur || AValeur === null || AValeur === undefined
            ? ValeurSemaine.plein
            : ValeurSemaine.vide;
        if (this.cache['GetNbrValeurs_' + LValeur] !== undefined) {
          return this.cache['GetNbrValeurs_' + LValeur];
        }
        for (let I = 0; I < this.Domaine.length; I++) {
          if (this.Domaine[I] === LValeur) {
            N++;
          }
        }
        this.cache['GetNbrValeurs_' + LValeur] = N;
        return N;
      }
      estUnNombre() {
        return this.getNbrValeurs(true) <= 1;
      }
      getNombre() {
        return this.getNbrValeurs(true) === 1
          ? this.getPremierePosition(true)
          : 0;
      }
      getTaille() {
        return this.Domaine.length;
      }
      getIntersection(aDomaine) {
        if (!aDomaine) {
          return MethodesObjet_1.MethodesObjet.dupliquer(this);
        }
        const lTaille = Math.min(this.getTaille(), aDomaine.getTaille());
        const lIntersect = new TypeDomaine(null, lTaille);
        for (let I = 1; I <= lTaille; I++) {
          if (this.getValeur(I) && aDomaine.getValeur(I)) {
            lIntersect.setValeur(true, I);
          }
        }
        return lIntersect;
      }
      getInversion() {
        const lTaille = this.getTaille();
        const lInversion = new TypeDomaine(null, lTaille);
        for (let I = 1; I <= lTaille; I++) {
          lInversion.setValeur(!this.getValeur(I), I);
        }
        return lInversion;
      }
      getDomaineSoustraction(aDomaineASoustraire) {
        const lDomaine = MethodesObjet_1.MethodesObjet.dupliquer(this);
        if (
          !aDomaineASoustraire ||
          !aDomaineASoustraire.getTaille ||
          !aDomaineASoustraire.getValeur
        ) {
          return lDomaine;
        }
        for (
          let I = 1, lTaille = aDomaineASoustraire.getTaille();
          I <= lTaille;
          I++
        ) {
          if (aDomaineASoustraire.getValeur(I)) {
            lDomaine.setValeur(false, I);
          }
        }
        return lDomaine;
      }
      getDomaineUnion(aDomaineAAjouter) {
        const lDomaine = MethodesObjet_1.MethodesObjet.dupliquer(this);
        if (!aDomaineAAjouter) {
          return lDomaine;
        }
        for (
          let I = 1, lTaille = aDomaineAAjouter.getTaille();
          I <= lTaille;
          I++
        ) {
          if (aDomaineAAjouter.getValeur(I)) {
            lDomaine.setValeur(true, I);
          }
        }
        return lDomaine;
      }
      egal(aDomaine) {
        if (!aDomaine || !aDomaine.getTaille || !aDomaine.getValeur) {
          return false;
        }
        for (let I = 1, lTaille = this.getTaille(); I <= lTaille; I++) {
          if (this.getValeur(I) !== aDomaine.getValeur(I)) {
            return false;
          }
        }
        return true;
      }
      getSemaines() {
        if (this.cache['getSemaines'] !== undefined) {
          return this.cache['getSemaines'];
        }
        const lTaille = this.getTaille();
        const lSemaines = [];
        for (let I = 1; I <= lTaille; I++) {
          if (this.getValeur(I)) {
            lSemaines.push(I);
          }
        }
        this.cache['getSemaines'] = lSemaines;
        return lSemaines;
      }
      dupliquer() {
        const lDomaine = new TypeDomaine(null, this.nombreValeurs);
        lDomaine.Domaine = [].concat(this.Domaine);
        return lDomaine;
      }
      toJSON() {
        const lJSON = {};
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] =
          TypeHttpVariable_1.TypeHttpVariable.TypeHttpDomaine;
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] = this.toString();
        return lJSON;
      }
      _getDomaine(AValeurParDefaut, ANombreValeurs) {
        const lType = typeof AValeurParDefaut;
        let D;
        if (lType !== 'object' && lType !== 'string') {
          D = new Array(
            1 +
              (ANombreValeurs === null || ANombreValeurs === undefined
                ? TypeDomaine.C_MaxDomaineCycle
                : ANombreValeurs),
          )
            .join(
              lType === 'boolean' && AValeurParDefaut
                ? ValeurSemaine.plein
                : ValeurSemaine.vide,
            )
            .split('');
        }
        switch (lType) {
          case 'number':
            D[AValeurParDefaut - 1] = ValeurSemaine.plein;
            return D;
          case 'string':
            return this.strToDomaine(AValeurParDefaut, ANombreValeurs);
          case 'boolean':
            return D;
          default:
            return D;
        }
      }
    }
    exports.TypeDomaine = TypeDomaine;
    TypeDomaine.CTailleOuverte = -1;
    TypeDomaine.C_MaxDomaineCycle = 62;
  },
  fn: 'typedomaine.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GTraductions = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    require('Divers.js');
    const trad = require('traductions.js');
    class ObjetTraduction {
      getValeur(aNom, aTableauRemplacements) {
        return this._getValeur(aNom, aTableauRemplacements);
      }
      getTabValeurs(aNom) {
        const lVal = this._getValeur(aNom);
        if (Array.isArray(lVal)) {
          return lVal;
        }
        return lVal;
      }
      hasTabValeurs(aNom) {
        let lValeur = MethodesObjet_1.MethodesObjet.get(this, aNom);
        return !!lValeur && Array.isArray(lValeur);
      }
      getTitreMFiche(aIdRessource) {
        const lChaine = this.getValeur(aIdRessource);
        if (lChaine !== '' && typeof lChaine === 'string') {
          const lJson = JSON.parse(lChaine);
          if (lJson && lJson.titre) {
            return lJson.titre;
          } else {
          }
        } else {
        }
      }
      _getValeur(aNom, aTableauRemplacements) {
        let lValeur = MethodesObjet_1.MethodesObjet.get(this, aNom);
        if (!lValeur && !MethodesObjet_1.MethodesObjet.isString(lValeur)) {
          return lValeur || '';
        }
        if (aTableauRemplacements) {
          if (typeof lValeur === 'string') {
            lValeur = lValeur.format(aTableauRemplacements);
          } else {
          }
        }
        return lValeur;
      }
      add(aNom, aValeur, aAccepteTableau) {
        try {
          let lNomDernierNoeud = aNom;
          let lObjet = this;
          if (aNom.indexOf('.') > 0) {
            const T = aNom.split('.');
            for (let J = 0; J < T.length - 1; J++) {
              const lProp = aNom.split('.')[J];
              if (!lObjet[lProp]) {
                lObjet[lProp] = new ObjetTraduction();
              }
              lObjet = lObjet[lProp];
            }
            if (T.length > 0) {
              lNomDernierNoeud = aNom.split('.')[T.length - 1];
            }
          }
          if (MethodesObjet_1.MethodesObjet.isString(lObjet)) {
            return;
          }
          if (lObjet[lNomDernierNoeud] || lObjet[lNomDernierNoeud] === '') {
            if (
              MethodesObjet_1.MethodesObjet.isString(lObjet[lNomDernierNoeud])
            ) {
              lObjet[lNomDernierNoeud] = [lObjet[lNomDernierNoeud]];
            }
            lObjet[lNomDernierNoeud].push(aValeur || '');
          } else {
            lObjet[lNomDernierNoeud] = aValeur || '';
          }
        } catch (e) {}
      }
      _passerEnCleDeTraductionsDEBUG(aChaine) {}
    }
    const GTraductions = new ObjetTraduction();
    exports.GTraductions = GTraductions;
    if (trad) {
      const lFunc = function (aNom, aValeur, aAccepteTableau) {
        GTraductions.add(aNom, aValeur, aAccepteTableau);
      };
      trad(lFunc);
    }
  },
  fn: 'objettraduction.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreAnnotation = void 0;
    var EGenreAnnotation;
    (function (EGenreAnnotation) {
      EGenreAnnotation[(EGenreAnnotation['erreur'] = -1)] = 'erreur';
      EGenreAnnotation[(EGenreAnnotation['note'] = 0)] = 'note';
      EGenreAnnotation[(EGenreAnnotation['absent'] = 1)] = 'absent';
      EGenreAnnotation[(EGenreAnnotation['dispense'] = 2)] = 'dispense';
      EGenreAnnotation[(EGenreAnnotation['nonNote'] = 3)] = 'nonNote';
      EGenreAnnotation[(EGenreAnnotation['inapte'] = 4)] = 'inapte';
      EGenreAnnotation[(EGenreAnnotation['nonRendu'] = 5)] = 'nonRendu';
      EGenreAnnotation[(EGenreAnnotation['absentZero'] = 6)] = 'absentZero';
      EGenreAnnotation[(EGenreAnnotation['nonRenduZero'] = 7)] = 'nonRenduZero';
      EGenreAnnotation[(EGenreAnnotation['felicitations'] = 8)] =
        'felicitations';
    })(EGenreAnnotation || (exports.EGenreAnnotation = EGenreAnnotation = {}));
  },
  fn: 'enumere_annotation.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ToucheClavierUtil = exports.ToucheClavier = void 0;
    const ToucheClavier = {
      Backspace: 8,
      Tab: 9,
      RetourChariot: 13,
      Espace: 32,
      Shift: 16,
      Ctrl: 17,
      Alt: 18,
      Windows: 91,
      ContextMenu: 93,
      Echap: 27,
      FlecheGauche: 37,
      FlecheDroite: 39,
      FlecheHaut: 38,
      FlecheBas: 40,
      Inserer: 45,
      Supprimer: 46,
      Debut: 36,
      Fin: 35,
      PageHaut: 33,
      PageBas: 34,
      _0: 48,
      _1: 49,
      _2: 50,
      _3: 51,
      _4: 52,
      _5: 53,
      _6: 54,
      _7: 55,
      _8: 56,
      _9: 57,
      A: 65,
      B: 66,
      C: 67,
      D: 68,
      E: 69,
      F: 70,
      G: 71,
      H: 72,
      I: 73,
      J: 74,
      K: 75,
      L: 76,
      M: 77,
      N: 78,
      O: 79,
      P: 80,
      Q: 81,
      R: 82,
      S: 83,
      T: 84,
      U: 85,
      V: 86,
      W: 87,
      X: 88,
      Y: 89,
      Z: 90,
      AccoladeDroite: 222,
      AccoladeGauche: 220,
      Dollar: 223,
      CrochetGauche: 186,
      CrochetDroite: 192,
      Circonflexe: 221,
      PointInterrogation: 219,
      VerrMaj: 20,
      VerrNum: 144,
      F1: 115,
      F3: 114,
      F2: 113,
      F5: 116,
      F6: 117,
      F7: 118,
      F8: 119,
      F9: 120,
      F10: 121,
      F11: 122,
      F12: 123,
      ArretDefilement: 145,
      Pause: 19,
      Inferieur: 226,
      Virgule: 188,
      Tiret: 189,
      Point: 190,
      Section: 191,
      NumpadPlus: 107,
      NumpadMoins: 109,
      NumpadSlash: 111,
      NumpadStar: 106,
      Numpad_0: 96,
      Numpad_1: 97,
      Numpad_2: 98,
      Numpad_3: 99,
      Numpad_4: 100,
      Numpad_5: 101,
      Numpad_6: 102,
      Numpad_7: 103,
      Numpad_8: 104,
      Numpad_9: 105,
      NumpadPoint: 110,
    };
    exports.ToucheClavier = ToucheClavier;
    const ToucheClavierUtil = {
      estCaractere(aChar, aRegExp) {
        return aChar === '' || new RegExp('[' + aRegExp + ']').test(aChar);
      },
      estEventRetourChariot(aEventJQuery) {
        return (
          !!aEventJQuery &&
          aEventJQuery.which === ToucheClavier.RetourChariot &&
          !aEventJQuery.shiftKey &&
          !aEventJQuery.altKey &&
          !aEventJQuery.ctrlKey
        );
      },
      estEventEspace(aEventJQuery) {
        return (
          !!aEventJQuery &&
          aEventJQuery.which === ToucheClavier.Espace &&
          !aEventJQuery.shiftKey
        );
      },
      estEventSelection(aEventJQuery) {
        return (
          ToucheClavierUtil.estEventRetourChariot(aEventJQuery) ||
          ToucheClavierUtil.estEventEspace(aEventJQuery)
        );
      },
      estEventEdition(aEventJQuery) {
        return (
          !!aEventJQuery &&
          aEventJQuery.which === ToucheClavier.RetourChariot &&
          aEventJQuery.shiftKey &&
          !aEventJQuery.altKey &&
          !aEventJQuery.ctrlKey
        );
      },
      estEventSupprimer(aEventJQuery) {
        return (
          aEventJQuery &&
          ((aEventJQuery.which === ToucheClavier.Supprimer &&
            !aEventJQuery.shiftKey &&
            !aEventJQuery.altKey &&
            !aEventJQuery.ctrlKey) ||
            (aEventJQuery.which === ToucheClavier.Backspace &&
              aEventJQuery.metaKey))
        );
      },
      estEventCaractereAlphaNumerique(aEventJQuery) {
        return (
          !!aEventJQuery &&
          !aEventJQuery.altKey &&
          !aEventJQuery.ctrlKey &&
          new RegExp('[0-9.a-z.A-Z]').test(
            String.fromCharCode(aEventJQuery.which),
          )
        );
      },
      estToucheFleche(aTouche) {
        return (
          aTouche === ToucheClavier.FlecheBas ||
          aTouche === ToucheClavier.FlecheHaut ||
          aTouche === ToucheClavier.FlecheGauche ||
          aTouche === ToucheClavier.FlecheDroite
        );
      },
      ToucheRetourNavigation: ToucheClavier.Echap,
    };
    exports.ToucheClavierUtil = ToucheClavierUtil;
  },
  fn: 'toucheclavier.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('purify.min.js');
    require('purify.js');
  },
  fn: 'declarationdompurify.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreDocumentJoint = void 0;
    var EGenreDocumentJoint;
    (function (EGenreDocumentJoint) {
      EGenreDocumentJoint[(EGenreDocumentJoint['Url'] = 0)] = 'Url';
      EGenreDocumentJoint[(EGenreDocumentJoint['Fichier'] = 1)] = 'Fichier';
      EGenreDocumentJoint[(EGenreDocumentJoint['Cloud'] = 2)] = 'Cloud';
      EGenreDocumentJoint[(EGenreDocumentJoint['LienKiosque'] = 3)] =
        'LienKiosque';
      EGenreDocumentJoint[(EGenreDocumentJoint['LienVisio'] = 4)] = 'LienVisio';
    })(
      EGenreDocumentJoint ||
        (exports.EGenreDocumentJoint = EGenreDocumentJoint = {}),
    );
  },
  fn: 'enumere_documentjoint.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EFormatDocJointUtil = exports.EFormatDocJoint = void 0;
    var EFormatDocJoint;
    (function (EFormatDocJoint) {
      EFormatDocJoint[(EFormatDocJoint['Inconnu'] = 0)] = 'Inconnu';
      EFormatDocJoint[(EFormatDocJoint['Texte'] = 1)] = 'Texte';
      EFormatDocJoint[(EFormatDocJoint['Pdf'] = 2)] = 'Pdf';
      EFormatDocJoint[(EFormatDocJoint['Excel'] = 3)] = 'Excel';
      EFormatDocJoint[(EFormatDocJoint['Archive'] = 4)] = 'Archive';
      EFormatDocJoint[(EFormatDocJoint['Image'] = 5)] = 'Image';
      EFormatDocJoint[(EFormatDocJoint['Son'] = 6)] = 'Son';
      EFormatDocJoint[(EFormatDocJoint['Video'] = 7)] = 'Video';
      EFormatDocJoint[(EFormatDocJoint['Diapo'] = 8)] = 'Diapo';
      EFormatDocJoint[(EFormatDocJoint['Geogebra'] = 9)] = 'Geogebra';
    })(EFormatDocJoint || (exports.EFormatDocJoint = EFormatDocJoint = {}));
    const EFormatDocJointUtil = {
      getClassImgDeGenre(aGenre) {
        switch (aGenre) {
          case EFormatDocJoint.Texte:
            return 'Image_FormatTexte';
          case EFormatDocJoint.Pdf:
            return 'Image_FormatPDF';
          case EFormatDocJoint.Excel:
            return 'Image_FormatExcel';
          case EFormatDocJoint.Archive:
            return 'Image_FormatArch';
          case EFormatDocJoint.Image:
            return 'Image_FormatImg';
          case EFormatDocJoint.Son:
            return 'Image_FormatSon';
          case EFormatDocJoint.Video:
            return 'Image_FormatVideo';
          case EFormatDocJoint.Diapo:
            return 'Image_FormatPPT';
          case EFormatDocJoint.Geogebra:
            return 'Image_FormatGGB';
        }
        return 'Image_FormatInconnu';
      },
      getGenreDExtension(aExtension) {
        switch (aExtension) {
          case 'doc':
          case 'docx':
          case 'txt':
            return EFormatDocJoint.Texte;
          case 'pdf':
            return EFormatDocJoint.Pdf;
          case 'gzip':
          case 'zip':
          case 'rar':
            return EFormatDocJoint.Archive;
          case 'xls':
          case 'xlsx':
            return EFormatDocJoint.Excel;
          case 'png':
          case 'mng':
          case 'tiff':
          case 'jpeg':
          case 'gif':
          case 'jpg':
          case 'webp':
          case 'bmp':
            return EFormatDocJoint.Image;
          case 'mp3':
          case 'ogg':
          case 'wav':
            return EFormatDocJoint.Son;
          case 'mp4':
          case 'mpeg':
          case 'avi':
            return EFormatDocJoint.Video;
          case 'ppt':
          case 'pptx':
            return EFormatDocJoint.Diapo;
          case 'ggb':
            return EFormatDocJoint.Geogebra;
        }
        return EFormatDocJoint.Inconnu;
      },
      getClassIconDeGenre(aGenre) {
        switch (aGenre) {
          case EFormatDocJoint.Texte:
            return 'icon_fichier_word';
          case EFormatDocJoint.Pdf:
            return 'icon_uniF1C1';
          case EFormatDocJoint.Excel:
            return 'icon_fichier_excel';
          case EFormatDocJoint.Archive:
            return 'icon_fichier_zip';
          case EFormatDocJoint.Image:
            return 'icon_fichier_image';
          case EFormatDocJoint.Son:
            return 'icon_fichier_audio';
          case EFormatDocJoint.Video:
            return 'icon_fichier_video';
          case EFormatDocJoint.Diapo:
            return 'icon_fichier_powerpoint';
          case EFormatDocJoint.Geogebra:
            return 'icon_file_text_alt';
          default:
            return 'icon_file_alt';
        }
      },
      getGenreDeFichier(aExtension) {
        if (aExtension !== '') {
          return EFormatDocJointUtil.getGenreDExtension(
            aExtension.toLowerCase(),
          );
        }
        return EFormatDocJoint.Inconnu;
      },
    };
    exports.EFormatDocJointUtil = EFormatDocJointUtil;
  },
  fn: 'enumere_formatdocjoint.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireCss = UtilitaireCss;
    const MethodesObjet_1 = require('MethodesObjet');
    function UtilitaireCss() {}
    let uCacheReglesCss = null;
    let uCacheCss = null;
    const uTailleMaxCacheCss = 50;
    function _trouverSelecteur(aSelecteursTexte, aNomRegleCss) {
      if (aSelecteursTexte && aSelecteursTexte.join) {
        for (let i = 0; i < aSelecteursTexte.length; i++) {
          if (aSelecteursTexte[i] === aNomRegleCss) {
            return true;
          }
        }
      }
      return false;
    }
    function _remplirCacheReglesCss() {
      let lStyleSheet, lRules, lRegles, lRegle, lSelecteurTexte;
      uCacheReglesCss = [];
      for (let I = document.styleSheets.length - 1; I >= 0; I--) {
        lStyleSheet = document.styleSheets[I];
        if (lStyleSheet && lStyleSheet.href) {
          try {
            lRules = lStyleSheet.cssRules || lStyleSheet.rules;
          } catch (e) {
            lRules = null;
            IE.log.addLog('lecture cssRules : exception=> ' + e);
          }
          if (lRules) {
            lRegles = [];
            uCacheReglesCss.push(lRegles);
            for (let J = 0; J < lRules.length; J++) {
              try {
                lSelecteurTexte = lRules[J].selectorText;
              } catch (e) {
                IE.log.addLog(e);
              }
              lRegle = { selecteurs: [], regle: lRules[J] };
              if (lSelecteurTexte && lSelecteurTexte.split) {
                const lTabSelector = lSelecteurTexte.split(',');
                if (lTabSelector) {
                  for (let i = 0; i < lTabSelector.length; i++) {
                    lRegle.selecteurs.push(
                      lTabSelector[i] &&
                        lTabSelector[i].trim &&
                        lTabSelector[i].trim().toLowerCase().replace(/'/g, '"'),
                    );
                  }
                }
              }
              lRegles.push(lRegle);
            }
          }
        }
      }
    }
    function _chercherReglesCss(aNomRegleCss) {
      if (
        !aNomRegleCss ||
        !MethodesObjet_1.MethodesObjet.isString(aNomRegleCss)
      ) {
        return null;
      }
      aNomRegleCss = aNomRegleCss.toLowerCase();
      if (!uCacheReglesCss) {
        _remplirCacheReglesCss();
      }
      if (uCacheCss && uCacheCss[aNomRegleCss]) {
        return uCacheCss[aNomRegleCss];
      }
      const lRegles = [];
      try {
        aNomRegleCss = aNomRegleCss.trim().toLowerCase().replace(/'/g, '"');
        for (let I = uCacheReglesCss.length - 1; I >= 0; I--) {
          const lRules = uCacheReglesCss[I];
          if (lRules) {
            for (let J = lRules.length - 1; J >= 0; J--) {
              const lRegle = lRules[J];
              if (lRegle) {
                if (_trouverSelecteur(lRegle.selecteurs, aNomRegleCss)) {
                  lRegles.push(lRegle.regle);
                }
              }
            }
          }
        }
        if (lRegles.length > 0) {
          if (!uCacheCss) {
            uCacheCss = [];
          }
          if (uCacheCss.length >= uTailleMaxCacheCss) {
            for (let lProp in uCacheCss) {
              delete uCacheCss[lProp];
              break;
            }
          }
          uCacheCss[aNomRegleCss] = lRegles;
          return lRegles;
        } else {
          return null;
        }
      } catch (e) {
        IE.log.addLog('lecture cssRules : exception=> ' + e);
      }
    }
    function _convertirProprieteCSS(aProprieteCSS) {
      const lTab = aProprieteCSS.split('-');
      for (let i = 1; i < lTab.length; i++) {
        lTab[i] = lTab[i].ucfirst();
      }
      return lTab.join('');
    }
    function _modifierProprieteCSS(aRule, aProprieteCSS, aValeur) {
      try {
        if (aRule && aRule.style) {
          if (aRule.style.setProperty) {
            aRule.style.setProperty(aProprieteCSS, aValeur, null);
          } else {
            aProprieteCSS = _convertirProprieteCSS(aProprieteCSS);
            if (
              !MethodesObjet_1.MethodesObjet.isUndefined(
                aRule.style[aProprieteCSS],
              )
            ) {
              aRule.style[aProprieteCSS] = aValeur;
            }
          }
        }
      } catch (e) {
        return false;
      }
      return true;
    }
    function _getRegleQuiDefinitProprieteCSS(aTabRegles, aProprieteCSS) {
      if (!aTabRegles) {
        return null;
      }
      let lAttribut;
      for (let i = 0; i < aTabRegles.length; i++) {
        const lRegle = aTabRegles[i];
        if (lRegle && lRegle.style) {
          aProprieteCSS = _convertirProprieteCSS(aProprieteCSS);
          lAttribut = lRegle.style[aProprieteCSS];
          if (
            lAttribut !== null &&
            lAttribut !== undefined &&
            lAttribut !== ''
          ) {
            return lRegle;
          }
        }
      }
      return null;
    }
    UtilitaireCss.modifierRegleCss = function (
      aNomRegleCss,
      aProprieteCSS,
      aValeur,
    ) {
      const lRegles = _chercherReglesCss(aNomRegleCss);
      if (!lRegles) {
        return false;
      }
      let lRegleAModifier = _getRegleQuiDefinitProprieteCSS(
        lRegles,
        aProprieteCSS,
      );
      if (lRegleAModifier === null || lRegleAModifier === undefined) {
        lRegleAModifier = lRegles[0];
      }
      return _modifierProprieteCSS(lRegleAModifier, aProprieteCSS, aValeur);
    };
    UtilitaireCss.chercherAttributReglesCss = function (
      aNomRegleCss,
      aAttribut,
    ) {
      const lRegles = _chercherReglesCss(aNomRegleCss);
      if (!lRegles) {
        return '';
      }
      let lAttribut;
      for (let i = 0; i < lRegles.length; i++) {
        if (lRegles[i] && lRegles[i].style) {
          lAttribut = lRegles[i].style[aAttribut];
          if (
            lAttribut !== null &&
            lAttribut !== undefined &&
            lAttribut !== ''
          ) {
            return lRegles[i].style[aAttribut];
          }
        }
      }
      return '';
    };
    UtilitaireCss.extraireUrlReglesCss = function (aNomRegleCss) {
      const lUrl = UtilitaireCss.chercherAttributReglesCss(
        aNomRegleCss,
        'backgroundImage',
      );
      if (!lUrl || lUrl.length === 0) {
        return '';
      }
      const lTabSplitDoubleQuote = lUrl.split('"');
      let lTab = lTabSplitDoubleQuote[1];
      if (!lTab) {
        const lTabSplitSimpleQuote = lUrl.split("'");
        lTab = lTabSplitSimpleQuote[1];
      }
      if (!lTab) {
        const lTabSplitOuvParenthese = lUrl.split('(');
        lTab = lTabSplitOuvParenthese[1];
        if (!lTab) {
          return '';
        }
        const lTabSplitFermParenthese = lTab.split(')');
        lTab = lTabSplitFermParenthese[0];
      }
      if (!lTab) {
        return '';
      }
      const lTabSplitSlash = lTab.split('/');
      const lTab2 = [];
      for (let j = 0; j < lTabSplitSlash.length; j++) {
        if (lTabSplitSlash[j] !== '..') {
          lTab2.push(lTabSplitSlash[j]);
        }
      }
      return lTab2.join('/');
    };
  },
  fn: 'utilitairecss.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.fragment = exports.c_attributsAAfficherMemeSiLaValeurEstVide =
      void 0;
    exports.str = str;
    exports.toArg = toArg;
    exports.jsxFuncAttr = jsxFuncAttr;
    const MethodesObjet_1 = require('MethodesObjet');
    const capitalACharCode = 'A'.charCodeAt(0);
    const capitalZCharCode = 'Z'.charCodeAt(0);
    const isUpper = (input, index) => {
      const charCode = input.charCodeAt(index);
      return capitalACharCode <= charCode && capitalZCharCode >= charCode;
    };
    const toKebabCase = (camelCased) => {
      let kebabCased = '';
      for (let i = 0; i < camelCased.length; i++) {
        const prevUpperCased = i > 0 ? isUpper(camelCased, i - 1) : true;
        const currentUpperCased = isUpper(camelCased, i);
        const nextUpperCased =
          i < camelCased.length - 1 ? isUpper(camelCased, i + 1) : true;
        if (
          (!prevUpperCased && currentUpperCased) ||
          (currentUpperCased && !nextUpperCased)
        ) {
          kebabCased += '-';
          kebabCased += camelCased[i].toLowerCase();
        } else {
          kebabCased += camelCased[i];
        }
      }
      return kebabCased;
    };
    const attributeToString = (aAttributes) => (name) => {
      let lValue = aAttributes[name];
      if (lValue === null || typeof lValue === 'undefined') {
        return '';
      }
      const formattedName = name.toLowerCase();
      const makeAttribute = (value) => `${formattedName}="${value}"`;
      if (formattedName === 'class' && Array.isArray(lValue)) {
        const lTab = [];
        lValue.forEach((aVal) => {
          const lVal = aVal && aVal.trim ? aVal.trim() : '';
          if (lVal) {
            lTab.push(lVal);
          }
        });
        lValue = lTab.join(' ');
      }
      if (
        formattedName === 'style' &&
        lValue &&
        !Array.isArray(lValue) &&
        typeof lValue === 'object' &&
        MethodesObjet_1.MethodesObjet.isObject(lValue) &&
        !MethodesObjet_1.MethodesObjet.isDate(lValue)
      ) {
        const lArr = [];
        const lPropsStyle = Object.keys(lValue);
        lPropsStyle.map((aKey) => {
          let lValueStyle = lValue[aKey];
          const lKeyStyle = toKebabCase(aKey);
          if (MethodesObjet_1.MethodesObjet.isNumber(lValueStyle)) {
            lValueStyle = lValueStyle.toString() + 'px';
          }
          if (
            lValueStyle &&
            lKeyStyle &&
            MethodesObjet_1.MethodesObjet.isString(lKeyStyle) &&
            MethodesObjet_1.MethodesObjet.isString(lValueStyle)
          ) {
            lArr.push(`${lKeyStyle}:${lValueStyle};`);
          }
        });
        if (lArr.length === 0) {
          return '';
        }
        lValue = lArr.join('');
      }
      if (lValue instanceof Date) {
        return makeAttribute(lValue.toISOString());
      } else {
        switch (typeof lValue) {
          case 'boolean':
            if (lValue) {
              return formattedName;
            } else {
              return '';
            }
          default: {
            let lStr = lValue + '';
            if (lStr === c_strObjectToString) {
              return '';
            }
            if (
              lStr === '' &&
              !exports.c_attributsAAfficherMemeSiLaValeurEstVide.includes(
                formattedName,
              )
            ) {
              return '';
            }
            if (formattedName === 'title') {
              lStr = lStr.toTitle();
            } else {
              lStr = lStr.toAttrValue();
            }
            return makeAttribute(lStr);
          }
        }
      }
    };
    const attributesToString = (aAttributes) => {
      if (aAttributes) {
        const lVal = Object.keys(aAttributes)
          .filter((attribute) => attribute !== 'children')
          .map(attributeToString(aAttributes))
          .filter((attribute) => attribute.length)
          .join(' ');
        return lVal ? ' ' + lVal : '';
      } else {
        return '';
      }
    };
    const c_strObjectToString = '[object Object]';
    exports.c_attributsAAfficherMemeSiLaValeurEstVide = [
      'alt',
      'title',
      'placeholder',
      'aria-label',
      'aria-description',
    ];
    const contentsToString = (contents) => {
      if (contents) {
        return contents
          .map((aElements) => {
            if (
              MethodesObjet_1.MethodesObjet.isString(aElements) ||
              MethodesObjet_1.MethodesObjet.isNumber(aElements)
            ) {
              return aElements;
            }
            if (MethodesObjet_1.MethodesObjet.isFunction(aElements)) {
              const lTab = [];
              const lResultBrut = aElements(lTab);
              let lResult;
              if (lTab.length > 0) {
                lResult = lTab.join('');
              } else {
                lResult = lResultBrut || '';
              }
              return contentsToString([lResult]);
            }
            if (Array.isArray(aElements)) {
              return contentsToString(aElements);
            }
            if (
              aElements &&
              aElements.toString &&
              !MethodesObjet_1.MethodesObjet.isBoolean(aElements) &&
              !MethodesObjet_1.MethodesObjet.isDate(aElements)
            ) {
              const lStr = aElements.toString();
              if (lStr === c_strObjectToString) {
                return '';
              }
              return lStr;
            }
            return '';
          })
          .join('');
      } else {
        return '';
      }
    };
    const isVoidElement = (tagName) => {
      return (
        [
          'area',
          'base',
          'br',
          'col',
          'command',
          'embed',
          'hr',
          'img',
          'input',
          'keygen',
          'link',
          'meta',
          'param',
          'source',
          'track',
          'wbr',
        ].indexOf(tagName) > -1
      );
    };
    function str(name, attributes = {}, ...contents) {
      const children = (attributes && attributes.children) || contents;
      if (typeof name === 'function') {
        return name(
          children ? Object.assign({ children }, attributes) : attributes,
          contents,
        );
      } else {
        const tagName = name.toLowerCase();
        if (isVoidElement(tagName) && !contents.length) {
          return `<${tagName}${attributesToString(attributes)}>`;
        } else {
          return `<${tagName}${attributesToString(attributes)}>${contentsToString(contents)}</${tagName}>`;
        }
      }
    }
    const fragment = (attributes, contents) => contentsToString(contents);
    exports.fragment = fragment;
    function toArg(aArgs) {
      let lArray;
      if (Array.isArray(aArgs)) {
        lArray = aArgs;
      } else {
        lArray = [aArgs];
      }
      const lTab = [];
      lArray.forEach((aArg) => {
        if (aArg === null || typeof aArg === 'undefined') {
          lTab.push(aArg + '');
        } else if (
          typeof aArg === 'string' ||
          MethodesObjet_1.MethodesObjet.isDate(aArg)
        ) {
          lTab.push(`'${aArg}'`);
        } else if (typeof aArg === 'object' || typeof aArg === 'function') {
          lTab.push(null + '');
        } else {
          lTab.push(aArg.toString());
        }
      });
      return lTab.join(',').toAttrValue();
    }
    function jsxFuncAttr(aNomFonction, aArgs) {
      if (!aNomFonction || !aNomFonction.replace) {
        return '';
      }
      let lResult = aNomFonction;
      if (arguments.length > 1) {
        lResult += `(${toArg(aArgs)})`;
      }
      return lResult;
    }
    IE.jsx = { str, fragment: exports.fragment };
  },
  fn: 'jsx.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.tag = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const jsx = require('jsx');
    let u_collection = {
      br: { autoFermante: true },
      input: { autoFermante: true },
      img: { autoFermante: true },
    };
    const tag = function (aBalise, ...aParams) {
      let lNomBalise = aBalise;
      if (!lNomBalise || !lNomBalise.trim) {
        return '';
      }
      lNomBalise = lNomBalise.trim();
      if (!lNomBalise) {
        return '';
      }
      const T = ['<', lNomBalise];
      const lArgs = aParams;
      const lAttrs = lArgs[0];
      let lInner = '';
      if (lAttrs && MethodesObjet_1.MethodesObjet.isObject(lAttrs)) {
        T.push(_attrsToString(lAttrs));
        lArgs.shift();
      }
      if (lArgs.length > 0) {
        lArgs.forEach((aVal) => {
          let lInnerArg = aVal;
          if (
            lInnerArg &&
            MethodesObjet_1.MethodesObjet.isFunction(lInnerArg)
          ) {
            const lTabInner = [];
            lInnerArg = lInnerArg(lTabInner);
            if (lTabInner.length > 0) {
              lInnerArg = lTabInner.join('');
            }
          }
          if (lInnerArg === 0) {
            lInnerArg = lInnerArg + '';
          }
          if (lInnerArg) {
            lInner += lInnerArg;
          }
        });
      }
      if (
        !lInner &&
        u_collection[lNomBalise] &&
        u_collection[lNomBalise].autoFermante
      ) {
        T.push('>');
      } else {
        T.push('>');
        if (lInner) {
          T.push(lInner);
        }
        T.push('</', lNomBalise, '>');
      }
      return T.join('');
    };
    exports.tag = tag;
    function _attrsToString(aAttrs) {
      if (aAttrs && MethodesObjet_1.MethodesObjet.isString(aAttrs)) {
        return aAttrs;
      }
      if (aAttrs && MethodesObjet_1.MethodesObjet.isObject(aAttrs)) {
        const T = [];
        Object.keys(aAttrs).forEach((aKey) => {
          let lVal = aAttrs[aKey];
          if (lVal && Array.isArray(lVal)) {
            if (aKey === 'class') {
              const lTab = [];
              lVal.forEach((aVal) => {
                const lVal = aVal && aVal.trim ? aVal.trim() : '';
                if (lVal) {
                  lTab.push(lVal);
                }
              });
              lVal = lTab.join(' ');
            } else if (aKey === 'style') {
              const lTab = [];
              lVal.forEach((aVal) => {
                let lVal = aVal && aVal.trim ? aVal.trim() : '';
                if (lVal && lVal.length > 0) {
                  if (lVal[lVal.length - 1] !== ';') {
                    lVal += ';';
                  }
                  lTab.push(lVal);
                }
              });
              lVal = lTab.join(' ');
            } else {
              lVal = lVal.join(' ');
            }
          }
          if (lVal && lVal.trim && lVal.trim() === '') {
            return;
          }
          if (lVal === 0 || lVal > 0 || lVal === true || (lVal && lVal.trim)) {
            T.push(tag.composeAttr(aKey, lVal === true ? '' : lVal).trimEnd());
          }
        });
        return T.join('');
      }
      return '';
    }
    tag.toArg = jsx.toArg;
    tag.funcAttr = jsx.jsxFuncAttr;
    tag.composeAttr = function (aAttribut, aValue, aArgs) {
      if (!aAttribut || !aAttribut.trim) {
        return '';
      }
      let lAttribut = aAttribut.trim();
      if (!lAttribut) {
        return '';
      }
      lAttribut = ' ' + lAttribut;
      let lValue = aValue === 0 ? aValue + '' : aValue;
      if (!lValue || lValue === true) {
        return lAttribut + ' ';
      }
      if (MethodesObjet_1.MethodesObjet.isString(lValue) && lValue.replace) {
        if (aAttribut === 'title') {
          lValue = lValue.toTitle();
        } else {
          lValue = lValue.toAttrValue();
        }
      } else {
        if (!MethodesObjet_1.MethodesObjet.isNumber(lValue)) {
          return lAttribut + ' ';
        }
        lValue = lValue + '';
      }
      const lArgs = [];
      if (arguments.length > 2) {
        lArgs.push(aArgs);
      }
      return lAttribut + '="' + tag.funcAttr(lValue, ...lArgs) + '" ';
    };
    tag.styleToStr = function (aRule, aValue) {
      if (!aRule || !aRule.trim) {
        return '';
      }
      if (!aValue && aValue !== 0) {
        return '';
      }
      return (
        aRule +
        ':' +
        aValue +
        (typeof aValue === 'string' &&
        aValue.length > 0 &&
        aValue[aValue.length - 1] === ';'
          ? ''
          : ';')
      );
    };
  },
  fn: 'tag.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TUtilitaireEmail = void 0;
    const cRregExEmail =
      '^([^\\s@\\.]+\\.)*[^\\s@\\.]+@([^\\s@\\.]+\\.)+[^\\s@\\.]+$';
    const TUtilitaireEmail = {
      estValide(aEmail) {
        return RegExp(cRregExEmail, 'i').test(aEmail.trim());
      },
    };
    exports.TUtilitaireEmail = TUtilitaireEmail;
  },
  fn: 'utilitaireemail.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GChaine = exports.ObjetChaine = void 0;
    require('DeclarationDOMPurify');
    require('Divers');
    const GUID_1 = require('GUID');
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_ChampsJSON_1 = require('Enumere_ChampsJSON');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const ObjetElement_1 = require('ObjetElement');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetSupport_1 = require('ObjetSupport');
    const TypeHttpVariable_1 = require('TypeHttpVariable');
    const Enumere_FormatDocJoint_1 = require('Enumere_FormatDocJoint');
    const UtilitaireCss_1 = require('UtilitaireCss');
    const ComparateurChaines_1 = require('ComparateurChaines');
    const tag_1 = require('tag');
    const UtilitaireEmail_1 = require('UtilitaireEmail');
    const ObjetTraduction_1 = require('ObjetTraduction');
    let GChaine;
    class ObjetChaine {
      constructor() {
        this.maskTelephone = '99 99 99 99 99 99';
        this._hauteurPolice = [];
        this.regexURL = /(https?:\/\/|www\.)[^ \r\n,]+/gi;
        this.__cacheCanvas = null;
        this.LongueurCaracteres = new Array(30);
        for (let I = 0; I < 30; I++) {
          this.LongueurCaracteres[I] = new Array(2);
          for (let J = 0; J < 2; J++) {
            this.LongueurCaracteres[I][J] = [];
          }
        }
      }
      enleverChemin(aFichier) {
        let N = aFichier.lastIndexOf('/');
        if (N === -1) {
          N = aFichier.lastIndexOf('\\');
        }
        return aFichier.substring(N + 1, aFichier.length);
      }
      avecEspaceSiVide(AChaine) {
        return AChaine && AChaine.length > 0 ? AChaine : '&nbsp;';
      }
      toAttrValue(aChaine) {
        return aChaine && aChaine.toAttrValue ? aChaine.toAttrValue() : '';
      }
      toTitle(aChaine) {
        return aChaine && aChaine.toTitle ? aChaine.toTitle() : '';
      }
      strToDate(ADate) {
        const lTabDate = ADate.split(' ');
        const LJour = lTabDate[0].split('/');
        const LHeure = lTabDate[1] ? lTabDate[1].split(':') : ['0', '0', '0'];
        return new Date(
          parseInt(LJour[2]),
          parseInt(LJour[1]) - 1,
          parseInt(LJour[0]),
          parseInt(LHeure[0]),
          parseInt(LHeure[1]),
          parseInt(LHeure[2]),
        );
      }
      strToInteger(aInteger) {
        return parseInt(aInteger, 10);
      }
      strToDouble(aDouble) {
        return parseFloat(aDouble.replace(',', '.'));
      }
      strToCardinal(ACardinal) {
        return parseInt(ACardinal, 10);
      }
      strToBoolean(ABoolean) {
        return (
          ABoolean === '1' ||
          ABoolean.toUpperCase() === 'TRUE' ||
          ABoolean.toUpperCase() === 'VRAI'
        );
      }
      strToIp(aIP) {
        const T = aIP.split('.');
        if (T.length !== 4) {
          return '';
        }
        let lIp = 0;
        let lValeur;
        for (let I = 0; I < 4; I++) {
          lValeur = parseInt(T[I], 10);
          if (lValeur < 0 || lValeur > 255) {
            return 0;
          }
          lIp = 256 * lIp + lValeur;
        }
        return lIp;
      }
      dateToStr(ADate) {
        return _dateToStr(ADate);
      }
      domaineToStr(aDomaine) {
        return aDomaine ? aDomaine.toString() : '';
      }
      doubleToStr(aDouble) {
        return ('' + aDouble).replace('.', ',');
      }
      chaineToStr(AChaine) {
        return !AChaine ? '' : AChaine;
      }
      cardinalToStr(ACardinal) {
        return '' + ACardinal;
      }
      ipToStr(aIp) {
        aIp = parseInt(aIp, 10);
        if (isNaN(aIp)) {
          return '';
        }
        const T = [];
        for (let I = 4; I > 0; I--) {
          T[I - 1] = aIp % 256;
          if (T[I - 1] < 0) {
            T[I - 1] += 256;
          }
          aIp = Math.floor(aIp / 256);
        }
        return T.join('.');
      }
      estAdresseIPV4Valide(aStrAdresseIPV4) {
        let lEstValide = false;
        if (!!aStrAdresseIPV4) {
          const lStrAdresseIP = aStrAdresseIPV4.trim();
          const lStrNombres = lStrAdresseIP.split('.');
          if (lStrNombres.length === 4) {
            lEstValide = true;
            for (const lStrNombre of lStrNombres) {
              const lNb = parseInt(lStrNombre);
              if (lNb < 0 || lNb >= 256) {
                lEstValide = false;
                break;
              }
            }
          }
        }
        return lEstValide;
      }
      format(aChaine, aTabElements) {
        if (!aChaine || !aChaine.format) {
          return aChaine;
        }
        return aChaine.format(aTabElements);
      }
      tailleOctetsToStr(aTailleEnOctets) {
        if (
          aTailleEnOctets < 0 ||
          !MethodesObjet_1.MethodesObjet.isNumber(aTailleEnOctets)
        ) {
          return `0 ${ObjetTraduction_1.GTraductions.getValeur('unite.Ko')}`;
        }
        const lUnit = 1024;
        let lFixed = 0;
        let lVal = aTailleEnOctets;
        let lUnite = ObjetTraduction_1.GTraductions.getValeur('unite.O');
        if (lVal === 0) {
          lUnite = ObjetTraduction_1.GTraductions.getValeur('unite.Ko');
        } else if (lVal > lUnit) {
          lUnite = ObjetTraduction_1.GTraductions.getValeur('unite.Ko');
          lVal = lVal / lUnit;
          lFixed = 1;
          if (lVal > lUnit) {
            lUnite = ObjetTraduction_1.GTraductions.getValeur('unite.Mo');
            lVal = lVal / lUnit;
            lFixed = 2;
            if (lVal > lUnit) {
              lUnite = ObjetTraduction_1.GTraductions.getValeur('unite.Go');
              lVal = lVal / lUnit;
            }
          }
        }
        return `${this.doubleToStr(lVal.toFixed(lFixed))} ${lUnite}`;
      }
      insecable(AChaine) {
        try {
          return AChaine
            ? AChaine.replace(/ /g, '&nbsp;').replace(/-/g, '&#x2011;')
            : '';
        } catch (e) {
          return '';
        }
      }
      formatTelephone(aChaine, aOptions) {
        if (!aChaine || !aChaine.trim) {
          return '';
        }
        const lOptions = Object.assign(
          { mask: '', avecTailleMask: true },
          aOptions,
        );
        let lMask = lOptions.mask || this.maskTelephone;
        const lChaine = aChaine.trim().replace(/([^0-9\s])/g, '');
        lMask = this._reverseString(lMask.replace(/([^9\s])/g, ''));
        const lLengthCharMask = lMask.replace(/([^9])/g, '').length;
        const lNumeroSansEspace = lChaine.replace(/([^0-9])/g, '');
        const lEcart = Math.max(0, lNumeroSansEspace.length - lLengthCharMask);
        let lPartieDroite = lNumeroSansEspace.slice(
          lEcart,
          lNumeroSansEspace.length,
        );
        let lPartieGaucheIntacte = '';
        let lPartieGauche;
        let lResult;
        lPartieDroite = this._reverseString(lPartieDroite);
        let lIndice = -1;
        lResult = lMask.replace(/9/g, () => {
          lIndice += 1;
          return lPartieDroite[lIndice] || '';
        });
        if (!lOptions.avecTailleMask) {
          lPartieGauche = lNumeroSansEspace.slice(0, lEcart);
          lIndice = 0;
          for (let i = 0; i < lChaine.length; i++) {
            if (lChaine.charAt(i) === ' ') {
              lPartieGaucheIntacte += ' ';
            } else {
              lPartieGaucheIntacte += lPartieGauche.charAt(lIndice);
              lIndice += 1;
              if (lIndice >= lPartieGauche.length) {
                break;
              }
            }
          }
        }
        return (lPartieGaucheIntacte + this._reverseString(lResult)).trim();
      }
      formatTelephoneAvecIndicatif(aIndicatif, aNumeroTel) {
        const lIndicatif = aIndicatif ? '+' + aIndicatif : '';
        if (
          !!aIndicatif &&
          aNumeroTel.length === 10 &&
          aNumeroTel.startsWith('0')
        ) {
          aNumeroTel = aNumeroTel.slice(1);
        }
        return lIndicatif + aNumeroTel;
      }
      geStrTelephoneAvecEspaces(aNumTel) {
        if (!aNumTel || !aNumTel.length) {
          return '';
        }
        let lResult = '';
        let lCompteur = 0;
        for (let i = aNumTel.length - 1; i >= 0; i--) {
          if (lCompteur % 2 === 0) {
            lResult = ' ' + lResult;
          }
          lResult = aNumTel.charAt(i) + lResult;
          lCompteur++;
        }
        return lResult.trim();
      }
      _getConteneurCalculChaine() {
        const ldLongueurChaineEnPixel = 'LongueurChaineEnPixel';
        let E = document.getElementById(ldLongueurChaineEnPixel);
        if (!E) {
          let lConteneur = document.body;
          if (global.GApplication) {
            lConteneur =
              document.getElementById(GApplication.getIdConteneur()) ||
              document.body;
          }
          lConteneur.insertAdjacentHTML(
            'beforeend',
            '<div id="' +
              ldLongueurChaineEnPixel +
              '" class="Texte10 hide" style="position:absolute; top:-50px; white-space:pre;"></div>',
          );
          E = document.getElementById(ldLongueurChaineEnPixel);
        }
        if (E) {
          return E;
        }
        return null;
      }
      getLongueurChaineDansDiv(AChaine, ATaille, AGras, aNonToTexte) {
        if (!AChaine) {
          return 0;
        }
        if (!ATaille) {
          ATaille = 10;
        }
        if (!this.__cacheCanvas) {
          this.__cacheCanvas =
            ObjetSupport_1.Support.supportCanvasText &&
            UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss
              ? {
                  canvas: document.createElement('canvas'),
                  fontFamily: global
                    .getComputedStyle(document.body)
                    .getPropertyValue('font-family'),
                  fontSize: {},
                }
              : {};
          this.__cacheCanvas.actif =
            !!this.__cacheCanvas.canvas && !!this.__cacheCanvas.fontFamily;
          if (!this.__cacheCanvas.actif) {
            this.__cacheCanvas.canvas = null;
          }
        }
        if (this.__cacheCanvas.actif) {
          const lContext = this.__cacheCanvas.canvas.getContext('2d');
          if (!this.__cacheCanvas.fontSize[ATaille]) {
            if (
              ATaille &&
              typeof ATaille === 'string' &&
              ATaille.endsWith('rem')
            ) {
              this.__cacheCanvas.fontSize[ATaille] =
                this.cacheCanvasConvertREMToPx(ATaille);
            } else if (
              ATaille &&
              typeof ATaille === 'string' &&
              ATaille.endsWith('px')
            ) {
              this.__cacheCanvas.fontSize[ATaille] = ATaille;
            } else {
              let lVal =
                UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss(
                  '.Texte' + ATaille,
                  'fontSize',
                );
              if (!lVal) {
                lVal = Math.round(ATaille * 1.1) + 'px';
              } else if (lVal.endsWith && lVal.endsWith('rem')) {
                lVal = this.cacheCanvasConvertREMToPx(lVal);
              }
              this.__cacheCanvas.fontSize[ATaille] = lVal;
            }
          }
          let lFontWeight = '';
          if (AGras === true) {
            lFontWeight = 'bold';
          } else if (AGras) {
            if (typeof AGras === 'number') {
              lFontWeight = AGras + '';
            } else {
              lFontWeight = AGras;
            }
          }
          lContext.font =
            (lFontWeight ? lFontWeight + ' ' : '') +
            this.__cacheCanvas.fontSize[ATaille] +
            ' ' +
            this.__cacheCanvas.fontFamily;
          const lMetrics = lContext.measureText(AChaine);
          return lMetrics.width;
        }
        const E = this._getConteneurCalculChaine();
        if (!E) {
          return 0;
        }
        E.className = 'hide Texte' + ATaille + (AGras ? ' Gras' : '');
        let lChaine =
          aNonToTexte === true ? AChaine : this.ajouterEntites(AChaine);
        lChaine =
          lChaine && lChaine.replace
            ? lChaine.replace(/ /g, '&nbsp;')
            : lChaine;
        E.innerHTML = lChaine;
        const lLongueur = E.clientWidth;
        E.innerHTML = '';
        return lLongueur;
      }
      getLongueurChaine(AChaine, ATaille, AGras, ALongueur, aChaineEnTexte) {
        if (!AChaine) {
          return '';
        }
        const lChaine = this.enleverEntites(AChaine);
        let LLongueur = 0;
        let I;
        const N = lChaine.length;
        if (lChaine.length > 0) {
          LLongueur = this.getLongueurChaineDansDiv(lChaine, ATaille, AGras);
        }
        if (ALongueur === null || ALongueur === undefined) {
          return LLongueur;
        }
        if (ALongueur > 0 && LLongueur >= ALongueur) {
          LLongueur = 0;
          const G = AGras ? 1 : 0;
          for (
            I = 0;
            I < N &&
            (ALongueur === null ||
              ALongueur === undefined ||
              LLongueur < ALongueur);
            I++
          ) {
            let C = lChaine.charCodeAt(I);
            let L = this.LongueurCaracteres[ATaille][G][C];
            if (!L) {
              L = this.LongueurCaracteres[ATaille][G][C] =
                this.getLongueurChaineDansDiv(
                  lChaine.charAt(I),
                  ATaille,
                  AGras,
                );
            }
            LLongueur += L === 0 ? 10 : L;
          }
        }
        if (LLongueur >= ALongueur) {
          let lChaineTronque = lChaine.substring(0, I);
          if (lChaineTronque && lChaine !== lChaineTronque && LLongueur > 0) {
            LLongueur = this.getLongueurChaineDansDiv(
              lChaineTronque,
              ATaille,
              AGras,
            );
          }
          if (LLongueur === 0) {
            return aChaineEnTexte
              ? ''
              : '<div style="font-size:1px">&nbsp;</div>';
          }
          if (LLongueur >= ALongueur) {
            lChaineTronque = lChaine.substring(0, I - 1);
            while (I > 2) {
              if (
                this.getLongueurChaineDansDiv(lChaineTronque, ATaille, AGras) <
                ALongueur
              ) {
                break;
              }
              I--;
              lChaineTronque = lChaine.substring(0, I - 1);
            }
          }
          return this.ajouterEntites(lChaineTronque);
        }
        return AChaine;
      }
      estChaineTropLongue(AChaine, ATaille, AGras, ALongueur) {
        const lResult = this.getChaine(AChaine, ATaille, AGras, ALongueur);
        if (typeof lResult === 'string') {
          return lResult.length !== AChaine.length;
        }
        return false;
      }
      getChaine(AChaine, ATaille, AGras, ALongueur, aChaineEnTexte) {
        return this.getLongueurChaine(
          AChaine,
          ATaille,
          AGras,
          ALongueur,
          aChaineEnTexte,
        );
      }
      getHauteurPolice(ATaille) {
        let lHauteur = this._hauteurPolice[ATaille];
        if (!lHauteur) {
          const E = this._getConteneurCalculChaine();
          if (!E) {
            return 0;
          }
          E.className = 'hide Texte' + ATaille;
          E.innerHTML = 'X';
          lHauteur = this._hauteurPolice[ATaille] = E.offsetHeight;
        }
        return lHauteur;
      }
      encoderComposantUrl(S, aAvecDecode = false) {
        if (!MethodesObjet_1.MethodesObjet.isString(S)) {
          return '';
        }
        try {
          const lStr = aAvecDecode ? decodeURI(S) : S;
          return encodeURIComponent(
            lStr.replace(ObjetChaine.regexCarControl, ''),
          );
        } catch (e) {
          return '';
        }
      }
      encoderUrl(S) {
        if (!MethodesObjet_1.MethodesObjet.isString(S)) {
          return '';
        }
        try {
          return encodeURI(
            decodeURI(S).replace(ObjetChaine.regexCarControl, ''),
          );
        } catch (e) {
          return '';
        }
      }
      replaceRCToHTML(AChaine, aChaineRemplacement) {
        return AChaine ? AChaine.replaceRCToHTML(aChaineRemplacement) : '';
      }
      fromHTML(AChaine) {
        return AChaine ? AChaine.replace(/<br( \/)?>/gi, '\n') : '';
      }
      nodeToTextAvecRC(aNode) {
        return aNode ? aNode.innerText || '' : '';
      }
      ajouterEntites(aChaine, aSansQuote) {
        if (aChaine && aChaine.ajouterEntites) {
          return aChaine.ajouterEntites(aSansQuote);
        }
        return aChaine;
      }
      enleverEntites(aChaine) {
        if (aChaine && aChaine.enleverEntites) {
          return aChaine.enleverEntites();
        }
        return aChaine;
      }
      nettoyerCommentaire(aChaine) {
        return aChaine && aChaine.replace
          ? aChaine.replace(/(<!--)(.+)(-->)/g, '')
          : aChaine;
      }
      verifierURLHttp(aUrl) {
        return aUrl
          ? aUrl.toLowerCase().indexOf('http://') === 0 ||
            aUrl.toLowerCase().indexOf('https://') === 0
            ? aUrl
            : 'http://' + aUrl
          : aUrl;
      }
      ajouterLiensURL(aTexte) {
        if (!aTexte) {
          aTexte = '';
        }
        const urlRegex = this.regexURL;
        return aTexte.replace(urlRegex, (url) => {
          return (
            '<a href="' +
            this.verifierURLHttp(url) +
            '" target="_blank">' +
            url +
            '</a>'
          );
        });
      }
      contientAuMoinsUneURL(aTexte) {
        if (!aTexte) {
          aTexte = '';
        }
        const lTexteAvecLiensURL = this.ajouterLiensURL(aTexte);
        return aTexte !== lTexteAvecLiensURL;
      }
      creerUrlBruteLienExterne(aDocumentJoint, aParam) {
        if (!('getCommunication' in GApplication)) {
          return;
        }
        if (!aDocumentJoint) {
          return '';
        }
        if (
          aDocumentJoint.getEtat() === Enumere_Etat_1.EGenreEtat.Creation ||
          !aDocumentJoint.existeNumero()
        ) {
          return '';
        }
        if (!aParam) {
          aParam = {};
        }
        let lUrl = '';
        let lGenreDocumentJoint = aParam.genreDocumentJoint;
        if (!MethodesObjet_1.MethodesObjet.isNumber(lGenreDocumentJoint)) {
          lGenreDocumentJoint = aDocumentJoint.getGenre();
        }
        let lLibelleLienExterne = aParam.libelle;
        if (!lLibelleLienExterne) {
          lLibelleLienExterne = aDocumentJoint.getLibelle();
        }
        if (
          lGenreDocumentJoint ===
          Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
        ) {
          lLibelleLienExterne = 'link';
        }
        const lInfoFichier = new ObjetElement_1.ObjetElement(
          '',
          aDocumentJoint.getNumero(),
          aParam.genreRessource,
        );
        if (!!aParam.infoSupp) {
          Object.assign(lInfoFichier, aParam.infoSupp);
        }
        if (aParam.miniature !== null && aParam.miniature !== undefined) {
          Object.assign(lInfoFichier, { miniature: aParam.miniature });
        }
        lUrl = GApplication.getCommunication().composeUrlFichierExterne(
          this.encoderComposantUrl(lLibelleLienExterne, true),
          lInfoFichier,
        );
        if (aParam.forcerURLComplete) {
          const lBalise = document.createElement('a');
          lBalise.href = lUrl;
          lUrl = lBalise.href;
        }
        return lUrl;
      }
      composerUrlLienExterne(aParam) {
        const lParam = {
          documentJoint: undefined,
          genreDocumentJoint: undefined,
          genreRessource: undefined,
          infoSupp: undefined,
          libelle: '',
          libelleEcran: undefined,
          ariaLabel: '',
          ariaLabelledby: '',
          avecAriaLabelledby: false,
          title: '',
          iconeOverride: '',
          afficherIconeDocument: true,
          avecLien: true,
          maxWidth: 0,
          ieModelChips: null,
          ieChipsMinimal: false,
          argsIEModel: null,
          class: '',
          forcerURLComplete: undefined,
        };
        Object.assign(lParam, aParam);
        if (
          !MethodesObjet_1.MethodesObjet.isNumber(lParam.genreDocumentJoint)
        ) {
          lParam.genreDocumentJoint = lParam.documentJoint
            ? lParam.documentJoint.getGenre()
            : Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier;
        }
        if (
          lParam.documentJoint &&
          (lParam.documentJoint.getEtat() ===
            Enumere_Etat_1.EGenreEtat.Creation ||
            !lParam.documentJoint.existeNumero())
        ) {
          lParam.avecLien = false;
        }
        if (
          lParam.genreDocumentJoint ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Url &&
          !lParam.libelleEcran &&
          !lParam.libelle
        ) {
          if (lParam.documentJoint.getLibelle()) {
            lParam.libelleEcran = lParam.documentJoint.getLibelle();
          } else {
            lParam.libelleEcran = lParam.documentJoint.url;
            lParam.avecAriaLabelledby = true;
          }
          lParam.libelle = 'link';
        }
        if (
          lParam.genreDocumentJoint ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.LienVisio &&
          !lParam.libelleEcran &&
          !lParam.libelle
        ) {
          lParam.libelleEcran = !!lParam.documentJoint.libelleLien
            ? lParam.documentJoint.libelleLien
            : undefined;
          lParam.libelle = lParam.documentJoint.url;
        }
        let lUrl = '';
        if (lParam.avecLien) {
          lUrl = this.creerUrlBruteLienExterne(lParam.documentJoint, {
            genreRessource: lParam.genreRessource,
            genreDocumentJoint: lParam.genreDocumentJoint,
            forcerURLComplete: lParam.forcerURLComplete,
            libelle: lParam.libelle,
            infoSupp: lParam.infoSupp,
          });
        }
        const lInfosLiens = {
          tag: 'ie-chips',
          ieModel: '',
          title: lParam.title || false,
          libelle:
            lParam.libelleEcran !== undefined && lParam.libelleEcran !== null
              ? lParam.libelleEcran
              : lParam.libelle
                ? lParam.libelle
                : lParam.documentJoint
                  ? lParam.documentJoint.getLibelle()
                  : '',
          href: lUrl,
          classes: [],
          ariaLabel: lParam.ariaLabel
            ? ' ' + tag_1.tag.composeAttr('aria-label', lParam.ariaLabel)
            : '',
          ariaLabelledby:
            lParam.avecAriaLabelledby && lParam.ariaLabelledby
              ? ' ' +
                tag_1.tag.composeAttr('aria-labelledby', lParam.ariaLabelledby)
              : '',
        };
        if (!!lParam.class) {
          lInfosLiens.classes.push(lParam.class);
        }
        if (!!lParam.ieModelChips) {
          lInfosLiens.ieModel =
            ' ' +
            tag_1.tag.composeAttr(
              'ie-model',
              lParam.ieModelChips,
              lParam.argsIEModel,
            );
        }
        let lIconeLien = '';
        if (!!lParam.afficherIconeDocument) {
          if (lParam.iconeOverride) {
            lIconeLien = lParam.iconeOverride;
          } else {
            lIconeLien = this._getClasseIconeDocumentJoint(
              lParam.documentJoint,
            );
          }
        }
        if (!!lIconeLien) {
          lInfosLiens.classes.push('iconic');
          lInfosLiens.classes.push(lIconeLien);
        }
        if (!!lParam.ieChipsMinimal) {
          lInfosLiens.classes.push('chips-minimal');
        }
        const lGenreFichier =
          Enumere_FormatDocJoint_1.EFormatDocJointUtil.getGenreDeFichier(
            this.extraireExtensionFichier(
              lParam.libelle
                ? lParam.libelle
                : lParam.documentJoint
                  ? lParam.documentJoint.getLibelle()
                  : '',
            ),
          );
        if (
          lGenreFichier === Enumere_FormatDocJoint_1.EFormatDocJoint.Geogebra
        ) {
          lInfosLiens.href =
            'geogebra.html?view=' + encodeURIComponent(lInfosLiens.href) + '';
        }
        return (
          '<' +
          lInfosLiens.tag +
          ' id="' +
          GUID_1.GUID.getId() +
          '"' +
          (lParam.maxWidth > 0
            ? ' style="max-width:' + lParam.maxWidth + 'px;"'
            : '') +
          (lInfosLiens.title && typeof lInfosLiens.title === 'string'
            ? ' title="' + GChaine.toTitle(lInfosLiens.title) + '"'
            : '') +
          (!!lInfosLiens.href ? ' href="' + lInfosLiens.href + '"' : '') +
          (!!lInfosLiens.ieModel ? lInfosLiens.ieModel : '') +
          (lInfosLiens.classes.length > 0
            ? ' class="' + lInfosLiens.classes.join(' ') + '"'
            : '') +
          (lInfosLiens.ariaLabel ? lInfosLiens.ariaLabel : '') +
          (lInfosLiens.ariaLabelledby ? lInfosLiens.ariaLabelledby : '') +
          '>' +
          lInfosLiens.libelle +
          '</' +
          lInfosLiens.tag +
          '>'
        );
      }
      estFichierImageAvecMiniaturePossible(aNomFichier) {
        if (aNomFichier) {
          const lExt = this.extraireExtensionFichier(aNomFichier);
          return (
            !!lExt &&
            !['webp'].includes(lExt) &&
            Enumere_FormatDocJoint_1.EFormatDocJointUtil.getGenreDeFichier(
              lExt,
            ) === Enumere_FormatDocJoint_1.EFormatDocJoint.Image
          );
        }
        return false;
      }
      composeUrlRequete(aParam) {
        let lResult = '';
        if (aParam.url) {
          lResult = aParam.url;
          if (lResult.charAt(lResult.length - 1) !== '/') {
            lResult += '/';
          }
        }
        if (aParam.nomRequete) {
          if (aParam.nomRequete.charAt(0) !== '/') {
            lResult += aParam.nomRequete;
          } else {
            lResult += aParam.nomRequete.substring(
              1,
              aParam.nomRequete.length - 1,
            );
          }
        }
        return lResult;
      }
      composeUrlImgPhotoIndividu(aIndividu) {
        if (!aIndividu || !aIndividu.getNumero) {
          return '';
        }
        if (!('getCommunication' in GApplication)) {
          return;
        }
        return GApplication.getCommunication().composeUrlFichierExterne(
          aIndividu.getLibelle().replace(/[\s]/gi, '_') + '.jpg',
          new ObjetElement_1.ObjetElement('', aIndividu.getNumero()),
        );
      }
      supprimerEspaces(aChaine) {
        return aChaine && aChaine.replace ? aChaine.replace(/ /g, '') : aChaine;
      }
      latinize(aChaine) {
        return ComparateurChaines_1.ComparateurChaines.latinize(aChaine);
      }
      normalize(aChaine) {
        return ComparateurChaines_1.ComparateurChaines.normalize(aChaine);
      }
      miseEnFormeEmail(aEmail) {
        return aEmail ? aEmail.replace(/;/g, '<br/>') : '';
      }
      composerEmail(aEmail, aNotMailTo, aSansTabulation) {
        return !aNotMailTo
          ? '<a href="mailto:' +
              aEmail +
              '"' +
              (aSansTabulation ? ' tabindex="-1"' : '') +
              ' target="_blank">' +
              GChaine.miseEnFormeEmail(aEmail) +
              '</a>'
          : '<span class="LienAccueil AvecMain">' +
              GChaine.miseEnFormeEmail(aEmail) +
              '</span>';
      }
      estEmailValide(aEmail) {
        if (!aEmail || !MethodesObjet_1.MethodesObjet.isString(aEmail)) {
          return false;
        }
        return UtilitaireEmail_1.TUtilitaireEmail.estValide(aEmail);
      }
      controleTailleTexte(aParam) {
        let lResult = { controleOK: true, chaine: aParam.chaine };
        let lValeurSansEntites = this.enleverEntites(aParam.chaine);
        if (
          aParam.tailleTexteMax > 0 &&
          lValeurSansEntites.length > aParam.tailleTexteMax
        ) {
          lValeurSansEntites = lValeurSansEntites.slice(
            0,
            aParam.tailleTexteMax,
          );
          lResult = {
            controleOK: false,
            chaine: this.ajouterEntites(lValeurSansEntites),
          };
        }
        return lResult;
      }
      extraireNomFichier(aNomFichier) {
        if (!aNomFichier || !aNomFichier.split) {
          return aNomFichier;
        }
        const lTab = aNomFichier.split('.');
        if (lTab.length > 1) {
          lTab.pop();
        }
        return lTab.join('.');
      }
      extraireExtensionFichier(aNomFichier) {
        if (!aNomFichier || !aNomFichier.split) {
          return '';
        }
        const lTab = aNomFichier.split('.');
        return lTab.length > 1 ? lTab[lTab.length - 1] : '';
      }
      getLibelleSurligne(aLibelle, aRecherches, aOptions) {
        if (!aLibelle) {
          return aLibelle;
        }
        let lRecherche, lIndex;
        const lArray = [];
        const lLibelle = GChaine.enleverEntites(aLibelle || '').replace(
          /&nbsp;/g,
          ' ',
        );
        let lResult;
        const lOptions = Object.assign(
          { couleur: GCouleur.surlignageTexte },
          aOptions,
        );
        if (Array.isArray(aRecherches)) {
          for (let i = 0; i < aRecherches.length; i++) {
            lRecherche = aRecherches[i].trim();
            if (lRecherche.length > 0) {
              for (lIndex = 0; lIndex < lLibelle.length; lIndex++) {
                if (
                  lIndex + lRecherche.length <= lLibelle.length &&
                  ComparateurChaines_1.ComparateurChaines.egal(
                    lRecherche,
                    lLibelle.slice(lIndex, lIndex + lRecherche.length),
                  )
                ) {
                  for (let j = 0; j < lRecherche.length; j++) {
                    lArray[lIndex + j] = true;
                  }
                }
              }
            }
          }
        }
        lResult = '';
        for (let i = 0; i < lLibelle.length; i++) {
          if (lArray[i]) {
            if (!lArray[i - 1]) {
              lResult +=
                '<span style="background-color:' + lOptions.couleur + '">';
            }
            lResult += GChaine.ajouterEntites(lLibelle[i]);
            if (!lArray[i + 1]) {
              lResult += '</span>';
            }
          } else {
            lResult += GChaine.insecable(GChaine.ajouterEntites(lLibelle[i]));
          }
        }
        return lResult;
      }
      supprimerBalisesHtml(aContenu) {
        if (!aContenu || !MethodesObjet_1.MethodesObjet.isString(aContenu)) {
          return '';
        }
        let lContenu = aContenu
          .replace(/\n/g, '')
          .replace(
            /(<\/div>|<\/ol>|<\/ul>|<\/li>|<\/p>)(?!(<br>|<br\/>|<\/div>|<\/ol>|<\/ul>|<\/li>|<\/p>))/g,
            '$1\n',
          )
          .replace(/(<br>|<br\/>)/g, '$1\n')
          .replace(/<[^>]*?>/gi, '');
        if (lContenu.endsWith('\n')) {
          lContenu = lContenu.slice(0, lContenu.length - 1);
        }
        return lContenu;
      }
      simpleHtmlToSafeHtml(aHtml) {
        try {
          const lDoc = new DOMParser().parseFromString(aHtml, 'text/html');
          if (lDoc && lDoc.body) {
            return lDoc.body.innerHTML || '';
          }
        } catch (e) {}
        return aHtml;
      }
      htmlToSafeHtml(aHtml) {
        if (!IE.DOMPurifyDisabled) {
          return this.htmlDOMPurify(aHtml);
        }
        return this.simpleHtmlToSafeHtml(aHtml);
      }
      htmlDOMPurify(aHtml, aOptionsDOMPurify) {
        if (
          aHtml &&
          MethodesObjet_1.MethodesObjet.isString(aHtml) &&
          global.DOMPurify &&
          !IE.DOMPurifyDisabled
        ) {
          try {
            return global.DOMPurify.sanitize(aHtml, aOptionsDOMPurify);
          } catch (e) {}
        }
        return aHtml;
      }
      estChaineHTMLEgal(aChaine1, aChaine2) {
        if (aChaine1 === aChaine2) {
          return true;
        }
        return this.htmlToSafeHtml(aChaine1) === this.htmlToSafeHtml(aChaine2);
      }
      _reverseString(a) {
        return a.split('').reverse().join('');
      }
      cacheCanvasConvertREMToPx(aTailleREM) {
        if (!this.__cacheCanvas.fontSizeRoot) {
          let lSize = 0;
          try {
            lSize = parseFloat(
              global
                .getComputedStyle(document.documentElement)
                .getPropertyValue('font-size'),
            );
          } catch (e) {
            lSize = 10;
          }
          this.__cacheCanvas.fontSizeRoot = lSize;
        }
        return parseFloat(aTailleREM) * this.__cacheCanvas.fontSizeRoot + 'px';
      }
      _getClasseIconeDocumentJoint(aDocJoint) {
        let lClasseIcone = '';
        const lGenreFichier =
          Enumere_FormatDocJoint_1.EFormatDocJointUtil.getGenreDeFichier(
            GChaine.extraireExtensionFichier(aDocJoint.getLibelle()),
          );
        if (
          lGenreFichier !== Enumere_FormatDocJoint_1.EFormatDocJoint.Inconnu
        ) {
          lClasseIcone =
            Enumere_FormatDocJoint_1.EFormatDocJointUtil.getClassIconDeGenre(
              lGenreFichier,
            );
        } else {
          if (
            aDocJoint.getGenre() ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Cloud
          ) {
            lClasseIcone = 'icon_cloud';
          } else if (
            aDocJoint.getGenre() ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
          ) {
            lClasseIcone = 'icon_link';
          } else if (
            aDocJoint.getGenre() ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.LienKiosque
          ) {
            lClasseIcone = 'icon_external_link';
          } else if (
            aDocJoint.getGenre() ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.LienVisio
          ) {
            lClasseIcone = 'icon_cours_virtuel';
          }
        }
        return lClasseIcone;
      }
    }
    exports.ObjetChaine = ObjetChaine;
    ObjetChaine.regexCarControl = /[\x00-\x1F\x7F-\x9f]/gi;
    function _dateToStr(ADate) {
      return ADate
        ? ADate.getDate() +
            '/' +
            (ADate.getMonth() + 1) +
            '/' +
            ADate.getFullYear() +
            ' ' +
            ADate.getHours() +
            ':' +
            ADate.getMinutes() +
            ':' +
            ADate.getSeconds()
        : '';
    }
    exports.GChaine = GChaine = new ObjetChaine();
    Date.prototype.toJSON = function () {
      const lJSON = {};
      lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] =
        TypeHttpVariable_1.TypeHttpVariable.TypeHttpDateTime;
      lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] = _dateToStr(this);
      return lJSON;
    };
  },
  fn: 'objetchaine.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeNote = void 0;
    const Enumere_ChampsJSON_1 = require('Enumere_ChampsJSON');
    const TypeHttpVariable_1 = require('TypeHttpVariable');
    const Enumere_Annotation_1 = require('Enumere_Annotation');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ToucheClavier_1 = require('ToucheClavier');
    const ObjetChaine_1 = require('ObjetChaine');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetTri_1 = require('ObjetTri');
    class TypeNote {
      constructor(aParametre, N) {
        this.note = '0.00';
        this.valeur = 0.0;
        this.genre = Enumere_Annotation_1.EGenreAnnotation.note;
        this.bareme = 0.0;
        if (typeof aParametre === 'string') {
          this.genre = this.getGenreNote(aParametre);
          this.valeur = this.noteToValeur(aParametre);
          this.note = this.estUneAnnotation()
            ? this.getChaineAnnotationDeGenre(this.genre)
            : this.valeurToNote(this.valeur, N);
          if (
            this.genre === Enumere_Annotation_1.EGenreAnnotation.absentZero ||
            this.genre === Enumere_Annotation_1.EGenreAnnotation.nonRenduZero
          ) {
            this.valeur = 0.0;
          } else if (
            this.genre === Enumere_Annotation_1.EGenreAnnotation.felicitations
          ) {
            const lAvecFelicitationAutorisee = TypeNote.estAnnotationPermise(
              Enumere_Annotation_1.EGenreAnnotation.felicitations,
            );
            if (lAvecFelicitationAutorisee) {
              this.bareme = this.getBaremeNote(aParametre);
              this.note = this.valeurToNote(this.bareme, N) + this.note;
              try {
                const lSurplusBareme =
                  TypeNote.getValeurSurplusBaremeAAppliquer(this.bareme);
                this.valeur = this.bareme + lSurplusBareme;
              } catch (error) {}
            } else {
              this.genre = Enumere_Annotation_1.EGenreAnnotation.note;
              this.bareme = this.getBaremeNote(aParametre);
              this.note = this.valeurToNote(this.bareme, N);
              this.valeur = this.bareme;
            }
          }
          this.chaine = aParametre;
        } else if (typeof aParametre === 'number') {
          this.note = this.valeurToNote(aParametre, N);
          this.valeur = aParametre;
          this.genre = Enumere_Annotation_1.EGenreAnnotation.note;
        }
      }
      getCaractereAnnotation(aArrayGenresNote) {
        const lCaractereAnnotation = {};
        for (const x in aArrayGenresNote) {
          switch (aArrayGenresNote[x]) {
            case Enumere_Annotation_1.EGenreAnnotation.absent:
              lCaractereAnnotation.Absent =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.Absent',
                );
              break;
            case Enumere_Annotation_1.EGenreAnnotation.dispense:
              lCaractereAnnotation.Dispense =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.Dispense',
                );
              break;
            case Enumere_Annotation_1.EGenreAnnotation.nonNote:
              lCaractereAnnotation.NonNote =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.NonNote',
                );
              break;
            case Enumere_Annotation_1.EGenreAnnotation.inapte:
              lCaractereAnnotation.Inapte =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.Inapte',
                );
              break;
            case Enumere_Annotation_1.EGenreAnnotation.nonRendu:
              lCaractereAnnotation.NonRendu =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.NonRendu',
                );
              break;
            case Enumere_Annotation_1.EGenreAnnotation.absentZero:
              lCaractereAnnotation.AbsentZero =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.AbsentZero',
                );
              break;
            case Enumere_Annotation_1.EGenreAnnotation.nonRenduZero:
              lCaractereAnnotation.NonRenduZero =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.NonRenduZero',
                );
              break;
            case Enumere_Annotation_1.EGenreAnnotation.felicitations:
              lCaractereAnnotation.Felicitations =
                ObjetTraduction_1.GTraductions.getValeur(
                  'TypeNote.CaractereAnnotation.Felicitations',
                );
              break;
          }
        }
        return lCaractereAnnotation;
      }
      getGenreNote(aChaine) {
        if (aChaine.split('|').length >= 2) {
          return parseInt(aChaine.split('|')[1]);
        }
        const lTabNotations = _getTableauNotations();
        for (const I in lTabNotations) {
          if (lTabNotations[I].toLowerCase() === aChaine.toLowerCase()) {
            return parseInt(I);
          } else if (
            parseInt(I) === Enumere_Annotation_1.EGenreAnnotation.felicitations
          ) {
            const lObjCaracteresAnnotation = this.getCaractereAnnotation([
              Enumere_Annotation_1.EGenreAnnotation.felicitations,
            ]);
            if (aChaine.indexOf(lObjCaracteresAnnotation.Felicitations) > 0) {
              return Enumere_Annotation_1.EGenreAnnotation.felicitations;
            }
          }
        }
        return Enumere_Annotation_1.EGenreAnnotation.note;
      }
      getBaremeNote(aChaine) {
        let lStrBareme = aChaine.split('|')[2];
        if (!!lStrBareme) {
          lStrBareme = lStrBareme.replace(',', '.');
        }
        return parseFloat(lStrBareme);
      }
      getNote() {
        return this.note;
      }
      getValeur() {
        return this.valeur;
      }
      getGenre() {
        return this.genre;
      }
      estUneValeur() {
        return !isNaN(this.valeur);
      }
      toString() {
        return this.note;
      }
      getNoteSansDecimaleForcee() {
        if (
          this.genre === Enumere_Annotation_1.EGenreAnnotation.note &&
          !isNaN(this.valeur)
        ) {
          return this.valeur.toString().replace('.', ',');
        }
        return this.getNote();
      }
      toStr() {
        let str;
        if (this.genre === Enumere_Annotation_1.EGenreAnnotation.note) {
          str = this.note;
        } else {
          str = '|' + this.genre;
          if (
            this.genre ===
              Enumere_Annotation_1.EGenreAnnotation.felicitations &&
            this.bareme !== null &&
            this.bareme !== undefined
          ) {
            str += '|' + this.bareme;
          }
        }
        return str;
      }
      toJSON() {
        const lJSON = {};
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] =
          TypeHttpVariable_1.TypeHttpVariable.TypeHttpNote;
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] = this.toStr();
        return lJSON;
      }
      noteToValeur(aStrNote) {
        return parseFloat(aStrNote.replace(',', '.'));
      }
      valeurToNote(aValeur, N) {
        let lValeurNb;
        if (typeof aValeur === 'number') {
          if (isNaN(aValeur)) {
            return '';
          }
          lValeurNb = aValeur;
        } else {
          lValeurNb = parseFloat(aValeur);
        }
        N = N === null || N === undefined ? TypeNote.decimalNotation : N;
        return ('' + lValeurNb.toFixed(N)).replace('.', ',');
      }
      estUneNoteVide() {
        return this.note === '';
      }
      estUneAnnotation() {
        return this.genre !== Enumere_Annotation_1.EGenreAnnotation.note;
      }
      estVide() {
        return this.note === '' && !this.estUneValeur();
      }
      estUneNoteValide(aNoteMin, aNoteMax, aAvecNotationSpecifique, aAvecVide) {
        if (this.estUneNoteVide()) {
          return aAvecVide === true;
        }
        if (aAvecNotationSpecifique) {
          if (this.genre !== Enumere_Annotation_1.EGenreAnnotation.note) {
            return true;
          }
        }
        let lChaine = this.note.replace(/\./g, ',');
        if (lChaine.indexOf(',') === -1) {
          lChaine += ',';
        }
        const lPosVirgule = lChaine.indexOf(',');
        const lNbrVirgule = lChaine.split(',').length - 1;
        const lPosMoins = lChaine.indexOf('-');
        const lPosVirguleMax = Math.max(
          ('' + parseInt(aNoteMin.toString())).length,
          ('' + parseInt(aNoteMax.toString())).length,
        );
        return (
          lPosMoins <= 0 &&
          lPosVirgule <= lPosVirguleMax &&
          lChaine.length - (lPosVirgule + 1) <= TypeNote.decimalNotation &&
          lNbrVirgule <= 1 &&
          this.valeur >= aNoteMin.getValeur() &&
          this.valeur <= aNoteMax.getValeur()
        );
      }
      getNoteEntier() {
        return this.estUneValeur()
          ? this.getNote().enleverZero()
          : this.getNote();
      }
      getBaremeEntier() {
        return '/' + this.getNote().enleverZero();
      }
      getBaremeEntierSansSlash() {
        return this.getNote().enleverZero();
      }
      getCoefficientEntier() {
        return this.getNote().enleverZero();
      }
      estBaremeParDefaut() {
        return TypeNote.baremeNotation
          ? this.getValeur() === TypeNote.baremeNotation.getValeur()
          : false;
      }
      estCoefficientParDefaut() {
        return this.valeur === 1;
      }
      getCoefficient() {
        if (this.estUneValeur()) {
          return this.getNote();
        } else {
          return 'xx.xx';
        }
      }
      getChaineAnnotationDeCaractere(aCaractere) {
        const lAnnotation = TypeNote.getGenreAnnotationDeRaccourci(aCaractere);
        if (!!lAnnotation) {
          return _getTableauNotations()[lAnnotation];
        }
      }
      getChaineAnnotationDeGenre(aGenre) {
        return _getTableauNotations()[aGenre];
      }
      egal(aNote) {
        return !!aNote && this.toStr() === aNote.toStr();
      }
      dupliquer() {
        const lNote = new TypeNote();
        lNote.note = this.note;
        lNote.valeur = this.valeur;
        lNote.genre = this.genre;
        return lNote;
      }
      static getValeurSurplusBaremeAAppliquer(aValeurBareme) {
        let lSurplusBaremeCalcule = 0;
        if (
          !!aValeurBareme &&
          !!TypeNote.surplusBareme &&
          TypeNote.surplusBareme.getValeur()
        ) {
          const lBaremeParDefaut = TypeNote.baremeNotation;
          if (
            !!lBaremeParDefaut &&
            aValeurBareme !== lBaremeParDefaut.getValeur()
          ) {
            lSurplusBaremeCalcule =
              (TypeNote.surplusBareme.getValeur() * aValeurBareme) /
              lBaremeParDefaut.getValeur();
          } else {
            lSurplusBaremeCalcule = TypeNote.surplusBareme.getValeur();
          }
        }
        return lSurplusBaremeCalcule;
      }
      static estAnnotationPermise(aGenreAnnotation) {
        const lListeAutorisee = TypeNote.listeAnnotationsAutorisees;
        return (
          !!aGenreAnnotation &&
          (!lListeAutorisee || lListeAutorisee.indexOf(aGenreAnnotation) !== -1)
        );
      }
      static avecVirgule() {
        return TypeNote.decimalNotation > 0;
      }
      static getGenreAnnotationDeRaccourci(aCaractere) {
        let lGenreAnnotation = null;
        if (!!aCaractere && aCaractere.toLowerCase) {
          switch (aCaractere.toLowerCase()) {
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.Absent',
            ):
              lGenreAnnotation = Enumere_Annotation_1.EGenreAnnotation.absent;
              break;
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.Dispense',
            ):
              lGenreAnnotation = Enumere_Annotation_1.EGenreAnnotation.dispense;
              break;
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.NonNote',
            ):
              lGenreAnnotation = Enumere_Annotation_1.EGenreAnnotation.nonNote;
              break;
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.Inapte',
            ):
              lGenreAnnotation = Enumere_Annotation_1.EGenreAnnotation.inapte;
              break;
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.NonRendu',
            ):
              lGenreAnnotation = Enumere_Annotation_1.EGenreAnnotation.nonRendu;
              break;
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.AbsentZero',
            ):
              lGenreAnnotation =
                Enumere_Annotation_1.EGenreAnnotation.absentZero;
              break;
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.NonRenduZero',
            ):
              lGenreAnnotation =
                Enumere_Annotation_1.EGenreAnnotation.nonRenduZero;
              break;
            case ObjetTraduction_1.GTraductions.getValeur(
              'TypeNote.CaractereAnnotation.Felicitations',
            ):
              lGenreAnnotation =
                Enumere_Annotation_1.EGenreAnnotation.felicitations;
              break;
          }
        }
        return lGenreAnnotation;
      }
      static estCaractereNote(
        aChar,
        aAvecLettre,
        aAvecVirgule,
        aAvecMoins,
        aCaractereAnnotation,
      ) {
        aAvecLettre =
          aAvecLettre === null || aAvecLettre === undefined
            ? true
            : aAvecLettre;
        aAvecVirgule =
          aAvecVirgule === null || aAvecVirgule === undefined
            ? true
            : aAvecVirgule;
        aAvecMoins =
          aAvecMoins === null || aAvecMoins === undefined ? true : aAvecMoins;
        aCaractereAnnotation =
          aCaractereAnnotation === null || aCaractereAnnotation === undefined
            ? ObjetTraduction_1.GTraductions.getValeur(
                'TypeNote.CaractereAnnotation',
              )
            : aCaractereAnnotation;
        let lRegExp = '0-9';
        if (aAvecLettre) {
          let lCarAnnot = '';
          for (const x in aCaractereAnnotation) {
            if (
              aCaractereAnnotation[x].toLowerCase &&
              aCaractereAnnotation[x] !== ' '
            ) {
              lCarAnnot += aCaractereAnnotation[x].toLowerCase();
            }
          }
          lRegExp += lCarAnnot + lCarAnnot.toUpperCase();
        }
        if (aAvecVirgule) {
          lRegExp += '.,';
        }
        if (aAvecMoins) {
          lRegExp += '-';
        }
        return ToucheClavier_1.ToucheClavierUtil.estCaractere(aChar, lRegExp);
      }
      static formatStrToNote(aChaine, aOptions = {}) {
        const lNote = new TypeNote(aChaine);
        let lValeurMin = 0;
        if (typeof aOptions.min === 'function') {
          lValeurMin = aOptions.min();
        } else if (!!aOptions.min) {
          lValeurMin = aOptions.min;
        }
        if (lNote.getGenre() > 0) {
          return aOptions.avecAnnotation ? lNote : null;
        }
        if (aChaine === '') {
          return aOptions.sansNotePossible ? lNote : null;
        }
        if (aChaine === ',' || aChaine === '.') {
          return aOptions && aOptions.avecVirgule && aOptions.sansNotePossible
            ? lNote
            : null;
        }
        if (aChaine === '-') {
          return lValeurMin < 0 ? lNote : null;
        }
        if (lNote.estUneValeur()) {
          const lTest =
            '0-9' +
            (aOptions.avecVirgule ? ',.' : '') +
            (lValeurMin < 0 ? '-' : '');
          if (new RegExp('^[' + lTest + ']+$').test(aChaine)) {
            return lNote;
          }
        }
        return null;
      }
      static validerNote(aValeur, aOptions = {}) {
        const lDefaultOptions = {
          avecVirgule: true,
          afficherAvecVirgule: true,
          avecAnnotation: true,
          sansNotePossible: true,
          min: 0,
          max: 100,
          titreMessageMinMax: '',
          messageMinMax:
            ObjetTraduction_1.GTraductions.getValeur('InputNote.MinMax'),
        };
        const lOptions = $.extend(lDefaultOptions, aOptions);
        if (typeof aValeur !== 'string') {
          aValeur = String(aValeur);
        }
        if (!lOptions.avecVirgule) {
          lOptions.afficherAvecVirgule = false;
        }
        let lResult;
        let lValueTemp = aValeur;
        if (lValueTemp.search(/^[0-9]*(,|\.)[0-9]+/) === 0) {
          const lRegExp = new RegExp(
            '^([0-9]*(,|\\.)[0-9]{' + TypeNote.decimalNotation + '}).*$',
          );
          lValueTemp = lValueTemp.replace(lRegExp, '$1');
        }
        const lNote = TypeNote.formatStrToNote(lValueTemp, lOptions);
        let lValeurMin;
        if (typeof lOptions.min === 'function') {
          lValeurMin = lOptions.min();
        } else {
          lValeurMin = lOptions.min;
        }
        let lValeurMax;
        if (typeof lOptions.max === 'function') {
          lValeurMax = lOptions.max();
        } else {
          lValeurMax = lOptions.max;
        }
        const lNoteMin = new TypeNote(lValeurMin),
          lNoteMax = new TypeNote(lValeurMax);
        if (
          !lNote ||
          !lNote.estUneNoteValide(
            lNoteMin,
            lNoteMax,
            lOptions.avecAnnotation,
            lOptions.sansNotePossible,
          ) ||
          lValueTemp === '-'
        ) {
          const lMessage = ObjetChaine_1.GChaine.format(
            lOptions.messageMinMax,
            [
              lOptions.afficherAvecVirgule
                ? lNoteMin.getNote()
                : lNoteMin.getNoteSansDecimaleForcee(),
              lOptions.afficherAvecVirgule
                ? lNoteMax.getNote()
                : lNoteMax.getNoteSansDecimaleForcee(),
            ],
          );
          lResult = {
            estValide: false,
            titre: lOptions.titreMessageMinMax,
            message: lMessage,
          };
        } else {
          lResult = { estValide: true, note: lNote };
        }
        return lResult;
      }
      static getTrisDefaut(aGetNote, aGenreTri) {
        if (!MethodesObjet_1.MethodesObjet.isFunction(aGetNote)) {
          return [];
        }
        return [
          ObjetTri_1.ObjetTri.init((D) => {
            const lNote = aGetNote(D);
            if (
              lNote &&
              (lNote.genre === Enumere_Annotation_1.EGenreAnnotation.note ||
                lNote.genre ===
                  Enumere_Annotation_1.EGenreAnnotation.felicitations) &&
              lNote.estUneValeur()
            ) {
              return lNote.valeur;
            }
            return -1000;
          }, aGenreTri),
          ObjetTri_1.ObjetTri.init((D) => {
            const lNote = aGetNote(D);
            if (lNote) {
              return lNote.genre === Enumere_Annotation_1.EGenreAnnotation.note
                ? -100
                : lNote.genre;
            }
            return -1000;
          }, aGenreTri),
        ];
      }
    }
    exports.TypeNote = TypeNote;
    TypeNote.decimalNotation = 2;
    TypeNote.baremeNotation = null;
    TypeNote.surplusBareme = null;
    TypeNote.listeAnnotationsAutorisees = null;
    let lTableauNotations = null;
    function _getTableauNotations() {
      if (!lTableauNotations) {
        lTableauNotations = [
          '',
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.Absent',
          ),
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.Dispense',
          ),
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.NonNote',
          ),
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.Inapte',
          ),
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.NonRendu',
          ),
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.Absent',
          ) + '*',
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.NonRendu',
          ) + '*',
          ObjetTraduction_1.GTraductions.getValeur(
            'TypeNote.Annotation.Felicitations',
          ),
        ];
      }
      return lTableauNotations;
    }
  },
  fn: 'typenote.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreArrondi = void 0;
    var EGenreArrondi;
    (function (EGenreArrondi) {
      EGenreArrondi[(EGenreArrondi['sans'] = 0)] = 'sans';
      EGenreArrondi[(EGenreArrondi['superieur'] = 1)] = 'superieur';
      EGenreArrondi[(EGenreArrondi['inferieur'] = 2)] = 'inferieur';
      EGenreArrondi[(EGenreArrondi['plusProche'] = 3)] = 'plusProche';
    })(EGenreArrondi || (exports.EGenreArrondi = EGenreArrondi = {}));
  },
  fn: 'enumere_arrondi.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeArrondi = void 0;
    const Enumere_ChampsJSON_1 = require('Enumere_ChampsJSON');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const TypeHttpVariable_1 = require('TypeHttpVariable');
    const TypeNote_1 = require('TypeNote');
    const Enumere_Arrondi_1 = require('Enumere_Arrondi');
    class TypeArrondi {
      constructor(aGenrePronote) {
        this.precision = 0;
        this.genre = Enumere_Arrondi_1.EGenreArrondi.sans;
        this.precisionMini =
          1 / Math.pow(10, TypeNote_1.TypeNote.decimalNotation);
        this.toType(aGenrePronote);
      }
      getPrecision() {
        return this.precision;
      }
      getGenre() {
        return this.genre;
      }
      setPrecision(aPrecision) {
        this.precision = aPrecision;
      }
      setGenre(aGenre) {
        this.genre = aGenre;
      }
      arrondir(aValeur) {
        aValeur =
          Math.round(
            parseFloat(
              Number(aValeur / this.precisionMini).toFixed(
                TypeNote_1.TypeNote.decimalNotation,
              ),
            ),
          ) * this.precisionMini;
        switch (this.genre) {
          case Enumere_Arrondi_1.EGenreArrondi.superieur:
            return (
              Math.ceil(
                parseFloat(
                  Number(aValeur / this.precision).toFixed(
                    TypeNote_1.TypeNote.decimalNotation,
                  ),
                ),
              ) * this.precision
            );
          case Enumere_Arrondi_1.EGenreArrondi.inferieur:
            return (
              Math.floor(
                parseFloat(
                  Number(aValeur / this.precision).toFixed(
                    TypeNote_1.TypeNote.decimalNotation,
                  ),
                ),
              ) * this.precision
            );
          case Enumere_Arrondi_1.EGenreArrondi.plusProche:
            return (
              Math.round(
                parseFloat(
                  Number(aValeur / this.precision).toFixed(
                    TypeNote_1.TypeNote.decimalNotation,
                  ),
                ),
              ) * this.precision
            );
          default:
            return aValeur;
        }
      }
      toType(aGenrePronote) {
        this.precision = [
          this.precisionMini,
          0.1,
          0.25,
          0.5,
          1,
          0.1,
          0.25,
          0.5,
          1,
        ][aGenrePronote];
        this.genre =
          parseInt(aGenrePronote) !== 0
            ? parseInt(aGenrePronote) <= 4
              ? Enumere_Arrondi_1.EGenreArrondi.superieur
              : Enumere_Arrondi_1.EGenreArrondi.plusProche
            : Enumere_Arrondi_1.EGenreArrondi.sans;
      }
      toString() {
        switch (this.genre) {
          case Enumere_Arrondi_1.EGenreArrondi.sans:
            return 0;
          case Enumere_Arrondi_1.EGenreArrondi.superieur:
            switch (this.precision) {
              case 0.1:
                return 1;
              case 0.25:
                return 2;
              case 0.5:
                return 3;
              case 1:
                return 4;
              default:
                return 0;
            }
          case Enumere_Arrondi_1.EGenreArrondi.plusProche:
            switch (this.precision) {
              case 0.1:
                return 5;
              case 0.25:
                return 6;
              case 0.5:
                return 7;
              case 1:
                return 8;
              default:
                return 0;
            }
          default:
            return 0;
        }
      }
      strPrecision() {
        const lTrads = ObjetTraduction_1.GTraductions.getTabValeurs('Arrondi');
        switch (this.precision) {
          case this.precisionMini:
            return lTrads[0];
          case 0.1:
            return lTrads[1];
          case 0.25:
            return lTrads[2];
          case 0.5:
            return lTrads[3];
          case 1.0:
            return lTrads[4];
        }
        return lTrads[0];
      }
      dupliquer() {
        const lArrondi = new TypeArrondi(0);
        lArrondi.precision = this.precision;
        lArrondi.genre = this.genre;
        return lArrondi;
      }
      toJSON() {
        const lJSON = {};
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] =
          TypeHttpVariable_1.TypeHttpVariable.TypeHttpArrondi;
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] = this.toString();
        return lJSON;
      }
    }
    exports.TypeArrondi = TypeArrondi;
  },
  fn: 'typearrondi.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeEnsembleNombre = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const MethodesTableau_1 = require('MethodesTableau');
    const Enumere_ChampsJSON_1 = require('Enumere_ChampsJSON');
    const TypeHttpVariable_1 = require('TypeHttpVariable');
    class TypeEnsembleNombre {
      constructor(aValeur) {
        this._set = new Set();
        this._cacheItems = null;
        this.clear();
        if (aValeur !== undefined) {
          this.add(aValeur);
        }
      }
      clear() {
        this._set = new Set();
        this._cacheItems = null;
        return this;
      }
      add(aValeur) {
        this._cacheItems = null;
        if (typeof aValeur === 'number') {
          this._set.add(aValeur);
        } else if (aValeur instanceof TypeEnsembleNombre) {
          aValeur.items().forEach((aVal) => {
            this._set.add(aVal);
          });
        } else if (MethodesObjet_1.MethodesObjet.isArray(aValeur)) {
          aValeur.forEach((aVal) => {
            if (typeof aVal === 'number') {
              this._set.add(aVal);
            }
          });
        }
        return this;
      }
      remove(aValeur) {
        this._cacheItems = null;
        if (typeof aValeur === 'number') {
          this._set.delete(aValeur);
        } else if (aValeur instanceof TypeEnsembleNombre) {
          aValeur.items().forEach((aVal) => {
            this._set.delete(aVal);
          });
        } else if (MethodesObjet_1.MethodesObjet.isArray(aValeur)) {
          aValeur.forEach((aVal) => {
            this._set.delete(aVal);
          });
        }
        return this;
      }
      contains(aValeur) {
        if (typeof aValeur === 'number') {
          return this._set.has(aValeur);
        }
        let lItems = null;
        if (aValeur instanceof TypeEnsembleNombre) {
          lItems = aValeur.items();
        } else if (MethodesObjet_1.MethodesObjet.isArray(aValeur)) {
          lItems = aValeur;
        }
        if (lItems) {
          if (lItems.length === 0) {
            return false;
          }
          return lItems.every((aVal) => {
            return this._set.has(aVal);
          });
        }
        return false;
      }
      intersect(aValeur) {
        const lSet = new Set();
        this._cacheItems = null;
        let lItems = null;
        if (aValeur instanceof TypeEnsembleNombre) {
          lItems = aValeur.items();
        } else if (MethodesObjet_1.MethodesObjet.isArray(aValeur)) {
          lItems = aValeur;
        } else {
        }
        if (lItems) {
          lItems.forEach((aVal) => {
            if (this._set.has(aVal)) {
              lSet.add(aVal);
            }
          });
          this._set = lSet;
        }
        return this;
      }
      get(aIndex) {
        const lItems = this.items();
        if (
          aIndex < 0 ||
          aIndex > lItems.length ||
          !MethodesObjet_1.MethodesObjet.isNumber(aIndex)
        ) {
          return null;
        }
        return lItems[aIndex];
      }
      indexOf(aValeur) {
        if (!this._set.has(aValeur)) {
          return -1;
        }
        return MethodesTableau_1.MethodesTableau.binaryIndexOf(
          this.items(),
          aValeur,
        );
      }
      items() {
        if (!this._cacheItems) {
          this._cacheItems = [];
          for (const lVal of this._set.values()) {
            this._cacheItems.push(lVal);
          }
          this._cacheItems.sort(_sort);
        }
        return this._cacheItems;
      }
      count() {
        return this._set.size;
      }
      each(aMethode, thisArg) {
        this.items().forEach((aItem, aIndex) => {
          aMethode.call(thisArg, aItem, aIndex);
        });
        return this;
      }
      dupliquer() {
        return new TypeEnsembleNombre(this);
      }
      toString() {
        let lResult = '',
          lNbDeSuite = 0,
          lValeur,
          lItems = this.items();
        for (let lIx = 1; lIx <= lItems.length; lIx++) {
          lValeur = lItems[lIx];
          if (lItems.length > lIx && lValeur === lItems[lIx - 1] + 1) {
            lNbDeSuite++;
          } else {
            if (lResult.length > 0) {
              lResult += ',';
            }
            if (lNbDeSuite > 0) {
              lResult += lItems[lIx - 1 - lNbDeSuite] + '..';
            }
            lResult += lItems[lIx - 1];
            lNbDeSuite = 0;
          }
        }
        return '[' + lResult + ']';
      }
      fromString(aChaine) {
        if (!aChaine || !aChaine.length || aChaine.length < 2) {
          return this;
        }
        aChaine = aChaine.substring(1, aChaine.length - 1);
        const T1 = aChaine.split(',');
        let T2, V1, V2;
        for (let I = 0; I < T1.length; I++) {
          T2 = T1[I].split('..');
          V1 = parseInt(T2[0], 10);
          V2 = parseInt(T2.length === 1 ? T2[0] : T2[1], 10);
          for (let J = V1; J <= V2; J++) {
            this._set.add(J);
          }
        }
        return this;
      }
      toJSON() {
        const lJSON = {};
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] =
          TypeHttpVariable_1.TypeHttpVariable.TypeHttpEnsembleNombre;
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] = this.toString();
        return lJSON;
      }
    }
    exports.TypeEnsembleNombre = TypeEnsembleNombre;
    function _sort(a, b) {
      return a < b ? -1 : a > b ? 1 : 0;
    }
  },
  fn: 'typeensemblenombre.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetJSON = void 0;
    require('DeclarationJQuery');
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_ChampsJSON_1 = require('Enumere_ChampsJSON');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const TypeHttpVariable_1 = require('TypeHttpVariable');
    const TypeDomaine_1 = require('TypeDomaine');
    const TypeArrondi_1 = require('TypeArrondi');
    const TypeEnsembleNombre_1 = require('TypeEnsembleNombre');
    const ObjetChaine_1 = require('ObjetChaine');
    const TypeNote_1 = require('TypeNote');
    const ObjetJSON = {
      parse(data, aParametres) {
        if (!data || typeof data !== 'string') {
          return null;
        }
        const lParametres = Object.assign(
          { ignorerEntites: false, JSONCollection: null },
          aParametres,
        );
        const lJSON = ObjetJSON.parseJSON(data);
        return ObjetJSON.parseVariables(lJSON, lParametres);
      },
      parseJSON(data) {
        let lJSON;
        try {
          lJSON = JSON.parse(data);
        } catch (e) {
          lJSON = null;
        }
        return lJSON;
      },
      parseVariables(aJSON, aParametres) {
        let lJSON;
        const lParametres = Object.assign(
          { ignorerEntites: false, JSONCollection: null },
          aParametres,
        );
        try {
          lJSON = _parseVariables(aJSON, lParametres);
        } catch (e) {
          lJSON = {};
        }
        return lJSON;
      },
      toJSON(aObjet, aParametres) {
        let lJSON;
        try {
          if (
            aParametres &&
            aParametres.ignorerEntites &&
            !aParametres.JSONCollection
          ) {
            lJSON = aObjet;
          } else {
            lJSON = ObjetJSON.preparerJSON(aObjet, aParametres);
          }
          return JSON.stringify(lJSON);
        } catch (e) {}
        return '';
      },
      preparerJSON(aObjet, aParametres) {
        const lChaine = JSON.stringify(aObjet);
        let lJSON = JSON.parse(lChaine);
        if (
          aParametres &&
          aParametres.ignorerEntites &&
          !aParametres.JSONCollection
        ) {
          return lJSON;
        }
        lJSON = _toJSON(lJSON, {
          ignorerEntites: !!(aParametres && aParametres.ignorerEntites),
          JSONCollection:
            aParametres && aParametres.JSONCollection
              ? aParametres.JSONCollection
              : null,
        });
        return lJSON;
      },
    };
    exports.ObjetJSON = ObjetJSON;
    function _parseElement(aJSON, aParametres) {
      const lElement = new ObjetElement_1.ObjetElement().fromJSON(aJSON);
      let lValeur;
      let lProp;
      if (aJSON) {
        if (lElement.Libelle) {
          lElement.Libelle = aParametres.ignorerEntites
            ? lElement.Libelle
            : ObjetChaine_1.GChaine.ajouterEntites(lElement.Libelle);
        }
        for (lProp in aJSON) {
          if (
            lProp !== ObjetElement_1.ObjetElement.const_JSON.libelle.JSON &&
            lProp !== ObjetElement_1.ObjetElement.const_JSON.numero.JSON &&
            lProp !== ObjetElement_1.ObjetElement.const_JSON.genre.JSON &&
            lProp !== ObjetElement_1.ObjetElement.const_JSON.position.JSON &&
            lProp !== ObjetElement_1.ObjetElement.const_JSON.actif.JSON
          ) {
            lValeur = aJSON[lProp];
            if (
              !_parseVariablesDeSource(lElement, lProp, lValeur, aParametres)
            ) {
              lElement[lProp] = lValeur;
            }
          }
        }
      }
      return lElement;
    }
    function _strToNote(aNote) {
      if (!TypeNote_1.TypeNote) {
        return null;
      }
      if (MethodesObjet_1.MethodesObjet.isArray(aNote)) {
        const T = [];
        for (const i in aNote) {
          T[i] = new TypeNote_1.TypeNote(aNote[i]);
        }
        return T;
      }
      return new TypeNote_1.TypeNote(aNote);
    }
    function _parseVariable(aJSON, aParametres) {
      if (!aJSON) {
        return null;
      }
      const lType = aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type];
      const lValeur = aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur];
      switch (lType) {
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpElement:
          if (MethodesObjet_1.MethodesObjet.isArray(lValeur)) {
            const lListeElements =
              new ObjetListeElements_1.ObjetListeElements();
            if (lValeur && lValeur.length) {
              for (let i = 0, lNb = lValeur.length; i < lNb; i++) {
                const lElement = _parseElement(lValeur[i], aParametres);
                lListeElements.addElement(lElement);
              }
            }
            return lListeElements;
          }
          return _parseElement(lValeur, aParametres);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpFichierBase64:
          if (
            aParametres &&
            aParametres.JSONCollection &&
            aParametres.JSONCollection.fichiers
          ) {
            const lFichierBase64 = aParametres.JSONCollection.fichiers[lValeur];
            aParametres.JSONCollection.fichiers[lValeur] = null;
            return lFichierBase64;
          }
          return '';
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpCardinal:
          return ObjetChaine_1.GChaine.strToCardinal(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpBoolean:
          return ObjetChaine_1.GChaine.strToBoolean(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpString:
          return ObjetChaine_1.GChaine.ajouterEntites(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpColor:
          return lValeur;
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpDateTime:
          return ObjetChaine_1.GChaine.strToDate(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpNote:
          return _strToNote(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpTraduction:
          return lValeur;
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpIP:
          return ObjetChaine_1.GChaine.strToIp(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpInteger:
          return ObjetChaine_1.GChaine.strToInteger(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpDouble:
          return ObjetChaine_1.GChaine.strToDouble(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpDomaine:
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpEnsemble:
          return new TypeDomaine_1.TypeDomaine(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpEnsembleCardinal:
          return new TypeDomaine_1.TypeDomaine(
            lValeur,
            TypeDomaine_1.TypeDomaine.CTailleOuverte,
          );
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpArrondi:
          return new TypeArrondi_1.TypeArrondi(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpHtml:
          return ObjetChaine_1.GChaine.htmlToSafeHtml(lValeur);
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpHtmlSafe:
          return lValeur;
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpEnsembleNombre:
          return new TypeEnsembleNombre_1.TypeEnsembleNombre().fromString(
            lValeur,
          );
        default:
          return lValeur;
      }
    }
    function _estVariable(aJSON) {
      if (
        aJSON &&
        aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] &&
        aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] !== undefined &&
        aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] >= 0
      ) {
        const lKeys = Object.keys(aJSON);
        if (
          lKeys.length === 2 &&
          ((lKeys[0] === Enumere_ChampsJSON_1.TypeChampsJSON.type &&
            lKeys[1] === Enumere_ChampsJSON_1.TypeChampsJSON.valeur) ||
            (lKeys[1] === Enumere_ChampsJSON_1.TypeChampsJSON.type &&
              lKeys[0] === Enumere_ChampsJSON_1.TypeChampsJSON.valeur))
        ) {
          return true;
        }
        return false;
      }
      return false;
    }
    function _estObjet(aValeur) {
      return aValeur && !aValeur.trim && typeof aValeur === 'object';
    }
    function _parseVariablesDeSource(
      aObjetResultat,
      aNomProprieteSource,
      aValeurSource,
      aParametres,
    ) {
      let lEstVariable;
      let lResult = true;
      if (MethodesObjet_1.MethodesObjet.isString(aValeurSource)) {
        aObjetResultat[aNomProprieteSource] = aParametres.ignorerEntites
          ? aValeurSource
          : ObjetChaine_1.GChaine.ajouterEntites(aValeurSource);
      } else if (_estObjet(aValeurSource)) {
        lEstVariable = false;
        if (!Array.isArray(aValeurSource)) {
          lEstVariable = _estVariable(aValeurSource);
        }
        aObjetResultat[aNomProprieteSource] = lEstVariable
          ? _parseVariable(aValeurSource, aParametres)
          : _parseVariables(aValeurSource, aParametres);
      } else {
        lResult = false;
      }
      return lResult;
    }
    function _parseVariables(aJSON, aParametres) {
      if (!aJSON) {
        return aJSON;
      }
      for (const i in aJSON) {
        _parseVariablesDeSource(aJSON, i, aJSON[i], aParametres);
      }
      return aJSON;
    }
    function _preparerVariableToJSON(aJSON, aParametres) {
      if (!aJSON) {
        return aJSON;
      }
      const lType = aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type];
      switch (lType) {
        case TypeHttpVariable_1.TypeHttpVariable.TypeHttpFichierBase64:
          if (aParametres && aParametres.JSONCollection) {
            if (!aParametres.JSONCollection.fichiers) {
              aParametres.JSONCollection.fichiers = [];
            }
            aParametres.JSONCollection.fichiers.push(
              aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur],
            );
            aJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] =
              aParametres.JSONCollection.fichiers.length - 1;
            return aJSON;
          }
          return aJSON;
        default:
          return aJSON;
      }
    }
    function _toJSON(aJSON, aParametres) {
      if (!aJSON) {
        return aJSON;
      }
      let lValeur;
      for (const i in aJSON) {
        lValeur = aJSON[i];
        if (lValeur) {
          if (typeof lValeur === 'string') {
            if (!aParametres.ignorerEntites) {
              aJSON[i] = ObjetChaine_1.GChaine.enleverEntites(lValeur);
            }
          } else if (_estVariable(lValeur)) {
            aJSON[i] = _preparerVariableToJSON(lValeur, aParametres);
          } else if (
            lValeur !== true &&
            !lValeur.MAX_VALUE &&
            !lValeur.getDate &&
            typeof lValeur === 'object'
          ) {
            aJSON[i] = _toJSON(lValeur, aParametres);
          }
        }
      }
      return aJSON;
    }
  },
  fn: 'objetjson.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    var _a;
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.setObjetDate =
      exports.REGEXP_TELEPHONE =
      exports.TAILLEMAX_INDICATIF_TELEPHONE =
      exports.REGEXP_INDICATIF_TELEPHONE =
      exports.MAX_LENGTH_Default =
      exports.C_eventsModifyInput =
      exports.C_eventsModifyCheckbox =
      exports.collectionIdentite =
      exports.outils =
      exports.empty =
      exports.injectHTMLParams =
      exports.injectHTML =
      exports.refresh =
      exports.ieData =
      exports.addClass =
      exports.addAttribut =
      exports.addBalise =
      exports.initControleur =
        void 0;
    require('DeclarationJQuery.js');
    const Divers_js_1 = require('Divers.js');
    require('jInputDisabled.js');
    require('jInputChecked.js');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const ControleSaisieEvenement_1 = require('ControleSaisieEvenement');
    const ObjetJSON_1 = require('ObjetJSON');
    const ObjetChaine_1 = require('ObjetChaine');
    const ToucheClavier_1 = require('ToucheClavier');
    const ObjetSupport_1 = require('ObjetSupport');
    const uBalises = {};
    const uAttributs = {};
    const uClassesCss = {};
    const uNodeNames = [];
    let lGUIDControleur1 = 1;
    let lGUIDControleur2 = 1;
    const C_id_event_iemodel = 'ie-model_verification';
    const C_RegExp_Match = /^\/(.*)\/([gim]*)$/;
    const uInvocateur = new Invocateur_1.ObjetInvocateur();
    let uTailleMaxTelephone = null;
    const lOutils = {
      nomInvocRefresh: '__refresh_node__',
      parseValueEvent: _parseValueEvent,
      getModel: _getModel,
      abonnerRefresh: _abonnerRefresh,
      getAccesParametres: _getAccesParametres,
      getAccesParametresModel: _getAccesParametresModel,
      injectHTML: _injectHTML,
      getContexteCourant: _getContexteCourant,
      getControleSaisieEvent: _getControleSaisieEvent,
      getAttributesDeNode: _getAttributesDeNode,
      getMapDeNode: _getMapDeNode,
      copyAttributs: _copyAttributs,
      gererInputCB: _gererInputCB,
      gererInputText: _gererInputText,
      addCommentaireDebug: _addCommentaireDebug,
      composantsAttributs: uAttributs,
      createSafeFragment: _createSafeFragment,
      caret: _caret,
      compile: _compile,
      addGetterHtml: _addGetterHtml,
      surInjectionHtml: _surInjectionHtml,
      surInjectionHtmlPromise: async function (aContexteCourant, aAfter) {
        return new Promise((aResolve, aReject) => {
          const lResult = lOutils.surInjectionHtml(
            aContexteCourant,
            () => {
              aResolve();
            },
            aAfter,
          );
          if (lResult !== true) {
            aReject();
          }
        });
      },
      surNodeEtNodeAfter(aContexteCourant) {
        const lInfosGetNode = this.getAccesParametres('node', aContexteCourant);
        if (lInfosGetNode && lInfosGetNode.estFonction) {
          this.surInjectionHtml(aContexteCourant, (...aArgs) => {
            lInfosGetNode.callback(aArgs);
          });
        }
        const lInfosGetNodeAfter = this.getAccesParametres(
          'nodeAfter',
          aContexteCourant,
        );
        if (lInfosGetNodeAfter && lInfosGetNodeAfter.estFonction) {
          this.surInjectionHtml(
            aContexteCourant,
            (...aArgs) => {
              lInfosGetNodeAfter.callback(aArgs);
            },
            true,
          );
        }
      },
      replaceNode(aNodeAncien, aNodeNouveau) {
        if (
          aNodeAncien &&
          aNodeNouveau &&
          aNodeAncien.parentNode &&
          aNodeAncien.parentNode.replaceChild
        ) {
          aNodeAncien.parentNode.replaceChild(aNodeNouveau, aNodeAncien);
          $(aNodeAncien).remove();
        }
      },
    };
    function _surInjectionHtml(aContexteCourant, aMethode, aAfter) {
      if (!aContexteCourant || !aContexteCourant.contexte) {
        return;
      }
      if (!aContexteCourant.contexte.eventsInjectionHtml) {
        aContexteCourant.contexte.eventsInjectionHtml = [];
      }
      if (MethodesObjet_1.MethodesObjet.isFunction(aMethode)) {
        if (aAfter) {
          aContexteCourant.contexte.eventsInjectionHtml.unshift({
            methode: aMethode,
            after: true,
          });
        } else {
          aContexteCourant.contexte.eventsInjectionHtml.push({
            methode: aMethode,
            after: false,
          });
        }
        return true;
      } else {
      }
    }
    async function _$refreshSelf_controleur(aForcerSynchrone) {
      if (
        this.instance &&
        _estInstanceIdentite(this.instance) &&
        this.instance.isDestroyed()
      ) {
        this.$promRefreshSelf = null;
        return Promise.resolve();
      }
      if (this.$asyncPromise !== false && !aForcerSynchrone) {
        if (this.$promRefreshSelf && !this.$promRefreshSelf._isFullfilled) {
          return this.$promRefreshSelf;
        }
        this.$promRefreshSelf = new Promise((aResolve) => {
          setTimeout(() => {
            if (this.$promRefreshSelf) {
              this.$promRefreshSelf._isFullfilled = true;
              this.$promRefreshSelf = null;
            }
            aResolve(this.$invocateur.evenement(C_id_event_iemodel));
          }, 0);
        });
        return this.$promRefreshSelf;
      }
      this.$invocateur.evenement(C_id_event_iemodel);
      return Promise.resolve();
    }
    async function _$refresh_controleur(aForcerSynchrone) {
      if (this.$asyncPromise !== false && !aForcerSynchrone) {
        if (this.$promRefresh && !this.$promRefresh._isFullfilled) {
          return this.$promRefresh;
        }
        this.$promRefresh = new Promise((aResolve) => {
          setTimeout(() => {
            this.$promRefresh._isFullfilled = true;
            this.$promRefresh = null;
            aResolve(uInvocateur.evenement(C_id_event_iemodel));
          }, 0);
        });
        return this.$promRefresh;
      }
      uInvocateur.evenement(C_id_event_iemodel);
      return Promise.resolve();
    }
    function _initControleur(aControleur) {
      if (!aControleur.$GUID) {
        aControleur.$GUID = lGUIDControleur1 + '_' + lGUIDControleur2;
        if (lGUIDControleur1 === Number.MAX_VALUE) {
          lGUIDControleur1 = 1;
          lGUIDControleur2 += 1;
        } else {
          lGUIDControleur1 += 1;
        }
      }
      if (!aControleur.$refreshSelf) {
        aControleur.$refreshSelf = _$refreshSelf_controleur;
      }
      if (!aControleur.$refresh) {
        aControleur.$refresh = _$refresh_controleur;
      }
      if (!aControleur.$invocateur) {
        aControleur.$invocateur = new Invocateur_1.ObjetInvocateur();
      }
      return aControleur;
    }
    function _transfererFragmentDansHTML(
      aNodesFragment,
      aParent,
      aInsererAvantLeNode,
    ) {
      const lTab = _sliceNodes(aNodesFragment);
      while (aNodesFragment && aNodesFragment.firstChild) {
        aNodesFragment.removeChild(aNodesFragment.firstChild);
      }
      if (lTab.length === 0) {
        return;
      }
      let lSafeFragment =
        lTab.length > 1 ? _createSafeFragment(document) : null;
      lTab.forEach((aNode) => {
        if (lSafeFragment) {
          lSafeFragment.appendChild(aNode);
        } else {
          if (aInsererAvantLeNode) {
            aParent.insertBefore(aNode, aInsererAvantLeNode);
          } else {
            aParent.appendChild(aNode);
          }
        }
      });
      if (lSafeFragment) {
        if (aInsererAvantLeNode) {
          aParent.insertBefore(lSafeFragment, aInsererAvantLeNode);
        } else {
          aParent.appendChild(lSafeFragment);
        }
        lSafeFragment = null;
      }
      let lNode = lTab[0];
      if (lTab[1] && _estNoeudCommentaire(lNode)) {
        lNode = lTab[1];
      }
      return lNode;
    }
    function _sliceNodes(aNodes) {
      return aNodes && aNodes.length ? Array.from(aNodes) : [];
    }
    function _preInjectionHTML(aElementParent, aIgnorerScroll) {
      const lResult = {
        elementParent: aElementParent,
        parentDocument: false,
        initOverflowParent: false,
      };
      let lElement = aElementParent;
      let lParent;
      while (!lResult.parentDocument && lElement) {
        lParent = null;
        if (lElement.nodeType === 1) {
          if (lElement.parentElement) {
            lParent = lElement.parentElement;
          } else if (lElement.parentNode) {
            lParent = lElement.parentNode;
          }
        }
        lElement = lParent;
        lResult.parentDocument = lElement === document;
      }
      if (lResult.parentDocument && aIgnorerScroll !== true) {
        let lOverflow = $(aElementParent).css('overflow');
        lResult.initOverflowParent =
          lOverflow === 'auto' || lOverflow === 'scroll';
        lOverflow = null;
      }
      return lResult;
    }
    function _finaliserInjectionHTML(aPreInjectionHtml, aContexte) {
      if (aPreInjectionHtml.parentDocument) {
        if (
          aPreInjectionHtml.initOverflowParent &&
          aPreInjectionHtml.elementParent
        ) {
          aPreInjectionHtml.elementParent.scrollLeft = 0;
          aPreInjectionHtml.elementParent.scrollTop = 0;
        }
        try {
          if (
            aContexte &&
            aContexte.eventsInjectionHtml &&
            aContexte.eventsInjectionHtml.length > 0
          ) {
            let lMeasures = [];
            let lMutates = [];
            const lEventsInjectionHtml = aContexte.eventsInjectionHtml;
            delete aContexte.eventsInjectionHtml;
            const lMeasureMutate = {
              addMeasure: function (aMethode) {
                lMeasures.push(aMethode);
              },
              addMutate: function (aMethode) {
                lMutates.push(aMethode);
              },
            };
            const lExec = function () {
              lMeasures.forEach((aMethode) => {
                if (aMethode) {
                  aMethode();
                }
              });
              lMutates.forEach((aMethode) => {
                if (aMethode) {
                  aMethode();
                }
              });
            };
            lEventsInjectionHtml.forEach((aElement) => {
              if (aElement && !aElement.after && aElement.methode) {
                aElement.methode(lMeasureMutate);
              }
            });
            lExec();
            lMeasures = [];
            lMutates = [];
            lEventsInjectionHtml.forEach((aElement) => {
              if (aElement && aElement.after && aElement.methode) {
                aElement.methode(lMeasureMutate);
              }
            });
            lExec();
          }
        } catch (e) {}
      }
    }
    function _findFirstChild(aNode, aNiveau) {
      let lNode = aNode;
      let lNiveau = aNiveau;
      while (lNode && lNiveau > 0) {
        lNode = lNode.firstChild;
        lNiveau -= 1;
      }
      return lNode;
    }
    function _getPremiereBalise(aChaine) {
      if (!aChaine || !aChaine.search) {
        return '';
      }
      let lPosDebut = aChaine.search('<');
      if (lPosDebut < 0) {
        return '';
      }
      lPosDebut += 1;
      const lChaine = aChaine.slice(lPosDebut);
      let lPosFinSup = lChaine.search('>');
      let lPosFinEsp = lChaine.search(' ');
      if (lPosFinSup < 0 && lPosFinEsp < 0) {
        return '';
      }
      if (lPosFinSup < 0) {
        lPosFinSup = lChaine.length;
      }
      if (lPosFinEsp < 0) {
        lPosFinEsp = lChaine.length;
      }
      return aChaine
        .slice(lPosDebut, lPosDebut + Math.min(lPosFinSup, lPosFinEsp))
        .toLowerCase();
    }
    function _createSafeFragment(aDocument) {
      const list = [].concat(uNodeNames),
        safeFrag = (aDocument || document).createDocumentFragment();
      if (safeFrag.createElement) {
        while (list.length) {
          safeFrag.createElement(list.pop());
        }
      }
      return safeFrag;
    }
    function _injectEtCompilNode(aParametres) {
      let lSafe = _createSafeFragment(document);
      let lNodeParent;
      let lNiveauFirstChild;
      lNodeParent = lSafe.appendChild(document.createElement('div'));
      if (aParametres.html && aParametres.html.nodeType > 0) {
        switch (aParametres.html.nodeName.toLowerCase()) {
          case 'td':
            lNodeParent.appendChild(document.createElement('table'));
            lNodeParent.firstChild.appendChild(document.createElement('tbody'));
            lNodeParent.firstChild.firstChild.appendChild(
              document.createElement('tr'),
            );
            lNodeParent = lNodeParent.firstChild.firstChild.firstChild;
            break;
          case 'tr':
            lNodeParent.appendChild(document.createElement('table'));
            lNodeParent = lNodeParent.firstChild;
            lNodeParent.appendChild(document.createElement('tbody'));
            lNodeParent = lNodeParent.firstChild;
            break;
          case 'ul':
            lNodeParent.appendChild(document.createElement('ul'));
            lNodeParent = lNodeParent.firstChild;
            break;
          default:
            lNodeParent.appendChild(document.createElement('div'));
            lNodeParent = lNodeParent.firstChild;
        }
        lNodeParent.appendChild(aParametres.html);
      } else {
        lNiveauFirstChild = 1;
        switch (_getPremiereBalise(aParametres.html)) {
          case 'td':
            lNodeParent.insertAdjacentHTML(
              'beforeend',
              '<table><tbody><tr>' + aParametres.html + '</tr></tbody></table>',
            );
            lNiveauFirstChild = 3;
            break;
          case 'tr':
            lNodeParent.insertAdjacentHTML(
              'beforeend',
              '<table><tbody>' + aParametres.html + '</tbody></table>',
            );
            lNiveauFirstChild = 2;
            break;
          case 'li':
            lNodeParent.insertAdjacentHTML(
              'beforeend',
              '<ul>' + aParametres.html + '</ul>',
            );
            break;
          default:
            lNodeParent.insertAdjacentHTML(
              'beforeend',
              '<div>' + aParametres.html + '</div>',
            );
        }
        lNodeParent = _findFirstChild(lNodeParent, lNiveauFirstChild);
      }
      if (!aParametres.contexte) {
        aParametres.contexte = {};
      }
      aParametres.childNodes = lNodeParent.childNodes;
      _compile(
        aParametres.childNodes,
        aParametres.element,
        aParametres.controleur,
        aParametres.contexte,
        aParametres.invocateur,
        0,
      );
      lNodeParent = null;
      lSafe = null;
    }
    function _injectHTML(aParametres) {
      let lNode = null;
      if (aParametres.controleur) {
        if (aParametres.instance && !aParametres.controleur.instance) {
          aParametres.controleur.instance = aParametres.instance;
        }
        _initControleur(aParametres.controleur);
      }
      if (!aParametres.element || aParametres.element.nodeType === undefined) {
        return null;
      }
      const lPreInjectionHtml = _preInjectionHTML(
        aParametres.element,
        aParametres.ignorerScroll,
      );
      _injectEtCompilNode(aParametres);
      lNode = _transfererFragmentDansHTML(
        aParametres.childNodes,
        aParametres.element,
        aParametres.insererAvantLeNode,
      );
      aParametres.childNodes = null;
      _finaliserInjectionHTML(lPreInjectionHtml, aParametres.contexte);
      return lNode;
    }
    function _remplirDataModel(aContexteCourant) {
      const lModele = aContexteCourant.node.getAttribute('ie-model');
      if (!lModele) {
        return null;
      }
      const lModeleArg = _parseValueEvent(lModele, aContexteCourant.contexte);
      if (lModeleArg && lModeleArg.nom) {
        aContexteCourant.data.$modeleParsed = lModeleArg;
        aContexteCourant.data.$modeleValue = lModele;
      }
      return true;
    }
    function _getModel(aContexteCourant) {
      const lAvecModele = _remplirDataModel(aContexteCourant);
      const lModele = aContexteCourant.data.$modeleValue;
      if (!lModele) {
        return null;
      }
      if (lAvecModele) {
        aContexteCourant.node.removeAttribute('ie-model');
        if (!aContexteCourant.ignorerCommentaires) {
          lOutils.addCommentaireDebug(
            aContexteCourant.node,
            'ie-model="' + lModele + '"',
          );
        }
      }
      return lModele;
    }
    function _getControleSaisieEvent(aContexteCourant) {
      if (!aContexteCourant.node.hasAttribute('ie-controlesaisie')) {
        return false;
      }
      aContexteCourant.node.removeAttribute('ie-controlesaisie');
      lOutils.addCommentaireDebug(aContexteCourant.node, 'ie-controleSaisie');
      return true;
    }
    function _callbackRefresh(aControleur, aData, aCallback) {
      if (aControleur && aControleur.$off && aControleur.$off()) {
        return;
      }
      try {
        aCallback();
      } catch (e) {}
    }
    function _abonnerRefresh(
      aCallback,
      aElementPourDestruction,
      aContexteCourant,
      aCallbackDestroy,
      aMutationObserverNoeudDetruit,
    ) {
      let lCallbacks = [];
      let lAjouterAbonnement = true;
      let lId;
      let lIdSelf;
      if (!aElementPourDestruction) {
        return;
      }
      if (aContexteCourant.data) {
        if (!aContexteCourant.data.$callbacksRefresh) {
          aContexteCourant.data.$callbacksRefresh = [];
        } else {
          lAjouterAbonnement = false;
        }
        lCallbacks = aContexteCourant.data.$callbacksRefresh;
      }
      lCallbacks.push(
        _callbackRefresh.bind(
          null,
          aContexteCourant.controleur,
          aContexteCourant.data,
          aCallback,
        ),
      );
      if (lAjouterAbonnement) {
        const lInvocateur = aContexteCourant.invocateur
          ? aContexteCourant.invocateur
          : uInvocateur;
        lId = lInvocateur.abonner(
          C_id_event_iemodel,
          () => {
            if (
              aContexteCourant.controleur &&
              aContexteCourant.controleur.instance &&
              _estInstanceIdentite(aContexteCourant.controleur.instance) &&
              aContexteCourant.controleur.instance.isDestroyed()
            ) {
              return;
            }
            const lNb = lCallbacks.length;
            for (let i = 0; i < lNb; i++) {
              lCallbacks[i]();
            }
          },
          null,
          false,
        );
        if (!aContexteCourant.invocateur && aContexteCourant.controleur) {
          lIdSelf = aContexteCourant.controleur.$invocateur.abonner(
            C_id_event_iemodel,
            () => {
              if (
                aContexteCourant.controleur &&
                aContexteCourant.controleur.instance &&
                _estInstanceIdentite(aContexteCourant.controleur.instance) &&
                aContexteCourant.controleur.instance.isDestroyed()
              ) {
                return;
              }
              const lNb = lCallbacks.length;
              for (let i = 0; i < lNb; i++) {
                lCallbacks[i]();
              }
            },
            null,
            false,
          );
        }
        let lDejaDetruit = false;
        let lObserver = null;
        const lDestroy = function () {
          if (lDejaDetruit) {
            return;
          }
          lInvocateur.desabonner([lId]);
          if (!aContexteCourant.invocateur && aContexteCourant.controleur) {
            aContexteCourant.controleur.$invocateur.desabonner([lIdSelf]);
          }
          if (aContexteCourant.data) {
            aContexteCourant.data.$destroy = true;
          }
          if (lObserver && lObserver.disconnect) {
            lObserver.disconnect();
            lObserver = null;
          }
          if (aCallbackDestroy) {
            aCallbackDestroy();
          }
          lDejaDetruit = true;
        };
        $(aElementPourDestruction).on('destroyed', lDestroy);
        if (aMutationObserverNoeudDetruit) {
          const lMutationObserver =
            window.MutationObserver ||
            window.WebKitMutationObserver ||
            window.MozMutationObserver;
          if (lMutationObserver) {
            lObserver = new lMutationObserver((mutations) => {
              mutations.every((mutation) => {
                if (!lDejaDetruit && mutation.type === 'childList') {
                  try {
                    if (aMutationObserverNoeudDetruit()) {
                      lDestroy();
                      return false;
                    }
                  } catch (e) {}
                }
                return true;
              });
            });
          }
          if (lObserver) {
            lObserver.observe(aElementPourDestruction, { childList: true });
          }
        }
      }
    }
    function _estInstanceIdentite(aInstance) {
      const lInstance = aInstance;
      return (
        lInstance &&
        lInstance.isDestroyed &&
        lInstance.setEtatSaisie &&
        typeof lInstance.isDestroyed === 'function' &&
        typeof lInstance.setEtatSaisie === 'function'
      );
    }
    function _getAccesParametres(
      aNomEnChaine,
      aContexteCourant,
      aAccepteErreur,
      aIgnorerNomOrigine,
    ) {
      let lParsed = null;
      const lResult = {
        valide: false,
        estFonction: false,
        nom: aNomEnChaine,
        args: [],
      };
      if (aNomEnChaine) {
        lParsed = _parseValueEvent(
          aNomEnChaine,
          aContexteCourant.contexte,
          aAccepteErreur,
        );
        if (lParsed) {
          aNomEnChaine = lParsed.nom;
        }
      }
      const lNomEnChaineOrigine = aNomEnChaine;
      if (
        aNomEnChaine &&
        (!aContexteCourant.data || !aContexteCourant.data.$modeleParsed)
      ) {
        if (!lParsed) {
          return lResult;
        }
      }
      let lAncreControleur = aContexteCourant.controleur;
      let lNom;
      if (aContexteCourant.data && aContexteCourant.data.$modeleParsed) {
        if (!lParsed || !lParsed.args || lParsed.args.length === 0) {
          lParsed = aContexteCourant.data.$modeleParsed;
        } else {
          lParsed.nom = aContexteCourant.data.$modeleParsed.nom;
        }
        if (aContexteCourant.data.$modeleParsed.nom) {
          aNomEnChaine = lParsed.nom + (aNomEnChaine ? '.' + aNomEnChaine : '');
        }
      }
      const lArgs = (lResult.args = lParsed ? lParsed.args : []);
      if (!aContexteCourant.controleur || !aNomEnChaine) {
        return lResult;
      }
      let lTab = aNomEnChaine.split('.');
      lNom = lTab.pop();
      lAncreControleur = MethodesObjet_1.MethodesObjet.get(
        aContexteCourant.controleur,
        lTab,
      );
      let lEstFonction =
        lAncreControleur &&
        lAncreControleur[lNom] !== undefined &&
        MethodesObjet_1.MethodesObjet.isFunction(lAncreControleur[lNom]);
      if (
        !lEstFonction &&
        aContexteCourant.data &&
        aContexteCourant.data.$modeleParsed &&
        !aIgnorerNomOrigine
      ) {
        const lTabHorsModele = lNomEnChaineOrigine.split('.');
        const lNomHorsModel = lTabHorsModele.pop();
        const lAncreControleurHorsModele = MethodesObjet_1.MethodesObjet.get(
          aContexteCourant.controleur,
          lTabHorsModele,
        );
        if (
          lAncreControleurHorsModele &&
          lAncreControleurHorsModele[lNom] !== undefined &&
          MethodesObjet_1.MethodesObjet.isFunction(
            lAncreControleurHorsModele[lNomHorsModel],
          )
        ) {
          lEstFonction = true;
          lAncreControleur = lAncreControleurHorsModele;
          lTab = lTabHorsModele;
          lNom = lNomHorsModel;
        }
      }
      const lTabRempli = lTab.length > 0;
      if (lEstFonction) {
        const lArgsCallback = lArgs || [];
        let lAvecArgsBoucleREPEAT = false;
        let lArray;
        for (let lIx = 0; lIx < lArgsCallback.length; lIx++) {
          if (lArgsCallback[lIx] && lArgsCallback[lIx].getterArray) {
            lAvecArgsBoucleREPEAT = true;
            break;
          }
        }
        lResult.valide = true;
        lResult.controleur = aContexteCourant.controleur;
        lResult.getAncre = function () {
          return lTabRempli
            ? MethodesObjet_1.MethodesObjet.get(
                aContexteCourant.controleur,
                lTab,
              )
            : aContexteCourant.controleur;
        };
        lResult.callback = function (aTabArguments) {
          var _a, _b;
          const lAncre = lTabRempli
            ? MethodesObjet_1.MethodesObjet.get(
                aContexteCourant.controleur,
                lTab,
              )
            : aContexteCourant.controleur;
          if (!lAncre || !lAncre[lNom] || !lAncre[lNom].apply) {
            return '';
          }
          let lArgs = lArgsCallback;
          let lArgCallback;
          if (lAvecArgsBoucleREPEAT) {
            lArgs = new Array(lArgsCallback.length);
            for (
              let lIx = 0, lLength = lArgsCallback.length;
              lIx < lLength;
              lIx++
            ) {
              lArgCallback = lArgsCallback[lIx];
              if (lArgCallback && lArgCallback.getterArray) {
                const lArgCallbackRepeat = lArgCallback;
                lArray = lArgCallbackRepeat.getterArray();
                lArgs[lIx] = {
                  indice: lArgCallbackRepeat.indice,
                  element: lArray[lArgCallbackRepeat.indice],
                  tableau: lArray,
                  arguments: lArgCallbackRepeat.arguments,
                };
              } else {
                lArgs[lIx] = lArgsCallback[lIx];
              }
            }
          }
          try {
            return lAncre[lNom].apply(
              aContexteCourant,
              aTabArguments && aTabArguments.length > 0
                ? lArgs.concat(aTabArguments)
                : lArgs,
            );
          } catch (e) {}
        };
        lResult.estFonction = true;
        lResult.nom = lNom;
        return lResult;
      }
      lResult.valide = !!MethodesObjet_1.MethodesObjet.get(
        aContexteCourant.controleur.instance,
        lTab,
      );
      lResult.getAncre = function () {
        return lTabRempli
          ? MethodesObjet_1.MethodesObjet.get(
              aContexteCourant.controleur.instance,
              lTab,
            )
          : aContexteCourant.controleur.instance;
      };
      lResult.getAncreControleur =
        lAncreControleur && lAncreControleur[lNom] !== undefined
          ? function () {
              return lTabRempli
                ? MethodesObjet_1.MethodesObjet.get(
                    aContexteCourant.controleur,
                    lTab,
                  )
                : aContexteCourant.controleur;
            }
          : null;
      lResult.callback = function () {
        const lAncre = lTabRempli
          ? MethodesObjet_1.MethodesObjet.get(
              aContexteCourant.controleur.instance,
              lTab,
            )
          : aContexteCourant.controleur.instance;
        if (!lAncre) {
          return '';
        }
        return lAncre[lNom];
      };
      lResult.estFonction = false;
      lResult.nom = lNom;
      return lResult;
    }
    function _getAccesParametresModel(
      aNomEnChaine,
      aContexteCourant,
      aAccepteErreur,
    ) {
      return _getAccesParametres(
        aNomEnChaine,
        aContexteCourant,
        aAccepteErreur,
        true,
      );
    }
    function _addCommentaireDebug(aNode, aCommentaire) {}
    function _estNoeudCommentaire(aNode) {
      return !!aNode && aNode.nodeType === 8;
    }
    function _getContexteCourant(
      aControleur,
      aContexte,
      aNode,
      aData,
      aInvocateur,
    ) {
      return {
        controleur: aControleur,
        instance: aControleur ? aControleur.instance : null,
        contexte: aContexte,
        data: aData,
        node: aNode,
        invocateur: aInvocateur,
        invocateurNode: new Invocateur_1.ObjetInvocateur(true),
      };
    }
    function _getAttributesDeNode(aNode) {
      return _sliceNodes(aNode.attributes);
    }
    function _getMapDeNode(aNode) {
      const lMap = {};
      for (
        let attr,
          nAttrs = _getAttributesDeNode(aNode),
          j = 0,
          jj = nAttrs && nAttrs.length;
        j < jj;
        j++
      ) {
        attr = nAttrs[j];
        if (attr.name) {
          const lName = attr.name.toLowerCase();
          lMap[lName] = attr.value;
        }
      }
      return lMap;
    }
    function _copyAttributs(aNodeSource, aNodeCible, aCallback) {
      const lMap = _getMapDeNode(aNodeSource);
      const lJCible = $(aNodeCible);
      for (const llName in lMap) {
        try {
          if (!aCallback || aCallback(llName, lMap[llName], lMap) !== false) {
            lJCible.attr(llName, lMap[llName]);
          }
        } catch (e) {}
      }
      return lMap;
    }
    function _addGetterHtml(aContexteCourant, aInfosParametres, aWrapperHtml) {
      const lNodeDestination =
        aContexteCourant.nodeTransfertContenuDynamique || aContexteCourant.node;
      const lGetter = function () {
        const lResult = aInfosParametres.callback([
          lNodeDestination,
          aContexteCourant.data,
        ]);
        if (MethodesObjet_1.MethodesObjet.isNumber(lResult)) {
          return lResult + '';
        }
        return (lResult || '') + '';
      };
      const lWrapperHtml =
        aWrapperHtml ||
        function (aHtml) {
          return aHtml;
        };
      const lHtml = lGetter();
      if (
        !aInfosParametres.estFonction &&
        !MethodesObjet_1.MethodesObjet.isString(lHtml)
      ) {
        return;
      }
      const lInvocateur = new Invocateur_1.ObjetInvocateur();
      $(lNodeDestination).empty();
      try {
        lNodeDestination.innerHTML = lWrapperHtml(lHtml);
      } catch (e) {
        $(lNodeDestination).html(lWrapperHtml(lHtml));
      }
      aContexteCourant.invocateurNode.evenement(lOutils.nomInvocRefresh, {
        refreshHtml: true,
        html: lHtml,
      });
      _compile(
        lNodeDestination.childNodes,
        lNodeDestination,
        aContexteCourant.controleur,
        aContexteCourant.contexte,
        lInvocateur,
      );
      let lOldHtmlValue = lHtml;
      _abonnerRefresh(
        () => {
          const lHtml = lGetter();
          if (lHtml !== lOldHtmlValue) {
            lOldHtmlValue = lHtml;
            IEHtml.empty(lNodeDestination);
            const lContexte = Object.assign({}, aContexteCourant.contexte);
            lContexte.eventsInjectionHtml = [];
            _injectHTML({
              element: lNodeDestination,
              html: lWrapperHtml(lHtml),
              controleur: aContexteCourant.controleur,
              contexte: lContexte,
              invocateur: lInvocateur,
            });
            aContexteCourant.invocateurNode.evenement(lOutils.nomInvocRefresh, {
              refreshHtml: true,
              html: lHtml,
            });
          } else {
            lInvocateur.evenement(C_id_event_iemodel);
          }
        },
        lNodeDestination,
        aContexteCourant,
      );
      return lNodeDestination;
    }
    function _parseArg(aArg, aEstChaine, aContexte) {
      if (aEstChaine) {
        return aArg;
      }
      if (aContexte && aContexte.repeat && aContexte.repeat[aArg]) {
        return aContexte.repeat[aArg];
      }
      if (aArg === 'null') {
        return null;
      }
      if (aArg === 'undefined') {
        return undefined;
      }
      if (aArg === 'true') {
        return true;
      }
      if (aArg === 'false') {
        return false;
      }
      let lNumber = parseInt(aArg, 10);
      if (isNaN(lNumber)) {
        lNumber = null;
        throw 'erreur _parseArg';
      }
      return lNumber;
    }
    function _parseValueEvent(aValue, aContexte, aSortieEnErreur) {
      if (!aValue) {
        return null;
      }
      const lResult = { nom: '', args: [] };
      let lEtat = 'rech_fonction';
      let lChar;
      let lNomFonction = '';
      let lArg = '';
      let LArgEstChaine = false;
      const lLength = aValue.length;
      const lSepDebut = '(';
      const lSepFin = ')';
      try {
        for (let lIPars = 0; lIPars < lLength; lIPars++) {
          lChar = aValue.charAt(lIPars);
          switch (lEtat) {
            case 'rech_fonction':
              if (lChar === lSepDebut || lIPars === lLength - 1) {
                lEtat = 'rech_param';
                if (lIPars === aValue.length - 1) {
                  lNomFonction += lChar;
                }
                lResult.nom = lNomFonction.trim();
                if (lResult.nom.length === 0) {
                  return null;
                }
                lArg = '';
              } else {
                lNomFonction += lChar;
              }
              break;
            case 'rech_param':
              if (lChar === lSepFin) {
                if (lIPars < lLength - 1) {
                  if (aValue.charAt(lIPars + 1) !== ';') {
                    throw 'erreur fermeture fonction';
                  }
                }
                lArg = lArg.trim();
                if (
                  LArgEstChaine ||
                  lArg.length > 0 ||
                  lResult.args.length > 0
                ) {
                  lResult.args.push(_parseArg(lArg, LArgEstChaine, aContexte));
                }
                lEtat = 'fin';
                break;
              }
              if (lChar === ',') {
                lResult.args.push(
                  _parseArg(lArg.trim(), LArgEstChaine, aContexte),
                );
                lArg = '';
                LArgEstChaine = false;
              } else if (lChar === "'") {
                if (lArg.trim().length > 0) {
                }
                lArg = '';
                lEtat = 'rech_chaine';
              } else {
                lArg += lChar;
              }
              break;
            case 'rech_chaine':
              if (
                lChar === "'" &&
                (aValue.charAt(lIPars + 1) === ')' ||
                  aValue.charAt(lIPars + 1) === ',')
              ) {
                lEtat = 'rech_param';
                LArgEstChaine = true;
                break;
              }
              lArg += lChar;
              break;
            case 'fin':
              if (lChar !== ';') {
                throw 'erreur fin fonction';
              }
              break;
            default:
              throw 'cas non géré';
          }
        }
      } catch (e) {
        if (aSortieEnErreur) {
          return null;
        }
      }
      return lResult;
    }
    function _positionnerObjetSelonAccesseur(aChaineAccesseur, aObjet) {
      if (!aObjet) {
        return null;
      }
      const lTab = aChaineAccesseur.split('.');
      let lResult = aObjet;
      for (let i = 0; i < lTab.length; i++) {
        lResult = lResult[lTab[i]];
        if (!lResult) {
          return null;
        }
      }
      return lResult;
    }
    function _caret(aElement, begin, end) {
      let range;
      if (!aElement) {
        return;
      }
      if (typeof begin === 'number') {
        end = typeof end === 'number' ? end : begin;
        const lValue = aElement.value;
        begin = Math.min(begin, lValue.length);
        end = Math.min(end, lValue.length);
        if (aElement.setSelectionRange) {
          aElement.setSelectionRange(begin, end);
        } else if (aElement.createTextRange) {
          range = aElement.createTextRange();
          range.collapse(true);
          range.moveEnd('character', end);
          range.moveStart('character', begin);
          range.select();
        }
      } else {
        if (aElement.setSelectionRange) {
          begin = aElement.selectionStart;
          end = aElement.selectionEnd;
        } else if (document.selection && document.selection.createRange) {
          range = document.selection.createRange();
          begin = 0 - range.duplicate().moveStart('character', -100000);
          end = begin + range.text.length;
        }
        return { begin: begin, end: end };
      }
    }
    function _verificationInputModel(
      aContexteCourant,
      aParametres,
      aPatternValidateRegex,
    ) {
      if (aParametres.data.$ignoreRefresh) {
        return;
      }
      let lValue;
      if (aParametres.getterValueInit) {
        if (aParametres.declencherExitChange) {
          if (aParametres.getterValue) {
            lValue = aParametres.getterValue();
          } else {
            return;
          }
        } else {
          lValue = aParametres.getterValueInit();
        }
      } else {
        if (!aParametres.getterValue) {
          return;
        }
        lValue = aParametres.getterValue();
      }
      let lValueInput;
      if (aParametres.saveValues.value !== lValue) {
        if (aParametres.estCB) {
          aParametres.eventActif = false;
          $(aParametres.node).inputChecked(lValue);
          aParametres.eventActif = true;
          aParametres.saveValues.value = aParametres.saveValues.inputValue =
            lValue;
        } else {
          aParametres.eventActif = false;
          lValueInput = lValue;
          if (aParametres.toDisplay) {
            lValueInput = aParametres.toDisplay(lValueInput);
          }
          if (aParametres.contentEditable) {
            aParametres.node.innerHTML = lValueInput;
          } else {
            aParametres.node.value = lValueInput;
          }
          aParametres.eventActif = true;
          if (aPatternValidateRegex) {
            const lAncreControleur = _positionnerObjetSelonAccesseur(
              aParametres.data.$modeleParsed.nom,
              aParametres.controleur,
            );
            if (lAncreControleur) {
              aContexteCourant.$patternOK = aPatternValidateRegex(lValue);
            }
          }
          aParametres.saveValues.value = lValue;
          aParametres.saveValues.inputValue = lValueInput;
        }
      } else {
        if (
          aParametres.estCB &&
          aContexteCourant.data &&
          aContexteCourant.data.estRadioBouton &&
          lValue !== $(aContexteCourant.node).is(':checked')
        ) {
          $(aParametres.node).inputChecked(lValue);
        }
        if (aParametres.toDisplay) {
          lValueInput = aParametres.toDisplay(lValue);
          if (aParametres.saveValues.inputValue !== lValueInput) {
            aParametres.eventActif = false;
            if (aParametres.contentEditable) {
              aParametres.node.innerHTML = lValueInput;
            } else {
              aParametres.node.value = lValueInput;
            }
            aParametres.eventActif = true;
          }
        }
      }
      if (aParametres.getterDisabled) {
        lValue = !!aParametres.getterDisabled();
        if (lValue !== aParametres.saveDisabled) {
          $(aParametres.node).inputDisabled(lValue);
          aParametres.saveDisabled = lValue;
        }
      }
      if (aParametres.getterReadOnly) {
        lValue = !!aParametres.getterReadOnly();
        if (lValue !== aParametres.saveReadOnly) {
          $(aParametres.node).prop('readonly', lValue);
          aParametres.saveReadOnly = lValue;
        }
      }
    }
    function _affecterGetterSetterInputModel(
      aParametres,
      aContexteCourant,
      aEstCB,
    ) {
      let lValue, lAncre;
      const lInfosGetValueInit = _getAccesParametresModel(
        'getValueInit',
        aContexteCourant,
      );
      if (lInfosGetValueInit.estFonction) {
        aParametres.getterValueInit = function () {
          const lValue = lInfosGetValueInit.callback([aParametres.node]);
          if (aEstCB) {
            return !!lValue;
          }
          return (lValue !== null && lValue !== void 0 ? lValue : '') + '';
        };
      }
      const lInfosGetValue = _getAccesParametresModel(
        'getValue',
        aContexteCourant,
      );
      const lInfosGetSetModele = _getAccesParametres('', aContexteCourant);
      if (lInfosGetValue.estFonction) {
        aParametres.getterValue = function () {
          const lValue = lInfosGetValue.callback([aParametres.node]);
          if (aEstCB) {
            return !!lValue;
          }
          return (lValue !== null && lValue !== void 0 ? lValue : '') + '';
        };
      } else if (!aParametres.getterValueInit) {
        lAncre = lInfosGetSetModele.getAncre();
        if (!lInfosGetSetModele.valide || !lAncre) {
          return false;
        }
        lValue = lAncre[lInfosGetSetModele.nom];
        if (lValue) {
          if (aEstCB && lValue !== true) {
            return false;
          }
          if (
            !aEstCB &&
            !MethodesObjet_1.MethodesObjet.isString(
              lAncre[lInfosGetSetModele.nom],
            )
          ) {
            return false;
          }
        }
        aParametres.getterValue = function () {
          const lValue = lInfosGetSetModele.callback();
          if (aEstCB) {
            return !!lValue;
          }
          return (lValue !== null && lValue !== void 0 ? lValue : '') + '';
        };
      }
      const lInfosSetValue = _getAccesParametresModel(
        'setValue',
        aContexteCourant,
      );
      if (lInfosSetValue.estFonction) {
        aParametres.setterValue = function (aValue, aParametresSetter) {
          return lInfosSetValue.callback([aValue, aParametresSetter]);
        };
      } else if (!aParametres.getterValueInit) {
        lAncre = lInfosGetSetModele.getAncre();
        if (!lInfosGetSetModele.valide || !lAncre) {
          return false;
        }
        aParametres.setterValue = function (aValue) {
          const lAncre = lInfosGetSetModele.getAncre();
          if (!lAncre) {
            return;
          }
          lAncre[lInfosGetSetModele.nom] = aValue;
        };
      }
      const lInfosGetDisabled = _getAccesParametresModel(
        'getDisabled',
        aContexteCourant,
      );
      if (lInfosGetDisabled.estFonction) {
        aParametres.getterDisabled = lInfosGetDisabled.callback.bind(null, [
          aParametres.node,
          aContexteCourant.data,
        ]);
      }
      const lInfosGetReadOnly = _getAccesParametresModel(
        'getReadOnly',
        aContexteCourant,
      );
      if (lInfosGetReadOnly.estFonction) {
        aParametres.getterReadOnly = lInfosGetReadOnly.callback.bind(null, [
          aParametres.node,
          aContexteCourant.data,
        ]);
      }
      const lInfosExitChange = _getAccesParametresModel(
        'exitChange',
        aContexteCourant,
      );
      if (lInfosExitChange.estFonction) {
        aParametres.infosExitChange = lInfosExitChange;
      }
      if (aParametres.getterValueInit && !aParametres.infosExitChange) {
        aParametres.getterValueInit = null;
      }
      const lInfosInterrompreEvent = _getAccesParametresModel(
        'interrompreEvent',
        aContexteCourant,
      );
      if (lInfosInterrompreEvent.estFonction) {
        aParametres.interrompreEvent = lInfosInterrompreEvent;
      }
      const lInfosNode = _getAccesParametresModel('node', aContexteCourant);
      if (lInfosNode.estFonction) {
        aParametres.infosNode = lInfosNode;
      }
      const lInfosNodeAfter = _getAccesParametresModel(
        'nodeAfter',
        aContexteCourant,
      );
      if (lInfosNodeAfter.estFonction) {
        aParametres.infosNodeAfter = lInfosNodeAfter;
      }
      const lInfoskeyupEnter = _getAccesParametresModel(
        'keyupEnter',
        aContexteCourant,
      );
      if (lInfoskeyupEnter.estFonction) {
        aParametres.infoskeyupEnter = lInfoskeyupEnter;
      }
      return true;
    }
    function _estNodeContentEditable(aNode) {
      if (
        aNode &&
        ObjetSupport_1.Support.contentEditable &&
        (aNode.isContentEditable || aNode.contentEditable === 'true')
      ) {
        const lNodeName = aNode.nodeName ? aNode.nodeName.toLowerCase() : '';
        return lNodeName !== 'input' && lNodeName !== 'textarea';
      }
      return false;
    }
    function _gererInputModele(
      aContexteCourant,
      aJNode,
      aEstCB,
      aAttributType,
      aMaxLength,
    ) {
      let lModele = null,
        lMask,
        lMatchMask,
        lPattern,
        lMatchPattern,
        lPatternValidateRegex,
        lTrim = false,
        lAvecAttrTrim = false,
        lValue = aEstCB ? false : '',
        lDisabled = false,
        lReadOnly = false,
        lInfosToDisplay = null,
        lInfosFromDisplay = null,
        lFuncExitChange = null,
        lEstTexteBrut = false;
      const lEstInputTime = aAttributType === 'time';
      const lSaveValues = {},
        lRefresh = aContexteCourant.contexte.refresh,
        lParametres = {
          node: aContexteCourant.node,
          controleur: aContexteCourant.controleur,
          data: aContexteCourant.data,
          estCB: aEstCB,
          saveValues: lSaveValues,
          eventActif: true,
          saveDisabled: false,
          getterValue: null,
          getterValueInit: null,
          setterValue: null,
          getterDisabled: null,
          getterReadOnly: null,
          toDisplay: null,
          fromDisplay: null,
          declencherExitChange: false,
          contentEditable: _estNodeContentEditable(aContexteCourant.node),
        };
      if (lParametres.contentEditable && aMaxLength > 0) {
        aMaxLength = 0;
      }
      if (aContexteCourant.node.hasAttribute('ie-etatsaisie')) {
        aContexteCourant.etatSaisie = true;
        aContexteCourant.node.removeAttribute('ie-etatsaisie');
        lOutils.addCommentaireDebug(aContexteCourant.node, 'ie-etatsaisie');
      }
      if (aContexteCourant.controleur) {
        lModele = _getModel(aContexteCourant);
        if (lModele) {
          Object.assign(lParametres, {
            modele: lModele,
            modeleArg: aContexteCourant.data.$modeleParsed,
          });
          if (
            !_affecterGetterSetterInputModel(
              lParametres,
              aContexteCourant,
              aEstCB,
            )
          ) {
            return;
          }
          if (lParametres.infosExitChange) {
            aContexteCourant.data.forceExitChange = function (aParametresExit) {
              if (lFuncExitChange) {
                lFuncExitChange(aParametresExit);
              }
            };
          }
          lValue = lParametres.getterValueInit
            ? lParametres.getterValueInit()
            : lParametres.getterValue();
          if (lParametres.getterDisabled) {
            lDisabled = lParametres.saveDisabled =
              !!lParametres.getterDisabled();
            aJNode.inputDisabled(lDisabled);
          }
          if (lParametres.getterReadOnly) {
            lReadOnly = lParametres.saveReadOnly =
              !!lParametres.getterReadOnly();
            aJNode.prop('readonly', lReadOnly);
          }
          if (aEstCB) {
            lValue = !!lValue;
            lSaveValues.value = lSaveValues.inputValue = lValue;
            aJNode.inputChecked(lValue);
          } else {
            lValue = lValue || '';
            lSaveValues.value = lSaveValues.inputValue = lValue;
            lAvecAttrTrim = aContexteCourant.node.hasAttribute('ie-trim');
            if (lAvecAttrTrim) {
              lOutils.addCommentaireDebug(aContexteCourant.node, 'ie-trim');
              aContexteCourant.node.removeAttribute('ie-trim');
            }
            lTrim =
              (aAttributType !== 'password' && lAvecAttrTrim) ||
              aContexteCourant.estIndicatifTelephone;
            if (lParametres.contentEditable) {
              lEstTexteBrut = true;
            } else if (
              aContexteCourant.estTelephone ||
              aContexteCourant.estIndicatifTelephone ||
              aAttributType === 'password' ||
              aAttributType === 'email'
            ) {
              lEstTexteBrut = true;
            } else if (aContexteCourant.node.hasAttribute('ie-textbrut')) {
              lEstTexteBrut = true;
              aContexteCourant.node.removeAttribute('ie-textbrut');
              lOutils.addCommentaireDebug(aContexteCourant.node, 'ie-textbrut');
            }
            if (!uTailleMaxTelephone) {
              uTailleMaxTelephone = ObjetChaine_1.GChaine.maskTelephone.replace(
                / /g,
                '',
              ).length;
            }
            lInfosToDisplay = _getAccesParametresModel(
              'toDisplay',
              aContexteCourant,
            );
            lInfosFromDisplay = _getAccesParametresModel(
              'fromDisplay',
              aContexteCourant,
            );
            lParametres.toDisplay = function (aChaine) {
              if (!lEstTexteBrut) {
                aChaine = ObjetChaine_1.GChaine.enleverEntites(aChaine);
              }
              if (aContexteCourant.estIndicatifTelephone) {
                aChaine =
                  '+ ' +
                  aChaine
                    .replace(IEHtml.REGEXP_INDICATIF_TELEPHONE, '')
                    .slice(0, IEHtml.TAILLEMAX_INDICATIF_TELEPHONE);
              }
              if (
                aContexteCourant.estTelephone &&
                ObjetChaine_1.GChaine &&
                ObjetChaine_1.GChaine.formatTelephone
              ) {
                aChaine = ObjetChaine_1.GChaine.formatTelephone(
                  aChaine
                    .replace(IEHtml.REGEXP_TELEPHONE, '')
                    .slice(0, uTailleMaxTelephone),
                );
              }
              if (lInfosToDisplay && lInfosToDisplay.estFonction) {
                aChaine = lInfosToDisplay.callback([
                  aChaine,
                  aContexteCourant.data,
                ]);
              }
              return aChaine;
            };
            lParametres.fromDisplay = function (aChaine) {
              if (lInfosFromDisplay && lInfosFromDisplay.estFonction) {
                aChaine = lInfosFromDisplay.callback([
                  aChaine,
                  aContexteCourant.data,
                ]);
              }
              if (!lEstTexteBrut) {
                aChaine = ObjetChaine_1.GChaine.ajouterEntites(aChaine);
              }
              if (lTrim && aChaine.trim) {
                aChaine = aChaine.trim();
              }
              if (aContexteCourant.estIndicatifTelephone) {
                aChaine = aChaine
                  .replace(/\+| /g, '')
                  .replace(IEHtml.REGEXP_INDICATIF_TELEPHONE, '')
                  .slice(0, IEHtml.TAILLEMAX_INDICATIF_TELEPHONE);
              }
              if (aContexteCourant.estTelephone) {
                aChaine = aChaine
                  .replace(/ /g, '')
                  .replace(IEHtml.REGEXP_TELEPHONE, '')
                  .slice(0, uTailleMaxTelephone);
              }
              return aChaine;
            };
            lValue = lSaveValues.inputValue = lParametres.toDisplay(lValue);
            if (lParametres.contentEditable) {
              aContexteCourant.node.innerHTML = lValue;
            } else {
              aContexteCourant.node.value = lValue;
            }
            lPattern = aContexteCourant.node.getAttribute('ie-pattern');
            lMatchPattern =
              lPattern && lPattern.match
                ? lPattern.match(C_RegExp_Match)
                : null;
            if (lMatchPattern) {
              const lRegExp = new RegExp(lMatchPattern[1], lMatchPattern[2]);
              lPatternValidateRegex = function (value) {
                return !value || lRegExp.test(value);
              };
              aContexteCourant.$patternOK = lPatternValidateRegex(
                lSaveValues.inputValue,
              );
            }
            if (lPattern) {
              lOutils.addCommentaireDebug(
                aContexteCourant.node,
                'ie-pattern="' + lPattern + '"',
              );
              aContexteCourant.node.removeAttribute('ie-pattern');
            }
          }
        }
      }
      if (!aEstCB) {
        lMask = aContexteCourant.node.getAttribute('ie-mask');
        if (lMask) {
          lOutils.addCommentaireDebug(
            aContexteCourant.node,
            'ie-mask="' + lMask + '"',
          );
          aContexteCourant.node.removeAttribute('ie-mask');
          if (lParametres.contentEditable) {
            lMask = '';
          }
        }
        if (lMask && !lModele) {
          lSaveValues.value = aContexteCourant.node.value;
        }
        lMatchMask = lMask && lMask.match ? lMask.match(C_RegExp_Match) : null;
      }
      if (lModele) {
        _abonnerRefresh(
          () => {
            _verificationInputModel(
              aContexteCourant,
              lParametres,
              lPatternValidateRegex,
            );
          },
          aContexteCourant.node,
          aContexteCourant,
        );
      }
      if (lModele || (!aEstCB && (lMatchMask || aMaxLength))) {
        aJNode.on(
          aEstCB ? IEHtml.C_eventsModifyCheckbox : IEHtml.C_eventsModifyInput,
          function (aEvent) {
            if (!lParametres.eventActif) {
              return;
            }
            let lNewValue = null,
              lNewInputValue = null,
              lValueInput,
              lCaret = null;
            if (aEstCB) {
              lNewValue = $(this).is(':checked');
            } else {
              lValueInput = lParametres.contentEditable
                ? this.innerHTML
                : this.value;
              lNewValue = lValueInput;
              lNewInputValue = lNewValue;
              if (
                lParametres.interrompreEvent &&
                lParametres.interrompreEvent.callback([aEvent])
              ) {
                return false;
              }
              if (
                aMaxLength > 0 &&
                lNewValue.length > aMaxLength &&
                !lParametres.contentEditable
              ) {
                const lTop = $(this).scrollTop();
                this.value = lNewValue = lNewValue.slice(0, aMaxLength);
                $(this).scrollTop(lTop);
              }
              if (lMatchMask && lNewValue.length > 0) {
                let lSanitize = '';
                let lCharMask = '';
                const lRegExpMask = new RegExp(lMatchMask[1], lMatchMask[2]);
                for (let lIx = 0; lIx < lNewValue.length; lIx++) {
                  lCharMask = lNewValue.charAt(lIx);
                  if (!lRegExpMask.test(lCharMask)) {
                    lSanitize += lCharMask;
                  }
                }
                if (lParametres.fromDisplay) {
                  lNewValue = lParametres.fromDisplay(lNewValue);
                }
                if (lSanitize !== lNewValue) {
                  const lNomProp = lParametres.contentEditable
                    ? 'innerHTML'
                    : 'value';
                  if (lSanitize === lSaveValues.value) {
                    if (lParametres.toDisplay) {
                      this[lNomProp] = lParametres.toDisplay(lSaveValues.value);
                    } else {
                      this[lNomProp] = lSaveValues.value;
                    }
                    return false;
                  }
                  lNewValue = lSanitize;
                  lNewInputValue = lSanitize;
                  if (lParametres.toDisplay) {
                    this[lNomProp] = lNewInputValue =
                      lParametres.toDisplay(lNewValue);
                  } else {
                    this[lNomProp] = lNewValue;
                  }
                }
              } else if (lParametres.fromDisplay) {
                lNewValue = lParametres.fromDisplay(lNewValue);
              }
              if (lParametres.toDisplay) {
                lNewInputValue = lParametres.toDisplay(lNewValue);
                if (
                  (lTrim && lNewInputValue.trim() !== lValueInput.trim()) ||
                  (!lTrim && lNewInputValue !== lValueInput)
                ) {
                  lCaret = null;
                  if (aContexteCourant.estTelephone) {
                    lCaret = _caret(this);
                    if (lValueInput.length < lSaveValues.inputValue.length) {
                      lCaret.begin = Math.max(
                        0,
                        lCaret.begin -
                          (lSaveValues.inputValue.length -
                            lNewInputValue.length) +
                          1,
                      );
                      if (lNewInputValue.charAt(lCaret.begin - 1) === ' ') {
                        lCaret.begin -= 1;
                      }
                      lCaret.change = true;
                    } else {
                      if (
                        lNewInputValue.length < lSaveValues.inputValue.length
                      ) {
                        lCaret.begin -=
                          lValueInput.length - lNewInputValue.length + 1;
                      }
                      if (lNewInputValue === lSaveValues.inputValue) {
                        lCaret.begin -=
                          lValueInput.length - lNewInputValue.length;
                      } else if (
                        lNewInputValue.charAt(lCaret.begin - 1) === ' '
                      ) {
                        lCaret.begin += 1;
                      } else if (
                        lNewInputValue.length > lSaveValues.inputValue.length &&
                        lCaret.begin > lSaveValues.inputValue.length
                      ) {
                        lCaret.begin = lNewInputValue.length;
                      }
                      lCaret.change = true;
                    }
                  }
                  if (lParametres.contentEditable) {
                    this.innerHTML = lNewInputValue;
                  } else {
                    this.value = lNewInputValue;
                  }
                  if (lCaret && lCaret.change) {
                    _caret(this, lCaret.begin);
                  }
                }
              }
            }
            if (lSaveValues.value !== lNewValue) {
              let lPatternOK, lCloneSave;
              if (lModele) {
                lPatternOK = true;
                if (lPatternValidateRegex) {
                  lPatternOK = lPatternValidateRegex(lNewValue);
                  aContexteCourant.$patternOK = lPatternOK;
                }
                lCloneSave =
                  MethodesObjet_1.MethodesObjet.dupliquer(lSaveValues);
              }
              lParametres.declencherExitChange = true;
              lSaveValues.value = lNewValue;
              lSaveValues.inputValue = lNewInputValue;
              if (aContexteCourant.etatSaisie) {
                if (
                  aContexteCourant.controleur &&
                  aContexteCourant.controleur.instance &&
                  _estInstanceIdentite(aContexteCourant.controleur.instance)
                ) {
                  aContexteCourant.controleur.instance.setEtatSaisie(true);
                } else {
                  Invocateur_1.Invocateur.evenement(
                    Invocateur_1.ObjetInvocateur.events.etatSaisie,
                    true,
                  );
                }
              }
              if (lModele) {
                const lParametresSetValue = {
                  node: this,
                  event: aEvent,
                  value: lNewValue,
                  inputValue: lNewInputValue,
                  textBrut: lEstTexteBrut,
                  oldValues: lCloneSave,
                  patternOK: lPatternOK,
                  selectionTexte: false,
                };
                if (lEstInputTime && uFuncDate.parseHeureMinute) {
                  lParametresSetValue.time =
                    uFuncDate.parseHeureMinute(lNewValue);
                }
                if (lParametres.setterValue) {
                  lParametres.setterValue(lNewValue, lParametresSetValue);
                }
                aContexteCourant.data.$ignoreRefresh = true;
                try {
                  lRefresh();
                } finally {
                  delete aContexteCourant.data.$ignoreRefresh;
                }
                if (aContexteCourant.data.$destroy === true) {
                  return;
                }
                _verificationInputModel(aContexteCourant, lParametres);
                if (lParametresSetValue.selectionTexte && !aEstCB) {
                  aContexteCourant.node.select();
                }
              }
            }
          },
        );
      }
      if (lTrim) {
        aJNode.on('change blur', function () {
          const lValue = lParametres.contentEditable
            ? this.innerHTML
            : this.value;
          const lValueTrim = lValue.trim();
          if (lValueTrim !== lValue) {
            lSaveValues.value = lValueTrim;
            lSaveValues.inputValue = lValueTrim;
            if (lParametres.contentEditable) {
              this.innerHTML = lValueTrim;
            } else {
              this.value = lValueTrim;
            }
          }
        });
      }
      if (lParametres.infosExitChange) {
        lFuncExitChange = function (aParamsExit) {
          const lParametresExitChange = Object.assign(aParamsExit || {}, {
            data: aContexteCourant.data,
            event: null,
          });
          let lValue = lSaveValues.value;
          if (lEstInputTime && uFuncDate.parseHeureMinute) {
            const lTime = uFuncDate.parseHeureMinute(lSaveValues.value);
            lParametresExitChange.time = lTime;
            const lStepStr = aContexteCourant.node.getAttribute('step');
            if (lStepStr) {
              const lStepInputTime_enM = Math.floor(
                parseInt(lStepStr, 10) / 60,
              );
              if (lStepInputTime_enM > 0) {
                const lReste = lTime.minute % lStepInputTime_enM;
                if (lReste <= lStepInputTime_enM / 2) {
                  lTime.minute = lTime.minute - lReste;
                } else {
                  lTime.minute = lTime.minute + (lStepInputTime_enM - lReste);
                }
              }
            }
            const lMinInputTimeStr = aContexteCourant.node.getAttribute('min');
            if (lMinInputTimeStr) {
              const lTimeMin = uFuncDate.parseHeureMinute(lMinInputTimeStr);
              if (lTimeMin.ok) {
                if (lTimeMin.heure > lTime.heure) {
                  lTime.heure = lTimeMin.heure;
                  lTime.minute = lTimeMin.minute;
                } else if (
                  lTimeMin.heure === lTime.heure &&
                  lTimeMin.minute > lTime.minute
                ) {
                  lTime.minute = lTimeMin.minute;
                }
              }
            }
            const lMaxInputTimeStr = aContexteCourant.node.getAttribute('max');
            if (lMaxInputTimeStr) {
              const lTimeMax = uFuncDate.parseHeureMinute(lMaxInputTimeStr);
              if (lTimeMax.ok) {
                if (lTime.heure > lTimeMax.heure) {
                  lTime.heure = lTimeMax.heure;
                  lTime.minute = lTimeMax.minute;
                } else if (
                  lTime.heure === lTimeMax.heure &&
                  lTime.minute > lTimeMax.minute
                ) {
                  lTime.minute = lTimeMax.minute;
                }
              }
            }
            const lDateModif = new Date();
            lDateModif.setHours(lTime.heure);
            lDateModif.setMinutes(lTime.minute);
            lValue = uFuncDate.formatDate(lDateModif, '%hh:%mm');
          }
          lParametres.infosExitChange.callback([lValue, lParametresExitChange]);
          _verificationInputModel(
            aContexteCourant,
            lParametres,
            lPatternValidateRegex,
          );
          lRefresh();
          if (lParametresExitChange.selectionTexte && !aEstCB) {
            aContexteCourant.node.select();
          }
        };
        let lEventsExitChange = 'blur focusout';
        if (!lEstInputTime) {
          lEventsExitChange += ' change';
        }
        aJNode.on(lEventsExitChange, (aEvent) => {
          if (!lParametres.declencherExitChange) {
            return;
          }
          lParametres.declencherExitChange = false;
          lFuncExitChange(aEvent);
        });
      }
      if (lParametres.infosNode) {
        lOutils.surInjectionHtml(aContexteCourant, (...aParams) => {
          lParametres.infosNode.callback(aParams);
        });
      }
      if (lParametres.infosNodeAfter) {
        lOutils.surInjectionHtml(
          aContexteCourant,
          (...aParams) => {
            lParametres.infosNodeAfter.callback(aParams);
          },
          true,
        );
      }
      if (lParametres.infoskeyupEnter) {
        aJNode.on('keyup', (aEvent) => {
          if (aEvent.which === ToucheClavier_1.ToucheClavier.RetourChariot) {
            lParametres.infoskeyupEnter.callback([aEvent]);
            lRefresh();
          }
        });
      }
      if (
        !aEstCB &&
        IE.estMobile &&
        aJNode.is(
          'input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], input[type=date], input[type=time], textarea',
        )
      ) {
        aJNode.on({
          focus() {
            _findElementPourGererActive_mobile(this).addClass('active');
          },
          blur() {
            if (
              this.value.length === 0 &&
              !aContexteCourant.node.getAttribute('placeholder')
            ) {
              _findElementPourGererActive_mobile(this).removeClass('active');
            }
          },
          'change input'() {
            if (
              this.value.length !== 0 ||
              aContexteCourant.node.getAttribute('placeholder')
            ) {
              _findElementPourGererActive_mobile(this).addClass('active');
            }
          },
        });
      }
    }
    function _findElementPourGererActive_mobile(aNode) {
      return $(aNode).closest('.input-field').find('>label, >.prefix');
    }
    function _gererInputCB(aContexteCourant, aAttributType) {
      _gererInputModele(
        aContexteCourant,
        $(aContexteCourant.node),
        true,
        aAttributType,
      );
    }
    function _gererMaxLengthInputText(
      aContexteCourant,
      aNode,
      aJNode,
      aEstInput,
      aAttributType,
    ) {
      const lAttrMaxLength = aNode.getAttribute('maxlength');
      let lMaxLength = 0;
      if (aEstInput) {
        if (
          aContexteCourant.estIndicatifTelephone ||
          aContexteCourant.estTelephone
        ) {
          return;
        }
        if (IEHtml.MAX_LENGTH_Default === 0) {
          return;
        }
        if (
          !lAttrMaxLength &&
          (aAttributType === 'text' ||
            aAttributType === '' ||
            aAttributType === 'number' ||
            aAttributType === 'email' ||
            aAttributType === 'url')
        ) {
          aJNode.attr('maxlength', IEHtml.MAX_LENGTH_Default);
        } else if (parseInt(lAttrMaxLength, 10) === 0) {
          aNode.removeAttribute('maxlength');
        }
      } else {
        lMaxLength = lAttrMaxLength
          ? parseInt(lAttrMaxLength, 10)
          : IEHtml.MAX_LENGTH_Default;
        if (isNaN(lMaxLength)) {
          lMaxLength = IEHtml.MAX_LENGTH_Default;
        }
      }
      return lMaxLength;
    }
    function _actualiserClassScrollTextArea(aNode) {
      if (aNode.scrollHeight > aNode.offsetHeight) {
        $(aNode).addClass('has-scroll');
      } else {
        $(aNode).removeClass('has-scroll');
      }
    }
    function _gererInputText(aContexteCourant, aAttributType) {
      let lJNode = $(aContexteCourant.node);
      const lEstInput = aContexteCourant.nodeName === 'input';
      const lEstTextArea = aContexteCourant.nodeName === 'textarea';
      if (lEstInput && aContexteCourant.node.hasAttribute('ie-indicatiftel')) {
        aContexteCourant.estIndicatifTelephone = true;
        lJNode.addClass('ie-indicatiftel');
        lOutils.addCommentaireDebug(aContexteCourant.node, 'ie-indicatiftel');
        aContexteCourant.node.removeAttribute('ie-indicatiftel');
      } else if (
        lEstInput &&
        aContexteCourant.node.hasAttribute('ie-telephone')
      ) {
        aContexteCourant.estTelephone = true;
        lJNode.addClass('ie-telephone');
        lOutils.addCommentaireDebug(aContexteCourant.node, 'ie-telephone');
        aContexteCourant.node.removeAttribute('ie-telephone');
      }
      const lMaxLength =
        lEstInput || lEstTextArea
          ? _gererMaxLengthInputText(
              aContexteCourant,
              aContexteCourant.node,
              lJNode,
              lEstInput,
              aAttributType,
            )
          : 0;
      if (lEstInput && aAttributType === 'time') {
        aContexteCourant.node.setAttribute('ie-mask', '/[^0-9:]/i');
        if (IE.estMobile) {
          aContexteCourant.node.setAttribute('pattern', '[0-9]{2}:[0-9]{2}');
        }
        aContexteCourant.node.setAttribute('size', '3');
      }
      if (lEstInput || lEstTextArea || aContexteCourant.data.$modeleValue) {
        _gererInputModele(
          aContexteCourant,
          lJNode,
          false,
          aAttributType,
          lMaxLength,
        );
      }
      if (lEstTextArea) {
        lOutils.surInjectionHtml(
          aContexteCourant,
          () => {
            _actualiserClassScrollTextArea(aContexteCourant.node);
          },
          true,
        );
        _abonnerRefresh(
          () => {
            _actualiserClassScrollTextArea(aContexteCourant.node);
          },
          aContexteCourant.node,
          aContexteCourant,
        );
        $(aContexteCourant.node).on(IEHtml.C_eventsModifyInput, function () {
          _actualiserClassScrollTextArea(this);
        });
      }
      lJNode = null;
    }
    function _getDataDeNode(aNode) {
      const lNodeValue = aNode.getAttribute('ie-data');
      let lData = null;
      if (
        lNodeValue &&
        lNodeValue.length > 2 &&
        lNodeValue.charAt(0) === '{' &&
        lNodeValue.charAt(lNodeValue.length - 1) === '}'
      ) {
        try {
          lData = ObjetJSON_1.ObjetJSON.parse(lNodeValue, {
            ignorerEntites: true,
          });
        } catch (e) {
          lData = null;
        }
      }
      return lData;
    }
    function _traiterIF(aNode, aNodeParent, aControleur, aContexte, aData) {
      const lValueAttr = aNode.getAttribute('ie-if');
      aNode.removeAttribute('ie-if');
      if (!lValueAttr) {
        return true;
      }
      if (!aControleur) {
        return true;
      }
      const lContexteCourant = _getContexteCourant(
        aControleur,
        aContexte,
        aNode,
        Object.assign({}, aData),
      );
      _remplirDataModel(lContexteCourant);
      const lInfos = _getAccesParametres(lValueAttr, lContexteCourant);
      const lValue = !!lInfos.callback();
      let lOldValue = lValue;
      const lChaineData = 'ie-if';
      const lNodeComm = document.createComment(lChaineData);
      const lCloneModele = aNode.cloneNode(true);
      aNode.parentNode.insertBefore(lNodeComm, aNode);
      const lInvocateur = new Invocateur_1.ObjetInvocateur();
      _abonnerRefresh(
        () => {
          const lValue = !!lInfos.callback();
          if (lOldValue !== lValue) {
            lOldValue = lValue;
            if (lValue) {
              const lParams = {
                element: aNodeParent,
                html: lCloneModele.cloneNode(true),
                controleur: aControleur,
                contexte: aContexte,
                invocateur: lInvocateur,
                childNodes: null,
              };
              const lPreInjectionHtml = _preInjectionHTML(aNodeParent, null);
              _injectEtCompilNode(lParams);
              _transfererFragmentDansHTML(
                lParams.childNodes,
                aNodeParent,
                lNodeComm.nextSibling,
              );
              _finaliserInjectionHTML(lPreInjectionHtml, aContexte);
              lParams.childNodes = null;
            } else {
              while (
                lNodeComm.nextSibling &&
                _estNoeudCommentaire(lNodeComm.nextSibling)
              ) {
                $(lNodeComm.nextSibling).remove();
              }
              if (lNodeComm.nextSibling) {
                $(lNodeComm.nextSibling).remove();
              }
            }
          } else {
            lInvocateur.evenement(C_id_event_iemodel);
          }
        },
        aNodeParent,
        lContexteCourant,
        null,
        () => {
          if (
            aNodeParent &&
            aNodeParent.contains &&
            !aNodeParent.contains(lNodeComm)
          ) {
            return true;
          }
          return false;
        },
      );
      if (!lValue) {
        $(aNode).remove();
      }
      return lValue;
    }
    function _addNodeDeREPEAT(
      aNodeParent,
      aControleur,
      aCloneModele,
      aNomVariableBoucle,
      aIndice,
      aInfosAcces,
      aNodeComm,
      aContexte,
      aArrayNodes,
      aInvocateur,
      aInitialisationRepeat,
    ) {
      let lNodeAvant;
      lNodeAvant = aNodeComm;
      if (aIndice > 0) {
        lNodeAvant = aArrayNodes[aIndice - 1];
      }
      if (!aContexte.repeat) {
        aContexte.repeat = {};
      }
      const lContexte = Object.assign({}, aContexte),
        lContexteBoucles = {};
      if (!lContexte.eventsInjectionHtml) {
        lContexte.eventsInjectionHtml = aContexte.eventsInjectionHtml = [];
      }
      lContexteBoucles[aNomVariableBoucle] = {
        indice: aIndice,
        arguments: aInfosAcces.args,
        getterArray: function () {
          return aInfosAcces.callback() || [];
        },
      };
      lContexte.repeat = Object.assign(lContexteBoucles, aContexte.repeat);
      if (aInitialisationRepeat) {
        const lNodeClone = aCloneModele.cloneNode(true);
        aNodeParent.insertBefore(lNodeClone, lNodeAvant.nextSibling);
        aArrayNodes[aIndice] = _compileNode(
          lNodeClone,
          aNodeParent,
          aControleur,
          lContexte,
          aInvocateur,
        );
      } else {
        const lParams = {
          element: aNodeParent,
          html: aCloneModele.cloneNode(true),
          controleur: aControleur,
          contexte: lContexte,
          invocateur: aInvocateur,
          childNodes: null,
        };
        _injectEtCompilNode(lParams);
        aArrayNodes[aIndice] = _transfererFragmentDansHTML(
          lParams.childNodes,
          aNodeParent,
          lNodeAvant.nextSibling,
        );
        lParams.childNodes = null;
      }
    }
    function _getDiffTab(aTabOld, aTabNew) {
      const lLength = Math.max(aTabOld.length, aTabNew.length),
        lResult = [];
      for (let i = 0; i < lLength; i++) {
        if (aTabOld[i] !== aTabNew[i]) {
          lResult[i] = {
            supprimer: true,
            ajouter: aTabNew[i] !== null && aTabNew[i] !== undefined,
          };
        }
      }
      return lResult;
    }
    function _traiterREPEAT(aNode, aNodeParent, aControleur, aContexte, aData) {
      let lValueAttr = aNode.getAttribute('ie-repeat');
      aNode.removeAttribute('ie-repeat');
      if (!lValueAttr) {
        return true;
      }
      if (!aControleur) {
        return true;
      }
      const lTab = lValueAttr.split('in');
      if (lTab.length !== 2) {
        return true;
      }
      lValueAttr = lTab[1].trim();
      const lNomVariableBoucle = lTab[0].trim();
      if (!aContexte.repeat) {
        aContexte.repeat = {};
      }
      if (aContexte.repeat[lNomVariableBoucle]) {
        return true;
      }
      const lContexteCourant = _getContexteCourant(
        aControleur,
        aContexte,
        aNode,
        aData,
      );
      const lInfos = _getAccesParametres(lValueAttr, lContexteCourant);
      let lArrayValue = [].concat(lInfos.callback() || []);
      const lChaineData = 'ie-repeat';
      const lNodeComm = document.createComment(lChaineData);
      const lArrayNodes = [];
      const lArrayComms = [];
      const lCloneModele = aNode.cloneNode(true);
      aNode.parentNode.insertBefore(lNodeComm, aNode);
      const lInvocateur = new Invocateur_1.ObjetInvocateur();
      _abonnerRefresh(
        () => {
          const lNewArrayValue = lInfos.callback() || [];
          const lDiff = _getDiffTab(lArrayValue, lNewArrayValue);
          let lArrayRemove;
          let lAvecModif = false;
          let lPreInjectionHtml;
          if (lDiff.length > 0) {
            lArrayRemove = [];
            for (let i = 0; i < lDiff.length; i++) {
              if (lDiff[i] && lDiff[i].supprimer) {
                lAvecModif = true;
                if (!lPreInjectionHtml) {
                  lPreInjectionHtml = _preInjectionHTML(aNodeParent, null);
                }
                lArrayRemove.push(lArrayNodes[i]);
                lArrayNodes[i] = null;
                if (i > 0 && lArrayComms[i]) {
                  lArrayRemove.push(lArrayComms[i]);
                  lArrayComms[i] = null;
                }
              }
            }
            if (lArrayRemove.length > 0) {
              $(lArrayRemove).remove();
            }
            for (let i = 0; i < lDiff.length; i++) {
              if (lDiff[i] && lDiff[i].ajouter) {
                lAvecModif = true;
                if (!lPreInjectionHtml) {
                  lPreInjectionHtml = _preInjectionHTML(aNodeParent, null);
                }
                _addNodeDeREPEAT(
                  aNodeParent,
                  aControleur,
                  lCloneModele,
                  lNomVariableBoucle,
                  i,
                  lInfos,
                  lNodeComm,
                  aContexte,
                  lArrayNodes,
                  lInvocateur,
                );
              }
            }
            lArrayValue = [].concat(lNewArrayValue);
            if (lAvecModif && lPreInjectionHtml) {
              _finaliserInjectionHTML(lPreInjectionHtml, aContexte);
            }
          }
          lInvocateur.evenement(C_id_event_iemodel);
        },
        aNodeParent,
        lContexteCourant,
        null,
        () => {
          if (
            aNodeParent &&
            aNodeParent.contains &&
            !aNodeParent.contains(lNodeComm)
          ) {
            return true;
          }
          return false;
        },
      );
      $(aNode).remove();
      for (let i = 0; i < lArrayValue.length; i++) {
        _addNodeDeREPEAT(
          aNodeParent,
          aControleur,
          lCloneModele,
          lNomVariableBoucle,
          i,
          lInfos,
          lNodeComm,
          aContexte,
          lArrayNodes,
          lInvocateur,
          true,
        );
      }
      return false;
    }
    function _compileNode(
      aNode,
      aNodeParent,
      aControleur,
      aContexte,
      aInvocateur,
      aProfondeur,
    ) {
      let lResultBalise,
        lNodeName,
        lNode = aNode,
        lData = null,
        lAvecAttributData = false,
        lJSONDebugData,
        lNameAttribut,
        lAvecCompilFils = true;
      const lProfondeur = aProfondeur || 0;
      const lContexteCourant = _getContexteCourant(
        aControleur,
        aContexte,
        aNode,
        null,
        aInvocateur,
      );
      if (lProfondeur > 1000) {
        return;
      }
      const lNodeType = lNode.nodeType;
      lNodeName = lNode.nodeName;
      if (lNodeType === 1 && !!lNodeName) {
        lNodeName = lNodeName ? lNodeName.toLowerCase() : '';
        if (!aContexte.refresh) {
          aContexte.refresh = function () {
            if (aControleur && aControleur.$refresh) {
              return aControleur.$refresh(true);
            }
            return IEHtml.refresh();
          };
        }
        if (!aContexte.refreshSelf) {
          aContexte.refreshSelf = async function () {
            if (aControleur && aControleur.$refreshSelf) {
              return aControleur.$refreshSelf(true);
            }
            return Promise.resolve();
          };
        }
        lJSONDebugData = null;
        lData = _getDataDeNode(lNode);
        lAvecAttributData = !!lData;
        if (!lData) {
          lData = {};
        }
        let lAvecIeRepeat = false;
        if (aNode.hasAttribute('ie-repeat')) {
          lAvecIeRepeat = true;
          if (
            !_traiterREPEAT(aNode, aNodeParent, aControleur, aContexte, lData)
          ) {
            return;
          }
        }
        if (aNode.hasAttribute('ie-if')) {
          if (
            !lAvecIeRepeat &&
            !_traiterIF(aNode, aNodeParent, aControleur, aContexte, lData)
          ) {
            return;
          }
        }
        lContexteCourant.data = lData;
        lContexteCourant.nodeName = lNodeName;
        _getModel(lContexteCourant);
        let lAvecTransformationNoeud = !!uBalises[lNodeName];
        let lNomBaliseTransform = lNodeName;
        if (!lAvecTransformationNoeud) {
          for (lNameAttribut in uBalises) {
            if (lNode.hasAttribute(lNameAttribut)) {
              lAvecTransformationNoeud = true;
              lNomBaliseTransform = lNameAttribut;
              lNode.removeAttribute(lNameAttribut);
              break;
            }
          }
        }
        if (lAvecTransformationNoeud) {
          lResultBalise = uBalises[lNomBaliseTransform](
            lContexteCourant,
            lOutils,
          );
          lAvecCompilFils =
            !lResultBalise || lResultBalise.avecCompileFils !== false;
          if (lResultBalise && lResultBalise.node) {
            lNode = lResultBalise.node;
            lContexteCourant.node = lNode;
            lNodeName = lNode.nodeName ? lNode.nodeName.toLowerCase() : '';
            lContexteCourant.nodeNameBefore = lContexteCourant.nodeName;
            lContexteCourant.nodeName = lNodeName;
          }
        }
        const lEstNodeInput = lNodeName === 'input';
        let lAttributType = '';
        if (lEstNodeInput) {
          lAttributType = (lNode.getAttribute('type') || '').toLowerCase();
        }
        if (
          lEstNodeInput &&
          (lAttributType === 'radio' || lAttributType === 'checkbox')
        ) {
          if (!lResultBalise || !lResultBalise.ignorerGererInputCB) {
            _gererInputCB(lContexteCourant, lAttributType);
          }
        } else if (
          lEstNodeInput ||
          lNodeName === 'textarea' ||
          _estNodeContentEditable(lNode)
        ) {
          if (!lResultBalise || !lResultBalise.ignorerInputText) {
            _gererInputText(lContexteCourant, lAttributType);
          }
        }
        if (lData && !$.isEmptyObject(lData)) {
          $(lNode).ieData(lData);
          if (lAvecAttributData) {
            if (lJSONDebugData) {
              lOutils.addCommentaireDebug(
                lNode,
                'ie-data="' + lJSONDebugData + '"',
              );
            }
            lNode.removeAttribute('ie-data');
          }
        }
        for (lNameAttribut in uAttributs) {
          if (lNode.hasAttribute(lNameAttribut)) {
            const lAttrValue = lNode.getAttribute(lNameAttribut);
            try {
              const lParametresCompile = {};
              lNode.removeAttribute(lNameAttribut);
              uAttributs[lNameAttribut](
                lContexteCourant,
                lNodeName,
                lAttrValue,
                lOutils,
                lParametresCompile,
              );
              if (lAvecCompilFils) {
                lAvecCompilFils = lParametresCompile.avecCompileFils !== false;
              }
            } catch (e) {}
          }
        }
        for (const lClass of Array.from(lNode.classList)) {
          if (uClassesCss[lClass]) {
            try {
              const lParametresCompile = {};
              uClassesCss[lClass](
                lContexteCourant,
                lNodeName,
                lOutils,
                lParametresCompile,
              );
              if (lAvecCompilFils) {
                lAvecCompilFils = lParametresCompile.avecCompileFils !== false;
              }
            } catch (e) {}
          }
        }
        if (
          lNodeName === 'i' &&
          !lNode.hasAttribute('role') &&
          (lNode.hasAttribute('aria-label') ||
            lNode.hasAttribute('aria-labelledby'))
        ) {
          lNode.setAttribute('role', 'img');
          IE.log.addLog(
            `Balise i avec aria-label/labelledby a role img manquant - ajouté automatiquement (a corriger) : ${lNode.outerHTML}`,
            null,
            IE.log.genre.Avertissement,
          );
        }
      }
      if (lAvecCompilFils && lNode.childNodes && lNode.childNodes.length > 0) {
        _compile(
          lNode.childNodes,
          lNode,
          aControleur,
          aContexte,
          aInvocateur,
          lProfondeur + 1,
        );
      }
      return lContexteCourant.node;
    }
    function _compile(
      aNodeList,
      aNodeParent,
      aControleur,
      aContexte,
      aInvocateur,
      aProfondeur,
    ) {
      const lProfondeur = aProfondeur || 0;
      if (lProfondeur > 1000) {
        return;
      }
      const lChildNodes = _sliceNodes(aNodeList);
      let lNode;
      for (let i = 0; i < lChildNodes.length; i++) {
        lNode = lChildNodes[i];
        _compileNode(
          lNode,
          aNodeParent,
          aControleur,
          aContexte,
          aInvocateur,
          lProfondeur,
        );
      }
    }
    const IEHtml = {
      initControleur: _initControleur,
      addBalise(aBalise, aFonction) {
        aBalise = aBalise.toLowerCase();
        uBalises[aBalise] = aFonction;
        uNodeNames.push(aBalise);
      },
      addAttribut(aAttribut, aFonction) {
        aAttribut = aAttribut.toLowerCase();
        uAttributs[aAttribut] = aFonction;
      },
      addClass(aClass, aFonction) {
        uClassesCss[aClass] = aFonction;
      },
      ieData(aObjet) {
        if (!aObjet) {
          return '';
        }
        const lChaine = ObjetJSON_1.ObjetJSON.toJSON(aObjet, {
          ignorerEntites: true,
        });
        if (!lChaine) {
          return '';
        }
        return ' ie-data="' + lChaine.replace(/"/g, '&quot;') + '" ';
      },
      async refresh(aRefreshAsynchrone) {
        if (aRefreshAsynchrone) {
          return new Promise((aResolve) => {
            setTimeout(() => {
              uInvocateur.evenement(C_id_event_iemodel);
              aResolve();
            }, 0);
          });
        } else {
          uInvocateur.evenement(C_id_event_iemodel);
          return Promise.resolve();
        }
      },
      injectHTML(
        aElement,
        aHtml,
        aControleur,
        aIgnorerScroll,
        aInsererAvantNode,
        aAvecCommentaireConstructeur,
        aCommentaireHtmlDebug,
      ) {
        return _injectHTML({
          element: aElement,
          insererAvantLeNode: aInsererAvantNode,
          html: aHtml,
          controleur: aControleur,
          ignorerScroll: aIgnorerScroll,
          avecCommentaireConstructeur: aAvecCommentaireConstructeur !== false,
          commentaireHtmlDebug: aCommentaireHtmlDebug,
        });
      },
      injectHTMLParams: _injectHTML,
      empty(aNode) {
        if (aNode && aNode.getElementsByTagName) {
          $.cleanData(aNode.getElementsByTagName('*'));
        }
        while (aNode && aNode.firstChild) {
          aNode.removeChild(aNode.firstChild);
        }
      },
      outils: lOutils,
      collectionIdentite: {},
      C_eventsModifyCheckbox: 'IEChecked change input',
      C_eventsModifyInput: 'input change paste cut keydown keypress keyup',
      MAX_LENGTH_Default: 0,
      REGEXP_INDICATIF_TELEPHONE: /[^0-9]/gi,
      TAILLEMAX_INDICATIF_TELEPHONE: 3,
      REGEXP_TELEPHONE: /[^0-9]/gi,
    };
    (_a = Object.assign({}, IEHtml)),
      (exports.initControleur = _a.initControleur),
      (exports.addBalise = _a.addBalise),
      (exports.addAttribut = _a.addAttribut),
      (exports.addClass = _a.addClass),
      (exports.ieData = _a.ieData),
      (exports.refresh = _a.refresh),
      (exports.injectHTML = _a.injectHTML),
      (exports.injectHTMLParams = _a.injectHTMLParams),
      (exports.empty = _a.empty),
      (exports.outils = _a.outils),
      (exports.collectionIdentite = _a.collectionIdentite),
      (exports.C_eventsModifyCheckbox = _a.C_eventsModifyCheckbox),
      (exports.C_eventsModifyInput = _a.C_eventsModifyInput),
      (exports.MAX_LENGTH_Default = _a.MAX_LENGTH_Default),
      (exports.REGEXP_INDICATIF_TELEPHONE = _a.REGEXP_INDICATIF_TELEPHONE),
      (exports.TAILLEMAX_INDICATIF_TELEPHONE =
        _a.TAILLEMAX_INDICATIF_TELEPHONE),
      (exports.REGEXP_TELEPHONE = _a.REGEXP_TELEPHONE);
    exports.default = IEHtml;
    const uFuncDate = { formatDate: null, parseHeureMinute: null };
    const setObjetDate = function (aFormatDate, aParseHeureMinute) {
      uFuncDate.formatDate = aFormatDate;
      uFuncDate.parseHeureMinute = aParseHeureMinute;
    };
    exports.setObjetDate = setObjetDate;
    $.fn.extend({
      ieHtml(aHtml, aParametres) {
        const lParametres = {
          html: aHtml,
          ignorerScroll: false,
          controleur: null,
          instance: null,
          sansCompile: false,
          avecCommentaireConstructeur: true,
          commentaireHtmlDebug: '',
        };
        Object.assign(lParametres, aParametres);
        return this.empty().each(function () {
          if (lParametres.sansCompile) {
            this.innerHTML = aHtml;
          } else {
            while (this && this.firstChild) {
              this.removeChild(this.firstChild);
            }
            IEHtml.injectHTMLParams(
              Object.assign({ element: this }, lParametres),
            );
          }
        });
      },
    });
    $.fn.extend({
      ieHtmlAppend(aHtml, aParametres) {
        const lParametres = {
          ignorerScroll: false,
          controleur: null,
          sansCompile: false,
        };
        Object.assign(lParametres, aParametres);
        return this.each(function () {
          if (lParametres.sansCompile) {
            this.innerHTML += aHtml;
          } else {
            IEHtml.injectHTMLParams(
              Object.assign({ element: this, html: aHtml }, lParametres),
            );
          }
        });
      },
    });
    $.fn.extend({
      ieData(aData) {
        if (arguments.length > 0) {
          return this.each(function () {
            $(this).data('ieData', aData);
          });
        }
        return $(this).data('ieData');
      },
    });
    let u_SurEventMouse_0x0 = false;
    let u_timer_SurEventMouse_0x0;
    const u_estEventEn0x0 = function (aEvent) {
      return (
        (aEvent.pageX === 0 && aEvent.pageY === 0) ||
        (aEvent.clientX === 0 && aEvent.clientY === 0)
      );
    };
    $.fn.extend({
      eventValidation(aCallback) {
        return this.each(function () {
          $(this).on({
            mouseup: function (aEvent) {
              u_SurEventMouse_0x0 = false;
              if (u_timer_SurEventMouse_0x0) {
                clearTimeout(u_timer_SurEventMouse_0x0);
                u_timer_SurEventMouse_0x0 = null;
              }
              if (u_estEventEn0x0(aEvent)) {
                u_SurEventMouse_0x0 = true;
                u_timer_SurEventMouse_0x0 = setTimeout(() => {
                  u_SurEventMouse_0x0 = false;
                  u_timer_SurEventMouse_0x0 = null;
                }, 100);
              }
            },
            click: function (aEvent) {
              if (!u_SurEventMouse_0x0 && u_estEventEn0x0(aEvent)) {
                return;
              }
              u_SurEventMouse_0x0 = false;
              return aCallback.call(this, aEvent);
            },
            keyup: function (aEvent) {
              if (
                aEvent.which === ToucheClavier_1.ToucheClavier.Espace ||
                aEvent.which === ToucheClavier_1.ToucheClavier.RetourChariot
              ) {
                return aCallback.call(this, aEvent);
              }
            },
          });
        });
      },
    });
    Invocateur_1.Invocateur.abonner(
      Invocateur_1.ObjetInvocateur.events.refreshIEHtml,
      () => {
        IEHtml.refresh();
      },
    );
  },
  fn: 'iehtml.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GHtml = exports.ObjetHtml = void 0;
    require('Divers.js');
    const MethodesObjet_1 = require('MethodesObjet');
    const IEHtml = require('IEHtml');
    const tag_1 = require('tag');
    const ObjetChaine_1 = require('ObjetChaine');
    const cTagsFocusables = [
      'audio',
      'button',
      'canvas',
      'details',
      'iframe',
      'input',
      'select',
      'summary',
      'textarea',
      'video',
    ];
    const cAttributsFocusables = [
      'accesskey',
      'contenteditable',
      'href',
      'tabindex',
    ];
    const cSelectorFocusables = `${cTagsFocusables.join(', ')}, ${cAttributsFocusables.map((a) => `[${a}]`).join(', ')}`;
    class ObjetHtml {
      elementExiste(aElement) {
        return !!this.getElement(aElement);
      }
      estElement(aElement) {
        return !!aElement && aElement.nodeType === 1;
      }
      estDocument(aElement) {
        return !!aElement && aElement.nodeType === 9;
      }
      estNoeudDeType(aElement, aTypeParent) {
        const lElement = this.getElement(aElement);
        return (
          this.estElement(lElement) &&
          lElement.nodeName.toUpperCase() === aTypeParent.toUpperCase()
        );
      }
      viderNode(aNode) {
        return IEHtml.empty(aNode);
      }
      getParent(aElement) {
        const lElement = this.getElement(aElement);
        if (this.estElement(lElement)) {
          if (lElement.parentElement) {
            return lElement.parentElement;
          }
          if (lElement.parentNode) {
            return lElement.parentNode;
          }
        }
        return null;
      }
      getParentOverflowNonVisible(aId) {
        const lParent = this.getParent(aId);
        if (lParent && lParent !== document.body) {
          try {
            if (
              global
                .getComputedStyle(lParent)
                .getPropertyValue('overflow-y') !== 'visible'
            ) {
              return lParent;
            }
          } catch (e) {
            return document.body;
          }
          return this.getParentOverflowNonVisible(lParent);
        }
        return document.body;
      }
      getParentScrollable(aId) {
        let lElement = this.getElement(aId);
        try {
          while (lElement) {
            if (lElement === document.documentElement) {
              return lElement;
            }
            let lAvecScroll = lElement.scrollTop > 0;
            if (!lAvecScroll) {
              const lOverflow = global
                .getComputedStyle(lElement)
                .getPropertyValue('overflow');
              lAvecScroll = lOverflow === 'auto' || lOverflow === 'scroll';
            }
            if (lAvecScroll) {
              return lElement;
            }
            lElement = this.getParent(lElement);
          }
        } catch (e) {}
        return null;
      }
      htmlToDOM(aHtml) {
        let lFrag = document.createDocumentFragment();
        let lDiv = document.createElement('div');
        let lNoeudDOM;
        lFrag.appendChild(lDiv);
        lDiv.insertAdjacentHTML('afterbegin', aHtml);
        if (lDiv.childNodes.length > 1) {
          lNoeudDOM = Array.from(lDiv.childNodes);
        } else {
          lNoeudDOM = lDiv.firstChild;
        }
        this.viderNode(lDiv);
        lDiv = null;
        lFrag = null;
        return lNoeudDOM;
      }
      insererElementDOM(aElementPere, aElement, aInsererEnPremier) {
        if (this.estElement(aElement) && this.estElement(aElementPere)) {
          if (aInsererEnPremier && aElementPere.firstChild) {
            aElementPere.insertBefore(aElement, aElementPere.firstChild);
          } else {
            aElementPere.appendChild(aElement);
          }
        }
      }
      addHtml(aId, aHtml, aParametres) {
        const lElement = this.getElement(aId);
        if (this.elementExiste(lElement) && lElement.appendChild) {
          const lParametres = Object.assign({}, aParametres);
          if (lParametres.instance && lParametres.instance.controleur) {
            lParametres.controleur = lParametres.instance.controleur;
          }
          if (lParametres.sansCompile) {
            lElement.insertAdjacentHTML('beforeend', aHtml);
          } else {
            IEHtml.injectHTML(
              lElement,
              aHtml,
              lParametres.controleur,
              lParametres.ignorerScroll,
              null,
              false,
            );
          }
        }
      }
      supprimerElementDOM(aId) {
        const lElement = this.getElement(aId);
        if (lElement) {
          $(lElement).remove();
        }
      }
      getElement(aId) {
        if (!aId) {
          return null;
        }
        if (typeof aId === 'string') {
          return document.getElementById(aId);
        }
        if (this.estElement(aId) || this.estDocument(aId)) {
          return aId;
        }
        return null;
      }
      getHtml(aId) {
        const E = this.getElement(aId);
        if (E) {
          return E.innerHTML;
        }
        return '';
      }
      getValue(aId) {
        const E = this.getElement(aId);
        if (E) {
          return ObjetChaine_1.GChaine.ajouterEntites(E.value);
        }
        return '';
      }
      estTextNode(aElement) {
        return aElement && aElement.nodeType === 3;
      }
      getTextesDeNode(aId) {
        let lResult = [];
        try {
          if (aId instanceof Node && this.estTextNode(aId)) {
            lResult.push(aId.nodeValue);
          } else if (
            aId instanceof Node ||
            MethodesObjet_1.MethodesObjet.isString(aId)
          ) {
            const lElement = this.getElement(aId);
            if (this.estTextNode(lElement)) {
              lResult.push(lElement.nodeValue);
            } else if (this.estElement(lElement) && lElement.childNodes) {
              for (let i = 0; i < lElement.childNodes.length; i++) {
                lResult = lResult.concat(
                  this.getTextesDeNode(lElement.childNodes[i]),
                );
              }
            }
          }
        } catch (e) {
          IE.log.addLog(
            'erreur getTextesDeNode : ' + e,
            null,
            IE.log.genre.Erreur,
          );
        }
        return lResult;
      }
      getClass(aId) {
        const E = this.getElement(aId);
        return E && E.className ? E.className : '';
      }
      addClass(aId, aClass) {
        this.modifierClass(aId, null, aClass);
      }
      delClass(aId, aClass) {
        this.modifierClass(aId, aClass, null);
      }
      modifierClass(aId, aClassSuppression, aClasseAjout) {
        if ((!aClassSuppression && !aClasseAjout) || !this.elementExiste(aId)) {
          return;
        }
        const lJElement =
          typeof aId === 'string' ? $('#' + aId.escapeJQ()) : $(aId);
        if (aClassSuppression) {
          lJElement.removeClass(aClassSuppression);
        }
        if (aClasseAjout) {
          lJElement.addClass(aClasseAjout);
        }
      }
      getClosestFocusable(aId) {
        const lNode = this.getElement(aId);
        if (lNode && lNode.closest) {
          let lNodeCB = lNode.closest('.iecb');
          if (lNodeCB) {
            return lNodeCB.querySelector('input');
          }
          return lNode.closest(cSelectorFocusables);
        }
        return null;
      }
      getClosestInteractive(aId) {
        const lNode = this.getElement(aId);
        if (lNode && lNode.closest) {
          let lNodeCB = lNode.closest('.iecb');
          if (lNodeCB) {
            return lNodeCB.querySelector('input');
          }
          return lNode.closest(cTagsFocusables.concat('a[href]').join(', '));
        }
        return null;
      }
      getElementsFocusablesDElement(aNode, aOptions) {
        const lNode = this.getElement(aNode);
        const lTab = [];
        if (lNode && lNode.querySelectorAll) {
          const lOptions = Object.assign(
            { ignoreAriaHidden: true, ignoreRolePresentation: true },
            aOptions,
          );
          const lNodes = lNode.querySelectorAll(cSelectorFocusables);
          if (lNodes) {
            Array.from(lNodes).forEach((lNode) => {
              if (lOptions.ignoreAriaHidden && lNode.closest('[aria-hidden]')) {
                return;
              }
              if (
                lOptions.ignoreRolePresentation &&
                ['presentation', 'none'].includes(lNode.role)
              ) {
                return;
              }
              lTab.push(lNode);
            });
          }
        }
        return lTab;
      }
      getDisplay(aId) {
        const E = this.getElement(aId);
        if (E) {
          if (E.style && E.style.display === 'none') {
            return false;
          } else if (!E.parentNode) {
            return true;
          } else {
            return this.getDisplay(E.parentNode);
          }
        }
        return false;
      }
      extraireNombreDId(aId, aIndiceAvant, aSeparateur) {
        let lOptions,
          T,
          lResult,
          lId = aId;
        if (!MethodesObjet_1.MethodesObjet.isString(lId)) {
          if (this.estElement(lId) && lId.id) {
            lId = lId.id;
          } else {
            return null;
          }
        }
        lOptions = {
          separateur: aSeparateur || '_',
          indiceAvant: aIndiceAvant || 0,
        };
        T = lId.split(lOptions.separateur);
        lResult = parseInt(
          T[Math.max(0, T.length - 1 - lOptions.indiceAvant)],
          10,
        );
        return MethodesObjet_1.MethodesObjet.isNumber(lResult) ? lResult : null;
      }
      getCheckBox(aId) {
        const E = this.getElement(aId);
        if (E) {
          return !!E.checked;
        }
        return false;
      }
      getElementEnFocus() {
        try {
          return document.activeElement;
        } catch (e) {
          return null;
        }
      }
      focusEstDansElement(aId) {
        const lElement = this.getElement(aId);
        if (this.estElement(lElement)) {
          const lElementFocus = this.getElementEnFocus();
          if (lElementFocus) {
            return (
              lElement === lElementFocus || $.contains(lElement, lElementFocus)
            );
          }
        }
        return false;
      }
      setClass(aId, aClass) {
        const E = this.getElement(aId);
        if (E) {
          E.className = aClass;
        }
      }
      setHtml(aId, aHtml, aIgnorerScroll) {
        const E = this.getElement(aId);
        if (E) {
          const lParametres = Object.assign({}, aIgnorerScroll);
          if (aIgnorerScroll === true) {
            lParametres.ignorerScroll = true;
          }
          if (lParametres.instance && lParametres.instance.controleur) {
            lParametres.controleur = lParametres.instance.controleur;
          }
          if (
            $.fn.ieHtml &&
            (!lParametres.instance || !lParametres.instance.IGNORER_IEHTML)
          ) {
            $(E).ieHtml(aHtml, lParametres);
          } else {
            if (E.getElementsByTagName) {
              $.cleanData(E.getElementsByTagName('*'));
            }
            E.innerHTML = aHtml;
            if (aIgnorerScroll !== true) {
              const lOverflow = $(E).css('overflow');
              if (lOverflow === 'auto' || lOverflow === 'scroll') {
                E.scrollLeft = 0;
                E.scrollTop = 0;
              }
            }
          }
        }
      }
      setTitle(aId, aTitle) {
        const E = this.getElement(aId);
        if (E) {
          E.title = _valeurToProp(aTitle);
        }
      }
      setValue(aId, aValue) {
        const E = this.getElement(aId);
        if (E) {
          E.value = _valeurToProp(aValue);
        }
      }
      setDisabled(aId, aDisabled) {
        const E = this.getElement(aId);
        if (E) {
          $(E).inputDisabled(aDisabled);
        }
      }
      setAvecMain(aId, aDisabled) {
        const E = this.getElement(aId);
        if (E) {
          $(E).toggleClass('AvecMain', !aDisabled);
        }
      }
      setDisplay(aId, aVisible, aSpeed) {
        const E = this.getElement(aId);
        if (E) {
          if (aVisible) {
            $(E).show(aSpeed);
          } else {
            $(E).hide(aSpeed);
          }
        }
      }
      setFocus(aId, aFocus, aAvecDecalage) {
        function _focus(aHtml, aElement) {
          if (!aHtml.elementExiste(aElement)) {
            return;
          }
          try {
            if (aFocus || aFocus === null || aFocus === undefined) {
              aElement.focus();
            } else {
              aElement.blur();
            }
          } catch (e) {
            IE.log.addLog(
              'Erreur ObjetHtml.setFocus : ' +
                e.toString() +
                ' ((fv) remarqué uniquement sur IE avec un delai)',
            );
          }
        }
        if (this.elementExiste(aId)) {
          try {
            if (this.getDisplay(aId)) {
              const lElement = this.getElement(aId);
              if (lElement) {
                let lAvecDecalage = aAvecDecalage,
                  lDecalage = 200;
                if (
                  MethodesObjet_1.MethodesObjet.isNumber(aAvecDecalage) &&
                  aAvecDecalage >= 0
                ) {
                  lAvecDecalage = true;
                  lDecalage = aAvecDecalage;
                }
                if (lAvecDecalage) {
                  setTimeout(_focus.bind(null, this, lElement), lDecalage);
                } else {
                  _focus(this, lElement);
                }
              }
            }
          } catch (e) {}
        }
      }
      setFocusEdit(aId) {
        if (this.elementExiste(aId)) {
          try {
            if (this.getDisplay(aId)) {
              const E = this.getElement(aId);
              if (E) {
                E.focus();
                E.value = E.value;
              }
            }
          } catch (e) {}
        }
      }
      setCursorAtEnd(aId) {
        try {
          const E = this.getElement(aId);
          if (E && E.value !== undefined) {
            const end = E.value.length;
            this.setSelectionEdit(E, end, end);
          }
        } catch (e) {}
      }
      setSelection(aId, aSelection) {
        const E = this.getElement(aId);
        if (E) {
          E.selectedIndex = aSelection;
        }
      }
      setSelectionEdit(aId, aBegin, aEnd) {
        if (this.elementExiste(aId)) {
          try {
            if (this.getDisplay(aId)) {
              const E = this.getElement(aId);
              if (E) {
                const begin = MethodesObjet_1.MethodesObjet.isNumber(aBegin)
                    ? aBegin
                    : 0,
                  end = MethodesObjet_1.MethodesObjet.isNumber(aEnd)
                    ? aEnd
                    : E.value.length;
                if (E.setSelectionRange) {
                  E.setSelectionRange(begin, end);
                } else if (E.createTextRange) {
                  const range = E.createTextRange();
                  range.collapse(true);
                  range.moveEnd('character', end);
                  range.moveStart('character', begin);
                  range.select();
                }
              }
            }
          } catch (e) {}
        }
      }
      setImage(aId, aSrc) {
        const E = this.getElement(aId);
        if (E) {
          E.src = aSrc;
        }
      }
      setAlt(aId, aValue) {
        const E = this.getElement(aId);
        if (E) {
          E.alt = aValue;
        }
      }
      setTexte(aId, aTexte) {
        const E = this.getElement(aId);
        if (E) {
          this.viderNode(E);
          E.appendChild(document.createTextNode(aTexte));
        }
      }
      composeBlanc() {
        return '<span style="font-size : 1px">&nbsp;</span>';
      }
      setCheckBox(aId, aValue) {
        if (aValue === undefined) {
          aValue = false;
        }
        const E = this.getElement(aId);
        if (E) {
          $(E).inputChecked(aValue);
        }
      }
      setLien(aId, aValue) {
        const E = this.getElement(aId);
        if (E && E.tagName.toUpperCase() === 'A') {
          E.href = aValue;
        }
      }
      setTabIndex(aId, aTabIndex) {
        const E = this.getElement(aId);
        if (E) {
          E.tabIndex = aTabIndex;
        }
      }
      toArg(aArgs) {
        return tag_1.tag.toArg(aArgs);
      }
      composeAttr(aAttribut, aValue, ...aArgs) {
        return tag_1.tag.composeAttr(aAttribut, aValue, ...aArgs);
      }
      deselectionTexte() {
        try {
          if (
            window.getSelection &&
            window.getSelection() &&
            window.getSelection().removeAllRanges
          ) {
            window.getSelection().removeAllRanges();
          }
        } catch (e) {}
      }
      nettoyerEditeurRiche(aJNode, aEditeurEquationMaxFileSize) {
        let lResult = false;
        if (aJNode && aJNode.find && aJNode.length > 0) {
          aJNode.find('img').each((index, ele) => {
            const lSrc = $(ele).attr('src');
            if ($(ele).attr('data-latex')) {
              if (lSrc && lSrc.length > (aEditeurEquationMaxFileSize || 4096)) {
                $(ele).remove();
                lResult = true;
              }
            } else if (
              lSrc &&
              (lSrc.search('data') > -1 || lSrc.startsWith('blob'))
            ) {
              $(ele).remove();
              lResult = true;
            }
          });
        }
        return lResult;
      }
      composeFondAucuneDonnee(aHtml) {
        return (
          '<div style="width:1px;height:1px;"></div><div class="message-vide card card-nodata"><div class="card-content">' +
          aHtml +
          '</div><div class="Image_No_Data" aria-hidden="true"></div></div>'
        );
      }
    }
    exports.ObjetHtml = ObjetHtml;
    function _valeurToProp(aValeur) {
      if (aValeur === null || aValeur === undefined) {
        return '';
      }
      if (MethodesObjet_1.MethodesObjet.isString(aValeur)) {
        return ObjetChaine_1.GChaine.enleverEntites(aValeur);
      }
      if (MethodesObjet_1.MethodesObjet.isNumber(aValeur)) {
        return aValeur + '';
      }
      return aValeur;
    }
    const GHtml = new ObjetHtml();
    exports.GHtml = GHtml;
  },
  fn: 'objethtml.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GStyle = exports.ObjetStyle = exports.EGenreBordure = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetSupport_1 = require('ObjetSupport');
    const EGenreBordure = {
      gauche: 1,
      haut: 2,
      droite: 4,
      bas: 8,
      avecBordure(aBordures, aGenreBordure) {
        return aGenreBordure > 0 && aBordures > 0
          ? !!(aBordures & aGenreBordure)
          : false;
      },
    };
    exports.EGenreBordure = EGenreBordure;
    class ObjetStyle {
      composeCouleur(
        aCouleurFond,
        aCouleurTexte,
        aCouleurBordure,
        aLargeurBordure,
        aListeBordures,
      ) {
        return (
          this.composeCouleurFond(aCouleurFond) +
          this.composeCouleurTexte(aCouleurTexte) +
          this.composeCouleurBordure(
            aCouleurBordure,
            aLargeurBordure,
            aListeBordures,
          )
        );
      }
      composeCouleurBordure(
        aCouleurBordure,
        aLargeurBordure = 1,
        aListeBordures = 0,
        aStyle = 'solid',
      ) {
        if (
          aCouleurBordure &&
          MethodesObjet_1.MethodesObjet.isString(aCouleurBordure)
        ) {
          const lStyle = aStyle || 'solid';
          if (!MethodesObjet_1.MethodesObjet.isNumeric(aLargeurBordure)) {
            aLargeurBordure = 1;
          }
          if (!aListeBordures) {
            return (
              ' border: ' +
              aLargeurBordure +
              'px ' +
              lStyle +
              ' ' +
              aCouleurBordure +
              ';'
            );
          }
          const H = [];
          H.push(
            aListeBordures & EGenreBordure.gauche
              ? ' border-left: ' +
                  aLargeurBordure +
                  'px ' +
                  lStyle +
                  ' ' +
                  aCouleurBordure +
                  ';'
              : '',
          );
          H.push(
            aListeBordures & EGenreBordure.haut
              ? ' border-top: ' +
                  aLargeurBordure +
                  'px ' +
                  lStyle +
                  ' ' +
                  aCouleurBordure +
                  ';'
              : '',
          );
          H.push(
            aListeBordures & EGenreBordure.droite
              ? ' border-right: ' +
                  aLargeurBordure +
                  'px ' +
                  lStyle +
                  ' ' +
                  aCouleurBordure +
                  ';'
              : '',
          );
          H.push(
            aListeBordures & EGenreBordure.bas
              ? ' border-bottom: ' +
                  aLargeurBordure +
                  'px ' +
                  lStyle +
                  ' ' +
                  aCouleurBordure +
                  ';'
              : '',
          );
          return H.join('');
        }
        return '';
      }
      composeCouleurFond(aCouleurFond) {
        if (!aCouleurFond) {
          return '';
        }
        if (MethodesObjet_1.MethodesObjet.isString(aCouleurFond)) {
          return ' background-color:' + aCouleurFond + ';';
        }
        return '';
      }
      composeCouleurTexte(aCouleurTexte) {
        if (!aCouleurTexte) {
          return '';
        }
        if (MethodesObjet_1.MethodesObjet.isString(aCouleurTexte)) {
          return ' color:' + aCouleurTexte + ';';
        }
        return '';
      }
      composeHeight(aValeur, aFormat) {
        if (
          aValeur &&
          MethodesObjet_1.MethodesObjet.isString(aValeur) &&
          aValeur.indexOf &&
          aValeur.indexOf('%') > 0
        ) {
          aValeur = parseFloat(aValeur);
          aFormat = '%';
        }
        if (!MethodesObjet_1.MethodesObjet.isNumber(aValeur)) {
          return '';
        }
        if (!aFormat) {
          aFormat = 'px';
        }
        return 'height:' + aValeur + aFormat + ';';
      }
      composeWidth(aValeur, aFormat) {
        if (
          aValeur &&
          MethodesObjet_1.MethodesObjet.isString(aValeur) &&
          aValeur.indexOf &&
          aValeur.indexOf('%') > 0
        ) {
          aValeur = parseFloat(aValeur);
          aFormat = '%';
        }
        if (!MethodesObjet_1.MethodesObjet.isNumber(aValeur)) {
          return '';
        }
        if (!aFormat) {
          aFormat = 'px';
        }
        return 'width:' + aValeur + aFormat + ';';
      }
      composeHeightCalc(aValeur) {
        if (!MethodesObjet_1.MethodesObjet.isNumber(aValeur)) {
          return '';
        }
        return 'height: calc(100% - ' + aValeur + 'px);';
      }
      composeWidthCalc(aValeur) {
        if (!MethodesObjet_1.MethodesObjet.isNumber(aValeur)) {
          return '';
        }
        return 'width: calc(100% - ' + aValeur + 'px);';
      }
      composeMarge(aHaut, aBas, aGauche, aDroit) {
        let lResult = '';
        if (MethodesObjet_1.MethodesObjet.isNumeric(aHaut)) {
          lResult += 'margin-top: ' + aHaut + 'px; ';
        }
        if (MethodesObjet_1.MethodesObjet.isNumeric(aBas)) {
          lResult += 'margin-bottom: ' + aBas + 'px; ';
        }
        if (MethodesObjet_1.MethodesObjet.isNumeric(aGauche)) {
          lResult += 'margin-left: ' + aGauche + 'px; ';
        }
        if (MethodesObjet_1.MethodesObjet.isNumeric(aDroit)) {
          lResult += 'margin-right: ' + aDroit + 'px; ';
        }
        return lResult;
      }
      composeOpacite(aOpacite) {
        if (
          !MethodesObjet_1.MethodesObjet.isNumeric(aOpacite) ||
          aOpacite < 0 ||
          aOpacite > 1
        ) {
          return '';
        }
        aOpacite = Math.borner(aOpacite, 0, 1);
        if (
          ObjetSupport_1.Support.supportOpacity[
            ObjetSupport_1.Support.GenreNavigateur.Standard
          ]
        ) {
          return 'opacity: ' + aOpacite + ';';
        } else if (
          ObjetSupport_1.Support.supportOpacity[
            ObjetSupport_1.Support.GenreNavigateur.Webkit
          ]
        ) {
          return '-webkit-opacity: ' + aOpacite + ';';
        } else if (
          ObjetSupport_1.Support.supportOpacity[
            ObjetSupport_1.Support.GenreNavigateur.Moz
          ]
        ) {
          return '-moz-opacity: ' + aOpacite + ';';
        } else if (ObjetSupport_1.Support.supportFilterIE) {
          return (
            'FILTER: progid:DXImageTransform.Microsoft.Alpha(opacity=' +
            aOpacite * 100 +
            ')' +
            ';'
          );
        } else {
          return '';
        }
      }
      getStyle(aId) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E) {
          return E.style;
        }
      }
      setStyle(aId, aStyle) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E) {
          if (E.setAttribute) {
            E.setAttribute('style', aStyle);
          }
        }
      }
      setCouleurBordure(aId, aCouleur) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E) {
          E.style.borderColor = aCouleur;
        }
      }
      setCouleurBordureHaut(aId, aCouleur) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E) {
          E.style.borderTopColor = aCouleur;
        }
      }
      setCouleurBordureBas(aId, aCouleur) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E && E.style) {
          E.style.borderBottomColor = aCouleur;
        }
      }
      setCouleurBordureGauche(aId, aCouleur) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E) {
          E.style.borderLeftColor = aCouleur;
        }
      }
      setCouleurBordureDroit(aId, aCouleur) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E) {
          E.style.borderRightColor = aCouleur;
        }
      }
      setCouleur(aId, aCouleurFond, aCouleurTexte, aCouleurBordure) {
        if (aCouleurFond || aCouleurFond === '') {
          this.setCouleurFond(aId, aCouleurFond);
        }
        if (aCouleurTexte || aCouleurTexte === '') {
          this.setCouleurTexte(aId, aCouleurTexte);
        }
        if (aCouleurBordure || aCouleurBordure === '') {
          this.setCouleurBordure(aId, aCouleurBordure);
        }
      }
      setCouleurFond(aId, aCouleurFond) {
        const S = this.getStyle(aId);
        if (S) {
          S.backgroundColor = aCouleurFond;
        }
      }
      setCouleurTexte(aId, aCouleurTexte) {
        const S = this.getStyle(aId);
        if (S) {
          S.color = aCouleurTexte;
        }
      }
      setVisible(aId, aVisible) {
        const S = this.getStyle(aId);
        if (S) {
          S.visibility = aVisible ? 'visible' : 'hidden';
        }
      }
      setGras(aId, aGras) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E && ObjetHtml_1.GHtml.estElement(E)) {
          E.style.fontWeight = aGras ? 'bold' : 'normal';
        }
      }
      getZindex(aId) {
        const S = this.getStyle(aId);
        if (S && S.zIndex) {
          return parseInt(S.zIndex);
        }
      }
      setZindex(aId, aZindex) {
        const S = this.getStyle(aId);
        if (S) {
          S.zIndex = aZindex;
        }
      }
      getDisplay(aId) {
        const S = this.getStyle(aId);
        return S.display === '';
      }
      setDisplay(aId, aDisplay, aSpeed) {
        ObjetHtml_1.GHtml.setDisplay(aId, aDisplay, aSpeed);
      }
      getVisible(aId) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        return E.style ? E.style.visibility === 'visible' : false;
      }
      composeDegradeVertical(aCouleurDebut, aCouleurFin) {
        let lResult = this.composeCouleurFond(aCouleurDebut);
        if (ObjetSupport_1.Support.supportFilterIE) {
          lResult +=
            ' FILTER: progid:DXImageTransform.Microsoft.Gradient(gradientType=0,startColorStr=' +
            aCouleurDebut +
            ',endColorStr=' +
            aCouleurFin +
            ');';
        } else if (
          ObjetSupport_1.Support.supportGradient[
            ObjetSupport_1.Support.GenreNavigateur.Standard
          ]
        ) {
          lResult +=
            ' background: linear-gradient(to bottom, ' +
            aCouleurDebut +
            ', ' +
            aCouleurFin +
            ');';
        } else if (
          ObjetSupport_1.Support.supportGradient[
            ObjetSupport_1.Support.GenreNavigateur.IE
          ]
        ) {
          lResult +=
            ' background: -ms-linear-gradient(top, ' +
            aCouleurDebut +
            ', ' +
            aCouleurFin +
            ');';
        } else if (
          ObjetSupport_1.Support.supportGradient[
            ObjetSupport_1.Support.GenreNavigateur.Moz
          ]
        ) {
          lResult +=
            ' background: -moz-linear-gradient(top, ' +
            aCouleurDebut +
            ', ' +
            aCouleurFin +
            ');';
        } else if (
          ObjetSupport_1.Support.supportGradient[
            ObjetSupport_1.Support.GenreNavigateur.Webkit
          ]
        ) {
          lResult +=
            ' background: -webkit-gradient(linear, left top, left bottom, from(' +
            aCouleurDebut +
            '), to(' +
            aCouleurFin +
            '));';
        }
        return lResult;
      }
      setImageFond(aId, aImage) {
        const S = this.getStyle(aId);
        if (S) {
          S.backgroundImage = 'url(' + aImage + ')';
          S.backgroundAttachment = 'fixed';
        }
      }
      getComputedValue(aNode, aPropertyName) {
        const lNode = ObjetHtml_1.GHtml.getElement(aNode);
        if (lNode && global.getComputedStyle && aPropertyName) {
          try {
            return global
              .getComputedStyle(lNode)
              .getPropertyValue(aPropertyName);
          } catch (e) {}
        }
        return '';
      }
      getFloatComputedValue(aNode, aPropertyName) {
        const lNumber = parseFloat(this.getComputedValue(aNode, aPropertyName));
        return isNaN(lNumber) ? 0 : lNumber;
      }
      styleSheetDisabled() {
        let lResult = false;
        try {
          const lBody = document.getElementsByTagName('BODY')[0];
          const lElement = document.createElement('div');
          lBody.appendChild(lElement);
          lElement.classList.add('support-css-test');
          lResult = this.getFloatComputedValue(lElement, 'height') === 0;
          lBody.removeChild(lElement);
        } catch (e) {}
        return lResult;
      }
    }
    exports.ObjetStyle = ObjetStyle;
    const GStyle = new ObjetStyle();
    exports.GStyle = GStyle;
  },
  fn: 'objetstyle.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GPosition = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_1 = require('ObjetStyle');
    class ObjetPosition {
      constructor() {
        this._cacheFontSize = null;
      }
      getWidth(aId) {
        const lElement = ObjetHtml_1.GHtml.getElement(aId);
        return ObjetHtml_1.GHtml.estElement(lElement)
          ? lElement.offsetWidth
          : 0;
      }
      getHeight(aId) {
        const lElement = ObjetHtml_1.GHtml.getElement(aId);
        return ObjetHtml_1.GHtml.estElement(lElement)
          ? lElement.offsetHeight
          : 0;
      }
      getLeft(aId) {
        const lElement = ObjetHtml_1.GHtml.getElement(aId);
        return ObjetHtml_1.GHtml.estElement(lElement)
          ? this.getClientRect(lElement).left
          : 0;
      }
      getTop(aId) {
        const lElement = ObjetHtml_1.GHtml.getElement(aId);
        return ObjetHtml_1.GHtml.estElement(lElement)
          ? this.getClientRect(aId).top
          : 0;
      }
      setWidth(aId, aWidth, aAjuster, aFormat) {
        try {
          if (aWidth === undefined || aWidth === null || isNaN(aWidth)) {
            IE.log.addLog('setWidth invalide : ' + aWidth);
            return;
          }
          const lElement = ObjetHtml_1.GHtml.getElement(aId);
          if (!lElement || !lElement.style) {
            return;
          }
          const lWidthEnString = MethodesObjet_1.MethodesObjet.isString(aWidth);
          aFormat = !aFormat && !lWidthEnString ? 'px' : aFormat;
          if (lWidthEnString && aWidth === 'auto') {
            lElement.style.width = aWidth;
          } else {
            aWidth = Math.max(0, aWidth);
            lElement.style.width = aWidth + aFormat;
          }
          if (
            aAjuster &&
            aFormat === 'px' &&
            ObjetHtml_1.GHtml.getDisplay(lElement)
          ) {
            const lWidth = this.getWidth(lElement);
            if (aWidth !== lWidth) {
              lElement.style.width =
                Math.max(0, aWidth - (lWidth - aWidth)) + aFormat;
            }
          }
        } catch (e) {}
      }
      setHeight(aId, aHeight, aAjuster, aFormat) {
        try {
          if (aHeight === undefined || aHeight === null || isNaN(aHeight)) {
            IE.log.addLog('setHeight invalide : ' + aHeight);
            return;
          }
          const lElement = ObjetHtml_1.GHtml.getElement(aId);
          if (!lElement || !lElement.style) {
            return;
          }
          const lHeightEnString =
            MethodesObjet_1.MethodesObjet.isString(aHeight);
          aFormat = !aFormat && !lHeightEnString ? 'px' : aFormat;
          if (lHeightEnString && aHeight === 'auto') {
            lElement.style.height = aHeight;
          } else {
            aHeight = Math.max(0, aHeight);
            lElement.style.height = aHeight + aFormat;
          }
          if (
            aAjuster &&
            aFormat === 'px' &&
            ObjetHtml_1.GHtml.getDisplay(lElement)
          ) {
            const lHeight = this.getHeight(lElement);
            if (aHeight !== lHeight) {
              lElement.style.height =
                Math.max(0, aHeight - (lHeight - aHeight)) + aFormat;
            }
          }
        } catch (e) {}
      }
      setLeft(aId, aLeft, aAjuster, aFormat) {
        aFormat = !aFormat ? 'px' : aFormat;
        try {
          if (aLeft === undefined || aLeft === null || isNaN(aLeft)) {
            IE.log.addLog('setLeft invalide : ' + aLeft);
            return;
          }
          const lElement = ObjetHtml_1.GHtml.getElement(aId);
          if (!lElement || !lElement.style) {
            return;
          }
          aLeft = isNaN(aLeft) ? 0 : aLeft;
          lElement.style.left = aLeft + aFormat;
          if (
            aAjuster &&
            aFormat === 'px' &&
            ObjetHtml_1.GHtml.getDisplay(lElement)
          ) {
            const lLeft = this.getLeft(lElement);
            if (aLeft !== lLeft) {
              lElement.style.left = aLeft - (lLeft - aLeft) + aFormat;
            }
          }
        } catch (e) {}
      }
      setTop(aId, aTop, aAjuster, aFormat) {
        aFormat = !aFormat ? 'px' : aFormat;
        try {
          if (aTop === undefined || aTop === null || isNaN(aTop)) {
            IE.log.addLog('setTop invalide : ' + aTop);
            return;
          }
          const lElement = ObjetHtml_1.GHtml.getElement(aId);
          if (!lElement || !lElement.style) {
            return;
          }
          aTop = isNaN(aTop) ? 0 : aTop;
          lElement.style.top = aTop + aFormat;
          if (
            aAjuster &&
            aFormat === 'px' &&
            ObjetHtml_1.GHtml.getDisplay(lElement)
          ) {
            const lTop = this.getTop(lElement);
            if (aTop !== lTop) {
              lElement.style.top = aTop - (lTop - aTop) + aFormat;
            }
          }
        } catch (e) {}
      }
      getRect(aId, aPositionAbsolue) {
        const lElement = ObjetHtml_1.GHtml.getElement(aId);
        if (lElement && lElement.getBoundingClientRect) {
          const lBoundingRect = lElement.getBoundingClientRect();
          if (lBoundingRect) {
            const lOffsetX = window.pageXOffset || 0;
            const lOffsetY = window.pageYOffset || 0;
            const lRect = {
              left: lBoundingRect.left + lOffsetX,
              right: lBoundingRect.right + lOffsetX,
              top: lBoundingRect.top + lOffsetY,
              bottom: lBoundingRect.bottom + lOffsetY,
              x: lBoundingRect.left + lOffsetX,
              y: lBoundingRect.top + lOffsetY,
              width: lBoundingRect.right - lBoundingRect.left,
              height: lBoundingRect.bottom - lBoundingRect.top,
              leftScroll: aPositionAbsolue ? lBoundingRect.left : 0,
              topScroll: aPositionAbsolue ? lBoundingRect.top : 0,
            };
            if (!aPositionAbsolue) {
              const lOffsetParent = $(lElement).offsetParent().get(0);
              if (lOffsetParent && lOffsetParent !== document.documentElement) {
                const lRectOffset = this.getRect(lOffsetParent, true);
                Object.assign(lRect, {
                  x: lRect.x - lRectOffset.x,
                  y: lRect.y - lRectOffset.y,
                  left: lRect.left - lRectOffset.left,
                  right: lRect.left - lRectOffset.left + lRect.width,
                  top: lRect.top - lRectOffset.top,
                  bottom: lRect.top - lRectOffset.top + lRect.height,
                });
              }
            }
            try {
              Object.assign(lRect, this.getComputedBoxRect(lElement));
              Object.assign(lRect, {
                contentLeft: lRect.left + lRect.paddingLeft + lRect.borderLeft,
                contentRight:
                  lRect.right - lRect.paddingRight - lRect.borderRight,
                contentTop: lRect.top + lRect.paddingTop + lRect.borderTop,
                contentBottom:
                  lRect.bottom - lRect.paddingBottom - lRect.borderBottom,
              });
              lRect.contentWidth = lRect.contentRight - lRect.contentLeft;
              lRect.contentHeight = lRect.contentBottom - lRect.contentTop;
              Object.assign(lRect, {
                innerLeft: lRect.contentLeft - lRect.paddingLeft,
                innerRight: lRect.contentRight + lRect.paddingRight,
                innerTop: lRect.contentTop - lRect.paddingTop,
                innerBottom: lRect.contentBottom + lRect.paddingBottom,
              });
              lRect.innerWidth = lRect.innerRight - lRect.innerLeft;
              lRect.innerHeight = lRect.innerBottom - lRect.innerTop;
              Object.assign(lRect, {
                outerLeft: lRect.left - lRect.marginLeft,
                outerRight: lRect.right + lRect.marginRight,
                outerTop: lRect.top - lRect.marginTop,
                outerBottom: lRect.bottom + lRect.marginBottom,
              });
              lRect.outerWidth = lRect.outerRight - lRect.outerLeft;
              lRect.outerHeight = lRect.outerBottom - lRect.outerTop;
            } catch (e) {}
            return lRect;
          }
        }
        return {
          left: 0,
          right: 0,
          top: 0,
          bottom: 0,
          width: 0,
          height: 0,
          x: 0,
          y: 0,
          leftScroll: 0,
          topScroll: 0,
          erreur: true,
        };
      }
      getClientRect(aId) {
        return this.getRect(aId, true);
      }
      getComputedBoxRect(aId) {
        const lElement = ObjetHtml_1.GHtml.getElement(aId);
        let lComputedStyle = null;
        if (lElement) {
          lComputedStyle = global.getComputedStyle(lElement);
        }
        const lBox = {};
        ['left', 'right', 'top', 'bottom'].forEach((aVal) => {
          const lValMaj = aVal.ucfirst();
          lBox[`padding${lValMaj}`] = lComputedStyle
            ? parseFloat(lComputedStyle.getPropertyValue(`padding-${aVal}`))
            : 0;
          lBox[`margin${lValMaj}`] = lComputedStyle
            ? parseFloat(lComputedStyle.getPropertyValue(`margin-${aVal}`))
            : 0;
          lBox[`border${lValMaj}`] = lComputedStyle
            ? parseFloat(
                lComputedStyle.getPropertyValue(`border-${aVal}-width`),
              )
            : 0;
        });
        return lBox;
      }
      setPosition(aId, aLeft, aTop, aAjuster, aFormat) {
        this.setLeft(aId, aLeft, aAjuster, aFormat);
        this.setTop(aId, aTop, aAjuster, aFormat);
      }
      centrer(aId) {
        let lLeft, lTop, lWidth, lHeight;
        lLeft = window.pageXOffset || 0;
        lTop = window.pageYOffset || 0;
        if (document.documentElement) {
          lLeft = lLeft || document.documentElement.scrollLeft;
          lTop = lTop || document.documentElement.scrollTop;
        }
        if (window.visualViewport) {
          lLeft = lLeft || window.visualViewport.offsetLeft;
          lTop = lTop || window.visualViewport.offsetTop;
        }
        if (GNavigateur.isTactile && window.visualViewport) {
          lWidth = window.visualViewport.width;
          lHeight = window.visualViewport.height;
        } else if (GNavigateur.isTactile && window.innerHeight) {
          lWidth = window.innerWidth;
          lHeight = window.innerHeight;
        } else {
          lWidth = GNavigateur.clientL;
          lHeight = GNavigateur.clientH;
        }
        const lWidthId = this.getWidth(aId),
          lHeightId = this.getHeight(aId);
        if (lWidthId * lHeightId) {
          const lPosition = {
            x: Math.max(0, lLeft + (lWidth - lWidthId) / 2),
            y: Math.max(0, lTop + (lHeight - lHeightId) / 2),
            width: lWidthId,
            height: lHeightId,
          };
          _ramenerPositionDansLAffichage(lPosition);
          this.setPosition(
            aId,
            Math.max(0, lPosition.x),
            Math.max(0, lPosition.y),
            true,
          );
        }
      }
      placer(aId, aLeft, aTop, aEcartBordEcran) {
        let lX1 = MethodesObjet_1.MethodesObjet.isNumber(aLeft)
          ? aLeft
          : GNavigateur.pointerX || 0;
        const lX2 = lX1 + this.getWidth(aId);
        let lY1 = MethodesObjet_1.MethodesObjet.isNumber(aTop)
          ? aTop
          : GNavigateur.pointerY || 0;
        const lY2 = lY1 + this.getHeight(aId);
        const lEcartBordEcran = $.extend({ x: 2, y: 2 }, aEcartBordEcran);
        if (lX2 + lEcartBordEcran.x > GNavigateur.ecranL) {
          lX1 = GNavigateur.ecranL - this.getWidth(aId) - lEcartBordEcran.x;
        }
        if (lY2 + lEcartBordEcran.y > GNavigateur.ecranH) {
          lY1 = GNavigateur.ecranH - this.getHeight(aId) - lEcartBordEcran.y;
        }
        this.setPosition(
          aId,
          Math.max(lEcartBordEcran.x, lX1),
          Math.max(lEcartBordEcran.y, lY1),
          true,
        );
      }
      placerFiche(aId, aIdSource, aVisible, aDecalage) {
        const lPositionSource = _getPositionElement(aIdSource);
        this.placerFicheSource(
          aId,
          lPositionSource.x,
          lPositionSource.x + lPositionSource.width,
          lPositionSource.y,
          lPositionSource.y + lPositionSource.height,
          aVisible,
          aDecalage,
        );
      }
      placerFicheSource(
        aId,
        aX1Source,
        aX2Source,
        aY1Source,
        aY2Source,
        aVisible,
        aDecalage,
      ) {
        const lVisible =
            aVisible === null || aVisible === undefined
              ? ObjetHtml_1.GHtml.getElement(aId).style.visibility === 'visible'
              : aVisible,
          lDecalage = $.extend({ x: 6, y: 0 }, aDecalage);
        const lPosition = _getPositionElement(aId),
          lPositionSource = {
            x: aX1Source,
            y: aY1Source,
            width: aX2Source - aX1Source,
            height: aY2Source - aY1Source,
          };
        _ramenerPositionDansLAffichage(lPosition);
        if (!lVisible || _avecChevauchement(lPosition, lPositionSource)) {
          lPosition.x = lPositionSource.x + lPositionSource.width;
          if (
            lPosition.x + lPosition.width + lDecalage.x >
            GNavigateur.ecranL
          ) {
            lPosition.x = Math.max(
              aX1Source - lPosition.width - lDecalage.x,
              1,
            );
          } else {
            lPosition.x += lDecalage.x;
          }
          if (!lVisible) {
            lPosition.y = lPositionSource.y;
            if (
              lPosition.y + lPosition.height + lDecalage.y >
              GNavigateur.ecranH
            ) {
              lPosition.y = Math.max(
                lPositionSource.y +
                  lPositionSource.height -
                  lPosition.height -
                  lDecalage.y,
                1,
              );
            } else {
              lPosition.y += lDecalage.y;
            }
          }
        }
        _modifierPositionSiChevauchement(lPosition, lPositionSource);
        _ramenerPositionDansLAffichage(lPosition);
        if (lPosition.x < 10) {
          lPosition.x = 10;
        }
        if (lPosition.y < 10) {
          lPosition.y = 10;
        }
        this.setPosition(
          aId,
          Math.max(0, lPosition.x),
          Math.max(0, lPosition.y),
          true,
        );
      }
      deplacerSiChevauchement(aIdMobile, aIdReference) {
        const lPosition = _getPositionElement(aIdMobile),
          lPositionSource = _getPositionElement(aIdReference);
        _modifierPositionSiChevauchement(lPosition, lPositionSource);
        this.setPosition(
          aIdMobile,
          Math.max(0, lPosition.x),
          Math.max(0, lPosition.y),
          true,
        );
      }
      getScrollTop(aId) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        return E ? E.scrollTop : 0;
      }
      setScrollTop(aId, aScrollTop) {
        const E = ObjetHtml_1.GHtml.getElement(aId);
        if (E && ObjetHtml_1.GHtml.estElement(E)) {
          E.scrollTop = aScrollTop;
        }
      }
      setTaille(aId, aWidth, aHeight, aFormat) {
        this.setWidth(aId, aWidth, !!aFormat, aFormat);
        this.setHeight(aId, aHeight, !!aFormat, aFormat);
      }
      positionDansZone(aPosition, aId) {
        const lRect = this.getClientRect(aId);
        return (
          !!aPosition &&
          aPosition.x > lRect.left &&
          aPosition.x < lRect.right &&
          aPosition.y > lRect.top &&
          aPosition.y < lRect.bottom
        );
      }
      estEnCollision(aId1, aId2) {
        const E1 = ObjetHtml_1.GHtml.getElement(aId1);
        const E2 = ObjetHtml_1.GHtml.getElement(aId2);
        if (!!E1 && !!E2) {
          const x1 = this.getLeft(aId1);
          const y1 = this.getTop(aId1);
          const h1 = this.getHeight(aId1);
          const w1 = this.getWidth(aId1);
          const b1 = y1 + h1;
          const r1 = x1 + w1;
          const x2 = this.getLeft(aId2);
          const y2 = this.getTop(aId2);
          const h2 = this.getHeight(aId2);
          const w2 = this.getWidth(aId2);
          const b2 = y2 + h2;
          const r2 = x2 + w2;
          return !(b1 < y2 || y1 > b2 || r1 < x2 || x1 > r2);
        }
        return false;
      }
      getPositionEventJQuery(aEvent) {
        if (!aEvent) {
          return { x: 0, y: 0 };
        }
        if (aEvent.pageX !== undefined) {
          return { x: Math.round(aEvent.pageX), y: Math.round(aEvent.pageY) };
        }
        const lEventTouch = aEvent;
        if (
          lEventTouch.originalEvent &&
          lEventTouch.originalEvent.changedTouches &&
          lEventTouch.originalEvent.changedTouches[0]
        ) {
          return {
            x: lEventTouch.originalEvent.changedTouches[0].pageX || 0,
            y: lEventTouch.originalEvent.changedTouches[0].pageY || 0,
          };
        }
        return { x: 0, y: 0 };
      }
      remToPixels(aRem) {
        if (!this._cacheFontSize) {
          this._cacheFontSize = ObjetStyle_1.GStyle.getFloatComputedValue(
            document.documentElement,
            'font-size',
          );
        }
        return aRem * this._cacheFontSize;
      }
      scrollToElement(aElement, aElementScrollParent) {
        const lElement = ObjetHtml_1.GHtml.getElement(aElement);
        const lElementScroll =
          ObjetHtml_1.GHtml.getElement(aElementScrollParent);
        if (!lElement || !lElementScroll) {
          return;
        }
        const lRect = this.getRect(lElement, true);
        const lRectScroll = this.getRect(lElementScroll, true);
        let lTop = 0;
        let lLeft = 0;
        let lJElement = $(lElement);
        while (
          lJElement.get(0) !== lElementScroll &&
          $.contains(lElementScroll, lJElement.get(0))
        ) {
          const lPosElement = lJElement.position();
          lTop += lPosElement.top;
          lLeft += lPosElement.left;
          lJElement = lJElement.offsetParent();
          if (/^body|html$/i.test(lJElement[0].nodeName)) {
            break;
          }
        }
        const lPosition = {
          top: lTop,
          left: lLeft,
          heightVisible: Math.min(lRect.height, lRectScroll.height),
          widthVisible: Math.min(lRect.width, lRectScroll.width),
        };
        if (lPosition.top < 0) {
          lElementScroll.scrollTop = -lPosition.top;
        } else if (
          lPosition.top + lPosition.heightVisible - lElementScroll.scrollTop >
          lRectScroll.height
        ) {
          lElementScroll.scrollTop =
            lPosition.top +
            lPosition.heightVisible -
            lElementScroll.scrollTop -
            lRectScroll.height;
        }
        if (lPosition.left < 0) {
          lElementScroll.scrollLeft = -lPosition.left;
        } else if (
          lPosition.left + lPosition.widthVisible - lElementScroll.scrollLeft >
          lRectScroll.width
        ) {
          lElementScroll.scrollLeft =
            lPosition.left +
            lPosition.widthVisible -
            lElementScroll.scrollLeft -
            lRectScroll.width;
        }
      }
    }
    function _ramenerPositionDansLAffichage(aPosition) {
      if (aPosition.x + aPosition.width > GNavigateur.ecranL) {
        aPosition.x = Math.max(0, GNavigateur.ecranL - aPosition.width);
      }
      if (aPosition.y + aPosition.height > GNavigateur.ecranH) {
        aPosition.y = Math.max(0, GNavigateur.ecranH - aPosition.height);
      }
    }
    function _avecChevauchement(aPosition, aPositionSource) {
      return (
        aPosition.x < aPositionSource.x + aPositionSource.width &&
        aPosition.x + aPosition.width > aPositionSource.x &&
        aPosition.y < aPositionSource.y + aPositionSource.height &&
        aPosition.y + aPosition.height > aPositionSource.y
      );
    }
    function _getPositionElement(aElement) {
      const lX = GPosition.getLeft(aElement),
        lY = GPosition.getTop(aElement),
        lWidth = GPosition.getWidth(aElement),
        lHeight = GPosition.getHeight(aElement);
      return { x: lX, y: lY, width: lWidth, height: lHeight };
    }
    function _modifierPositionSiChevauchement(
      aPositionMobile,
      aPositionSource,
    ) {
      if (aPositionMobile.x + aPositionMobile.width > GNavigateur.ecranL) {
        aPositionMobile.x = GNavigateur.ecranL - aPositionMobile.width;
      }
      if (aPositionMobile.y + aPositionMobile.height > GNavigateur.ecranH) {
        aPositionMobile.y = GNavigateur.ecranH - aPositionMobile.height;
      }
      if (_avecChevauchement(aPositionMobile, aPositionSource)) {
        aPositionMobile.x = aPositionSource.x + aPositionSource.width + 6;
        if (aPositionMobile.x + aPositionMobile.width > GNavigateur.ecranL) {
          aPositionMobile.x = Math.max(
            aPositionSource.x - aPositionMobile.width,
            1,
          );
        }
      }
      if (aPositionMobile.x + aPositionMobile.width > GNavigateur.ecranL) {
        aPositionMobile.x = GNavigateur.ecranL - aPositionMobile.width;
      }
      if (aPositionMobile.x < 6) {
        aPositionMobile.x = 6;
      }
      if (_avecChevauchement(aPositionMobile, aPositionSource)) {
        aPositionMobile.y = aPositionSource.y + aPositionSource.height + 6;
        if (aPositionMobile.y + aPositionMobile.height > GNavigateur.ecranH) {
          aPositionMobile.y = Math.max(
            aPositionSource.y - aPositionMobile.height,
            1,
          );
        }
      }
      if (aPositionMobile.y + aPositionMobile.height > GNavigateur.ecranH) {
        aPositionMobile.y = GNavigateur.ecranH - aPositionMobile.height;
      }
    }
    const GPosition = new ObjetPosition();
    exports.GPosition = GPosition;
    $(window).one('load', () => {
      GPosition._cacheFontSize = null;
    });
  },
  fn: 'objetposition.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreBoutonSouris = void 0;
    var EGenreBoutonSouris;
    (function (EGenreBoutonSouris) {
      EGenreBoutonSouris[(EGenreBoutonSouris['Gauche'] = 0)] = 'Gauche';
      EGenreBoutonSouris[(EGenreBoutonSouris['Droite'] = 1)] = 'Droite';
    })(
      EGenreBoutonSouris ||
        (exports.EGenreBoutonSouris = EGenreBoutonSouris = {}),
    );
  },
  fn: 'enumere_boutonsouris.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EEvent = void 0;
    var EEvent;
    (function (EEvent) {
      EEvent[(EEvent['SurError'] = 1)] = 'SurError';
      EEvent[(EEvent['SurResize'] = 2)] = 'SurResize';
      EEvent[(EEvent['SurPreResize'] = 3)] = 'SurPreResize';
      EEvent[(EEvent['SurPostResize'] = 4)] = 'SurPostResize';
      EEvent[(EEvent['SurClick'] = 5)] = 'SurClick';
      EEvent[(EEvent['SurScroll'] = 6)] = 'SurScroll';
      EEvent[(EEvent['SurKeyDown'] = 7)] = 'SurKeyDown';
      EEvent[(EEvent['SurKeyUp'] = 8)] = 'SurKeyUp';
      EEvent[(EEvent['SurKeyPress'] = 9)] = 'SurKeyPress';
      EEvent[(EEvent['SurMouseMove'] = 10)] = 'SurMouseMove';
      EEvent[(EEvent['SurMouseDown'] = 11)] = 'SurMouseDown';
      EEvent[(EEvent['SurSelectStart'] = 12)] = 'SurSelectStart';
      EEvent[(EEvent['SurMouseUp'] = 13)] = 'SurMouseUp';
      EEvent[(EEvent['SurFinDeplacement'] = 14)] = 'SurFinDeplacement';
      EEvent[(EEvent['SurBlur'] = 15)] = 'SurBlur';
      EEvent[(EEvent['SurChange'] = 16)] = 'SurChange';
      EEvent[(EEvent['SurDblClick'] = 17)] = 'SurDblClick';
      EEvent[(EEvent['SurFocus'] = 18)] = 'SurFocus';
      EEvent[(EEvent['SurFocusIn'] = 19)] = 'SurFocusIn';
      EEvent[(EEvent['SurFocusOut'] = 20)] = 'SurFocusOut';
      EEvent[(EEvent['SurLoad'] = 21)] = 'SurLoad';
      EEvent[(EEvent['SurUnload'] = 22)] = 'SurUnload';
      EEvent[(EEvent['SurMouseOut'] = 23)] = 'SurMouseOut';
      EEvent[(EEvent['SurMouseOver'] = 24)] = 'SurMouseOver';
      EEvent[(EEvent['SurFinResize'] = 25)] = 'SurFinResize';
    })(EEvent || (exports.EEvent = EEvent = {}));
  },
  fn: 'enumere_event.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetNavigateur = void 0;
    require('Divers.js');
    require('DeclarationJQuery.js');
    const Invocateur_1 = require('Invocateur');
    const ObjetSupport_1 = require('ObjetSupport');
    const ObjetPosition_1 = require('ObjetPosition');
    const ToucheClavier_1 = require('ToucheClavier');
    const TypeNote_1 = require('TypeNote');
    const Enumere_BoutonSouris_1 = require('Enumere_BoutonSouris');
    const Enumere_Event_1 = require('Enumere_Event');
    global.GNavigateur = null;
    let uTimerPresenceUtilisateur;
    let uTimerDeclencherVerifierPresenceUtilisateur = null;
    const c_dureeInteractionUtilisateur = 10 * 60 * 1000;
    let u_count_modal_mobile = 0;
    class ObjetNavigateur {
      constructor() {
        this.versionAndroid = [0, 0, 0];
        this.Nom = 'GNavigateur';
        this.OnEvent = [];
        this.nbBlocageClavier = 0;
        this.interactionUtilisateur = true;
        this.chargementTermine = false;
        if (document.body) {
          this.initialiser();
        } else {
          const lThis = this;
          $(document).ready(() => {
            lThis.initialiser();
          });
        }
        this.interfaceBloquee = false;
        this.declarationEvenements();
      }
      initialiser() {
        this.UserAgent = navigator.userAgent;
        const LIndex = this.UserAgent.lastIndexOf('MSIE');
        this.isIpad = this.UserAgent.lastIndexOf('iPad') !== -1;
        this.isIphone = this.UserAgent.lastIndexOf('iPhone') !== -1;
        this.isAndroid = this.UserAgent.lastIndexOf('Android') !== -1;
        this.isWinMob =
          this.UserAgent.toLowerCase().lastIndexOf('windows phone') !== -1 ||
          this.UserAgent.toLowerCase().lastIndexOf('windows mobile') !== -1;
        this.isEdge = this.UserAgent.lastIndexOf('Edge') !== -1;
        this.isMacOs = this.UserAgent.search(/Mac\s?OS/gi) > -1;
        if (this.isAndroid) {
          try {
            const lMatchAndroid = this.UserAgent.match(/android\s([0-9.]*)/i);
            if (lMatchAndroid && lMatchAndroid[1]) {
              const lVersionAndroid = lMatchAndroid[1].split('.');
              [0, 1, 2].forEach((aVal) => {
                this.versionAndroid[aVal] = parseInt(
                  lVersionAndroid[aVal] || '0',
                  10,
                );
              });
            }
          } catch (e) {}
        }
        if (this.isIpad || this.isIphone) {
          try {
            const lMatchIOS = (navigator.appVersion || '').match(
              /OS (\d+)_(\d+)_?(\d+)?/,
            );
            if (lMatchIOS) {
              this.isIOS = true;
              this.versionIOS = [
                parseInt(lMatchIOS[1], 10),
                parseInt(lMatchIOS[2], 10),
                parseInt(lMatchIOS[3] || '0', 10),
              ];
            }
          } catch (e) {}
        }
        if (this.isMacOs) {
          try {
            const lMatchMacOS = (navigator.appVersion || '').match(
              /Mac OS X (\d+)_(\d+)_?(\d+)?/,
            );
            if (lMatchMacOS) {
              this.versionMacOS = [
                parseInt(lMatchMacOS[1], 10),
                parseInt(lMatchMacOS[2], 10),
                parseInt(lMatchMacOS[3] || '0', 10),
              ];
            }
          } catch (e) {}
        }
        if (
          document.body.parentNode.parentNode.firstChild.nodeValue === null ||
          document.body.parentNode.parentNode.firstChild.nodeValue === undefined
        ) {
          this.IsIE9 =
            parseInt(this.UserAgent.substring(LIndex + 5, LIndex + 6), 10) ===
            9;
        }
        try {
          this.IsIE = LIndex !== -1;
        } catch (e) {
          this.IsIE = LIndex !== -1;
        }
        this.IsIE =
          LIndex !== -1 || this.UserAgent.lastIndexOf('Trident') !== -1;
        if (this.IsIE) {
          this.IEVersion = this.UserAgent.match(/MSIE (.*?);/)
            ? parseInt(this.UserAgent.match(/MSIE (.*?);/)[1], 10)
            : 0;
          this.IEModeCompatible = this.IEVersion > document.documentMode;
        }
        this.isIETouch = this.IsIE && /Touch/.test(this.UserAgent);
        this.isIE9Mobile =
          this.IsIE && /Windows Phone OS 7/.test(this.UserAgent);
        this.isTactile =
          this.isIpad || this.isIphone || this.isAndroid || this.isIETouch;
        this.IsWebKit = this.UserAgent.lastIndexOf('AppleWebKit/') > -1;
        this.IsGecko =
          !this.IsIE &&
          this.UserAgent.lastIndexOf('Gecko') > -1 &&
          this.UserAgent.lastIndexOf('KHTML') === -1;
        this.IsOpera =
          Object.prototype.toString.call(window.opera) === '[object Opera]';
        this.isSafari =
          this.UserAgent.search(/safari/gi) > -1 &&
          this.UserAgent.search(/chrome/gi) === -1;
        if (
          !this.isTactile &&
          this.isSafari &&
          this.isMacOs &&
          this.UserAgent.lastIndexOf('Macintosh') !== -1 &&
          'ontouchstart' in window &&
          window.navigator &&
          window.navigator.maxTouchPoints > 1 &&
          !this.isAndroid
        ) {
          this.isIpad = true;
          this.isTactile = true;
        }
        this.withContentEditable =
          this.IsIE ||
          this.IsOpera ||
          this.IsGecko ||
          (this.IsWebKit &&
            !this.isAndroid &&
            !this.isIphone &&
            !this.isIpad) ||
          (this.IsWebKit &&
            parseInt(this.UserAgent.match(/AppleWebKit\/(\d*)/)[1], 10) >= 534);
        ObjetSupport_1.Support.addInit(() => {
          _uniformisationTouch();
          if (
            ObjetSupport_1.Support.supportTouch &&
            (this.isIphone || this.isIpad)
          ) {
            _emulationContextMenu.call(this);
          }
          if (ObjetSupport_1.Support.supportTouch) {
            document.addEventListener(
              'touchmove',
              (aEvent) => {
                if (
                  aEvent.target.closest('.ie-draggable-handle') &&
                  !aEvent.target.closest('.ie-draggable-handle-cancel')
                ) {
                  aEvent.preventDefault();
                }
              },
              { passive: false },
            );
          }
        });
        const lThis = this;
        document.addEventListener(
          'pointerdown',
          (aEvent) => {
            lThis.pointerX = aEvent.pageX;
            lThis.pointerY = aEvent.pageY;
          },
          { capture: true },
        );
        document.addEventListener(
          'pointermove',
          (aEvent) => {
            lThis.pointerX = aEvent.pageX;
            lThis.pointerY = aEvent.pageY;
          },
          { capture: true },
        );
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.eventIOAjax,
          this._surEventIOAjax.bind(this),
        );
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.patience,
          this._surPatience.bind(this),
        );
        this.setIsTactile(this.isTactile);
      }
      get ecranL() {
        return document.body.scrollWidth;
      }
      get ecranH() {
        return document.body.scrollHeight;
      }
      get clientL() {
        return document.body.clientWidth;
      }
      get clientH() {
        return document.body.clientHeight;
      }
      get isLayoutTactile() {
        return false;
      }
      resetCodeTouche() {
        this.CodeTouche = null;
        this.ShiftTouche = null;
        this.AltTouche = null;
        this.CtrlTouche = null;
        this.CmdTouche = null;
      }
      setIsTactile(aVal) {
        this.isTactile = aVal;
        if (aVal) {
          $(document.body).addClass('isTactile');
        } else {
          $(document.body).removeClass('isTactile');
        }
      }
      getBloquerClavier() {
        return this.nbBlocageClavier > 0;
      }
      _surBeforeUnload() {
        let lData;
        if (Invocateur_1.Invocateur) {
          lData = {};
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.autorisationRechargementPage,
            lData,
          );
          if (lData.message) {
            return lData.message;
          }
        }
        if (window.GApplication) {
          GApplication._unloadEnCours = true;
          setTimeout(() => {
            if (window.GApplication) {
              GApplication._unloadEnCours = false;
            }
          }, 500);
        }
      }
      viderCache() {
        this.OnEvent = [];
        if (uTimerPresenceUtilisateur) {
          clearTimeout(uTimerPresenceUtilisateur);
        }
        if (uTimerDeclencherVerifierPresenceUtilisateur) {
          clearTimeout(uTimerDeclencherVerifierPresenceUtilisateur);
        }
      }
      getEventInvocateur(aGenreEvent) {
        return 'IIE_EventNavigateur_' + aGenreEvent;
      }
      stopperEvenement(AEvenement) {
        AEvenement = _getEvenement(AEvenement);
        if (AEvenement) {
          AEvenement.cancelBubble = true;
          if (AEvenement.stopPropagation) {
            AEvenement.stopPropagation();
          }
        }
      }
      bloquerValeurEvenement(aEvenement) {
        aEvenement = _getEvenement(aEvenement);
        if (aEvenement) {
          if (aEvenement.preventDefault) {
            aEvenement.preventDefault();
          } else {
            aEvenement.returnValue = false;
          }
        }
      }
      declarationEvenements() {
        try {
          const lThis = this;
          window.onerror = function (AMessage, AUrl, ALigne) {
            IE.log.addLog(
              'ObjetNavigateur.surError : ' +
                AMessage +
                '; ' +
                AUrl +
                '; Ligne : ' +
                ALigne,
              'ERROR',
              IE.log.genre.Erreur,
            );
            lThis.declencherEvenements(Enumere_Event_1.EEvent.SurError);
          };
          document.onclick = () => {
            this.declencherEvenements(Enumere_Event_1.EEvent.SurClick);
          };
          document.onkeyup = () => {
            this.altPrecedent = this.AltTouche;
            this.shiftPrecedent = this.ShiftTouche;
            this.ShiftTouche = null;
            this.AltTouche = null;
            this.CtrlTouche = null;
            this.CmdTouche = null;
            this.declencherEvenements(Enumere_Event_1.EEvent.SurKeyUp);
          };
          document.onkeypress = (e) => {
            this.setCaractereTouche(e);
            return this.declencherEvenements(
              Enumere_Event_1.EEvent.SurKeyPress,
            );
          };
          document.onmousemove = () => {
            this.enDeplacement();
            this.declencherEvenements(Enumere_Event_1.EEvent.SurMouseMove);
          };
          document.onmouseup = () => {
            this.SourisBouton = false;
            this.finDeplacement();
            this.declencherEvenements(Enumere_Event_1.EEvent.SurMouseUp);
          };
          document.onmousedown = () => {
            this.declencherEvenements(Enumere_Event_1.EEvent.SurMouseDown);
          };
          document.onselectstart = () => {
            this.declencherEvenements(Enumere_Event_1.EEvent.SurSelectStart);
          };
          $(document).on({
            keydown: (aEvent) => {
              if (aEvent.ctrlKey && aEvent.keyCode === 188) {
                Invocateur_1.Invocateur.evenement(
                  Invocateur_1.ObjetInvocateur.events.toucheDEBUG,
                );
              }
              return this.declencherEvenements(
                Enumere_Event_1.EEvent.SurKeyDown,
              );
            },
          });
          $(document).on(
            'click dblclick mousedown mouseup mousemove ' +
              'keydown keyup keypress ' +
              'touchstart touchend touchcancel touchmove ' +
              'pointerdown pointerup pointermove ' +
              'contextmenu ' +
              'ie-pointerdownlong ' +
              'ie-doubletap',
            function (event) {
              if (
                (event.type === 'click' || event.type === 'dblclick') &&
                event.which !== 1
              ) {
                return;
              }
              Invocateur_1.Invocateur.evenement(
                lThis.getEventInvocateur(event.type),
                event,
                this,
              );
            },
          );
          document.addEventListener(
            'pointerdown',
            function (aEvent) {
              Invocateur_1.Invocateur.evenement(
                `${lThis.getEventInvocateur(aEvent.type)}.capture`,
                aEvent,
                this,
              );
            },
            { capture: true },
          );
          document.addEventListener(
            'keydown',
            function (aEvent) {
              Invocateur_1.Invocateur.evenement(
                `${lThis.getEventInvocateur(aEvent.type)}.capture`,
                aEvent,
                this,
              );
            },
            { capture: true },
          );
          this._verifierPresenceUtilisateur();
          $(document).on('visibilitychange', () => {
            switch (document.hidden) {
              case true:
                lThis._utilisateurNonPresent();
                break;
              case false:
                lThis._verifierPresenceUtilisateur();
                break;
            }
          });
          const lEventMap = {};
          lEventMap.resize = (aEvent) => {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.resizeNavigateur,
              aEvent,
            );
            this.surResize();
          };
          lEventMap.scroll = () => {
            this.declencherEvenements(Enumere_Event_1.EEvent.SurScroll);
          };
          lEventMap.load = () => {
            this.chargementTermine = true;
          };
          lEventMap.pagehide = () => {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.surRechargementPage,
            );
            this.viderCache();
          };
          lEventMap.beforeunload = this._surBeforeUnload;
          lEventMap.blur = () => {
            this.resetCodeTouche();
          };
          if (!IE.estMobile) {
            lEventMap.orientationchange = () => {
              if (lThis.isTactile) {
                lThis._surResize();
              }
            };
          }
          $(window).on(lEventMap, { instance: this });
          document.addEventListener(
            'mousedown',
            (aEvent) => {
              lThis.SourisBouton = true;
              lThis.BoutonSouris = lThis.getBoutonSouris(aEvent);
            },
            true,
          );
          document.addEventListener(
            'keydown',
            (aEvent) => {
              if (lThis) {
                lThis.setCodeTouche(aEvent);
                lThis.CaractereTouche = '';
              }
            },
            true,
          );
          document.addEventListener(
            'keypress',
            (aEvent) => {
              if (lThis) {
                lThis.setCaractereTouche(aEvent);
              }
            },
            true,
          );
          document.addEventListener(
            'keyup',
            (aEvent) => {
              if (lThis) {
                lThis.setCodeTouche(aEvent);
              }
            },
            true,
          );
        } catch (e) {
          IE.log.addLog(`exception - ${e}`);
        }
      }
      _surEventIOAjax(aParametres) {
        if (
          aParametres.init ||
          aParametres.actualisation ||
          aParametres.ignorerBlocageClavier
        ) {
          return;
        }
        this._surPatience(!!aParametres.emission);
      }
      _surPatience(aActiver) {
        this.nbBlocageClavier = this.nbBlocageClavier + (aActiver ? 1 : -1);
        this.nbBlocageClavier = Math.max(0, this.nbBlocageClavier);
      }
      getZIndexModalMobile(aAdd) {
        if (aAdd === true) {
          u_count_modal_mobile += 1;
        } else if (aAdd === false) {
          u_count_modal_mobile = Math.max(0, u_count_modal_mobile - 1);
        }
        return 1000 + u_count_modal_mobile * 2;
      }
      addEvent(AGenre, APere, AEvenement) {
        if (!this.chargementTermine) {
          return;
        }
        if (!AEvenement || !APere) {
          return;
        }
        if (!this.OnEvent[AGenre]) {
          this.OnEvent[AGenre] = [];
        }
        this.OnEvent[AGenre].push({ evenement: AEvenement, pere: APere });
      }
      delEvent(AGenre, APere) {
        const LNom = APere.getNom();
        const LArrayEvent = this.OnEvent[AGenre];
        if (!LArrayEvent) {
          IE.log.addLog(
            'delEvent sur un element non ajouté ! APere = ' + APere.getNom(),
            null,
            IE.log.genre.Erreur,
          );
          return;
        }
        let i = 0;
        while (i < LArrayEvent.length) {
          if (LArrayEvent[i].pere.getNom() === LNom) {
            this.OnEvent[AGenre].splice(i, 1);
          } else {
            i++;
          }
        }
      }
      declencherEvenements(AGenre) {
        let LContinuer;
        for (
          let I = 0;
          this.OnEvent[AGenre] && I < this.OnEvent[AGenre].length;
          I++
        ) {
          let lEvent = this.OnEvent[AGenre][I];
          LContinuer =
            !lEvent.evenement.call(lEvent.pere) && LContinuer !== false;
        }
        return LContinuer;
      }
      isToucheEspace() {
        return (
          this.CodeTouche === ToucheClavier_1.ToucheClavier.Espace &&
          !this.ShiftTouche
        );
      }
      isToucheRetourChariot() {
        return (
          this.CodeTouche === ToucheClavier_1.ToucheClavier.RetourChariot &&
          !this.ShiftTouche &&
          !this.AltTouche &&
          !this.CtrlTouche
        );
      }
      isToucheSelection() {
        return this.isToucheRetourChariot() || this.isToucheEspace();
      }
      isToucheMenuContextuel() {
        return (
          this.CodeTouche === ToucheClavier_1.ToucheClavier.ContextMenu ||
          (this.CodeTouche === ToucheClavier_1.ToucheClavier.RetourChariot &&
            !this.ShiftTouche &&
            (this.AltTouche || this.CtrlTouche))
        );
      }
      isToucheEdition() {
        return (
          this.CodeTouche === ToucheClavier_1.ToucheClavier.RetourChariot &&
          this.ShiftTouche &&
          !this.AltTouche &&
          !this.CtrlTouche
        );
      }
      isToucheSupprimer() {
        return (
          (this.CodeTouche === 46 &&
            !this.ShiftTouche &&
            !this.AltTouche &&
            !this.CtrlTouche) ||
          (this.CodeTouche === ToucheClavier_1.ToucheClavier.Backspace &&
            this.CmdTouche)
        );
      }
      isToucheEchap() {
        return this.CodeTouche === ToucheClavier_1.ToucheClavier.Echap;
      }
      isToucheFlecheHaut() {
        return this.CodeTouche === ToucheClavier_1.ToucheClavier.FlecheHaut;
      }
      isToucheFlecheBas() {
        return this.CodeTouche === ToucheClavier_1.ToucheClavier.FlecheBas;
      }
      isToucheFlecheGauche() {
        return this.CodeTouche === ToucheClavier_1.ToucheClavier.FlecheGauche;
      }
      isToucheFlecheDroite() {
        return this.CodeTouche === ToucheClavier_1.ToucheClavier.FlecheDroite;
      }
      isToucheFleche() {
        return (
          this.isToucheFlecheHaut() ||
          this.isToucheFlecheBas() ||
          this.isToucheFlecheGauche() ||
          this.isToucheFlecheDroite()
        );
      }
      isToucheTab() {
        return this.CodeTouche === ToucheClavier_1.ToucheClavier.Tab;
      }
      isToucheShiftTab() {
        return (
          this.CodeTouche === ToucheClavier_1.ToucheClavier.Tab &&
          this.ShiftTouche
        );
      }
      isToucheOnlyTab() {
        return (
          this.CodeTouche === ToucheClavier_1.ToucheClavier.Tab &&
          !this.ShiftTouche
        );
      }
      isToucheOnglets() {
        return this.CodeTouche === 66 && (this.AltTouche || this.CtrlTouche);
      }
      isToucheBackspace() {
        return (
          this.CodeTouche === ToucheClavier_1.ToucheClavier.Backspace &&
          !this.ShiftTouche &&
          !this.AltTouche &&
          !this.CtrlTouche
        );
      }
      getToucheAltNum(ADeb, AFin) {
        let LCodeTouche;
        if (this.CodeTouche >= ToucheClavier_1.ToucheClavier.Numpad_0) {
          LCodeTouche =
            this.CodeTouche - ToucheClavier_1.ToucheClavier.Numpad_0;
          return this.altPrecedent &&
            !this.shiftPrecedent &&
            LCodeTouche >= ADeb &&
            LCodeTouche <= AFin
            ? LCodeTouche
            : null;
        }
        LCodeTouche = this.CodeTouche - ToucheClavier_1.ToucheClavier._0;
        return this.altPrecedent &&
          this.shiftPrecedent &&
          LCodeTouche >= ADeb &&
          LCodeTouche <= AFin
          ? LCodeTouche
          : null;
      }
      estCaractereDecimal() {
        return this.estCaractere('0-9');
      }
      estCaractereHexa() {
        return this.estCaractere('0-9abcdefABCDEF');
      }
      estCaractereDate() {
        return this.estCaractere('0-9');
      }
      estCaractereNote(
        aAvecLettre,
        aAvecVirgule,
        aAvecMoins,
        aCaractereAnnotation,
      ) {
        return TypeNote_1.TypeNote.estCaractereNote(
          this.CaractereTouche,
          aAvecLettre,
          aAvecVirgule,
          aAvecMoins,
          aCaractereAnnotation,
        );
      }
      estCaractereAlphaNumerique() {
        return (
          !this.AltTouche &&
          !this.CtrlTouche &&
          new RegExp('[0-9.a-z.A-Z]').test(this.CaractereTouche)
        );
      }
      estCaractere(aRegExp) {
        return ToucheClavier_1.ToucheClavierUtil.estCaractere(
          this.CaractereTouche,
          aRegExp,
        );
      }
      estSourisBoutonGauche() {
        return (
          this.BoutonSouris === Enumere_BoutonSouris_1.EGenreBoutonSouris.Gauche
        );
      }
      estSourisBoutonDroit() {
        return (
          this.BoutonSouris === Enumere_BoutonSouris_1.EGenreBoutonSouris.Droite
        );
      }
      setCaractereTouche(e) {
        e = e || window.event;
        this.CaractereTouche =
          e.charCode === 0 ? '' : String.fromCharCode(e.charCode || e.keyCode);
      }
      setCodeTouche(e) {
        e = e || window.event;
        this.CodeTouche = e.keyCode;
        this.ShiftTouche = e.shiftKey;
        this.AltTouche = e.altKey;
        this.CtrlTouche = e.ctrlKey;
        this.CmdTouche = e.metaKey;
      }
      getBoutonSouris(e) {
        if (e) {
          switch (e.button) {
            case 0:
              return Enumere_BoutonSouris_1.EGenreBoutonSouris.Gauche;
            case 2:
              return Enumere_BoutonSouris_1.EGenreBoutonSouris.Droite;
          }
        } else {
          switch (window.event.button) {
            case 1:
              return Enumere_BoutonSouris_1.EGenreBoutonSouris.Gauche;
            case 2:
              return Enumere_BoutonSouris_1.EGenreBoutonSouris.Droite;
          }
        }
      }
      getLargeurBarreDeScroll() {
        return ObjetSupport_1.Support.tailleScrollBar || 8;
      }
      getHost() {
        return window.location.href.slice(
          0,
          window.location.href.lastIndexOf('/') + 1,
        );
      }
      surResize() {
        if (!IE.estMobile && !this.isTactile) {
          this._surResize();
        }
      }
      _surResize() {
        if (IE.estMobile) {
          return;
        }
        if (this.EnResize) {
          window.clearTimeout(this.TimerResize);
        } else {
          this.EnResize = true;
          this.declencherEvenements(Enumere_Event_1.EEvent.SurPreResize);
        }
        this.declencherEvenements(Enumere_Event_1.EEvent.SurResize);
        this.TimerResize = setTimeout(() => {
          try {
            this.declencherEvenements(Enumere_Event_1.EEvent.SurPostResize);
            this.declencherEvenements(Enumere_Event_1.EEvent.SurFinResize);
          } finally {
            this.EnResize = false;
          }
        }, 300);
      }
      positionnerMenuContextuelSurId(aId, aDeltaX, aDeltaY) {
        const lElement = document.getElementById(aId);
        if (lElement) {
          this.pointerX = aDeltaX
            ? ObjetPosition_1.GPosition.getLeft(lElement) + aDeltaX
            : ObjetPosition_1.GPosition.getLeft(lElement);
          this.pointerY = aDeltaY
            ? ObjetPosition_1.GPosition.getTop(lElement) + aDeltaY
            : ObjetPosition_1.GPosition.getTop(lElement);
        }
      }
      debDeplacement(APere, AId) {
        this._idDeplacement = AId;
        this.Deplacement = true;
        this.DecalageX =
          this.pointerX -
          ObjetPosition_1.GPosition.getLeft(this._idDeplacement);
        this.DecalageY =
          this.pointerY - ObjetPosition_1.GPosition.getTop(this._idDeplacement);
      }
      enDeplacement() {
        if (this.Deplacement) {
          ObjetPosition_1.GPosition.placer(
            this._idDeplacement,
            this.pointerX - this.DecalageX,
            this.pointerY - this.DecalageY,
          );
        }
      }
      finDeplacement() {
        if (this.Deplacement) {
          this.Deplacement = false;
          this.declencherEvenements(Enumere_Event_1.EEvent.SurFinDeplacement);
          delete this._idDeplacement;
        }
      }
      _utilisateurNonPresent() {
        if (uTimerPresenceUtilisateur) {
          clearTimeout(uTimerPresenceUtilisateur);
          uTimerPresenceUtilisateur = null;
        }
        if (this.interactionUtilisateur) {
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.modificationPresenceUtilisateur,
            false,
          );
          this.interactionUtilisateur = false;
        }
      }
      _verifierPresenceUtilisateur() {
        if (!this.interactionUtilisateur) {
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.modificationPresenceUtilisateur,
            true,
          );
        }
        this.interactionUtilisateur = true;
        if (uTimerPresenceUtilisateur) {
          clearTimeout(uTimerPresenceUtilisateur);
          uTimerPresenceUtilisateur = null;
        }
        uTimerPresenceUtilisateur = setTimeout(
          this._utilisateurNonPresent.bind(this),
          c_dureeInteractionUtilisateur,
        );
        $(document).off(
          'mousedown keydown mousemove pointerdown touchstart',
          this._verifierPresenceUtilisateur.bind(this),
        );
        if (uTimerDeclencherVerifierPresenceUtilisateur) {
          clearTimeout(uTimerDeclencherVerifierPresenceUtilisateur);
          uTimerDeclencherVerifierPresenceUtilisateur = null;
        }
        uTimerDeclencherVerifierPresenceUtilisateur = setTimeout(() => {
          uTimerDeclencherVerifierPresenceUtilisateur = null;
          $(document).on(
            'mousedown keydown mousemove pointerdown touchstart',
            this._verifierPresenceUtilisateur.bind(this),
          );
        }, 1000 * 10);
      }
    }
    exports.ObjetNavigateur = ObjetNavigateur;
    function _emulationContextMenu() {
      const lDelai = 500;
      let uGestionTouch = null;
      const const_margesDeplacementContextMenu = 100;
      function _touchstart(event) {
        const lPosition =
          ObjetPosition_1.GPosition.getPositionEventJQuery(event);
        uGestionTouch = {
          x: lPosition.x,
          y: lPosition.y,
          timeStart: Date.now(),
        };
      }
      function _toucheend(aEvent) {
        let lGestionTouch = uGestionTouch;
        uGestionTouch = null;
        if (lGestionTouch && Date.now() - lGestionTouch.timeStart > lDelai) {
          const lPosition =
            ObjetPosition_1.GPosition.getPositionEventJQuery(aEvent);
          const lAccepterContextMenu =
            aEvent.target &&
            Math.abs(lPosition.x - lGestionTouch.x) <
              const_margesDeplacementContextMenu &&
            Math.abs(lPosition.y - lGestionTouch.y) <
              const_margesDeplacementContextMenu &&
            (!ObjetPosition_1.GPosition ||
              ObjetPosition_1.GPosition.positionDansZone(
                lPosition,
                aEvent.target,
              ));
          if (!lAccepterContextMenu) {
            return;
          }
          aEvent.stopImmediatePropagation();
          aEvent.preventDefault();
          const lEvent = $.Event('contextmenu', {
            pointerType: 'touch',
            originalEvent: aEvent.originalEvent,
          });
          setTimeout(() => {
            $(aEvent.target).trigger(lEvent);
          }, 0);
        }
      }
      $(document).on({
        touchstart: _touchstart,
        touchend: _toucheend,
        touchcancel() {
          uGestionTouch = {};
        },
        contextmenu() {
          uGestionTouch = {};
        },
      });
    }
    function _uniformisationTouch() {
      let uLongTouch = null,
        uLongTouchTimer,
        uLongTouchTimerFin,
        const_delaiLongTouch = 500,
        const_delaiLongTouchFin = 1500,
        const_margesDeplacementLongTouch = 50,
        const_delaiDoubleTap = 300,
        const_margesDeplacementDoubleTap = 50,
        uLastTap = { time: 0, target: null, x: 0, y: 0 };
      function _stopperLongTouch() {
        clearTimeout(uLongTouchTimer);
        clearTimeout(uLongTouchTimerFin);
        uLongTouch = null;
      }
      function _demarrageLongTouch(aEventOrigine) {
        _stopperLongTouch();
        uLongTouch = {
          pointerId: aEventOrigine.pointerId,
          x: aEventOrigine.clientX,
          y: aEventOrigine.clientY,
          ok: false,
        };
        uLongTouchTimer = setTimeout(() => {
          if (uLongTouch) {
            uLongTouch.ok = true;
          }
        }, const_delaiLongTouch);
        uLongTouchTimerFin = setTimeout(() => {
          if (uLongTouch) {
            _finaliserLongTouch(aEventOrigine, true);
          }
        }, const_delaiLongTouchFin);
      }
      function _eventDansMargesLongTouch(aEvent) {
        return (
          uLongTouch &&
          Math.abs(aEvent.clientX - uLongTouch.x) <
            const_margesDeplacementLongTouch &&
          Math.abs(aEvent.clientY - uLongTouch.y) <
            const_margesDeplacementLongTouch
        );
      }
      function _finaliserLongTouch(aEventOrigine, aSurTimer) {
        clearTimeout(uLongTouchTimer);
        clearTimeout(uLongTouchTimerFin);
        if (
          uLongTouch.ok &&
          uLongTouch.pointerId === aEventOrigine.pointerId &&
          _eventDansMargesLongTouch(aEventOrigine)
        ) {
          const lEventSimule = $.Event(
            'ie-pointerdownlong',
            Object.assign(aEventOrigine, {
              type: 'ie-pointerdownlong',
              surTimer: false,
            }),
          );
          if (aSurTimer) {
            lEventSimule.surTimer = true;
          }
          $(aEventOrigine.target).trigger(lEventSimule);
        }
        _stopperLongTouch();
      }
      function _detectDoubleTap(aEventOrigine) {
        const lCurrentTime = Date.now();
        const lDelaiTap = lCurrentTime - uLastTap.time;
        if (
          uLastTap.time > 0 &&
          lDelaiTap < const_delaiDoubleTap &&
          lDelaiTap > 0 &&
          uLastTap.target === aEventOrigine.target &&
          _eventDansMargesDoubleTap(aEventOrigine)
        ) {
          const lEventSimule = $.Event(
            'ie-doubletap',
            Object.assign(aEventOrigine, { type: 'ie-doubletap' }),
          );
          $(aEventOrigine.target).trigger(lEventSimule);
          uLastTap.time = 0;
          uLastTap.target = null;
          uLastTap.x = 0;
          uLastTap.y = 0;
        } else {
          uLastTap.time = lCurrentTime;
          uLastTap.target = aEventOrigine.target;
          uLastTap.x = aEventOrigine.clientX;
          uLastTap.y = aEventOrigine.clientY;
        }
      }
      function _eventDansMargesDoubleTap(aEvent) {
        return (
          uLastTap &&
          Math.abs(aEvent.clientX - uLastTap.x) <
            const_margesDeplacementDoubleTap &&
          Math.abs(aEvent.clientY - uLastTap.y) <
            const_margesDeplacementDoubleTap
        );
      }
      $(document).on({
        'pointerdown.pointerdownlong'(aEvent) {
          if (aEvent.target) {
            _demarrageLongTouch(aEvent);
          }
        },
        'pointerup.pointerdownlong'(aEvent) {
          if (aEvent.target && uLongTouch) {
            _finaliserLongTouch(aEvent);
          }
        },
        'pointermove.pointerdownlong'(aEvent) {
          if (uLongTouch) {
            if (
              uLongTouch.pointerId !== aEvent.pointerId ||
              !_eventDansMargesLongTouch(aEvent)
            ) {
              _stopperLongTouch();
            }
          }
        },
        'pointercancel.pointerdownlong'() {
          if (uLongTouch) {
            _stopperLongTouch();
          }
        },
        'scroll.pointerdownlong'() {
          if (uLongTouch) {
            _stopperLongTouch();
          }
        },
        'click.doubleTap'(aEvent) {
          if (aEvent.target) {
            _detectDoubleTap(aEvent);
          }
        },
      });
      _initSwipeEvent();
    }
    function _initSwipeEvent() {
      function triggerCustomEvent(obj, eventType, event, bubble) {
        const originalType = event.type;
        event.type = eventType;
        if (bubble) {
          $.event.trigger(event, undefined, obj);
        } else {
          $.event.dispatch.call(obj, event);
        }
        event.type = originalType;
      }
      const lJDocument = $(document);
      const lSwipe = {
        scrollSupressionThreshold: 30,
        durationThreshold: 1000,
        horizontalDistanceThreshold: GNavigateur.isIOS ? 60 : 30,
        verticalDistanceThreshold: GNavigateur.isIOS ? 60 : 30,
        getLocation: function (event) {
          const winPageX = window.pageXOffset;
          const winPageY = window.pageYOffset;
          let x = event.clientX;
          let y = event.clientY;
          if (
            (event.pageY === 0 && Math.floor(y) > Math.floor(event.pageY)) ||
            (event.pageX === 0 && Math.floor(x) > Math.floor(event.pageX))
          ) {
            x = x - winPageX;
            y = y - winPageY;
          } else if (y < event.pageY - winPageY || x < event.pageX - winPageX) {
            x = event.pageX - winPageX;
            y = event.pageY - winPageY;
          }
          return { x: x, y: y };
        },
        start: function (event) {
          const data = event.originalEvent.touches
              ? event.originalEvent.touches[0]
              : event,
            location = $.event.special.swipe.getLocation(data);
          return {
            time: new Date().getTime(),
            coords: [location.x, location.y],
            origin: $(event.target),
          };
        },
        stop: function (event) {
          const data = event.originalEvent.touches
              ? event.originalEvent.touches[0]
              : event,
            location = $.event.special.swipe.getLocation(data);
          return {
            time: new Date().getTime(),
            coords: [location.x, location.y],
          };
        },
        handleSwipe: function (start, stop, thisObject, origTarget) {
          if (
            stop.time - start.time <
            $.event.special.swipe.durationThreshold
          ) {
            let direction = null;
            if (
              Math.abs(start.coords[0] - stop.coords[0]) >
                $.event.special.swipe.horizontalDistanceThreshold &&
              Math.abs(start.coords[1] - stop.coords[1]) <
                $.event.special.swipe.verticalDistanceThreshold
            ) {
              direction =
                start.coords[0] > stop.coords[0] ? 'swipeleft' : 'swiperight';
            } else if (
              Math.abs(start.coords[0] - stop.coords[0]) <
                $.event.special.swipe.horizontalDistanceThreshold &&
              Math.abs(start.coords[1] - stop.coords[1]) >
                $.event.special.swipe.verticalDistanceThreshold
            ) {
              direction =
                start.coords[1] > stop.coords[1] ? 'swipeup' : 'swipedown';
            }
            if (direction) {
              triggerCustomEvent(
                thisObject,
                'swipe',
                $.Event('swipe', {
                  target: origTarget,
                  swipestart: start,
                  swipestop: stop,
                }),
                true,
              );
              triggerCustomEvent(
                thisObject,
                direction,
                $.Event(direction, {
                  target: origTarget,
                  swipestart: start,
                  swipestop: stop,
                }),
                true,
              );
              return true;
            }
          }
          return false;
        },
        eventInProgress: false,
        setup: function () {
          let events;
          const thisObject = this;
          const $this = $(thisObject);
          const context = {};
          events = $.data(this, 'mobile-events');
          if (!events) {
            events = { length: 0 };
            $.data(this, 'mobile-events', events);
          }
          events.length++;
          events.swipe = context;
          context.start = function (event) {
            $.event.special.swipe.eventInProgress = true;
            let stop;
            const start = $.event.special.swipe.start(event);
            const origTarget = event.target;
            let emitted = false;
            context.move = function (event) {
              if (
                !start ||
                event.isDefaultPrevented() ||
                event.originalEvent.changedTouches.length > 1
              ) {
                return;
              }
              stop = $.event.special.swipe.stop(event);
              if (!emitted) {
                emitted = $.event.special.swipe.handleSwipe(
                  start,
                  stop,
                  thisObject,
                  origTarget,
                );
                if (emitted) {
                  $.event.special.swipe.eventInProgress = false;
                }
              }
            };
            context.stop = function () {
              emitted = true;
              $.event.special.swipe.eventInProgress = false;
              lJDocument.off('touchmove', context.move);
              context.move = null;
            };
            lJDocument
              .on('touchmove', context.move)
              .one('touchend', context.stop);
          };
          $this.on('touchstart', context.start);
        },
        teardown: function () {
          let events, context;
          events = $.data(this, 'mobile-events');
          if (events) {
            context = events.swipe;
            delete events.swipe;
            events.length--;
            if (events.length === 0) {
              $.removeData(this, 'mobile-events');
            }
          }
          if (context) {
            if (context.start) {
              $(this).off('touchstart', context.start);
            }
            if (context.move) {
              lJDocument.off('touchmove', context.move);
            }
            if (context.stop) {
              lJDocument.off('touchend', context.stop);
            }
          }
        },
      };
      $.event.special.swipe = lSwipe;
      $.each(
        {
          swipeleft: 'swipe.left',
          swiperight: 'swipe.right',
          swipeup: 'swipe.up',
          swipedown: 'swipe.down',
        },
        (event, sourceEvent) => {
          $.event.special[event] = {
            setup: function () {
              $(this).bind(sourceEvent, $.noop);
            },
            teardown: function () {
              $(this).unbind(sourceEvent);
            },
          };
        },
      );
    }
    function _getEvenement(aEvenement) {
      return aEvenement || window.event;
    }
    global.GNavigateur = new ObjetNavigateur();
  },
  fn: 'objetnavigateur.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    require('NamespaceIE');
    require('DeclarationJQuery.js');
    const Invocateur_1 = require('Invocateur');
    let _actif = false;
    let _actifRequete = false;
    const _idLogAutorises = {};
    let _compteurRequete = 0;
    const _nbRequetesMax = 200;
    let _pileLog = [];
    const _pileRequete = [];
    var TypeGenreLog;
    (function (TypeGenreLog) {
      TypeGenreLog[(TypeGenreLog['Message'] = 0)] = 'Message';
      TypeGenreLog[(TypeGenreLog['Avertissement'] = 1)] = 'Avertissement';
      TypeGenreLog[(TypeGenreLog['Erreur'] = 2)] = 'Erreur';
      TypeGenreLog[(TypeGenreLog['Deprecated'] = 3)] = 'Deprecated';
    })(TypeGenreLog || (TypeGenreLog = {}));
    const Log = {
      genre: TypeGenreLog,
      getActif() {
        return _actif;
      },
      setActif(aActif) {
        _actif = aActif;
        if (aActif) {
          this.addLog('Démarrage Log', null, Log.genre.Avertissement);
        }
      },
      getActifRequete() {
        return _actifRequete;
      },
      setActifRequete(aActif) {
        _actifRequete = aActif;
      },
      addLog(aMessage, aIdFiltrage, aGenreLog) {
        if (!_actif) {
          return;
        }
        if (aIdFiltrage && _idLogAutorises && !_idLogAutorises[aIdFiltrage]) {
          return;
        }
        const lMessage =
          aMessage && aMessage.toString
            ? aMessage.toString()
            : 'aMessage NON LOGGABLE !!!';
        const lLog = {
          message: lMessage,
          genreLog: aGenreLog,
          date: new Date(),
        };
        _pileLog.push(lLog);
        this.addConsoleLog(aMessage, aGenreLog);
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.DEBUG_log,
          lLog,
        );
      },
      vider() {
        _pileLog = [];
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.DEBUG_log,
          null,
        );
      },
      setIDFiltrageLog(aID, aAutoriser) {
        if (aAutoriser) {
          _idLogAutorises[aID] = true;
        } else {
          delete _idLogAutorises[aID];
        }
      },
      addRequete(aDonnees) {
        if (!this.getActifRequete()) {
          return;
        }
        const lDonnees = {
          nomRequete: '',
          numeroRequete: 0,
          numeroOrdre: 0,
          chrono: null,
          estReponse: false,
          lgcontenu: null,
        };
        Object.assign(lDonnees, aDonnees);
        lDonnees.date = new Date();
        if (!lDonnees.estReponse) {
          _compteurRequete += 1;
        }
        _pileRequete.push(lDonnees);
        if (_pileRequete.length > _nbRequetesMax) {
          _pileRequete.shift();
        }
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.DEBUG_logRequete,
          lDonnees,
        );
      },
      getCompteurRequete() {
        return _compteurRequete;
      },
      getPile() {
        return _pileLog;
      },
      getRequetes() {
        return _pileRequete;
      },
      addConsoleLog(aMessage, aGenreMsg) {},
      addConsoleLogObjet(aObjet, aLibelle) {},
      addConsolePileAppel(aLibelle) {},
    };
    IE.log = Log;
    module.exports = Log;
  },
  fn: 'ielog.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    var __extends;
    var __assign;
    var __rest;
    var __decorate;
    var __param;
    var __esDecorate;
    var __runInitializers;
    var __propKey;
    var __setFunctionName;
    var __metadata;
    var __awaiter;
    var __generator;
    var __exportStar;
    var __values;
    var __read;
    var __spread;
    var __spreadArrays;
    var __spreadArray;
    var __await;
    var __asyncGenerator;
    var __asyncDelegator;
    var __asyncValues;
    var __makeTemplateObject;
    var __importStar;
    var __importDefault;
    var __classPrivateFieldGet;
    var __classPrivateFieldSet;
    var __classPrivateFieldIn;
    var __createBinding;
    var __addDisposableResource;
    var __disposeResources;
    (function (factory) {
      var root =
        typeof global === 'object'
          ? global
          : typeof self === 'object'
            ? self
            : typeof this === 'object'
              ? this
              : {};
      if (typeof define === 'function' && define.amd) {
        define('tslib', ['exports'], function (exports) {
          factory(createExporter(root, createExporter(exports)));
        });
      } else if (
        typeof module === 'object' &&
        typeof module.exports === 'object'
      ) {
        factory(createExporter(root, createExporter(module.exports)));
      } else {
        factory(createExporter(root));
      }
      function createExporter(exports, previous) {
        if (exports !== root) {
          if (typeof Object.create === 'function') {
            Object.defineProperty(exports, '__esModule', { value: true });
          } else {
            exports.__esModule = true;
          }
        }
        return function (id, v) {
          return (exports[id] = previous ? previous(id, v) : v);
        };
      }
    })(function (exporter) {
      var extendStatics =
        Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array &&
          function (d, b) {
            d.__proto__ = b;
          }) ||
        function (d, b) {
          for (var p in b)
            if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
        };
      __extends = function (d, b) {
        if (typeof b !== 'function' && b !== null)
          throw new TypeError(
            'Class extends value ' +
              String(b) +
              ' is not a constructor or null',
          );
        extendStatics(d, b);
        function __() {
          this.constructor = d;
        }
        d.prototype =
          b === null
            ? Object.create(b)
            : ((__.prototype = b.prototype), new __());
      };
      __assign =
        Object.assign ||
        function (t) {
          for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s)
              if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
          }
          return t;
        };
      __rest = function (s, e) {
        var t = {};
        for (var p in s)
          if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
            t[p] = s[p];
        if (s != null && typeof Object.getOwnPropertySymbols === 'function')
          for (
            var i = 0, p = Object.getOwnPropertySymbols(s);
            i < p.length;
            i++
          ) {
            if (
              e.indexOf(p[i]) < 0 &&
              Object.prototype.propertyIsEnumerable.call(s, p[i])
            )
              t[p[i]] = s[p[i]];
          }
        return t;
      };
      __decorate = function (decorators, target, key, desc) {
        var c = arguments.length,
          r =
            c < 3
              ? target
              : desc === null
                ? (desc = Object.getOwnPropertyDescriptor(target, key))
                : desc,
          d;
        if (
          typeof Reflect === 'object' &&
          typeof Reflect.decorate === 'function'
        )
          r = Reflect.decorate(decorators, target, key, desc);
        else
          for (var i = decorators.length - 1; i >= 0; i--)
            if ((d = decorators[i]))
              r =
                (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) ||
                r;
        return c > 3 && r && Object.defineProperty(target, key, r), r;
      };
      __param = function (paramIndex, decorator) {
        return function (target, key) {
          decorator(target, key, paramIndex);
        };
      };
      __esDecorate = function (
        ctor,
        descriptorIn,
        decorators,
        contextIn,
        initializers,
        extraInitializers,
      ) {
        function accept(f) {
          if (f !== void 0 && typeof f !== 'function')
            throw new TypeError('Function expected');
          return f;
        }
        var kind = contextIn.kind,
          key = kind === 'getter' ? 'get' : kind === 'setter' ? 'set' : 'value';
        var target =
          !descriptorIn && ctor
            ? contextIn['static']
              ? ctor
              : ctor.prototype
            : null;
        var descriptor =
          descriptorIn ||
          (target
            ? Object.getOwnPropertyDescriptor(target, contextIn.name)
            : {});
        var _,
          done = false;
        for (var i = decorators.length - 1; i >= 0; i--) {
          var context = {};
          for (var p in contextIn)
            context[p] = p === 'access' ? {} : contextIn[p];
          for (var p in contextIn.access)
            context.access[p] = contextIn.access[p];
          context.addInitializer = function (f) {
            if (done)
              throw new TypeError(
                'Cannot add initializers after decoration has completed',
              );
            extraInitializers.push(accept(f || null));
          };
          var result = (0, decorators[i])(
            kind === 'accessor'
              ? { get: descriptor.get, set: descriptor.set }
              : descriptor[key],
            context,
          );
          if (kind === 'accessor') {
            if (result === void 0) continue;
            if (result === null || typeof result !== 'object')
              throw new TypeError('Object expected');
            if ((_ = accept(result.get))) descriptor.get = _;
            if ((_ = accept(result.set))) descriptor.set = _;
            if ((_ = accept(result.init))) initializers.unshift(_);
          } else if ((_ = accept(result))) {
            if (kind === 'field') initializers.unshift(_);
            else descriptor[key] = _;
          }
        }
        if (target) Object.defineProperty(target, contextIn.name, descriptor);
        done = true;
      };
      __runInitializers = function (thisArg, initializers, value) {
        var useValue = arguments.length > 2;
        for (var i = 0; i < initializers.length; i++) {
          value = useValue
            ? initializers[i].call(thisArg, value)
            : initializers[i].call(thisArg);
        }
        return useValue ? value : void 0;
      };
      __propKey = function (x) {
        return typeof x === 'symbol' ? x : ''.concat(x);
      };
      __setFunctionName = function (f, name, prefix) {
        if (typeof name === 'symbol')
          name = name.description ? '['.concat(name.description, ']') : '';
        return Object.defineProperty(f, 'name', {
          configurable: true,
          value: prefix ? ''.concat(prefix, ' ', name) : name,
        });
      };
      __metadata = function (metadataKey, metadataValue) {
        if (
          typeof Reflect === 'object' &&
          typeof Reflect.metadata === 'function'
        )
          return Reflect.metadata(metadataKey, metadataValue);
      };
      __awaiter = function (thisArg, _arguments, P, generator) {
        function adopt(value) {
          return value instanceof P
            ? value
            : new P(function (resolve) {
                resolve(value);
              });
        }
        return new (P || (P = Promise))(function (resolve, reject) {
          function fulfilled(value) {
            try {
              step(generator.next(value));
            } catch (e) {
              reject(e);
            }
          }
          function rejected(value) {
            try {
              step(generator['throw'](value));
            } catch (e) {
              reject(e);
            }
          }
          function step(result) {
            result.done
              ? resolve(result.value)
              : adopt(result.value).then(fulfilled, rejected);
          }
          step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
      };
      __generator = function (thisArg, body) {
        var _ = {
            label: 0,
            sent: function () {
              if (t[0] & 1) throw t[1];
              return t[1];
            },
            trys: [],
            ops: [],
          },
          f,
          y,
          t,
          g;
        return (
          (g = { next: verb(0), throw: verb(1), return: verb(2) }),
          typeof Symbol === 'function' &&
            (g[Symbol.iterator] = function () {
              return this;
            }),
          g
        );
        function verb(n) {
          return function (v) {
            return step([n, v]);
          };
        }
        function step(op) {
          if (f) throw new TypeError('Generator is already executing.');
          while ((g && ((g = 0), op[0] && (_ = 0)), _))
            try {
              if (
                ((f = 1),
                y &&
                  (t =
                    op[0] & 2
                      ? y['return']
                      : op[0]
                        ? y['throw'] || ((t = y['return']) && t.call(y), 0)
                        : y.next) &&
                  !(t = t.call(y, op[1])).done)
              )
                return t;
              if (((y = 0), t)) op = [op[0] & 2, t.value];
              switch (op[0]) {
                case 0:
                case 1:
                  t = op;
                  break;
                case 4:
                  _.label++;
                  return { value: op[1], done: false };
                case 5:
                  _.label++;
                  y = op[1];
                  op = [0];
                  continue;
                case 7:
                  op = _.ops.pop();
                  _.trys.pop();
                  continue;
                default:
                  if (
                    !((t = _.trys), (t = t.length > 0 && t[t.length - 1])) &&
                    (op[0] === 6 || op[0] === 2)
                  ) {
                    _ = 0;
                    continue;
                  }
                  if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) {
                    _.label = op[1];
                    break;
                  }
                  if (op[0] === 6 && _.label < t[1]) {
                    _.label = t[1];
                    t = op;
                    break;
                  }
                  if (t && _.label < t[2]) {
                    _.label = t[2];
                    _.ops.push(op);
                    break;
                  }
                  if (t[2]) _.ops.pop();
                  _.trys.pop();
                  continue;
              }
              op = body.call(thisArg, _);
            } catch (e) {
              op = [6, e];
              y = 0;
            } finally {
              f = t = 0;
            }
          if (op[0] & 5) throw op[1];
          return { value: op[0] ? op[1] : void 0, done: true };
        }
      };
      __exportStar = function (m, o) {
        for (var p in m)
          if (p !== 'default' && !Object.prototype.hasOwnProperty.call(o, p))
            __createBinding(o, m, p);
      };
      __createBinding = Object.create
        ? function (o, m, k, k2) {
            if (k2 === undefined) k2 = k;
            var desc = Object.getOwnPropertyDescriptor(m, k);
            if (
              !desc ||
              ('get' in desc
                ? !m.__esModule
                : desc.writable || desc.configurable)
            ) {
              desc = {
                enumerable: true,
                get: function () {
                  return m[k];
                },
              };
            }
            Object.defineProperty(o, k2, desc);
          }
        : function (o, m, k, k2) {
            if (k2 === undefined) k2 = k;
            o[k2] = m[k];
          };
      __values = function (o) {
        var s = typeof Symbol === 'function' && Symbol.iterator,
          m = s && o[s],
          i = 0;
        if (m) return m.call(o);
        if (o && typeof o.length === 'number')
          return {
            next: function () {
              if (o && i >= o.length) o = void 0;
              return { value: o && o[i++], done: !o };
            },
          };
        throw new TypeError(
          s ? 'Object is not iterable.' : 'Symbol.iterator is not defined.',
        );
      };
      __read = function (o, n) {
        var m = typeof Symbol === 'function' && o[Symbol.iterator];
        if (!m) return o;
        var i = m.call(o),
          r,
          ar = [],
          e;
        try {
          while ((n === void 0 || n-- > 0) && !(r = i.next()).done)
            ar.push(r.value);
        } catch (error) {
          e = { error: error };
        } finally {
          try {
            if (r && !r.done && (m = i['return'])) m.call(i);
          } finally {
            if (e) throw e.error;
          }
        }
        return ar;
      };
      __spread = function () {
        for (var ar = [], i = 0; i < arguments.length; i++)
          ar = ar.concat(__read(arguments[i]));
        return ar;
      };
      __spreadArrays = function () {
        for (var s = 0, i = 0, il = arguments.length; i < il; i++)
          s += arguments[i].length;
        for (var r = Array(s), k = 0, i = 0; i < il; i++)
          for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
        return r;
      };
      __spreadArray = function (to, from, pack) {
        if (pack || arguments.length === 2)
          for (var i = 0, l = from.length, ar; i < l; i++) {
            if (ar || !(i in from)) {
              if (!ar) ar = Array.prototype.slice.call(from, 0, i);
              ar[i] = from[i];
            }
          }
        return to.concat(ar || Array.prototype.slice.call(from));
      };
      __await = function (v) {
        return this instanceof __await ? ((this.v = v), this) : new __await(v);
      };
      __asyncGenerator = function (thisArg, _arguments, generator) {
        if (!Symbol.asyncIterator)
          throw new TypeError('Symbol.asyncIterator is not defined.');
        var g = generator.apply(thisArg, _arguments || []),
          i,
          q = [];
        return (
          (i = {}),
          verb('next'),
          verb('throw'),
          verb('return', awaitReturn),
          (i[Symbol.asyncIterator] = function () {
            return this;
          }),
          i
        );
        function awaitReturn(f) {
          return function (v) {
            return Promise.resolve(v).then(f, reject);
          };
        }
        function verb(n, f) {
          if (g[n]) {
            i[n] = function (v) {
              return new Promise(function (a, b) {
                q.push([n, v, a, b]) > 1 || resume(n, v);
              });
            };
            if (f) i[n] = f(i[n]);
          }
        }
        function resume(n, v) {
          try {
            step(g[n](v));
          } catch (e) {
            settle(q[0][3], e);
          }
        }
        function step(r) {
          r.value instanceof __await
            ? Promise.resolve(r.value.v).then(fulfill, reject)
            : settle(q[0][2], r);
        }
        function fulfill(value) {
          resume('next', value);
        }
        function reject(value) {
          resume('throw', value);
        }
        function settle(f, v) {
          if ((f(v), q.shift(), q.length)) resume(q[0][0], q[0][1]);
        }
      };
      __asyncDelegator = function (o) {
        var i, p;
        return (
          (i = {}),
          verb('next'),
          verb('throw', function (e) {
            throw e;
          }),
          verb('return'),
          (i[Symbol.iterator] = function () {
            return this;
          }),
          i
        );
        function verb(n, f) {
          i[n] = o[n]
            ? function (v) {
                return (p = !p)
                  ? { value: __await(o[n](v)), done: false }
                  : f
                    ? f(v)
                    : v;
              }
            : f;
        }
      };
      __asyncValues = function (o) {
        if (!Symbol.asyncIterator)
          throw new TypeError('Symbol.asyncIterator is not defined.');
        var m = o[Symbol.asyncIterator],
          i;
        return m
          ? m.call(o)
          : ((o =
              typeof __values === 'function'
                ? __values(o)
                : o[Symbol.iterator]()),
            (i = {}),
            verb('next'),
            verb('throw'),
            verb('return'),
            (i[Symbol.asyncIterator] = function () {
              return this;
            }),
            i);
        function verb(n) {
          i[n] =
            o[n] &&
            function (v) {
              return new Promise(function (resolve, reject) {
                (v = o[n](v)), settle(resolve, reject, v.done, v.value);
              });
            };
        }
        function settle(resolve, reject, d, v) {
          Promise.resolve(v).then(function (v) {
            resolve({ value: v, done: d });
          }, reject);
        }
      };
      __makeTemplateObject = function (cooked, raw) {
        if (Object.defineProperty) {
          Object.defineProperty(cooked, 'raw', { value: raw });
        } else {
          cooked.raw = raw;
        }
        return cooked;
      };
      var __setModuleDefault = Object.create
        ? function (o, v) {
            Object.defineProperty(o, 'default', { enumerable: true, value: v });
          }
        : function (o, v) {
            o['default'] = v;
          };
      __importStar = function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null)
          for (var k in mod)
            if (k !== 'default' && Object.prototype.hasOwnProperty.call(mod, k))
              __createBinding(result, mod, k);
        __setModuleDefault(result, mod);
        return result;
      };
      __importDefault = function (mod) {
        return mod && mod.__esModule ? mod : { default: mod };
      };
      __classPrivateFieldGet = function (receiver, state, kind, f) {
        if (kind === 'a' && !f)
          throw new TypeError('Private accessor was defined without a getter');
        if (
          typeof state === 'function'
            ? receiver !== state || !f
            : !state.has(receiver)
        )
          throw new TypeError(
            'Cannot read private member from an object whose class did not declare it',
          );
        return kind === 'm'
          ? f
          : kind === 'a'
            ? f.call(receiver)
            : f
              ? f.value
              : state.get(receiver);
      };
      __classPrivateFieldSet = function (receiver, state, value, kind, f) {
        if (kind === 'm') throw new TypeError('Private method is not writable');
        if (kind === 'a' && !f)
          throw new TypeError('Private accessor was defined without a setter');
        if (
          typeof state === 'function'
            ? receiver !== state || !f
            : !state.has(receiver)
        )
          throw new TypeError(
            'Cannot write private member to an object whose class did not declare it',
          );
        return (
          kind === 'a'
            ? f.call(receiver, value)
            : f
              ? (f.value = value)
              : state.set(receiver, value),
          value
        );
      };
      __classPrivateFieldIn = function (state, receiver) {
        if (
          receiver === null ||
          (typeof receiver !== 'object' && typeof receiver !== 'function')
        )
          throw new TypeError("Cannot use 'in' operator on non-object");
        return typeof state === 'function'
          ? receiver === state
          : state.has(receiver);
      };
      __addDisposableResource = function (env, value, async) {
        if (value !== null && value !== void 0) {
          if (typeof value !== 'object' && typeof value !== 'function')
            throw new TypeError('Object expected.');
          var dispose;
          if (async) {
            if (!Symbol.asyncDispose)
              throw new TypeError('Symbol.asyncDispose is not defined.');
            dispose = value[Symbol.asyncDispose];
          }
          if (dispose === void 0) {
            if (!Symbol.dispose)
              throw new TypeError('Symbol.dispose is not defined.');
            dispose = value[Symbol.dispose];
          }
          if (typeof dispose !== 'function')
            throw new TypeError('Object not disposable.');
          env.stack.push({ value: value, dispose: dispose, async: async });
        } else if (async) {
          env.stack.push({ async: true });
        }
        return value;
      };
      var _SuppressedError =
        typeof SuppressedError === 'function'
          ? SuppressedError
          : function (error, suppressed, message) {
              var e = new Error(message);
              return (
                (e.name = 'SuppressedError'),
                (e.error = error),
                (e.suppressed = suppressed),
                e
              );
            };
      __disposeResources = function (env) {
        function fail(e) {
          env.error = env.hasError
            ? new _SuppressedError(
                e,
                env.error,
                'An error was suppressed during disposal.',
              )
            : e;
          env.hasError = true;
        }
        function next() {
          while (env.stack.length) {
            var rec = env.stack.pop();
            try {
              var result = rec.dispose && rec.dispose.call(rec.value);
              if (rec.async)
                return Promise.resolve(result).then(next, function (e) {
                  fail(e);
                  return next();
                });
            } catch (e) {
              fail(e);
            }
          }
          if (env.hasError) throw env.error;
        }
        return next();
      };
      exporter('__extends', __extends);
      exporter('__assign', __assign);
      exporter('__rest', __rest);
      exporter('__decorate', __decorate);
      exporter('__param', __param);
      exporter('__esDecorate', __esDecorate);
      exporter('__runInitializers', __runInitializers);
      exporter('__propKey', __propKey);
      exporter('__setFunctionName', __setFunctionName);
      exporter('__metadata', __metadata);
      exporter('__awaiter', __awaiter);
      exporter('__generator', __generator);
      exporter('__exportStar', __exportStar);
      exporter('__createBinding', __createBinding);
      exporter('__values', __values);
      exporter('__read', __read);
      exporter('__spread', __spread);
      exporter('__spreadArrays', __spreadArrays);
      exporter('__spreadArray', __spreadArray);
      exporter('__await', __await);
      exporter('__asyncGenerator', __asyncGenerator);
      exporter('__asyncDelegator', __asyncDelegator);
      exporter('__asyncValues', __asyncValues);
      exporter('__makeTemplateObject', __makeTemplateObject);
      exporter('__importStar', __importStar);
      exporter('__importDefault', __importDefault);
      exporter('__classPrivateFieldGet', __classPrivateFieldGet);
      exporter('__classPrivateFieldSet', __classPrivateFieldSet);
      exporter('__classPrivateFieldIn', __classPrivateFieldIn);
      exporter('__addDisposableResource', __addDisposableResource);
      exporter('__disposeResources', __disposeResources);
    });
  },
  fn: 'tslib.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetHint = void 0;
    const GUID_1 = require('GUID');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const MethodesTableau_1 = require('MethodesTableau');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetSupport_1 = require('ObjetSupport');
    const tag_1 = require('tag');
    let uTimeoutFondu = null;
    const uIdConteneur = GUID_1.GUID.getId();
    const uIdScroll = uIdConteneur + '_scroll';
    let uHintsEnAttente = [];
    let uHintEnCoursChargement = null;
    let uHintAffiche = null;
    let uHintInitialise = false;
    class ConteneurEventInvocateur {
      constructor() {
        this.pileAbonnementInvocateur = {};
      }
      getPileAbonnement() {
        return this.pileAbonnementInvocateur;
      }
    }
    const uConteneurEventInvocateur = new ConteneurEventInvocateur();
    const ObjetHint = {
      optionsDefault: {
        sansDelai: false,
        maxHeight: 500,
        maxWidth: 550,
        delaiTimer: 400,
        delaiFermeture: 0,
        sansDelaiFermetureSuppression: false,
      },
      getDisabled() {
        return !global.GNavigateur;
      },
      start(aContenu, aOptions) {
        if (ObjetHint.getDisabled()) {
          IE.log.addLog('ObjetHint.start => disabled sur espaces mobiles');
          return;
        }
        if (!uHintInitialise) {
          uHintInitialise = true;
          $(document)
            .off('pointerdown.Hint keyup.Hint')
            .on('pointerdown.Hint keyup.Hint', (aEvent) => {
              _stopAll(aEvent);
            });
          $(window)
            .off('resize.Hint')
            .on('resize.Hint', (event) => {
              if (uHintAffiche && uHintAffiche.hintTouch) {
                return;
              }
              _stopAll(event);
            });
        }
        const lHint = Object.assign(
          { position: null, event: null, elementDOM: null },
          ObjetHint.optionsDefault,
          aOptions,
        );
        lHint.actif = false;
        if (!aContenu || aContenu === '') {
          return lHint;
        }
        if (lHint.elementDOM && lHint.elementDOM.setAttribute) {
          lHint.elementDOM.setAttribute('title', '');
        }
        lHint.actif = true;
        uHintsEnAttente.push(lHint);
        if (lHint.sansDelai) {
          _afficher(aContenu, lHint);
        } else {
          lHint.promiseTimerDelai = new Promise((aResolve) => {
            lHint.timer = setTimeout(() => {
              _afficher(aContenu, lHint);
              if (lHint.pomiseAfficher) {
                lHint.pomiseAfficher.then(() => {
                  aResolve();
                });
              } else {
                aResolve();
              }
            }, lHint.delaiTimer);
          });
        }
        return lHint;
      },
      stop(aHint) {
        if (aHint && aHint === uHintEnCoursChargement) {
          return false;
        }
        if (aHint) {
          const lARetirer = !aHint.estAffiche;
          _stopHint(aHint);
          if (lARetirer) {
            setTimeout(() => {
              _retirerHintPileAttente(aHint);
            }, 0);
          }
        } else {
          _stopAll();
        }
      },
      attach(aParam) {
        if (ObjetHint.getDisabled()) {
          IE.log.addLog('ObjetHint.attach > disabled sur espaces mobiles');
          return;
        }
        const lNamespace = aParam.namespace
            ? (aParam.namespace = '.' + aParam.namespace)
            : '.IEHint',
          lContenu = aParam.contenu,
          lInterrupt = aParam.interrupt,
          lMargeDeplacementTouch = 50,
          lIdentEventsTouch = GNavigateur.getEventInvocateur('pointermove');
        let lHint;
        let lTimeoutTouch;
        const lStop = function () {
          if (lTimeoutTouch) {
            clearTimeout(lTimeoutTouch);
            lTimeoutTouch = null;
          }
          Invocateur_1.Invocateur.desabonner(
            lIdentEventsTouch,
            uConteneurEventInvocateur,
          );
          if (ObjetHint.stop(lHint) !== false) {
            lHint = null;
          }
        };
        if (!aParam.$Element) {
          return false;
        }
        if (aParam.off !== false) {
          aParam.$Element.off(
            ' pointerover' +
              lNamespace +
              ' pointerleave' +
              lNamespace +
              ' pointerout' +
              lNamespace +
              ' destroyed' +
              lNamespace +
              ' pointerdown' +
              lNamespace,
          );
        }
        const lElementDOM = aParam.$Element.get(0);
        const lMap = {};
        lMap['pointerover' + lNamespace] = function (event) {
          if (event.pointerType === 'touch') {
            return;
          }
          if (uHintEnCoursChargement) {
            return;
          }
          if (lInterrupt && lInterrupt.call(this, event)) {
            return;
          }
          const lContenuAAfficher = lContenu;
          lHint = ObjetHint.start(lContenuAAfficher, {
            event: event,
            elementDOM: lElementDOM,
          });
        };
        lMap['destroyed' + lNamespace] = function () {
          lStop();
        };
        lMap['pointerleave' + lNamespace + ' pointerout' + lNamespace] =
          function (aEvent) {
            if (aEvent.pointerType === 'touch') {
              return;
            }
            if (lHint && lHint.hintTouch) {
              return;
            }
            lStop();
          };
        lMap['pointerdown' + lNamespace] = function (event) {
          if (event.pointerType !== 'touch') {
            return;
          }
          if (lInterrupt && lInterrupt.call(this, event)) {
            return;
          }
          if (event.originalEvent.__hintSurEventPointerDown__) {
            return;
          }
          event.originalEvent.hintTouch = true;
          const lPositionEvent =
            ObjetPosition_1.GPosition.getPositionEventJQuery(event);
          lHint = ObjetHint.start(lContenu, {
            delaiTimer: 500,
            event: event,
            position: { x: lPositionEvent.x + 5, y: lPositionEvent.y + 5 },
            elementDOM: lElementDOM,
            avecTestDisplay: true,
          });
          if (!lHint || !lHint.promiseTimerDelai) {
            return;
          }
          const lTestDeplacement = function (aEvent) {
            if (lHint && lHint.actif && lHint.position) {
              const lPositionEvent =
                ObjetPosition_1.GPosition.getPositionEventJQuery(aEvent);
              if (
                Math.abs(lPositionEvent.x - lHint.position.x) >
                  lMargeDeplacementTouch ||
                Math.abs(lPositionEvent.y - lHint.position.y) >
                  lMargeDeplacementTouch
              ) {
                lStop();
              }
            }
          };
          Invocateur_1.Invocateur.desabonner(
            lIdentEventsTouch,
            uConteneurEventInvocateur,
          );
          Invocateur_1.Invocateur.abonner(
            lIdentEventsTouch,
            lTestDeplacement,
            uConteneurEventInvocateur,
          );
          lHint.promiseTimerDelai.then(() => {
            if (!lHint.estAffiche) {
              return;
            }
            event.originalEvent.__hintSurEventPointerDown__ = true;
            lHint.hintTouch = true;
            if (lHint.hintAvecScroll) {
              lHint.stopSurFinScroll = lStop;
              return;
            }
            if (lTimeoutTouch) {
              clearTimeout(lTimeoutTouch);
            }
            lTimeoutTouch = setTimeout(() => {
              lTimeoutTouch = null;
              if (lHint && lHint.actif && lHint.estAffiche) {
                lStop();
              }
            }, 1500);
          });
        };
        aParam.$Element.on(lMap);
        aParam.$Element = null;
      },
      nodeDansHint(aNode) {
        return $(aNode).parents('#' + uIdConteneur.escapeJQ()).length > 0;
      },
    };
    exports.ObjetHint = ObjetHint;
    function _stopHint(aHint) {
      if (!aHint || aHint === uHintEnCoursChargement) {
        return;
      }
      if (aHint.elementDOM && aHint.elementDOM.removeAttribute) {
        aHint.elementDOM.removeAttribute('title');
      }
      if (aHint.estAffiche) {
        uHintAffiche = null;
        $('#' + uIdConteneur.escapeJQ()).removeClass('visible');
        if (
          ObjetSupport_1.Support.avecSupportTransitions &&
          !aHint.sansDelaiFermetureSuppression
        ) {
          clearTimeout(uTimeoutFondu);
          uTimeoutFondu = setTimeout(() => {
            ObjetHtml_1.GHtml.supprimerElementDOM(uIdConteneur);
            uTimeoutFondu = null;
          }, 200);
        } else {
          ObjetHtml_1.GHtml.supprimerElementDOM(uIdConteneur);
        }
      }
      if (aHint.timerFermeture) {
        clearTimeout(aHint.timerFermeture);
        aHint.timerFermeture = null;
      }
      if (aHint.timer) {
        clearTimeout(aHint.timer);
        aHint.timer = null;
      }
      aHint.estAffiche = false;
      aHint.actif = false;
    }
    function _stopEnAttente() {
      let lHintEnAttente;
      for (let i = 0, lNb = uHintsEnAttente.length; i < lNb; i++) {
        lHintEnAttente = uHintsEnAttente[i];
        if (lHintEnAttente) {
          lHintEnAttente.actif = false;
          if (lHintEnAttente.timer) {
            clearTimeout(lHintEnAttente.timer);
            lHintEnAttente.timer = null;
          }
        }
      }
      uHintsEnAttente = [];
    }
    function _stopAll(event, aConserverHintEnCours) {
      if (event && event.originalEvent && event.originalEvent.hintTouch) {
        return;
      }
      if (uHintEnCoursChargement) {
        return;
      }
      if (uHintAffiche && !aConserverHintEnCours) {
        _stopHint(uHintAffiche);
      }
      _stopEnAttente();
    }
    function _getContenu(aContenu, aHint) {
      if (MethodesObjet_1.MethodesObjet.isFunction(aContenu)) {
        const lResult = aContenu(aHint);
        if (typeof lResult === 'string') {
          return lResult;
        }
        uHintEnCoursChargement = aHint;
        return lResult.finally(() => {
          setTimeout(() => {
            if (aHint === uHintEnCoursChargement) {
              uHintEnCoursChargement = null;
            }
          }, 50);
        });
      } else {
        return aContenu;
      }
    }
    function _retirerHintPileAttente(aHint) {
      const lIndice = uHintsEnAttente.indexOf(aHint);
      if (lIndice >= 0) {
        MethodesTableau_1.MethodesTableau.supprimerElement(
          uHintsEnAttente,
          lIndice,
        );
      }
    }
    function _loopAnimateScroll(aHint, aId, aHauteurAScroller) {
      const lDuree = (aHauteurAScroller * 1000) / 100;
      $(aId)
        .delay(1000)
        .animate(
          { scrollTop: aHauteurAScroller },
          {
            duration: lDuree,
            easing: 'linear',
            done() {
              if (aHint.stopSurFinScroll) {
                aHint.stopSurFinScroll();
              }
            },
          },
        )
        .delay(1000)
        .animate(
          { scrollTop: 0 },
          {
            duration: 300,
            done: function () {
              _loopAnimateScroll(aHint, aId, aHauteurAScroller);
            },
          },
        );
    }
    function _afficher(aContenu, aHint) {
      if (uHintEnCoursChargement) {
        return;
      }
      if (
        aHint.avecTestDisplay &&
        aHint.elementDOM &&
        !$(aHint.elementDOM).is(':visible')
      ) {
        return;
      }
      if (_avecTitleDansEventHint(aHint)) {
        return;
      }
      aHint.pomiseAfficher = Promise.resolve()
        .then(() => {
          return _getContenu(aContenu, aHint);
        })
        .then((aContenu) => {
          if (!aHint.actif || !aContenu || aContenu === '') {
            aHint.timer = null;
            aHint.actif = false;
            return;
          }
          const lContenu = aContenu;
          _retirerHintPileAttente(aHint);
          _stopAll();
          uHintAffiche = aHint;
          uHintAffiche.contenu = lContenu;
          clearTimeout(uTimeoutFondu);
          aHint.estAffiche = true;
          aHint.timer = null;
          if (aHint.delaiFermeture > 0) {
            aHint.timerFermeture = setTimeout(() => {
              _stopHint(aHint);
            }, aHint.delaiFermeture);
          }
          let lConteneur = ObjetHtml_1.GHtml.getElement(uIdConteneur);
          if (!ObjetHtml_1.GHtml.elementExiste(lConteneur)) {
            lConteneur = ObjetHtml_1.GHtml.htmlToDOM(
              '<div id="' + uIdConteneur + '" class="ie-hint"></div>',
            );
            ObjetHtml_1.GHtml.insererElementDOM(
              ObjetHtml_1.GHtml.getElement(GApplication.getIdConteneur()),
              lConteneur,
            );
          }
          ObjetHtml_1.GHtml.setHtml(lConteneur, compose(lContenu, aHint));
          let lPositionEvent = {};
          if (!aHint.position && aHint.event && IE.estMobile) {
            lPositionEvent = ObjetPosition_1.GPosition.getPositionEventJQuery(
              aHint.event,
            );
          }
          const lPosition = Object.assign(
              { y: GNavigateur.pointerY, x: GNavigateur.pointerX },
              lPositionEvent,
              aHint.position,
            ),
            lDecalage = aHint.position ? { x: 0, y: 0 } : { x: 0, y: 20 };
          const lJScroll = $('#' + uIdScroll.escapeJQ()),
            lHeightScroll = lJScroll.height(),
            lHeightContenu = lJScroll.children().height(),
            lAvecScroll = lHeightScroll < lHeightContenu;
          lJScroll.css('width', lJScroll.outerWidth());
          ObjetPosition_1.GPosition.placerFicheSource(
            uIdConteneur,
            lPosition.x,
            lPosition.x,
            lPosition.y,
            lPosition.y,
            false,
            lDecalage,
          );
          $(lConteneur).addClass('visible');
          if (lAvecScroll) {
            aHint.hintAvecScroll = true;
            _loopAnimateScroll(
              aHint,
              '#' + uIdScroll.escapeJQ(),
              lHeightContenu - lHeightScroll,
            );
          }
        });
    }
    function compose(aContenu, aHint) {
      return (0, tag_1.tag)(
        'div',
        {
          id: uIdScroll,
          tabindex: '-1',
          class: 'ie-hint-cont',
          style: `max-height:${Math.min(aHint.maxHeight, GNavigateur.ecranL)}px; max-width:${Math.min(aHint.maxWidth, GNavigateur.ecranH)}px;`,
        },
        (0, tag_1.tag)('div', aContenu),
      );
    }
    function _avecTitleDansEventHint(aHint) {
      if (
        !aHint ||
        !aHint.event ||
        !aHint.event.target ||
        !aHint.elementDOM ||
        aHint.event.target === aHint.elementDOM
      ) {
        return false;
      }
      let lResult = false;
      const lDOMTarget = aHint.event.target;
      if ($(lDOMTarget).prop('title').length > 0) {
        lResult = true;
      }
      if (!lResult) {
        $(lDOMTarget)
          .parentsUntil(aHint.elementDOM)
          .each((aIndex, aElement) => {
            if (!lResult && $(aElement).prop('title').length > 0) {
              lResult = true;
            }
          });
      }
      return lResult;
    }
  },
  fn: 'objethint.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHint_1 = require('ObjetHint');
    const ObjetStyle_1 = require('ObjetStyle');
    const c_PPP = '…';
    function _reductionTextMultiline(aNode, aNodeText, aChaine, aOptions) {
      let lAvecModif = false;
      try {
        const lConteneur = $(aNode).parent();
        let lHeight = 0;
        const lWidth = Math.round(lConteneur.width());
        let lLineHeight = 0;
        if (
          MethodesObjet_1.MethodesObjet.isNumber(aOptions.nbLignesMax) &&
          aOptions.nbLignesMax > 0
        ) {
          try {
            lLineHeight = ObjetStyle_1.GStyle.getComputedValue(
              aNode,
              'line-height',
            );
            if (lLineHeight === 'normal') {
              lLineHeight =
                Math.ceil(
                  ObjetStyle_1.GStyle.getFloatComputedValue(aNode, 'font-size'),
                ) * 1.2;
            } else {
              lLineHeight = Math.ceil(parseFloat(lLineHeight));
            }
          } catch (e) {
            return true;
          }
          lHeight =
            lLineHeight *
            (aOptions.nbLignesMax > 0 &&
            MethodesObjet_1.MethodesObjet.isNumber(aOptions.nbLignesMax)
              ? aOptions.nbLignesMax
              : 1);
          if (!MethodesObjet_1.MethodesObjet.isNumber(lHeight)) {
            return true;
          }
        } else {
          lHeight = Math.floor(lConteneur.height());
        }
        const lEnOverflowHeight = function () {
          return lHeight > 0 && aNode.clientHeight - 1 > lHeight;
        };
        const lEnOverflow = function () {
          return (
            lHeight > 0 &&
            lWidth > 0 &&
            (lEnOverflowHeight() || aNode.scrollWidth - 1 > lWidth)
          );
        };
        if (lEnOverflow()) {
          lAvecModif = true;
          const cMinNbCar = 1;
          const lMinIndex = cMinNbCar;
          let lMaxIndex = aChaine.length;
          while (lMaxIndex > lMinIndex && lEnOverflow()) {
            const lMaxTemp = Math.floor((lMaxIndex + lMinIndex) / 2 || 0);
            if (lMaxTemp > lMinIndex) {
              if (lEnOverflowHeight()) {
                aNodeText.nodeValue = aChaine.slice(0, lMaxTemp) + c_PPP;
                if (lEnOverflowHeight()) {
                  lMaxIndex = lMaxTemp;
                }
              } else {
                const lClientHeight = aNode.clientHeight;
                aNodeText.nodeValue = aChaine.slice(0, lMaxTemp) + c_PPP;
                if (lEnOverflow() && aNode.clientHeight === lClientHeight) {
                  lMaxIndex = lMaxTemp;
                }
              }
            }
            lMaxIndex = lMaxIndex - 1;
            aNodeText.nodeValue = aChaine.slice(0, lMaxIndex) + c_PPP;
          }
        }
      } catch (e) {}
      if (
        lAvecModif &&
        aOptions.avecHint &&
        !ObjetHint_1.ObjetHint.getDisabled() &&
        !ObjetHint_1.ObjetHint.nodeDansHint(aNode)
      ) {
        ObjetHint_1.ObjetHint.attach({
          $Element: MethodesObjet_1.MethodesObjet.isFunction(
            aOptions.getJNodeHint,
          )
            ? $(aOptions.getJNodeHint(aNode))
            : $(aNode),
          namespace: 'ieellipsismultiline',
          contenu: aChaine,
          off: false,
        });
      }
      return true;
    }
    IEHtml.addAttribut(
      'ie-ellipsis-multiline',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lOptions = {
          nbLignesMax: aAttributValue || '',
          avecHint: true,
          getJNodeHint: null,
        };
        if (lOptions.nbLignesMax) {
          const lGetOptions = aOutils.getAccesParametres(
            aAttributValue,
            aContexteCourant,
          );
          if (lGetOptions.estFonction) {
            Object.assign(lOptions, lGetOptions.callback());
          } else {
            lOptions.nbLignesMax = parseInt(lOptions.nbLignesMax, 10);
          }
          if (!MethodesObjet_1.MethodesObjet.isNumber(lOptions.nbLignesMax)) {
            lOptions.nbLignesMax = '';
          }
        }
        if (
          !aContexteCourant.node.childNodes ||
          aContexteCourant.node.childNodes.length > 1
        ) {
          return true;
        }
        if (aContexteCourant.node.childNodes.length === 0) {
          return true;
        }
        const lNodeText = aContexteCourant.node.childNodes[0];
        if (!lNodeText || lNodeText.nodeType !== 3) {
          return true;
        }
        const lValueText = lNodeText.nodeValue;
        if (
          !lValueText ||
          !MethodesObjet_1.MethodesObjet.isString(lValueText) ||
          lValueText.length < 3
        ) {
          return true;
        }
        let lTraite = false;
        aOutils.surInjectionHtml(aContexteCourant, () => {
          if (
            !lTraite &&
            aContexteCourant.node.clientHeight > 0 &&
            aContexteCourant.node.clientWidth > 0
          ) {
            lTraite = _reductionTextMultiline(
              aContexteCourant.node,
              lNodeText,
              lValueText,
              lOptions,
            );
          }
        });
        aOutils.abonnerRefresh(
          () => {
            if (
              !lTraite &&
              aContexteCourant.node.scrollHeight > 0 &&
              aContexteCourant.node.clientWidth > 0
            ) {
              lTraite = _reductionTextMultiline(
                aContexteCourant.node,
                lNodeText,
                lValueText,
                lOptions,
              );
            }
          },
          aContexteCourant.node,
          aContexteCourant,
        );
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-ellipsis-multiline="' + lOptions.nbLignesMax + '"',
        );
        return true;
      },
    );
  },
  fn: 'iehtml.ellipisismultiline.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Chronometre = void 0;
    class Chronometre {
      constructor() {
        this.reset();
        this.actif = true;
      }
      start() {
        this.dateChrono = Date.now();
        this.actif = true;
      }
      stop() {
        this.valeur += Date.now() - this.dateChrono;
        this.actif = false;
      }
      reset() {
        this.dateChrono = Date.now();
        this.valeur = 0;
      }
      toString() {
        const lValeur =
          this.valeur + (this.actif ? Date.now() - this.dateChrono : 0);
        if (lValeur > 1000) {
          return lValeur / 1000 + ' s';
        }
        return lValeur + ' ms';
      }
    }
    exports.Chronometre = Chronometre;
  },
  fn: 'chronometre.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.deferLoadingScript = void 0;
    require('NamespaceIE');
    require('Divers');
    const Invocateur_1 = require('Invocateur');
    const Chronometre_1 = require('Chronometre');
    const lModules = {},
      isOpera =
        typeof window.opera !== 'undefined' &&
        window.opera.toString() === '[object Opera]',
      uUrlsProcess = {},
      options = { done: null, fail: null, messageChargement: '' };
    let lModuleEnCours = null,
      lSupportASync,
      lHead = null;
    const uPileChargementEnCours = {};
    function createNode(config) {
      const node = config.xhtml
        ? document.createElementNS(
            'http://www.w3.org/1999/xhtml',
            'html:script',
          )
        : document.createElement('script');
      if (config.scriptType) {
        node.type = config.scriptType;
      }
      node.async = false;
      return node;
    }
    function removeListener(node, func, name, ieName) {
      if (node.detachEvent && !isOpera) {
        if (ieName) {
          node.detachEvent(ieName, func);
        }
      } else {
        node.removeEventListener(name, func, false);
      }
    }
    function _getHead() {
      if (!lHead) {
        lHead = document.getElementsByTagName('head')[0];
      }
      return lHead;
    }
    function createLoaderScript(aUrl, aCallback, aParams) {
      let lLoader = null;
      function finScript(evt) {
        const node = evt.currentTarget || evt.srcElement;
        removeListener(node, onScriptLoad, 'load', 'onreadystatechange');
        removeListener(node, onScriptError, 'error');
        return node;
      }
      function onScriptLoad(evt) {
        if (
          evt.type === 'load' ||
          /^(complete|loaded)$/.test(
            (evt.currentTarget || evt.srcElement).readyState,
          )
        ) {
          finScript(evt);
          lLoader.loaded = true;
          lLoader.finChargement();
        }
      }
      lLoader = {
        url: aUrl,
        loaded: false,
        loadedFail: false,
        chrono: null,
        supportASync: false,
        timerFail: -1,
        params: aParams,
        load: function () {
          if (this.loaded) {
            this.finChargement();
            return;
          }
          const node = createNode({});
          if (lSupportASync === undefined) {
            if (!document.addEventListener) {
              lSupportASync = false;
            } else {
              lSupportASync = 'async' in node;
            }
          }
          if (
            node.attachEvent &&
            !(
              node.attachEvent.toString &&
              node.attachEvent.toString().indexOf('[native code') < 0
            ) &&
            !isOpera
          ) {
            node.attachEvent('onreadystatechange', onScriptLoad);
            lSupportASync = false;
          } else {
            node.addEventListener('load', onScriptLoad, false);
            node.addEventListener('error', onScriptError, false);
          }
          node.src = this.url;
          if (lSupportASync && this.params.accepteASync) {
            node.async = false;
          }
          _getHead().appendChild(node);
          const lSelf = this;
          this.timerFail = setTimeout(() => {
            lSelf.loadedTimeoutFail = true;
            onScriptError({ currentTarget: node });
          }, aParams.timeoutFailScript);
          if (lSupportASync && this.params.accepteASync && this.next) {
            this.params._compteurTimeout += 1;
            if (
              this.params.timeoutLoad >= 0 &&
              this.params._compteurTimeout >= this.params.nbPourDelaiTimeout
            ) {
              this.params._compteurTimeout = 0;
              setTimeout(() => {
                lSelf.next.load();
              }, this.params.timeoutLoad);
            } else {
              Promise.resolve().then(() => {
                this.next.load();
              });
            }
          }
        },
        finChargement: function () {
          clearTimeout(this.timerFail);
          aCallback(this);
          if (this.next && !(lSupportASync && this.params.accepteASync)) {
            this.next.load();
          }
        },
      };
      function onScriptError(evt) {
        finScript(evt);
        lLoader.loadedFail = true;
        lLoader.finChargement();
      }
      return lLoader;
    }
    function _loadSingletonModule(aNom, aParams) {
      const lNom = aNom.toLowerCase(),
        lModule = lModules[lNom];
      lModule.nom = lNom;
      lModule.params = aParams;
      const _callbackFin = (aEchec) => {
        if (aEchec) {
          if (options.fail) {
            options.fail(aNom, lModule);
          }
          if (aParams.fail) {
            aParams.fail(aNom, lModule);
          }
        } else {
          if (options.done) {
            options.done(aNom, lModule);
          }
          aParams.done(aNom, lModule);
        }
      };
      if (uPileChargementEnCours[lNom]) {
        uPileChargementEnCours[lNom].push(_callbackFin);
        return;
      }
      uPileChargementEnCours[lNom] = [];
      const lCallbackPile = (aEchec) => {
        _callbackFin();
        if (uPileChargementEnCours[lNom]) {
          const lTab = uPileChargementEnCours[lNom];
          delete uPileChargementEnCours[lNom];
          lTab.forEach((aFunc) => {
            aFunc(aEchec);
          });
        }
      };
      if (!aParams || !aParams.done) {
        lCallbackPile(true);
        return exports.deferLoadingScript;
      }
      if (!lModule) {
        lCallbackPile(true);
        return exports.deferLoadingScript;
      }
      lModuleEnCours = lNom;
      let lUrl, i, lScript, LPrevScript;
      function _callback(aLoader) {
        if (lModule.interrupt) {
          return;
        }
        if (aLoader.loadedFail) {
          aLoader.next = null;
          lModule.interrupt = true;
          uUrlsProcess[aLoader.url].failed = true;
          lCallbackPile(true);
          return;
        }
        uUrlsProcess[aLoader.url].resolved = true;
        if (!aLoader.next) {
          lCallbackPile();
        }
      }
      let lSurStartLoading = true;
      lModule.first = null;
      for (i = 0; i < lModule.urls.length; i++) {
        lUrl = lModule.urls[i];
        if (!uUrlsProcess[lUrl]) {
          uUrlsProcess[lUrl] = { started: true };
          if (lSurStartLoading) {
            lSurStartLoading = false;
          }
          lScript = createLoaderScript(lUrl, _callback, aParams);
          if (LPrevScript) {
            LPrevScript.next = lScript;
          }
          if (!lModule.first) {
            lModule.first = lScript;
          }
          LPrevScript = lScript;
        }
      }
      if (lModule.first) {
        lModule.first.load(lModule);
      } else {
        lCallbackPile();
      }
    }
    exports.deferLoadingScript = {
      add(aNom, aUrls) {
        const lNom = aNom.toLowerCase(),
          lModule = { urls: [], count: 0 };
        let lUrl, i;
        lModules[lNom] = lModule;
        for (i = 0; i < aUrls.length; i++) {
          lUrl = aUrls[i];
          lModule.urls.push(lUrl);
        }
        return exports.deferLoadingScript;
      },
      contains(aNom) {
        return !!lModules[aNom.toLowerCase()];
      },
      setOptions(aOptions) {
        Object.assign(options, aOptions);
        return exports.deferLoadingScript;
      },
      load(aNom, aParam) {
        if (typeof aNom === 'string') {
          exports.deferLoadingScript.load([aNom], aParam);
          return;
        }
        function _loadSingletonDeTableau(aNomsTraites, aParam, aDone, aFail) {
          if (aNomsTraites.length === 0) {
            lModuleEnCours = null;
            if (aParam.eventIO !== false) {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.patience,
                false,
              );
            }
            aDone();
            return;
          }
          aParam.done = function () {
            aNomsTraites.shift();
            if (aParam.timeoutLoadGroupe >= 0) {
              setTimeout(() => {
                _loadSingletonDeTableau(aNomsTraites, aParam, aDone, aFail);
              }, aParam.timeoutLoadGroupe);
            } else {
              Promise.resolve().then(() => {
                _loadSingletonDeTableau(aNomsTraites, aParam, aDone, aFail);
              });
            }
          };
          aParam.fail = function (aNom) {
            aNomsTraites = [];
            if (aParam.eventIO !== false) {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.patience,
                false,
              );
            }
            if (aFail) {
              aFail(aNom);
            }
          };
          aParam._compteurTimeout = 0;
          if (exports.deferLoadingScript.contains(aNomsTraites[0])) {
            if (aParam.eventIOExt) {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.patience,
                false,
              );
            }
            if (aParam.eventIO !== false) {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.patience,
                true,
                {
                  actualisation: true,
                  message: (
                    options.messageChargement +
                    ' ' +
                    aNomsTraites[0]
                  ).trim(),
                },
              );
            }
            _loadSingletonModule(aNomsTraites[0], aParam);
          } else {
            aParam.done();
          }
        }
        const lParams = Object.assign(
          {
            done: null,
            fail: null,
            eventIO: false,
            timeoutLoadGroupe: -1,
            timeoutLoad: -1,
            nbPourDelaiTimeout: 1,
            accepteASync: true,
            timeoutFailScript: 3 * 60 * 1000,
          },
          aParam,
        );
        if (Array.isArray(aNom)) {
          const lDone = lParams.done,
            lFail = lParams.fail;
          if (lParams.eventIO !== false) {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.patience,
              true,
              { message: options.messageChargement },
            );
          }
          _loadSingletonDeTableau(aNom, lParams, lDone, lFail);
          return exports.deferLoadingScript;
        } else {
          return exports.deferLoadingScript;
        }
      },
      loadAsync(aNom, aParam) {
        return new Promise((aResolve, aReject) => {
          const lParams = Object.assign(aParam || {}, {
            done: function (aParam) {
              aResolve(aParam);
            },
            fail: function (aParam) {
              aReject(aParam);
            },
          });
          exports.deferLoadingScript.load(aNom, lParams);
        });
      },
      afficherPatience() {
        var _a;
        if (!lModuleEnCours) {
          return false;
        }
        const lModule = lModules[lModuleEnCours.toLowerCase()];
        if (!lModule || !lModule.nom || !lModule.params) {
          return false;
        }
        lModule.params.eventIO = true;
        lModule.params.eventIOExt = true;
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.patience,
          true,
          { message: (options.messageChargement + ' ' + lModule.nom).trim() },
        );
        return true;
      },
    };
  },
  fn: 'deferloadingscript.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireTraitementImage = void 0;
    const DeferLoadingScript_1 = require('DeferLoadingScript');
    const Invocateur_1 = require('Invocateur');
    const UtilitaireTraitementImage = {
      browserAutoRotate: false,
      fileToDataUrlPromise(aFile) {
        return new Promise((aResolve, aReject) => {
          if (!aFile) {
            aReject();
          }
          const lReader = new FileReader();
          lReader.onloadend = function (e) {
            if (e.target.readyState === FileReader.DONE) {
              aResolve(e.target.result);
            }
          };
          lReader.onerror = function () {
            aReject();
          };
          lReader.onabort = function () {
            aReject();
          };
          lReader.readAsDataURL(aFile);
        });
      },
      loadImageDataUrlPromise(aDataUrl, aImage) {
        return new Promise((aResolve, aReject) => {
          const lImg = aImage || new Image();
          lImg.onload = function () {
            aResolve(lImg);
          };
          lImg.onerror = function () {
            aReject();
          };
          lImg.src = aDataUrl;
        });
      },
      fileToImgPromise(aFile, aImage) {
        return UtilitaireTraitementImage.fileToDataUrlPromise(aFile)
          .then((aDataUrl) => {
            return UtilitaireTraitementImage.loadImageDataUrlPromise(
              aDataUrl,
              aImage,
            );
          })
          .then((aImg) => {
            let lOrientation = -2;
            return Promise.resolve()
              .then(() => {
                if (UtilitaireTraitementImage.avecOrientationPossible(aFile)) {
                  return UtilitaireTraitementImage.getOrientationPromise(
                    aFile,
                  ).then(
                    (aOrientation) => {
                      lOrientation = aOrientation;
                    },
                    () => {},
                  );
                }
              })
              .then(() => {
                return { img: aImg, orientation: lOrientation };
              });
          });
      },
      getOrientationPromise(file) {
        return new Promise((aResolve, aReject) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const view = new DataView(e.target.result);
              if (view.getUint16(0, false) != 0xffd8) {
                return aResolve(-2);
              }
              const length = view.byteLength;
              let offset = 2;
              while (offset < length) {
                if (view.getUint16(offset + 2, false) <= 8) {
                  return aResolve(-1);
                }
                const marker = view.getUint16(offset, false);
                offset += 2;
                if (marker == 0xffe1) {
                  if (view.getUint32((offset += 2), false) != 0x45786966) {
                    return aResolve(-1);
                  }
                  const little = view.getUint16((offset += 6), false) == 0x4949;
                  offset += view.getUint32(offset + 4, little);
                  const tags = view.getUint16(offset, little);
                  offset += 2;
                  for (let i = 0; i < tags; i++) {
                    if (view.getUint16(offset + i * 12, little) == 0x0112) {
                      return aResolve(
                        view.getUint16(offset + i * 12 + 8, little),
                      );
                    }
                  }
                } else if ((marker & 0xff00) != 0xff00) {
                  break;
                } else {
                  offset += view.getUint16(offset, false);
                }
              }
              return aResolve(-1);
            } catch (e) {
              aReject(e);
            }
          };
          reader.onerror = function (e) {
            aReject(e);
          };
          reader.readAsArrayBuffer(file);
        });
      },
      avecOrientationPossible(aFile) {
        return (
          !!(aFile && aFile.type === 'image/jpeg') && !this.browserAutoRotate
        );
      },
      resizeEtOrientationImgToCanvas(aParams) {
        const lParams = Object.assign(
          {
            img: null,
            width: 0,
            height: 0,
            widthResize: 0,
            heightResize: 0,
            orientation: -1,
          },
          aParams,
        );
        const lWidth = lParams.widthResize || lParams.width;
        const lHeight = lParams.heightResize || lParams.height;
        const lCanvasResult = document.createElement('canvas');
        const lCtxDest = lCanvasResult.getContext('2d');
        lCanvasResult.width = lWidth;
        lCanvasResult.height = lHeight;
        if (lParams.orientation > 0) {
          const lCanvas = document.createElement('canvas');
          const lCtx = lCanvas.getContext('2d');
          lCanvas.width = lParams.width;
          lCanvas.height = lParams.height;
          lCtx.drawImage(lParams.img, 0, 0, lCanvas.width, lCanvas.height);
          if (4 < lParams.orientation && lParams.orientation < 9) {
            lCanvasResult.width = lHeight;
            lCanvasResult.height = lWidth;
          }
          switch (lParams.orientation) {
            case 2:
              lCtxDest.transform(-1, 0, 0, 1, lWidth, 0);
              break;
            case 3:
              lCtxDest.transform(-1, 0, 0, -1, lWidth, lHeight);
              break;
            case 4:
              lCtxDest.transform(1, 0, 0, -1, 0, lHeight);
              break;
            case 5:
              lCtxDest.transform(0, 1, 1, 0, 0, 0);
              break;
            case 6:
              lCtxDest.transform(0, 1, -1, 0, lHeight, 0);
              break;
            case 7:
              lCtxDest.transform(0, -1, -1, 0, lHeight, lWidth);
              break;
            case 8:
              lCtxDest.transform(0, -1, 1, 0, 0, lWidth);
              break;
            default:
              break;
          }
          lCtxDest.drawImage(lCanvas, 0, 0, lWidth, lHeight);
        } else {
          lCtxDest.drawImage(lParams.img, 0, 0, lWidth, lHeight);
        }
        return lCanvasResult;
      },
      resizeImgToCanvas(aImg, aMaxWidth, aMaxHeight, aOrientation) {
        const lWidthOriginal = aImg.width;
        const lHeightOriginal = aImg.height;
        const lMAX_WIDTH = aMaxWidth || 1500;
        const lMAX_HEIGHT = aMaxHeight || 1500;
        let lWidth = lWidthOriginal;
        let lHeight = lHeightOriginal;
        if (lWidth > lHeight) {
          if (lWidth > lMAX_WIDTH) {
            lHeight *= lMAX_WIDTH / lWidth;
            lWidth = lMAX_WIDTH;
          }
        } else {
          if (lHeight > lMAX_HEIGHT) {
            lWidth *= lMAX_HEIGHT / lHeight;
            lHeight = lMAX_HEIGHT;
          }
        }
        let lCanvasResult = null;
        const lAvecResize =
          lHeightOriginal !== lHeight || lWidthOriginal !== lWidth;
        if (lAvecResize) {
          lCanvasResult =
            UtilitaireTraitementImage.resizeEtOrientationImgToCanvas({
              img: aImg,
              width: lWidthOriginal,
              height: lHeightOriginal,
              widthResize: lWidth,
              heightResize: lHeight,
              orientation: aOrientation,
            });
        }
        return {
          avecResize: lAvecResize,
          canvas: lCanvasResult,
          img: aImg,
          width: lWidth,
          height: lHeight,
          widthOriginal: lWidthOriginal,
          heightOriginal: lHeightOriginal,
        };
      },
      canvasToBlobPromise(aCanvas, aType, aName, aCompression) {
        return new Promise((aResolve) => {
          aCanvas.toBlob(
            (aBlob) => {
              aBlob.name = aName;
              aResolve(aBlob);
            },
            aType,
            aCompression,
          );
        });
      },
      resizeFilePromise(aFile, aMaxWidth, aMaxHeight, aCompression) {
        return UtilitaireTraitementImage.fileToImgPromise(aFile)
          .then((aParamsFileToPromise) => {
            const lResult = UtilitaireTraitementImage.resizeImgToCanvas(
              aParamsFileToPromise.img,
              aMaxWidth,
              aMaxHeight,
              aParamsFileToPromise.orientation,
            );
            if (lResult.avecResize && lResult.canvas) {
              return UtilitaireTraitementImage.canvasToBlobPromise(
                lResult.canvas,
                aFile.type,
                aFile.name,
                aCompression,
              ).then((aBlob) => {
                lResult.file = aBlob;
                return lResult;
              });
            }
            lResult.file = aFile;
            return lResult;
          })
          .catch((e) => {
            return null;
          });
      },
      avecResizePossible(aFile) {
        return !!(
          aFile &&
          aFile.type &&
          [
            'image/jpeg',
            'image/jpg',
            'image/png',
            'image/bmp',
            'image/webp',
          ].indexOf(aFile.type) >= 0
        );
      },
      async genererPdfAsync(aListeFichiers) {
        try {
          await DeferLoadingScript_1.deferLoadingScript.loadAsync('jspdf');
        } catch (_a) {
          throw { erreurLib: true };
        }
        const lJsPDF = await Promise.resolve().then(() =>
          require('jspdf.min.js'),
        );
        if (!lJsPDF) {
          throw { erreurLib: true };
        }
        return Promise.resolve()
          .then(() => {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.patience,
              true,
              { delai: 100 },
            );
            const lPromises = [];
            if (aListeFichiers) {
              aListeFichiers.parcourir((aFichier) => {
                if (
                  !aFichier.estResize &&
                  UtilitaireTraitementImage.avecOrientationPossible(
                    aFichier.file,
                  )
                ) {
                  lPromises.push(
                    UtilitaireTraitementImage.fileToImgPromise(aFichier.file)
                      .then((aParamsFileToPromise) => {
                        if (aParamsFileToPromise.orientation >= 2) {
                          const lCanvasResult =
                            UtilitaireTraitementImage.resizeEtOrientationImgToCanvas(
                              {
                                img: aParamsFileToPromise.img,
                                width: aParamsFileToPromise.img.width,
                                height: aParamsFileToPromise.img.height,
                                orientation: aParamsFileToPromise.orientation,
                              },
                            );
                          return UtilitaireTraitementImage.canvasToBlobPromise(
                            lCanvasResult,
                            aFichier.file.type,
                            aFichier.file.name,
                          ).then((aBlob) => {
                            aFichier.file = aBlob;
                          });
                        }
                      })
                      .catch(() => {
                        return Promise.reject({ nom: aFichier.Libelle });
                      }),
                  );
                }
              });
            }
            return Promise.all(lPromises);
          })
          .then(() => {
            return new Promise((aResolve, aReject) => {
              const lNbFichiers = aListeFichiers ? aListeFichiers.count() : 0;
              if (aListeFichiers && lNbFichiers > 0) {
                let lNb = 0;
                const lFilesDataUrl = [];
                aListeFichiers.parcourir((aFichier, aIndex) => {
                  const lFichier = aFichier;
                  UtilitaireTraitementImage.fileToDataUrlPromise(
                    lFichier.file,
                  ).then(
                    ((aIndex, aDataUrl) => {
                      lNb += 1;
                      lFilesDataUrl[aIndex] = {
                        dataUrl: aDataUrl,
                        fichier: aFichier,
                        type: lFichier.file.type,
                      };
                      if (lNb >= lNbFichiers) {
                        aResolve(lFilesDataUrl);
                      }
                    }).bind(null, aIndex),
                    ((aLibelle) => {
                      aReject({ nom: aLibelle });
                    }).bind(null, lFichier.Libelle),
                  );
                });
              } else {
                aResolve(null);
              }
            });
          })
          .then((aFilesDataUrl) => {
            if (aFilesDataUrl && aFilesDataUrl.length > 0) {
              const lPDF = new lJsPDF();
              const lPromisesErreursJsPDF = [];
              aFilesDataUrl.forEach((aFile) => {
                try {
                  aFile.imageProp = lPDF.getImageProperties(aFile.dataUrl);
                } catch (e) {
                  lPromisesErreursJsPDF.push(
                    new Promise((aResolve, aReject) => {
                      let lTypePDF = '';
                      switch (aFile.type) {
                        case 'image/jpeg':
                          lTypePDF = 'JPEG';
                          break;
                        case 'image/png':
                          lTypePDF = 'PNG';
                          break;
                        default:
                          aReject({ nom: aFile.fichier.Libelle });
                          return;
                      }
                      UtilitaireTraitementImage.loadImageDataUrlPromise(
                        aFile.dataUrl,
                      ).then(
                        ((aFile, aTypePDF, aImage) => {
                          aFile.imageProp = {
                            width: aImage.width,
                            height: aImage.height,
                            fileType: aTypePDF,
                          };
                          aResolve();
                        }).bind(null, aFile, lTypePDF),
                        ((aFile) => {
                          return Promise.reject({ nom: aFile.fichier.Libelle });
                        }).bind(null, aFile),
                      );
                    }),
                  );
                }
              });
              return Promise.all(lPromisesErreursJsPDF).then(() => {
                return aFilesDataUrl;
              });
            }
          })
          .then((aFilesDataUrl) => {
            if (aFilesDataUrl && aFilesDataUrl.length > 0) {
              return new Promise((aResolve, aReject) => {
                let lPDF = new lJsPDF();
                aFilesDataUrl.every((aFile, aIndex) => {
                  try {
                    const lImageProp = aFile.imageProp;
                    if (aIndex !== 0) {
                      lPDF.addPage([lImageProp.width, lImageProp.height]);
                    } else {
                      lPDF = new lJsPDF({
                        format: [lImageProp.width, lImageProp.height],
                        unit: 'px',
                        orientation:
                          lImageProp.width >= lImageProp.height ? 'l' : 'p',
                        compress: true,
                      });
                    }
                    lPDF.addImage(
                      aFile.dataUrl,
                      lImageProp.fileType,
                      0,
                      0,
                      lImageProp.width / lPDF.internal.scaleFactor,
                      lImageProp.height / lPDF.internal.scaleFactor,
                      NaN,
                      'SLOW',
                    );
                    return true;
                  } catch (e) {
                    aReject({ nom: aFile.fichier.Libelle });
                    return false;
                  }
                });
                const lFile = lPDF.output('blob');
                lFile.name = 'file.pdf';
                aResolve({ file: lFile });
              });
            }
          })
          .finally(() => {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.patience,
              false,
            );
          });
      },
      getTabMimePDFImage() {
        return [
          'image/jpeg',
          'image/jpg',
          'image/png',
          'image/bmp',
          'image/gif',
        ];
      },
    };
    exports.UtilitaireTraitementImage = UtilitaireTraitementImage;
    function _browserAutoRotatesPromise() {
      return new Promise((resolve, reject) => {
        const image = new Image();
        image.onload = function () {
          resolve(image.naturalWidth === 1);
        };
        image.onerror = reject;
        image.src =
          'data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z';
      });
    }
    _browserAutoRotatesPromise().then((aVal) => {
      UtilitaireTraitementImage.browserAutoRotate = !!aVal;
    });
    if (!HTMLCanvasElement.prototype.toBlob) {
      Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {
        value: function (callback, type, quality) {
          const canvas = this;
          setTimeout(() => {
            const binStr = atob(canvas.toDataURL(type, quality).split(',')[1]),
              len = binStr.length,
              arr = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
              arr[i] = binStr.charCodeAt(i);
            }
            callback(new Blob([arr], { type: type || 'image/png' }));
          });
        },
      });
    }
  },
  fn: 'utilitairetraitementimage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireLoaderImage = void 0;
    const UtilitaireTraitementImage_1 = require('UtilitaireTraitementImage');
    const GUID_1 = require('GUID');
    const c_pilesImages = {
      enCours: [],
      enAttente: [],
      nbMax: 2,
      timeoutEchec: 60 * 1000,
    };
    let UtilitaireLoaderImage = {
      loadImage(aNodeImage, aUrl) {
        if (c_pilesImages.enCours.length >= c_pilesImages.nbMax) {
          c_pilesImages.enAttente.push({ node: aNodeImage, url: aUrl });
        } else {
          _loadImage(aNodeImage, aUrl);
        }
      },
    };
    exports.UtilitaireLoaderImage = UtilitaireLoaderImage;
    const uGenerateurGUID = new GUID_1.GUID.generateur();
    function _loadImage(aNodeImage, aUrl) {
      if (!aNodeImage || !document.body.contains(aNodeImage)) {
        _depiler();
        return;
      }
      const lId = uGenerateurGUID.get();
      c_pilesImages.enCours.push(lId);
      return Promise.race([
        UtilitaireTraitementImage_1.UtilitaireTraitementImage.loadImageDataUrlPromise(
          aUrl,
          aNodeImage,
        ).catch(() => {}),
        new Promise((aResolve) => {
          setTimeout(() => {
            aResolve();
          }, c_pilesImages.timeoutEchec);
        }),
      ]).then(() => {
        const lIndex = c_pilesImages.enCours.indexOf(lId);
        if (lIndex >= 0) {
          c_pilesImages.enCours.splice(lIndex, 1);
        }
        _depiler();
      });
    }
    function _depiler() {
      if (
        c_pilesImages.enAttente.length > 0 &&
        c_pilesImages.enCours.length < c_pilesImages.nbMax
      ) {
        const lAttente = c_pilesImages.enAttente.shift();
        _loadImage(lAttente.node, lAttente.url);
      }
    }
  },
  fn: 'utilitaireloaderimage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const UtilitaireLoaderImage_1 = require('UtilitaireLoaderImage');
    let uObserverImgSrc = null;
    IEHtml.addAttribut(
      'ie-load-src',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lUrl = aAttributValue || '';
        if (lUrl) {
          const lJNode = $(aContexteCourant.node);
          aContexteCourant.node.setAttribute('data-src', lUrl);
          lJNode.on('error', () => {
            if (lJNode.hasClass('img-portrait')) {
              aContexteCourant.node.removeAttribute('src');
            }
            aContexteCourant.node.classList.remove('ie-imgviewer');
          });
          aOutils.surInjectionHtml(aContexteCourant, () => {
            if (uObserverImgSrc) {
              uObserverImgSrc.observe(aContexteCourant.node);
            } else {
              UtilitaireLoaderImage_1.UtilitaireLoaderImage.loadImage(
                aContexteCourant.node,
                lUrl,
              );
            }
          });
        }
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          `ie-load-src="${lUrl}"`,
        );
        return true;
      },
    );
    try {
      uObserverImgSrc = new IntersectionObserver((aObservables) => {
        aObservables.forEach((aObservable) => {
          if (aObservable.intersectionRatio > 0 || aObservable.isIntersecting) {
            const lNode = aObservable.target;
            if (lNode) {
              const lUrl = lNode.dataset.src;
              UtilitaireLoaderImage_1.UtilitaireLoaderImage.loadImage(
                lNode,
                lUrl,
              );
              uObserverImgSrc.unobserve(lNode);
            }
          }
        });
      });
    } catch (e) {
      uObserverImgSrc = null;
    }
  },
  fn: 'iehtml.load.src.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireMenuContextuelNatif = void 0;
    const UtilitaireMenuContextuelNatif = {
      desactiverSurElement(aJElement) {
        if (IE.estMobile || !aJElement || !aJElement.length) {
          return;
        }
        return aJElement
          .off(
            'contextmenu.AvecMenuContextuel1 contextmenu.AvecMenuContextuel2',
          )
          .on(
            'contextmenu.AvecMenuContextuel1',
            UtilitaireMenuContextuelNatif.accepter,
          )
          .on(
            {
              'contextmenu.AvecMenuContextuel2': function (event) {
                event.originalEvent.__marqueurAutoriserMenuContextuel = true;
                return true;
              },
            },
            '.AvecMenuContextuel',
          );
      },
      accepter(aEvent) {
        if (aEvent.type !== 'contextmenu') {
          return false;
        }
        const lName =
          aEvent.target && aEvent.target.tagName
            ? aEvent.target.tagName.toLowerCase()
            : '';
        let lType = aEvent.target.type || '';
        lType = lType.toLowerCase();
        const lInputConcerne =
          (lName === 'input' &&
            lType !== 'checkbox' &&
            lType !== 'radio' &&
            lType !== 'button') ||
          lName === 'textarea';
        return (
          (lInputConcerne &&
            !$(aEvent.target).hasClass('SansMenuContextuel')) ||
          (aEvent.originalEvent &&
            '__marqueurAutoriserMenuContextuel' in aEvent.originalEvent &&
            aEvent.originalEvent.__marqueurAutoriserMenuContextuel === true) ||
          $(aEvent.target).hasClass('AvecMenuContextuel')
        );
      },
    };
    exports.UtilitaireMenuContextuelNatif = UtilitaireMenuContextuelNatif;
  },
  fn: 'utilitairemenucontextuelnatif.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ZoneFenetre = void 0;
    const ObjetHtml_1 = require('ObjetHtml');
    const Invocateur_1 = require('Invocateur');
    const UtilitaireMenuContextuelNatif_1 = require('UtilitaireMenuContextuelNatif');
    const ZoneFenetre = {
      idZoneFenetre: 'zone_fenetre',
      idConteneurApp: '',
      getElementZoneFenetre() {
        const lId = ZoneFenetre.idZoneFenetre;
        let lElement = ObjetHtml_1.GHtml.getElement(lId);
        if (!ObjetHtml_1.GHtml.estElement(lElement)) {
          lElement = ObjetHtml_1.GHtml.htmlToDOM(
            IE.jsx.str('div', { id: lId, class: 'NePasImprimer' }),
          );
          const lDivFrere = ZoneFenetre.idConteneurApp
            ? ObjetHtml_1.GHtml.getElement(ZoneFenetre.idConteneurApp)
            : null;
          if (lDivFrere && lDivFrere.parentNode) {
            lDivFrere.parentNode.insertBefore(lElement, lDivFrere);
          } else {
            document.body.appendChild(lElement);
          }
          Invocateur_1.Invocateur.evenement('creationZoneFenetre', lElement);
          UtilitaireMenuContextuelNatif_1.UtilitaireMenuContextuelNatif.desactiverSurElement(
            $(lElement),
          );
        }
        return lElement;
      },
      ajouterFenetre(aId, aZIndex) {
        if (ObjetHtml_1.GHtml.elementExiste(aId)) {
          ZoneFenetre.enleverFenetre(aId);
          IE.log.addLog(
            'ZoneFenetre.ajouterFenetre : la fenetre ' + aId + ' existe déjà!',
          );
        }
        const lZIndex = aZIndex === 0 ? 0 : aZIndex || 1100;
        ObjetHtml_1.GHtml.addHtml(
          ZoneFenetre.getElementZoneFenetre(),
          IE.jsx.str('div', {
            class: 'zone-fenetre',
            id: aId,
            style: `display:none;${lZIndex ? 'z-index:' + lZIndex : ''}`,
          }),
        );
      },
      enleverFenetre(aId) {
        const lElement = ObjetHtml_1.GHtml.getElement(aId);
        if (
          ObjetHtml_1.GHtml.estElement(lElement) &&
          lElement.parentNode &&
          'id' in lElement.parentNode &&
          lElement.parentNode.id === ZoneFenetre.idZoneFenetre
        ) {
          $(lElement).remove();
        } else {
          IE.log.addLog('erreur enleverFenetre de ' + aId);
        }
      },
    };
    exports.ZoneFenetre = ZoneFenetre;
  },
  fn: 'iezonefenetre.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IEHtml.ImgViewer.css');
    const IEHtml = require('IEHtml');
    const Invocateur_1 = require('Invocateur');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ToucheClavier_1 = require('ToucheClavier');
    const GUID_1 = require('GUID');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const jsx_1 = require('jsx');
    const ObjetSupport_1 = require('ObjetSupport');
    const MethodesObjet_1 = require('MethodesObjet');
    const uSingleton_IdViewer = `id-imgviewer-${GUID_1.GUID.getId()}`;
    let uSingleton_ViewerIsVisible = false;
    const uViewerSurZoom = {
      estZoom: false,
      styleIdViewer: {},
      styleIdArticle: {},
      styleIdViewerImg: {},
      meta: IE.estMobile ? $('meta[name=viewport]').get(0).content : '',
    };
    const uIdBtnZoomIn = 'btnZoomIn' + GUID_1.GUID.getId();
    const uIdBtnZoomOut = 'btnZoomOut' + GUID_1.GUID.getId();
    const uIdBtnNext = 'btnNext' + GUID_1.GUID.getId();
    const uIdBtnPrev = 'btnPrev' + GUID_1.GUID.getId();
    const uIdTitre = 'zoneTitre' + GUID_1.GUID.getId();
    const uIdBtnFermer = 'btnFermer' + GUID_1.GUID.getId();
    let uIdNavGauche;
    let uIdNavDroite;
    let lWidthDefaut;
    let lHeightDefaut;
    let uState;
    let uFocusPrecedent = null;
    IEHtml.addAttribut(
      'ie-imgviewer',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        $(aContexteCourant.node).addClass('ie-imgviewer');
        $(aContexteCourant.node).eventValidation((aEvent) => {
          if (aNodeName !== 'img') {
            return true;
          }
          if (!aContexteCourant.node.classList.contains('ie-imgviewer')) {
            return;
          }
          uFocusPrecedent = document.activeElement;
          if (!IE.estMobile) {
            _ouvrirViewer(aContexteCourant.node, aEvent, true);
          } else {
            window.open(_getUrlImg(aContexteCourant.node));
          }
          if (ObjetSupport_1.Support.supportEventOnPopState) {
            uState = MethodesObjet_1.MethodesObjet.dupliquer(
              window.history.state,
            );
            window.history.pushState({ popStateViewer: true }, '');
          }
        });
        aOutils.addCommentaireDebug(aContexteCourant.node, `ie-imgviewer`);
        return true;
      },
    );
    function _ouvrirViewer(aNode, aEvent, aAvecAnimationOuverture) {
      var _a;
      lWidthDefaut = 0;
      lHeightDefaut = 0;
      const lUrl = _getUrlImg(aNode);
      if (lUrl) {
        if (aEvent) {
          aEvent.stopPropagation();
        }
        _fermer();
        let lIndicePrec = -1;
        let lIndiceSuiv = -1;
        let lJImgsNav;
        const lNodeDiapos = aNode.closest('.ie-imgviewer-container');
        if (lNodeDiapos) {
          lJImgsNav = $(lNodeDiapos).find('img.ie-imgviewer');
          if (lJImgsNav.length > 1) {
            const lIndexImageCourante = lJImgsNav.index(aNode);
            lIndicePrec =
              lIndexImageCourante === 0
                ? lJImgsNav.length - 1
                : lIndexImageCourante - 1;
            lIndiceSuiv =
              lIndexImageCourante >= lJImgsNav.length - 1
                ? 0
                : lIndexImageCourante + 1;
            if (!_getUrlImg(lJImgsNav.get(lIndicePrec))) {
              lIndicePrec = -1;
            }
            if (!_getUrlImg(lJImgsNav.get(lIndiceSuiv))) {
              lIndiceSuiv = -1;
            }
          }
        }
        uSingleton_ViewerIsVisible = true;
        const lControleur = {
          nodeFocus(aNextTab) {
            $(this.node).on('focus', () => {
              const lJQBandeau = $('.BandeauViewer >');
              ObjetHtml_1.GHtml.setFocus(
                aNextTab ? lJQBandeau.first().get(0) : lJQBandeau.last().get(0),
              );
            });
          },
          getNode() {
            $(this.node).on({
              destroyed: () => {
                if (uIdNavGauche) {
                  Invocateur_1.Invocateur.desabonner([uIdNavGauche]);
                }
                if (uIdNavDroite) {
                  Invocateur_1.Invocateur.desabonner([uIdNavDroite]);
                }
              },
              'ie-doubletap': () => {
                if (IE.estMobile) {
                  if (!uViewerSurZoom.estZoom) {
                    _surEntreeDansModeZoom();
                  } else {
                    _surSortieDuModeZoom();
                  }
                  this.controleur.$refreshSelf();
                }
              },
            });
            if (!IE.estMobile) {
              $(this.node)
                .find('img')
                .on({
                  'ie-doubletap': () => {
                    if (!uViewerSurZoom.estZoom) {
                      _surEntreeDansModeZoom();
                    } else {
                      _surSortieDuModeZoom();
                    }
                    this.controleur.$refreshSelf();
                  },
                });
            }
            $(this.node)
              .find('>.VoileDeFondViewer')
              .on('click', (aEvent) => {
                if (
                  !IE.estMobile ||
                  (!uViewerSurZoom.estZoom &&
                    !(
                      aEvent.pointerType !== 'touch' &&
                      (lIndicePrec >= 0 || lIndiceSuiv >= 0)
                    ))
                ) {
                  _fermerTransition();
                }
              });
            if (lIndicePrec >= 0) {
              $(this.node).on('swiperight', () => {
                const lScroll = $('#' + uSingleton_IdViewer).get(0);
                if (lScroll.scrollLeft === 0) {
                  _ouvrirViewer(lJImgsNav.get(lIndicePrec));
                }
              });
              if (uIdNavGauche) {
                Invocateur_1.Invocateur.desabonner([uIdNavGauche]);
              }
              uIdNavGauche = Invocateur_1.Invocateur.abonner(
                GNavigateur.getEventInvocateur('keyup'),
                (aEvent) => {
                  if (
                    !uViewerSurZoom.estZoom &&
                    [ToucheClavier_1.ToucheClavier.FlecheGauche].includes(
                      aEvent.which,
                    )
                  ) {
                    _ouvrirViewer(lJImgsNav.get(lIndicePrec));
                    ObjetHtml_1.GHtml.setFocus(aEvent.target.id);
                  }
                },
              );
            }
            if (lIndiceSuiv >= 0) {
              $(this.node).on('swipeleft', () => {
                const lScroll = $('#' + uSingleton_IdViewer).get(0);
                const lJImage = $('#' + uSingleton_IdViewer + ' img');
                const lWidth = lJImage.width();
                if (
                  lScroll.scrollLeft >=
                  Math.round10(lWidth - GNavigateur.clientL, -1)
                ) {
                  _ouvrirViewer(lJImgsNav.get(lIndiceSuiv));
                }
              });
              if (uIdNavDroite) {
                Invocateur_1.Invocateur.desabonner([uIdNavDroite]);
              }
              uIdNavDroite = Invocateur_1.Invocateur.abonner(
                GNavigateur.getEventInvocateur('keyup'),
                (aEvent) => {
                  if (
                    !uViewerSurZoom.estZoom &&
                    [ToucheClavier_1.ToucheClavier.FlecheDroite].includes(
                      aEvent.which,
                    )
                  ) {
                    _ouvrirViewer(lJImgsNav.get(lIndiceSuiv));
                    ObjetHtml_1.GHtml.setFocus(aEvent.target.id);
                  }
                },
              );
            }
            $(this.node).on('swipedown', () => {
              const lScroll = $('#' + uSingleton_IdViewer).get(0);
              if (lScroll.scrollTop === 0) {
                _fermerTransition();
              }
            });
          },
          nodeImg() {
            $(this.node).on('load', function () {
              this.classList.remove('loading');
              const lNatHeight = this.naturalHeight;
              const lNatWidth = this.naturalWidth;
              const lPourcentEcran = 0.9;
              let lRatio = 0;
              const lClientL =
                GNavigateur.clientL -
                (lIndicePrec >= 0 || lIndiceSuiv >= 0 ? 35 * 2 : 0);
              const lRatioImage = lNatHeight / lNatWidth;
              const lRatioEcran = GNavigateur.clientH / lClientL;
              if (lRatioEcran > lRatioImage) {
                lRatio = (lClientL * lPourcentEcran) / lNatWidth;
              } else {
                lRatio = (GNavigateur.clientH * lPourcentEcran) / lNatHeight;
              }
              lRatio = Math.min(lRatio, 2);
              lHeightDefaut = lNatHeight * lRatio;
              lWidthDefaut = lNatWidth * lRatio;
              $(this).css({ height: lHeightDefaut, width: lWidthDefaut });
              if (IE.estMobile) {
                _surEntreeDansModeZoom();
              }
            });
          },
          avecBandeauViewer() {
            return !IE.estMobile;
          },
          btnFermer: {
            event() {
              _fermerTransition();
            },
            getTitle() {
              return ObjetTraduction_1.GTraductions.getValeur('Fermer');
            },
          },
          btnNav: {
            event(aIndiceNode, aEvent) {
              _ouvrirViewer(lJImgsNav.get(aIndiceNode), aEvent);
              ObjetHtml_1.GHtml.setFocus(aEvent.target.id);
            },
          },
          btnZoom: {
            event(aEstZoomIn) {
              _surActionZoom(aEstZoomIn);
            },
            getDisabled(aEstZoomIn) {
              const lJImage = $('#' + uSingleton_IdViewer + ' img');
              const lWidth = lJImage.width();
              const lHeight = lJImage.height();
              if (!lWidth || !lWidthDefaut) {
                return !aEstZoomIn;
              }
              return aEstZoomIn
                ? Math.round10(lWidth, -1) >=
                    Math.round10(lWidthDefaut * Math.pow(1.5, 4), -1) ||
                    Math.round10(lHeight, -1) >=
                      Math.round10(lHeightDefaut * Math.pow(1.5, 4), -1)
                : !uViewerSurZoom.estZoom ||
                    Math.round10(lWidth, -1) <=
                      Math.round10(lWidthDefaut, -1) ||
                    Math.round10(lHeight, -1) <=
                      Math.round10(lHeightDefaut, -1);
            },
          },
          dragImg() {
            let lScrollLeftDepart = 0;
            let lScrollTopDepart = 0;
            return {
              start() {
                if (!IE.estMobile && uViewerSurZoom.estZoom) {
                  const lJImage = $('#' + uSingleton_IdViewer + ' img');
                  lJImage.css({ cursor: 'grabbing' });
                  const lScroll = $('#' + uSingleton_IdViewer).get(0);
                  lScrollLeftDepart = lScroll.scrollLeft;
                  lScrollTopDepart = lScroll.scrollTop;
                }
              },
              drag(aParamsDrag) {
                if (!IE.estMobile && uViewerSurZoom.estZoom) {
                  const lScroll = $('#' + uSingleton_IdViewer).get(0);
                  lScroll.scrollLeft = lScrollLeftDepart - aParamsDrag.offset.x;
                  lScroll.scrollTop = lScrollTopDepart - aParamsDrag.offset.y;
                }
              },
              stop() {
                if (!IE.estMobile && uViewerSurZoom.estZoom) {
                  const lJImage = $('#' + uSingleton_IdViewer + ' img');
                  lJImage.css({ cursor: 'grab' });
                }
              },
            };
          },
        };
        const lLibelleImage =
          (_a = aNode.getAttribute('data-libelle')) !== null && _a !== void 0
            ? _a
            : '';
        IEHtml.injectHTMLParams({
          element: IEZoneFenetre_1.ZoneFenetre.getElementZoneFenetre(),
          html: IE.jsx.str(
            'div',
            {
              id: uSingleton_IdViewer,
              class: [
                'ie-imgviewer-popup',
                aAvecAnimationOuverture ? '' : 'active',
              ],
              'ie-node': 'getNode',
              role: 'dialog',
              'aria-modal': 'true',
            },
            IE.jsx.str('div', {
              class: 'sr-only',
              tabindex: '0',
              'aria-hidden': 'true',
              'ie-node': 'nodeFocus(false)',
            }),
            IE.jsx.str('div', {
              class: 'VoileDeFondViewer',
              'aria-hidden': 'true',
            }),
            IE.jsx.str(
              'div',
              { class: 'BandeauViewer', 'ie-if': 'avecBandeauViewer' },
              IE.jsx.str('ie-btnicon', {
                id: uIdBtnZoomIn,
                'ie-model': (0, jsx_1.jsxFuncAttr)('btnZoom', [true]),
                class:
                  'icon_zoom_in btn-zoom-viewer zoom-in bt-activable bt-large',
                title: ObjetTraduction_1.GTraductions.getValeur('Agrandir'),
              }),
              IE.jsx.str('ie-btnicon', {
                id: uIdBtnZoomOut,
                'ie-model': (0, jsx_1.jsxFuncAttr)('btnZoom', [false]),
                class:
                  'icon_zoom_out btn-zoom-viewer zoom-out bt-activable bt-large',
                title: ObjetTraduction_1.GTraductions.getValeur('Reduire'),
              }),
              lIndicePrec >= 0
                ? IE.jsx.str('ie-btnicon', {
                    id: uIdBtnPrev,
                    'ie-model': (0, jsx_1.jsxFuncAttr)('btnNav', [lIndicePrec]),
                    class:
                      'icon_angle_left btn-carr-viewer prec bt-activable bt-large',
                    title:
                      ObjetTraduction_1.GTraductions.getValeur('Precedent'),
                    tabindex: '0',
                  })
                : '',
              IE.jsx.str(
                'div',
                {
                  id: uIdTitre,
                  class: 'TitreImage',
                  'ie-ellipsis': true,
                  tabindex: '0',
                },
                lLibelleImage,
              ),
              lIndiceSuiv >= 0
                ? IE.jsx.str('ie-btnicon', {
                    id: uIdBtnNext,
                    'ie-model': (0, jsx_1.jsxFuncAttr)('btnNav', [lIndiceSuiv]),
                    class:
                      'icon_angle_right btn-carr-viewer suiv bt-activable bt-large',
                    title: ObjetTraduction_1.GTraductions.getValeur('Suivant'),
                    tabindex: '0',
                  })
                : '',
              IE.jsx.str('ie-btnicon', {
                id: uIdBtnFermer,
                'ie-model': 'btnFermer',
                class: 'icon_fermeture_widget btn-fermer bt-activable bt-large',
              }),
            ),
            IE.jsx.str(
              'div',
              { class: 'conteneur-img' },
              IE.jsx.str('img', {
                src: lUrl,
                class: ['AvecMenuContextuel', 'loading'],
                alt: ObjetTraduction_1.GTraductions.getValeur(
                  'Visionneuse.altImage',
                ),
                'aria-labelledby': uIdTitre,
                'ie-node': 'nodeImg',
                'ie-draggable': !IE.estMobile ? 'dragImg' : false,
              }),
            ),
            IE.jsx.str('div', {
              class: 'sr-only',
              tabindex: '0',
              'aria-hidden': 'true',
              'ie-node': 'nodeFocus(true)',
            }),
          ),
          controleur: lControleur,
        });
        if (aAvecAnimationOuverture) {
          const lElement = ObjetHtml_1.GHtml.getElement(uSingleton_IdViewer);
          lElement.offsetWidth;
          lElement.classList.add('active');
        }
        if (!IE.estMobile) {
          ObjetHtml_1.GHtml.setFocus(uIdTitre);
        } else {
          _surEntreeDansModeZoom();
        }
      }
    }
    function _getUrlImg(aNode) {
      if (aNode && aNode.getAttribute) {
        let lStrUrl =
          aNode.getAttribute('src') || aNode.getAttribute('data-src');
        if (lStrUrl) {
          try {
            let lUrl = new URL(lStrUrl, location);
            lUrl.searchParams.delete('miniature');
            return lUrl.toString();
          } catch (e) {
            return lStrUrl;
          }
        }
      }
    }
    function _surEntreeDansModeZoom() {
      let lStyle = $('#' + uSingleton_IdViewer).get(0).style;
      uViewerSurZoom.styleIdViewer = {
        overflow: lStyle.overflow,
        display: lStyle.display,
      };
      lStyle = $('#' + uSingleton_IdViewer + ' .conteneur-img').get(0).style;
      uViewerSurZoom.styleIdArticle = {
        'min-height': lStyle.minHeight,
        'min-width': lStyle.minWidth,
      };
      lStyle = $('#' + uSingleton_IdViewer + ' img').get(0).style;
      uViewerSurZoom.styleIdViewerImg = {
        width: lStyle.width,
        height: lStyle.height,
        'max-width': lStyle.maxWidth,
        position: lStyle.position,
        margin: lStyle.margin,
        cursor: lStyle.cursor,
      };
      const lRatioZoom = IE.estMobile ? 1.25 : 1.5;
      const lWidthStart = lWidthDefaut * lRatioZoom;
      const lHeightStart = lHeightDefaut * lRatioZoom;
      $('#' + uSingleton_IdViewer).css({
        overflow: 'scroll',
        display: 'inline-block',
      });
      $('#' + uSingleton_IdViewer + ' .conteneur-img').css({
        'min-height': '100%',
        'min-width': '100%',
      });
      $('#' + uSingleton_IdViewer + ' img').css({
        width: lWidthStart + 'px',
        height: lHeightStart + 'px',
        'max-width': 'none',
        position: 'relative',
        margin: 'auto',
        cursor: 'grab',
      });
      $('#' + uSingleton_IdViewer).get(0).scrollLeft =
        (lWidthStart - GNavigateur.clientL) / 2;
      $('#' + uSingleton_IdViewer).get(0).scrollTop =
        (lHeightStart - GNavigateur.clientH) / 2;
      if (IE.estMobile) {
        $('meta[name=viewport]').get(0).content = 'width=device-width';
      }
      uViewerSurZoom.estZoom = true;
    }
    function _surSortieDuModeZoom() {
      if (IE.estMobile) {
        _fermerTransition();
      } else {
        $('#' + uSingleton_IdViewer).css(uViewerSurZoom.styleIdViewer);
        $('#' + uSingleton_IdViewer + ' .conteneur-img').css(
          uViewerSurZoom.styleIdArticle,
        );
        $('#' + uSingleton_IdViewer + ' img').css(
          uViewerSurZoom.styleIdViewerImg,
        );
        $('#' + uSingleton_IdViewer + ' > .VoileDeFondViewer').show();
        uViewerSurZoom.estZoom = false;
      }
    }
    function _fermer() {
      if (uSingleton_ViewerIsVisible) {
        uSingleton_ViewerIsVisible = false;
        uViewerSurZoom.estZoom = false;
        $(`#${uSingleton_IdViewer}`).remove();
      }
      if (IE.estMobile) {
        $('meta[name=viewport]').get(0).content = uViewerSurZoom.meta;
      }
      $(window).off('popstate.imgviewer');
      if (uState) {
        window.history.replaceState(uState, '');
      }
    }
    function _fermerTransition() {
      if (uSingleton_ViewerIsVisible) {
        $(`#${uSingleton_IdViewer}`)
          .removeClass('active')
          .on('transitionend', () => {
            _fermer();
            if (
              (uFocusPrecedent === null || uFocusPrecedent === void 0
                ? void 0
                : uFocusPrecedent.focus) &&
              $(uFocusPrecedent).length === 1
            ) {
              uFocusPrecedent.focus();
              uFocusPrecedent = null;
            }
          });
      }
    }
    function _surActionZoom(aEstZoomIn) {
      const lJImage = $('#' + uSingleton_IdViewer + ' img');
      const lWidth = lJImage.width();
      const lHeight = lJImage.height();
      const lScroll = $('#' + uSingleton_IdViewer).get(0);
      let lNewWidth = 0;
      let lNewHeight = 0;
      if (aEstZoomIn) {
        if (uViewerSurZoom.estZoom) {
          lNewWidth = lWidth * 1.5;
          lNewHeight = lHeight * 1.5;
          lJImage.width(lNewWidth);
          lJImage.height(lNewHeight);
          lScroll.scrollLeft += (lNewWidth - lWidth) / 2;
          lScroll.scrollTop += (lNewHeight - lHeight) / 2;
        } else {
          _surEntreeDansModeZoom();
        }
      } else {
        lNewWidth = lWidth / 1.5;
        lNewHeight = lHeight / 1.5;
        if (
          Math.round10(lNewWidth, -1) === Math.round10(lWidthDefaut, -1) &&
          Math.round10(lNewHeight, -1) === Math.round10(lHeightDefaut, -1)
        ) {
          _surSortieDuModeZoom();
        } else {
          lJImage.width(lNewWidth);
          lJImage.height(lNewHeight);
          lScroll.scrollLeft += (lNewWidth - lWidth) / 2;
          lScroll.scrollTop += (lNewHeight - lHeight) / 2;
        }
      }
    }
    $(document).ready(() => {
      $(document).on('keydown.imgviewer', (aEvent) => {
        if (uSingleton_ViewerIsVisible) {
          if (
            [
              ToucheClavier_1.ToucheClavier.Espace,
              ToucheClavier_1.ToucheClavier.RetourChariot,
            ].includes(aEvent.which)
          ) {
            if (
              ![uIdBtnZoomIn, uIdBtnZoomOut, uIdBtnNext, uIdBtnPrev].includes(
                aEvent.target.id,
              )
            ) {
              _fermerTransition();
            }
          }
          if ([ToucheClavier_1.ToucheClavier.Echap].includes(aEvent.which)) {
            _fermerTransition();
          }
        }
      });
      $(window).on('scroll.imgviewer resize.imgviewer', () => {
        if (!IE.estMobile || !uViewerSurZoom.estZoom) {
          _fermerTransition();
        }
      });
    });
    $(window).on('popstate.imgviewer', (event) => {
      event.preventDefault();
      _fermerTransition();
    });
    Invocateur_1.Invocateur.abonner('surAffichageFenetre', () => {
      _fermerTransition();
    });
    Invocateur_1.Invocateur.abonner(
      Invocateur_1.ObjetInvocateur.events.fermerFenetres,
      () => {
        _fermerTransition();
      },
    );
  },
  fn: 'iehtml.imgviewer.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    IEHtml.addAttribut(
      'ie-autoresize',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        if (aNodeName === 'ie-textareamax') {
          return true;
        }
        if (aNodeName !== 'textarea') {
          return true;
        }
        let lEstTextAreaMaxWrapper = false;
        let lJNode = $(aContexteCourant.node);
        let lInitBesoinObserveur = true;
        const lCalcul = function () {
          const lEstVisible = aContexteCourant.node.scrollHeight > 0;
          if (!lEstVisible) {
            if (lInitBesoinObserveur) {
              lInitBesoinObserveur = false;
              let lObserver;
              try {
                lObserver = new IntersectionObserver((aObservables) => {
                  if (
                    aObservables[0] &&
                    (aObservables[0].intersectionRatio > 0 ||
                      aObservables[0].isIntersecting)
                  ) {
                    lObserver.disconnect();
                    lCalcul();
                  }
                });
                lObserver.observe(aContexteCourant.node);
              } catch (e) {
                lObserver = null;
              }
            }
            return;
          }
          lInitBesoinObserveur = false;
          aContexteCourant.node.style.height = '5px';
          const lComputedStyle = global.getComputedStyle(aContexteCourant.node);
          const lTaille =
            aContexteCourant.node.scrollHeight +
            parseFloat(lComputedStyle.getPropertyValue('border-top-width')) +
            parseFloat(lComputedStyle.getPropertyValue('border-bottom-width'));
          aContexteCourant.node.style.height = lTaille + 'px';
          if (lEstTextAreaMaxWrapper) {
            const lNodeWrapper = aContexteCourant.node.closest(
              '.textareamax-wrapper',
            );
            if (!lNodeWrapper) {
              return;
            }
            const lHeightParent = $(lNodeWrapper).height();
            if (Math.ceil(lTaille) > lHeightParent) {
              aContexteCourant.node.style.height = lHeightParent + 'px';
            } else if (Math.ceil(lTaille) < lHeightParent) {
              aContexteCourant.node.style.height = '100%';
            }
          }
        };
        let lVal = lJNode.val();
        let lValPlaceHolder = lJNode.attr('placeholder');
        lJNode.on('input', () => {
          const lNewVal = lJNode.val();
          if (lVal !== lNewVal) {
            lVal = lNewVal;
            lCalcul();
          }
        });
        aOutils.abonnerRefresh(
          () => {
            const lNewVal = lJNode.val();
            const lNewValPlaceHolder = lJNode.attr('placeholder');
            if (lVal !== lNewVal || lValPlaceHolder !== lNewValPlaceHolder) {
              lVal = lNewVal;
              lValPlaceHolder = lNewValPlaceHolder;
              lCalcul();
            }
          },
          aContexteCourant.node,
          aContexteCourant,
        );
        aOutils.surInjectionHtml(aContexteCourant, () => {
          lEstTextAreaMaxWrapper =
            lJNode.hasClass('textareamax') &&
            !!aContexteCourant.node.closest('.textareamax-wrapper');
          lCalcul();
        });
        aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-autoresize');
      },
    );
  },
  fn: 'iehtml.autoresize.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const IEHtml = require('IEHtml.js');
    const { ToucheClavier } = require('ToucheClavier.js');
    IEHtml.addClass('collapsible', (aContexteCourant) => {
      _refresh(aContexteCourant);
      const lObserver = new MutationObserver((aMutations) => {
        if (aMutations[0] && aMutations[0].type === 'childList') {
          _refresh(aContexteCourant);
        }
      });
      lObserver.observe(aContexteCourant.node, { childList: true });
      return true;
    });
    function _refresh(aContexteCourant) {
      const lJNode = $(aContexteCourant.node);
      const lJHeaders = lJNode
        .children('li')
        .children('.collapsible-header:not([data-iecollapsibleinit])');
      if (lJHeaders.length === 0) {
        return;
      }
      lJHeaders.attr({ tabindex: 0, 'data-iecollapsibleinit': true });
      const lEstAccordeon = !aContexteCourant.node.classList.contains(
        'collapsible-not-accordeon',
      );
      const lJActiveBodies = lJNode
        .children('li.active')
        .children('.collapsible-body');
      if (lEstAccordeon) {
        lJActiveBodies.first().css('display', 'block');
      } else {
        lJActiveBodies.css('display', 'block');
      }
      lJHeaders.each((aIndex, aElement) => {
        $(aElement).attr(
          'aria-expanded',
          $(aElement).parent().hasClass('active') ? 'true' : 'false',
        );
      });
      const lAction = (aEvent) => {
        const $header = $(aEvent.target).closest('.collapsible-header');
        if (aEvent.target && $header.length) {
          const $collapsible = $header.closest('.collapsible');
          if ($collapsible[0] === aContexteCourant.node) {
            const $collapsibleLi = $header.closest('li');
            const $collapsibleLis = $collapsible.children('li');
            const isActive = $collapsibleLi[0].classList.contains('active');
            const index = $collapsibleLis.index($collapsibleLi);
            if (isActive) {
              close(index);
            } else {
              open(index);
            }
          }
        }
      };
      lJHeaders.off('click.collapsible keydown.collapsible').on({
        'click.collapsible'(aEvent) {
          lAction(aEvent);
        },
        'keydown.collapsible'(aEvent) {
          if (
            [
              ToucheClavier.Espace,
              ToucheClavier.RetourChariot,
              ToucheClavier.Echap,
            ].includes(aEvent.which)
          ) {
            lAction(aEvent);
          }
        },
      });
      function open(index) {
        const $collapsibleLi = lJNode.children('li').eq(index);
        if (
          $collapsibleLi.length &&
          !$collapsibleLi[0].classList.contains('active')
        ) {
          if (lEstAccordeon) {
            const $collapsibleLis = lJNode.children('li');
            const $activeLis = lJNode.children('li.active');
            $activeLis.each((aIndex, aEl) => {
              const index = $collapsibleLis.index($(aEl));
              close(index);
            });
          }
          $collapsibleLi[0].classList.add('active');
          const lJBody = $collapsibleLi.children('.collapsible-body');
          $collapsibleLi
            .children('.collapsible-header')
            .attr('aria-expanded', 'true');
          lJBody.css({ display: 'block', height: 0, overflow: 'hidden' });
          const lHeight = lJBody[0].scrollHeight;
          const lPTop = lJBody.css('padding-top');
          const lPBottom = lJBody.css('padding-bottom');
          lJBody.css({ paddingTop: 0, paddingBottom: 0 });
          lJBody
            .css({
              height: lHeight + 'px',
              paddingTop: lPTop,
              paddingBottom: lPBottom,
            })
            .off('transitionend.collapsible')
            .one('transitionend.collapsible', () => {
              lJBody.css({
                height: '',
                paddingTop: '',
                paddingBottom: '',
                overflow: '',
              });
            });
        }
      }
      function close(index) {
        const $collapsibleLi = lJNode.children('li').eq(index);
        if (
          $collapsibleLi.length &&
          $collapsibleLi[0].classList.contains('active')
        ) {
          $collapsibleLi[0].classList.remove('active');
          const lJBody = $collapsibleLi.eq(0).children('.collapsible-body');
          $collapsibleLi
            .children('.collapsible-header')
            .attr('aria-expanded', 'false');
          const lHeight = lJBody[0].scrollHeight;
          const lPTop = lJBody.css('padding-top');
          const lPBottom = lJBody.css('padding-bottom');
          lJBody.css({
            display: 'block',
            height: lHeight + 'px',
            paddingTop: lPTop,
            paddingBottom: lPBottom,
            overflow: 'hidden',
          });
          lJBody.off('transitionend.collapsible');
          lJBody.get(0).offsetWidth;
          lJBody
            .css({ height: '0', paddingTop: 0, paddingBottom: 0 })
            .one('transitionend.collapsible', () => {
              lJBody.css({
                display: '',
                overflow: '',
                height: '',
                paddingTop: '',
                paddingBottom: '',
              });
            });
        }
      }
    }
  },
  fn: 'iehtml.collapsible.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const c_id_attribut_nodeVisibility = 'ie-visibility-observer';
    let uObserver_ie_node_visibility = null;
    try {
      uObserver_ie_node_visibility = new IntersectionObserver(
        (aObservables) => {
          for (const lObservable of aObservables) {
            if (lObservable && lObservable.target) {
              const lCallbackChange = $(lObservable.target).data(
                c_id_attribut_nodeVisibility,
              );
              if (lCallbackChange) {
                const lVisible =
                  lObservable.intersectionRatio > 0 ||
                  lObservable.isIntersecting;
                lCallbackChange(lVisible);
              }
            }
          }
        },
      );
    } catch (e) {
      uObserver_ie_node_visibility = null;
    }
    IEHtml.addAttribut(
      c_id_attribut_nodeVisibility,
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!lValue || !aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.estFonction) {
          return true;
        }
        aOutils.surInjectionHtml(aContexteCourant, (...aParams) => {
          const lCallback = (aVisible) => {
            if (lInfos.callback([aVisible, ...aParams]) === false) {
              $(aContexteCourant.node).data(c_id_attribut_nodeVisibility, null);
              uObserver_ie_node_visibility.unobserve(aContexteCourant.node);
            }
          };
          if (uObserver_ie_node_visibility) {
            $(aContexteCourant.node).data(
              c_id_attribut_nodeVisibility,
              lCallback,
            );
            uObserver_ie_node_visibility.observe(aContexteCourant.node);
            $(aContexteCourant.node).on(
              `destroyed.${c_id_attribut_nodeVisibility}`,
              () => {
                uObserver_ie_node_visibility.unobserve(aContexteCourant.node);
              },
            );
          } else {
            lCallback(true);
          }
        });
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          `${c_id_attribut_nodeVisibility}="${lValue}"`,
        );
        return true;
      },
    );
  },
  fn: 'iehtml.visibilityobserver.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const c_id_attribut_resizeObserver = 'ie-resize-observer';
    IEHtml.addAttribut(
      c_id_attribut_resizeObserver,
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!lValue || !aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.estFonction) {
          return true;
        }
        aOutils.surInjectionHtml(aContexteCourant, (...aParams) => {
          try {
            let lResizeObserver = new ResizeObserver((aObservers) => {
              const lObserver = aObservers[0];
              if (lObserver && lObserver.contentRect) {
                let lResult = false;
                try {
                  lResult = lInfos.callback([
                    {
                      node: aContexteCourant.node,
                      observer: lObserver,
                      contentRect: lObserver.contentRect,
                    },
                    ...aParams,
                  ]);
                } catch (e) {
                  lResult = false;
                }
                if (lResult === false && lResizeObserver) {
                  lResizeObserver.disconnect();
                  lResizeObserver = null;
                }
              }
            });
            lResizeObserver.observe(aContexteCourant.node);
            $(aContexteCourant.node).on(
              `destroyed.${c_id_attribut_resizeObserver}`,
              () => {
                if (lResizeObserver) {
                  lResizeObserver.disconnect();
                  lResizeObserver = null;
                }
              },
            );
          } catch (e) {}
        });
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          `${c_id_attribut_resizeObserver}="${lValue}"`,
        );
        return true;
      },
    );
  },
  fn: 'iehtml.resizeobserver.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IEHtml.Ripple.css');
    const IEHtml = require('IEHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetHtml_1 = require('ObjetHtml');
    const c_DureeActivate = 500;
    const c_DureeDeactivatee = 150;
    IEHtml.addClass('ie-ripple', (aContexteCourant, aNodeName, aOutils) => {
      if (!IE.estMobile) {
        return;
      }
      let lTimeoutActivate = null;
      let lTimeoutDeactivate = null;
      let lActivateEnd = {};
      const lEndDeactive = () => {
        aContexteCourant.node.classList.remove('ie-ripple-deactivation');
      };
      const lHide = () => {
        if (lActivateEnd && lActivateEnd.event && lActivateEnd.timeout) {
          lActivateEnd = {};
          aContexteCourant.node.classList.remove('ie-ripple-activation');
          aContexteCourant.node.classList.add('ie-ripple-deactivation');
          lTimeoutDeactivate = setTimeout(lEndDeactive, c_DureeDeactivatee);
        }
      };
      $(aContexteCourant.node).on({
        pointerdown(aEvent) {
          if (
            $(this).is(':disabled') ||
            $(this).hasClass('disabled') ||
            $(this).hasClass('ie-ripple-disabled') ||
            $(this).attr('aria-disabled') === 'true'
          ) {
            return;
          }
          if (
            aEvent.target &&
            aEvent.target !== aContexteCourant.node &&
            aEvent.target.classList
          ) {
            if (aEvent.target.classList.contains('ie-ripple')) {
              return;
            }
            const lNode = ObjetHtml_1.GHtml.getClosestFocusable(aEvent.target);
            if (
              lNode &&
              !lNode.classList.contains('ie-ripple') &&
              !!lNode.closest('.ie-ripple')
            ) {
              return;
            }
          }
          if (
            aContexteCourant.node.classList.contains('ie-ripple-activation')
          ) {
            aContexteCourant.node.classList.remove('ie-ripple-activation');
            aContexteCourant.node.scrollTop;
          }
          clearTimeout(lTimeoutActivate);
          clearTimeout(lTimeoutDeactivate);
          lActivateEnd = {};
          lEndDeactive();
          aContexteCourant.node.classList.add('ie-ripple-activation');
          const lRect = ObjetPosition_1.GPosition.getClientRect(
            aContexteCourant.node,
          );
          let lPosEventRelatif = {
            x: aEvent.clientX - lRect.left,
            y: aEvent.clientY - lRect.top,
          };
          const lSizeMax = Math.max(lRect.width, lRect.height);
          const lSizeAfter = lSizeMax / 3;
          const lScale = (lSizeMax / lSizeAfter) * 2;
          const lPosX = lPosEventRelatif.x - lSizeAfter / 2;
          const lPosY = lPosEventRelatif.y - lSizeAfter / 2;
          $(aContexteCourant.node).css({
            '--ie-ripple-size': `${lSizeAfter}px`,
            '--ie-ripple-scale': lScale,
            '--ie-ripple-translate': `${lPosX}px, ${lPosY}px`,
          });
          lTimeoutActivate = setTimeout(() => {
            lActivateEnd.timeout = true;
            lHide();
          }, c_DureeActivate);
        },
        'touchend touchcancel mouseup mouseleave dragend'() {
          lActivateEnd.event = true;
          lHide();
        },
        destroyed() {
          clearTimeout(lTimeoutActivate);
          clearTimeout(lTimeoutDeactivate);
        },
      });
      aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-ripple');
      return true;
    });
  },
  fn: 'iehtml.ripple.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const ObjetPosition_1 = require('ObjetPosition');
    const IEHtml = require('IEHtml');
    const Invocateur_1 = require('Invocateur');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const tag_1 = require('tag');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const MethodesObjet_1 = require('MethodesObjet');
    require('IEHtml.DraggableDroppable.css');
    const u_invocateur_dragdrop = new Invocateur_1.ObjetInvocateur();
    IEHtml.addAttribut(
      'ie-draggable',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lInfos = aOutils.getAccesParametres(
          aAttributValue,
          aContexteCourant,
        );
        if (
          !aAttributValue ||
          !aContexteCourant.controleur ||
          !lInfos.estFonction
        ) {
          return true;
        }
        const lParams = Object.assign(
          {
            start: null,
            drag: null,
            stop: null,
            distanceStart: 0,
            containment: document.body,
            avecDrop: false,
          },
          lInfos.callback(),
        );
        _drag(aContexteCourant, lParams);
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-draggable="' + aAttributValue + '"',
        );
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-draggable-fantome',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lInfos = aOutils.getAccesParametres(
          aAttributValue,
          aContexteCourant,
        );
        if (
          !aAttributValue ||
          !aContexteCourant.controleur ||
          !lInfos.estFonction
        ) {
          return true;
        }
        const lParams = {
          start: null,
          drag: null,
          stop: null,
          containment: document.body,
          getIdZone: null,
          distanceStart: 5,
          avecDrop: true,
        };
        const lParamsInfos = lInfos.callback();
        Object.assign(lParams, lParamsInfos, {
          start(aParamsDrag) {
            const lData = { libelle: '' };
            aParamsDrag.data = lData;
            let lResult = lParamsInfos.start(aParamsDrag);
            if (lResult === false) {
              return lResult;
            }
            const lJConteneur = $(
              IEZoneFenetre_1.ZoneFenetre.getElementZoneFenetre(),
            );
            lJConteneur.find('>.FantomeDraggable').remove();
            lData.controleurDraggable = {
              getHtmlFantome: function () {
                const lHtml = lData.libelle || '';
                let lSupp = '';
                if (lData.getHtmlDetailsDraggable) {
                  lSupp = lData.getHtmlDetailsDraggable(lData);
                } else if (lData.horsZoneSuppression) {
                  lSupp =
                    '<i class="icon_remove" style="font-size:15px; color:red;"></i><label>' +
                    ObjetTraduction_1.GTraductions.getValeur('Supprimer') +
                    '</label>';
                }
                return (
                  `<div class="draggable-libelle">${lHtml}</div>` +
                  (lSupp
                    ? '<div class="draggable_details">' + lSupp + '</div>'
                    : '')
                );
              },
            };
            IEHtml.injectHTMLParams({
              element: lJConteneur.get(0),
              html: (0, tag_1.tag)(
                'div',
                { class: 'FantomeDraggable' },
                (0, tag_1.tag)('div', {
                  class: 'draggable',
                  'ie-html': 'getHtmlFantome',
                }),
                IE.jsx.str('div', { class: 'overlay' }),
              ),
              controleur: lData.controleurDraggable,
            });
            aParamsDrag.data.jDraggable = lJConteneur.find(
              '>.FantomeDraggable>.draggable',
            );
            return lResult;
          },
          drag: function (aParamsDrag, aEvent) {
            const lIdZone = lParamsInfos.getIdZone
              ? lParamsInfos.getIdZone()
              : null;
            aParamsDrag.horsZone = lIdZone
              ? !ObjetPosition_1.GPosition.positionDansZone(
                  aParamsDrag.pos,
                  lIdZone,
                )
              : false;
            if (lParamsInfos.drag) {
              lParamsInfos.drag(aParamsDrag, aEvent);
              aParamsDrag.data.controleurDraggable.$refreshSelf();
            }
            let lTop = Math.max(
              aParamsDrag.rectContrainte.top,
              aParamsDrag.pos.y - 10,
            );
            let lLeft = Math.max(
              aParamsDrag.rectContrainte.left,
              aParamsDrag.pos.x - 15,
            );
            let lRectDraggable = null;
            aParamsDrag.data.jDraggable
              .find('.draggable-libelle, .draggable_details')
              .each(function () {
                const lRectChild =
                  ObjetPosition_1.GPosition.getClientRect(this);
                if (!lRectDraggable) {
                  lRectDraggable = lRectChild;
                } else {
                  lRectDraggable.left = Math.min(
                    lRectDraggable.left,
                    lRectChild.left,
                  );
                  lRectDraggable.top = Math.min(
                    lRectDraggable.top,
                    lRectChild.top,
                  );
                  lRectDraggable.right = Math.max(
                    lRectDraggable.right,
                    lRectChild.right,
                  );
                  lRectDraggable.bottom = Math.max(
                    lRectDraggable.bottom,
                    lRectChild.bottom,
                  );
                }
              });
            lLeft = Math.min(
              lLeft,
              aParamsDrag.rectContrainte.left +
                aParamsDrag.rectContrainte.width -
                (lRectDraggable.right - lRectDraggable.left),
            );
            lTop = Math.min(
              lTop,
              aParamsDrag.rectContrainte.top +
                aParamsDrag.rectContrainte.height -
                (lRectDraggable.bottom - lRectDraggable.top),
            );
            aParamsDrag.data.jDraggable.css({ left: lLeft, top: lTop });
            const lElement = aParamsDrag.data.jDraggable.get(0);
            aParamsDrag.scrollIntoViewSurNode(lElement);
          },
          stop: function (aParamsDrag, aEvent) {
            try {
              if (lParamsInfos.stop) {
                const lIdZone = lParamsInfos.getIdZone
                  ? lParamsInfos.getIdZone()
                  : null;
                aParamsDrag.horsZone = lIdZone
                  ? !ObjetPosition_1.GPosition.positionDansZone(
                      aParamsDrag.pos,
                      lIdZone,
                    )
                  : false;
                lParamsInfos.stop(aParamsDrag, aEvent);
                aParamsDrag.data.controleurDraggable.$refreshSelf();
              }
            } finally {
              $(IEZoneFenetre_1.ZoneFenetre.getElementZoneFenetre())
                .find(`>.FantomeDraggable`)
                .remove();
            }
          },
        });
        _drag(aContexteCourant, lParams);
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-draggable-fantome="' + aAttributValue + '"',
        );
        return true;
      },
    );
    function _drag(aContexteCourant, aParams) {
      let lDrag = null;
      let lDetach;
      const lOnMove = (aEvent) => {
        const lEventTouch = aEvent;
        if (
          lDrag &&
          lDrag.touch &&
          lEventTouch &&
          lEventTouch.originalEvent &&
          lEventTouch.originalEvent.changedTouches &&
          lEventTouch.originalEvent.changedTouches.length > 0
        ) {
          if (lDrag.identifierTouchMove < 0) {
            lDrag.identifierTouchMove =
              lEventTouch.originalEvent.changedTouches[0].identifier;
          } else if (
            lDrag.identifierTouchMove !==
            lEventTouch.originalEvent.changedTouches[0].identifier
          ) {
            return;
          }
        }
        if (!lDrag || (!aEvent.which && !lDrag.touch)) {
          lOnStop(aEvent);
          return;
        }
        let lContainment;
        if (
          aParams.containment &&
          MethodesObjet_1.MethodesObjet.isFunction(aParams.containment)
        ) {
          lContainment = aParams.containment(lDrag.node);
        } else {
          lContainment = aParams.containment;
        }
        lDrag.rectContrainte = lContainment
          ? ObjetPosition_1.GPosition.getClientRect(lContainment)
          : null;
        lDrag.pos = ObjetPosition_1.GPosition.getPositionEventJQuery(aEvent);
        if (lDrag.rectContrainte) {
          lDrag.pos.x = Math.max(
            lDrag.rectContrainte.left,
            Math.min(
              lDrag.rectContrainte.left + lDrag.rectContrainte.width,
              lDrag.pos.x,
            ),
          );
          lDrag.pos.y = Math.max(
            lDrag.rectContrainte.top,
            Math.min(
              lDrag.rectContrainte.top + lDrag.rectContrainte.height,
              lDrag.pos.y,
            ),
          );
        }
        lDrag.offset.x = lDrag.pos.x - lDrag.posStart.x;
        lDrag.offset.y = lDrag.pos.y - lDrag.posStart.y;
        let lResult = true;
        try {
          if (!lDrag._started) {
            if (
              aParams.distanceStart > 0 &&
              aParams.distanceStart >
                Math.max(Math.abs(lDrag.offset.x), Math.abs(lDrag.offset.y))
            ) {
              return;
            }
            if (aParams.start) {
              if (aParams.start(lDrag) === false) {
                lDetach();
                lDrag = null;
                return;
              }
            }
            lDrag._started = true;
            if (aParams.avecDrop) {
              u_invocateur_dragdrop.evenement('start-drag', lDrag);
            }
          }
          if (aParams.drag) {
            aParams.drag(lDrag, aEvent);
          }
          if (aParams.avecDrop) {
            u_invocateur_dragdrop.evenement('move-drag', lDrag);
          }
          lResult = false;
        } catch (e) {
          lDetach();
          lDrag = null;
        }
        return lDrag && lDrag.touch ? true : lResult;
      };
      const lOnStop = (aEvent) => {
        if (lDrag && lDrag.touch && aEvent) {
          const lEvent = aEvent;
          if (
            lEvent.originalEvent &&
            lEvent.originalEvent.changedTouches &&
            lEvent.originalEvent.changedTouches.length > 0 &&
            lDrag.identifierTouchMove >= 0 &&
            lDrag.identifierTouchMove !==
              lEvent.originalEvent.changedTouches[0].identifier
          ) {
            return;
          }
        }
        const lDragTemp = lDrag;
        lDrag = null;
        lDetach();
        if (lDragTemp && lDragTemp._started) {
          if (aParams.avecDrop) {
            u_invocateur_dragdrop.evenement('stop-drag', lDragTemp);
          }
          if (aParams.stop) {
            try {
              aParams.stop(lDragTemp, aEvent);
            } catch (e) {}
          }
        }
      };
      lDetach = () => {
        $(document).off('touchmove.iedrag mousemove.iedrag', lOnMove);
        if (lDrag) {
          $(document).off(
            'touchend.iedrag touchcancel.iedrag mouseup.iedrag',
            lOnStop,
          );
        }
      };
      $(aContexteCourant.node).on({
        pointerdown(aEvent) {
          const lEstTouch = aEvent.pointerType === 'touch';
          if (lDrag) {
            if (lDrag.pointerId !== aEvent.pointerId) {
              return;
            }
            lOnStop(aEvent);
          }
          lDrag = {
            node: this,
            pointerId: aEvent.pointerId,
            identifierTouchMove: -1,
            rect: ObjetPosition_1.GPosition.getClientRect(this),
            posStart: ObjetPosition_1.GPosition.getPositionEventJQuery(aEvent),
            touch: lEstTouch,
            offset: { x: 0, y: 0 },
            rectContrainte: null,
            scrollIntoViewSurNode(aNode) {
              if (aNode && aNode.scrollIntoView) {
                aNode.scrollIntoView({ block: 'nearest', inline: 'nearest' });
              }
            },
          };
          lDetach();
          $(document).on({
            [lEstTouch ? 'touchmove.iedrag' : 'mousemove.iedrag']: lOnMove,
            [lEstTouch
              ? 'touchend.iedrag touchcancel.iedrag'
              : 'mouseup.iedrag']: lOnStop,
          });
        },
        dragstart() {
          return false;
        },
        destroyed() {
          lOnStop();
        },
      });
      if (!aParams.autoriserEventMove) {
        $(aContexteCourant.node).addClass('ie-draggable-handle');
      }
    }
    IEHtml.addAttribut(
      'ie-droppable',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lInfos = aOutils.getAccesParametres(
          aAttributValue,
          aContexteCourant,
        );
        if (
          !aAttributValue ||
          !aContexteCourant.controleur ||
          !lInfos.estFonction
        ) {
          return true;
        }
        const lParams = Object.assign(
          {
            accept: null,
            activate: null,
            deactivate: null,
            drop: null,
            over: null,
            out: null,
          },
          lInfos.callback(),
        );
        let lFuncDetach = null;
        let lObjetDrop = null;
        const lFuncMove = function () {
          if (lObjetDrop && lObjetDrop.drag) {
            const lEstDansZone = !!ObjetPosition_1.GPosition.positionDansZone(
              lObjetDrop.drag.pos,
              aContexteCourant.node,
            );
            if (lObjetDrop.hoverDrop !== lEstDansZone) {
              lObjetDrop.hoverDrop = lEstDansZone;
              if (lObjetDrop.hoverDrop) {
                $(aContexteCourant.node).addClass('ie-droppable-hover');
                if (lParams.over) {
                  lParams.over(lObjetDrop);
                }
              } else {
                $(aContexteCourant.node).removeClass('ie-droppable-hover');
                if (lParams.out) {
                  lParams.out(lObjetDrop);
                }
              }
            }
          }
        };
        const lFuncEnd = () => {
          const lDropTemp = lObjetDrop;
          lObjetDrop = null;
          if (lDropTemp) {
            lFuncDetach();
            $(aContexteCourant.node).removeClass(
              'ie-droppable-active ie-droppable-hover',
            );
            if (lDropTemp.hoverDrop) {
              lDropTemp.drag.isDropped = true;
              if (lParams.drop) {
                lParams.drop(lDropTemp);
              }
            }
            if (lParams.deactivate) {
              lParams.deactivate(lDropTemp);
            }
          }
        };
        lFuncDetach = () => {
          u_invocateur_dragdrop.desabonner(`stop-drag`, lFuncEnd);
          u_invocateur_dragdrop.desabonner(`move-drag`, lFuncMove);
        };
        const lFuncStart = (aParamsDrag) => {
          lObjetDrop = {
            drag: aParamsDrag,
            drop: { node: aContexteCourant.node },
            hoverDrop: false,
          };
          if (lParams.accept && !lParams.accept(lObjetDrop)) {
            lObjetDrop = null;
            return;
          }
          lFuncDetach();
          u_invocateur_dragdrop.abonner(`stop-drag`, lFuncEnd);
          u_invocateur_dragdrop.abonner(`move-drag`, lFuncMove);
          $(aContexteCourant.node).addClass('ie-droppable-active');
          if (lParams.activate) {
            lParams.activate(lObjetDrop);
          }
          lFuncMove();
        };
        u_invocateur_dragdrop.abonner(`start-drag`, lFuncStart);
        $(aContexteCourant.node)
          .on('destroyed', () => {
            lObjetDrop = null;
            u_invocateur_dragdrop.desabonner(`start-drag`, lFuncStart);
            lFuncDetach();
          })
          .addClass('ie-droppable');
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-droppable="' + aAttributValue + '"',
        );
        return true;
      },
    );
  },
  fn: 'iehtml.draggabledroppable.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreAttribut =
      exports.EGenreRole =
      exports.EGenreObjet =
      exports.GObjetWAI =
      exports.ObjetWAI =
        void 0;
    const GUID_1 = require('GUID');
    const ObjetTraduction_1 = require('ObjetTraduction');
    var EGenreObjet;
    (function (EGenreObjet) {
      EGenreObjet[(EGenreObjet['Aide'] = 1)] = 'Aide';
      EGenreObjet[(EGenreObjet['Tableau'] = 2)] = 'Tableau';
      EGenreObjet[(EGenreObjet['AvecValidation'] = 3)] = 'AvecValidation';
      EGenreObjet[(EGenreObjet['BarreOnglets'] = 4)] = 'BarreOnglets';
      EGenreObjet[(EGenreObjet['NavigationHorizontal'] = 5)] =
        'NavigationHorizontal';
      EGenreObjet[(EGenreObjet['NavigationVertical'] = 6)] =
        'NavigationVertical';
      EGenreObjet[(EGenreObjet['NavigationHorizontalAvecValidation'] = 7)] =
        'NavigationHorizontalAvecValidation';
      EGenreObjet[(EGenreObjet['NavigationVerticalAvecValidation'] = 8)] =
        'NavigationVerticalAvecValidation';
      EGenreObjet[(EGenreObjet['CalendrierNavigation'] = 9)] =
        'CalendrierNavigation';
      EGenreObjet[(EGenreObjet['CalendrierPrecedent'] = 10)] =
        'CalendrierPrecedent';
      EGenreObjet[(EGenreObjet['CalendrierSuivant'] = 11)] =
        'CalendrierSuivant';
      EGenreObjet[(EGenreObjet['DetailEvenement'] = 12)] = 'DetailEvenement';
      EGenreObjet[(EGenreObjet['TitreDetailEvenement'] = 13)] =
        'TitreDetailEvenement';
      EGenreObjet[(EGenreObjet['AvecMenuContextuel'] = 16)] =
        'AvecMenuContextuel';
      EGenreObjet[(EGenreObjet['ItemDesactiver'] = 17)] = 'ItemDesactiver';
      EGenreObjet[(EGenreObjet['AvecEdition'] = 18)] = 'AvecEdition';
      EGenreObjet[(EGenreObjet['Tabulation'] = 19)] = 'Tabulation';
      EGenreObjet[(EGenreObjet['Supprimer'] = 20)] = 'Supprimer';
      EGenreObjet[(EGenreObjet['Fenetre'] = 21)] = 'Fenetre';
      EGenreObjet[(EGenreObjet['NouvelElement'] = 22)] = 'NouvelElement';
      EGenreObjet[(EGenreObjet['BarreOngletsPrincipal'] = 23)] =
        'BarreOngletsPrincipal';
      EGenreObjet[(EGenreObjet['SousOnglets'] = 24)] = 'SousOnglets';
      EGenreObjet[(EGenreObjet['ValidezEvenement'] = 25)] = 'ValidezEvenement';
      EGenreObjet[(EGenreObjet['RetourDebutFenetre'] = 26)] =
        'RetourDebutFenetre';
      EGenreObjet[(EGenreObjet['FenetreChoix'] = 27)] = 'FenetreChoix';
    })(EGenreObjet || (exports.EGenreObjet = EGenreObjet = {}));
    var EGenreRole;
    (function (EGenreRole) {
      EGenreRole[(EGenreRole['Application'] = 1)] = 'Application';
      EGenreRole[(EGenreRole['Window'] = 2)] = 'Window';
      EGenreRole[(EGenreRole['Textbox'] = 3)] = 'Textbox';
      EGenreRole[(EGenreRole['Link'] = 5)] = 'Link';
      EGenreRole[(EGenreRole['Combobox'] = 6)] = 'Combobox';
      EGenreRole[(EGenreRole['Option'] = 7)] = 'Option';
      EGenreRole[(EGenreRole['Checkbox'] = 8)] = 'Checkbox';
      EGenreRole[(EGenreRole['Radio'] = 10)] = 'Radio';
      EGenreRole[(EGenreRole['Radiogroup'] = 11)] = 'Radiogroup';
      EGenreRole[(EGenreRole['Button'] = 12)] = 'Button';
      EGenreRole[(EGenreRole['Progressbar'] = 13)] = 'Progressbar';
      EGenreRole[(EGenreRole['Tree'] = 17)] = 'Tree';
      EGenreRole[(EGenreRole['Treeitem'] = 19)] = 'Treeitem';
      EGenreRole[(EGenreRole['Presentation'] = 20)] = 'Presentation';
      EGenreRole[(EGenreRole['Group'] = 21)] = 'Group';
      EGenreRole[(EGenreRole['Grid'] = 22)] = 'Grid';
      EGenreRole[(EGenreRole['Tab'] = 24)] = 'Tab';
      EGenreRole[(EGenreRole['Tabpanel'] = 25)] = 'Tabpanel';
      EGenreRole[(EGenreRole['Tablist'] = 26)] = 'Tablist';
      EGenreRole[(EGenreRole['Rowheader'] = 30)] = 'Rowheader';
      EGenreRole[(EGenreRole['Columnheader'] = 31)] = 'Columnheader';
      EGenreRole[(EGenreRole['List'] = 32)] = 'List';
      EGenreRole[(EGenreRole['Listitem'] = 33)] = 'Listitem';
      EGenreRole[(EGenreRole['Menu'] = 34)] = 'Menu';
      EGenreRole[(EGenreRole['Menubar'] = 35)] = 'Menubar';
      EGenreRole[(EGenreRole['Menuitem'] = 36)] = 'Menuitem';
      EGenreRole[(EGenreRole['Alert'] = 37)] = 'Alert';
      EGenreRole[(EGenreRole['Alertdialog'] = 38)] = 'Alertdialog';
      EGenreRole[(EGenreRole['Dialog'] = 39)] = 'Dialog';
      EGenreRole[(EGenreRole['Gridcell'] = 40)] = 'Gridcell';
      EGenreRole[(EGenreRole['Log'] = 41)] = 'Log';
      EGenreRole[(EGenreRole['Marquee'] = 42)] = 'Marquee';
      EGenreRole[(EGenreRole['Menuitemcheckbox'] = 43)] = 'Menuitemcheckbox';
      EGenreRole[(EGenreRole['Menuitemradio'] = 44)] = 'Menuitemradio';
      EGenreRole[(EGenreRole['Scrollbar'] = 45)] = 'Scrollbar';
      EGenreRole[(EGenreRole['Slider'] = 46)] = 'Slider';
      EGenreRole[(EGenreRole['Spinbutton'] = 47)] = 'Spinbutton';
      EGenreRole[(EGenreRole['Status'] = 48)] = 'Status';
      EGenreRole[(EGenreRole['Timer'] = 49)] = 'Timer';
      EGenreRole[(EGenreRole['Tooltip'] = 50)] = 'Tooltip';
      EGenreRole[(EGenreRole['Listbox'] = 51)] = 'Listbox';
      EGenreRole[(EGenreRole['Treegrid'] = 52)] = 'Treegrid';
      EGenreRole[(EGenreRole['Article'] = 53)] = 'Article';
      EGenreRole[(EGenreRole['Definition'] = 54)] = 'Definition';
      EGenreRole[(EGenreRole['Directory'] = 55)] = 'Directory';
      EGenreRole[(EGenreRole['Document'] = 56)] = 'Document';
      EGenreRole[(EGenreRole['Heading'] = 57)] = 'Heading';
      EGenreRole[(EGenreRole['Img'] = 58)] = 'Img';
      EGenreRole[(EGenreRole['Math'] = 59)] = 'Math';
      EGenreRole[(EGenreRole['Note'] = 60)] = 'Note';
      EGenreRole[(EGenreRole['Region'] = 61)] = 'Region';
      EGenreRole[(EGenreRole['Row'] = 62)] = 'Row';
      EGenreRole[(EGenreRole['Separator'] = 63)] = 'Separator';
      EGenreRole[(EGenreRole['Toolbar'] = 64)] = 'Toolbar';
      EGenreRole[(EGenreRole['Banner'] = 65)] = 'Banner';
      EGenreRole[(EGenreRole['Complementary'] = 66)] = 'Complementary';
      EGenreRole[(EGenreRole['Contentinfo'] = 67)] = 'Contentinfo';
      EGenreRole[(EGenreRole['Form'] = 68)] = 'Form';
      EGenreRole[(EGenreRole['Main'] = 69)] = 'Main';
      EGenreRole[(EGenreRole['Navigation'] = 70)] = 'Navigation';
      EGenreRole[(EGenreRole['Search'] = 71)] = 'Search';
      EGenreRole[(EGenreRole['Cell'] = 72)] = 'Cell';
    })(EGenreRole || (exports.EGenreRole = EGenreRole = {}));
    var EGenreAttribut;
    (function (EGenreAttribut) {
      EGenreAttribut[(EGenreAttribut['activedescendant'] = 0)] =
        'activedescendant';
      EGenreAttribut[(EGenreAttribut['atomic'] = 1)] = 'atomic';
      EGenreAttribut[(EGenreAttribut['autocomplete'] = 2)] = 'autocomplete';
      EGenreAttribut[(EGenreAttribut['busy'] = 3)] = 'busy';
      EGenreAttribut[(EGenreAttribut['checked'] = 4)] = 'checked';
      EGenreAttribut[(EGenreAttribut['controls'] = 5)] = 'controls';
      EGenreAttribut[(EGenreAttribut['describedby'] = 6)] = 'describedby';
      EGenreAttribut[(EGenreAttribut['disabled'] = 7)] = 'disabled';
      EGenreAttribut[(EGenreAttribut['dropeffect'] = 8)] = 'dropeffect';
      EGenreAttribut[(EGenreAttribut['expanded'] = 9)] = 'expanded';
      EGenreAttribut[(EGenreAttribut['flowto'] = 10)] = 'flowto';
      EGenreAttribut[(EGenreAttribut['grabbed'] = 11)] = 'grabbed';
      EGenreAttribut[(EGenreAttribut['haspopup'] = 12)] = 'haspopup';
      EGenreAttribut[(EGenreAttribut['hidden'] = 13)] = 'hidden';
      EGenreAttribut[(EGenreAttribut['invalid'] = 14)] = 'invalid';
      EGenreAttribut[(EGenreAttribut['label'] = 15)] = 'label';
      EGenreAttribut[(EGenreAttribut['labelledby'] = 16)] = 'labelledby';
      EGenreAttribut[(EGenreAttribut['level'] = 17)] = 'level';
      EGenreAttribut[(EGenreAttribut['live'] = 18)] = 'live';
      EGenreAttribut[(EGenreAttribut['multiline'] = 19)] = 'multiline';
      EGenreAttribut[(EGenreAttribut['multiselectable'] = 20)] =
        'multiselectable';
      EGenreAttribut[(EGenreAttribut['orientation'] = 21)] = 'orientation';
      EGenreAttribut[(EGenreAttribut['owns'] = 22)] = 'owns';
      EGenreAttribut[(EGenreAttribut['posinset'] = 23)] = 'posinset';
      EGenreAttribut[(EGenreAttribut['pressed'] = 24)] = 'pressed';
      EGenreAttribut[(EGenreAttribut['readonly'] = 25)] = 'readonly';
      EGenreAttribut[(EGenreAttribut['relevant'] = 26)] = 'relevant';
      EGenreAttribut[(EGenreAttribut['required'] = 27)] = 'required';
      EGenreAttribut[(EGenreAttribut['selected'] = 28)] = 'selected';
      EGenreAttribut[(EGenreAttribut['setsize'] = 29)] = 'setsize';
      EGenreAttribut[(EGenreAttribut['sort'] = 30)] = 'sort';
      EGenreAttribut[(EGenreAttribut['valuemax'] = 31)] = 'valuemax';
      EGenreAttribut[(EGenreAttribut['valuemin'] = 32)] = 'valuemin';
      EGenreAttribut[(EGenreAttribut['valuenow'] = 33)] = 'valuenow';
      EGenreAttribut[(EGenreAttribut['valuetext'] = 34)] = 'valuetext';
      EGenreAttribut[(EGenreAttribut['colindex'] = 35)] = 'colindex';
      EGenreAttribut[(EGenreAttribut['colspan'] = 36)] = 'colspan';
      EGenreAttribut[(EGenreAttribut['rowindex'] = 37)] = 'rowindex';
      EGenreAttribut[(EGenreAttribut['rowspan'] = 38)] = 'rowspan';
      EGenreAttribut[(EGenreAttribut['description'] = 39)] = 'description';
    })(EGenreAttribut || (exports.EGenreAttribut = EGenreAttribut = {}));
    class ObjetWAI {
      constructor() {
        this.idMessagesAide = GUID_1.GUID.getId();
        this.InfoWai = [];
        this.InfoWai[EGenreObjet.Aide] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.Aide');
        this.InfoWai[EGenreObjet.Tableau] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.Tableau');
        this.InfoWai[EGenreObjet.AvecValidation] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.AvecValidation');
        this.InfoWai[EGenreObjet.BarreOnglets] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.BarreOnglets');
        this.InfoWai[EGenreObjet.NavigationHorizontal] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.NavigationHorizontal',
          );
        this.InfoWai[EGenreObjet.NavigationVertical] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.NavigationVertical',
          );
        this.InfoWai[EGenreObjet.NavigationHorizontalAvecValidation] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.NavigationHorizontalAvecValidation',
          );
        this.InfoWai[EGenreObjet.NavigationVerticalAvecValidation] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.NavigationVerticalAvecValidation',
          );
        this.InfoWai[EGenreObjet.CalendrierNavigation] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.CalendrierNavigation',
          );
        this.InfoWai[EGenreObjet.CalendrierPrecedent] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.CalendrierPrecedent',
          );
        this.InfoWai[EGenreObjet.CalendrierSuivant] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.CalendrierSuivant',
          );
        this.InfoWai[EGenreObjet.ValidezEvenement] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.ValidezEvenement',
          );
        this.InfoWai[EGenreObjet.TitreDetailEvenement] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.TitreDetailEvenement',
          );
        this.InfoWai[EGenreObjet.ItemDesactiver] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.ItemDesactiver');
        this.InfoWai[EGenreObjet.AvecEdition] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.AvecEdition');
        this.InfoWai[EGenreObjet.Tabulation] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.Tabulation');
        this.InfoWai[EGenreObjet.Supprimer] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.Supprimer');
        this.InfoWai[EGenreObjet.Fenetre] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.Fenetre');
        this.InfoWai[EGenreObjet.NouvelElement] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.NouvelElement');
        this.InfoWai[EGenreObjet.BarreOngletsPrincipal] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.BarreOngletsPrincipal',
          );
        this.InfoWai[EGenreObjet.SousOnglets] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.SousOnglets');
        this.InfoWai[EGenreObjet.RetourDebutFenetre] =
          ObjetTraduction_1.GTraductions.getValeur(
            'Navigation.RetourDebutFenetre',
          );
        this.InfoWai[EGenreObjet.FenetreChoix] =
          ObjetTraduction_1.GTraductions.getValeur('Navigation.FenetreChoix');
        this.WaiRole = [];
        this.WaiRole[EGenreRole.Window] = 'window';
        this.WaiRole[EGenreRole.Alert] = 'alert';
        this.WaiRole[EGenreRole.Alertdialog] = 'alertdialog';
        this.WaiRole[EGenreRole.Button] = 'button';
        this.WaiRole[EGenreRole.Checkbox] = 'checkbox';
        this.WaiRole[EGenreRole.Cell] = 'cell';
        this.WaiRole[EGenreRole.Dialog] = 'dialog';
        this.WaiRole[EGenreRole.Gridcell] = 'gridcell';
        this.WaiRole[EGenreRole.Link] = 'link';
        this.WaiRole[EGenreRole.Log] = 'log';
        this.WaiRole[EGenreRole.Marquee] = 'marquee';
        this.WaiRole[EGenreRole.Menuitem] = 'menuitem';
        this.WaiRole[EGenreRole.Menuitemcheckbox] = 'menuitemcheckbox';
        this.WaiRole[EGenreRole.Menuitemradio] = 'menuitemradio';
        this.WaiRole[EGenreRole.Option] = 'option';
        this.WaiRole[EGenreRole.Progressbar] = 'progressbar';
        this.WaiRole[EGenreRole.Radio] = 'radio';
        this.WaiRole[EGenreRole.Scrollbar] = 'scrollbar';
        this.WaiRole[EGenreRole.Slider] = 'slider';
        this.WaiRole[EGenreRole.Spinbutton] = 'spinbutton';
        this.WaiRole[EGenreRole.Status] = 'status';
        this.WaiRole[EGenreRole.Tab] = 'tab';
        this.WaiRole[EGenreRole.Tabpanel] = 'tabpanel';
        this.WaiRole[EGenreRole.Textbox] = 'textbox';
        this.WaiRole[EGenreRole.Timer] = 'timer';
        this.WaiRole[EGenreRole.Tooltip] = 'tooltip';
        this.WaiRole[EGenreRole.Treeitem] = 'treeitem';
        this.WaiRole[EGenreRole.Combobox] = 'combobox';
        this.WaiRole[EGenreRole.Grid] = 'grid';
        this.WaiRole[EGenreRole.Listbox] = 'listbox';
        this.WaiRole[EGenreRole.Menu] = 'menu';
        this.WaiRole[EGenreRole.Menubar] = 'menubar';
        this.WaiRole[EGenreRole.Radiogroup] = 'radiogroup';
        this.WaiRole[EGenreRole.Tablist] = 'tablist';
        this.WaiRole[EGenreRole.Tree] = 'tree';
        this.WaiRole[EGenreRole.Treegrid] = 'treegrid';
        this.WaiRole[EGenreRole.Article] = 'article';
        this.WaiRole[EGenreRole.Columnheader] = 'columnheader';
        this.WaiRole[EGenreRole.Definition] = 'definition';
        this.WaiRole[EGenreRole.Directory] = 'directory';
        this.WaiRole[EGenreRole.Document] = 'document';
        this.WaiRole[EGenreRole.Group] = 'group';
        this.WaiRole[EGenreRole.Heading] = 'heading';
        this.WaiRole[EGenreRole.Img] = 'img';
        this.WaiRole[EGenreRole.List] = 'list';
        this.WaiRole[EGenreRole.Listitem] = 'listitem';
        this.WaiRole[EGenreRole.Math] = 'math';
        this.WaiRole[EGenreRole.Note] = 'note';
        this.WaiRole[EGenreRole.Presentation] = 'presentation';
        this.WaiRole[EGenreRole.Region] = 'region';
        this.WaiRole[EGenreRole.Row] = 'row';
        this.WaiRole[EGenreRole.Rowheader] = 'rowheader';
        this.WaiRole[EGenreRole.Separator] = 'separator';
        this.WaiRole[EGenreRole.Toolbar] = 'toolbar';
        this.WaiRole[EGenreRole.Application] = 'application';
        this.WaiRole[EGenreRole.Banner] = 'banner';
        this.WaiRole[EGenreRole.Complementary] = 'complementary';
        this.WaiRole[EGenreRole.Contentinfo] = 'contentinfo';
        this.WaiRole[EGenreRole.Form] = 'form';
        this.WaiRole[EGenreRole.Main] = 'main';
        this.WaiRole[EGenreRole.Navigation] = 'navigation';
        this.WaiRole[EGenreRole.Search] = 'search';
        this.WaiAttribut = [];
        this.WaiAttribut[EGenreAttribut.activedescendant] =
          'aria-activedescendant';
        this.WaiAttribut[EGenreAttribut.atomic] = 'aria-atomic';
        this.WaiAttribut[EGenreAttribut.autocomplete] = 'aria-autocomplete';
        this.WaiAttribut[EGenreAttribut.busy] = 'aria-busy';
        this.WaiAttribut[EGenreAttribut.checked] = 'aria-checked';
        this.WaiAttribut[EGenreAttribut.controls] = 'aria-controls';
        this.WaiAttribut[EGenreAttribut.describedby] = 'aria-describedby';
        this.WaiAttribut[EGenreAttribut.disabled] = 'aria-disabled';
        this.WaiAttribut[EGenreAttribut.dropeffect] = 'aria-dropeffect';
        this.WaiAttribut[EGenreAttribut.expanded] = 'aria-expanded';
        this.WaiAttribut[EGenreAttribut.flowto] = 'aria-flowto';
        this.WaiAttribut[EGenreAttribut.grabbed] = 'aria-grabbed';
        this.WaiAttribut[EGenreAttribut.haspopup] = 'aria-haspopup';
        this.WaiAttribut[EGenreAttribut.hidden] = 'aria-hidden';
        this.WaiAttribut[EGenreAttribut.invalid] = 'aria-invalid';
        this.WaiAttribut[EGenreAttribut.label] = 'aria-label';
        this.WaiAttribut[EGenreAttribut.labelledby] = 'aria-labelledby';
        this.WaiAttribut[EGenreAttribut.level] = '	aria-level';
        this.WaiAttribut[EGenreAttribut.live] = 'aria-live';
        this.WaiAttribut[EGenreAttribut.multiline] = 'aria-multiline';
        this.WaiAttribut[EGenreAttribut.multiselectable] =
          'aria-multiselectable';
        this.WaiAttribut[EGenreAttribut.orientation] = 'aria-orientation';
        this.WaiAttribut[EGenreAttribut.owns] = 'aria-owns';
        this.WaiAttribut[EGenreAttribut.posinset] = 'aria-posinset';
        this.WaiAttribut[EGenreAttribut.pressed] = 'aria-pressed';
        this.WaiAttribut[EGenreAttribut.readonly] = 'aria-readonly';
        this.WaiAttribut[EGenreAttribut.relevant] = 'aria-relevant';
        this.WaiAttribut[EGenreAttribut.required] = 'aria-required';
        this.WaiAttribut[EGenreAttribut.selected] = 'aria-selected';
        this.WaiAttribut[EGenreAttribut.setsize] = 'aria-setsize';
        this.WaiAttribut[EGenreAttribut.sort] = 'aria-sort';
        this.WaiAttribut[EGenreAttribut.valuemax] = 'aria-valuemax';
        this.WaiAttribut[EGenreAttribut.valuemin] = 'aria-valuemin';
        this.WaiAttribut[EGenreAttribut.valuenow] = 'aria-valuenow';
        this.WaiAttribut[EGenreAttribut.valuetext] = 'aria-valuetext';
        this.WaiAttribut[EGenreAttribut.colindex] = 'aria-colindex';
        this.WaiAttribut[EGenreAttribut.colspan] = 'aria-colspan';
        this.WaiAttribut[EGenreAttribut.rowindex] = 'aria-rowindex';
        this.WaiAttribut[EGenreAttribut.rowspan] = 'aria-rowspan';
        this.WaiAttribut[EGenreAttribut.description] = 'aria-description';
      }
      getInfo(AEnum) {
        return this.InfoWai[AEnum];
      }
      strRole(AEnum) {
        return this.WaiRole[AEnum] || '';
      }
      getRole(AEnum) {
        return 'role="' + this.strRole(AEnum) + '"';
      }
      getAttribut(aEnum) {
        return this.WaiAttribut[aEnum];
      }
      composeSpan(AParametre, AId) {
        const lID = AId || false;
        const lTabIndex = AId ? '-1' : false;
        return typeof AParametre === 'string'
          ? IE.jsx.str(
              'span',
              { id: lID, tabindex: lTabIndex, class: 'sr-only' },
              AParametre,
            )
          : IE.jsx.str(
              'span',
              { id: lID, tabindex: lTabIndex, class: 'sr-only' },
              this.getInfo(AParametre),
            );
      }
      composeRole(AParametre) {
        return typeof AParametre === 'string' ? '' : this.getRole(AParametre);
      }
      composeAttribut(aParametre) {
        if (aParametre.valeur && typeof aParametre.valeur !== 'string') {
          IE.log.addLog(
            'ObjetWAI.composeAttribut: mauvais type de parametre ' +
              aParametre.genre +
              ' => ' +
              aParametre.valeur,
          );
        }
        if (!aParametre.valeur || typeof aParametre.valeur !== 'string') {
          return '';
        }
        const lAttribute = this.getAttribut(aParametre.genre);
        return typeof aParametre.genre === 'string' && lAttribute
          ? ''
          : ' ' + lAttribute + '="' + aParametre.valeur.toAttrValue() + '"';
      }
      getObjetAttributValeur(aGenreAttribut, aValeur) {
        const lObjetValeurAttribut = {};
        const lValeurStringAttribut = this.composeAttribut({
          genre: aGenreAttribut,
          valeur: aValeur,
        });
        if (lValeurStringAttribut && lValeurStringAttribut.includes('=')) {
          const lSplit = lValeurStringAttribut.split('=');
          if (lSplit && lSplit.length === 2) {
            lObjetValeurAttribut[lSplit[0]] = lSplit[1];
          }
        }
        return lObjetValeurAttribut;
      }
      getNodeRechercheNavigation(aTabNodes, aNodeOrigine, aModeRecherche) {
        if (aTabNodes && aTabNodes.length > 0) {
          let lIndexTrouve = aTabNodes.indexOf(aNodeOrigine);
          if (lIndexTrouve < 0) {
            aTabNodes.forEach((aElement, aIndex) => {
              if (
                lIndexTrouve < 0 &&
                $(aElement).find(aNodeOrigine).length > 0
              ) {
                lIndexTrouve = aIndex;
              }
            });
          }
          if (lIndexTrouve < 0) {
            return null;
          }
          switch (aModeRecherche) {
            case ObjetWAI.ModeRechercheNavigation.current:
              return aTabNodes[lIndexTrouve];
            case ObjetWAI.ModeRechercheNavigation.prev:
              return lIndexTrouve > 0 ? aTabNodes[lIndexTrouve - 1] : null;
            case ObjetWAI.ModeRechercheNavigation.prevCycle:
              return lIndexTrouve > 0
                ? aTabNodes[lIndexTrouve - 1]
                : aTabNodes[aTabNodes.length - 1];
            case ObjetWAI.ModeRechercheNavigation.next:
              return lIndexTrouve < aTabNodes.length - 1
                ? aTabNodes[lIndexTrouve + 1]
                : null;
            case ObjetWAI.ModeRechercheNavigation.nextCycle:
              return lIndexTrouve < aTabNodes.length - 1
                ? aTabNodes[lIndexTrouve + 1]
                : aTabNodes[0];
            case ObjetWAI.ModeRechercheNavigation.first:
              return aTabNodes[0];
            case ObjetWAI.ModeRechercheNavigation.last:
              return aTabNodes[aTabNodes.length - 1];
            default:
          }
        }
        return null;
      }
    }
    exports.ObjetWAI = ObjetWAI;
    (function (ObjetWAI) {
      let ModeRechercheNavigation;
      (function (ModeRechercheNavigation) {
        ModeRechercheNavigation[(ModeRechercheNavigation['prev'] = 0)] = 'prev';
        ModeRechercheNavigation[(ModeRechercheNavigation['prevCycle'] = 1)] =
          'prevCycle';
        ModeRechercheNavigation[(ModeRechercheNavigation['next'] = 2)] = 'next';
        ModeRechercheNavigation[(ModeRechercheNavigation['nextCycle'] = 3)] =
          'nextCycle';
        ModeRechercheNavigation[(ModeRechercheNavigation['first'] = 4)] =
          'first';
        ModeRechercheNavigation[(ModeRechercheNavigation['last'] = 5)] = 'last';
        ModeRechercheNavigation[(ModeRechercheNavigation['current'] = 6)] =
          'current';
      })(
        (ModeRechercheNavigation =
          ObjetWAI.ModeRechercheNavigation ||
          (ObjetWAI.ModeRechercheNavigation = {})),
      );
    })(ObjetWAI || (exports.ObjetWAI = ObjetWAI = {}));
    const GObjetWAI = new ObjetWAI();
    exports.GObjetWAI = GObjetWAI;
  },
  fn: 'objetwai.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const ToucheClavier_1 = require('ToucheClavier');
    const ObjetWAI_1 = require('ObjetWAI');
    IEHtml.addAttribut(
      'ie-zonenavigation',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lParams = {
          returnNavNode(aNode) {
            $(aNode).focus();
          },
          retourNavigationDefaut: null,
          nodeBackup: null,
        };
        if (aAttributValue && aContexteCourant.controleur) {
          const lInfos = aOutils.getAccesParametres(
            aAttributValue,
            aContexteCourant,
          );
          if (!lInfos.estFonction) {
            return true;
          }
          Object.assign(lParams, lInfos.callback());
        }
        if (!lParams) {
          return true;
        }
        $(aContexteCourant.node)
          .data('ie-zonenavigation', lParams)
          .addClass('ie-zonenavigation')
          .on({
            keyup(aEvent) {
              if (
                aEvent.which ===
                ToucheClavier_1.ToucheClavierUtil.ToucheRetourNavigation
              ) {
                const lPreviousZone =
                  ObjetWAI_1.GObjetWAI.getNodeRechercheNavigation(
                    $(document).find('.ie-zonenavigation').toArray(),
                    aContexteCourant.node,
                    ObjetWAI_1.ObjetWAI.ModeRechercheNavigation.prev,
                  );
                if (lPreviousZone) {
                  const lParamsPrevious =
                    $(lPreviousZone).data('ie-zonenavigation');
                  if (lParamsPrevious) {
                    if (
                      lParamsPrevious.nodeBackup &&
                      lParamsPrevious.returnNavNode &&
                      $(lPreviousZone).find(lParamsPrevious.nodeBackup).length >
                        0
                    ) {
                      lParamsPrevious.returnNavNode(lParamsPrevious.nodeBackup);
                      return;
                    }
                    if (lParamsPrevious.retourNavigationDefaut) {
                      lParamsPrevious.retourNavigationDefaut();
                      return;
                    }
                  } else {
                  }
                }
              }
            },
            focusout(aEvent) {
              lParams.nodeBackup = aEvent.target;
            },
          });
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          aAttributValue
            ? `ie-zonenavigation="${aAttributValue}"`
            : 'ie-zonenavigation',
        );
        return true;
      },
    );
  },
  fn: 'iehtml.zonenavigation.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IEHtml.BtnImage.css');
    const IEHtml = require('IEHtml');
    const Invocateur_1 = require('Invocateur');
    const ObjetHtml_1 = require('ObjetHtml');
    const ControleSaisieEvenement_1 = require('ControleSaisieEvenement');
    var TypeEtatBtnImage;
    (function (TypeEtatBtnImage) {
      TypeEtatBtnImage[(TypeEtatBtnImage['NonSelectionne'] = 0)] =
        'NonSelectionne';
      TypeEtatBtnImage[(TypeEtatBtnImage['Inactif'] = 1)] = 'Inactif';
      TypeEtatBtnImage[(TypeEtatBtnImage['ClicNonSelectionne'] = 2)] =
        'ClicNonSelectionne';
      TypeEtatBtnImage[(TypeEtatBtnImage['Selectionne'] = 3)] = 'Selectionne';
      TypeEtatBtnImage[(TypeEtatBtnImage['SurvolNonSelectionne'] = 4)] =
        'SurvolNonSelectionne';
      TypeEtatBtnImage[(TypeEtatBtnImage['SurvolSelectionne'] = 5)] =
        'SurvolSelectionne';
    })(TypeEtatBtnImage || (TypeEtatBtnImage = {}));
    IEHtml.addBalise('ie-btnimage', (aContexteCourant, aOutils) => {
      return _ieBtn(false, aContexteCourant, aOutils);
    });
    IEHtml.addBalise('ie-btnicon', (aContexteCourant, aOutils) => {
      return _ieBtn(true, aContexteCourant, aOutils);
    });
    function _ieBtn(aForcerIcone, aContexteCourant, aOutils) {
      let lEstIcone;
      let lEstSVG;
      let lInfosGetSelection;
      function _actualiser(aJBouton, aData, aEtat) {
        if (lEstIcone) {
          if (aData.$selection) {
            aJBouton.addClass('btnImageSelection');
          } else {
            aJBouton.removeClass('btnImageSelection');
          }
          if (lInfosGetSelection && lInfosGetSelection.valide) {
            aJBouton.attr('aria-pressed', aData.$selection ? 'true' : 'false');
          }
        }
        if (lEstIcone || lEstSVG) {
          return;
        }
        if (!aData.$disabled) {
          if (aData.$selection) {
            aData.$genre = aEtat.survol
              ? TypeEtatBtnImage.SurvolSelectionne
              : TypeEtatBtnImage.Selectionne;
          } else if (aEtat.clique) {
            aData.$genre = TypeEtatBtnImage.ClicNonSelectionne;
          } else {
            aData.$genre = aEtat.survol
              ? TypeEtatBtnImage.SurvolNonSelectionne
              : TypeEtatBtnImage.NonSelectionne;
          }
        } else {
          aData.$genre = TypeEtatBtnImage.Inactif;
        }
        aJBouton.css(
          'background-position',
          -aData.$width * aData.$genre + 'px 0',
        );
      }
      const lEtat = { clique: false, survol: false };
      Object.assign(aContexteCourant.data, {
        $width: 20,
        $selection: false,
        $genre: TypeEtatBtnImage.NonSelectionne,
        $disabled: false,
      });
      const lData = aContexteCourant.data;
      const lInnerHtml = aContexteCourant.node.innerHTML;
      lEstSVG = !!lInnerHtml && $(aContexteCourant.node).find('svg').length > 0;
      const lEstIconeStandard =
        aForcerIcone || $(aContexteCourant.node).hasClass('btnImageIcon');
      lEstIcone =
        lEstIconeStandard ||
        $(aContexteCourant.node).hasClass('btn-bandeau') ||
        $(aContexteCourant.node).hasClass('ObjetBoutonMenu_icone');
      const lBouton = lEstIcone
        ? ObjetHtml_1.GHtml.htmlToDOM(
            IE.jsx.str('i', { role: 'button', tabindex: '0' }),
          )
        : ObjetHtml_1.GHtml.htmlToDOM(
            IE.jsx.str('div', { role: 'button', tabindex: '0' }),
          );
      const lJBouton = $(lBouton);
      lJBouton.ieData(aContexteCourant.data);
      let lInfosEvent,
        lInfosGetDisabled,
        lInfosGetTitle,
        lAvecControleSaisie,
        lDisabled = false,
        lModele = aOutils.getModel(aContexteCourant),
        lAvecLabelAccessible =
          aContexteCourant.node.hasAttribute('aria-label') ||
          aContexteCourant.node.hasAttribute('aria-labelledby'),
        lLabelWAIManquant = !lAvecLabelAccessible,
        lSetTitle = function (aTitle) {
          lData.$oldTitle = aTitle;
          lJBouton.attr('title', aTitle);
          if (!lAvecLabelAccessible) {
            lJBouton.attr('aria-label', aTitle);
          }
        };
      const lSetDisabled = function (aDisabled) {
        if (aDisabled) {
          lJBouton.attr('aria-disabled', 'true');
          lJBouton.addClass('btnImageDisable');
        } else {
          lJBouton.get(0).removeAttribute('aria-disabled');
          lJBouton.removeClass('btnImageDisable');
        }
      };
      if (lModele && aContexteCourant.data.$modeleParsed) {
        lInfosEvent = aOutils.getAccesParametresModel(
          'event',
          aContexteCourant,
        );
        lInfosGetSelection = aOutils.getAccesParametresModel(
          'getSelection',
          aContexteCourant,
        );
        lInfosGetDisabled = aOutils.getAccesParametresModel(
          'getDisabled',
          aContexteCourant,
        );
        lInfosGetTitle = aOutils.getAccesParametresModel(
          'getTitle',
          aContexteCourant,
        );
        const lRefresh = aContexteCourant.contexte.refresh;
        lAvecControleSaisie = aOutils.getControleSaisieEvent(aContexteCourant);
        if (lInfosEvent.estFonction) {
          lJBouton.eventValidation(function (event) {
            if (lData.$disabled) {
              return;
            }
            const lAction = () => {
              const lResult = lInfosEvent.callback([
                event,
                this,
                aContexteCourant.data,
              ]);
              lRefresh();
              return lResult;
            };
            if (lAvecControleSaisie) {
              (0, ControleSaisieEvenement_1.ControleSaisieEvenement)(lAction);
            } else {
              return lAction();
            }
          });
        }
        let lGetSelection, lGetterDisabled, lGetterTitle;
        if (lInfosGetSelection.valide) {
          lGetSelection = function () {
            return !!lInfosGetSelection.callback([
              aContexteCourant.node,
              aContexteCourant.data,
            ]);
          };
          lData.$selection = lGetSelection();
        }
        if (lInfosGetDisabled.valide) {
          lGetterDisabled = function () {
            return !!lInfosGetDisabled.callback([
              lBouton,
              aContexteCourant.data,
            ]);
          };
          if (
            lInfosGetDisabled.estFonction ||
            !lGetterDisabled() ||
            lGetterDisabled() === true
          ) {
            lDisabled = !!lGetterDisabled();
          } else {
            lGetterDisabled = null;
            IE.log.addLog(
              'echec getDisabled de ie-bouton, propriété incorrecte du model "' +
                lModele +
                '"',
            );
          }
        }
        if (lInfosGetTitle.estFonction) {
          lGetterTitle = function () {
            return (
              lInfosGetTitle.callback([lBouton, aContexteCourant.data]) || ''
            );
          };
          lSetTitle(lGetterTitle());
          lLabelWAIManquant = false;
        }
        if (lGetSelection || lGetterDisabled || lGetterTitle) {
          aOutils.abonnerRefresh(
            () => {
              let lActualiser = false;
              if (lGetSelection) {
                const lSelection = lGetSelection();
                if (lSelection !== lData.$selection) {
                  lData.$selection = lSelection;
                  lActualiser = true;
                }
              }
              if (lGetterDisabled) {
                const lDisabled = !!lGetterDisabled();
                if (lDisabled !== lData.$disabled) {
                  lData.$disabled = lDisabled;
                  lSetDisabled(lDisabled);
                  lActualiser = true;
                }
              }
              if (lActualiser) {
                _actualiser(lJBouton, aContexteCourant.data, lEtat);
              }
              if (lGetterTitle) {
                const lTitle = lGetterTitle();
                if (lTitle !== lData.$oldTitle) {
                  lSetTitle(lTitle);
                }
              }
            },
            lBouton,
            aContexteCourant,
          );
        }
      }
      aOutils.copyAttributs(aContexteCourant.node, lBouton, (aName, aValue) => {
        if (
          aName === 'title' &&
          aValue &&
          (!lInfosGetTitle || !lInfosGetTitle.estFonction)
        ) {
          lJBouton.attr('aria-label', aValue);
          lLabelWAIManquant = false;
        } else if (aName === 'disabled') {
          lDisabled = true;
          return false;
        }
      });
      if (!lBouton.style.width) {
        if (!lEstSVG && !lEstIconeStandard) {
          lBouton.style.width = lData.$width + 'px';
        }
      } else {
        lData.$width = parseInt(lBouton.style.width, 10) || lData.$width;
      }
      lData.$disabled = lDisabled;
      _actualiser(lJBouton, aContexteCourant.data, lEtat);
      if (lDisabled) {
        lSetDisabled(lDisabled);
      }
      lJBouton
        .addClass('btnImage')
        .on('focusin mouseover', () => {
          lEtat.survol = true;
          _actualiser(lJBouton, aContexteCourant.data, lEtat);
        })
        .on('focusout mouseout', () => {
          lEtat.survol = false;
          _actualiser(lJBouton, aContexteCourant.data, lEtat);
        })
        .on('pointerdown', () => {
          lEtat.clique = true;
          _actualiser(lJBouton, aContexteCourant.data, lEtat);
          Invocateur_1.Invocateur.abonnerUnique(
            GNavigateur.getEventInvocateur('pointerup'),
            () => {
              lEtat.clique = false;
              _actualiser(lJBouton, aContexteCourant.data, lEtat);
            },
          );
        });
      const lRacine = lJBouton.get(0);
      aOutils.replaceNode(aContexteCourant.node, lRacine);
      if (lModele && aContexteCourant.data.$modeleParsed) {
        aOutils.surNodeEtNodeAfter(aContexteCourant);
      }
      aOutils.addCommentaireDebug(
        lRacine,
        aForcerIcone ? 'ie-btnicon' : 'ie-btnimage',
      );
      if (lInnerHtml) {
        aOutils.injectHTML({
          element: lRacine,
          html: lInnerHtml,
          controleur: aContexteCourant.controleur,
          ignorerScroll: true,
          contexte: aContexteCourant.contexte,
        });
      }
      return { node: lRacine, avecCompileFils: false };
    }
  },
  fn: 'iehtml.btnimage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IESwitch.css');
    require('IEHtml.CheckboxRadio.css');
    const IEHtml = require('IEHtml');
    const GUID_1 = require('GUID');
    var TypeCBRadio;
    (function (TypeCBRadio) {
      TypeCBRadio['checkbox'] = 'checkbox';
      TypeCBRadio['radio'] = 'radio';
      TypeCBRadio['switch'] = 'switch';
    })(TypeCBRadio || (TypeCBRadio = {}));
    const c_GenerateurGUID = new GUID_1.GenerateurGUID();
    function _creerCBEtRB(aContexteCourant, aType, aOutils) {
      const lInnerHTML = aContexteCourant.node.innerHTML;
      const lNomModele = aOutils.getModel(aContexteCourant);
      const lAvecIEHtml = aContexteCourant.node.hasAttribute('ie-html');
      const lAvecIETexte = aContexteCourant.node.hasAttribute('ie-texte');
      const lInfosGetLibelle = lNomModele
        ? aOutils.getAccesParametresModel('getLibelle', aContexteCourant)
        : null;
      const lAvecGetLibelle = lInfosGetLibelle && lInfosGetLibelle.estFonction;
      const lAvecLibelle =
        lInnerHTML.length > 0 || lAvecIEHtml || lAvecIETexte || lAvecGetLibelle;
      let lJModele;
      let lJInput;
      let lRacine;
      let llName;
      let lContexteCourant;
      const lMap = aOutils.getMapDeNode(aContexteCourant.node);
      let lEventMap;
      let lEtatIndetermine = false;
      let lSubstitution = true;
      let lEstGauche = !IE.estMobile;
      let lEstDroite = IE.estMobile;
      if (!lEstGauche && aContexteCourant.node.hasAttribute('ie-textright')) {
        lEstGauche = true;
        lEstDroite = false;
      }
      if (!lEstDroite && aContexteCourant.node.hasAttribute('ie-textleft')) {
        lEstGauche = false;
        lEstDroite = true;
      }
      aContexteCourant.data.estRadioBouton = aType === TypeCBRadio.radio;
      const lIdInput = lMap['id'] || `cb-${c_GenerateurGUID.get()}-gen-for`;
      let lClassCss;
      let lClassSpan = '';
      let lSpanGauche = '';
      let lSpanDroite = '';
      if (aType === TypeCBRadio.switch) {
        if (
          !lAvecIEHtml &&
          !lAvecIETexte &&
          !lAvecGetLibelle &&
          lInnerHTML &&
          aContexteCourant.node.childNodes.length === 2 &&
          aContexteCourant.node.childNodes[0].nodeName.toLowerCase() ===
            'span' &&
          aContexteCourant.node.childNodes[1].nodeName.toLowerCase() === 'span'
        ) {
          lSpanGauche =
            aContexteCourant.node.childNodes[0][
              IE.estMobile ? 'innerHTML' : 'outerHTML'
            ];
          lSpanDroite = aContexteCourant.node.childNodes[1].outerHTML;
          lEstGauche = true;
          lEstDroite = false;
        }
        lClassCss =
          'ieswitch ' + (lEstDroite ? 'iecbrbdroite' : 'iecbrbgauche');
        lClassSpan = 'lever';
      } else {
        lClassCss = 'iecb ' + (lEstDroite ? 'iecbrbdroite' : 'iecbrbgauche');
      }
      if ($(aContexteCourant.node).hasClass('as-chips')) {
        let lImageIconChips =
          aContexteCourant.node.getAttribute('ie-icon') || '';
        if (lImageIconChips) {
          aContexteCourant.node.removeAttribute('ie-icon');
        }
        lClassCss += ' ' + lImageIconChips;
      }
      lJModele = $(
        (aType === TypeCBRadio.switch ? '<div class="switch">' : '') +
          IE.jsx.str(
            'label',
            { class: lClassCss, for: lIdInput },
            IE.jsx.str('input', {
              type: aType !== TypeCBRadio.radio ? 'checkbox' : 'radio',
              id: lIdInput,
              role: aType === TypeCBRadio.switch ? 'switch' : false,
            }),
            IE.jsx.str('span', {
              class: lClassSpan || false,
              'aria-hidden': 'true',
            }),
            !lInnerHTML && lAvecLibelle && !lSpanDroite
              ? IE.jsx.str('span', null)
              : '',
          ) +
          (aType === TypeCBRadio.switch ? '</div>' : ''),
      );
      lJInput = lJModele.find('input');
      lRacine = lJModele.get(0);
      const lElementInput = lJInput.get(0);
      lJModele.ieData(aContexteCourant.data);
      Object.assign(aContexteCourant.data, {
        $couleurActif: '',
        $couleurInactif: GCouleur.nonEditable.texte,
        $AvecMain: true,
      });
      for (llName in lMap) {
        if (
          llName !== 'type' &&
          llName !== 'ie-textright' &&
          llName !== 'ie-textleft' &&
          llName !== 'ie-icon'
        ) {
          try {
            if (
              llName === 'style' ||
              llName === 'title' ||
              aOutils.composantsAttributs[llName] ||
              llName === 'aria-hidden'
            ) {
              lJModele.attr(llName, lMap[llName]);
              if (!lSubstitution && llName !== 'style') {
                lJInput.removeAttr(llName);
              }
            } else if (llName === 'class') {
              lJModele.addClass(lMap[llName]);
            } else {
              if (lSubstitution) {
                lJInput.attr(llName, lMap[llName]);
              }
            }
          } catch (e) {}
        }
      }
      if (
        aType === TypeCBRadio.radio &&
        !lMap.name &&
        lNomModele &&
        aContexteCourant.data.$modeleParsed &&
        aContexteCourant.controleur
      ) {
        lJInput.attr(
          'name',
          aContexteCourant.controleur.$GUID +
            '_' +
            aContexteCourant.data.$modeleParsed.nom,
        );
      }
      if (aType === TypeCBRadio.checkbox) {
        lEtatIndetermine = lElementInput.indeterminate;
        if (lNomModele && aContexteCourant.data.$modeleParsed) {
          const lInfosGetIndeterminate = aOutils.getAccesParametresModel(
            'getIndeterminate',
            aContexteCourant,
          );
          if (lInfosGetIndeterminate.estFonction) {
            lEtatIndetermine = !!lInfosGetIndeterminate.callback();
            aOutils.abonnerRefresh(
              () => {
                const lEtat = !!lInfosGetIndeterminate.callback();
                if (lEtat !== lElementInput.indeterminate) {
                  lEtatIndetermine = lEtat;
                  lElementInput.indeterminate = lEtatIndetermine;
                }
              },
              lElementInput,
              aContexteCourant,
            );
          }
        }
      }
      lEventMap = {};
      lEventMap.focus = function () {
        $(this).parent().triggerHandler('focusin');
      };
      lEventMap.blur = function () {
        $(this).parent().triggerHandler('focusout');
      };
      lJInput.on(lEventMap);
      if (aContexteCourant.data.$modeleValue) {
        lContexteCourant = Object.assign({}, aContexteCourant);
        lContexteCourant.node = lElementInput;
        aOutils.gererInputCB(lContexteCourant, lMap.type);
      } else {
        lJInput.on(IEHtml.C_eventsModifyCheckbox, () => {
          aContexteCourant.contexte.refresh();
        });
      }
      if (lEtatIndetermine) {
        lElementInput.indeterminate = lEtatIndetermine;
      }
      const lJLabelParent = lJInput.closest('label');
      const lGetDisabled = function () {
        return lJInput.is(':disabled');
      };
      let lEstDisabled = lGetDisabled();
      if (lEstDisabled) {
        lJLabelParent.addClass('is-disabled');
      }
      const lGetChecked = function () {
        return lJInput.is(':checked');
      };
      let lEstChecked = lGetChecked();
      if (lEstChecked) {
        lJLabelParent.addClass('is-checked');
      }
      const lGetIndeterminate = function () {
        return lJInput.is(':indeterminate');
      };
      let lEstIndeterminate = lGetIndeterminate();
      if (lEstIndeterminate) {
        lJLabelParent.addClass('is-indeterminate');
      }
      aOutils.abonnerRefresh(
        () => {
          const lNewEstDisabled = lGetDisabled();
          if (lNewEstDisabled !== lEstDisabled) {
            if (lNewEstDisabled) {
              lJLabelParent.addClass('is-disabled');
            } else {
              lJLabelParent.removeClass('is-disabled');
            }
            lEstDisabled = lNewEstDisabled;
          }
          const lNewEstChecked = lGetChecked();
          if (lNewEstChecked !== lEstChecked) {
            if (lNewEstChecked) {
              lJLabelParent.addClass('is-checked');
            } else {
              lJLabelParent.removeClass('is-checked');
            }
            lEstChecked = lNewEstChecked;
          }
          const lNewEstIndeterminate = lGetIndeterminate();
          if (lNewEstIndeterminate !== lEstIndeterminate) {
            if (lNewEstIndeterminate) {
              lJLabelParent.addClass('is-indeterminate');
            } else {
              lJLabelParent.removeClass('is-indeterminate');
            }
            lEstIndeterminate = lNewEstIndeterminate;
          }
        },
        lElementInput,
        aContexteCourant,
      );
      if (lSubstitution) {
        aOutils.replaceNode(aContexteCourant.node, lRacine);
      }
      aOutils.addCommentaireDebug(lRacine, 'ie-' + aType);
      if (lAvecLibelle) {
        let lDest = lRacine;
        if (aType === TypeCBRadio.switch) {
          lDest = lRacine.firstChild;
        }
        if (lSpanGauche) {
          aOutils.injectHTML({
            element: lDest,
            insererAvantLeNode: lJModele.find('span.lever').get(0),
            html: lSpanGauche,
            controleur: aContexteCourant.controleur,
            ignorerScroll: true,
            contexte: aContexteCourant.contexte,
          });
        }
        if (lInnerHTML) {
          aOutils.injectHTML({
            element: lDest,
            html: lSpanDroite || '<span>' + lInnerHTML + '</span>',
            controleur: aContexteCourant.controleur,
            ignorerScroll: true,
            contexte: aContexteCourant.contexte,
          });
        }
        aContexteCourant.nodeTransfertContenuDynamique = lDest.lastChild;
        if (lAvecGetLibelle) {
          aOutils.addGetterHtml(aContexteCourant, lInfosGetLibelle);
        }
      }
      aContexteCourant.node = lRacine;
      return { node: aContexteCourant.node, avecCompileFils: false };
    }
    IEHtml.addBalise('ie-checkbox', (aContexteCourant, aOutils) => {
      return _creerCBEtRB(aContexteCourant, TypeCBRadio.checkbox, aOutils);
    });
    IEHtml.addBalise('ie-radio', (aContexteCourant, aOutils) => {
      return _creerCBEtRB(aContexteCourant, TypeCBRadio.radio, aOutils);
    });
    IEHtml.addBalise('ie-switch', (aContexteCourant, aOutils) => {
      return _creerCBEtRB(aContexteCourant, TypeCBRadio.switch, aOutils);
    });
  },
  fn: 'iehtml.checkboxradio.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Callback = void 0;
    class Callback {
      constructor(aPere, aEvenement, aIdentifiant) {
        this.pere = aPere;
        this.evenement = aEvenement;
        this.identifiant = aIdentifiant;
      }
      appel(...aParams) {
        if (this.pere && this.evenement) {
          return this.evenement.call(this.pere, ...aParams);
        }
      }
    }
    exports.Callback = Callback;
  },
  fn: 'callback.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreDirection = void 0;
    var EGenreDirection;
    (function (EGenreDirection) {
      EGenreDirection[(EGenreDirection['SensInverse'] = -1)] = 'SensInverse';
      EGenreDirection[(EGenreDirection['DeuxSenses'] = 0)] = 'DeuxSenses';
      EGenreDirection[(EGenreDirection['SensNormal'] = 1)] = 'SensNormal';
    })(EGenreDirection || (exports.EGenreDirection = EGenreDirection = {}));
  },
  fn: 'enumere_direction.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreOrientationAffichage = void 0;
    var EGenreOrientationAffichage;
    (function (EGenreOrientationAffichage) {
      EGenreOrientationAffichage[(EGenreOrientationAffichage['Vertical'] = 0)] =
        'Vertical';
      EGenreOrientationAffichage[
        (EGenreOrientationAffichage['Horizontal'] = 1)
      ] = 'Horizontal';
    })(
      EGenreOrientationAffichage ||
        (exports.EGenreOrientationAffichage = EGenreOrientationAffichage = {}),
    );
  },
  fn: 'enumere_orientationaffichage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Identite = void 0;
    require('Divers.js');
    require('NamespaceIE');
    require('DeclarationExtensionsObjetNatif');
    const IEHtml = require('IEHtml');
    const Callback_1 = require('Callback');
    const GUID_1 = require('GUID');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_1 = require('ObjetStyle');
    const Enumere_Direction_1 = require('Enumere_Direction');
    const Enumere_OrientationAffichage_1 = require('Enumere_OrientationAffichage');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const lGenerateurGUID = new GUID_1.GUID.generateur();
    class Identite {
      constructor(ANom, AIdent, APere, AEvenement) {
        this.pileAbonnementInvocateur = {};
        if (typeof ANom === 'string') {
          this.Nom = this.construireNom(ANom, AIdent);
          this.Pere = APere;
          this.Evenement = AEvenement;
        } else {
          const lParametres = {
            nomComplet: '',
            nomObjet: undefined,
            pere: null,
            evenement: undefined,
          };
          $.extend(lParametres, ANom);
          this.Pere = lParametres.pere;
          this.Evenement = lParametres.evenement;
          if (
            lParametres.nomObjet &&
            lParametres.pere &&
            lParametres.pere instanceof Identite
          ) {
            this.Nom = lParametres.pere.Nom + '.' + lParametres.nomObjet;
          } else {
            this.Nom = lParametres.nomComplet || '';
          }
        }
        this.callback = new Callback_1.Callback(this.Pere, this.Evenement);
        this._callbacksSurDestruction = [];
        if (this.Pere && this.Pere instanceof Identite) {
          this.Pere.ajouterInstanceADetruire(this);
        }
        this.options = {};
        this.Actif = true;
        this.Visible = true;
        this.TableauGauche = {};
        this.TableauDroite = {};
        this.TableauHaut = {};
        this.TableauBas = {};
        this.IdPremierElement = '';
        this.idMessageActionRequise = GUID_1.GUID.getId();
        this.tabIndex = 0;
        this.pileEvenementGlobaux = [];
        this.instancesADetruire = {};
        this.controleur = IEHtml.initControleur(this.getControleur(this) || {});
        if (this.controleur) {
          this.controleur.instance = this;
        }
      }
      setOptions(aOptions) {
        Object.assign(this.options, aOptions);
        return this;
      }
      getOptions() {
        return this.options;
      }
      getPileAbonnement() {
        return this.pileAbonnementInvocateur;
      }
      setParametres(...aParams) {}
      setAvecTabulation(AAvecTabIndex) {
        this.tabIndex =
          AAvecTabIndex === null || AAvecTabIndex === undefined || AAvecTabIndex
            ? 0
            : -1;
      }
      setDonnees(...aParams) {}
      recupererDonnees() {}
      construireAffichage(...aParams) {
        return '&nbsp;';
      }
      setGenre(AGenre) {
        this.Genre = AGenre;
      }
      setActif(AActif) {
        this.Actif = AActif;
      }
      getActif() {
        return this.Actif;
      }
      setVisible(AVisible) {
        ObjetStyle_1.GStyle.setDisplay(this.Nom, (this.Visible = AVisible));
      }
      estUneInteractionUtilisateur() {
        return this.InteractionUtilisateur !== false;
      }
      setEtatSaisie(aEtatSaisie) {
        if (this.Pere && this.Pere instanceof Identite) {
          this.Pere.setEtatSaisie(aEtatSaisie);
        } else {
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.etatSaisie,
            aEtatSaisie,
          );
        }
      }
      setControleNavigation(AControleNavigation) {
        this.ControleNavigation = AControleNavigation;
      }
      getEtatSaisie() {
        if (this.Pere && this.Pere instanceof Identite) {
          return this.Pere.getEtatSaisie();
        }
      }
      $refresh() {
        return this.controleur.$refresh();
      }
      $refreshSelf() {
        return this.controleur.$refreshSelf();
      }
      getControleur(aInstance) {
        return {};
      }
      avecEventResizeNavigateur() {
        return this.Pere && this.Pere instanceof Identite
          ? this.Pere.avecEventResizeNavigateur()
          : true;
      }
      construireNom(ANom, AIdent) {
        return AIdent === null || AIdent === undefined
          ? ANom
          : ANom + '[' + AIdent + ']';
      }
      getNom() {
        return this.Nom;
      }
      effacer(aMessage) {
        if (aMessage === null || aMessage === undefined) {
          aMessage = '&nbsp;';
        }
        ObjetHtml_1.GHtml.setHtml(this.Nom, aMessage);
      }
      afficher(H, ...aParams) {
        let lHtml = '';
        if (H === null || H === undefined) {
          lHtml = this.construireAffichage();
        } else if (aParams.length === 0 && typeof H === 'string') {
          lHtml = H;
        } else {
        }
        if (lHtml) {
          ObjetHtml_1.GHtml.setHtml(this.Nom, lHtml, { instance: this });
        }
      }
      initialiser() {
        const H = this.construireAffichage();
        if (H) {
          ObjetHtml_1.GHtml.setHtml(this.Nom, H, { instance: this });
        }
        this.recupererDonnees();
      }
      composeMessage(aMessage) {
        return IE.jsx.str(
          'div',
          { role: 'note', tabindex: '0' },
          IE.jsx.str(
            'p',
            {
              id: this.idMessageActionRequise,
              class: 'semi-bold taille-m text-center p-y-xl m-bottom-l',
            },
            aMessage,
          ),
        );
      }
      navigationClavier(AId) {
        if (GNavigateur.isToucheFleche()) {
          this.focusSuivant(
            AId,
            GNavigateur.isToucheFlecheGauche() ||
              GNavigateur.isToucheFlecheDroite()
              ? Enumere_OrientationAffichage_1.EGenreOrientationAffichage
                  .Horizontal
              : Enumere_OrientationAffichage_1.EGenreOrientationAffichage
                  .Vertical,
            GNavigateur.isToucheFlecheGauche() ||
              GNavigateur.isToucheFlecheHaut()
              ? Enumere_Direction_1.EGenreDirection.SensInverse
              : Enumere_Direction_1.EGenreDirection.SensNormal,
          );
        }
      }
      focusSuivant(AId, AOrientation, ADirection) {
        const lIdSuivant = this.getIdNavigationSuivant(
          AId,
          AOrientation,
          ADirection,
        );
        if (lIdSuivant) {
          ObjetHtml_1.GHtml.setFocus(lIdSuivant);
        }
      }
      getIdNavigationSuivant(aId, aOrientation, aDirection) {
        return aOrientation ===
          Enumere_OrientationAffichage_1.EGenreOrientationAffichage.Horizontal
          ? aDirection === Enumere_Direction_1.EGenreDirection.SensNormal
            ? this.TableauDroite[aId]
            : this.TableauGauche[aId]
          : aDirection === Enumere_Direction_1.EGenreDirection.SensNormal
            ? this.TableauBas[aId]
            : this.TableauHaut[aId];
      }
      ajouterAuTableaux(APremierId, ADeuxiemeId, AHorizontal, AVertical) {
        switch (AHorizontal) {
          case Enumere_Direction_1.EGenreDirection.DeuxSenses:
            this.TableauDroite[APremierId] = ADeuxiemeId;
            this.TableauGauche[ADeuxiemeId] = APremierId;
            break;
          case Enumere_Direction_1.EGenreDirection.SensNormal:
            this.TableauDroite[APremierId] = ADeuxiemeId;
            break;
          case Enumere_Direction_1.EGenreDirection.SensInverse:
            this.TableauGauche[ADeuxiemeId] = APremierId;
            break;
        }
        switch (AVertical) {
          case Enumere_Direction_1.EGenreDirection.DeuxSenses:
            this.TableauBas[APremierId] = ADeuxiemeId;
            this.TableauHaut[ADeuxiemeId] = APremierId;
            break;
          case Enumere_Direction_1.EGenreDirection.SensNormal:
            this.TableauBas[APremierId] = ADeuxiemeId;
            break;
          case Enumere_Direction_1.EGenreDirection.SensInverse:
            this.TableauHaut[ADeuxiemeId] = APremierId;
            break;
        }
      }
      resetTableauxNavigation() {
        this.TableauGauche = {};
        this.TableauDroite = {};
        this.TableauHaut = {};
        this.TableauBas = {};
      }
      estObjetGraphiqueFenetre() {
        return false;
      }
      getId(APositionId) {
        if (this.TabId && APositionId < this.TabId.length) {
          return this.TabId[APositionId];
        }
      }
      focusSurPremierElement() {
        ObjetHtml_1.GHtml.setFocus(this.IdPremierElement);
      }
      setPremierElement(AElement) {
        this.IdPremierElement = AElement;
      }
      getPremierElement() {
        return this.IdPremierElement;
      }
      ajouterInstanceADetruire(aInstance) {
        if (aInstance && aInstance.Nom) {
          this.instancesADetruire[aInstance.Nom] = aInstance;
        }
      }
      enleverInstanceADetruire(aInstance) {
        if (aInstance && aInstance.Nom) {
          this.instancesADetruire[aInstance.Nom] = null;
        }
      }
      ajouterEvenementGlobal(aEvenement, aMethode) {
        if (!GNavigateur.addEvent) {
          return;
        }
        if (!aMethode) {
          return;
        }
        GNavigateur.addEvent(aEvenement, this, aMethode);
        this.pileEvenementGlobaux.push({
          evenement: aEvenement,
          methode: aMethode,
        });
        return this.pileEvenementGlobaux.length - 1;
      }
      viderEvenementGlobaux() {
        for (let i = 0; i < this.pileEvenementGlobaux.length; i++) {
          GNavigateur.delEvent(this.pileEvenementGlobaux[i].evenement, this);
        }
        this.pileEvenementGlobaux = [];
      }
      detruireInstances() {}
      free() {
        if (this.isDestroyed()) {
          return;
        }
        this.__enCoursDeDestruction = true;
        try {
          this._viderEvenements();
          this.detruireInstancesFils();
          if (this.detruireInstances) {
            this.detruireInstances();
          }
          if (this.estObjetGraphiqueFenetre()) {
            if (ObjetHtml_1.GHtml.elementExiste(this.Nom)) {
              IEZoneFenetre_1.ZoneFenetre.enleverFenetre(this.Nom);
            }
          } else if (
            !this.Pere ||
            !(
              '__enCoursDeDestruction' in this.Pere &&
              this.Pere.__enCoursDeDestruction
            )
          ) {
            ObjetHtml_1.GHtml.setHtml(this.Nom, '', true);
          }
          if (this.Pere && this.Pere instanceof Identite) {
            this.Pere.enleverInstanceADetruire(this);
          }
          if (this._callbacksSurDestruction.length > 0) {
            this._callbacksSurDestruction.forEach((aCallback) => {
              aCallback();
            });
          }
        } catch (e) {
        } finally {
          delete this.__enCoursDeDestruction;
          this._estDetruite = true;
        }
      }
      detruireInstancesFils() {
        for (const lNom in this.instancesADetruire) {
          if (this.instancesADetruire.hasOwnProperty(lNom)) {
            const lInstance = this.instancesADetruire[lNom];
            if (lInstance && !lInstance._estDetruite && lInstance.free) {
              lInstance.free();
            }
            this.instancesADetruire[lNom] = null;
          }
        }
      }
      ajouterCallbackSurDestruction(aCallback) {
        this._callbacksSurDestruction.push(aCallback);
        return this;
      }
      isDestroyed() {
        return this._estDetruite || this.__enCoursDeDestruction;
      }
      static creerInstance(aConstructeur, aParametres) {
        if (!aConstructeur) {
          return null;
        }
        const lNom = lGenerateurGUID.get(),
          lNomComplet = 'IE.Identite.collection.' + lNom;
        $.extend(aParametres, { nomComplet: lNomComplet });
        const lInstance = new aConstructeur(aParametres);
        if (aParametres.options) {
          lInstance.setOptions(aParametres.options);
        }
        lInstance.ajouterCallbackSurDestruction(() => {
          if (IE.Identite.collection[lNom]) {
            delete IE.Identite.collection[lNom];
          }
        });
        IE.Identite.collection[lNom] = lInstance;
        return lInstance;
      }
      _viderEvenements() {
        Invocateur_1.Invocateur.desabonner(this);
        this.viderEvenementGlobaux();
      }
    }
    exports.Identite = Identite;
  },
  fn: 'objetidentite.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetIdentite_1 = require('ObjetIdentite');
    IEHtml.addAttribut(
      'ie-identite',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lNode = aContexteCourant.node;
        if (lNode.id) {
          return true;
        }
        const lValue = aAttributValue || '';
        if (!lValue || !aContexteCourant.controleur) {
          return true;
        }
        const lCallbackParams = aOutils.getAccesParametres(
          lValue,
          aContexteCourant,
        );
        if (!lCallbackParams.estFonction) {
          return true;
        }
        const lValueCallback = lCallbackParams.callback([]);
        if (!lValueCallback || !lValueCallback.class || !lValueCallback.pere) {
          return true;
        }
        let lInstance = ObjetIdentite_1.Identite.creerInstance(
          lValueCallback.class,
          { pere: lValueCallback.pere, evenement: lValueCallback.evenement },
        );
        lNode.id = lInstance.getNom();
        $(lNode).on('destroyed', () => {
          if (
            MethodesObjet_1.MethodesObjet.isFunction(lValueCallback.destroy)
          ) {
            lValueCallback.destroy(lInstance);
          }
          lInstance.free();
          lInstance = null;
        });
        if (MethodesObjet_1.MethodesObjet.isFunction(lValueCallback.init)) {
          lValueCallback.init(lInstance);
        }
        aOutils.surInjectionHtml(aContexteCourant, () => {
          if (MethodesObjet_1.MethodesObjet.isFunction(lInstance.initialiser)) {
            lInstance.initialiser();
          }
          if (MethodesObjet_1.MethodesObjet.isFunction(lValueCallback.start)) {
            lValueCallback.start(lInstance);
          }
        });
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-identite="' + lValue + '"',
        );
        return true;
      },
    );
  },
  fn: 'iehtml.identite.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IEHtml.Chips.css');
    const IEHtml = require('IEHtml');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetWAI_1 = require('ObjetWAI');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ToucheClavier_1 = require('ToucheClavier');
    IEHtml.addBalise('ie-chips', (aContexteCourant, aOutils) => {
      const lModele = aOutils.getModel(aContexteCourant);
      const lInnerHtml = aContexteCourant.node.innerHTML;
      const lHref = aContexteCourant.node.getAttribute('href');
      const lOptions = {
        avecBtn: true,
        classIconeBtn: 'icon_fermeture_widget ',
        titleBtn: ObjetTraduction_1.GTraductions.getValeur('Supprimer'),
        disabled: false,
        selected: false,
      };
      const lHtmlInterneChips = IE.jsx.str(
        'div',
        { class: 'text', 'ie-ellipsis': true },
        lInnerHtml,
      );
      const lElementChips = ObjetHtml_1.GHtml.htmlToDOM(
        lHref
          ? IE.jsx.str(
              'a',
              { href: lHref, target: '_blank' },
              lHtmlInterneChips,
            )
          : IE.jsx.str('div', { tabindex: '0' }, lHtmlInterneChips),
      );
      const lJChips = $(lElementChips);
      let lJBtnSuppr = null;
      let lJRoleButton = $(lElementChips);
      const lJText = lJChips.find('.text');
      let lInfosEvent;
      let lInfosEventBtn;
      let lInfosGetDisabled;
      let lInfosGetOptions;
      let lInfosGetLibelle;
      let lAvecBtnSuppr = false;
      let lFuncGetLabelBtnSuppr = null;
      let lLabelBtnSuppr_bak = '';
      const lRefresh = aContexteCourant.contexte.refresh;
      if (lModele && aContexteCourant.data.$modeleParsed) {
        lInfosEvent = aOutils.getAccesParametresModel(
          'event',
          aContexteCourant,
        );
        lInfosEventBtn = aOutils.getAccesParametresModel(
          'eventBtn',
          aContexteCourant,
        );
        lInfosGetDisabled = aOutils.getAccesParametresModel(
          'getDisabled',
          aContexteCourant,
        );
        const lInfosGetSelected = aOutils.getAccesParametresModel(
          'getSelected',
          aContexteCourant,
        );
        lInfosGetOptions = aOutils.getAccesParametresModel(
          'getOptions',
          aContexteCourant,
        );
        lInfosGetLibelle = aOutils.getAccesParametresModel(
          'getLibelle',
          aContexteCourant,
        );
        if (lInfosGetOptions.estFonction) {
          Object.assign(lOptions, lInfosGetOptions.callback([lElementChips]));
        }
        if (
          lOptions.avecBtn &&
          lOptions.classIconeBtn &&
          lInfosEventBtn &&
          lInfosEventBtn.estFonction
        ) {
          lAvecBtnSuppr = true;
          lJRoleButton = lJText;
        }
        let lGetterDisabled;
        if (lInfosGetDisabled.estFonction) {
          lGetterDisabled = function () {
            return !!lInfosGetDisabled.callback([]);
          };
          lOptions.disabled = lGetterDisabled();
        }
        const lSetDisabled = function () {
          var _a;
          if (lOptions.disabled) {
            lJRoleButton.attr(
              ObjetWAI_1.GObjetWAI.getAttribut(
                ObjetWAI_1.EGenreAttribut.disabled,
              ),
              'true',
            );
            lJBtnSuppr === null || lJBtnSuppr === void 0
              ? void 0
              : lJBtnSuppr.attr(
                  ObjetWAI_1.GObjetWAI.getAttribut(
                    ObjetWAI_1.EGenreAttribut.disabled,
                  ),
                  'true',
                );
            lJChips.addClass('disabled');
          } else {
            lJRoleButton
              .get(0)
              .removeAttribute(
                ObjetWAI_1.GObjetWAI.getAttribut(
                  ObjetWAI_1.EGenreAttribut.disabled,
                ),
              );
            (_a =
              lJBtnSuppr === null || lJBtnSuppr === void 0
                ? void 0
                : lJBtnSuppr.get(0)) === null || _a === void 0
              ? void 0
              : _a.removeAttribute(
                  ObjetWAI_1.GObjetWAI.getAttribut(
                    ObjetWAI_1.EGenreAttribut.disabled,
                  ),
                );
            lJChips.removeClass('disabled');
          }
        };
        if (lInfosGetSelected.estFonction) {
          lOptions.selected = !!lInfosGetSelected.callback([]);
          lOptions.selected
            ? lJChips.addClass('pressed')
            : lJChips.removeClass('pressed');
          lJRoleButton.attr('aria-pressed', lOptions.selected + '');
        }
        if (lGetterDisabled || lInfosGetSelected.estFonction) {
          aOutils.abonnerRefresh(
            () => {
              if (lGetterDisabled) {
                const lDisabled = !!lGetterDisabled();
                if (lDisabled !== lOptions.disabled) {
                  lOptions.disabled = lDisabled;
                  lSetDisabled();
                }
              }
              if (lInfosGetSelected.estFonction) {
                const lEstSelected = !!lInfosGetSelected.callback([]);
                if (lEstSelected !== lOptions.selected) {
                  lOptions.selected = lEstSelected;
                  lOptions.selected
                    ? lJChips.addClass('pressed')
                    : lJChips.removeClass('pressed');
                  lJRoleButton.attr('aria-pressed', lOptions.selected + '');
                }
              }
            },
            lElementChips,
            aContexteCourant,
          );
        }
        if (lAvecBtnSuppr) {
          lFuncGetLabelBtnSuppr = () => {
            return `${lOptions.titleBtn} ${lJText.text()}`;
          };
          lLabelBtnSuppr_bak = lFuncGetLabelBtnSuppr();
          lJChips.append(
            IE.jsx.str('i', {
              class: ['btn', lOptions.classIconeBtn],
              role: 'button',
              tabindex: '0',
              'aria-label': lLabelBtnSuppr_bak,
            }),
          );
          lJBtnSuppr = lJChips.find('>i');
        }
        if (lOptions.disabled) {
          lSetDisabled();
        }
      }
      aOutils.copyAttributs(aContexteCourant.node, lElementChips);
      if (!lHref && lInfosEvent && lInfosEvent.estFonction) {
        lJChips.get(0).removeAttribute('tabindex');
        lJRoleButton.get(0).setAttribute('role', 'button');
        lJRoleButton.get(0).setAttribute('tabindex', '0');
      }
      let lClass = 'ie-chips' + (lHref ? ' AvecMenuContextuel' : '');
      if ((lInfosEvent && lInfosEvent.estFonction) || lHref) {
        lJChips.eventValidation((aEvent) => {
          if (aEvent.originalEvent && '__eventBtn__' in aEvent.originalEvent) {
            return;
          }
          if (lOptions.disabled) {
            if (lHref) {
              return false;
            }
            return;
          }
          if (lInfosEvent && lInfosEvent.estFonction) {
            const lResult = lInfosEvent.callback([aEvent]);
            lRefresh();
            return lResult;
          }
        });
        lClass += ' avec-event ie-ripple ie-ripple-claire';
      }
      if (lJBtnSuppr) {
        lJBtnSuppr.eventValidation((aEvent) => {
          if (lOptions.disabled) {
            return;
          }
          if (aEvent.originalEvent) {
            aEvent.originalEvent.__eventBtn__ = true;
          }
          let lResult = lInfosEventBtn.callback([aEvent]);
          lRefresh();
          if (lHref) {
            lResult = false;
          }
          return lResult;
        });
        lJChips.on('keyup', (aEvent) => {
          if (lOptions.disabled) {
            return;
          }
          if (
            ToucheClavier_1.ToucheClavierUtil.estEventSupprimer(aEvent) ||
            aEvent.which === ToucheClavier_1.ToucheClavier.Backspace
          ) {
            const lResult = lInfosEventBtn.callback([aEvent]);
            lRefresh();
            return lResult;
          }
        });
      }
      lJChips.addClass(lClass);
      const lRacine = lElementChips;
      aOutils.replaceNode(aContexteCourant.node, lRacine);
      aContexteCourant.node = lRacine;
      if (lModele && aContexteCourant.data.$modeleParsed) {
        aOutils.surNodeEtNodeAfter(aContexteCourant);
      }
      aContexteCourant.nodeTransfertContenuDynamique = lJText.get(0);
      if (lInfosGetLibelle && lInfosGetLibelle.estFonction) {
        if (aContexteCourant.nodeTransfertContenuDynamique) {
          aOutils.addGetterHtml(aContexteCourant, lInfosGetLibelle);
          if (lFuncGetLabelBtnSuppr) {
            aOutils.abonnerRefresh(
              () => {
                if (lInfosGetLibelle) {
                  const lLabelBtnSuppr = lFuncGetLabelBtnSuppr();
                  if (lLabelBtnSuppr !== lLabelBtnSuppr_bak) {
                    lLabelBtnSuppr_bak = lLabelBtnSuppr;
                    lJBtnSuppr
                      .get(0)
                      .setAttribute('aria-label', lLabelBtnSuppr);
                  }
                }
              },
              lElementChips,
              aContexteCourant,
            );
          }
        }
      }
      aOutils.addCommentaireDebug(lRacine, 'ie-chips');
      return { node: lRacine, avecCompileFils: true };
    });
  },
  fn: 'iehtml.chips.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreEvenementObjetSaisie = void 0;
    var EGenreEvenementObjetSaisie;
    (function (EGenreEvenementObjetSaisie) {
      EGenreEvenementObjetSaisie[
        (EGenreEvenementObjetSaisie['selection'] = 0)
      ] = 'selection';
      EGenreEvenementObjetSaisie[
        (EGenreEvenementObjetSaisie['deploiement'] = 1)
      ] = 'deploiement';
      EGenreEvenementObjetSaisie[
        (EGenreEvenementObjetSaisie['fermeture'] = 2)
      ] = 'fermeture';
    })(
      EGenreEvenementObjetSaisie ||
        (exports.EGenreEvenementObjetSaisie = EGenreEvenementObjetSaisie = {}),
    );
  },
  fn: 'enumere_evenementobjetsaisie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreSaisie = void 0;
    var EGenreSaisie;
    (function (EGenreSaisie) {
      EGenreSaisie[(EGenreSaisie['Combo'] = 2)] = 'Combo';
      EGenreSaisie[(EGenreSaisie['SaisieRecherche'] = 3)] = 'SaisieRecherche';
    })(EGenreSaisie || (exports.EGenreSaisie = EGenreSaisie = {}));
  },
  fn: 'enumere_saisie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetCelluleBouton = exports.EGenreBoutonCellule = void 0;
    require('Form-components.css');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_Event_1 = require('Enumere_Event');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetWAI_1 = require('ObjetWAI');
    const MethodesObjet_1 = require('MethodesObjet');
    var EGenreBoutonCellule;
    (function (EGenreBoutonCellule) {
      EGenreBoutonCellule[(EGenreBoutonCellule['Aucun'] = 0)] = 'Aucun';
      EGenreBoutonCellule[(EGenreBoutonCellule['Fleche'] = 1)] = 'Fleche';
      EGenreBoutonCellule[(EGenreBoutonCellule['Loupe'] = 2)] = 'Loupe';
      EGenreBoutonCellule[(EGenreBoutonCellule['Points'] = 3)] = 'Points';
      EGenreBoutonCellule[(EGenreBoutonCellule['Image'] = 4)] = 'Image';
    })(
      EGenreBoutonCellule ||
        (exports.EGenreBoutonCellule = EGenreBoutonCellule = {}),
    );
    class ObjetCelluleBouton extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.idZone = this.Nom + '_Zone';
        this.NomEdit = this.Nom + '_Edit';
        this.NomDescr = this.Nom + '_Descr';
        this.idTexte = this.NomEdit;
        this.idBouton = this.Nom + '_Bouton';
        this.libelle = '';
        this.options = {
          hauteur: 18,
          largeur: 80,
          genreBouton: EGenreBoutonCellule.Aucun,
          iconeGauche: '',
          avecBordures: true,
          avecCouleurFondBouton: true,
          avecFocusVisibleTexte: true,
          avecZoneSaisie: true,
          estSaisissable: false,
          selectionSaisieSurFocus: false,
          taillePolice: 10,
          classeZone: 'FondBlanc',
          classTexte: '',
          classBackground: '',
          styleZoneTexte: '',
          styleBouton: '',
          placeHolder: '',
          libelleHaut: '',
          withTabulation: true,
          roleWAI: ObjetWAI_1.EGenreRole.Button,
          labelWAI: '',
          popupWAI: '',
          labelledById: '',
          describedById: '',
          desactiverAideSaisie: false,
          ariaExpanded: false,
          required: false,
          titleForce: '',
          setValue: null,
          editAvecTrim: false,
          ariaControls: '',
          ariaDescription: '',
        };
        this.setOptionsObjetCelluleBouton({
          estSaisissable: true,
          genreBouton: EGenreBoutonCellule.Fleche,
        });
        this.IdPremierElement = this.NomEdit;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          ifLibelleHaut: function () {
            return !!aInstance.options.libelleHaut;
          },
          htmlLibelleHaut: function () {
            return aInstance.options.libelleHaut;
          },
          getClassZone: function () {
            return (
              'Texte' +
              aInstance.options.taillePolice +
              ' ' +
              aInstance.options.classeZone +
              ' CelluleBoutonZoneJQ' +
              (aInstance.Actif ? ' AvecMain' : '')
            );
          },
          getStyleConteneur: function () {
            return {
              width:
                aInstance.options.largeur &&
                aInstance.options.largeur === '100%'
                  ? '100%'
                  : '',
            };
          },
          getClass_ocb_cont() {
            return !aInstance.Actif ? 'ie-ripple-disabled' : '';
          },
          getStyleContenu: function () {
            if (!IE.estMobile) {
              return {
                width:
                  aInstance.options.largeur &&
                  aInstance.options.largeur !== '100%'
                    ? aInstance.options.largeur + 'px'
                    : '',
              };
            } else {
              return {};
            }
          },
          getAttrContenu() {
            const lAttr = {
              'aria-disabled': aInstance.Actif ? null : true,
              'aria-label':
                aInstance.options.labelWAI ||
                aInstance.options.titleForce ||
                null,
              'aria-labelledby': aInstance.options.labelledById || null,
              'aria-describedby': aInstance.options.describedById || null,
              'aria-controls': aInstance.options.ariaControls || null,
            };
            if (aInstance.options.roleWAI === ObjetWAI_1.EGenreRole.Combobox) {
              lAttr['aria-expanded'] = !!aInstance.options.ariaExpanded;
            }
            return lAttr;
          },
          getTitleDescriptionEdit: function () {
            return !aInstance.options.titleForce
              ? aInstance.estLibelleHTML
                ? ''
                : aInstance.libelle &&
                    typeof aInstance.options.largeur === 'number' &&
                    ObjetChaine_1.GChaine.getLongueurChaineDansDiv(
                      aInstance.libelle,
                      aInstance.options.taillePolice,
                      false,
                    ) >= aInstance.options.largeur
                  ? ObjetChaine_1.GChaine.enleverEntites(aInstance.libelle)
                  : ''
              : aInstance.options.titleForce;
          },
          edit: {
            getValue: function () {
              return aInstance.libelle;
            },
            setValue: function (aValue) {
              aInstance.libelle = aValue;
              if (aInstance.options.setValue) {
                aInstance.options.setValue(aValue, aInstance);
              }
            },
            getDisabled: function () {
              return !aInstance.Actif;
            },
            node: function () {
              if (!aInstance.options.estSaisissable) {
                $(this.node).on('focus', function () {
                  ObjetHtml_1.GHtml.setFocus(this, false);
                });
              }
              $(this.node).on('keyup blur focusout', (aEvent) => {
                aInstance._surEventEdit(aEvent);
              });
            },
            getNodeSansSaisie: function () {
              $(this.node).on(
                'mousedown click keyup blur focusout',
                (aEvent) => {
                  aInstance._surEventEdit(aEvent);
                },
              );
            },
            getClassEdit: function () {
              return (
                'CelluleBoutonNomEditJQ Texte' +
                aInstance.options.taillePolice +
                ' ' +
                (aInstance.options.classTexte || '') +
                (aInstance.Actif
                  ? aInstance.options.estSaisissable
                    ? ' AvecTexte'
                    : ' AvecMain'
                  : '') +
                ' ' +
                (aInstance.options.classBackground || '')
              );
            },
            getStylePourBoutonNonEditable: function () {
              return {
                'background-color': aInstance.Actif
                  ? ''
                  : GCouleur.nonEditable.fond,
              };
            },
          },
          getHtmlConsult: function () {
            if (aInstance.libelle || !aInstance.options.placeHolder) {
              return ObjetChaine_1.GChaine.avecEspaceSiVide(
                aInstance.estLibelleHTML
                  ? aInstance.libelle
                  : ObjetChaine_1.GChaine.insecable(aInstance.libelle),
              );
            } else if (aInstance.options.placeHolder) {
              if (typeof aInstance.options.placeHolder === 'string') {
                return IE.jsx.str(
                  'span',
                  { class: 'as-placeholder', 'aria-disabled': 'true' },
                  aInstance.options.placeHolder,
                );
              }
              if (aInstance.options.placeHolder.libelleHtml) {
                return ObjetChaine_1.GChaine.avecEspaceSiVide(
                  aInstance.options.placeHolder.libelleHtml,
                );
              }
            }
          },
          getNodeBouton: function () {
            $(this.node).on('mousedown click keyup', (aEvent) => {
              if (!aInstance.Actif) {
                return;
              }
              let lEvent = null;
              switch (aEvent.type) {
                case 'mousedown':
                  lEvent = Enumere_Event_1.EEvent.SurMouseDown;
                  break;
                case 'click':
                  lEvent = Enumere_Event_1.EEvent.SurClick;
                  break;
                case 'keyup':
                  lEvent = Enumere_Event_1.EEvent.SurKeyUp;
                  break;
              }
              if (lEvent !== null) {
                aInstance.callback.appel(lEvent, aEvent, false);
                if (
                  aInstance.Pere &&
                  aInstance.Pere instanceof ObjetIdentite_1.Identite &&
                  aInstance.Pere.$refreshSelf
                ) {
                  aInstance.Pere.$refreshSelf();
                }
              }
            });
          },
        });
      }
      setParametresPN(aAvecBouton, aLargeur, aHauteur, aClassTexte) {
        this.setOptionsObjetCelluleBouton({
          genreBouton: aAvecBouton
            ? EGenreBoutonCellule.Fleche
            : EGenreBoutonCellule.Aucun,
          largeur: aLargeur,
          hauteur: aHauteur ? aHauteur : 15,
          classTexte: aClassTexte ? aClassTexte : 'Gras',
          estSaisissable: false,
          avecZoneSaisie: false,
        });
      }
      setOptionsObjetCelluleBouton(aOptions) {
        $.extend(this.options, aOptions);
        this.avecBouton =
          this.options.genreBouton !== EGenreBoutonCellule.Aucun;
        this.$refreshSelf();
      }
      construireAffichage() {
        const H = [];
        let lClasseBtn = '';
        switch (this.options.genreBouton) {
          case EGenreBoutonCellule.Fleche:
            lClasseBtn = 'as-select ';
            break;
          case EGenreBoutonCellule.Loupe:
            lClasseBtn = 'as-search';
            break;
          case EGenreBoutonCellule.Points:
            lClasseBtn = 'as-multi-choix';
            break;
          case EGenreBoutonCellule.Image:
            lClasseBtn = 'as-date-picker';
            break;
        }
        H.push(
          '<div ie-if="ifLibelleHaut" ie-html="htmlLibelleHaut" class="LibelleHaut"></div>',
        );
        H.push(
          '<div class="input-wrapper" ie-style="getStyleConteneur">',
          '<div class="ocb_cont as-input ',
          lClasseBtn,
          !this.options.avecZoneSaisie ? ' ie-ripple' : '',
          '" ie-class="getClass_ocb_cont">',
        );
        if (this.options.iconeGauche) {
          H.push(
            IE.jsx.str('i', {
              class: ['ocb_icone_gauche', this.options.iconeGauche],
              'ie-node': 'edit.getNodeSansSaisie',
              'aria-hidden': 'true',
            }),
          );
        }
        const lStrAttrsWAI = {
          role: ObjetWAI_1.GObjetWAI.strRole(this.options.roleWAI),
          'aria-haspopup': this.options.popupWAI || false,
          'aria-required': this.options.required ? 'true' : false,
          'aria-description': this.options.ariaDescription || false,
          'aria-expanded':
            this.options.roleWAI === ObjetWAI_1.EGenreRole.Combobox
              ? 'false'
              : false,
        };
        if (this.options.avecZoneSaisie) {
          H.push(
            IE.jsx.str(
              'input',
              Object.assign(
                {
                  type: 'text',
                  'ie-model': 'edit',
                  'ie-trim': !!this.options.editAvecTrim,
                  id: this.NomEdit,
                  'ie-style': 'getStyleContenu',
                  'ie-attr': 'getAttrContenu',
                  autocomplete: this.options.desactiverAideSaisie
                    ? 'off'
                    : false,
                  autocorrect: this.options.desactiverAideSaisie
                    ? 'off'
                    : false,
                  autocapitalize: this.options.desactiverAideSaisie
                    ? 'off'
                    : false,
                  spellcheck: this.options.desactiverAideSaisie
                    ? 'false'
                    : false,
                  'ie-title': 'getTitleDescriptionEdit',
                  'ie-selecttextfocus': !!this.options.selectionSaisieSurFocus,
                  readonly: !this.options.estSaisissable,
                  'aria-readonly': this.options.estSaisissable ? false : 'true',
                  'ie-ellipsis': !this.options.estSaisissable,
                },
                lStrAttrsWAI,
                {
                  'aria-autocomplete': 'list',
                  placeholder:
                    this.options.placeHolder &&
                    MethodesObjet_1.MethodesObjet.isString(
                      this.options.placeHolder,
                    )
                      ? this.options.placeHolder
                      : false,
                },
              ),
            ),
          );
        } else {
          H.push(
            IE.jsx.str(
              'div',
              Object.assign(
                {
                  class: 'ocb-libelle',
                  tabindex: this.options.withTabulation ? '0' : '',
                  id: this.idTexte,
                  'ie-html': 'getHtmlConsult',
                  'ie-style': 'getStyleContenu',
                  'ie-attr': 'getAttrContenu',
                  'ie-node': 'edit.getNodeSansSaisie',
                  'ie-ellipsis': !this.options.titleForce,
                  title: this.options.titleForce,
                },
                lStrAttrsWAI,
                {
                  'aria-live':
                    this.options.roleWAI === ObjetWAI_1.EGenreRole.Combobox
                      ? 'polite'
                      : false,
                  'aria-relevant':
                    this.options.roleWAI === ObjetWAI_1.EGenreRole.Combobox
                      ? 'text'
                      : false,
                },
              ),
            ),
          );
        }
        if (this.avecBouton) {
          H.push(
            IE.jsx.str('div', {
              class: 'ocb_bouton',
              'ie-node': 'getNodeBouton',
              role: 'presentation',
            }),
          );
        }
        H.push('</div>');
        H.push('</div>');
        return H.join('');
      }
      recupererDonnees() {
        if (!ObjetHtml_1.GHtml.elementExiste(this.idZone)) {
          return;
        }
        let lEventMap = {};
        if (this.options.avecFocusVisibleTexte) {
          lEventMap = {
            focusin: function () {
              $(this)
                .find('.CelluleBoutonNomEditJQ')
                .css('outline', GCouleur.texte + ' dotted 1px');
            },
            focusout: function () {
              $(this).find('.CelluleBoutonNomEditJQ').css('outline', 'none');
            },
          };
        }
        $('#' + this.Nom.escapeJQ())
          .on(lEventMap, { instance: this })
          .data('couleurFocus', GCouleur.texte);
      }
      setActif(AActif) {
        super.setActif(AActif);
        this.$refreshSelf();
      }
      setLibelle(aLibelle) {
        this.libelle = aLibelle;
        this.estLibelleHTML = false;
        this.$refreshSelf();
      }
      setLibelleHtml(aLibelleHtml) {
        if (this.options.avecZoneSaisie) {
          return;
        }
        this.estLibelleHTML = true;
        this.libelle = aLibelleHtml;
        this.$refreshSelf();
      }
      getLibelle() {
        return this.libelle;
      }
      setLargeur(aLargeur) {
        this.setOptionsObjetCelluleBouton({
          largeur: aLargeur ? aLargeur : undefined,
        });
      }
      setTitle(aTitle) {
        this.setOptionsObjetCelluleBouton({ titleForce: aTitle });
      }
      setFocus() {
        ObjetHtml_1.GHtml.setFocus(this.NomEdit);
      }
      setAvecBouton(aAvecBouton) {
        if (this.avecBouton === aAvecBouton) {
          return;
        }
        this.avecBouton = aAvecBouton;
        this.$refreshSelf();
      }
      _surEventEdit(aEvent) {
        if (!this.Actif) {
          return;
        }
        let lEvent = null;
        switch (aEvent.type) {
          case 'keyup':
            lEvent = Enumere_Event_1.EEvent.SurKeyUp;
            break;
          case 'blur':
            lEvent = Enumere_Event_1.EEvent.SurBlur;
            break;
          case 'focusout':
            lEvent = Enumere_Event_1.EEvent.SurFocusOut;
            break;
          case 'mousedown':
            lEvent = Enumere_Event_1.EEvent.SurMouseDown;
            break;
          case 'click':
            lEvent = Enumere_Event_1.EEvent.SurClick;
            break;
          default:
        }
        if (lEvent) {
          this.callback.appel(lEvent, aEvent, true);
          if (
            this.Pere &&
            this.Pere instanceof ObjetIdentite_1.Identite &&
            this.Pere.$refreshSelf
          ) {
            this.Pere.$refreshSelf();
          }
        }
      }
    }
    exports.ObjetCelluleBouton = ObjetCelluleBouton;
  },
  fn: 'objetcellulebouton.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeThemeBouton = void 0;
    var TypeThemeBouton;
    (function (TypeThemeBouton) {
      TypeThemeBouton['primaire'] = 'themeBoutonPrimaire';
      TypeThemeBouton['secondaire'] = 'themeBoutonSecondaire';
      TypeThemeBouton['neutre'] = 'themeBoutonNeutre';
    })(TypeThemeBouton || (exports.TypeThemeBouton = TypeThemeBouton = {}));
  },
  fn: 'type_themebouton.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetSaisie = void 0;
    const GUID_1 = require('GUID');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetStyle_1 = require('ObjetStyle');
    const ControleSaisieEvenement_1 = require('ControleSaisieEvenement');
    const Enumere_EvenementObjetSaisie_1 = require('Enumere_EvenementObjetSaisie');
    const Enumere_Event_1 = require('Enumere_Event');
    const Enumere_Saisie_1 = require('Enumere_Saisie');
    const ObjetCelluleBouton_1 = require('ObjetCelluleBouton');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetWAI_1 = require('ObjetWAI');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const ToucheClavier_1 = require('ToucheClavier');
    const tag_1 = require('tag');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const IEHtml = require('IEHtml');
    const Invocateur_1 = require('Invocateur');
    const jsx_1 = require('jsx');
    require('ObjetSaisie.css');
    class ObjetSaisie extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.Survolee = -1;
        this.Selection = -1;
        this.Timer = null;
        this._listeSelections = new ObjetListeElements_1.ObjetListeElements();
        this.modeTactile = false;
        this.NomListe = this.Nom + '_Liste';
        this.nomListeConteneur = this.Nom + '_Liste_cont';
        this.idContenu = this.Nom + '_Contenu';
        this.idContenuScroll = this.Nom + '_ContenuScroll';
        this.idWrapperBouton = this.Nom + '_wrapperbouton';
        this.NomLabel = this.Nom + '_Label';
        this.idBtnValidation = this.Nom + '_btnValidation';
        this.idBloc = this.Nom + '_bloc';
        this.idLibelleHaut = this.Nom + '_lib_haut';
        this.cache = { editionEnCours: false };
        this.init();
        Invocateur_1.Invocateur.abonner(
          `surAffichageFenetre ${Invocateur_1.ObjetInvocateur.events.resizeNavigateur}`,
          () => {
            if (this.listeDeroulee && this._estOuvertureModale()) {
              this.fermerListe(false);
            }
          },
          this,
        );
      }
      init() {
        this._initParseur();
        this.bouton = new ObjetCelluleBouton_1.ObjetCelluleBouton(
          this.Nom + '.bouton',
          null,
          this,
          this._surEvenementBouton.bind(this),
        );
        this.IdPremierElement = this.bouton.NomEdit;
        this.initialiserOptionsObjetSaisie();
        this.decalageTopOuvertureInverse = 15;
      }
      detruireInstances() {
        $('#' + this.idContenu.escapeJQ()).stop(true, true);
        clearTimeout(this.cache.timerMAJ);
        clearTimeout(this._timerInitParseur);
        clearTimeout(this._timerEditionRecherche);
        $(`#${this.nomListeConteneur.escapeJQ()}`).remove();
      }
      static calculTailleMaxLibelle(aLibelle, aEstGras) {
        return (
          Math.ceil(
            ObjetChaine_1.GChaine.getLongueurChaineDansDiv(
              aLibelle,
              '1.2rem',
              aEstGras,
            ),
          ) +
          4 +
          1
        );
      }
      initialiserOptionsObjetSaisie() {
        this._options = {
          mode: Enumere_Saisie_1.EGenreSaisie.Combo,
          multiSelection: false,
          avecElementObligatoire: false,
          avecDesignMobile: false,
          avecOuvertureDeroulantModale: null,
          longueur: 125,
          hauteur: null,
          hauteurLigneDefault: 18,
          hauteurLigneTactile: 36,
          largeurListe: null,
          estLargeurAuto: false,
          getTailleElementlargeurAuto: function (aElement, aEstGras) {
            return ObjetSaisie.calculTailleMaxLibelle(
              aElement.getLibelle(),
              aEstGras,
            );
          },
          largeurAutoMin: 40,
          largeurAutoMax: 500,
          avecBouton: true,
          iconeGauche: '',
          deroulerListeSeulementSiPlusieursElements: true,
          initAutoSelectionAvecUnElement: true,
          controlerNbrElements: false,
          avecTriListeElements: false,
          nbrLignes: 15,
          classTexte: '',
          classBackground: null,
          placeHolder: '',
          desactiverAideSaisie: false,
          couleurFondDeroulant: null,
          celluleAvecTexteHtml: false,
          getContenuCellule: null,
          texteEdit: '',
          couleurTexteEdit: null,
          styleTexteEdit: null,
          classTexteEdit: null,
          largeurTexteEdit: null,
          getClassElement: null,
          getContenuElement: null,
          getEstElementNonSelectionnable: null,
          getElementSelectionnableParPrecSuiv: null,
          getEnteteListe: null,
          getPiedListe: null,
          libelleHaut: '',
          avecEventSurFermetureListe: false,
          avecFondSelectionSurSurvol: true,
          avecGrasSurSurvol: false,
          modifierContenuCelluleSurSelection: true,
          avecReservationPlaceBarreScroll: false,
          desactiverScrollInfini: false,
          nbBlocsScrollInfini: 2,
          roleWAI: ObjetWAI_1.EGenreRole.Combobox,
          labelWAICellule: '',
          labelledById: '',
          describedById: '',
          required: false,
          avecBoutonsPrecSuiv: false,
          avecBoutonsPrecSuivVisiblesInactifs: true,
          avecBoutonsPrecSuiv_boucle: false,
          optionsBouton: {},
          surValidation: null,
          getInfosElementCB: null,
          getLibelleCelluleMultiSelection: function (aListeSelections) {
            return aListeSelections
              ? aListeSelections.getTableauLibelles().join(', ')
              : '';
          },
          getLibelleBoutonValider: function (aNombreSelectionnes, aNombre) {
            return aNombre > 0
              ? ObjetChaine_1.GChaine.format('%s (%d / %d)', [
                  ObjetTraduction_1.GTraductions.getValeur('Valider'),
                  aNombreSelectionnes,
                  aNombre,
                ])
              : ObjetTraduction_1.GTraductions.getValeur('Valider');
          },
          surEditionRecherche: null,
          nbCarMinRecherche: 2,
          delaiSurEditionRecherche: 500,
          rechercheTout: ['', '*'],
          avecSurlignageSuggestion: true,
          couleurSurlignageSuggestion: GCouleur.surlignageTexte,
          avecSurlignageElement: null,
          callbackToutCalcule: null,
          dureeAnimationDeploiement: 150,
        };
      }
      setOptionsObjetSaisie(aOptions) {
        $.extend(this._options, aOptions);
        const lEstListeOuCombo = [Enumere_Saisie_1.EGenreSaisie.Combo].includes(
          this._options.mode,
        );
        const lAvecSaisieRechercheDynamique =
          this._avecSaisieRechercheDynamique();
        const lLabelledBy =
          this._options.labelledById ||
          (this._options.texteEdit ? this.NomLabel : undefined) ||
          (this._options.libelleHaut ? this.idLibelleHaut : undefined);
        const lOptionsBouton = $.extend(
          {
            estSaisissable: !lEstListeOuCombo,
            avecZoneSaisie: !lEstListeOuCombo,
            genreBouton: this._options.avecBouton
              ? lEstListeOuCombo
                ? ObjetCelluleBouton_1.EGenreBoutonCellule.Fleche
                : ObjetCelluleBouton_1.EGenreBoutonCellule.Loupe
              : ObjetCelluleBouton_1.EGenreBoutonCellule.Aucun,
            largeur:
              this._options.avecDesignMobile && IE.estMobile
                ? '100%'
                : this._options.longueur,
            hauteur: this._options.hauteur || undefined,
            iconeGauche: this._options.avecBoutonsPrecSuiv
              ? ''
              : this._options.iconeGauche,
            classTexte: this._options.classTexte,
            classBackground: this._options.classBackground,
            placeHolder: this._options.placeHolder,
            desactiverAideSaisie:
              this._options.desactiverAideSaisie ||
              this._options.mode ===
                Enumere_Saisie_1.EGenreSaisie.SaisieRecherche,
            roleWAI: this._options.roleWAI || undefined,
            labelWAI: this._options.labelWAICellule || undefined,
            popupWAI: 'listbox',
            labelledById: lLabelledBy,
            describedById: this._options.describedById || '',
            required: this._options.required || undefined,
            setValue:
              this._options.mode ===
              Enumere_Saisie_1.EGenreSaisie.SaisieRecherche
                ? this._modificationSaisieBoutonRecherche.bind(this)
                : null,
            editAvecTrim: lAvecSaisieRechercheDynamique,
            selectionSaisieSurFocus: lAvecSaisieRechercheDynamique,
          },
          aOptions.optionsBouton,
        );
        this.bouton.setOptionsObjetCelluleBouton(lOptionsBouton);
        this.$refreshSelf();
        return this;
      }
      chercherIndiceSelectionSelonSens(
        aIndice,
        aPrecedent,
        aEnBoucle,
        aMethodeSelec,
      ) {
        if (!this.ListeElements || !this.ListeElements.count) {
          return -1;
        }
        let lIndice = aIndice;
        const lNbr = this.ListeElements.count();
        if (lIndice !== null && lIndice !== undefined) {
          while (
            lIndice < lNbr &&
            lIndice >= 0 &&
            (!this._estSelectionnable(this.ListeElements.get(lIndice)) ||
              (aMethodeSelec &&
                aMethodeSelec({ element: this.ListeElements.get(lIndice) }) !==
                  true))
          ) {
            lIndice += aPrecedent ? -1 : 1;
          }
        } else {
          lIndice = -1;
        }
        if (lIndice >= lNbr) {
          lIndice = -1;
        }
        if (aEnBoucle && lIndice === -1) {
          return this.chercherIndiceSelectionSelonSens(
            aPrecedent ? lNbr - 1 : 0,
            aPrecedent,
            false,
            aMethodeSelec,
          );
        }
        return lIndice;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          ifLibelleHaut: function () {
            return !!aInstance._options.libelleHaut;
          },
          htmlLibelleHaut: function () {
            return aInstance._options.libelleHaut;
          },
          listeEventOut: function () {
            return {
              nodesExclus: [
                ObjetHtml_1.GHtml.getElement(aInstance.bouton.getNom()),
              ],
              callback: function () {
                if (aInstance.listeDeroulee && aInstance.activerEventOut) {
                  aInstance._declencherFermetureListe();
                }
              },
            };
          },
          nodeOverlay() {
            $(this.node).on({
              click() {
                aInstance._declencherFermetureListe(true);
              },
            });
          },
          btnSuivPrec: {
            event: function (aPrecedent) {
              aInstance._surPrecedentSuivant(aPrecedent);
            },
            getDisabled: function (aPrecedent) {
              return !aInstance._boutonPrecSuivOK(aPrecedent);
            },
            getStyle: function (aPrecedent) {
              if (aInstance._options.avecBoutonsPrecSuivVisiblesInactifs) {
                return;
              }
              return {
                visibility: aInstance._boutonPrecSuivOK(aPrecedent)
                  ? ''
                  : 'hidden',
              };
            },
          },
          getNodeBouton() {
            $(this.node).on({
              swipeleft: function () {
                if (
                  aInstance._options.avecBoutonsPrecSuiv &&
                  aInstance._boutonPrecSuivOK(false)
                ) {
                  aInstance._surPrecedentSuivant(false);
                }
              },
              swiperight: function () {
                if (
                  aInstance._options.avecBoutonsPrecSuiv &&
                  aInstance._boutonPrecSuivOK(true)
                ) {
                  aInstance._surPrecedentSuivant(true);
                }
              },
            });
          },
          getClassesDynamiques: function () {
            const lClasses = [];
            if (!aInstance.getActif()) {
              lClasses.push('input-wrapper-disabled');
            }
            return lClasses.join(' ');
          },
          getNodeContenu: function () {
            $(this.node).on({
              keydown(aEvent) {
                if (
                  !aEvent.altKey &&
                  (aEvent.which === ToucheClavier_1.ToucheClavier.FlecheBas ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.FlecheHaut)
                ) {
                  aEvent.preventDefault();
                }
              },
              wheel(aEvent) {
                if (this.scrollHeight > this.clientHeight) {
                  aEvent.originalEvent.__wheelSurCombo__ = true;
                }
              },
            });
            if (aInstance.cache.scrollInfiniActif) {
              $(this.node).on('scroll', function () {
                aInstance._majBlocsDeTop(this.scrollTop);
              });
            }
          },
          getAttrWAIOption: function (aLigne) {
            const lResult = {};
            if (aInstance._options.multiSelection) {
              const lInfos = aInstance._infosElementsCbs[aLigne];
              lResult[
                ObjetWAI_1.GObjetWAI.getAttribut(
                  ObjetWAI_1.EGenreAttribut.selected,
                )
              ] =
                '' +
                !!(
                  (lInfos === null || lInfos === void 0
                    ? void 0
                    : lInfos.avecCB) &&
                  (lInfos === null || lInfos === void 0
                    ? void 0
                    : lInfos.selectionne)
                );
            } else {
              lResult[
                ObjetWAI_1.GObjetWAI.getAttribut(
                  ObjetWAI_1.EGenreAttribut.selected,
                )
              ] = '' + (aInstance.Selection === aLigne);
            }
            return lResult;
          },
          cbElement: {
            getValue: function (aIndice) {
              return aInstance.getValueElementCB(aIndice);
            },
            setValue: function (aIndice, aValue) {
              aInstance._setValueElementCB(aIndice, aValue);
            },
            getIndeterminate: function (aIndice) {
              const lInfos = aInstance._infosElementsCbs
                ? aInstance._infosElementsCbs[aIndice]
                : null;
              if (lInfos) {
                const lSelection = aInstance._getSelectionElement(
                  lInfos,
                  aIndice,
                );
                return (
                  lSelection.nbFilsSelectionne > 0 &&
                  lSelection.nbFilsSelectionne < lSelection.nbFils
                );
              }
              return false;
            },
            getDisabled: function (aIndice) {
              const lInfos = aInstance._infosElementsCbs
                ? aInstance._infosElementsCbs[aIndice]
                : null;
              if (lInfos) {
                return lInfos.nonEditable;
              }
              return false;
            },
          },
          getNodeCBMulti: function () {
            $(this.node).on({
              'mouseenter mouseleave': function (event) {
                if (event.type === 'mouseenter') {
                  aInstance._selectionLigne(aInstance.Survolee, false);
                  aInstance.Survolee = -1;
                }
              },
            });
          },
          btnValidationCB: {
            event: function (aEvent) {
              aEvent.stopPropagation();
              aInstance.surValidation(true, -1, {
                validationMultiSelection: true,
              });
            },
            getDisabled: function () {
              let lDisabled = false;
              if (aInstance._options.avecElementObligatoire) {
                let lNbSelectionnes = 0;
                aInstance.ListeElements.parcourir((aElement, aIndex) => {
                  const lInfosCBs = aInstance._infosElementsCbs
                    ? aInstance._infosElementsCbs[aIndex]
                    : null;
                  if (
                    lInfosCBs &&
                    !lInfosCBs.estCumul &&
                    aInstance._estSelectionnable(aElement)
                  ) {
                    if (lInfosCBs.selectionne) {
                      lNbSelectionnes += 1;
                    }
                  }
                });
                lDisabled = lNbSelectionnes === 0;
              }
              return lDisabled;
            },
            getNode: function () {
              $(this.node).on({
                mouseover: function () {
                  aInstance._survolBoutonMultiSelection();
                },
              });
            },
            getHtml: function () {
              let lNb = 0;
              let lNbSelectionnes = 0;
              if (aInstance.ListeElements) {
                aInstance.ListeElements.parcourir((aElement, aIndex) => {
                  const lInfosCBs = aInstance._infosElementsCbs
                    ? aInstance._infosElementsCbs[aIndex]
                    : null;
                  if (
                    lInfosCBs &&
                    !lInfosCBs.estCumul &&
                    aInstance._estSelectionnable(aElement)
                  ) {
                    lNb += 1;
                    if (lInfosCBs.selectionne) {
                      lNbSelectionnes += 1;
                    }
                  }
                });
              }
              return aInstance._options.getLibelleBoutonValider(
                lNbSelectionnes,
                lNb,
              );
            },
          },
          getNodeListeVide: function () {
            $(this.node).eventValidation(() => {
              aInstance.fermerListe();
            });
          },
        });
      }
      setParametres(
        AMode,
        ALongueur,
        AAvecBouton,
        aAvecStyleSite,
        aControlerNbrElements,
        aHauteur,
        aClassTexte,
      ) {
        this.setOptionsObjetSaisie({
          mode: AMode,
          longueur:
            ALongueur === null || ALongueur === undefined
              ? undefined
              : ALongueur,
          hauteur: aHauteur,
          avecBouton:
            AAvecBouton === null || AAvecBouton === undefined
              ? undefined
              : AAvecBouton,
          controlerNbrElements: aControlerNbrElements,
          classTexte: aClassTexte,
        });
        IE.log.addLog(
          'ObjetSaisie.setParametres deprecated!',
          null,
          IE.log.genre.Deprecated,
        );
      }
      setLabel(aTexte, aClass, aStyle) {
        this._options.texteEdit = aTexte;
        $.extend(this._options, {
          classTexteEdit: aClass ? aClass : undefined,
          styleTexteEdit: aStyle ? aStyle : undefined,
        });
        const lElementLabel = ObjetHtml_1.GHtml.getElement(this.NomLabel);
        if (ObjetHtml_1.GHtml.estElement(lElementLabel)) {
          ObjetHtml_1.GHtml.setHtml(
            lElementLabel,
            ObjetChaine_1.GChaine.insecable(this._options.texteEdit) + '&nbsp;',
          );
          if (this._options.classTexteEdit) {
            ObjetHtml_1.GHtml.setClass(
              lElementLabel,
              this._options.classTexteEdit,
            );
          }
          if (this._options.styleTexteEdit) {
            ObjetStyle_1.GStyle.setStyle(
              lElementLabel,
              this._options.styleTexteEdit,
            );
          }
        }
      }
      recupererDonnees() {
        this.setOptionsObjetSaisie({});
        this.bouton.initialiser();
      }
      construireAffichage() {
        $('#' + this.idContenu.escapeJQ()).stop(true, true);
        const lOuvertureModale = this._estOuvertureModale();
        let H = '';
        const LFor =
          this._options.labelWAICellule ||
          [Enumere_Saisie_1.EGenreSaisie.Combo].includes(this._options.mode)
            ? ''
            : 'for="' + this.bouton.NomEdit + '"';
        const lDesignMobile = this._options.avecDesignMobile && IE.estMobile;
        H += `<label class="ie-titre-petit bloc-contain m-bottom" ie-if="ifLibelleHaut" ie-html="htmlLibelleHaut" id="${this.idLibelleHaut}"></label>`;
        H +=
          '<div class="input-wrapper ObjetSaisie' +
          (this._options.longueur === '100%' || lDesignMobile
            ? ' ObjetSaisie_100P'
            : '') +
          (lDesignMobile ? ' design-mobile' : '') +
          (lOuvertureModale ? ' open-up' : '') +
          '" ie-class="getClassesDynamiques" ' +
          ObjetWAI_1.GObjetWAI.composeRole(ObjetWAI_1.EGenreRole.Presentation) +
          ' id="' +
          this.idWrapperBouton +
          '">';
        if (this._options.texteEdit && this._options.texteEdit.trim()) {
          if (this._options.largeurTexteEdit) {
            H +=
              '<div style="' +
              ObjetStyle_1.GStyle.composeWidth(this._options.largeurTexteEdit) +
              '">';
          }
          const lStyleTextEdit = this._options.couleurTexteEdit
            ? 'style="' +
              ObjetStyle_1.GStyle.composeCouleurTexte(
                this._options.couleurTexteEdit,
              ) +
              '"'
            : this._options.styleTexteEdit
              ? 'style="' + this._options.styleTexteEdit + '"'
              : '';
          H +=
            '<label id="' +
            this.NomLabel +
            '" class="' +
            (this._options.classTexteEdit !== null &&
            this._options.classTexteEdit !== undefined
              ? this._options.classTexteEdit
              : ' label-default') +
            '" ' +
            LFor +
            ' ' +
            lStyleTextEdit +
            '>' +
            ObjetChaine_1.GChaine.insecable(this._options.texteEdit) +
            '&nbsp;</label>';
          if (this._options.largeurTexteEdit) {
            H += '</div>';
          }
        }
        if (this._options.avecBoutonsPrecSuiv) {
          H += IE.jsx.str('ie-btnicon', {
            class: [
              'icon_angle_left',
              lDesignMobile ? '' : 'icon btnImageIcon',
            ],
            'ie-model': 'btnSuivPrec(true)',
            'ie-style': 'getStyle',
            title: ObjetTraduction_1.GTraductions.getValeur('Precedent'),
            'aria-label':
              ObjetTraduction_1.GTraductions.getValeur('Precedent') +
              (this._options.labelWAICellule
                ? '  ' + this._options.labelWAICellule
                : ''),
          });
        }
        H += '<div class="ObjetSaisie_cont">';
        H +=
          '<div id="' +
          this.bouton.getNom() +
          '" ie-node="getNodeBouton"' +
          (this._options.avecBoutonsPrecSuiv && IE.estMobile
            ? ' class="text-center" '
            : '') +
          '></div>';
        const lHtmlList = (0, tag_1.tag)('div', {
          id: this.NomListe,
          'ie-eventout': lOuvertureModale ? false : 'listeEventOut',
          class: [
            'deroulant-conteneur-show-hide',
            IE.estMobile || GNavigateur.isTactile ? ' is-tactile' : '',
          ],
          style: lOuvertureModale ? false : 'display: none;',
          tabindex: -1,
        });
        if (lOuvertureModale) {
          let lZIndex = 2000;
          $(`#${this.nomListeConteneur.escapeJQ()}`).remove();
          IEHtml.injectHTMLParams({
            element: IEZoneFenetre_1.ZoneFenetre.getElementZoneFenetre(),
            html: (0, tag_1.tag)(
              'div',
              {
                id: this.nomListeConteneur,
                class: 'ObjetSaisie ObjetSaisie-modal',
                style: `z-index:${lZIndex}`,
              },
              lHtmlList +
                (0, tag_1.tag)('div', {
                  class: 'overlay',
                  'ie-node': 'nodeOverlay',
                }),
            ),
            controleur: this.controleur,
          });
        } else {
          H += lHtmlList;
        }
        H += '</div>';
        if (this._options.avecBoutonsPrecSuiv) {
          H += IE.jsx.str('ie-btnicon', {
            class: [
              'icon_angle_right',
              lOuvertureModale ? '' : 'icon btnImageIcon',
            ],
            'ie-model': 'btnSuivPrec(false)',
            'ie-style': 'getStyle',
            title: ObjetTraduction_1.GTraductions.getValeur('Suivant'),
            'aria-label':
              ObjetTraduction_1.GTraductions.getValeur('Suivant') +
              (this._options.labelWAICellule
                ? '  ' + this._options.labelWAICellule
                : ''),
          });
        }
        H += '</div>';
        H += '</div>';
        return H;
      }
      setSelection(ASelection) {
        const lIndice = this.chercherIndiceSelectionSelonSens(
          ASelection,
          false,
        );
        if (lIndice >= 0) {
          if (this._options.multiSelection) {
            this._selectionnerUnElementEnMultiSelection(lIndice);
          }
          this.surValidation(false, lIndice);
        }
      }
      surSelection(aParams) {
        if (
          (this.getNbElementsVisible() > 0 ||
            !this._options.deroulerListeSeulementSiPlusieursElements) &&
          !this.actualiserListe
        ) {
          this._deroulerListe();
        } else {
          this.surValidation(false, undefined, aParams);
        }
      }
      deroulerListe() {
        this._deroulerListe();
      }
      surValidation(aInteractionUtilisateur, ASelection, aParams) {
        this.InteractionUtilisateur = aInteractionUtilisateur;
        this.cache.surDemandeSaisieRechercheTout = false;
        const lParams = Object.assign(
          {
            saisieRecherche: false,
            validationMultiSelection: false,
            surBoutonCellule: false,
          },
          aParams,
        );
        const lEstMultiSelection = this._options.multiSelection;
        if (
          !this.ListeElements ||
          !this.ListeElements.get(ASelection) ||
          this._estSelectionnable(this.ListeElements.get(ASelection))
        ) {
          this.Selection = ASelection;
          this.fermerListe(true);
          this.$refreshSelf();
          clearTimeout(this._timerEditionRecherche);
          let LValeur;
          const lEditionEnCours = this.cache.editionEnCours;
          this.cache.editionEnCours = false;
          if (lEstMultiSelection) {
            if (!this._listeSelections) {
              this._listeSelections =
                new ObjetListeElements_1.ObjetListeElements();
            }
            this._listeSelections.vider();
            const lListeIndices = [];
            if (this.ListeElements) {
              this.ListeElements.parcourir((D, aIndex) => {
                const lInfos = this._infosElementsCbs
                  ? this._infosElementsCbs[aIndex]
                  : null;
                if (lInfos && ASelection === aIndex && lInfos.estCumul) {
                  this.Selection = -1;
                }
                if (lInfos && !lInfos.estCumul && lInfos.selectionne) {
                  this._listeSelections.addElement(D);
                  lListeIndices.push(aIndex);
                }
              });
            }
            let lMAJContenu =
              lParams.validationMultiSelection ||
              this.Selection >= 0 ||
              this._listeSelections.count() > 0;
            if (
              lParams.surBoutonCellule &&
              this._options.mode ===
                Enumere_Saisie_1.EGenreSaisie.SaisieRecherche &&
              !lEditionEnCours
            ) {
              LValeur = '';
              lMAJContenu = false;
              this.cache.surDemandeSaisieRechercheTout = true;
            } else if (
              lParams.saisieRecherche ||
              lEditionEnCours ||
              (this._options.mode ===
                Enumere_Saisie_1.EGenreSaisie.SaisieRecherche &&
                this._listeSelections.count() === 0 &&
                !lParams.validationMultiSelection)
            ) {
              LValeur = this.getContenu();
            } else {
              LValeur = this._options.getLibelleCelluleMultiSelection(
                this._listeSelections,
              );
            }
            if (
              this._options.modifierContenuCelluleSurSelection &&
              lMAJContenu
            ) {
              this.setContenu(LValeur);
            }
            const lIdDescendant =
              this.Nom + '_' + lListeIndices.join(',' + this.Nom + '_');
            $(
              '#' +
                this.idContenuScroll.escapeJQ() +
                ', #' +
                this.bouton.NomEdit.escapeJQ(),
            ).attr(
              ObjetWAI_1.GObjetWAI.getAttribut(
                ObjetWAI_1.EGenreAttribut.activedescendant,
              ),
              ObjetHtml_1.GHtml.getElement(lIdDescendant)
                ? lIdDescendant
                : null,
            );
          } else if (
            ASelection >= -1 &&
            !lParams.validationMultiSelection &&
            !lParams.saisieRecherche
          ) {
            const lElement =
              ASelection >= 0 ? this.ListeElements.get(this.Selection) : null;
            LValeur = lElement ? lElement.getLibelle() : '';
            if (this._options.modifierContenuCelluleSurSelection) {
              if (this._options.getContenuCellule) {
                this._appliquerGetContenuCellule(lElement);
              } else if (
                this._options.celluleAvecTexteHtml &&
                lElement &&
                lElement.libelleHtml
              ) {
                this.bouton.setLibelleHtml(lElement.libelleHtml);
              } else {
                this.setContenu(LValeur);
              }
              const lIdDescendant = this.Nom + '_' + ASelection;
              $(
                '#' +
                  this.idContenuScroll.escapeJQ() +
                  ', #' +
                  this.bouton.NomEdit.escapeJQ(),
              ).attr(
                ObjetWAI_1.GObjetWAI.getAttribut(
                  ObjetWAI_1.EGenreAttribut.activedescendant,
                ),
                ObjetHtml_1.GHtml.getElement(lIdDescendant)
                  ? lIdDescendant
                  : null,
              );
            }
          } else {
            if (
              lParams.surBoutonCellule &&
              this._options.mode ===
                Enumere_Saisie_1.EGenreSaisie.SaisieRecherche &&
              !lEditionEnCours
            ) {
              LValeur = '';
              this.cache.surDemandeSaisieRechercheTout = true;
            } else {
              LValeur = [Enumere_Saisie_1.EGenreSaisie.Combo].includes(
                this._options.mode,
              )
                ? '*'
                : this.getContenu();
            }
          }
          if (
            (ASelection >= 0 || lEstMultiSelection) &&
            this.ControleNavigation &&
            ControleSaisieEvenement_1.ControleSaisieEvenement
          ) {
            (0, ControleSaisieEvenement_1.ControleSaisieEvenement)(
              this._retourSurNavigation.bind(
                this,
                Object.assign(
                  { valeur: LValeur, retourSaisieAnnule: true },
                  lParams,
                ),
              ),
            );
          } else {
            this._retourSurNavigation(
              Object.assign(
                { valeur: LValeur, retourSaisieAnnule: false },
                lParams,
              ),
            );
          }
        }
      }
      _remplirListe() {
        const lHeightScroll = this.cache.heightScroll;
        this.cache = {
          scrollInfiniActif: false,
          blocs: [],
          nbVisibles: 0,
          toutCalcule: false,
          heightScroll: lHeightScroll,
          largeurCellule:
            this._options.avecDesignMobile && IE.estMobile
              ? '100%'
              : this._options.longueur,
          editionEnCours: false,
          surDemandeSaisieRechercheTout:
            this.cache.surDemandeSaisieRechercheTout,
        };
        if (!this.ListeElements) {
          if (this._options.multiSelection) {
            this._infosElementsCbs = {};
          }
          return;
        }
        this._trierElements();
        let lBlocs = { debut: 0, fin: 0, lignesVisibles: [] };
        let lNb = 0;
        let lTailleMaxLibelle = 0;
        this.cache.blocs.push(lBlocs);
        this.ListeElements.parcourir((aElement, aIndex) => {
          if (lNb >= this._options.nbrLignes) {
            lBlocs = { debut: aIndex, fin: aIndex, lignesVisibles: [] };
            this.cache.blocs.push(lBlocs);
            lNb = 0;
          }
          lBlocs.debut = Math.min(lBlocs.debut, aIndex);
          lBlocs.fin = Math.max(lBlocs.debut, aIndex);
          if (aElement.existe() && aElement.Visible !== false) {
            lNb += 1;
            lBlocs.lignesVisibles.push(aIndex);
            this.cache.nbVisibles += 1;
            if (
              this._options.estLargeurAuto &&
              MethodesObjet_1.MethodesObjet.isFunction(
                this._options.getTailleElementlargeurAuto,
              )
            ) {
              lTailleMaxLibelle =
                Math.max(
                  lTailleMaxLibelle,
                  this._options.getTailleElementlargeurAuto(
                    aElement,
                    this._options.classTexte === 'Gras',
                  ),
                ) + (this._options.multiSelection ? 10 : 0);
            }
          }
        });
        if (
          this._options.estLargeurAuto &&
          lTailleMaxLibelle &&
          MethodesObjet_1.MethodesObjet.isNumeric(this.cache.largeurCellule)
        ) {
          this.cache.largeurCellule = Math.min(
            Math.max(lTailleMaxLibelle, this._options.largeurAutoMin),
            this._options.largeurAutoMax,
          );
          this.bouton.setLargeur(this.cache.largeurCellule);
        }
        this.cache.scrollInfiniActif =
          !this._options.desactiverScrollInfini &&
          this.cache.blocs.length > 2 * this._options.nbBlocsScrollInfini + 2 &&
          this.cache.nbVisibles > 100;
        this.cache.avecCBMultiSelection = false;
        if (this._options.multiSelection) {
          if (!this._infosElementsCbs) {
            this._infosElementsCbs = {};
          }
          this.ListeElements.parcourir((aElement, aIndex) => {
            if (aElement.existe() && aElement.Visible !== false) {
              this._initInfosElementsCBs(aIndex);
              if (this._infosElementsCbs[aIndex].avecCB) {
                this.cache.avecCBMultiSelection =
                  this._infosElementsCbs[aIndex].avecCB;
              }
            }
          });
        }
        if (
          this.cache.nbVisibles === 0 &&
          this._options.deroulerListeSeulementSiPlusieursElements
        ) {
          return;
        }
        if ($('#' + this.Nom.escapeJQ()).length === 0) {
          return;
        }
        let lLargeurListe = this._getLargeurListe(),
          lCompteurLigne = 0,
          lNumeroDerniereLigne = 0,
          lNumeroLigneReference = -1,
          lHeightBoutonTactile = 36,
          lEstMultiSelection = this._options.multiSelection,
          lAvecScroll = false;
        this.cache.recherchesSurlignage = null;
        this.cache.avecSurlignage =
          this._options.avecSurlignageSuggestion &&
          this._options.mode === Enumere_Saisie_1.EGenreSaisie.SaisieRecherche;
        const lEstOuvertureModale = this._estOuvertureModale();
        if (!lEstOuvertureModale) {
          $('#' + this.idWrapperBouton.escapeJQ()).css('position', 'relative');
          $('#' + this.NomListe.escapeJQ()).css('width', lLargeurListe);
        }
        if (lEstMultiSelection && !this._infosElementsCbs) {
          this._infosElementsCbs = {};
        }
        if (
          this.cache.avecSurlignage &&
          !this.cache.surDemandeSaisieRechercheTout
        ) {
          const lRecherche = this.bouton.getLibelle().trim();
          if (
            lRecherche &&
            lRecherche.length > 0 &&
            (!this._options.rechercheTout ||
              !this._options.rechercheTout.includes(lRecherche))
          ) {
            this.cache.recherchesSurlignage = lRecherche.split(' ');
          }
        }
        if (!this._avecDeroulerListe()) {
          return;
        }
        const T = [];
        T.push(
          '<div role="presentation" ',
          this._options.couleurFondDeroulant
            ? +'style="' +
                ObjetStyle_1.GStyle.composeCouleurFond(
                  this._options.couleurFondDeroulant,
                ) +
                '">'
            : '>',
        );
        if (lLargeurListe > 0) {
          lLargeurListe = lLargeurListe - 1;
        }
        let lEnteteListe;
        if (
          MethodesObjet_1.MethodesObjet.isFunction(this._options.getEnteteListe)
        ) {
          lEnteteListe = this._options.getEnteteListe(this);
          if (lEnteteListe && lEnteteListe.html) {
            T.push('<div class="ObjetSaisie_entete_liste"></div>');
          }
        }
        T.push(
          '<div id="' +
            this.idContenu +
            '" tabindex="-1" ie-node="getNodeContenu" class="ie-draggable-handle-cancel"',
          ' style="height:0px; overflow-y: auto; overflow-x: hidden;',
          lEstOuvertureModale
            ? ''
            : ObjetStyle_1.GStyle.composeWidth(lLargeurListe),
          '"',
          ' ',
          ObjetWAI_1.GObjetWAI.composeRole(ObjetWAI_1.EGenreRole.Presentation),
          '>',
        );
        this.ListeElements.parcourir((aElement, aIndex) => {
          if (aElement.existe() && aElement.Visible !== false) {
            lNumeroDerniereLigne = aIndex;
            lCompteurLigne += 1;
            if (lCompteurLigne === this._options.nbrLignes) {
              lNumeroLigneReference = aIndex;
            }
            if (lCompteurLigne > this._options.nbrLignes) {
              lAvecScroll = true;
            }
          }
        });
        this.cache.largeurContenu =
          lLargeurListe -
          (GNavigateur.getLargeurBarreDeScroll &&
          (lAvecScroll || this._options.avecReservationPlaceBarreScroll)
            ? GNavigateur.getLargeurBarreDeScroll() - 2
            : 0);
        const lEstContenuVide = this.cache.nbVisibles === 0;
        T.push(
          IE.jsx.str(
            'ul',
            {
              class: [
                'liste-as-options',
                this.cache.avecCBMultiSelection ? ' multi-selections ' : '',
              ],
              id: this.idContenuScroll,
              role: 'listbox',
              'aria-multiselectable': this.cache.avecCBMultiSelection
                ? 'true'
                : false,
            },
            (aTab) => {
              if (lEstContenuVide) {
                aTab.push(
                  IE.jsx.str(
                    'li',
                    { 'ie-node': 'getNodeListeVide' },
                    IE.jsx.str(
                      'div',
                      { class: 'as-li ObjetSaisie_contenuvide' },
                      ObjetTraduction_1.GTraductions.getValeur(
                        'Navigation.ObjetSaisieVide',
                      ),
                    ),
                  ),
                );
              } else {
                if (this.cache.scrollInfiniActif) {
                  for (let i = 0; i <= this._options.nbBlocsScrollInfini; i++) {
                    aTab.push(this._composeBloc(this.cache.blocs[i], i));
                  }
                } else {
                  this.cache.blocs.forEach((aBloc, aIndex) => {
                    aTab.push(this._composeBloc(aBloc, aIndex));
                  });
                }
              }
            },
          ),
        );
        T.push('</div>');
        let lPiedListe;
        if (
          MethodesObjet_1.MethodesObjet.isFunction(this._options.getPiedListe)
        ) {
          lPiedListe = this._options.getPiedListe(this);
          if (lPiedListe && lPiedListe.html) {
            T.push('<div class="ObjetSaisie_pied_liste"></div>');
          }
        }
        if (lEstMultiSelection) {
          T.push(
            IE.jsx.str(
              'div',
              { class: 'validate-conteneur' },
              IE.jsx.str('ie-bouton', {
                'ie-model': 'btnValidationCB',
                'ie-node': 'getNode',
                'ie-html': 'getHtml',
                class: Type_ThemeBouton_1.TypeThemeBouton.primaire,
                id: this.idBtnValidation,
                style: this.modeTactile
                  ? ObjetStyle_1.GStyle.composeHeight(lHeightBoutonTactile)
                  : false,
              }),
            ),
          );
        }
        if (ObjetHtml_1.GHtml.elementExiste(this.NomListe)) {
          ObjetHtml_1.GHtml.setDisplay(this.NomListe, true);
          if (lEstOuvertureModale) {
            const lConteneur = ObjetHtml_1.GHtml.getElement(
              this.nomListeConteneur,
            );
            lConteneur.classList.add('visible');
          }
          ObjetHtml_1.GHtml.setHtml(this.NomListe, T.join(''), {
            controleur: this.controleur,
            ignorerScroll: true,
          });
          if (lEnteteListe && lEnteteListe.html) {
            $(
              '#' + this.NomListe.escapeJQ() + ' .ObjetSaisie_entete_liste',
            ).ieHtml(lEnteteListe.html, {
              controleur: lEnteteListe.controleur,
              instance: this,
            });
          }
          if (lPiedListe && lPiedListe.html) {
            $(
              '#' + this.NomListe.escapeJQ() + ' .ObjetSaisie_pied_liste',
            ).ieHtml(lPiedListe.html, {
              controleur: lPiedListe.controleur,
              instance: this,
            });
          }
          if (this.cache.scrollInfiniActif) {
            let lTop = 0,
              lNbLignesVisibles = 0,
              lAvecBlocInvisible = false;
            this.cache.blocs.forEach((aBloc, aNumeroBloc) => {
              if (aBloc.dessine) {
                this._majBloc(aNumeroBloc);
                lTop += aBloc.height;
                lNbLignesVisibles += aBloc.lignesVisibles.length;
              } else {
                lAvecBlocInvisible = true;
              }
            });
            if (!this.cache.heightScroll) {
              this.cache.heightScroll = lTop;
              if (lAvecBlocInvisible) {
                this.cache.heightScroll =
                  (lTop / lNbLignesVisibles) * this.cache.nbVisibles;
              }
            }
            $('#' + this.idContenuScroll.escapeJQ()).height(
              this.cache.heightScroll,
            );
            this._majBlocsTacheFond();
          }
          const lEventMap = {
            'focusin.saisie': this._surFocusLigne,
            'pointerdown.saisie': function (event) {
              const T = this.id.split('_');
              const lIndice = parseInt(T[T.length - 1], 10);
              event.data.instance.surLigne(lIndice);
            },
            'click.saisie': this._surClickListe,
            'mousemove.saisie': this._surMouseMoveListe,
          };
          $('#' + this.NomListe.escapeJQ())
            .off(lEventMap)
            .on(lEventMap, '.' + lClasseJQ, { instance: this });
          const lEventMap2 = {
            focusin: this._surFocusLigne,
            keydown: this._surKeyDownListe,
            keyup: this._surKeyUpListe,
          };
          $('#' + this.NomListe.escapeJQ())
            .off(lEventMap2)
            .on(lEventMap2, { instance: this });
        }
        if (lNumeroLigneReference < 0) {
          lNumeroLigneReference = lNumeroDerniereLigne;
        }
        this._ouvertureInverse = false;
        if (!lEstOuvertureModale) {
          const lJLigne = lEstContenuVide
            ? $('#' + this.Nom.escapeJQ() + ' .ObjetSaisie_contenuvide')
            : $('#' + this.Nom.escapeJQ() + '_' + lNumeroLigneReference);
          if (lJLigne.length > 0) {
            this.hauteurContenu =
              lJLigne.position().top + lJLigne.outerHeight(true);
          } else {
            this.hauteurContenu = 0;
          }
          if (lEstMultiSelection) {
            this.hauteurContenu += 1;
          }
          const lDecalageOmbre = 1;
          const lJBouton = $('#' + this.bouton.getNom().escapeJQ());
          let lPositionBouton = lJBouton.position();
          if (!lPositionBouton) {
            lPositionBouton = { top: 0, left: 0 };
          }
          const lRectOverflow = ObjetPosition_1.GPosition.getClientRect(
            ObjetHtml_1.GHtml.getParentOverflowNonVisible(lJBouton.get(0)),
          );
          const lRectBouton = ObjetPosition_1.GPosition.getClientRect(
              lJBouton.get(0),
            ),
            lJListe = $('#' + this.NomListe.escapeJQ());
          const lCorrectionHauteur =
            lDecalageOmbre +
            5 +
            ObjetPosition_1.GPosition.remToPixels(1.2) +
            (lEstMultiSelection
              ? $(
                  '#' + this.NomListe.escapeJQ() + ' .validate-conteneur',
                ).outerHeight()
              : 0) +
            (lEnteteListe && lEnteteListe.html
              ? $(
                  '#' + this.NomListe.escapeJQ() + ' .ObjetSaisie_entete_liste',
                ).outerHeight() + ObjetPosition_1.GPosition.remToPixels(0.4 * 2)
              : 0) +
            (lPiedListe && lPiedListe.html
              ? $(
                  '#' + this.NomListe.escapeJQ() + ' .ObjetSaisie_pied_liste',
                ).outerHeight() + ObjetPosition_1.GPosition.remToPixels(0.4 * 2)
              : 0);
          const lHauteurVersBas =
            Math.min(lRectOverflow.bottom, GNavigateur.ecranH) -
            lRectBouton.bottom -
            lCorrectionHauteur;
          const lHauteurVersHaut =
            lRectBouton.top - lCorrectionHauteur - lRectOverflow.top;
          this.decalageTopOuvertureInverse = lCorrectionHauteur - 3;
          if (
            this.hauteurContenu > lHauteurVersBas &&
            lHauteurVersHaut > 20 &&
            (lHauteurVersHaut * 2) / 3 > lHauteurVersBas
          ) {
            this._ouvertureInverse = true;
            this.hauteurContenu = Math.min(
              this.hauteurContenu,
              lHauteurVersHaut,
            );
            if (lJListe.length) {
              lJListe.css({
                top: -(lRectBouton.height + lDecalageOmbre) + 'px',
              });
            }
          } else {
            if (lJListe.length) {
              lJListe.css({ top: lRectBouton.height + lDecalageOmbre + 'px' });
            }
            this.hauteurContenu = Math.min(
              this.hauteurContenu,
              lHauteurVersBas,
            );
          }
          let lLeft = lPositionBouton.left;
          if (this._options.largeurListe) {
            const lLeftAbs = ObjetPosition_1.GPosition.getLeft(this.Nom);
            const lWidthListe = $('#' + this.NomListe.escapeJQ()).width();
            if (lLeftAbs + lWidthListe > GNavigateur.clientL) {
              lLeft = Math.max(
                -lLeftAbs + 2,
                ObjetPosition_1.GPosition.getWidth(this.Nom) - lWidthListe,
              );
            }
          }
          lJListe.css({ left: lLeft });
        } else {
          const lJContenu = $(`#${this.idContenu.escapeJQ()}`);
          const lHeightContenu_bak = lJContenu.height();
          lJContenu.height('auto');
          const lHeightScroll = ObjetPosition_1.GPosition.getClientRect(
            this.idContenuScroll,
          ).height;
          const lNodeListe = ObjetHtml_1.GHtml.getElement(this.NomListe);
          this.hauteurContenu = Math.max(
            20,
            lHeightScroll - (lNodeListe.scrollHeight - lNodeListe.clientHeight),
          );
          this.hauteurContenu = Math.floor(this.hauteurContenu);
          lJContenu.height(lHeightContenu_bak);
        }
        if (this.cache.largeurCellule === 0) {
          this.cache.largeurCellule = ObjetHtml_1.GHtml.getElement(
            this.NomListe,
          ).scrollWidth;
          this.bouton.setLargeur(this.cache.largeurCellule);
          ObjetPosition_1.GPosition.setWidth(
            this.NomListe,
            this.cache.largeurCellule,
          );
        }
        ObjetHtml_1.GHtml.setDisplay(this.NomListe, false);
        if (lEstOuvertureModale) {
          ObjetHtml_1.GHtml.getElement(this.nomListeConteneur).classList.remove(
            'visible',
          );
        }
      }
      getNbElementsVisible() {
        let lResult = 0;
        if (this.ListeElements) {
          for (let i = 0, lNb = this.ListeElements.count(); i < lNb; i++) {
            const lElement = this.ListeElements.get(i);
            if (lElement.existe() && lElement.Visible !== false) {
              lResult++;
            }
          }
        }
        return lResult;
      }
      fermerListe(AAvecFocus) {
        if (this.Selection >= 0) {
          this._majBlocsDeLigne(this.Selection, true);
        }
        if (this.listeDeroulee) {
          this._arreterFermetureListe();
          clearTimeout(this._timerEditionRecherche);
          clearTimeout(this.cache.timerMAJ);
          this._selectionLigne(this.Survolee, false);
          this.Survolee = -1;
          if (AAvecFocus) {
            this.setFocus();
          }
          this.listeDeroulee = false;
          this.activerEventOut = false;
          this.bouton.setOptionsObjetCelluleBouton({
            ariaExpanded: false,
            ariaControls: '',
          });
          const lElementListe = ObjetHtml_1.GHtml.getElement(this.NomListe);
          const lElementContenuListe = ObjetHtml_1.GHtml.getElement(
            this.idContenu,
          );
          if (
            ObjetHtml_1.GHtml.estElement(lElementListe) &&
            ObjetHtml_1.GHtml.estElement(lElementContenuListe)
          ) {
            lElementContenuListe.style.overflowY = 'hidden';
            if (!this._estOuvertureModale()) {
              ObjetStyle_1.GStyle.setZindex(lElementListe, 200);
            }
            const lObjet = this;
            if (this._ouvertureInverse) {
              $(lElementListe).css({
                top: -lObjet.hauteurContenu - this.decalageTopOuvertureInverse,
              });
            }
            $(lElementContenuListe)
              .css({ height: lObjet.hauteurContenu })
              .animate(
                { height: 0 },
                {
                  duration: this._options.dureeAnimationDeploiement,
                  step: this._ouvertureInverse
                    ? this._etapeFermetureInverse.bind(this, $(lElementListe))
                    : null,
                },
              )
              .queue(function () {
                lObjet._eventAnimationFermetureFin();
                $(this).dequeue();
              });
          }
        }
      }
      surLigne(ASurvolee, aSansFocusLigne) {
        if (!this.listeDeroulee) {
          return;
        }
        const lAvecFocus = aSansFocusLigne !== true;
        if (
          this.Survolee !== ASurvolee &&
          MethodesObjet_1.MethodesObjet.isNumber(ASurvolee)
        ) {
          this._majBlocsDeLigne(ASurvolee);
          const N = this.ListeElements.count();
          if (this._estSelectionnable(this.ListeElements.get(ASurvolee))) {
            if (this.Survolee > -1 && this.Survolee < N) {
              this._selectionLigne(this.Survolee, false);
            }
            this.Survolee = ASurvolee;
            this._selectionLigne(this.Survolee, true);
          }
          const lElementContenu = ObjetHtml_1.GHtml.getElement(this.idContenu);
          if (lElementContenu) {
            const lJContenuElement = $(
              '#' + this.Nom.escapeJQ() + '_' + this.Survolee,
            );
            if (lJContenuElement.length === 1) {
              if (this.Survolee === 0) {
                lElementContenu.scrollTop = 0;
              } else {
                ObjetPosition_1.GPosition.scrollToElement(
                  lJContenuElement.get(0),
                  lElementContenu,
                );
              }
            }
          }
          if (lAvecFocus) {
            ObjetHtml_1.GHtml.setFocus(this.Nom + '_' + this.Survolee);
          }
        } else if (ASurvolee === -1) {
          if (lAvecFocus) {
            this._majBlocsDeLigne(ASurvolee);
            ObjetHtml_1.GHtml.setFocus(this.NomListe);
          }
        }
      }
      setDonneesObjetSaisie(aParams) {
        var _a, _b;
        const lParams = Object.assign(
          {
            liste: null,
            selection: null,
            deroulerListe: false,
            actualiserListe: false,
            ignorerSelectionAutomatiqueAvecUnElement: false,
            options: null,
          },
          aParams,
        );
        if (lParams.options) {
          this.setOptionsObjetSaisie(lParams.options);
        }
        if (this.listeDeroulee) {
          this.fermerListe(false);
        }
        clearTimeout(this.cache.timerMAJ);
        this.ListeElements = lParams.liste;
        this.actualiserListe = lParams.actualiserListe;
        this._trierElements();
        this.listeDeroulee = false;
        this.activerEventOut = false;
        this.cache.heightScroll = 0;
        let lAvecSelectionAutomatique = false;
        if (
          this._options.initAutoSelectionAvecUnElement &&
          !this._options.multiSelection &&
          !lParams.ignorerSelectionAutomatiqueAvecUnElement
        ) {
          lAvecSelectionAutomatique = this._gererCasUnSeulElement();
        }
        this._remplirListe();
        if (
          !lAvecSelectionAutomatique &&
          typeof lParams.selection === 'number'
        ) {
          this.setSelection(lParams.selection);
        }
        if (
          this._options.multiSelection &&
          lParams.selection instanceof ObjetListeElements_1.ObjetListeElements
        ) {
          this._initListeSelections(lParams.selection);
        }
        if (
          lParams.deroulerListe &&
          (this.getNbElementsVisible() > 1 ||
            !this._options.deroulerListeSeulementSiPlusieursElements)
        ) {
          this._deroulerListe(lParams.selection ? null : 0);
        }
      }
      setDonnees(AListeElements, ASelection, ADeroulerListe, AActualiserListe) {
        this.setDonneesObjetSaisie({
          liste: AListeElements,
          selection: ASelection,
          deroulerListe: ADeroulerListe,
          actualiserListe: AActualiserListe,
        });
      }
      setFocus() {
        this.bouton.setFocus();
        if (this._avecSaisieRechercheDynamique()) {
          setTimeout(() => {
            ObjetHtml_1.GHtml.setCursorAtEnd(this.bouton.NomEdit);
          }, 0);
        }
      }
      viderContenu() {
        this.setContenu('');
        $(
          '#' +
            this.idContenuScroll.escapeJQ() +
            ', #' +
            this.bouton.NomEdit.escapeJQ(),
        ).attr(
          ObjetWAI_1.GObjetWAI.getAttribut(
            ObjetWAI_1.EGenreAttribut.activedescendant,
          ),
          null,
        );
      }
      setContenu(AContenu) {
        let lLibelle = '';
        if (AContenu instanceof ObjetListeElements_1.ObjetListeElements) {
          lLibelle = this._options.getLibelleCelluleMultiSelection(AContenu);
        } else if (AContenu instanceof ObjetElement_1.ObjetElement) {
          lLibelle = AContenu.getLibelle();
        } else {
          lLibelle = AContenu || '';
        }
        this.bouton.setLibelle(lLibelle);
      }
      getContenu() {
        if (
          [Enumere_Saisie_1.EGenreSaisie.Combo].includes(this._options.mode)
        ) {
          return this.Selection > -1
            ? this.ListeElements.get(this.Selection).getLibelle()
            : '';
        } else {
          return this.bouton.getLibelle();
        }
      }
      getListeElements() {
        return this.ListeElements;
      }
      estComboMultiSelection() {
        return this._options.multiSelection;
      }
      reset() {
        this.setDonnees(new ObjetListeElements_1.ObjetListeElements());
        this.viderContenu();
      }
      getSelection() {
        return this.Selection > -1
          ? this.ListeElements.get(this.Selection)
          : null;
      }
      initSelectionParNumeroEtGenre(ANumero, AGenre, AIndiceSiNonTrouve) {
        if (
          (ANumero === null || ANumero === undefined) &&
          (AGenre === null || AGenre === undefined)
        ) {
          ANumero = 0;
        }
        if (this.ListeElements) {
          let LIndice = this.ListeElements.getIndiceParNumeroEtGenre(
            ANumero,
            AGenre,
          );
          if (LIndice === null || LIndice === undefined) {
            LIndice = AIndiceSiNonTrouve;
          }
          this.initSelection(LIndice);
        }
      }
      initSelection(aSelection) {
        this.Selection = aSelection >= 0 ? aSelection : -1;
        if (
          this.Selection >= 0 &&
          this._options.modifierContenuCelluleSurSelection
        ) {
          const lElement = this.ListeElements.get(this.Selection);
          if (lElement) {
            if (this._options.getContenuCellule) {
              this._appliquerGetContenuCellule(lElement);
            } else if (
              this._options.celluleAvecTexteHtml &&
              lElement.libelleHtml
            ) {
              this.bouton.setLibelleHtml(lElement.libelleHtml);
            } else {
              this.setContenu(lElement.getLibelle());
            }
            const lIdDescendant = this.Nom + '_' + this.Selection;
            $(
              '#' +
                this.idContenuScroll.escapeJQ() +
                ', #' +
                this.bouton.NomEdit.escapeJQ(),
            ).attr(
              ObjetWAI_1.GObjetWAI.getAttribut(
                ObjetWAI_1.EGenreAttribut.activedescendant,
              ),
              ObjetHtml_1.GHtml.getElement(lIdDescendant)
                ? lIdDescendant
                : null,
            );
          }
        }
        this.$refreshSelf();
      }
      setSelectionParNumeroEtGenre(ANumero, AGenre, AIndice) {
        let lResult = false;
        if (
          (ANumero === null || ANumero === undefined) &&
          (AGenre === null || AGenre === undefined)
        ) {
          ANumero = 0;
        }
        if (this.ListeElements) {
          let LIndice = this.ListeElements.getIndiceParNumeroEtGenre(
            ANumero,
            AGenre,
          );
          if (LIndice === null || LIndice === undefined) {
            LIndice = AIndice;
          }
          lResult = LIndice >= 0;
          this.setSelection(LIndice);
        }
        return lResult;
      }
      setSelectionParIndice(aIndice) {
        if (this.ListeElements.getNbrElementsExistes() <= 1) {
          return;
        }
        this.setSelection(aIndice);
      }
      setSelectionParElement(aElement, aIndice) {
        if (aElement) {
          this.setSelectionParNumeroEtGenre(
            aElement.getNumero(),
            aElement.getGenre(),
            aIndice,
          );
        } else {
          this.setSelectionParNumeroEtGenre(null, null, aIndice);
        }
      }
      setListeSelections(aListeSelections) {
        let lResult = false;
        if (this._infosElementsCbs) {
          lResult = this._initListeSelections(aListeSelections);
        }
        this.surValidation(false, -1, { validationMultiSelection: true });
        return lResult;
      }
      surPrecedentSuivant(aPrecedent) {
        this._surPrecedentSuivant(aPrecedent);
      }
      setActif(AActif) {
        super.setActif(AActif);
        this.bouton.setActif(AActif);
        this.$refreshSelf();
      }
      getDonneesPourHTMLCombo() {
        return { options: this._options, bouton: this.bouton };
      }
      _avecSaisieRechercheDynamique() {
        return (
          this._options.mode ===
            Enumere_Saisie_1.EGenreSaisie.SaisieRecherche &&
          !this._estOuvertureModale() &&
          !!this._options.surEditionRecherche
        );
      }
      _trierElements() {
        if (this._options.avecTriListeElements && this.ListeElements) {
          this.ListeElements.trier();
        }
      }
      _callbackRecherche(aParam) {
        const lParam = Object.assign({ liste: null }, aParam);
        if (lParam.liste && lParam.liste.count() > 0) {
          this.ListeElements = lParam.liste;
          this._trierElements();
          this.fermerListe(false);
          this._deroulerListe(0, false, true);
        } else {
          this.fermerListe(false);
        }
      }
      _modificationSaisieBoutonRecherche(aValue) {
        this.ListeElements = new ObjetListeElements_1.ObjetListeElements();
        this.Selection = -1;
        const lValue = (aValue + '').trim();
        clearTimeout(this._timerEditionRecherche);
        if (lValue.length < this._options.nbCarMinRecherche) {
          this.fermerListe(false);
        } else if (this._options.surEditionRecherche) {
          this.cache.editionEnCours = true;
          if (this._avecSaisieRechercheDynamique()) {
            if (this._options.delaiSurEditionRecherche >= 0) {
              this._timerEditionRecherche = setTimeout(() => {
                this.cache.surDemandeSaisieRechercheTout = false;
                this._options.surEditionRecherche(
                  lValue,
                  this._callbackRecherche.bind(this),
                );
              }, this._options.delaiSurEditionRecherche);
            } else {
              this.cache.surDemandeSaisieRechercheTout = false;
              this._options.surEditionRecherche(
                lValue,
                this._callbackRecherche.bind(this),
              );
            }
          }
        }
      }
      _boutonPrecSuivOK(aPrecedent) {
        const lListe = this.ListeElements;
        if (!lListe || !lListe.count || lListe.count() < 2) {
          return false;
        }
        if (!this.getActif()) {
          return false;
        }
        let lIndice = this.Selection;
        const lEnBoucle = this._options.avecBoutonsPrecSuiv_boucle;
        if (lIndice === -1) {
          if (aPrecedent) {
            lIndice = lEnBoucle ? 0 : -1;
          } else {
            return lListe.count() > 0;
          }
        }
        const lElement = lListe.get(lIndice);
        if (!lElement) {
          return false;
        }
        if (
          aPrecedent &&
          lListe.get(
            this.chercherIndiceSelectionSelonSens(
              lIndice - 1,
              true,
              lEnBoucle,
              this._options.getElementSelectionnableParPrecSuiv,
            ),
          )
        ) {
          return true;
        }
        if (
          !aPrecedent &&
          lListe.get(
            this.chercherIndiceSelectionSelonSens(
              lIndice + 1,
              false,
              lEnBoucle,
              this._options.getElementSelectionnableParPrecSuiv,
            ),
          )
        ) {
          return true;
        }
        return false;
      }
      _parcourirFilsDeCumul(aIndice, aFunction) {
        const lInfos = this._infosElementsCbs[aIndice];
        this.ListeElements.parcourir((D, aIndex) => {
          if (
            aIndice !== aIndex &&
            D.Visible !== false &&
            (!lInfos.estFilsCumul || lInfos.estFilsCumul(D))
          ) {
            aFunction.call(this, D, aIndex);
          }
        }, this);
      }
      _getSelectionElement(aInfos, aIndice) {
        const lResult = { selectionne: false, nbFils: 0, nbFilsSelectionne: 0 };
        if (!aInfos.estCumul) {
          lResult.selectionne = aInfos.selectionne;
        } else {
          this._parcourirFilsDeCumul(aIndice, (D, aIndex) => {
            lResult.nbFils += 1;
            const lInfosFils = this._infosElementsCbs[aIndex];
            if (lInfosFils && lInfosFils.selectionne) {
              lResult.nbFilsSelectionne += 1;
            }
          });
          lResult.selectionne =
            lResult.nbFilsSelectionne > 0 &&
            lResult.nbFilsSelectionne === lResult.nbFils;
        }
        return lResult;
      }
      getValueElementCB(aIndice) {
        const lInfos = this._infosElementsCbs
          ? this._infosElementsCbs[aIndice]
          : null;
        if (lInfos) {
          return this._getSelectionElement(lInfos, aIndice).selectionne;
        }
        return false;
      }
      _modifierSelectionElement(aIndice, aValue, aProfondeur) {
        const lInfos = this._infosElementsCbs
          ? this._infosElementsCbs[aIndice]
          : null;
        if (lInfos) {
          lInfos.selectionne = aValue;
          const lElementSource = this.ListeElements.get(aIndice),
            lProfondeur = aProfondeur || 0;
          if (lProfondeur > 1) {
            return;
          }
          this.ListeElements.parcourir((D, aIndex) => {
            const lInfosElement = this._infosElementsCbs
              ? this._infosElementsCbs[aIndex]
              : null;
            if (
              aIndice !== aIndex &&
              D.Visible !== false &&
              lInfosElement &&
              !lInfosElement.estCumul &&
              lInfosElement.setModifierSelection
            ) {
              const lResult = lInfosElement.setModifierSelection({
                elementCourantSelectionne: lInfosElement.selectionne,
                elementSource: lElementSource,
                elementSourceSelectionne: aValue,
              });
              if (
                (lResult === true && lInfosElement.selectionne !== true) ||
                (lResult === false && lInfosElement.selectionne !== false)
              ) {
                this._modifierSelectionElement(
                  aIndex,
                  lResult,
                  lProfondeur + 1,
                );
              }
            }
          }, this);
        }
      }
      _setValueElementCB(aIndice, aValue) {
        const lInfos = this._infosElementsCbs
          ? this._infosElementsCbs[aIndice]
          : null;
        if (lInfos) {
          if (lInfos.estCumul) {
            this._parcourirFilsDeCumul(aIndice, (D, aIndex) => {
              this._modifierSelectionElement(aIndex, aValue);
            });
          } else {
            this._modifierSelectionElement(aIndice, aValue);
          }
        }
      }
      _surPrecedentSuivant(aPrecedent) {
        let lIndice = this.Selection;
        const lListe = this.ListeElements;
        const lEnBoucle = this._options.avecBoutonsPrecSuiv_boucle;
        const lMethodeSelec = this._options.getElementSelectionnableParPrecSuiv;
        if (this._options.multiSelection && lListe) {
          lListe.parcourir((D, aIndex) => {
            const lInfos = this._infosElementsCbs
              ? this._infosElementsCbs[aIndex]
              : null;
            if (lInfos && !lInfos.estCumul && lInfos.selectionne) {
              lIndice = aIndex;
              if (aPrecedent) {
                return false;
              }
            }
          }, this);
        }
        if (lIndice === -1 && aPrecedent) {
          lIndice = lEnBoucle ? 0 : -1;
        }
        if (
          MethodesObjet_1.MethodesObjet.isNumber(lIndice) &&
          lListe &&
          lListe.get
        ) {
          if (aPrecedent && (lListe.get(lIndice - 1) || lEnBoucle)) {
            lIndice = this.chercherIndiceSelectionSelonSens(
              lIndice - 1,
              true,
              lEnBoucle,
              lMethodeSelec,
            );
          } else if (!aPrecedent && (lListe.get(lIndice + 1) || lEnBoucle)) {
            lIndice = this.chercherIndiceSelectionSelonSens(
              lIndice + 1,
              false,
              lEnBoucle,
              lMethodeSelec,
            );
          }
          if (lIndice >= 0) {
            if (this._options.multiSelection) {
              lListe.parcourir((D, aIndex) => {
                const lInfos = this._infosElementsCbs
                  ? this._infosElementsCbs[aIndex]
                  : null;
                if (lInfos && lInfos.selectionne) {
                  lInfos.selectionne = false;
                }
              }, this);
              this._setValueElementCB(lIndice, true);
              this.surValidation(true, lIndice);
            } else {
              this.surValidation(true, lIndice);
            }
          }
        }
      }
      _getLargeurListe() {
        return this.modeTactile
          ? (window.innerWidth || document.body.offsetWidth) / 2
          : this._options.largeurListe
            ? this._options.largeurListe
            : $('#' + this.bouton.getNom().escapeJQ()).width();
      }
      _surEvenementBouton(aGenreEvent, aEvent, aEvenementSurEdit) {
        var _a;
        switch (aGenreEvent) {
          case Enumere_Event_1.EEvent.SurMouseDown:
            if (aEvenementSurEdit) {
              if (
                [Enumere_Saisie_1.EGenreSaisie.Combo].includes(
                  this._options.mode,
                )
              ) {
                this.surSelection();
              }
            } else {
              this.surSelection({ surBoutonCellule: true });
            }
            break;
          case Enumere_Event_1.EEvent.SurKeyUp:
            switch (this._options.mode) {
              case Enumere_Saisie_1.EGenreSaisie.Combo: {
                if (!this.listeDeroulee) {
                  if (
                    aEvent.which === ToucheClavier_1.ToucheClavier.FlecheHaut ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.FlecheBas
                  ) {
                    this._deroulerListe();
                  } else if (
                    aEvent.which === ToucheClavier_1.ToucheClavier.Debut
                  ) {
                    this._deroulerListe(0);
                  } else if (
                    aEvent.which === ToucheClavier_1.ToucheClavier.Fin
                  ) {
                    this._deroulerListe(this._getDerniereLingeSelectionnable());
                  }
                }
                if (
                  !this.listeDeroulee &&
                  !aEvent.altKey &&
                  (aEvent.which ===
                    ToucheClavier_1.ToucheClavier.FlecheGauche ||
                    aEvent.which ===
                      ToucheClavier_1.ToucheClavier.FlecheDroite) &&
                  !this._options.multiSelection &&
                  !((_a = ObjetHtml_1.GHtml.getElement(this.getNom())) ===
                    null || _a === void 0
                    ? void 0
                    : _a.closest('[role="toolbar"]'))
                ) {
                  this._surPrecedentSuivant(
                    aEvent.which === ToucheClavier_1.ToucheClavier.FlecheGauche,
                  );
                }
                break;
              }
              case Enumere_Saisie_1.EGenreSaisie.SaisieRecherche: {
                const lNbVisibles = this.getNbElementsVisible();
                if (
                  !this.listeDeroulee &&
                  aEvent.which === ToucheClavier_1.ToucheClavier.FlecheBas &&
                  (lNbVisibles > 0 ||
                    !this._options.deroulerListeSeulementSiPlusieursElements)
                ) {
                  this._deroulerListe(0, true);
                } else {
                  this._defilerFleches(aEvent);
                }
                if (
                  ToucheClavier_1.ToucheClavierUtil.estEventRetourChariot(
                    aEvent,
                  )
                ) {
                  if (
                    this.listeDeroulee &&
                    (lNbVisibles > 0 ||
                      !this._options.deroulerListeSeulementSiPlusieursElements)
                  ) {
                    this.surValidation(
                      true,
                      this.Selection >= 0 ? this.Selection : 0,
                    );
                  } else if (
                    (lNbVisibles > 0 ||
                      !this._options
                        .deroulerListeSeulementSiPlusieursElements) &&
                    !this.actualiserListe
                  ) {
                    if (
                      lNbVisibles > 1 ||
                      !this._options.deroulerListeSeulementSiPlusieursElements
                    ) {
                      this._deroulerListe(0, true);
                    } else {
                      this._gererCasUnSeulElement();
                    }
                  } else {
                    this.surValidation(false, -1, { saisieRecherche: true });
                  }
                }
                return;
              }
            }
            if (ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent)) {
              this.surSelection();
            }
            break;
          case Enumere_Event_1.EEvent.SurFocusOut:
            switch (this._options.mode) {
              case Enumere_Saisie_1.EGenreSaisie.SaisieRecherche:
                if (this._avecSaisieRechercheDynamique()) {
                  this._declencherFermetureListe();
                }
                break;
            }
            break;
        }
      }
      _appliquerGetContenuCellule(aElement) {
        if (!aElement) {
          this.setContenu('');
          return;
        }
        const lContenuCellule = this._options.getContenuCellule(aElement, this);
        if (typeof lContenuCellule === 'string') {
          if (lContenuCellule) {
            this.setContenu(lContenuCellule);
          }
        } else if (lContenuCellule) {
          if (
            MethodesObjet_1.MethodesObjet.isString(lContenuCellule.libelleHtml)
          ) {
            this.bouton.setLibelleHtml(lContenuCellule.libelleHtml);
          } else if (
            MethodesObjet_1.MethodesObjet.isString(lContenuCellule.libelle)
          ) {
            this.setContenu(lContenuCellule.libelle);
          }
        }
      }
      _getParamsCallback(aParams) {
        return Object.assign(
          {
            combo: this,
            genreEvenement: -1,
            element: null,
            indice: null,
            genre: this.Genre,
            surSetDonnees: null,
            listeSelections: null,
            estComboMultiSelection: this._options.multiSelection,
            interactionUtilisateur: this.InteractionUtilisateur,
            estSelectionManuelle: false,
            editionEnCours: this.cache.editionEnCours,
            valeur: null,
            saisieRecherche: false,
            validationMultiSelection: false,
            surBoutonCellule: false,
          },
          aParams,
        );
      }
      _callback(aParams) {
        return this.callback.appel(aParams);
      }
      _retourSurNavigation(aParams) {
        if (aParams.retourSaisieAnnule) {
          this.setEtatSaisie(false);
        }
        const lSurSetDonnes = this._surSetDonnnes;
        const lParams = this._getParamsCallback(
          Object.assign(
            {
              genreEvenement:
                Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
                  .selection,
              element:
                this.Selection >= 0
                  ? this.ListeElements.get(this.Selection)
                  : null,
              indice: this.Selection || 0,
              genre: this.Genre,
              surSetDonnees: lSurSetDonnes,
              listeSelections: this._listeSelections,
              estSelectionManuelle: this.InteractionUtilisateur,
            },
            aParams,
          ),
        );
        delete this._surSetDonnnes;
        if (
          lParams.element &&
          lParams.element.callbackSelection &&
          MethodesObjet_1.MethodesObjet.isFunction(
            lParams.element.callbackSelection,
          )
        ) {
          lParams.element.callbackSelection(lParams);
        }
        this._callback(lParams);
        if (this._options.surValidation) {
          this._options.surValidation.call(this.Pere, lParams);
        }
        if (
          this.Pere &&
          this.Pere instanceof ObjetIdentite_1.Identite &&
          this.Pere.$refreshSelf
        ) {
          this.Pere.$refreshSelf();
        }
        if (
          this._options.mode === Enumere_Saisie_1.EGenreSaisie.SaisieRecherche
        ) {
          this.ListeElements = new ObjetListeElements_1.ObjetListeElements();
        }
      }
      _survolBoutonMultiSelection() {
        this._selectionLigne(this.Survolee, false);
        this.Survolee += 1;
      }
      _defilerFleches(aEvent, aSurKeyDown) {
        if (this.listeDeroulee) {
          if (this._estEventFermetureFleche(aEvent)) {
            if (!aSurKeyDown) {
              this.fermerListe(true);
            }
            return false;
          }
          if (aEvent.which === ToucheClavier_1.ToucheClavier.FlecheBas) {
            if (
              this._chercherSuivantSelectionnable(this.Survolee, true) <
              this.ListeElements.count()
            ) {
              this.surLigne(
                this._chercherSuivantSelectionnable(this.Survolee, true),
              );
              return true;
            }
            if (
              this._options.multiSelection &&
              this.Survolee < this.ListeElements.count()
            ) {
              this._survolBoutonMultiSelection();
              ObjetHtml_1.GHtml.setFocus(this.idBtnValidation, true);
              return true;
            }
          }
          if (aEvent.which === ToucheClavier_1.ToucheClavier.FlecheHaut) {
            if (
              this._chercherSuivantSelectionnable(this.Survolee, false) > -1
            ) {
              this.surLigne(
                this._chercherSuivantSelectionnable(this.Survolee, false),
              );
            }
            return true;
          }
        }
        return false;
      }
      _defiler(aEvent, aIgnorerFleches) {
        if (
          !this.listeDeroulee &&
          [Enumere_Saisie_1.EGenreSaisie.Combo].includes(this._options.mode)
        ) {
          if (ToucheClavier_1.ToucheClavierUtil.estEventRetourChariot(aEvent)) {
            this._deroulerListe();
          }
        }
        if (this.listeDeroulee) {
          if (
            ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent) ||
            this._estEventFermetureFleche(aEvent)
          ) {
            this._surValidationClavier();
          } else if (aEvent.which === ToucheClavier_1.ToucheClavier.Echap) {
            this.fermerListe(true);
          } else if (
            !(!aIgnorerFleches && this._defilerFleches(aEvent)) &&
            ToucheClavier_1.ToucheClavierUtil.estEventCaractereAlphaNumerique(
              aEvent,
            )
          ) {
            clearTimeout(this._timerInitParseur);
            this._timerInitParseur = setTimeout(
              this._initParseur.bind(this),
              500,
            );
            this._parseur = this._parseur + aEvent.key;
            const lIndice = this.ListeElements.getIndiceParParsingLibelle(
              this._parseur,
            );
            if (lIndice >= 0) {
              this.surLigne(lIndice);
            }
          }
        }
      }
      _surValidationClavier() {
        if (this._options.multiSelection) {
          this._setValueElementCB(
            this.Survolee,
            !this.getValueElementCB(this.Survolee),
          );
          this.$refreshSelf();
        } else {
          this.surValidation(true, this.Survolee);
        }
      }
      _estEventFermetureFleche(aEvent) {
        return (
          aEvent &&
          aEvent.altKey &&
          aEvent.which === ToucheClavier_1.ToucheClavier.FlecheHaut
        );
      }
      _initParseur() {
        this._parseur = '';
      }
      _chercherSuivantSelectionnable(aIndice, aSensSuivant) {
        const lSens = aSensSuivant ? 1 : -1;
        aIndice = aIndice + lSens;
        const N = this.ListeElements.count();
        while (
          aIndice > -1 &&
          aIndice < N &&
          this.ListeElements &&
          this.ListeElements.get(aIndice) &&
          !this._estSelectionnable(this.ListeElements.get(aIndice))
        ) {
          aIndice += lSens;
        }
        return aIndice;
      }
      _initInfosElementsCBs(aNumeroLigne) {
        const lElement = this.ListeElements.get(aNumeroLigne);
        const lSelectionnable = !!this._estSelectionnable(lElement);
        this._infosElementsCbs[aNumeroLigne] = {
          selectionne:
            lSelectionnable &&
            !!this._listeSelections.getElementParElement(lElement),
          avecCB: lSelectionnable,
          selectionnable: lSelectionnable,
          nonEditable: false,
          estCumul: false,
          estFilsCumul: null,
          setModifierSelection: null,
        };
        if (this._options.getInfosElementCB && lElement) {
          $.extend(
            this._infosElementsCbs[aNumeroLigne],
            this._options.getInfosElementCB(lElement),
          );
        }
      }
      _composeLigne(aElement, I, aLignesVisibles) {
        const T = [];
        if (!aElement) {
          return '';
        }
        let LLibelle = aElement.getLibelle();
        const lPaddingLeft = 3;
        const lParams = {
          element: aElement,
          indice: I,
          largeur: this.cache.largeurContenu - lPaddingLeft,
        };
        const lEstCumul = !!(
          this._options.getEstCumul && this._options.getEstCumul(aElement)
        );
        const lClassElement = this._options.getClassElement
          ? this._options.getClassElement(lParams)
          : lEstCumul
            ? 'titre-liste'
            : '';
        let lAvecEllipsis =
          !aElement.libelleHtmlTitle &&
          !this._options.getContenuElement &&
          !this._estOuvertureModale();
        if (
          this.cache.avecSurlignage &&
          this.cache.recherchesSurlignage &&
          !aElement.libelleHtml &&
          !this._options.getContenuElement &&
          (!this._options.avecSurlignageElement ||
            this._options.avecSurlignageElement(lParams))
        ) {
          LLibelle = ObjetChaine_1.GChaine.getLibelleSurligne(
            LLibelle,
            this.cache.recherchesSurlignage,
            { couleur: this._options.couleurSurlignageSuggestion },
          );
        }
        LLibelle = ObjetChaine_1.GChaine.avecEspaceSiVide(LLibelle);
        const lAvecSelection = this._estSelectionnable(aElement);
        T.push(
          '<li',
          !!lClassElement ? ' class="' + lClassElement + '"' : '',
          ' role="presentation">',
        );
        if (aElement.ClassAffichage || aElement.StyleAffichage) {
          LLibelle =
            '<div ' +
            (lAvecEllipsis ? ' ie-ellipsis ' : '') +
            (aElement.ClassAffichage
              ? 'class="' + aElement.ClassAffichage + '" '
              : '') +
            (aElement.StyleAffichage
              ? 'style="' + aElement.StyleAffichage + '"'
              : '') +
            '>' +
            LLibelle +
            '</div>';
          lAvecEllipsis = false;
        }
        if (
          this.cache.avecCBMultiSelection &&
          this._infosElementsCbs &&
          this._infosElementsCbs[lParams.indice] &&
          this._infosElementsCbs[lParams.indice].avecCB
        ) {
          T.push(
            IE.jsx.str(
              IE.jsx.fragment,
              null,
              IE.jsx.str(
                'div',
                {
                  class: 'check-conteneur',
                  role: 'presentation',
                  'ie-node': (0, jsx_1.jsxFuncAttr)('getNodeCBMulti', [I]),
                },
                IE.jsx.str('ie-checkbox', {
                  'aria-hidden': 'true',
                  tabindex: '-1',
                  'ie-model': (0, jsx_1.jsxFuncAttr)('cbElement', [I]),
                }),
              ),
            ),
          );
        }
        const lGetIdLigne = (aLigne) => {
          return `${this.Nom}_${aLigne}`;
        };
        const lLineHeight = this.modeTactile
          ? this._options.hauteurLigneTactile
          : this._options.hauteur
            ? this._options.hauteur
            : this._options.hauteurLigneDefault;
        let lRole = 'option';
        let lAriaOwns = [];
        if (!lAvecSelection) {
          if (lEstCumul) {
            lRole = 'group';
            aLignesVisibles.forEach((aNumeroLigne) => {
              const lLigne = this.ListeElements.get(aNumeroLigne);
              if (
                lLigne !== aElement &&
                this._options.getEstFilsDeCumul &&
                this._options.getEstFilsDeCumul(lLigne, aElement)
              ) {
                lAriaOwns.push(lGetIdLigne(aNumeroLigne));
              }
            });
          } else {
            lRole = 'presentation';
          }
        }
        T.push(
          IE.jsx.str(
            'div',
            {
              id: lGetIdLigne(I),
              role: lRole,
              'ie-attr': lAvecSelection
                ? (0, jsx_1.jsxFuncAttr)('getAttrWAIOption', I)
                : false,
              'ie-hint': aElement.libelleHtmlTitle
                ? aElement.libelleHtmlTitle
                : '',
              'ie-ellipsis': lAvecEllipsis,
              class: ['as-li', lClasseJQ],
              style:
                'line-height:' + lLineHeight * 0.1 + 'rem; overflow: hidden;',
              tabindex: lAvecSelection ? '-1' : false,
              'aria-owns': lAriaOwns.length > 0 ? lAriaOwns.join(' ') : false,
              'aria-label': lRole === 'group' ? LLibelle : false,
            },
            () => {
              if (aElement.libelleHtml || this._options.getContenuElement) {
                const lContenu = this._options.getContenuElement
                  ? this._options.getContenuElement(lParams)
                  : aElement.libelleHtml;
                if (this.modeTactile) {
                  return IE.jsx.str(
                    IE.jsx.fragment,
                    null,
                    IE.jsx.str(
                      'div',
                      { class: 'InlineBlock', style: 'height:100%;width:0;' },
                      '\u00A0',
                    ),
                    IE.jsx.str(
                      'div',
                      {
                        class: 'InlineBlock',
                        style: 'line-height:initial; width:100%;',
                      },
                      lContenu,
                    ),
                  );
                }
                return lContenu;
              } else {
                return LLibelle;
              }
            },
          ),
        );
        T.push('</li>');
        return T.join('');
      }
      _composeBloc(aBloc, aNumeroBloc) {
        const T = [];
        if (aBloc && aBloc.lignesVisibles) {
          aBloc.dessine = true;
          aBloc.calcule = false;
          aBloc.top = 0;
          aBloc.height = 0;
          if (this.cache.scrollInfiniActif) {
            T.push(
              '<li id="',
              this.idBloc + aNumeroBloc,
              '" style="position:absolute;top:-1000px" role="presentation">',
            );
            T.push(
              '<ul class="liste-as-options',
              this.cache.avecCBMultiSelection ? ' multi-selections ' : '',
              '" role="presentation">',
            );
          }
          aBloc.lignesVisibles.forEach((aNumeroLigne) => {
            T.push(
              this._composeLigne(
                this.ListeElements.get(aNumeroLigne),
                aNumeroLigne,
                aBloc.lignesVisibles,
              ),
            );
          });
          if (this.cache.scrollInfiniActif) {
            T.push('</ul>');
            T.push('</li>');
          }
        }
        return T.join('');
      }
      _majBlocsTacheFond() {
        clearTimeout(this.cache.timerMAJ);
        if (!this.listeDeroulee) {
          return;
        }
        if (this.cache.toutCalcule) {
          return;
        }
        let lNumeroACalculer = 0;
        const lToutCalcule = this.cache.blocs.every((aBloc, aNumeroBloc) => {
          if (!aBloc.calcule) {
            lNumeroACalculer = aNumeroBloc;
          }
          return !!aBloc.calcule;
        });
        if (lNumeroACalculer > 0) {
          this.cache.timerMAJ = setTimeout(
            function (aNumeroBloc) {
              const lBloc = this.cache.blocs[aNumeroBloc];
              const lASupprimer = !lBloc.dessine;
              this._majBloc(aNumeroBloc);
              if (lASupprimer) {
                $('#' + (this.idBloc + aNumeroBloc).escapeJQ()).remove();
                lBloc.dessine = false;
              }
              this._majBlocsTacheFond();
            }.bind(this, lNumeroACalculer),
            0,
          );
        }
        if (!this.cache.toutCalcule && lToutCalcule) {
          this.cache.toutCalcule = true;
          if (this._options.callbackToutCalcule) {
            this._options.callbackToutCalcule();
          }
          const lDernierBloc = this.cache.blocs[this.cache.blocs.length - 1];
          const lHeightScroll = lDernierBloc.top + lDernierBloc.height;
          if (lHeightScroll !== this.cache.heightScroll) {
            this.cache.heightScroll = lHeightScroll;
            $('#' + this.idContenuScroll.escapeJQ()).height(lHeightScroll);
          }
        }
      }
      _majBloc(aNumeroBloc, aSurFermeture) {
        if (!aSurFermeture) {
          const lBlocPrecedent = this.cache.blocs[aNumeroBloc - 1];
          if (lBlocPrecedent && !lBlocPrecedent.calcule) {
            this._majBloc(aNumeroBloc - 1);
          }
        }
        const lBloc = this.cache.blocs[aNumeroBloc];
        if (!lBloc) {
          return;
        }
        if (!lBloc.dessine) {
          lBloc.dessine = true;
          ObjetHtml_1.GHtml.addHtml(
            this.idContenuScroll,
            this._composeBloc(lBloc, aNumeroBloc),
            { controleur: this.controleur, ignorerScroll: true },
          );
        }
        if (!lBloc.calcule && !aSurFermeture) {
          const lJBloc = $('#' + (this.idBloc + aNumeroBloc).escapeJQ());
          lBloc.height = lJBloc.height();
          lBloc.top =
            aNumeroBloc === 0
              ? 0
              : this.cache.blocs[aNumeroBloc - 1].top +
                this.cache.blocs[aNumeroBloc - 1].height;
          lBloc.calcule = true;
          lJBloc.css('top', lBloc.top);
        }
      }
      _visibiliteSurNumeroBloc(aNumeroBlocVisible, aSurFermeture) {
        this.cache.blocs.forEach((aBloc, aNumeroBloc) => {
          const lVisible = aSurFermeture
            ? aNumeroBloc === aNumeroBlocVisible
            : aNumeroBloc <=
                aNumeroBlocVisible + this._options.nbBlocsScrollInfini &&
              aNumeroBloc >=
                aNumeroBlocVisible - this._options.nbBlocsScrollInfini;
          const lSurvolSurBloc =
            aBloc.debut <= this.Survolee && aBloc.fin >= this.Survolee;
          if (lVisible) {
            const lEstDejaDessine = aBloc.dessine;
            this._majBloc(aNumeroBloc, aSurFermeture);
            if (!lEstDejaDessine && lSurvolSurBloc) {
              this._selectionLigne(this.Survolee, true);
              ObjetHtml_1.GHtml.setFocus(this.Nom + '_' + this.Survolee);
            }
          } else {
            if (aBloc.dessine) {
              $('#' + (this.idBloc + aNumeroBloc).escapeJQ()).remove();
            }
            aBloc.dessine = false;
            if (lSurvolSurBloc) {
              ObjetHtml_1.GHtml.setFocus(this.idContenu);
            }
          }
        });
      }
      _majBlocsDeLigne(aLigne, aSurFermeture) {
        if (!this.cache.scrollInfiniActif) {
          return;
        }
        let lNumeroBloc = 0;
        this.cache.blocs.every((aBloc, aNumeroBloc) => {
          lNumeroBloc = aNumeroBloc;
          return aLigne >= 0 && (aLigne < aBloc.debut || aLigne > aBloc.fin);
        });
        this._visibiliteSurNumeroBloc(lNumeroBloc, aSurFermeture);
        if (!aSurFermeture) {
          this._majBlocsTacheFond();
        }
      }
      _majBlocsDeTop(aTop) {
        if (!this.cache.scrollInfiniActif) {
          return;
        }
        let lNumeroBlocVisible = 0;
        let lTrouve = false;
        let lDernierBlocCalcule = 0;
        this.cache.blocs.every((aBloc, aNumeroBloc) => {
          if (aBloc.calcule) {
            lDernierBlocCalcule = aNumeroBloc;
          }
          return !!aBloc.calcule;
        });
        this.cache.blocs.every((aBloc, aNumeroBloc) => {
          if (
            aBloc.calcule &&
            aBloc.top <= aTop &&
            aBloc.top + aBloc.height > aTop
          ) {
            lNumeroBlocVisible = aNumeroBloc;
            lTrouve = true;
          }
          return !lTrouve;
        });
        if (!lTrouve) {
          if (lDernierBlocCalcule >= 0) {
            this._majBloc(lDernierBlocCalcule + 1);
            this._majBlocsDeTop(aTop);
          }
          return;
        }
        this._visibiliteSurNumeroBloc(lNumeroBlocVisible);
        this._majBlocsTacheFond();
      }
      _surFocusLigne(event) {
        event.data.instance._arreterFermetureListe();
      }
      _surKeyDownListe(aEvent) {
        const lThis = aEvent.data.instance;
        if (
          lThis.listeDeroulee &&
          aEvent.which === ToucheClavier_1.ToucheClavier.Tab
        ) {
          if (!lThis._options.multiSelection) {
            lThis._surValidationClavier();
          }
        } else if (aEvent.which === ToucheClavier_1.ToucheClavier.Debut) {
          lThis.surLigne(lThis.chercherIndiceSelectionSelonSens(0));
        } else if (aEvent.which === ToucheClavier_1.ToucheClavier.Fin) {
          lThis.surLigne(lThis._getDerniereLingeSelectionnable());
        } else {
          lThis._defilerFleches(aEvent, true);
        }
      }
      _surKeyUpListe(event) {
        event.data.instance._defiler(event, true);
        if (event.which === ToucheClavier_1.ToucheClavier.Echap) {
          GNavigateur.stopperEvenement(event.originalEvent);
        }
      }
      _selectionnerUnElementEnMultiSelection(aIndice) {
        if (
          this._infosElementsCbs &&
          this._infosElementsCbs[aIndice] &&
          !this._infosElementsCbs[aIndice].selectionnable
        ) {
          return false;
        }
        if (this.ListeElements) {
          this.ListeElements.parcourir((D, aIndex) => {
            const lInfos = this._infosElementsCbs
              ? this._infosElementsCbs[aIndex]
              : null;
            if (lInfos && lInfos.selectionne) {
              lInfos.selectionne = false;
            }
          }, this);
        }
        this._setValueElementCB(aIndice, true);
        return true;
      }
      _surClickListe(event) {
        const T = this.id.split('_'),
          lIndice = parseInt(T[T.length - 1], 10),
          lInstance = event.data.instance;
        if (lInstance._options.multiSelection) {
          lInstance._selectionnerUnElementEnMultiSelection(lIndice);
        }
        lInstance.surValidation(true, lIndice);
      }
      _surMouseMoveListe(event) {
        const T = this.id.split('_');
        const lIndice = parseInt(T[T.length - 1], 10);
        const lInstance = event.data.instance;
        lInstance.surLigne(lIndice);
        lInstance._arreterFermetureListe();
      }
      _avecDeroulerListe() {
        const lNbVisibles = this.getNbElementsVisible();
        return (
          lNbVisibles > 1 ||
          (lNbVisibles > 0 &&
            this._options.mode ===
              Enumere_Saisie_1.EGenreSaisie.SaisieRecherche) ||
          (lNbVisibles > 0 &&
            this._options.multiSelection &&
            this._options.mode === Enumere_Saisie_1.EGenreSaisie.Combo) ||
          (!this._options.deroulerListeSeulementSiPlusieursElements &&
            lNbVisibles <= 1)
        );
      }
      _estOuvertureModale() {
        if (this._options.avecOuvertureDeroulantModale === true) {
          return true;
        }
        if (this._options.avecOuvertureDeroulantModale === false) {
          return false;
        }
        return IE.estMobile;
      }
      _deroulerListe(ASurvolee, aListeDejaRemplie, aSansFocusLigne) {
        if (this.listeDeroulee) {
          this.fermerListe();
          this.listeDeroulee = false;
          return;
        }
        const lParams = this._getParamsCallback({
          genreEvenement:
            Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
              .deploiement,
        });
        if (this._callback(lParams) === false) {
          if (this.Pere && this.Pere.$refreshSelf) {
            this.Pere.$refreshSelf();
          }
          return;
        }
        if (this._avecDeroulerListe()) {
          this._arreterFermetureListe();
          if (this._avecSaisieRechercheDynamique()) {
            setTimeout(this._arreterFermetureListe.bind(this), 0);
          }
          if (!aListeDejaRemplie) {
            this._remplirListe();
          }
          this.listeDeroulee = true;
          this.bouton.setOptionsObjetCelluleBouton({
            ariaExpanded: true,
            ariaControls: this.idContenuScroll,
          });
          const lElementListe = ObjetHtml_1.GHtml.getElement(this.NomListe);
          const lElementContenuListe = ObjetHtml_1.GHtml.getElement(
            this.idContenu,
          );
          ObjetHtml_1.GHtml.setDisplay(lElementListe, true);
          lElementContenuListe.style.overflowY = 'hidden';
          if (this._estOuvertureModale()) {
            const lCont = ObjetHtml_1.GHtml.getElement(this.nomListeConteneur);
            lCont.classList.add('visible');
            lCont.offsetWidth;
            lCont.classList.add('active');
            if (IE.estMobile && GNavigateur.getZIndexModalMobile) {
              lCont.style.zIndex = GNavigateur.getZIndexModalMobile(true) + '';
            }
          } else {
            ObjetStyle_1.GStyle.setZindex(lElementListe, 500);
            this.activerEventOut = false;
            setTimeout(() => {
              this.activerEventOut = true;
            }, 50);
          }
          const lObjet = this;
          $(lElementContenuListe)
            .css({ height: 0 })
            .animate(
              { height: lObjet.hauteurContenu + 'px' },
              this._options.dureeAnimationDeploiement,
            );
          if (this._ouvertureInverse) {
            $(lElementListe)
              .css({ top: -this.decalageTopOuvertureInverse })
              .animate(
                {
                  top:
                    -(
                      lObjet.hauteurContenu + this.decalageTopOuvertureInverse
                    ) + 'px',
                },
                this._options.dureeAnimationDeploiement,
              );
          }
          $(lElementContenuListe).queue(function () {
            $('#' + lObjet.idContenu.escapeJQ()).css('overflowY', 'auto');
            lObjet._eventAnimationOuvertureFin(ASurvolee, aSansFocusLigne);
            $(this).dequeue();
          });
        } else {
          this._gererCasUnSeulElement();
        }
      }
      _eventAnimationOuvertureFin(ASurvolee, aSansFocusLigne) {
        let lNumeroLigne =
          ASurvolee === null || ASurvolee === undefined
            ? this.Selection === null || this.Selection === undefined
              ? 0
              : this.Selection
            : ASurvolee;
        lNumeroLigne = this.chercherIndiceSelectionSelonSens(
          lNumeroLigne >= 0 ? lNumeroLigne : 0,
        );
        this.surLigne(lNumeroLigne, aSansFocusLigne);
      }
      _declencherFermetureListe(AAvecFocus) {
        clearTimeout(this.Timer);
        this.Timer = setTimeout(this.fermerListe.bind(this, AAvecFocus), 100);
      }
      _arreterFermetureListe() {
        clearTimeout(this.Timer);
        this.Timer = null;
      }
      _etapeFermetureInverse(aJElement, aNow) {
        aJElement.css({ top: -aNow - this.decalageTopOuvertureInverse });
      }
      _eventAnimationFermetureFin() {
        if (this._estOuvertureModale()) {
          ObjetHtml_1.GHtml.getElement(this.nomListeConteneur).classList.remove(
            'visible',
          );
          if (IE.estMobile && GNavigateur.getZIndexModalMobile) {
            GNavigateur.getZIndexModalMobile(false);
          }
        }
        setTimeout(
          ObjetHtml_1.GHtml.setDisplay.bind(
            ObjetHtml_1.GHtml,
            this.NomListe,
            false,
          ),
          5,
        );
        if (this._options.avecEventSurFermetureListe) {
          this._callback(
            this._getParamsCallback({
              genreEvenement:
                Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
                  .fermeture,
              indice: 0,
            }),
          );
          if (
            this.Pere &&
            this.Pere instanceof ObjetIdentite_1.Identite &&
            this.Pere.$refreshSelf
          ) {
            this.Pere.$refreshSelf();
          }
        }
      }
      _estSelectionnable(aElement) {
        return (
          !!aElement &&
          aElement.AvecSelection !== false &&
          aElement.Visible !== false &&
          (!this._options.getEstElementNonSelectionnable ||
            this._options.getEstElementNonSelectionnable(aElement) !== true)
        );
      }
      _selectionLigne(aLigne, aSelectionner) {
        if (aLigne > -1 && aLigne < this.ListeElements.count()) {
          const lElement = this.ListeElements.get(aLigne);
          if (aSelectionner && !this._estSelectionnable(lElement)) {
            return;
          }
          const lJDOM = $(`#${this.Nom.escapeJQ() + '_' + aLigne}`);
          if (lJDOM.length === 0) {
            return;
          }
          if (aSelectionner) {
            lJDOM.attr('tabindex', '0');
          } else {
            lJDOM.attr('tabindex', '-1');
          }
          if (this._options.avecFondSelectionSurSurvol) {
            if (aSelectionner) {
              lJDOM.addClass('selected');
            } else {
              lJDOM.removeClass('selected');
            }
          }
          if (this._options.avecGrasSurSurvol) {
            if (aSelectionner) {
              lJDOM.addClass('Gras');
            } else {
              lJDOM.removeClass('Gras');
            }
          }
        }
      }
      _gererCasUnSeulElement() {
        let lResult = false;
        if (this.getNbElementsVisible() === 1) {
          let LLibelle = '';
          let lEstHtml = false;
          let lElement;
          const lIndex = this.ListeElements.getIndiceElementParFiltre((aEl) => {
            return aEl.Visible !== false;
          });
          lElement = this.ListeElements.get(lIndex);
          if (lElement) {
            LLibelle = lElement.getLibelle();
            if (this._options.getContenuElement) {
              LLibelle = this._options.getContenuElement({
                element: lElement,
                indice: lIndex,
              });
            } else if (
              this._options.celluleAvecTexteHtml &&
              lElement.libelleHtml
            ) {
              LLibelle = lElement.libelleHtml;
              lEstHtml = true;
            }
          }
          if (LLibelle) {
            this.Selection = lIndex;
            if (this._options.controlerNbrElements) {
              ObjetHtml_1.GHtml.setHtml(
                this.Nom,
                '<span class="Gras Insecable">' + LLibelle + '</span>',
              );
            }
            this.surValidation(false, this.Selection);
            lResult = true;
          } else {
            this.Selection = -1;
          }
          if (this._options.modifierContenuCelluleSurSelection) {
            if (this._options.getContenuCellule) {
              this._appliquerGetContenuCellule(lElement);
            } else if (lEstHtml) {
              this.bouton.setLibelleHtml(LLibelle);
            } else {
              this.setContenu(LLibelle);
            }
            const lIdDescendant =
              this.Selection > -1 ? this.Nom + '_' + this.Selection : '';
            $(
              '#' +
                this.idContenuScroll.escapeJQ() +
                ', #' +
                this.bouton.NomEdit.escapeJQ(),
            ).attr(
              ObjetWAI_1.GObjetWAI.getAttribut(
                ObjetWAI_1.EGenreAttribut.activedescendant,
              ),
              ObjetHtml_1.GHtml.getElement(lIdDescendant)
                ? lIdDescendant
                : null,
            );
          }
        }
        this.$refreshSelf();
        return lResult;
      }
      _initListeSelections(aListeSelections) {
        const lListeSelections =
          MethodesObjet_1.MethodesObjet.dupliquer(aListeSelections);
        if (!this._listeSelections) {
          this._listeSelections = new ObjetListeElements_1.ObjetListeElements();
        }
        this._listeSelections.vider();
        let lResult = false;
        if (this.ListeElements) {
          this.ListeElements.parcourir((D, aIndex) => {
            const lElement = lListeSelections
              ? lListeSelections.getElementParNumero(D.getNumero())
              : null;
            if (lElement) {
              lResult = true;
              this._listeSelections.addElement(lElement);
              if (this._infosElementsCbs && this._infosElementsCbs[aIndex]) {
                this._infosElementsCbs[aIndex].selectionne = true;
              }
            } else if (
              this._infosElementsCbs &&
              this._infosElementsCbs[aIndex]
            ) {
              this._infosElementsCbs[aIndex].selectionne = false;
            }
          });
        }
        return lResult;
      }
      _getDerniereLingeSelectionnable() {
        return this.ListeElements && this.ListeElements.count
          ? this.chercherIndiceSelectionSelonSens(
              this.ListeElements.count() - 1,
              true,
            )
          : 0;
      }
    }
    exports.ObjetSaisie = ObjetSaisie;
    const lClasseJQ = GUID_1.GUID.getClassCss();
  },
  fn: 'objetsaisie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_EvenementObjetSaisie_1 = require('Enumere_EvenementObjetSaisie');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetSaisie_1 = require('ObjetSaisie');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetIdentite_1 = require('ObjetIdentite');
    IEHtml.addBalise('ie-combo', (aContexteCourant, aOutils) => {
      function _listesIdentiques(aListe1, aListe2) {
        return aListe1 && aListe1.listeIdentiqueParElementsOrdonnes
          ? aListe1.listeIdentiqueParElementsOrdonnes(aListe2)
          : false;
      }
      const lModele = aOutils.getModel(aContexteCourant),
        const_forcerActualisation = 'forcer_Actualisation';
      if (!lModele) {
        return;
      }
      const lInfosEvent = aOutils.getAccesParametresModel(
          'event',
          aContexteCourant,
        ),
        lInfosInit = aOutils.getAccesParametresModel('init', aContexteCourant),
        lInfosGetDonnees = aOutils.getAccesParametresModel(
          'getDonnees',
          aContexteCourant,
        ),
        lInfosGetIndice = aOutils.getAccesParametresModel(
          'getIndiceSelection',
          aContexteCourant,
        ),
        lInfosSetIndice = aOutils.getAccesParametresModel(
          'setIndiceSelection',
          aContexteCourant,
        ),
        lInfosGetLibelle = aOutils.getAccesParametresModel(
          'getLibelle',
          aContexteCourant,
        ),
        lInfosDestroy = aOutils.getAccesParametresModel(
          'destroy',
          aContexteCourant,
        ),
        lInfosGetDisabled = aOutils.getAccesParametresModel(
          'getDisabled',
          aContexteCourant,
        ),
        lAvecControleSaisie = aOutils.getControleSaisieEvent(aContexteCourant),
        lRefresh = aContexteCourant.contexte.refresh;
      let lListeSelectionsBackup = null;
      const lStrAriaLabel = aContexteCourant.node.getAttribute('aria-label');
      if (lStrAriaLabel) {
        aContexteCourant.node.removeAttribute('aria-label');
      }
      const lStrAriaLabelledBy =
        aContexteCourant.node.getAttribute('aria-labelledby');
      if (lStrAriaLabelledBy) {
        aContexteCourant.node.removeAttribute('aria-labelledby');
      }
      const lStrAriaDescribedBy =
        aContexteCourant.node.getAttribute('aria-describedby');
      if (lStrAriaDescribedBy) {
        aContexteCourant.node.removeAttribute('aria-describedby');
      }
      let lInstanceCombo = ObjetIdentite_1.Identite.creerInstance(
        ObjetSaisie_1.ObjetSaisie,
        {
          pere: aContexteCourant.controleur,
          evenement: function (aParams) {
            const lParametres = aParams;
            const lCallback = function () {
              if (
                lParametres.genreEvenement ===
                Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
                  .selection
              ) {
                if (
                  (lParametres.estComboMultiSelection &&
                    !_listesIdentiques(
                      lParametres.listeSelections,
                      lListeSelectionsBackup,
                    )) ||
                  (MethodesObjet_1.MethodesObjet.isNumber(lParametres.indice) &&
                    lParametres.indice !== aContexteCourant.data.$indice) ||
                  aContexteCourant.data.$indice === const_forcerActualisation
                ) {
                  if (lInfosSetIndice.estFonction) {
                    lInfosSetIndice.callback([
                      lParametres.estComboMultiSelection
                        ? lParametres.listeSelections
                        : lParametres.indice,
                      lInstanceCombo,
                      aContexteCourant.data,
                    ]);
                  }
                  aContexteCourant.data.$indice = lParametres.indice;
                }
              }
              if (lInfosEvent.estFonction) {
                lInfosEvent.callback([
                  lParametres,
                  lInstanceCombo,
                  aContexteCourant.data,
                ]);
              }
              lRefresh();
            };
            lCallback();
          },
        },
      );
      lInstanceCombo.ControleNavigation = !!lAvecControleSaisie;
      const lRacine = ObjetHtml_1.GHtml.htmlToDOM(
          '<div id="' + lInstanceCombo.getNom() + '"></div>',
        ),
        lJRacine = $(lRacine);
      if (
        IE.estMobile &&
        !aContexteCourant.node.classList.contains('combo-classic')
      ) {
        if (aContexteCourant.node.classList.contains('membre-combo')) {
          lInstanceCombo.setOptionsObjetSaisie({
            iconeGauche: '',
            avecBouton: true,
          });
        } else if (aContexteCourant.node.classList.contains('search-contain')) {
          lInstanceCombo.setOptionsObjetSaisie({
            avecDesignMobile: true,
            iconeGauche: '',
            avecBouton: true,
          });
        } else {
          lInstanceCombo.setOptionsObjetSaisie({
            avecDesignMobile: true,
            iconeGauche: 'icon_reorder',
            avecBouton: false,
          });
        }
      }
      if (lStrAriaLabel || lStrAriaLabelledBy || lStrAriaDescribedBy) {
        lInstanceCombo.setOptionsObjetSaisie({
          labelWAICellule: lStrAriaLabel || '',
          labelledById: lStrAriaLabelledBy || '',
          describedById: lStrAriaDescribedBy || '',
        });
      }
      const lParams = {
        liste: new ObjetListeElements_1.ObjetListeElements(),
        indice: -1,
      };
      if (lInfosInit.estFonction) {
        lInfosInit.callback([lInstanceCombo, aContexteCourant.data]);
      }
      const lRemplirListe = (aNode, aParams, aAEstFils) => {
        if (aNode && aNode.childNodes) {
          for (let i = 0; i < aNode.childNodes.length; i++) {
            const lNode = aNode.childNodes[i];
            const lNodeName = lNode.nodeName.toLowerCase();
            if (lNodeName && lNodeName === 'option') {
              const lArticle = ObjetElement_1.ObjetElement.create({
                Libelle: lNode.innerHTML,
                Numero: lNode.value,
                node: lNode,
                avecIndentation: aAEstFils,
              });
              aParams.liste.add(lArticle);
              if (lNode.getAttribute('selected') === 'selected') {
                aParams.indice = aParams.liste.count() - 1;
              }
            } else if (lNodeName && lNodeName === 'optgroup') {
              const lLibelle = lNode.getAttribute('label') || '';
              aParams.liste.add(
                ObjetElement_1.ObjetElement.create({
                  Libelle: lLibelle,
                  AvecSelection: false,
                  estCumul: true,
                  node: lNode,
                }),
              );
              lRemplirListe(lNode, aParams, true);
            }
          }
        }
      };
      lRemplirListe(aContexteCourant.node, lParams);
      if (lParams.liste.count() > 0) {
        lInstanceCombo.setDonneesObjetSaisie({
          liste: lParams.liste,
          selection: lParams.indice,
          options: {
            getClassElement(aParams) {
              if (aParams.element.estCumul) {
                return 'liste-fond-cumul';
              } else if (aParams.element.avecIndentation) {
                return 'element-indentation';
              }
              return '';
            },
          },
        });
        if (lParams.indice < 0) {
          lInstanceCombo.initSelection(0);
        }
      }
      aOutils.injectHTML({
        element: lRacine,
        html: lInstanceCombo.construireAffichage(),
        controleur: lInstanceCombo.controleur,
        ignorerScroll: true,
        contexte: aContexteCourant.contexte,
      });
      lJRacine.ieData(aContexteCourant.data);
      lJRacine.on('destroyed', () => {
        if (lInfosDestroy.estFonction) {
          lInfosDestroy.callback([lInstanceCombo, aContexteCourant.data]);
        }
        lInstanceCombo.free();
        lInstanceCombo = null;
      });
      aOutils.surInjectionHtml(aContexteCourant, () => {
        lInstanceCombo.recupererDonnees();
        let lActualiserSelection;
        const lDemarrerGetIndice = function () {
          if (lInfosGetIndice.estFonction) {
            let lGetterIndice;
            lActualiserSelection = function () {
              if (!lInstanceCombo) {
                return;
              }
              let lIndice = lGetterIndice();
              const lEstListe =
                lInstanceCombo.getDonneesPourHTMLCombo().options.multiSelection;
              if (
                (lEstListe &&
                  (!lListeSelectionsBackup ||
                    !lListeSelectionsBackup.preventionBoucle) &&
                  !_listesIdentiques(lIndice, lListeSelectionsBackup)) ||
                (!lEstListe && lIndice !== aContexteCourant.data.$indice) ||
                aContexteCourant.data.$indice === const_forcerActualisation
              ) {
                if (lEstListe) {
                  if (
                    lIndice &&
                    lIndice instanceof ObjetListeElements_1.ObjetListeElements
                  ) {
                    lListeSelectionsBackup = lIndice;
                  } else {
                    lListeSelectionsBackup =
                      new ObjetListeElements_1.ObjetListeElements();
                  }
                  lListeSelectionsBackup.preventionBoucle = true;
                  lInstanceCombo.setListeSelections(lIndice);
                } else {
                  const lIndiceNumber = lIndice;
                  aContexteCourant.data.$indice = lIndiceNumber;
                  if (
                    lInstanceCombo.getNbElementsVisible() === 0 &&
                    lIndiceNumber < 0
                  ) {
                    lInstanceCombo.surValidation(false, lIndiceNumber);
                  } else if (lIndiceNumber >= 0) {
                    lInstanceCombo.setSelection(lIndiceNumber);
                  }
                }
              } else if (
                lListeSelectionsBackup &&
                lListeSelectionsBackup.preventionBoucle
              ) {
                lListeSelectionsBackup.preventionBoucle = false;
              }
            };
            lGetterIndice = function () {
              let lIndice =
                lInfosGetIndice.callback([
                  lInstanceCombo,
                  aContexteCourant.data,
                ]) || 0;
              if (
                !lInstanceCombo.getDonneesPourHTMLCombo().options.multiSelection
              ) {
                lIndice = lInstanceCombo.chercherIndiceSelectionSelonSens(
                  lIndice,
                  false,
                );
              }
              return lIndice;
            };
            const lIndice = lGetterIndice();
            if (
              lInstanceCombo.getDonneesPourHTMLCombo().options.multiSelection
            ) {
              if (
                lIndice &&
                lIndice instanceof ObjetListeElements_1.ObjetListeElements
              ) {
                lListeSelectionsBackup = lIndice;
              } else {
                lListeSelectionsBackup =
                  new ObjetListeElements_1.ObjetListeElements();
              }
              lInstanceCombo.setListeSelections(lListeSelectionsBackup);
            } else {
              aContexteCourant.data.$indice = lIndice;
              if (lIndice >= 0) {
                lInstanceCombo.setSelection(lIndice);
              }
            }
            aOutils.abonnerRefresh(
              lActualiserSelection,
              lRacine,
              aContexteCourant,
            );
          }
        };
        if (lInfosGetDonnees.estFonction) {
          const lGetterDonnees = function () {
            return (
              lInfosGetDonnees.callback([
                lInstanceCombo.getListeElements(),
                lInstanceCombo,
                aContexteCourant.data,
              ]) || null
            );
          };
          const lDonnees = lGetterDonnees();
          let lComboInitialise = false;
          if (lDonnees && lDonnees.count) {
            lInstanceCombo.setDonneesObjetSaisie({ liste: lDonnees });
            lDemarrerGetIndice();
            lComboInitialise = true;
          }
          aOutils.abonnerRefresh(
            () => {
              if (!lInstanceCombo) {
                IE.log.addLog("lInstanceCombo n'existe pas");
                return null;
              }
              const lDonnees = lGetterDonnees();
              const lListeCourante = lInstanceCombo.getListeElements();
              if (
                lDonnees &&
                lDonnees.count &&
                lListeCourante !== lDonnees &&
                !(
                  lDonnees.count() === 0 &&
                  lListeCourante &&
                  lListeCourante.count &&
                  lListeCourante.count() === 0
                )
              ) {
                lInstanceCombo.setDonneesObjetSaisie({ liste: lDonnees });
                aContexteCourant.data.$indice = const_forcerActualisation;
                if (!lComboInitialise) {
                  lDemarrerGetIndice();
                  lComboInitialise = true;
                } else if (lActualiserSelection) {
                  lActualiserSelection();
                }
              }
            },
            lRacine,
            aContexteCourant,
          );
        } else {
          lDemarrerGetIndice();
        }
        if (lInfosGetLibelle.estFonction) {
          const lGetterLibelle = function () {
            return lInfosGetLibelle.callback([
              lInstanceCombo,
              aContexteCourant.data,
            ]);
          };
          const lLibelle = lGetterLibelle();
          if (lLibelle === '' || (lLibelle && lLibelle.length > 0)) {
            lInstanceCombo.setContenu(lLibelle);
          }
          aOutils.abonnerRefresh(
            () => {
              if (!lInstanceCombo) {
                IE.log.addLog("lInstanceCombo n'existe pas");
                return null;
              }
              const lLibelle = lGetterLibelle();
              if (
                (lLibelle === '' || (lLibelle && lLibelle.length > 0)) &&
                lLibelle !==
                  lInstanceCombo.getDonneesPourHTMLCombo().bouton.getLibelle()
              ) {
                lInstanceCombo.setContenu(lLibelle);
              }
            },
            lRacine,
            aContexteCourant,
          );
        }
      });
      if (lInfosGetDisabled.estFonction) {
        const lGetterDisabled = function () {
          return !!lInfosGetDisabled.callback([
            lInstanceCombo,
            aContexteCourant.data,
          ]);
        };
        const lEstDisabled = lGetterDisabled();
        aContexteCourant.data.$disabled = lEstDisabled;
        if (lEstDisabled) {
          lInstanceCombo.setActif(false);
        }
        aOutils.abonnerRefresh(
          () => {
            if (!lInstanceCombo) {
              IE.log.addLog("lInstanceCombo n'existe pas");
              return null;
            }
            const lEstDisabled = lGetterDisabled();
            if (lEstDisabled !== aContexteCourant.data.$disabled) {
              aContexteCourant.data.$disabled = lEstDisabled;
              lInstanceCombo.setActif(!lEstDisabled);
            }
          },
          lRacine,
          aContexteCourant,
        );
      }
      if (lModele && aContexteCourant.data.$modeleParsed) {
        aOutils.surNodeEtNodeAfter(aContexteCourant);
      }
      aOutils.copyAttributs(aContexteCourant.node, lRacine, (aName) => {
        if (aName === 'id') {
          return false;
        }
      });
      lJRacine.addClass('ObjetSaisie ie-combo');
      aOutils.replaceNode(aContexteCourant.node, lRacine);
      aOutils.addCommentaireDebug(
        lRacine,
        'ie-combo ie-model="' + lModele + '"',
      );
      if (lStrAriaLabel) {
        aOutils.addCommentaireDebug(
          lRacine,
          `transfert aria-label="${lStrAriaLabel}"`,
        );
      }
      if (lStrAriaLabelledBy) {
        aOutils.addCommentaireDebug(
          lRacine,
          `transfert aria-labelledby="${lStrAriaLabelledBy}"`,
        );
      }
      if (lStrAriaDescribedBy) {
        aOutils.addCommentaireDebug(
          lRacine,
          `transfert aria-describedby="${lStrAriaDescribedBy}"`,
        );
      }
      return { node: lRacine, avecCompileFils: false };
    });
  },
  fn: 'iehtml.combo.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IEHtml.Bouton.css');
    const IEHtml = require('IEHtml');
    const ObjetHtml_1 = require('ObjetHtml');
    const ControleSaisieEvenement_1 = require('ControleSaisieEvenement');
    const ToucheClavier_1 = require('ToucheClavier');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const MethodesObjet_1 = require('MethodesObjet');
    const u_Dots = '...';
    IEHtml.addBalise('ie-bouton', (aContexteCourant, aOutils) => {
      let lOptions = {
        disabled: false,
        theme: Type_ThemeBouton_1.TypeThemeBouton.secondaire,
        tailleBordure: null,
        fontWeight: '',
        hasDots: false,
      };
      function _getCss(aSurvol) {
        const lStyle = {};
        let lColor =
          (lOptions.disabled
            ? lOptions.couleurTexteInactif
            : aSurvol
              ? lOptions.couleurTexteSurvol
              : lOptions.couleurTexte) || '';
        if (lColor) {
          lStyle.color = lColor;
        }
        lColor =
          (lOptions.disabled
            ? lOptions.couleurFondInactif
            : aSurvol
              ? lOptions.couleurFondSurvol
              : lOptions.couleurFond) || '';
        if (lColor) {
          lStyle.backgroundColor = lColor;
        }
        if (
          lOptions.tailleBordure >= 0 &&
          MethodesObjet_1.MethodesObjet.isNumber(lOptions.tailleBordure)
        ) {
          lStyle.borderWidth = lOptions.tailleBordure + 'px';
        }
        lColor =
          (lOptions.disabled
            ? lOptions.couleurBordureInactif
            : aSurvol
              ? lOptions.couleurBordureSurvol
              : lOptions.couleurBordure) || '';
        if (lColor) {
          lStyle.borderColor = lColor;
        }
        return lStyle;
      }
      function _estToucheValider(aNumeroTouche) {
        return (
          aNumeroTouche === ToucheClavier_1.ToucheClavier.Espace ||
          aNumeroTouche === ToucheClavier_1.ToucheClavier.RetourChariot
        );
      }
      let lInnerHtml = aContexteCourant.node.innerHTML;
      const lInnerHtmlInitial = lInnerHtml;
      const lBouton = ObjetHtml_1.GHtml.htmlToDOM('<button>' + '</button>');
      const lJBouton = $(lBouton);
      if (lInnerHtml === u_Dots) {
        lOptions.hasDots = true;
      }
      if (
        $(aContexteCourant.node).hasClass(
          Type_ThemeBouton_1.TypeThemeBouton.primaire,
        )
      ) {
        lOptions.theme = Type_ThemeBouton_1.TypeThemeBouton.primaire;
      }
      const lImage = aContexteCourant.node.getAttribute('ie-image') || '';
      if (lImage) {
        aContexteCourant.node.removeAttribute('ie-image');
      }
      const lImageIcon = aContexteCourant.node.getAttribute('ie-icon') || '';
      if (lImageIcon) {
        aContexteCourant.node.removeAttribute('ie-icon');
      }
      const lIconSize = aContexteCourant.node.getAttribute('ie-iconsize') || '';
      if (lIconSize) {
        aContexteCourant.node.removeAttribute('ie-iconsize');
      }
      const lEstBoutonCarre = $(aContexteCourant.node).hasClass('bouton-carre');
      if (lEstBoutonCarre) {
        let lWidthDefaut = 0;
        if (aContexteCourant.node.style.width) {
          const lWidth = Math.round($(aContexteCourant.node).innerWidth());
          if (lWidth > 0) {
            lWidthDefaut = Math.max(10, lWidth - 2 - 2);
          }
        }
        lOptions = Object.assign(lOptions, {
          theme: Type_ThemeBouton_1.TypeThemeBouton.neutre,
          widthBoutonImage: lWidthDefaut,
          heightTexteBoutonImage: 0,
          heightImageBoutonImage: 0,
        });
      }
      let lDisabled = false;
      const lModele = aOutils.getModel(aContexteCourant);
      let lInfosGetLibelle;
      if (lModele && aContexteCourant.data.$modeleParsed) {
        const lInfosEvent = aOutils.getAccesParametresModel(
            'event',
            aContexteCourant,
          ),
          lInfosGetDisabled = aOutils.getAccesParametresModel(
            'getDisabled',
            aContexteCourant,
          ),
          lInfosGetOptions = aOutils.getAccesParametresModel(
            'getOptions',
            aContexteCourant,
          );
        lInfosGetLibelle = aOutils.getAccesParametresModel(
          'getLibelle',
          aContexteCourant,
        );
        const lAvecControleSaisie =
          aOutils.getControleSaisieEvent(aContexteCourant);
        let lKeyUpValiderAIgnorer = false;
        if (lInfosEvent.estFonction) {
          const lRefresh = aContexteCourant.contexte.refresh;
          lJBouton
            .eventValidation(function (aEvent) {
              if (lOptions.disabled) {
                return;
              }
              if (aEvent.type === 'keyup') {
                if (lKeyUpValiderAIgnorer) {
                  lKeyUpValiderAIgnorer = false;
                  return;
                }
              }
              const lAction = () => {
                const lResult = lInfosEvent.callback([
                  aEvent,
                  this,
                  aContexteCourant.data,
                ]);
                lRefresh();
                return lResult;
              };
              if (lAvecControleSaisie) {
                (0, ControleSaisieEvenement_1.ControleSaisieEvenement)(lAction);
              } else {
                return lAction();
              }
            })
            .on({
              focusin: function () {
                if (
                  window.GNavigateur &&
                  window.GNavigateur.ShiftTouche !== null
                ) {
                  lKeyUpValiderAIgnorer = _estToucheValider(
                    window.GNavigateur.CodeTouche,
                  );
                  if (lKeyUpValiderAIgnorer) {
                    $(window)
                      .off('keydown.IEHTMLBoutonKeyupAIgnorer')
                      .one('keydown.IEHTMLBoutonKeyupAIgnorer', () => {
                        lKeyUpValiderAIgnorer = false;
                      });
                  }
                }
              },
              focusout: function () {
                lKeyUpValiderAIgnorer = false;
              },
            });
        }
        if (lInfosGetDisabled.valide) {
          const lGetter = function () {
            return !!lInfosGetDisabled.callback([
              lBouton,
              aContexteCourant.data,
            ]);
          };
          if (
            lInfosGetDisabled.estFonction ||
            !lGetter() ||
            lGetter() === true
          ) {
            lDisabled = !!lGetter();
            aOutils.abonnerRefresh(
              () => {
                const lDisabled = !!lGetter();
                if (lDisabled !== lOptions.disabled) {
                  lOptions.disabled = lDisabled;
                  $(lBouton).inputDisabled(lDisabled);
                }
              },
              lBouton,
              aContexteCourant,
            );
          } else {
            IE.log.addLog(
              'echec getDisabled de ie-bouton, propriété incorrecte du model "' +
                lModele +
                '"',
            );
          }
        }
        if (lInfosGetOptions.estFonction) {
          const lOptionsPerso = lInfosGetOptions.callback([
            lBouton,
            aContexteCourant.data,
          ]);
          if (lOptionsPerso) {
            Object.assign(lOptions, lOptionsPerso);
          }
        }
        aOutils.surNodeEtNodeAfter(aContexteCourant);
        aContexteCourant.invocateurNode.abonner(
          aOutils.nomInvocRefresh,
          (aParams) => {
            if (aParams.refreshHtml) {
              const lHasDots = aParams.html === u_Dots;
              if (lOptions.hasDots !== lHasDots) {
                lOptions.hasDots = lHasDots;
                if (lOptions.hasDots) {
                  lJBouton.addClass('has-dots');
                } else {
                  lJBouton.removeClass('has-dots');
                }
              }
            }
          },
        );
      }
      aOutils.copyAttributs(aContexteCourant.node, lBouton, (aName) => {
        switch (aName) {
          case 'disabled':
            lDisabled = true;
            break;
        }
      });
      let lClassDefaut = '';
      if (!lBouton.style.height && !lImage && !lImageIcon) {
        lClassDefaut = ' ieBoutonDefautSansImage';
      }
      switch (lOptions.theme) {
        case Type_ThemeBouton_1.TypeThemeBouton.primaire:
          if (
            !lJBouton.hasClass(Type_ThemeBouton_1.TypeThemeBouton.secondaire) &&
            !lJBouton.hasClass(Type_ThemeBouton_1.TypeThemeBouton.neutre)
          ) {
            lJBouton.addClass(Type_ThemeBouton_1.TypeThemeBouton.primaire);
          }
          break;
        case Type_ThemeBouton_1.TypeThemeBouton.neutre:
          if (
            !lJBouton.hasClass(Type_ThemeBouton_1.TypeThemeBouton.secondaire) &&
            !lJBouton.hasClass(Type_ThemeBouton_1.TypeThemeBouton.primaire)
          ) {
            lJBouton.addClass(Type_ThemeBouton_1.TypeThemeBouton.neutre);
          }
          break;
      }
      if (!lDisabled && lOptions.disabled) {
        lJBouton.attr('disabled', '');
      } else if (lDisabled) {
        $(lBouton).inputDisabled(true);
      }
      lOptions.disabled = lDisabled;
      const lCss = { 'font-weight': lOptions.fontWeight };
      let lWrapperHtml;
      if (lImage || lImageIcon) {
        lWrapperHtml = function (aHtml) {
          return IE.jsx.str('span', { 'ie-ellipsis-multiline': true }, aHtml);
        };
        const lHtmlImage = lImage
          ? IE.jsx.str('span', { class: lImage })
          : IE.jsx.str('i', {
              class: ['ieBoutonIcon', lImageIcon],
              style: lIconSize ? `font-size:${lIconSize}` : false,
              'aria-hidden': 'true',
            });
        if (lEstBoutonCarre) {
          lInnerHtml = [
            IE.jsx.str('span', { class: 'ieBtnContImg-img' }, lHtmlImage),
            IE.jsx.str(
              'span',
              { class: 'ieBtnContImg-texte' },
              lWrapperHtml(lInnerHtml),
            ),
          ].join('');
          lCss.padding = 1;
        } else {
          lInnerHtml = IE.jsx.str(
            'span',
            { class: 'ieBtnContImg-img' },
            IE.jsx.str(
              IE.jsx.fragment,
              null,
              lHtmlImage,
              IE.jsx.str(
                'span',
                {
                  'ie-ellipsis':
                    aContexteCourant.node.hasAttribute('ie-ellipsis'),
                },
                lInnerHtml,
              ),
            ),
          );
        }
      }
      if (lOptions.minWidth > 0) {
        lCss['min-width'] = lOptions.minWidth + 'px';
      }
      let lClasse = 'ieBouton ';
      lClasse += 'ie-ripple ';
      lClasse = (lOptions.hasDots ? 'has-dots ' : '') + lClasse;
      lJBouton
        .css(Object.assign(lCss, _getCss()))
        .addClass(lClasse + ' NoWrap' + lClassDefaut)
        .on({
          mouseout: function () {
            if (window.GNavigateur && window.GNavigateur.isTactile) {
              return;
            }
            if (lOptions.disabled) {
              return;
            }
            $(this).css(_getCss(false));
          },
          mouseover: function () {
            if (window.GNavigateur && window.GNavigateur.isTactile) {
              return;
            }
            if (lOptions.disabled) {
              return;
            }
            $(this).css(_getCss(true));
          },
          IEDisabled: function () {
            const lJThis = $(this);
            lOptions.disabled = lJThis.is(':disabled');
            if (lOptions.disabled) {
              lJThis.removeClass('AvecMain');
            } else {
              lJThis.addClass('AvecMain');
            }
            lJThis.css(_getCss());
          },
        });
      const lRacine = lJBouton.get(0);
      aOutils.replaceNode(aContexteCourant.node, lRacine);
      aContexteCourant.node = lJBouton.get(0);
      if (lInnerHtml) {
        aOutils.injectHTML({
          element: lRacine,
          html: lInnerHtml,
          controleur: aContexteCourant.controleur,
          ignorerScroll: true,
          contexte: aContexteCourant.contexte,
        });
      }
      if (lImage || lImageIcon) {
        if (lEstBoutonCarre) {
          aContexteCourant.nodeTransfertContenuDynamique = $(
            aContexteCourant.node,
          )
            .find('>.ieBtnContImg-texte')
            .get(0);
        } else {
          aContexteCourant.nodeTransfertContenuDynamique = $(
            aContexteCourant.node,
          )
            .find('>.ieBtnContImg-img>:not(:first-child)')
            .get(0);
        }
      }
      if (lInfosGetLibelle && lInfosGetLibelle.estFonction) {
        aOutils.addGetterHtml(aContexteCourant, lInfosGetLibelle, lWrapperHtml);
      }
      aOutils.addCommentaireDebug(
        lRacine,
        'ie-bouton' +
          (lImage ? ' ie-image="' + lImage + '"' : '') +
          (lImageIcon ? ' ie-icon="' + lImageIcon + '"' : '') +
          (lIconSize ? ' ie-iconsize="' + lIconSize + '"' : ''),
      );
      return { node: aContexteCourant.node, avecCompileFils: false };
    });
  },
  fn: 'iehtml.bouton.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const ObjetHtml_1 = require('ObjetHtml');
    const ToucheClavier_1 = require('ToucheClavier');
    require('IEHtml.BtnSelecteur.css');
    IEHtml.addBalise('ie-btnselecteur', (aContexteCourant, aOutils) => {
      const lEstMultilines =
        aContexteCourant.node.classList.contains('multilignes');
      const lInnerHtml = aContexteCourant.node.innerHTML;
      const lBtn = ObjetHtml_1.GHtml.htmlToDOM(
        IE.jsx.str(
          'div',
          {
            class: ['ie-btnselecteur', 'ie-ripple'],
            tabindex: '0',
            'aria-haspopup': 'dialog',
          },
          IE.jsx.str('div', { class: 'bs-icone', 'aria-hidden': 'true' }),
          IE.jsx.str(
            'div',
            { class: 'bs-libelle', 'ie-ellipsis': !lEstMultilines },
            lInnerHtml,
          ),
        ),
      );
      const lJBtn = $(lBtn);
      const lDOMIcone = lJBtn.find('>.bs-icone').get(0);
      const lDOMLibelle = lJBtn.find('>.bs-libelle').get(0);
      const lModele = aOutils.getModel(aContexteCourant);
      let lInfosGetLibelle = null;
      let lInfosEvent = null;
      let lInfosGetHtmIcone = null;
      let lDisabled =
        aContexteCourant.node.getAttribute('aria-disabled') === 'true';
      const lFuncActualiserDisabled = () => {
        if (lDisabled) {
          aContexteCourant.node.setAttribute('aria-disabled', 'true');
        } else {
          aContexteCourant.node.removeAttribute('aria-disabled');
        }
      };
      if (lModele) {
        lInfosEvent = aOutils.getAccesParametresModel(
          'event',
          aContexteCourant,
        );
        const lInfosGetDisabled = aOutils.getAccesParametresModel(
          'getDisabled',
          aContexteCourant,
        );
        lInfosGetLibelle = aOutils.getAccesParametresModel(
          'getLibelle',
          aContexteCourant,
        );
        lInfosGetHtmIcone = aOutils.getAccesParametresModel(
          'getIcone',
          aContexteCourant,
        );
        if (lInfosGetDisabled.estFonction) {
          lDisabled = !!lInfosGetDisabled.callback([]);
          lFuncActualiserDisabled();
          aOutils.abonnerRefresh(
            () => {
              const lDisabledNew = !!lInfosGetDisabled.callback([]);
              if (lDisabledNew !== lDisabled) {
                lDisabled = lDisabledNew;
                lFuncActualiserDisabled();
              }
            },
            lBtn,
            aContexteCourant,
          );
        }
      }
      let lHtmlPlaceHolder = '';
      aOutils.copyAttributs(aContexteCourant.node, lBtn, (aName, aValue) => {
        if (aName === 'class' && aValue) {
          lJBtn.addClass(aValue);
          return false;
        }
        if (aName === 'placeholder' && aValue) {
          lHtmlPlaceHolder = IE.jsx.str(
            'span',
            { class: 'as-placeholder', 'aria-disabled': 'true' },
            aValue,
          );
          return false;
        }
      });
      let lRole = lBtn.getAttribute('role');
      if (!lRole) {
        lRole = 'combobox';
        lBtn.setAttribute('role', lRole);
      }
      const lEstComboBox = lRole === 'combobox';
      if (lEstComboBox && !lBtn.hasAttribute('aria-expanded')) {
        lBtn.setAttribute('aria-expanded', 'false');
      }
      const lTitle = lBtn.getAttribute('title');
      if (
        lTitle &&
        !lBtn.getAttribute('aria-label') &&
        !lBtn.getAttribute('aria-labelledby')
      ) {
        lBtn.setAttribute('aria-label', lTitle);
      }
      if (lInfosEvent && lInfosEvent.estFonction) {
        lJBtn.eventValidation((aEvent) => {
          if (!lDisabled) {
            lInfosEvent.callback([aEvent, lBtn]);
          }
        });
        if (lEstComboBox) {
          lJBtn.on('keyup', function (aEvent) {
            if (aEvent.which === ToucheClavier_1.ToucheClavier.FlecheBas) {
              lInfosEvent.callback([aEvent, lBtn]);
            }
          });
        }
      }
      const lAvecGetHtmlIcone =
        lInfosGetHtmIcone && lInfosGetHtmIcone.estFonction;
      if (!lAvecGetHtmlIcone) {
        $(lDOMIcone).html(
          IE.jsx.str('i', {
            class: IE.estMobile ? 'icon_ul' : 'icon_ellipsis_horizontal',
          }),
        );
      }
      aOutils.surNodeEtNodeAfter(aContexteCourant);
      aOutils.replaceNode(aContexteCourant.node, lBtn);
      aContexteCourant.node = lBtn;
      if (lInfosGetLibelle && lInfosGetLibelle.estFonction) {
        aContexteCourant.nodeTransfertContenuDynamique = lDOMLibelle;
        const lGet = {
          callback() {
            let lResult = lInfosGetLibelle.callback([]) || '';
            if (!lResult && lHtmlPlaceHolder) {
              lResult = lHtmlPlaceHolder;
            }
            return lResult;
          },
          estFonction: true,
        };
        aOutils.addGetterHtml(aContexteCourant, lGet);
      }
      if (lAvecGetHtmlIcone) {
        aContexteCourant.nodeTransfertContenuDynamique = lDOMIcone;
        aOutils.addGetterHtml(aContexteCourant, lInfosGetHtmIcone);
      }
      if (
        GApplication.estDebug() &&
        lEstComboBox &&
        !lBtn.getAttribute('aria-label') &&
        !lBtn.getAttribute('aria-labelledby')
      ) {
      }
      aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-btnselecteur');
      return { node: aContexteCourant.node, avecCompileFils: true };
    });
  },
  fn: 'iehtml.btnselecteur.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ZoneDessinEvenement = void 0;
    const IEHtml = require('IEHtml');
    const ObjetHtml_1 = require('ObjetHtml');
    const DeferLoadingScript_1 = require('DeferLoadingScript');
    require('signature_pad.umd.min.js');
    require('signature_pad.umd.js');
    require('IEHtml.ZoneDessin.css');
    var ZoneDessinEvenement;
    (function (ZoneDessinEvenement) {
      ZoneDessinEvenement['DebutDessin'] = 'ZD_DebutDessin';
      ZoneDessinEvenement['FinDessin'] = 'ZD_FinDessin';
      ZoneDessinEvenement['Effacement'] = 'ZD_Effacement';
      ZoneDessinEvenement['AnnulerDernierTrait'] = 'ZD_AnnulerDernierTrait';
    })(
      ZoneDessinEvenement ||
        (exports.ZoneDessinEvenement = ZoneDessinEvenement = {}),
    );
    const cFacteurTraitTailleMin = 0.5;
    const cFacteurTraitTailleMax = 2.5;
    IEHtml.addBalise('ie-zonedessin', (aContexteCourant, aOutils) => {
      let lEstZoneDessinDisabled = false;
      let lSignaturePad;
      let lInfosDestroy;
      const lInnerDivGlobal = IE.jsx.str('div', { class: 'ie-zonedessin' });
      const lElementDivGlobal = ObjetHtml_1.GHtml.htmlToDOM(lInnerDivGlobal);
      const lJDivGlobal = $(lElementDivGlobal);
      let lJDivCanvas = null;
      let lFaireInitTaille = true;
      const lControleurCanvas = {
        visibility(aVisible) {
          if (aVisible && lFaireInitTaille) {
            lFaireInitTaille = false;
            const lWidthParent = lJDivGlobal.width();
            const lHeightParent = lJDivGlobal.height();
            lJDivCanvas
              .attr('width', lWidthParent)
              .attr('height', lHeightParent);
          }
        },
      };
      aOutils.injectHTML({
        element: lElementDivGlobal,
        html: IE.jsx.str('canvas', { 'ie-visibility-observer': 'visibility' }),
        controleur: lControleurCanvas,
        ignorerScroll: true,
        contexte: aContexteCourant.contexte,
      });
      lJDivCanvas = $(lElementDivGlobal).find('>canvas');
      const lElementCanvas = lJDivCanvas.get(0);
      const lOptionsZoneDessin = { couleurCrayon: '#000', tailleCrayon: 1 };
      DeferLoadingScript_1.deferLoadingScript
        .loadAsync(['signature-pad'])
        .then(() => {
          let lInfosInitialiseZoneDessin;
          let lInfosSurEvenementZoneDessin;
          const lModele = aOutils.getModel(aContexteCourant);
          if (lModele && aContexteCourant.data.$modeleParsed) {
            lInfosInitialiseZoneDessin = aOutils.getAccesParametresModel(
              'initialiseZoneDessin',
              aContexteCourant,
            );
            lInfosDestroy = aOutils.getAccesParametresModel(
              'destroy',
              aContexteCourant,
            );
            const lInfosGetOptions = aOutils.getAccesParametresModel(
              'getOptions',
              aContexteCourant,
            );
            if (lInfosGetOptions && lInfosGetOptions.estFonction) {
              Object.assign(lOptionsZoneDessin, lInfosGetOptions.callback([]));
            }
            const lInfosGetDisabled = aOutils.getAccesParametresModel(
              'getDisabled',
              aContexteCourant,
            );
            if (lInfosGetDisabled && lInfosGetDisabled.estFonction) {
              const lGetter = function () {
                return !!lInfosGetDisabled.callback([]);
              };
              lEstZoneDessinDisabled = !!lGetter();
              aOutils.abonnerRefresh(
                () => {
                  const lDisabled = !!lGetter();
                  if (lDisabled !== lEstZoneDessinDisabled) {
                    lEstZoneDessinDisabled = lDisabled;
                    if (lEstZoneDessinDisabled) {
                      $(aContexteCourant.node)
                        .find('canvas')
                        .attr('disabled', 'disabled');
                      lSignaturePad.off();
                    } else {
                      $(aContexteCourant.node)
                        .find('canvas')
                        .removeAttr('disabled');
                      lSignaturePad.on();
                    }
                  }
                },
                lElementDivGlobal,
                aContexteCourant,
              );
            }
            lInfosSurEvenementZoneDessin = aOutils.getAccesParametresModel(
              'surEvenementZoneDessin',
              aContexteCourant,
            );
          }
          const lDefaultOptionsSignaturePad = {
            dotSize: 1,
            minWidth: 0.5,
            maxWidth: 2.5,
            throttle: 0,
            minDistance: 5,
            backgroundColor: '#FFF',
            penColor: '#000',
            velocityFilterWeight: 0.7,
          };
          const lOptionsSignaturePad = Object.assign(
            lDefaultOptionsSignaturePad,
            {
              minWidth:
                cFacteurTraitTailleMin * lOptionsZoneDessin.tailleCrayon,
              maxWidth:
                cFacteurTraitTailleMax * lOptionsZoneDessin.tailleCrayon,
              dotSize: lDefaultOptionsSignaturePad.maxWidth,
              penColor: lOptionsZoneDessin.couleurCrayon,
            },
          );
          lSignaturePad = new global.SignaturePad(
            lElementCanvas,
            lOptionsSignaturePad,
          );
          if (
            lInfosInitialiseZoneDessin &&
            lInfosInitialiseZoneDessin.estFonction
          ) {
            lInfosInitialiseZoneDessin.callback([lSignaturePad]);
          }
          if (lEstZoneDessinDisabled) {
            lSignaturePad.off();
          }
          if (
            lInfosSurEvenementZoneDessin &&
            lInfosSurEvenementZoneDessin.estFonction
          ) {
            lSignaturePad.addEventListener('beginStroke', () => {
              lInfosSurEvenementZoneDessin.callback([
                ZoneDessinEvenement.DebutDessin,
              ]);
            });
          }
          lSignaturePad.addEventListener('endStroke', () => {
            if (
              lInfosSurEvenementZoneDessin &&
              lInfosSurEvenementZoneDessin.estFonction
            ) {
              lInfosSurEvenementZoneDessin.callback([
                ZoneDessinEvenement.FinDessin,
              ]);
            }
            aContexteCourant.contexte.refresh();
          });
          lSignaturePad.getImageBase64 = () => {
            return lSignaturePad.toDataURL('image/png');
          };
          lSignaturePad.recupererBlob = (aCallback) => {
            lElementCanvas.toBlob(aCallback);
          };
          lSignaturePad.enregistrerImage = (aNomFichier) => {
            lElementCanvas.toBlob((aBlobDeCanvas) => {
              const url = window.URL.createObjectURL(aBlobDeCanvas);
              const a = document.createElement('a');
              a.style = 'display: none';
              a.href = url;
              a.download = aNomFichier;
              document.body.appendChild(a);
              a.click();
              window.URL.revokeObjectURL(url);
            });
          };
          lSignaturePad.estZoneDessinVide = () => {
            return lSignaturePad.isEmpty();
          };
          lSignaturePad.annulerDernierTrait = () => {
            const lDataActuelle = lSignaturePad.toData();
            if (lDataActuelle) {
              lDataActuelle.pop();
              lSignaturePad.fromData(lDataActuelle);
            }
            if (
              lInfosSurEvenementZoneDessin &&
              lInfosSurEvenementZoneDessin.estFonction
            ) {
              lInfosSurEvenementZoneDessin.callback([
                ZoneDessinEvenement.AnnulerDernierTrait,
              ]);
            }
          };
          lSignaturePad.effacerZoneDessin = () => {
            lSignaturePad.clear();
            if (
              lInfosSurEvenementZoneDessin &&
              lInfosSurEvenementZoneDessin.estFonction
            ) {
              lInfosSurEvenementZoneDessin.callback([
                ZoneDessinEvenement.Effacement,
              ]);
            }
          };
          lSignaturePad.getCouleurTrait = () => {
            return lSignaturePad.penColor;
          };
          lSignaturePad.changerCouleurTrait = (aCouleur) => {
            lOptionsZoneDessin.couleurCrayon = aCouleur;
            lSignaturePad.penColor = lOptionsZoneDessin.couleurCrayon;
          };
        });
      lJDivCanvas.on('destroyed', () => {
        lSignaturePad = null;
        if (lInfosDestroy && lInfosDestroy.estFonction) {
          lInfosDestroy.callback([]);
        }
      });
      aOutils.copyAttributs(aContexteCourant.node, lElementDivGlobal);
      const lRacine = lElementDivGlobal;
      aOutils.replaceNode(aContexteCourant.node, lRacine);
      aContexteCourant.node = lRacine;
      aOutils.surNodeEtNodeAfter(aContexteCourant);
      aOutils.addCommentaireDebug(lElementDivGlobal, 'ie-zonedessin');
      return { node: lElementDivGlobal };
    });
  },
  fn: 'iehtml.zonedessin.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GestionnaireModale = exports.OpaciteVoileBloquant = void 0;
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_1 = require('ObjetStyle');
    const Invocateur_1 = require('Invocateur');
    const GUID_1 = require('GUID');
    var TypePrioriteBlocageInterface;
    (function (TypePrioriteBlocageInterface) {
      TypePrioriteBlocageInterface[
        (TypePrioriteBlocageInterface['voile'] = 1)
      ] = 'voile';
      TypePrioriteBlocageInterface[
        (TypePrioriteBlocageInterface['standard'] = 10)
      ] = 'standard';
      TypePrioriteBlocageInterface[
        (TypePrioriteBlocageInterface['message'] = 20)
      ] = 'message';
      TypePrioriteBlocageInterface[
        (TypePrioriteBlocageInterface['messageInformatif'] = 30)
      ] = 'messageInformatif';
      TypePrioriteBlocageInterface[
        (TypePrioriteBlocageInterface['systeme'] = 99999)
      ] = 'systeme';
    })(TypePrioriteBlocageInterface || (TypePrioriteBlocageInterface = {}));
    var OpaciteVoileBloquant;
    (function (OpaciteVoileBloquant) {
      OpaciteVoileBloquant[(OpaciteVoileBloquant['default'] = 1)] = 'default';
      OpaciteVoileBloquant[(OpaciteVoileBloquant['opaqueComplet'] = 2)] =
        'opaqueComplet';
    })(
      OpaciteVoileBloquant ||
        (exports.OpaciteVoileBloquant = OpaciteVoileBloquant = {}),
    );
    exports.GestionnaireModale = (function () {
      const uBlocage = {
        pile: [],
        nb: 0,
        avecVoile: false,
        pourPatience: false,
      };
      const CidBlocageGeneral = GUID_1.GUID.getId() + '_bloquer';
      const uPileZIndex = {};
      let uMaxZIndex = -1;
      const uZIndexBlocage = 1000;
      const uGenerateurGUID = new GUID_1.GUID.generateur();
      const uClassBloquageInterface = 'nav_zoneBloquageInterface';
      function _ajoutDansPile(
        aId,
        aPourPremierPlan,
        aPourBlocageInterface,
        aPrioriteBlocage,
      ) {
        const lPriorite = _getPrioriteBlocageDePriorite(aPrioriteBlocage);
        if (uPileZIndex[aId]) {
          uPileZIndex[aId].pourPremierPlan =
            uPileZIndex[aId].pourPremierPlan || aPourPremierPlan;
          uPileZIndex[aId].pourBlocageInterface =
            uPileZIndex[aId].pourBlocageInterface || aPourBlocageInterface;
          uPileZIndex[aId].prioriteBlocage = Math.max(
            uPileZIndex[aId].prioriteBlocage,
            lPriorite,
          );
        } else {
          const lElement = ObjetHtml_1.GHtml.getElement(aId);
          const lZindex = ObjetStyle_1.GStyle.getZindex(aId);
          if (lZindex || aPourBlocageInterface) {
            uPileZIndex[aId] = {
              element: lElement,
              zIndexOrigine: lZindex,
              zIndex: lZindex,
              pourPremierPlan: aPourPremierPlan,
              pourBlocageInterface: aPourBlocageInterface,
              prioriteBlocage: lPriorite,
              estBloque: false,
              pileBlocage: [],
            };
            uMaxZIndex = Math.max(uMaxZIndex, lZindex);
          }
        }
      }
      function _setZIndex(aId, zIndex) {
        if (!uPileZIndex[aId]) {
          return;
        }
        uPileZIndex[aId].zIndex = zIndex;
        ObjetStyle_1.GStyle.setZindex(aId, zIndex);
      }
      function _getPrioriteBlocageCourant() {
        let lPriorite = 0;
        uBlocage.pile.forEach((aElement) => {
          lPriorite = Math.max(lPriorite, aElement.priorite);
        });
        return lPriorite;
      }
      function _getPrioriteBlocageDePriorite(aPrioriteBlocage) {
        return (
          aPrioriteBlocage ||
          exports.GestionnaireModale.TypePrioriteBlocageInterface.standard
        );
      }
      function _notifierAbonneBlocageInterface(
        aId,
        aBloquer,
        aForcerDeblocage,
        aPrioriteBlocage,
        aEtatBloquerPrecedent,
      ) {
        const lElement = uPileZIndex[aId];
        if (lElement && lElement.pourBlocageInterface) {
          const lPrioriteBlocage =
            _getPrioriteBlocageDePriorite(aPrioriteBlocage);
          if (!aBloquer && aForcerDeblocage) {
            lElement.estBloque = false;
            if (lElement.methode) {
              lElement.methode(
                aBloquer,
                uBlocage.avecVoile,
                uBlocage.pourPatience,
              );
            } else {
              _setZIndex(aId, lElement.zIndexOrigine);
            }
          } else {
            if (
              (aBloquer &&
                (!lElement.estBloque ||
                  (!lElement.avecVoile && uBlocage.avecVoile !== false)) &&
                lElement.prioriteBlocage <= lPrioriteBlocage) ||
              (!aBloquer && lElement.estBloque && !aEtatBloquerPrecedent)
            ) {
              if (aBloquer) {
                lElement.estBloque = true;
              } else {
                lElement.estBloque = !!aEtatBloquerPrecedent;
              }
              if (lElement.methode) {
                if (lElement.estBloque) {
                  lElement.avecVoile = uBlocage.avecVoile;
                }
                lElement.methode(
                  lElement.estBloque,
                  uBlocage.avecVoile,
                  uBlocage.pourPatience,
                );
              } else {
                if (lElement.estBloque) {
                  if (lElement.zIndex > uZIndexBlocage - 10) {
                    _setZIndex(aId, uZIndexBlocage - 10);
                  }
                } else {
                  _setZIndex(aId, lElement.zIndexOrigine);
                }
              }
            }
          }
          let lId = aId;
          if (lElement.blocageGeneral && global.GApplication) {
            lId = global.GApplication.getIdConteneur();
          }
          if (lElement.estBloque) {
            $('#' + lId.escapeJQ()).addClass(uClassBloquageInterface);
          } else {
            $('#' + lId.escapeJQ()).removeClass(uClassBloquageInterface);
          }
        }
      }
      function _notifierAbonnesBlocageInterface(
        aBloquer,
        aForcerDeblocage,
        aPrioriteBlocage,
      ) {
        for (let lId in uPileZIndex) {
          const lElement = uPileZIndex[lId];
          let lEtatPrecedent = null;
          if (aBloquer) {
            lElement.pileBlocage.push(lElement.estBloque);
          } else {
            lEtatPrecedent = lElement.pileBlocage.pop();
          }
          _notifierAbonneBlocageInterface(
            lId,
            aBloquer,
            aForcerDeblocage,
            aPrioriteBlocage,
            lEtatPrecedent,
          );
        }
      }
      function _desabonnementBlocageInterface(aId) {
        if (uPileZIndex[aId] && uPileZIndex[aId].pourBlocageInterface) {
          ObjetStyle_1.GStyle.setZindex(aId, uPileZIndex[aId].zIndex);
          if (!uPileZIndex[aId].pourPremierPlan) {
            delete uPileZIndex[aId];
          } else {
            uPileZIndex[aId].estBloque = false;
            uPileZIndex[aId].pourBlocageInterface = false;
          }
        }
      }
      function _desabonnementPremierPlan(aId) {
        if (uPileZIndex[aId]) {
          if (uPileZIndex[aId].zIndex >= uMaxZIndex) {
            uMaxZIndex = -1;
            for (const lId in uPileZIndex) {
              if (
                uPileZIndex[lId] &&
                uPileZIndex[lId].pourPremierPlan &&
                lId !== aId
              ) {
                uMaxZIndex = Math.max(uMaxZIndex, uPileZIndex[lId].zIndex);
              }
            }
          }
          _setZIndex(aId, uPileZIndex[aId].zIndexOrigine);
          if (!uPileZIndex[aId].pourBlocageInterface) {
            delete uPileZIndex[aId];
          } else {
            uPileZIndex[aId].pourPremierPlan = false;
          }
        }
      }
      function _bloquerInterfaceGenerale(
        ABloquer,
        aAvecVoileOpaque,
        aPourPatience,
      ) {
        if (IE.estTestMocha) {
          return;
        }
        let lElement = ObjetHtml_1.GHtml.getElement(CidBlocageGeneral);
        if (!lElement) {
          $(document.body)
            .find(':first')
            .before(
              '<div id="' +
                CidBlocageGeneral +
                '" class="BloquerInterface NePasImprimer SansSelectionTexte" style="display:none;"></div>',
            );
          lElement = ObjetHtml_1.GHtml.getElement(CidBlocageGeneral);
        }
        if (ABloquer) {
          const lAvecVoileOpaque =
            aAvecVoileOpaque !== null && aAvecVoileOpaque !== void 0
              ? aAvecVoileOpaque
              : true;
          $(lElement).removeClass('VoileOpaque50 VoileOpaqueComplet');
          if (lAvecVoileOpaque) {
            let lOpaciteVoile = OpaciteVoileBloquant.default;
            uBlocage.pile.forEach((aElement) => {
              if (aElement.opaciteVoile > lOpaciteVoile) {
                lOpaciteVoile = aElement.opaciteVoile;
                if (lOpaciteVoile === OpaciteVoileBloquant.opaqueComplet) {
                }
              }
            });
            let lCss =
              lOpaciteVoile === OpaciteVoileBloquant.default
                ? 'VoileOpaque50'
                : 'VoileOpaqueComplet';
            $(lElement).addClass(lCss);
          }
        }
        if (!lElement.oncontextmenu) {
          lElement.oncontextmenu = function () {
            return false;
          };
        }
        ObjetStyle_1.GStyle.setDisplay(lElement, ABloquer);
        if (aPourPatience) {
          $(lElement).addClass('blocage-patience');
        } else {
          $(lElement).removeClass('blocage-patience');
        }
      }
      Invocateur_1.Invocateur.abonner('finSession', () => {
        _notifierAbonnesBlocageInterface(
          false,
          true,
          exports.GestionnaireModale.TypePrioriteBlocageInterface.systeme,
        );
      });
      return {
        TypePrioriteBlocageInterface: TypePrioriteBlocageInterface,
        enPremierPlan(AIdPremierPlan) {
          if (!uPileZIndex[AIdPremierPlan]) {
            return;
          }
          for (const lId in uPileZIndex) {
            let lElement = uPileZIndex[lId];
            if (lElement && lElement.pourPremierPlan) {
              if (!ObjetHtml_1.GHtml.elementExiste(lId)) {
                IE.log.addLog(
                  'Erreur GestionnaireModale.enPremierPlan : element supprimé sans etre desabonné',
                  null,
                  IE.log.genre.Erreur,
                );
                _desabonnementPremierPlan(lId);
              } else if (!lElement.estBloque) {
                if (lId === AIdPremierPlan) {
                  _setZIndex(lId, uMaxZIndex + 1);
                } else if (!uPileZIndex[lId].estBloque) {
                  _setZIndex(lId, lElement.zIndexOrigine);
                }
              }
            }
          }
        },
        abonnementPremierPlan(aAbonner, aId) {
          if (aAbonner) {
            _ajoutDansPile(aId, true, false);
          } else {
            _desabonnementPremierPlan(aId);
          }
        },
        abonnementBlocageInterfaceGenerale() {
          uPileZIndex[CidBlocageGeneral] = {
            blocageGeneral: true,
            pourPremierPlan: false,
            pourBlocageInterface: true,
            estBloque: false,
            pileBlocage: [],
            prioriteBlocage:
              exports.GestionnaireModale.TypePrioriteBlocageInterface.voile,
            methode: _bloquerInterfaceGenerale,
          };
        },
        abonnementBlocageInterface(aAbonner, aId, aPrioriteBlocage) {
          if (aAbonner) {
            _ajoutDansPile(aId, false, true, aPrioriteBlocage);
            const lPriorite = _getPrioriteBlocageDePriorite(aPrioriteBlocage);
            if (
              exports.GestionnaireModale.estInterfaceBloque() &&
              _getPrioriteBlocageCourant() > lPriorite
            ) {
              _notifierAbonneBlocageInterface(aId, true, false, lPriorite);
            }
          } else {
            _desabonnementBlocageInterface(aId);
          }
        },
        estInterfaceBloque() {
          return uBlocage.pile.length > 0;
        },
        estJElementBloque(aJElement) {
          return aJElement && aJElement.parents
            ? aJElement.closest('.' + uClassBloquageInterface).length > 0
            : false;
        },
        bloquerInterface(aParams) {
          const lParams = Object.assign(
            {
              bloquer: false,
              prioriteBlocage:
                exports.GestionnaireModale.TypePrioriteBlocageInterface
                  .standard,
              pourPatience: false,
              avecVoile: null,
              forcerDeblocage: false,
              guidBlocage: null,
              opaciteVoile: OpaciteVoileBloquant.default,
            },
            aParams,
          );
          if (!lParams.bloquer && uBlocage.pile.length === 0) {
            return;
          }
          let lId = null;
          lParams.prioriteBlocage = _getPrioriteBlocageDePriorite(
            lParams.prioriteBlocage,
          );
          if (lParams.bloquer) {
            const lElement = {
              priorite: lParams.prioriteBlocage,
              guid: uGenerateurGUID.get(),
              opaciteVoile: lParams.opaciteVoile,
            };
            uBlocage.pile.push(lElement);
            lId = lElement.guid;
            uBlocage.avecVoile = lParams.avecVoile;
            uBlocage.pourPatience = !!lParams.pourPatience;
          } else {
            if (lParams.guidBlocage) {
              let lTrouve = false;
              uBlocage.pile = uBlocage.pile.filter((aElement) => {
                if (aElement.guid === lParams.guidBlocage) {
                  lTrouve = true;
                }
                return aElement.guid !== lParams.guidBlocage;
              });
              if (!lTrouve) {
                return;
              }
            } else {
              uBlocage.pile.pop();
            }
          }
          _notifierAbonnesBlocageInterface(
            lParams.bloquer,
            false,
            lParams.prioriteBlocage,
          );
          return lId;
        },
      };
    })();
    if (!IE.estMobile) {
      exports.GestionnaireModale.abonnementBlocageInterfaceGenerale();
    }
  },
  fn: 'gestionnairemodale.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireSelecFile = void 0;
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const UtilitaireTraitementImage_1 = require('UtilitaireTraitementImage');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    let uIdFichier = 0;
    const UtilitaireSelecFile = {
      C_MaxSize: 500 * 1024 * 1024,
      addFileDansListe(aFile, aListeFichiers, aGenrePJ) {
        const lElement = new ObjetElement_1.ObjetElement('', null, aGenrePJ);
        lElement.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
        let lLibelle = ObjetChaine_1.GChaine.enleverChemin(aFile.name);
        if (lLibelle && lLibelle.replace) {
          lLibelle = lLibelle.replace(/[:/\\*?"<>|]/g, '_');
        }
        if (lLibelle === 'image.jpg') {
          lLibelle = `image_${Date.now()}.jpg`;
        }
        lElement.Libelle = ObjetChaine_1.GChaine.ajouterEntites(lLibelle);
        lElement.nomOriginal = lLibelle;
        lElement.file = aFile;
        try {
          if (aFile.lastModified) {
            lElement.lastModified = aFile.lastModified;
          }
        } catch (error) {}
        uIdFichier += 1;
        lElement.idFichier = 'selecfile_' + uIdFichier + '_' + Date.now();
        aListeFichiers.addElement(lElement);
      },
      controleTailleFichiers(aListeFichiers, aMessagesErreur, aMaxSize) {
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        aListeFichiers.parcourir((aFichier) => {
          if (
            aMaxSize > 0 &&
            !UtilitaireSelecFile.estFichierCloudPartage(aFichier) &&
            aFichier.file &&
            aFichier.file.size > aMaxSize
          ) {
            let lVal = Math.floor(aMaxSize / 1024);
            let lUnite = ObjetTraduction_1.GTraductions.getValeur('unite.Ko');
            if (
              lVal > 1024 * 10 ||
              (lVal > 1024 && Math.floor(lVal / 1024) === lVal / 1024)
            ) {
              lVal = Math.floor(lVal / 1024);
              lUnite = ObjetTraduction_1.GTraductions.getValeur('unite.Mo');
            }
            aMessagesErreur.push(
              ObjetChaine_1.GChaine.format('%s (%s)', [
                ObjetTraduction_1.GTraductions.getValeur(
                  'inputFile.msgEchecTailleFichier',
                  [lVal, lUnite],
                ),
                aFichier.getLibelle(),
              ]),
            );
          } else {
            lListe.addElement(aFichier);
          }
        });
        return lListe;
      },
      estFichierCloudPartage(aFichier) {
        return (
          aFichier &&
          aFichier.idPartage &&
          aFichier.getGenre &&
          aFichier.getGenre() ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Cloud
        );
      },
      extraireListeFichiersCloudsPartage(aListeFichiers) {
        const lListeFichiersClouds =
          new ObjetListeElements_1.ObjetListeElements();
        if (aListeFichiers && aListeFichiers.parcourir) {
          const lTabFichiers = [...aListeFichiers.getTabListeElements()];
          lTabFichiers.forEach((aFichier, aIndex) => {
            if (UtilitaireSelecFile.estFichierCloudPartage(aFichier)) {
              lListeFichiersClouds.add(aFichier);
              aListeFichiers.remove(aIndex);
            }
          });
        }
        return lListeFichiersClouds;
      },
      genererPdfAsync(
        aListeFichiers,
        aMessagesErreur,
        aNomPDFaGenerer,
        aGenrePDF,
      ) {
        return UtilitaireTraitementImage_1.UtilitaireTraitementImage.genererPdfAsync(
          aListeFichiers,
        )
          .then((aParamPDF) => {
            aListeFichiers.vider();
            if (aParamPDF && aParamPDF.file) {
              if (aNomPDFaGenerer) {
                aParamPDF.file.name = aNomPDFaGenerer;
              }
              UtilitaireSelecFile.addFileDansListe(
                aParamPDF.file,
                aListeFichiers,
                aGenrePDF,
              );
            }
          })
          .catch((aParamsReject) => {
            aListeFichiers.vider();
            if (aMessagesErreur.length > 0) {
              aMessagesErreur.push('');
            }
            aMessagesErreur.push(
              ObjetChaine_1.GChaine.format(
                ObjetTraduction_1.GTraductions.getValeur(
                  'inputFile.echecImagePDF_S',
                ),
                [(aParamsReject ? aParamsReject.nom : '') || ''],
              ),
            );
          });
      },
    };
    exports.UtilitaireSelecFile = UtilitaireSelecFile;
  },
  fn: 'utilitaireselecfile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.SelecFile = void 0;
    const IEHtml = require('IEHtml');
    const GUID_1 = require('GUID');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTri_1 = require('ObjetTri');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const UtilitaireTraitementImage_1 = require('UtilitaireTraitementImage');
    const UtilitaireSelecFile_1 = require('UtilitaireSelecFile');
    class SelecFile {
      static async select(aOptions) {
        return await new ObjetSelecFile(aOptions).select();
      }
      static async addFiles(aOptions, aFiles) {
        return await new ObjetSelecFile(aOptions).addFiles(aFiles);
      }
      static getOptionsDefaut() {
        return {
          accept: '',
          extensions: null,
          maxSize: null,
          multiple: false,
          maxFiles: 0,
          genrePJ: Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
          avecResizeImage: true,
          hauteurMaxImageResize: 1500,
          largeurMaxImageResize: 1500,
          compressionImage: 0.88,
          avecTransformationFlux: true,
          avecTransformationFlux_versCloud: false,
          genererPDFImages: false,
          nomPDFaGenerer: '',
          accept_genererPDFImages:
            UtilitaireTraitementImage_1.UtilitaireTraitementImage.getTabMimePDFImage().join(
              ', ',
            ),
          capture: '',
        };
      }
    }
    exports.SelecFile = SelecFile;
    const uIdConteneurInputFile = GUID_1.GUID.getId();
    class ObjetSelecFile {
      constructor(aOptions) {
        this.options = SelecFile.getOptionsDefaut();
        Object.assign(this.options, aOptions);
      }
      async select() {
        if (
          !MethodesObjet_1.MethodesObjet.isNumber(this.options.maxSize) ||
          this.options.maxSize < 0
        ) {
          this.options.maxSize = 0;
        }
        if (this.options.maxSize <= 0) {
          this.options.maxSize = 50 * 1024 * 1024;
        }
        return new Promise((aResolve) => {
          this.createInput(aResolve);
          if (!this.jInput) {
            return false;
          }
          if (this.options.surOuvertureSelecteur) {
            this.options.surOuvertureSelecteur();
          }
          this.jInput.trigger('click');
        });
      }
      async addFiles(aFiles) {
        const lParams = {
          files: aFiles,
          listeFichiers: new ObjetListeElements_1.ObjetListeElements(),
        };
        const lMessagesErreur = [];
        this.construireListeFichiers(lParams, lMessagesErreur);
        let lAvecBlocageInterface = false;
        try {
          if (lParams.listeFichiers.count() > 0) {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.patience,
              true,
              { delai: 500 },
            );
            lAvecBlocageInterface = true;
          }
          try {
            for (const lFichier of lParams.listeFichiers) {
              if (
                this.options.avecResizeImage &&
                UtilitaireTraitementImage_1.UtilitaireTraitementImage.avecResizePossible(
                  lFichier.file,
                )
              ) {
                await this.scaleImage(lParams, lFichier, lMessagesErreur);
              }
            }
            if (!this.avecTransformationFlux()) {
              lParams.listeFichiers =
                UtilitaireSelecFile_1.UtilitaireSelecFile.controleTailleFichiers(
                  lParams.listeFichiers,
                  lMessagesErreur,
                  this.options.maxSize,
                );
            }
            if (
              this.options.genererPDFImages &&
              lParams.listeFichiers.count() > 0
            ) {
              await UtilitaireSelecFile_1.UtilitaireSelecFile.genererPdfAsync(
                lParams.listeFichiers,
                lMessagesErreur,
                this.options.nomPDFaGenerer,
                this.options.genrePJ,
              );
              if (!this.avecTransformationFlux()) {
                lParams.listeFichiers =
                  UtilitaireSelecFile_1.UtilitaireSelecFile.controleTailleFichiers(
                    lParams.listeFichiers,
                    lMessagesErreur,
                    this.options.maxSize,
                  );
              }
            }
          } finally {
            if (lAvecBlocageInterface) {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.patience,
                false,
              );
            }
          }
          if (this.avecTransformationFlux()) {
            try {
              await GApplication.getObject(
                'transformationFlux',
              ).transformationFluxPromise(lParams.listeFichiers, this.options);
            } catch (aError) {}
            lParams.listeFichiers =
              UtilitaireSelecFile_1.UtilitaireSelecFile.controleTailleFichiers(
                lParams.listeFichiers,
                lMessagesErreur,
                this.options.maxSize,
              );
          }
          if (lMessagesErreur.length > 0) {
            await GApplication.getMessage().afficher({
              message: lMessagesErreur.join('<br>'),
            });
          }
          if (lParams.listeFichiers.count() > 0) {
            lParams.eltFichier = lParams.listeFichiers.get(0);
            IEHtml.refresh(true);
            return lParams;
          }
        } catch (e) {
          await GApplication.getMessage().afficher({
            message: ObjetTraduction_1.GTraductions.getValeur(
              'inputFile.EchecAjoutFichier',
            ),
          });
          return null;
        }
      }
      createInput(aResolve) {
        this.removeInput();
        if (this.timeoutClean) {
          clearTimeout(this.timeoutClean);
        }
        this.timeoutClean = null;
        if (!ObjetHtml_1.GHtml.getElement(uIdConteneurInputFile)) {
          IEZoneFenetre_1.ZoneFenetre.ajouterFenetre(uIdConteneurInputFile, -1);
        }
        const lAccept =
          (this.options.genererPDFImages
            ? this.options.accept_genererPDFImages
            : '') || this.options.accept;
        this.jInput = $(
          IEHtml.injectHTMLParams({
            element: ObjetHtml_1.GHtml.getElement(uIdConteneurInputFile),
            html: IE.jsx.str('input', {
              type: 'file',
              style: 'display:none',
              multiple: !!this.options.multiple,
              accept: lAccept || false,
              capture: this.options.capture || false,
            }),
            ignorerScroll: true,
          }),
        );
        this.jInput.on(
          {
            change: async function (aEvent) {
              const lInstance = aEvent.data.this;
              try {
                const lResult = await lInstance.addFiles(
                  Array.from(this.files),
                );
                lInstance.removeInput();
                aResolve(lResult);
              } catch (e) {
                lInstance.removeInput();
                aResolve(null);
              }
            },
          },
          { this: this },
        );
      }
      removeInput() {
        if (this.timeoutClean) {
          clearTimeout(this.timeoutClean);
        }
        this.timeoutClean = null;
        $(`#${uIdConteneurInputFile}`).remove();
        this.jInput = null;
      }
      construireListeFichiers(aParams, aMessagesErreur) {
        let lNbMax = this.options.maxFiles;
        if (!this.options.multiple) {
          lNbMax = 1;
        }
        Array.from(aParams.files).forEach((aFile, aIndex) => {
          const lFichierRefuse =
            lNbMax > 0 &&
            MethodesObjet_1.MethodesObjet.isNumber(lNbMax) &&
            aIndex >= lNbMax;
          IE.log.addLog(
            'Fichier ' +
              (lFichierRefuse ? 'refusé (max atteint)' : 'ajouté') +
              ' : ' +
              aFile.name +
              ' - Taille : ' +
              Math.ceil(aFile.size / 1024) +
              'ko',
          );
          if (lFichierRefuse) {
            return;
          }
          if (aFile.size === 0) {
            aMessagesErreur.push(
              ObjetTraduction_1.GTraductions.getValeur(
                'inputFile.msgDocJointVide',
                [aFile.name],
              ),
            );
          } else if (
            this.options.extensions &&
            this.options.extensions.length > 0 &&
            !this.options.extensions.includes(
              aFile.name.replace(/(.*)\.([^./]+)$/, '$2').toLowerCase(),
            )
          ) {
            aMessagesErreur.push(
              ObjetTraduction_1.GTraductions.getValeur(
                'inputFile.echecSelection',
                [this.options.extensions.join(', ')],
              ),
            );
          } else {
            UtilitaireSelecFile_1.UtilitaireSelecFile.addFileDansListe(
              aFile,
              aParams.listeFichiers,
              this.options.genrePJ,
            );
          }
        });
        if (aParams.listeFichiers) {
          aParams.listeFichiers.setTri([
            ObjetTri_1.ObjetTri.init('lastModified'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]);
          aParams.listeFichiers.trier();
        }
      }
      async scaleImage(aParams, aFichier, aMessagesErreur) {
        try {
          const aParamsTraitement =
            await UtilitaireTraitementImage_1.UtilitaireTraitementImage.resizeFilePromise(
              aFichier.file,
              this.options.largeurMaxImageResize,
              this.options.hauteurMaxImageResize,
              this.options.compressionImage,
            );
          if (
            aParamsTraitement &&
            aParamsTraitement.avecResize &&
            aParamsTraitement.file &&
            aParamsTraitement.file.size < aFichier.file.size
          ) {
            const lAncienFichier = aFichier.file;
            aFichier.file = aParamsTraitement.file;
            aFichier.estResize = true;
            aMessagesErreur.push(
              ObjetChaine_1.GChaine.format(
                ObjetTraduction_1.GTraductions.getValeur(
                  'inputFile.reductionTailleImage_SDDDDDD',
                ),
                [
                  aFichier.Libelle,
                  aParamsTraitement.widthOriginal,
                  aParamsTraitement.heightOriginal,
                  lAncienFichier.size / 1024,
                  Math.round(aParamsTraitement.width),
                  Math.round(aParamsTraitement.height),
                  aFichier.file.size / 1024,
                ],
              ),
            );
          }
        } catch (e) {
          return null;
        }
      }
      avecTransformationFlux() {
        if (this.options.avecTransformationFlux && global.GApplication) {
          const lTransformationFlux =
            GApplication.getObject('transformationFlux');
          return (
            !!lTransformationFlux &&
            lTransformationFlux.getActif() &&
            !['image/*', 'application/zip'].includes(this.options.accept)
          );
        }
        return false;
      }
    }
  },
  fn: 'selecfile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IEHtml.SelecFile.css');
    const IEHtml = require('IEHtml');
    const Invocateur_1 = require('Invocateur');
    const ObjetHtml_1 = require('ObjetHtml');
    const GestionnaireModale_1 = require('GestionnaireModale');
    const ToucheClavier_1 = require('ToucheClavier');
    const SelecFile_1 = require('SelecFile');
    let uInvocateurSelecFile = new Invocateur_1.ObjetInvocateur();
    IEHtml.addAttribut(
      'ie-selecfile',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lModele = aOutils.getModel(aContexteCourant);
        let lDisabled = false;
        let lDesactiverClick_openFileManuel = false;
        let lTimeoutDrag;
        let lTimeoutDragSurvol;
        const lDureeTimeoutDrag = 10;
        let lDragEnCours = false;
        let lDragHoverEnCours = false;
        let lIdsAbon = null;
        if (!lModele || !aContexteCourant.data.$modeleParsed) {
          return true;
        }
        const lJElement = $(aContexteCourant.node),
          lInfosOptions = aOutils.getAccesParametresModel(
            'getOptionsSelecFile',
            aContexteCourant,
          ),
          lInfosAdd = aOutils.getAccesParametresModel(
            'addFiles',
            aContexteCourant,
          ),
          lInfosGetDisabled = aOutils.getAccesParametresModel(
            'getDisabled',
            aContexteCourant,
          );
        if (!lInfosAdd.estFonction) {
          return true;
        }
        if (!lInfosOptions.estFonction) {
          return true;
        }
        const lOptions = SelecFile_1.SelecFile.getOptionsDefaut();
        function _estDisabled() {
          return lDisabled;
        }
        const lOuvrirSelecteur = async function () {
          const lResult = await SelecFile_1.SelecFile.select(lOptions);
          if (lResult && lResult.files) {
            lInfosAdd.callback([lResult]);
            aContexteCourant.controleur.$refresh();
          }
        };
        function _surDrag(aParams) {
          if (_estDisabled()) {
            return;
          }
          clearTimeout(lTimeoutDrag);
          if (aParams.start && lOptions.acceptDragDrop) {
            if (
              !lDragEnCours &&
              !GestionnaireModale_1.GestionnaireModale.estJElementBloque(
                lJElement,
              )
            ) {
              lDragEnCours = true;
              if (lOptions.classDrag) {
                aContexteCourant.node.classList.add(lOptions.classDrag);
              }
              if (lOptions.eventSurDrag) {
                lOptions.eventSurDrag({ surDrag: true });
              }
            }
          } else if (lDragEnCours) {
            lTimeoutDrag = setTimeout(() => {
              lDragEnCours = false;
              lDragHoverEnCours = false;
              if (lOptions.classDrag) {
                aContexteCourant.node.classList.remove(lOptions.classDrag);
              }
              if (lOptions.classDragHoverSelec) {
                aContexteCourant.node.classList.remove(
                  lOptions.classDragHoverSelec,
                );
              }
              if (lOptions.eventSurDrag) {
                lOptions.eventSurDrag({ surDrag: false });
              }
            }, lDureeTimeoutDrag);
          }
          if (lOptions.bloquerDropHorsZoneDrop) {
            aParams.avecSelecAbonne = true;
          }
        }
        Object.assign(lOptions, {
          acceptDragDrop: true,
          eventClick: true,
          title: '',
          getClass: function (aDisabled) {
            return aDisabled || !lOptions.eventClick ? '' : 'AvecMain';
          },
          interrompreClick: false,
          click_surEventCapture: true,
          dragEnCoursVisible: true,
          bloquerDropHorsZoneDrop: true,
          classDrag: 'SelecFile_DragEnCours',
          classDragHoverSelec: 'SelecFile_DragEnCours_survol',
          eventSurDrag: null,
        });
        function _majOptions() {
          if (lInfosOptions.estFonction) {
            const lFunc = () => {
              lDesactiverClick_openFileManuel = true;
              return lOuvrirSelecteur;
            };
            const lResultOptions = lInfosOptions.callback([lFunc]);
            if (lResultOptions) {
              Object.assign(lOptions, lResultOptions);
            }
          }
          if (lOptions.dragEnCoursVisible) {
            if (lIdsAbon) {
              uInvocateurSelecFile.desabonner(lIdsAbon);
            }
            lIdsAbon = uInvocateurSelecFile.abonner('drag', _surDrag);
          }
        }
        function _listenerClick(aEvent) {
          if (
            _estDisabled() ||
            !lOptions.eventClick ||
            lDesactiverClick_openFileManuel
          ) {
            return;
          }
          lOuvrirSelecteur();
          if (lOptions.interrompreClick) {
            aEvent.stopImmediatePropagation();
            aEvent.preventDefault();
            return false;
          }
        }
        function _listenerClickCapture(aEvent) {
          if (lOptions.click_surEventCapture) {
            _listenerClick(aEvent);
          }
        }
        function _listenerClickBubbling(aEvent) {
          if (!lOptions.click_surEventCapture) {
            _listenerClick(aEvent);
          }
        }
        aContexteCourant.node.addEventListener(
          'click',
          _listenerClickCapture,
          true,
        );
        aContexteCourant.node.addEventListener(
          'click',
          _listenerClickBubbling,
          false,
        );
        if (!ObjetHtml_1.GHtml.getClosestInteractive(lJElement.get(0))) {
          if (!lJElement.attr('role')) {
            lJElement.attr('role', 'button');
          }
          if (!lJElement.attr('tabindex')) {
            lJElement.attr('tabindex', '0');
          }
        }
        lJElement.on({
          destroyed: function () {
            if (lIdsAbon) {
              uInvocateurSelecFile.desabonner(lIdsAbon);
              lIdsAbon = null;
            }
            clearTimeout(lTimeoutDrag);
            clearTimeout(lTimeoutDragSurvol);
            lDragEnCours = false;
            lDragHoverEnCours = false;
            if (lOptions.classDrag) {
              aContexteCourant.node.classList.remove(lOptions.classDrag);
            }
            if (lOptions.classDragHoverSelec) {
              aContexteCourant.node.classList.remove(
                lOptions.classDragHoverSelec,
              );
            }
            if (lOptions.eventSurDrag) {
              lOptions.eventSurDrag({ surDrag: false });
            }
            aContexteCourant.node.removeEventListener(
              'click',
              _listenerClickCapture,
              true,
            );
            aContexteCourant.node.removeEventListener(
              'click',
              _listenerClickBubbling,
              false,
            );
          },
          keyup(aEvent) {
            if (
              !_estDisabled() &&
              ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent)
            ) {
              lOuvrirSelecteur();
            }
          },
          'dragenter.selecfile dragover.selecfile': function (aEvent) {
            if (
              !lOptions.acceptDragDrop ||
              _estDisabled() ||
              !_eventDragAvecFiles(aEvent)
            ) {
              return;
            }
            aEvent.originalEvent.__dropAccepted__ = true;
            aEvent.preventDefault();
            if (lOptions.dragEnCoursVisible) {
              clearTimeout(lTimeoutDragSurvol);
              if (lOptions.classDragHoverSelec && !lDragHoverEnCours) {
                lDragHoverEnCours = true;
                aContexteCourant.node.classList.add(
                  lOptions.classDragHoverSelec,
                );
              }
            }
          },
          'dragexit.selecfile dragleave.selecfile dragend.selecfile':
            function () {
              clearTimeout(lTimeoutDrag);
              clearTimeout(lTimeoutDragSurvol);
              if (lOptions.classDragHoverSelec && lDragHoverEnCours) {
                lTimeoutDragSurvol = setTimeout(() => {
                  lDragHoverEnCours = false;
                  aContexteCourant.node.classList.remove(
                    lOptions.classDragHoverSelec,
                  );
                }, lDureeTimeoutDrag);
              }
            },
          'drop.selecfile': async function (aEvent) {
            uInvocateurSelecFile.evenement('drag', { start: false });
            if (!lOptions.acceptDragDrop || _estDisabled()) {
              return;
            }
            aEvent.stopPropagation();
            aEvent.preventDefault();
            const lDataTransfert = aEvent.originalEvent.dataTransfer;
            if (lDataTransfert) {
              const lFiles = Array.from(lDataTransfert.files);
              if (lFiles.length > 0) {
                const lResult = await SelecFile_1.SelecFile.addFiles(
                  lOptions,
                  lFiles,
                );
                if (lResult && lResult.files) {
                  lInfosAdd.callback([lResult]);
                  aContexteCourant.controleur.$refresh();
                }
              }
            }
          },
        });
        const lTitleOrigine = aContexteCourant.node.title;
        const lMAJDisabled = (aDisabled) => {
          if (!aDisabled) {
            _majOptions();
          }
          if (aDisabled && lTitleOrigine && lOptions.title) {
            ObjetHtml_1.GHtml.setTitle(
              aContexteCourant.node,
              lTitleOrigine || '',
            );
          } else if (!aDisabled && lOptions.title) {
            ObjetHtml_1.GHtml.setTitle(aContexteCourant.node, lOptions.title);
          }
          if (lOptions.getClass) {
            lJElement
              .removeClass(lOptions.getClass(!aDisabled))
              .addClass(lOptions.getClass(aDisabled));
          }
        };
        if (lInfosGetDisabled.valide) {
          const lGetter = function () {
            return !!lInfosGetDisabled.callback([
              lJElement.get(0),
              aContexteCourant.data,
            ]);
          };
          if (
            lInfosGetDisabled.estFonction ||
            !lGetter() ||
            lGetter() === true
          ) {
            lDisabled = !!lGetter();
            aOutils.abonnerRefresh(
              () => {
                const lNewDisabled = !!lGetter();
                if (lNewDisabled !== lDisabled) {
                  lDisabled = lNewDisabled;
                  lMAJDisabled(lDisabled);
                }
              },
              lJElement.get(0),
              aContexteCourant,
            );
          } else {
            IE.log.addLog(
              'echec getDisabled de ie-selecfile, propriété incorrecte du model "' +
                lModele +
                '"',
            );
          }
        }
        lMAJDisabled(lDisabled);
        aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-selecfile');
        return true;
      },
    );
    function _eventDragAvecFiles(aEvent) {
      if (
        aEvent.originalEvent &&
        aEvent.originalEvent.dataTransfer &&
        aEvent.originalEvent.dataTransfer.items &&
        aEvent.originalEvent.dataTransfer.items.length > 0
      ) {
        let lAvecFile = false;
        try {
          for (
            let i = 0;
            i < aEvent.originalEvent.dataTransfer.items.length;
            i++
          ) {
            const lData = aEvent.originalEvent.dataTransfer.items[i];
            if (!lData || lData.kind !== 'string') {
              lAvecFile = true;
              break;
            }
          }
        } catch (e) {
          lAvecFile = true;
        }
        return lAvecFile;
      }
      return true;
    }
    $(document).on({
      'dragenter.selecfile dragover.selecfile': function (aEvent) {
        const lParams = { start: true, avecSelecAbonne: false };
        if (_eventDragAvecFiles(aEvent)) {
          uInvocateurSelecFile.evenement('drag', lParams);
        } else {
          lParams.avecSelecAbonne = false;
        }
        if (
          lParams.avecSelecAbonne &&
          !('__dropAccepted__' in aEvent.originalEvent) &&
          'dataTransfer' in aEvent.originalEvent
        ) {
          aEvent.originalEvent.dataTransfer.dropEffect = 'none';
          return false;
        }
      },
      'dragexit.selecfile dragleave.selecfile dragend.selecfile drop.selecfile':
        function () {
          uInvocateurSelecFile.evenement('drag', { start: false });
        },
    });
  },
  fn: 'iehtml.selecfile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const tslib_1 = require('tslib');
    const IEHtml = require('IEHtml');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetHint_1 = require('ObjetHint');
    require('IEHtml.EllipisisMultiline.js');
    require('IEHtml.Load.Src.js');
    require('IEHtml.ImgViewer.js');
    require('IEHtml.AutoResize.js');
    require('IEHtml.Collapsible.js');
    require('IEHtml.VisibilityObserver.js');
    require('IEHtml.ResizeObserver.js');
    require('IEHtml.Ripple.js');
    require('IEHtml.DraggableDroppable.js');
    require('IEHtml.ZoneNavigation.js');
    require('IEHtml.BtnImage.js');
    require('IEHtml.CheckboxRadio.js');
    require('IEHtml.Identite.js');
    require('IEHtml.Chips.js');
    require('IEHtml.Combo.js');
    require('IEHtml.Bouton.js');
    require('IEHtml.BtnSelecteur.js');
    require('IEHtml.ZoneDessin.js');
    require('IEHtml.SelecFile');
    IEHtml.addAttribut(
      'ie-node',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!lValue || !aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.estFonction) {
          return true;
        }
        aOutils.surInjectionHtml(aContexteCourant, (...aParams) => {
          lInfos.callback(aParams);
        });
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-node="' + lValue + '"',
        );
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-nodeafter',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!lValue || !aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.estFonction) {
          return true;
        }
        aOutils.surInjectionHtml(
          aContexteCourant,
          (...aParams) => {
            lInfos.callback(aParams);
          },
          true,
        );
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-nodeafter="' + lValue + '"',
        );
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-event',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!aContexteCourant.controleur) {
          return;
        }
        let lTab = lValue.split('->');
        if (lTab.length < 2) {
          return;
        }
        let lMethode;
        const lEvents = lTab[0].trim().split('-');
        let lSelecteur = null;
        lTab.shift();
        lMethode = lTab.join('->');
        if (lMethode.length > 2 && lMethode.charAt(0) === '{') {
          lTab = lMethode.split('}');
          if (lTab.length < 2) {
            return;
          }
          const lNomSelecteur = lTab[0].slice(1);
          lTab.shift();
          lMethode = lTab.join('}');
          if (aContexteCourant.data && aContexteCourant.data[lNomSelecteur]) {
            lSelecteur = aContexteCourant.data[lNomSelecteur];
          } else {
            lSelecteur = lNomSelecteur;
          }
        }
        const lInfos = aOutils.getAccesParametres(lMethode, aContexteCourant);
        if (!lInfos.valide || !lInfos.estFonction) {
          return;
        }
        if (lInfos) {
          const lCallbackEvent = function (aEvent) {
            return lInfos.callback([
              aEvent,
              this,
              aContexteCourant.node,
              aContexteCourant.data,
            ]);
          };
          if (lSelecteur) {
            $(aContexteCourant.node).on(
              lEvents.join(' '),
              lSelecteur,
              { controleur: aContexteCourant.controleur },
              lCallbackEvent,
            );
          } else {
            $(aContexteCourant.node).on(
              lEvents.join(' '),
              { controleur: aContexteCourant.controleur },
              lCallbackEvent,
            );
          }
          aOutils.addCommentaireDebug(
            aContexteCourant.node,
            'ie-event="' + lValue + '"',
          );
          return true;
        } else {
          aOutils.addCommentaireDebug(
            aContexteCourant.node,
            '[ECHEC] ie-event="' + lValue + '"',
          );
        }
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-eventout',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!lValue || !aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.estFonction) {
          return true;
        }
        aOutils.surInjectionHtml(aContexteCourant, () => {
          const lSelec = 'pointerdown.eventout keydown.eventout';
          function _event(aEvent, ...aParams) {
            if (
              aContexteCourant.node !== aEvent.target &&
              (aEvent.isTrigger ||
                !ObjetHtml_1.GHtml.estDocument(aEvent.target)) &&
              !$.contains(aContexteCourant.node, aEvent.target)
            ) {
              const lResult = lInfos.callback([aEvent, ...aParams]);
              if (lResult && lResult.nodesExclus && lResult.callback) {
                if (
                  !lResult.nodesExclus.every ||
                  lResult.nodesExclus.every((aNode) => {
                    return (
                      !aNode ||
                      (aNode !== aEvent.target &&
                        !$.contains(aNode, aEvent.target))
                    );
                  })
                ) {
                  lResult.callback();
                }
              }
            }
          }
          $(aContexteCourant.node).on('destroyed', () => {
            $(document).off(lSelec, _event);
          });
          $(document).on(lSelec, _event);
        });
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-eventout="' + lValue + '"',
        );
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-title',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lNom = aAttributValue || '';
        let lGetter;
        let lOldValue = lNom;
        if (lNom && aContexteCourant.controleur) {
          const lInfos = aOutils.getAccesParametres(
            lNom,
            aContexteCourant,
            true,
          );
          if (lInfos.estFonction) {
            lGetter = function () {
              const lResult =
                (lInfos.callback([
                  aContexteCourant.node,
                  aContexteCourant.data,
                ]) || '') + '';
              return lResult.replace &&
                ObjetChaine_1.GChaine &&
                ObjetChaine_1.GChaine.enleverEntites
                ? ObjetChaine_1.GChaine.enleverEntites(lResult)
                : '';
            };
          }
        }
        if (lGetter) {
          lOldValue = lGetter();
        } else if (lOldValue === 'undefined' || lOldValue === 'null') {
          return false;
        } else {
        }
        $(aContexteCourant.node).attr('title', lOldValue);
        if (lGetter) {
          aOutils.abonnerRefresh(
            () => {
              const lValue = lGetter().toString();
              if (lOldValue !== lValue) {
                lOldValue = lValue;
                $(aContexteCourant.node).attr('title', lOldValue);
              }
            },
            aContexteCourant.node,
            aContexteCourant,
          );
        }
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-title' + (lNom ? '="' + lNom + '"' : ''),
        );
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-hint',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        if (ObjetHint_1.ObjetHint.getDisabled()) {
          aOutils.addCommentaireDebug(
            aContexteCourant.node,
            'ie-hint (désactivé sur mobile !)',
          );
          return true;
        }
        const lNom = aAttributValue || '';
        let lValue = lNom;
        if (
          lValue &&
          lValue.length > 2 &&
          lValue.charAt(0) === "'" &&
          lValue.charAt(lValue.length - 1) === "'"
        ) {
          lValue = lValue.slice(1, lValue.length - 1);
        } else if (lNom && aContexteCourant.controleur) {
          const lInfos = aOutils.getAccesParametres(
            lNom,
            aContexteCourant,
            true,
          );
          if (lInfos.estFonction) {
            lValue = function (aHint) {
              const lResult = lInfos.callback([
                aHint,
                aContexteCourant.node,
                aContexteCourant.data,
              ]);
              if (lResult && lResult.then) {
                return lResult;
              }
              return (lResult || '') + '';
            };
          }
        }
        if (!lValue) {
          return true;
        }
        ObjetHint_1.ObjetHint.attach({
          $Element: $(aContexteCourant.node),
          namespace: 'iehint',
          contenu: lValue,
          off: false,
        });
        aContexteCourant.node.dataset.avecIeHint = 'true';
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-hint' + (lNom ? '="' + lNom + '"' : ''),
        );
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-html',
      (
        aContexteCourant,
        aNodeName,
        aAttributValue,
        aOutils,
        aParametresCompile,
      ) => {
        let lValue = aAttributValue || '';
        if (!lValue) {
          return true;
        }
        if (!aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.valide) {
          return true;
        }
        const lNodeDestination = aOutils.addGetterHtml(
          aContexteCourant,
          lInfos,
        );
        if (!lNodeDestination) {
          return;
        }
        aOutils.addCommentaireDebug(
          lNodeDestination,
          'ie-html="' + lValue + '"',
        );
        aParametresCompile.avecCompileFils = false;
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-texte',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!lValue) {
          return true;
        }
        if (!aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.valide) {
          return true;
        }
        const lNodeDestination =
          aContexteCourant.nodeTransfertContenuDynamique ||
          aContexteCourant.node;
        const lGetter = function () {
          const lResult = lInfos.callback([
            lNodeDestination,
            aContexteCourant.data,
          ]);
          if (MethodesObjet_1.MethodesObjet.isNumber(lResult)) {
            return lResult + '';
          }
          return (lResult || '') + '';
        };
        let lOldTexte = lGetter();
        $(lNodeDestination).ieHtml('');
        lNodeDestination.appendChild(document.createTextNode(lOldTexte));
        aOutils.abonnerRefresh(
          () => {
            const lTexte = lGetter();
            if (lTexte !== lOldTexte) {
              lOldTexte = lTexte;
              $(lNodeDestination).ieHtml('');
              lNodeDestination.appendChild(document.createTextNode(lTexte));
            }
          },
          lNodeDestination,
          aContexteCourant,
        );
        aOutils.addCommentaireDebug(
          lNodeDestination,
          'ie-texte="' + lValue + '"',
        );
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-style',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        let lValue = aAttributValue || '';
        if (!lValue) {
          return true;
        }
        if (!aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.valide) {
          return true;
        }
        const lGetter = function () {
          const lStyle =
            lInfos.callback([aContexteCourant.node, aContexteCourant.data]) ||
            null;
          return lStyle || {};
        };
        let lObjetCss = lGetter();
        const lJNode = $(aContexteCourant.node);
        if (!lInfos.estFonction || !lObjetCss) {
          return;
        }
        lJNode.css(lObjetCss);
        aOutils.abonnerRefresh(
          () => {
            const lNewStyleCss = lGetter();
            if (
              !MethodesObjet_1.MethodesObjet.objetsIdentiques(
                lNewStyleCss,
                lObjetCss,
              )
            ) {
              lObjetCss = lNewStyleCss;
              $(aContexteCourant.node).css(lObjetCss);
            }
          },
          aContexteCourant.node,
          aContexteCourant,
        );
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-style="' + lValue + '"',
        );
        return true;
      },
    );
    (function () {
      IEHtml.addAttribut(
        'ie-class',
        (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
          const lValue = aAttributValue || '';
          if (!lValue || !aContexteCourant.controleur) {
            return true;
          }
          const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
          if (!lInfos.valide) {
            return true;
          }
          let lClassCss = lInfos.callback() || '';
          if (lClassCss.length > 0) {
            $(aContexteCourant.node).addClass(lClassCss);
          }
          aOutils.abonnerRefresh(
            () => {
              const lNewClassCss = lInfos.callback() || '';
              if (lNewClassCss !== lClassCss) {
                $(aContexteCourant.node)
                  .removeClass(lClassCss)
                  .addClass(lNewClassCss);
                lClassCss = lNewClassCss;
              }
            },
            aContexteCourant.node,
            aContexteCourant,
          );
          aOutils.addCommentaireDebug(
            aContexteCourant.node,
            'ie-class="' + lValue + '"',
          );
          return true;
        },
      );
    })();
    (function () {
      IEHtml.addAttribut(
        'ie-display',
        (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
          const lValue = aAttributValue || '';
          if (!lValue || !aContexteCourant.controleur) {
            return true;
          }
          const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
          if (!lInfos.valide) {
            return true;
          }
          const lGetter = function () {
            return !!lInfos.callback([
              aContexteCourant.node,
              aContexteCourant.data,
            ]);
          };
          const lDisplay = lGetter();
          ObjetHtml_1.GHtml.setDisplay(aContexteCourant.node, lDisplay);
          let lOldDisplayValue = lDisplay;
          aOutils.abonnerRefresh(
            () => {
              const lDisplay = lGetter();
              if (lDisplay !== lOldDisplayValue) {
                lOldDisplayValue = lDisplay;
                ObjetHtml_1.GHtml.setDisplay(aContexteCourant.node, lDisplay);
              }
            },
            aContexteCourant.node,
            aContexteCourant,
          );
          aOutils.addCommentaireDebug(
            aContexteCourant.node,
            'ie-display="' + lValue + '"',
          );
          return true;
        },
      );
    })();
    IEHtml.addAttribut(
      'ie-attr',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        const lValue = aAttributValue || '';
        if (!lValue || !aContexteCourant.controleur) {
          return true;
        }
        const lInfos = aOutils.getAccesParametres(lValue, aContexteCourant);
        if (!lInfos.estFonction) {
          return true;
        }
        const lGetter = function () {
          return lInfos.callback([]);
        };
        let lAttr = MethodesObjet_1.MethodesObjet.dupliquer(lGetter());
        if (lAttr) {
          $(aContexteCourant.node).attr(lAttr);
        }
        aOutils.abonnerRefresh(
          () => {
            const lNewAttr = lGetter();
            if (
              !MethodesObjet_1.MethodesObjet.objetsIdentiques(lNewAttr, lAttr)
            ) {
              lAttr = MethodesObjet_1.MethodesObjet.dupliquer(lNewAttr);
              $(aContexteCourant.node).attr(lAttr);
            }
          },
          aContexteCourant.node,
          aContexteCourant,
        );
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-attr="' + lValue + '"',
        );
        return true;
      },
    );
    function _initEllipsis(aContexteCourant, aOutils, aAttributValue) {
      const lOptions = { getJNodeHint: null, avecHint: true };
      if (aAttributValue) {
        const lGetOptions = aOutils.getAccesParametres(
          aAttributValue,
          aContexteCourant,
        );
        if (lGetOptions.estFonction) {
          Object.assign(lOptions, lGetOptions.callback());
        } else {
        }
      }
      $(aContexteCourant.node).addClass('ie-ellipsis');
      if (lOptions.avecHint && !ObjetHint_1.ObjetHint.getDisabled()) {
        aOutils.surInjectionHtml(
          aContexteCourant,
          (aParams) => {
            if (ObjetHint_1.ObjetHint.nodeDansHint(aContexteCourant.node)) {
              return;
            }
            aParams.addMutate(() => {
              if (aContexteCourant.node.dataset.avecIeHint) {
                return;
              }
              ObjetHint_1.ObjetHint.attach({
                $Element: MethodesObjet_1.MethodesObjet.isFunction(
                  lOptions.getJNodeHint,
                )
                  ? lOptions.getJNodeHint(aContexteCourant.node)
                  : $(aContexteCourant.node),
                namespace: 'ellipsis',
                contenu: function () {
                  return $(aContexteCourant.node).html();
                },
                interrupt: function () {
                  const lJThis = $(aContexteCourant.node);
                  if (aContexteCourant.node.dataset.avecIeHint) {
                    return true;
                  }
                  if (lJThis.prop('title').length > 0) {
                    return true;
                  }
                  if (
                    Math.ceil(lJThis.outerWidth()) >= lJThis.prop('scrollWidth')
                  ) {
                    return true;
                  }
                },
              });
            });
          },
          true,
        );
      }
    }
    IEHtml.addAttribut(
      'ie-ellipsis',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        _initEllipsis(aContexteCourant, aOutils, aAttributValue);
        aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-ellipsis');
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-ellipsis-fixe',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        _initEllipsis(aContexteCourant, aOutils, aAttributValue);
        aOutils.surInjectionHtml(
          aContexteCourant,
          (aParams) => {
            let lWidth = null;
            aParams.addMeasure(() => {
              if (!aContexteCourant.node.style.width) {
                lWidth = $(aContexteCourant.node).width();
              }
            });
            aParams.addMutate(() => {
              if (lWidth !== null) {
                $(aContexteCourant.node).width(Math.ceil(lWidth));
              }
            });
          },
          true,
        );
        aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-ellipsis-fixe');
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-hintoverflow',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        aOutils.surInjectionHtml(
          aContexteCourant,
          (aParams) => {
            aParams.addMutate(() => {
              if (aContexteCourant.node.dataset.avecIeHint) {
                return;
              }
              ObjetHint_1.ObjetHint.attach({
                $Element: $(aContexteCourant.node),
                namespace: 'ie-hintoverflow',
                contenu: function () {
                  return $(aContexteCourant.node).html();
                },
                interrupt: function () {
                  const lJThis = $(this);
                  if (aContexteCourant.node.dataset.avecIeHint) {
                    return true;
                  }
                  if (lJThis.prop('title').length > 0) {
                    return true;
                  }
                  const lScrollH = lJThis.prop('scrollHeight') - 1;
                  const lScrollW = lJThis.prop('scrollWidth') - 1;
                  if (lScrollH < 5 || lScrollW < 5) {
                    return true;
                  }
                  if (
                    Math.ceil(lJThis.outerHeight()) >= lScrollH &&
                    Math.ceil(lJThis.outerWidth()) >= lScrollW
                  ) {
                    return true;
                  }
                },
              });
            });
          },
          true,
        );
        aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-hintoverflow');
        return true;
      },
    );
    IEHtml.addAttribut(
      'ie-selecttextfocus',
      (aContexteCourant, aNodeName, aAttributValue, aOutils) => {
        if (aNodeName !== 'input' && aNodeName !== 'textarea') {
          return true;
        }
        $(aContexteCourant.node).on({
          focus: function () {
            if (this.select) {
              this.select();
            }
          },
          mouseup: function (e) {
            e.preventDefault();
          },
        });
        aOutils.addCommentaireDebug(
          aContexteCourant.node,
          'ie-selecttextfocus',
        );
        return true;
      },
    );
    tslib_1.__exportStar(require('IEHtml'), exports);
  },
  fn: 'iehtmlcomposants.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    require('fonts.css');
  },
  fn: 'declarationindexfont.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('lottie-player.js');
  },
  fn: 'declarationlottie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.LottiePatience = void 0;
    const GUID_1 = require('GUID');
    require('DeclarationLottie');
    class LottiePatience {
      static construire() {
        if (LottiePatience.url) {
          return IE.jsx.str('lottie-player', {
            src: LottiePatience.url,
            class: 'lottie-patience',
            background: 'transparent',
            'aria-hidden': 'true',
            autoplay: true,
            loop: true,
          });
        }
        return '';
      }
      static setUrl(aUrlLottie) {
        LottiePatience.url = aUrlLottie;
      }
    }
    exports.LottiePatience = LottiePatience;
    LottiePatience.url = '';
    $(window).on('load', () => {
      const lGuid = GUID_1.GUID.getId();
      setTimeout(() => {
        if (LottiePatience.url) {
          $(document.body).append(
            IE.jsx.str(
              'div',
              {
                id: lGuid,
                style:
                  'display:none; position:absolute; left: -1000px; width: 0px;',
              },
              LottiePatience.construire(),
            ),
          );
          $(`#${lGuid}`).remove();
        }
      }, 5000);
    });
  },
  fn: 'lottiepatience.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetMessageInformatif = void 0;
    require('ObjetMessageInformatif.css');
    const GUID_1 = require('GUID');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const GestionnaireModale_1 = require('GestionnaireModale');
    const LottiePatience_1 = require('LottiePatience');
    let u_windowOK = false;
    $(window).on('load', () => {
      u_windowOK = true;
    });
    class ObjetMessageInformatif {
      constructor() {
        this.Nom = GUID_1.GUID.getId();
        this.locked = false;
        this.DetailMessageInformatif = '';
        this.IdBarre = this.Nom + '_BarreProgression';
        this.IdDetailMessageInformatif = this.Nom + '_DetailMessageInformatif';
        this.IdMessageInformatif = this.Nom + '_DetailMessage';
        this.compteurBlocage = 0;
        if (u_windowOK) {
          this.init();
        } else {
          $(window).on('load', () => {
            this.init();
          });
        }
      }
      init() {
        if (!IE || !Invocateur_1.Invocateur || !ObjetHtml_1.GHtml) {
          return;
        }
        IEZoneFenetre_1.ZoneFenetre.ajouterFenetre(this.Nom, 2000);
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.eventIOAjax,
          this._surEventIOAjax.bind(this),
        );
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.patience,
          this._surPatience.bind(this),
        );
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.erreurCommunication,
          () => {
            this.debloquer(true);
            this.masquer();
          },
        );
        const lThis = this;
        $(window).on('resize', () => {
          if (lThis.EnAffichage) {
            lThis._positionner();
          }
        });
      }
      setDonnees(
        aMessage,
        aAvecBarreDeProgression,
        ANbElmtsTotal,
        ANbElmtsTraites,
        aParams,
      ) {
        this.AvecBarreDeProgression = aAvecBarreDeProgression;
        this.DetailMessageInformatif = aMessage;
        this.NbElmtsTotal = ANbElmtsTotal;
        this.NbElmtsTraites = (ANbElmtsTraites ? ANbElmtsTraites : 0) - 1;
        const lTraduction = ObjetTraduction_1.GTraductions
          ? ObjetTraduction_1.GTraductions.getValeur(
              'connexion.MessageVeuillezPatienter',
            )
          : '';
        this.afficher(lTraduction, null, true, null, aParams);
        if (this.AvecBarreDeProgression) {
          this.locked = true;
          this.progresser();
        }
      }
      afficher(aMessage, aDuree, aBloquer, aDetailMessageInformatif, aParams) {
        this.compteurBlocage += 1;
        this._arreterTimerAffichage();
        if (!this.locked) {
          this.message = aMessage;
          this.duree = aDuree;
          this.bloquer = aBloquer;
          if (this.bloquer && this.compteurBlocage === 1) {
            this._bloquerInterface();
          }
          this._afficherContenu(
            aMessage,
            aDuree,
            aDetailMessageInformatif,
            aParams,
          );
        }
      }
      bloquerAfficherAvecDelai(
        aMessage,
        aDelaiAffichage,
        aDetailMessageInformatif,
        aParams,
      ) {
        this.compteurBlocage += 1;
        this._arreterTimerAffichage();
        if (!this.locked) {
          this.message = aMessage;
          this.duree = null;
          this.bloquer = true;
          if (this.compteurBlocage === 1) {
            this._bloquerInterface();
          }
          if (this.EnAffichage) {
            this._afficherContenu(
              aMessage,
              null,
              aDetailMessageInformatif,
              aParams,
            );
          } else {
            const lDelaiAffichage =
              !IE.estMobile && aDelaiAffichage ? aDelaiAffichage : 0;
            this._timerAffichage = setTimeout(
              this._afficherContenu.bind(
                this,
                aMessage,
                null,
                aDetailMessageInformatif,
                aParams,
              ),
              lDelaiAffichage,
            );
          }
        }
      }
      masquer() {
        this.compteurBlocage = Math.max(0, this.compteurBlocage - 1);
        if (this.compteurBlocage > 0) {
          return;
        }
        this._arreterTimerAffichage();
        if (!this.locked) {
          ObjetHtml_1.GHtml.setDisplay(this.Nom, false);
          ObjetHtml_1.GHtml.setHtml(this.Nom, '');
          this.DetailMessageInformatif = '';
          if (this.bloquer && this.guidBlocage) {
            try {
              GestionnaireModale_1.GestionnaireModale.bloquerInterface({
                bloquer: false,
                avecVoile: false,
                guidBlocage: this.guidBlocage,
              });
              this.guidBlocage = null;
            } catch (E) {}
          }
          this.EnAffichage = false;
        }
      }
      masquerAvecLock() {
        this._arreterTimerAffichage();
        this.locked = false;
        this.masquer();
      }
      progresser(aParam) {
        this._arreterTimerAffichage();
        if (this.AvecBarreDeProgression && !aParam) {
          this.NbElmtsTraites++;
          if (this.NbElmtsTotal !== 0) {
            const LPourcentage =
              (this.NbElmtsTraites * 100) / this.NbElmtsTotal;
            ObjetHtml_1.GHtml.setHtml(
              this.IdBarre,
              this.construireBarre(LPourcentage),
            );
            ObjetHtml_1.GHtml.setHtml(
              this.IdDetailMessageInformatif,
              this.DetailMessageInformatif +
                ' ' +
                this.NbElmtsTraites +
                '/' +
                this.NbElmtsTotal,
            );
          }
        } else if (
          this.AvecBarreDeProgression &&
          aParam &&
          MethodesObjet_1.MethodesObjet.isObject(aParam)
        ) {
          this.NbElmtsTraites = aParam.progress.actualFile;
          ObjetHtml_1.GHtml.setHtml(
            this.IdBarre,
            this.construireBarre(aParam.progress.percent),
          );
          ObjetHtml_1.GHtml.setHtml(
            this.IdDetailMessageInformatif,
            (aParam.message || this.DetailMessageInformatif) +
              ' ' +
              this.NbElmtsTraites +
              '/' +
              this.NbElmtsTotal,
          );
        }
      }
      debloquer(aDebloquerForcer) {
        this._arreterTimerAffichage();
        const LPourcentage = (this.NbElmtsTraites * 100) / this.NbElmtsTotal;
        if (LPourcentage === 100 || aDebloquerForcer) {
          this.AvecBarreDeProgression = false;
          this.DetailMessageInformatif = '';
          this.locked = false;
        }
      }
      construireBarre(APourcentage) {
        return '<div style="width:' + APourcentage + '%;"></div>';
      }
      setDetailMessageInformatif(AMessage) {
        this.DetailMessageInformatif = AMessage;
        ObjetHtml_1.GHtml.setHtml(this.IdDetailMessageInformatif, AMessage);
      }
      _arreterTimerAffichage() {
        if (this._timerAffichage) {
          clearTimeout(this._timerAffichage);
          delete this._timerAffichage;
        }
      }
      _afficherContenu(aMessage, aDuree, aDetailMessageInformatif, aParams) {
        this._arreterTimerAffichage();
        const lParams = Object.assign(
          { htmlPied: '', controleur: null },
          aParams,
        );
        const lHtml = IE.jsx.str(
          'div',
          { class: 'MessageInformatif', role: 'presentation' },
          IE.jsx.str(
            IE.jsx.fragment,
            null,
            IE.estMobile ? IE.jsx.str('div', { class: 'overlay' }) : '',
            IE.jsx.str(
              'div',
              { class: 'content' },
              IE.jsx.str(
                IE.jsx.fragment,
                null,
                IE.jsx.str(
                  'div',
                  {
                    class: 'message',
                    id: this.IdMessageInformatif,
                    tabindex: '-1',
                    role: 'alert',
                  },
                  aMessage,
                ),
                LottiePatience_1.LottiePatience.construire(),
                IE.jsx.str(
                  'div',
                  {
                    class: 'detail-message',
                    id: this.IdDetailMessageInformatif,
                  },
                  aDetailMessageInformatif
                    ? aDetailMessageInformatif
                    : this.DetailMessageInformatif,
                ),
                this.AvecBarreDeProgression
                  ? IE.jsx.str(
                      'div',
                      {
                        id: this.IdBarre,
                        class: 'progress',
                        'aria-hidden': 'true',
                      },
                      this.construireBarre(0),
                    )
                  : '',
                lParams.htmlPied
                  ? IE.jsx.str('div', { class: 'pied' }, lParams.htmlPied)
                  : '',
              ),
            ),
          ),
        );
        if (this.EnAffichage) {
          clearInterval(this.Timer);
        }
        ObjetHtml_1.GHtml.setHtml(this.Nom, lHtml, {
          controleur: lParams.controleur,
        });
        try {
          ObjetHtml_1.GHtml.setDisplay(this.Nom, true);
          $(`#${this.Nom.escapeJQ()} .content`)
            .finish()
            .css('opacity', 0)
            .animate({ opacity: 1 }, { duration: 500 });
          this._positionner();
        } catch (E) {
          try {
            document.getElementById(
              this.IdMessageInformatif,
            ).style.outlineWidth = '0px';
          } catch (e) {}
        }
        this.EnAffichage = true;
        if (aDuree) {
          this.Timer = setTimeout(this.masquer.bind(this), aDuree * 1000);
        }
      }
      _positionner() {
        ObjetPosition_1.GPosition.centrer(this.Nom);
      }
      _bloquerInterface() {
        try {
          this.guidBlocage =
            GestionnaireModale_1.GestionnaireModale.bloquerInterface({
              bloquer: true,
              pourPatience: true,
              avecVoile: false,
              prioriteBlocage:
                GestionnaireModale_1.GestionnaireModale
                  .TypePrioriteBlocageInterface.messageInformatif,
            });
        } catch (E) {}
      }
      _surEventIOAjax(aParametres) {
        if (aParametres.actualisation) {
          if (this.EnAffichage && !this.locked) {
            this.setDetailMessageInformatif(aParametres.message || '');
          }
          return;
        }
        if (aParametres.blocageDeconnexion === true) {
          this.blocageDeconnexion = true;
          this.compteurBlocage = 0;
          this.debloquer(true);
          this.masquer();
          this.bloquerAfficherAvecDelai(
            ObjetTraduction_1.GTraductions.getValeur(
              'requete.VeuillezPatienter',
            ),
            0,
            aParametres.message || '',
          );
          return;
        }
        if (aParametres.blocageDeconnexion === false) {
          delete this.blocageDeconnexion;
          this.masquer();
          return;
        }
        if (this.blocageDeconnexion) {
          return;
        }
        if (aParametres.emission) {
          if (aParametres.upload) {
            if (aParametres.nombreFichiers > 0 && aParametres.progress) {
              if (aParametres.progress.personnalise) {
                this.progresser(aParametres);
              } else if (aParametres.progress.percent === 0) {
                this.setDonnees(
                  aParametres.message ||
                    ObjetTraduction_1.GTraductions.getValeur(
                      'requete.transfertPJ',
                    ),
                  true,
                  aParametres.nombreFichiers,
                  aParametres.progress.actualFile,
                  aParametres.params,
                );
              } else {
                this.progresser(aParametres);
              }
            } else if (aParametres.nombreFichiers > 0) {
              this.setDonnees(
                aParametres.message ||
                  ObjetTraduction_1.GTraductions.getValeur(
                    'requete.transfertPJ',
                  ),
                true,
                aParametres.nombreFichiers,
                null,
                aParametres.params,
              );
            } else {
              this.progresser();
            }
          } else {
            const lMessage = ObjetTraduction_1.GTraductions.getValeur(
              'requete.VeuillezPatienter',
            );
            const lDetail = aParametres.message || '';
            if (aParametres.delai === 0) {
              this.afficher(lMessage, null, true, lDetail, aParametres.params);
            } else {
              this.bloquerAfficherAvecDelai(
                lMessage,
                aParametres.delai || 500,
                lDetail,
                aParametres.params,
              );
            }
          }
        } else {
          if (aParametres.upload) {
            this.debloquer(aParametres.debloquerForcer);
          }
          this.masquer();
        }
      }
      _surPatience(aAfficher, aParametres) {
        const lParametres = Object.assign(
          { delai: 0, message: '' },
          aParametres,
        );
        if (aAfficher) {
          this.bloquerAfficherAvecDelai(
            ObjetTraduction_1.GTraductions.getValeur(
              'requete.VeuillezPatienter',
            ),
            lParametres.delai || 0,
            lParametres.message || '',
          );
        } else {
          this.masquer();
        }
      }
    }
    exports.ObjetMessageInformatif = ObjetMessageInformatif;
  },
  fn: 'objetmessageinformatif.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreAction = void 0;
    var EGenreAction;
    (function (EGenreAction) {
      EGenreAction[(EGenreAction['Valider'] = 0)] = 'Valider';
      EGenreAction[(EGenreAction['NePasValider'] = 1)] = 'NePasValider';
      EGenreAction[(EGenreAction['Annuler'] = 2)] = 'Annuler';
    })(EGenreAction || (exports.EGenreAction = EGenreAction = {}));
  },
  fn: 'enumere_action.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreBoiteMessage = void 0;
    var EGenreBoiteMessage;
    (function (EGenreBoiteMessage) {
      EGenreBoiteMessage[(EGenreBoiteMessage['Information'] = 0)] =
        'Information';
      EGenreBoiteMessage[(EGenreBoiteMessage['Confirmation'] = 1)] =
        'Confirmation';
      EGenreBoiteMessage[(EGenreBoiteMessage['MrFiche'] = 2)] = 'MrFiche';
    })(
      EGenreBoiteMessage ||
        (exports.EGenreBoiteMessage = EGenreBoiteMessage = {}),
    );
  },
  fn: 'enumere_boitemessage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EStructureAffichage = void 0;
    var EStructureAffichage;
    (function (EStructureAffichage) {
      EStructureAffichage[(EStructureAffichage['Verticale'] = 1)] = 'Verticale';
      EStructureAffichage[(EStructureAffichage['Autre'] = 3)] = 'Autre';
    })(
      EStructureAffichage ||
        (exports.EStructureAffichage = EStructureAffichage = {}),
    );
  },
  fn: 'enumere_structureaffichage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetInterface = void 0;
    require('ObjetInterface.css');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_Event_1 = require('Enumere_Event');
    const Enumere_StructureAffichage_1 = require('Enumere_StructureAffichage');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetWAI_1 = require('ObjetWAI');
    class ObjetInterface extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.Instances = [];
        this.GenreAffichage = [];
        this.NombreGenreAffichage = 0;
        this._pileInfosFenetres = [];
        this._pileFenetre = [];
        this.EtatIdCourant = true;
        this.reinitialiser();
        this.AvecCadre = true;
        this.GenreStructure =
          Enumere_StructureAffichage_1.EStructureAffichage.Verticale;
        this.IdentZoneAlClient = -1;
        this.AddSurZone = [];
        this.idPremierObjet = '';
        if (this.Nom && this.avecEventResizeNavigateur()) {
          this.ajouterEvenementGlobal(
            Enumere_Event_1.EEvent.SurResize,
            this._surResizeInterface,
          );
        }
      }
      reinitialiser() {
        this.detruireInstancesFils();
        this.Instances = [];
        this.GenreAffichage = [];
        this.NombreGenreAffichage = 0;
        this._pileInfosFenetres = [];
      }
      focusSurPremierElement() {}
      focusSurPremierObjet() {
        if (this.idPremierObjet) {
          ObjetHtml_1.GHtml.setFocus(this.idPremierObjet);
        } else {
          IE.log.addLog(
            '[' +
              MethodesObjet_1.MethodesObjet.getNomClassDeConstructeur(
                this.constructor,
              ) +
              '] Il est où mon premierobjet ?',
            '',
            IE.log.genre.Avertissement,
          );
        }
      }
      addInstance(aParametres) {
        const lParametres = {
          objet: null,
          constructionFenetre: false,
          evenement: null,
          init: null,
          ident: null,
          traductions: null,
        };
        $.extend(lParametres, aParametres);
        const lObjetGraphique = this.getObjetGraphique(lParametres.objet);
        if (!lObjetGraphique) {
          IE.log.addLog(
            'ObjetInterface.addInstance : "' +
              (lObjetGraphique ? lObjetGraphique.nom : lParametres.objet) +
              '" n"existe pas!',
            null,
            IE.log.genre.Avertissement,
          );
          return null;
        }
        if (lParametres.ident !== null && lParametres.ident !== undefined) {
          this.NombreGenreAffichage = lParametres.ident;
        }
        this.GenreAffichage[this.NombreGenreAffichage] = lParametres.objet;
        if (lObjetGraphique) {
          if (lParametres.constructionFenetre) {
            this._pileInfosFenetres[this.NombreGenreAffichage] = {
              ident: this.NombreGenreAffichage,
              genre: lParametres.objet,
              evenement: lParametres.evenement,
              init: lParametres.init,
              traductions: lParametres.traductions,
              coordonnees: { left: 0, top: 0 },
            };
          } else {
            const lInstance = this._construireObjetGraphique(
              lObjetGraphique.constructeur,
              lObjetGraphique.nom,
              this.NombreGenreAffichage,
              lParametres.evenement,
            );
            this.Instances[this.NombreGenreAffichage] = lInstance;
            if (lParametres.init) {
              lParametres.init.call(this, lInstance);
            }
          }
        }
        return this.NombreGenreAffichage++;
      }
      getObjetGraphique(aConstructor) {
        if (
          aConstructor &&
          MethodesObjet_1.MethodesObjet.isFunction(aConstructor)
        ) {
          const lInfosObjet = {
            nom: 'NON IDENTIFIE',
            estFenetre:
              aConstructor.prototype &&
              aConstructor.prototype.estObjetGraphiqueFenetre(),
            constructeur: aConstructor,
          };
          return lInfosObjet;
        }
        return null;
      }
      add(aClassIdentite, AEvenement, AInitialiser, aTraductions, I) {
        return this.addInstance({
          objet: aClassIdentite,
          evenement: AEvenement,
          init: AInitialiser,
          traductions: aTraductions,
          ident: I,
        });
      }
      addFenetre(aClassFenetre, AEvenement, AInitialiser, aTraductions, I) {
        return this.addInstance({
          objet: aClassFenetre,
          constructionFenetre: true,
          evenement: AEvenement,
          init: AInitialiser,
          traductions: aTraductions,
          ident: I,
        });
      }
      del() {
        this.Instances[this.NombreGenreAffichage] = null;
        this.NombreGenreAffichage--;
      }
      getInstance(AIdent) {
        let lInstance = this.Instances[AIdent];
        if (
          !this.Instances[AIdent] &&
          this.getObjetGraphique(this.GenreAffichage[AIdent]) &&
          this.getObjetGraphique(this.GenreAffichage[AIdent]).estFenetre &&
          this._pileInfosFenetres[AIdent] &&
          !this.__enCoursDeDestruction
        ) {
          lInstance = this.creerFenetre(AIdent);
        }
        return lInstance;
      }
      existeInstance(aIdent) {
        return !!this.Instances[aIdent];
      }
      creerFenetre(AIdent) {
        let lInstance;
        if (this._pileInfosFenetres[AIdent]) {
          const lInfosFenetre = this._pileInfosFenetres[AIdent];
          const lObjetGraphique = this.getObjetGraphique(lInfosFenetre.genre);
          lInstance = this._construireObjetGraphique(
            lObjetGraphique.constructeur,
            lObjetGraphique.nom,
            AIdent,
            lInfosFenetre.evenement,
          );
          lInstance.destructionSurFermeture = true;
          const lSelf = this;
          lInstance.ajouterCallbackSurDestruction(() => {
            if (
              AIdent !== undefined &&
              lSelf.Instances[AIdent] &&
              lSelf._pileInfosFenetres[AIdent]
            ) {
              lSelf.Instances[AIdent] = null;
              const lIndice = lSelf._pileFenetre.indexOf(
                lSelf.getZoneId(AIdent),
              );
              if (lIndice >= 0) {
                lSelf._pileFenetre[lIndice] = null;
              }
            }
          });
          if (!this._pileFenetre) {
            this._pileFenetre = [];
          }
          this._pileFenetre.push(this.getZoneId(AIdent));
          IEZoneFenetre_1.ZoneFenetre.ajouterFenetre(
            this.getZoneId(AIdent),
            lInstance.getZIndex ? lInstance.getZIndex() : '',
          );
          if (lInfosFenetre.init) {
            lInfosFenetre.init.call(this, lInstance);
          }
          lInstance.coordonnees = lInfosFenetre.coordonnees;
          lInstance.initialiser();
          this.Instances[AIdent] = lInstance;
        }
        return lInstance;
      }
      getNomInstance(AIdent) {
        return this.getInstance(AIdent)
          ? this.getInstance(AIdent).getNom()
          : '';
      }
      getInstanceParNom(aNom) {
        for (let I = 0; I < this.NombreGenreAffichage; I++) {
          if (this.getNomInstance(I) === aNom) {
            return this.getInstance(I);
          }
        }
      }
      getZoneId(AIdent) {
        return this.construireNom(this.Nom + '.Instances', AIdent);
      }
      initialiser(aReset) {
        if (aReset) {
          this.reinitialiser();
        }
        this.EnConstruction = true;
        try {
          this.construireInstances();
          this.setParametresGeneraux();
          ObjetHtml_1.GHtml.setHtml(
            this.Pere === null || this.Pere === undefined
              ? GApplication.getIdConteneur()
              : this.Nom,
            this._construireStructureAffichage(),
            { instance: this },
          );
          this.construireAffichage();
        } finally {
          this.EnConstruction = false;
        }
        this.recupererDonnees();
        this.surResizeInterface();
        return this;
      }
      appartientAZone(AIdent) {
        for (let I = 0; I < this.AddSurZone.length; I++) {
          const lElement = this.AddSurZone[I];
          if (
            (lElement === AIdent && lElement !== '') ||
            (lElement && lElement.ident === AIdent)
          ) {
            return true;
          }
        }
        return false;
      }
      construireStructureAffichageVerticale(lFooter) {
        const H = [];
        let lInfo;
        H.push(
          '<div class="interface_affV',
          this.AvecCadre ? ' interface_affV_padding' : '',
          !!lFooter ? lFooter : '',
          '" ',
          ObjetWAI_1.GObjetWAI.composeRole(ObjetWAI_1.EGenreRole.Presentation),
          '>',
        );
        const lTabAffichages = [];
        for (let I = 0; I < this.NombreGenreAffichage; I++) {
          if (
            !this.appartientAZone(I) &&
            !this.getObjetGraphique(this.GenreAffichage[I]).estFenetre
          ) {
            lInfo = { estZoneClient: this.IdentZoneAlClient === I, indice: I };
            lTabAffichages.push(lInfo);
          }
        }
        for (let I = 0; I < lTabAffichages.length; I++) {
          lInfo = lTabAffichages[I];
          H.push(
            '<div id="' + this.getZoneId(lInfo.indice) + '"',
            lInfo.estZoneClient ? ' class="interface_affV_client"' : '',
            '></div>',
          );
        }
        if (this.NombreGenreAffichage === 0) {
          H.push('<div>' + this.composeMessage('') + '</div>');
        }
        H.push('</div>');
        return H.join('');
      }
      construireStructureAffichageAutre() {
        return '';
      }
      construireStructureFenetres() {
        this._effacerFenetres();
        const H = [];
        for (let I = 0; I < this.NombreGenreAffichage; I++) {
          const lInstance = this.Instances[I];
          if (
            this.getObjetGraphique(this.GenreAffichage[I]).estFenetre &&
            lInstance
          ) {
            if (!this._pileFenetre) {
              this._pileFenetre = [];
            }
            this._pileFenetre.push(this.getZoneId(I));
            IEZoneFenetre_1.ZoneFenetre.ajouterFenetre(
              this.getZoneId(I),
              lInstance &&
                'getZIndex' in lInstance &&
                MethodesObjet_1.MethodesObjet.isFunction(lInstance.getZIndex)
                ? lInstance.getZIndex()
                : '',
            );
          }
        }
        return H.join('');
      }
      construireInstances() {}
      setParametresGeneraux() {}
      construireStructureAffichage() {
        const lHtml = [];
        switch (this.GenreStructure) {
          case Enumere_StructureAffichage_1.EStructureAffichage.Verticale:
            lHtml.push(this.construireStructureAffichageVerticale());
            break;
          default:
            lHtml.push(this.construireStructureAffichageAutre());
            break;
        }
        if (this.AddSurZone.length || this.avecBandeau) {
          this.construireStructureAffichageBandeau();
        }
        return lHtml.join('');
      }
      construireStructureAffichageBandeau() {}
      construireAffichage() {
        for (let I = 0; I < this.NombreGenreAffichage; I++) {
          if (this.Instances[I]) {
            if (!this.getObjetGraphique(this.GenreAffichage[I]).estFenetre) {
              this.Instances[I].setVisible(this.Instances[I].Visible);
            }
            this.Instances[I].initialiser();
          }
        }
        return '';
      }
      recupererDonnees(...aParams) {}
      construireObjetGraphique(ANomObjet, AIdent, AEvenement) {
        const lObjetGraphique = this.getObjetGraphique(ANomObjet);
        return lObjetGraphique
          ? this._construireObjetGraphique(
              lObjetGraphique.constructeur,
              lObjetGraphique.nom,
              AIdent,
              AEvenement,
            )
          : null;
      }
      setCallbackNavigation(aCallbackNavigation) {
        this._callbackNavigation = aCallbackNavigation;
      }
      actionSurValidation(...aParams) {
        if (this._callbackNavigation) {
          this._callbackNavigation();
          delete this._callbackNavigation;
        } else if (this.afficherPage) {
          this.afficherPage(...aParams);
        } else {
          this.recupererDonnees(...aParams);
        }
      }
      setIdCourant(AId) {
        if (this.EtatIdCourant && window.GEtatUtilisateur) {
          window.GEtatUtilisateur.IdCourant = AId;
        }
      }
      getIdCourant() {
        return window.GEtatUtilisateur
          ? window.GEtatUtilisateur.IdCourant
          : null;
      }
      setFocusIdCourant() {
        ObjetHtml_1.GHtml.setFocus(this.getIdCourant());
      }
      setEtatIdCourant(ABool) {
        this.EtatIdCourant =
          ABool !== null && ABool !== undefined ? ABool : true;
      }
      _surResizeInterface() {
        this.surResizeInterface();
      }
      surResizeInterface() {}
      detruireInstancesFils() {
        this._effacerFenetres();
        super.detruireInstancesFils();
        const lNbr = this.Instances ? this.Instances.length : 0;
        let lInstance;
        for (let I = 0; I < lNbr; I++) {
          lInstance = this.Instances[I];
          if (
            lInstance &&
            (!lInstance.isDestroyed || !lInstance.isDestroyed()) &&
            lInstance.free
          ) {
            IE.log.addLog(
              'detruireInstancesFils instance non detruite : ' +
                lInstance.getNom(),
            );
            lInstance.free();
          }
          this.Instances[I] = null;
        }
      }
      _construireObjetGraphique(aConstructeur, aNom, aIdent, aEvenement) {
        IE.log.addLog(
          'Interface Construire ' + aNom + ' (' + aIdent + ')',
          'OBJETINTERFACE_LOGNOM',
        );
        if (aConstructeur) {
          return new aConstructeur({
            nomObjet: 'Instances[' + aIdent + ']',
            pere: this,
            evenement: aEvenement,
          });
        }
        return null;
      }
      getPageImpression(AFormat) {
        return;
      }
      _construireStructureAffichage() {
        const lHtml = [];
        lHtml.push(this.construireStructureFenetres());
        lHtml.push(this.construireStructureAffichage());
        return lHtml.join('');
      }
      _effacerFenetres() {
        if (this._pileFenetre) {
          this._pileFenetre = [];
        }
      }
    }
    exports.ObjetInterface = ObjetInterface;
  },
  fn: 'objetinterface.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports._ObjetFenetre = void 0;
    const ObjetInterface_1 = require('ObjetInterface');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const Enumere_StructureAffichage_1 = require('Enumere_StructureAffichage');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const MethodesTableau_1 = require('MethodesTableau');
    const GestionnaireModale_1 = require('GestionnaireModale');
    class _ObjetFenetre extends ObjetInterface_1.ObjetInterface {
      constructor(...aParams) {
        super(...aParams);
        this._structureBoutons = [];
        this.__surDestructionApresFermeture_ = false;
        this.optionsFenetre = {
          roleWAI: 'dialog',
          listeBoutonsInvisibles: [],
          opaciteVoileModale: GestionnaireModale_1.OpaciteVoileBloquant.default,
        };
        this.EnAffichage = false;
        this.promise = null;
        this._promiseResolve = null;
        this.NomFenetre = this.Nom + '_Fenetre';
        this.idFenetreContenu = this.Nom + '_FenetreContenu';
        this.IdTitre = this.Nom + '_Titre';
        this.IdTitreImage = this.IdTitre + '_image';
        this.IdContenu = this.Nom + '_Contenu';
        this.IdPremierElement = this.NomFenetre;
        this.GenreStructure =
          Enumere_StructureAffichage_1.EStructureAffichage.Autre;
        this.optionsInterne = { closeStart: null, closeEnd: null };
      }
      setOptionsFenetre(aOptions) {
        Object.assign(this.optionsFenetre, aOptions);
        this._structureBoutons = null;
        this.$refreshSelf();
        return this;
      }
      _getOptionsFenetre() {
        return this.optionsFenetre;
      }
      setBoutonActif(I, AActif) {
        if (this.optionsFenetre.listeBoutonsInactifs) {
          this.optionsFenetre.listeBoutonsInactifs[I] = !AActif;
          this.$refreshSelf();
        }
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          $off: function () {
            return !aInstance.EnAffichage;
          },
          listeBoutons() {
            if (!aInstance._structureBoutons) {
              aInstance._structureBoutons = [];
              const T = aInstance._structureBoutons;
              aInstance.optionsFenetre.listeBoutons.forEach(
                (aElement, aIndex) => {
                  const lElement = {
                    index: null,
                    libelle: null,
                    theme: null,
                    sansFermeture: null,
                  };
                  if (typeof aElement === 'string') {
                    lElement.libelle = aElement;
                  } else {
                    Object.assign(lElement, aElement);
                  }
                  if (aElement) {
                    lElement.index = aIndex;
                    lElement.theme = lElement.theme
                      ? lElement.theme
                      : lElement.libelle ===
                          ObjetTraduction_1.GTraductions.getValeur('Valider')
                        ? Type_ThemeBouton_1.TypeThemeBouton.primaire
                        : Type_ThemeBouton_1.TypeThemeBouton.secondaire;
                    lElement.sansFermeture = lElement.sansFermeture
                      ? lElement.sansFermeture
                      : false;
                    T.push(lElement);
                  }
                },
              );
            }
            return aInstance._structureBoutons || [];
          },
          fenetreBtn: {
            event(aBoutonRepeat) {
              aInstance.surValidation(aBoutonRepeat.element.index);
            },
            getLibelle(aBoutonRepeat) {
              return aBoutonRepeat.element.libelle;
            },
            getDisabled(aBoutonRepeat) {
              if (aBoutonRepeat.element.getDisabled) {
                return aBoutonRepeat.element.getDisabled();
              }
              return (
                aInstance.optionsFenetre.listeBoutonsInactifs &&
                aInstance.optionsFenetre.listeBoutonsInactifs[
                  aBoutonRepeat.element.index
                ] === true
              );
            },
            getOptions(aBoutonRepeat) {
              if (
                MethodesObjet_1.MethodesObjet.isObject(
                  aBoutonRepeat.element.options,
                )
              ) {
                return aBoutonRepeat.element.options;
              }
            },
          },
        });
      }
      composeContenu() {
        return '';
      }
      getBoutonNumero(aNumeroBouton) {
        let lBouton = {};
        if (this.optionsFenetre.listeBoutons) {
          const lBoutonFenetre =
            this.optionsFenetre.listeBoutons[aNumeroBouton];
          if (typeof lBoutonFenetre === 'string') {
            lBouton = { libelle: lBoutonFenetre };
          } else {
            lBouton = lBoutonFenetre;
          }
        }
        return lBouton || { annuler: true };
      }
      setBoutonVisible(I, aVisible) {
        this.optionsFenetre.listeBoutonsInvisibles[I] = !aVisible;
        this.$refreshSelf();
      }
      getParametresValidation(aNumeroBouton) {
        const lParametres = {
          instance: this,
          bouton: this.getBoutonNumero(aNumeroBouton),
          numeroBouton: aNumeroBouton,
        };
        if (
          MethodesObjet_1.MethodesObjet.isFunction(
            this.optionsFenetre.addParametresValidation,
          )
        ) {
          Object.assign(
            lParametres,
            this.optionsFenetre.addParametresValidation.call(
              this.Pere,
              lParametres,
            ),
          );
        }
        return lParametres;
      }
      promiseResolve(aParams) {
        if (this._promiseResolve) {
          this._promiseResolve(aParams);
          this._promiseResolve = null;
        }
      }
      surValidation(ANumeroBouton) {
        const lParams = this.getParametresValidation(ANumeroBouton);
        this.promiseResolve(lParams);
        if (this.optionsFenetre.surValiderAvantFermer) {
          this.optionsFenetre.surValiderAvantFermer.call(this.Pere, lParams);
        }
        if (
          !lParams ||
          !lParams.bouton ||
          typeof lParams.bouton !== 'object' ||
          !lParams.bouton.sansFermeture
        ) {
          this.fermer();
        }
        if (this.optionsFenetre.callback) {
          this.optionsFenetre.callback.call(this.Pere, ANumeroBouton, lParams);
        }
        this.callback.appel(ANumeroBouton, lParams);
      }
      async fermer(aSurInteractionUtilisateur) {
        if (!this.estAffiche()) {
          return Promise.resolve();
        }
        this.optionsInterne.closeStart();
        try {
          if (this._focusPrecedent && $(this._focusPrecedent).length === 1) {
            if (ObjetHtml_1.GHtml.focusEstDansElement(this.Nom)) {
              $(this._focusPrecedent).focus();
            }
            this._focusPrecedent = null;
          }
        } catch (e) {}
        this.EnAffichage = false;
        if (this.surFermer) {
          this.surFermer();
        }
        if (
          MethodesObjet_1.MethodesObjet.isFunction(
            this.optionsFenetre.callbackFermer,
          )
        ) {
          this.optionsFenetre.callbackFermer();
        }
        if (
          MethodesObjet_1.MethodesObjet.isFunction(
            this.optionsFenetre.callbackApresFermer,
          )
        ) {
          this.optionsFenetre.callbackApresFermer();
        }
        this.promiseResolve({ surFermer: true });
        this.$refresh();
        const lResultPromise = this.optionsInterne.closeEnd();
        const lFunc = () => {
          ObjetHtml_1.GHtml.setDisplay(this.Nom, false);
          if (this.destructionSurFermeture && !this.__enCoursDeDestruction) {
            this.__surDestructionApresFermeture_ = true;
            this.free();
          }
        };
        if (lResultPromise && lResultPromise.then) {
          return lResultPromise.then(lFunc);
        }
        lFunc();
        return Promise.resolve();
      }
      async afficher(...aParams) {
        return;
      }
      surAfficher() {}
      actualiser() {}
      surFermer() {}
      estAffiche() {
        return this.EnAffichage === true;
      }
      setBoutonFocus(aVal, avecDecalageFocus) {
        let lIndice = aVal;
        if (MethodesObjet_1.MethodesObjet.isObject(aVal)) {
          lIndice = MethodesTableau_1.MethodesTableau.indexOfMask(
            this.optionsFenetre.listeBoutons,
            aVal,
          );
        }
        if (lIndice >= 0) {
          ObjetHtml_1.GHtml.setFocus(
            this._getIdBoutons(lIndice),
            true,
            avecDecalageFocus,
          );
        }
        return this;
      }
      composeBas() {
        return this.optionsFenetre.htmlFooter || '';
      }
      positionnerFenetre(aParams) {
        return this;
      }
      existeCoordonnees() {
        return false;
      }
      setCoordonnees() {}
      positionnerSousId(aId) {}
      surFixerTaille() {}
      _getIdBoutons(aIndice) {
        return this.Nom + '_btns_' + aIndice;
      }
      setBoutonLibelle(I, aLibelle) {}
      debutRetaillage() {}
      finRetaillage() {}
      getHeightMaxIdSelonEcran(aId) {
        return 0;
      }
      estObjetGraphiqueFenetre() {
        return true;
      }
      static creerInstanceFenetre(aConstructeur, aParametres, aOptionsFenetre) {
        if (!aParametres || !aParametres.pere) {
          return;
        }
        const lInstance = ObjetIdentite_1.Identite.creerInstance(
          aConstructeur,
          aParametres,
        );
        const lParametres = $.extend(
          { initialiser: true, destructionSurFermeture: true, nomComplet: '' },
          aParametres,
        );
        lInstance.destructionSurFermeture = lParametres.destructionSurFermeture;
        if (aOptionsFenetre && aOptionsFenetre.zIndex) {
          const lZIndex = aOptionsFenetre.zIndex;
          lInstance.getZIndex = function () {
            return lZIndex;
          };
        }
        IEZoneFenetre_1.ZoneFenetre.ajouterFenetre(
          lParametres.nomComplet,
          lInstance.getZIndex ? lInstance.getZIndex() : 1100,
        );
        $('#' + lInstance.getNom().escapeJQ()).on('destroyed', () => {
          if (lInstance.destructionSurFermeture) {
            lInstance.free();
          }
        });
        if (aOptionsFenetre) {
          lInstance.setOptionsFenetre(aOptionsFenetre);
        }
        if (lParametres.initialiser) {
          if (
            MethodesObjet_1.MethodesObjet.isFunction(lParametres.initialiser)
          ) {
            lParametres.initialiser.call(lParametres.pere, lInstance);
          }
          lInstance.initialiser();
        }
        return lInstance;
      }
      static creerInstance() {
        throw new Error('creerInstance incorrect');
      }
    }
    exports._ObjetFenetre = _ObjetFenetre;
  },
  fn: '_objetfenetre.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetreEspace = void 0;
    const _ObjetFenetre_1 = require('_ObjetFenetre');
    require('ObjetFenetre_Espace.css');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetStyle_1 = require('ObjetStyle');
    const Enumere_Event_1 = require('Enumere_Event');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetWAI_1 = require('ObjetWAI');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const GestionnaireModale_1 = require('GestionnaireModale');
    const tag_1 = require('tag');
    const ObjetChaine_1 = require('ObjetChaine');
    const uCoordonneesBackup = {};
    class ObjetFenetreEspace extends _ObjetFenetre_1._ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.Titre = '';
        this._initialiserOptionsFenetre();
        this.resetCoordonnees();
        if (this.Nom) {
          this.ajouterEvenementGlobal(
            Enumere_Event_1.EEvent.SurPreResize,
            this._preResizePositionnement,
          );
          this.ajouterEvenementGlobal(
            Enumere_Event_1.EEvent.SurPostResize,
            this._postResizePositionnement,
          );
        }
        Invocateur_1.Invocateur.abonner(
          `${GNavigateur.getEventInvocateur('pointerdown')}.capture ${GNavigateur.getEventInvocateur('keydown')}.capture`,
          (aEvent) => {
            if (
              this.optionsFenetre.fermerFenetreSurClicHorsFenetre &&
              this.EnAffichage &&
              aEvent.target &&
              !aEvent.target.closest(`#${this.Nom.escapeJQ()}`) &&
              !GestionnaireModale_1.GestionnaireModale.estJElementBloque(
                $('#' + this.Nom.escapeJQ()),
              )
            ) {
              this.fermer();
            }
          },
        );
        Object.assign(this.optionsInterne, {
          closeStart: () => {
            GestionnaireModale_1.GestionnaireModale.abonnementBlocageInterface(
              false,
              this.Nom,
            );
            if (this._interfaceEstBloquee) {
              GestionnaireModale_1.GestionnaireModale.bloquerInterface({
                bloquer: false,
                guidBlocage: this._guidBlocage,
              });
              delete this._interfaceEstBloquee;
            }
            GestionnaireModale_1.GestionnaireModale.abonnementPremierPlan(
              false,
              this.Nom,
            );
          },
          closeEnd: () => {
            ObjetHtml_1.GHtml.setDisplay(this.Nom, false);
          },
        });
        this.getZIndex = function () {
          return 1100;
        };
      }
      detruireInstances() {
        if (!this.__surDestructionApresFermeture_) {
          this.fermer(false);
        }
      }
      setParametresGeneraux() {
        ObjetHtml_1.GHtml.setDisplay(this.Nom, false);
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getNodeFenetre: function () {
            aInstance._surCreationNodeFenetre(this.node);
          },
          getDragFenetre() {
            return aInstance._getDragFenetre(aInstance);
          },
          getTitre: function () {
            return aInstance.optionsFenetre.titre
              ? MethodesObjet_1.MethodesObjet.isFunction(
                  aInstance.optionsFenetre.titre,
                )
                ? aInstance.optionsFenetre.titre() || ''
                : aInstance.optionsFenetre.titre
              : aInstance.Titre || '';
          },
          btnCroixFermeture: {
            event: function () {
              aInstance.surValidation(
                aInstance.optionsFenetre.indiceCroixFermeture,
              );
            },
          },
          avecZoneBas: function () {
            return (
              !!aInstance.composeBas() ||
              (aInstance.optionsFenetre.listeBoutons &&
                aInstance.optionsFenetre.listeBoutons.length > 0)
            );
          },
          avecBoutons: function () {
            return (
              aInstance.optionsFenetre.listeBoutons &&
              aInstance.optionsFenetre.listeBoutons.length > 0
            );
          },
          htmlRepeatBoutons: function (aBoutonRepeat) {
            let lMargin = 4;
            if (
              aBoutonRepeat.element.theme ===
                Type_ThemeBouton_1.TypeThemeBouton.primaire &&
              aBoutonRepeat.indice > 0 &&
              aBoutonRepeat.tableau[aBoutonRepeat.indice - 1] &&
              aBoutonRepeat.tableau[aBoutonRepeat.indice - 1].theme !==
                Type_ThemeBouton_1.TypeThemeBouton.primaire
            ) {
              lMargin = 8;
            }
            return aInstance.construireBouton(aBoutonRepeat, lMargin);
          },
          getDragResize() {
            return aInstance._getDragResize(aInstance, this.node);
          },
        });
      }
      construireBouton(aBoutonRepeat, aMargin) {
        return [
          '<ie-bouton',
          ' id="',
          this._getIdBoutons(aBoutonRepeat.element.index),
          '"',
          ' ie-model="fenetreBtn(bouton)" class="',
          aBoutonRepeat.element.theme &&
          MethodesObjet_1.MethodesObjet.isString(aBoutonRepeat.element.theme)
            ? aBoutonRepeat.element.theme
            : '',
          '"',
          ' style="',
          this.optionsFenetre.listeBoutonsInvisibles[
            aBoutonRepeat.element.index
          ] === true
            ? 'display:none;'
            : '',
          'margin-left:',
          aMargin,
          'px;',
          '"',
          aBoutonRepeat.element.title
            ? ObjetHtml_1.GHtml.composeAttr(
                'title',
                aBoutonRepeat.element.title,
              )
            : '',
          '>',
          '</ie-bouton>',
        ].join('');
      }
      focusSurPremierElement() {
        if (ObjetHtml_1.GHtml.elementExiste(this.IdTitre)) {
          ObjetHtml_1.GHtml.setFocus(this.IdTitre);
        } else {
        }
      }
      construireStructureAffichageAutre() {
        const lHTML = [];
        if (
          this.optionsFenetre.identConservationCoordonnees &&
          uCoordonneesBackup[this.optionsFenetre.identConservationCoordonnees]
        ) {
          this.coordonnees =
            uCoordonneesBackup[
              this.optionsFenetre.identConservationCoordonnees
            ] ||
            this.coordonnees ||
            {};
        }
        if (this.optionsFenetre.avecRetaillage && this.existeCoordonnees()) {
          if (this.coordonnees.width > 0) {
            this.optionsFenetre.largeur = this.coordonnees.width;
          }
          if (this.coordonnees.height > 0) {
            this.optionsFenetre.hauteur = this.coordonnees.height;
          }
        }
        let LStyle =
          this.optionsFenetre.largeur > 0
            ? 'width: ' + this.optionsFenetre.largeur + 'px;'
            : '';
        LStyle +=
          this.optionsFenetre.hauteur > 0
            ? 'min-height: ' + this.optionsFenetre.hauteur + 'px;'
            : this.optionsFenetre.hauteur === 'auto'
              ? ''
              : ObjetStyle_1.GStyle.composeHeight(100, '%');
        LStyle += ObjetStyle_1.GStyle.composeCouleurFond(
          this.optionsFenetre.couleurFond,
        );
        lHTML.push(
          '<span class="sr-only" tabindex="0" onfocus="' +
            this.Nom +
            '.focusSurPremierElement();"></span>',
          '<div id="',
          this.NomFenetre,
          '"',
          ' ie-node="getNodeFenetre"',
          this.optionsFenetre.avecTitre
            ? ObjetWAI_1.GObjetWAI.composeAttribut({
                genre: ObjetWAI_1.EGenreAttribut.labelledby,
                valeur: this.IdTitre,
              })
            : '',
          this.optionsFenetre.avecAriaDescribedByContenu
            ? ` aria-describedby="${this.IdContenu}"`
            : '',
          ' class="ObjetFenetre_Espace ',
          this.optionsFenetre.cssFenetre || '',
          '" tabindex="-1" role="',
          this.optionsFenetre.roleWAI || 'dialog',
          '"',
          this.optionsFenetre.modale ? ` aria-modal="true"` : '',
          '>',
          '<div id="',
          this.idFenetreContenu,
          '" class="Fenetre_Cadre ombre-cadre" style="box-sizing:border-box; ',
          LStyle,
          '">',
        );
        const lHtmlBas = this.composeBas();
        const lHtmlBoutons = this.composeBoutons();
        if (this.optionsFenetre.avecTitre) {
          lHTML.push(
            '<div class="Fenetre_Titre NePasImprimer">',
            '<h1 id="',
            this.IdTitre,
            '" class="ZoneDeplacementFenetre" ie-html="getTitre" ie-draggable="getDragFenetre" tabindex="0">',
            '</h1>',
            '<div class="cta-conteneur" ie-display="optionsFenetre.avecCroixFermeture">',
            '<ie-btnimage class="btnImageIcon as-button icon_fermeture_widget " ie-model="btnCroixFermeture" title="',
            ObjetTraduction_1.GTraductions.getValeur('Fermer'),
            '"></ie-btnimage>',
            '</div>',
            '</div>',
          );
        }
        const lStyleContenuFenetre = [];
        if (this.optionsFenetre.hauteurMaxContenu > 0) {
          lStyleContenuFenetre.push(
            'max-height: ' + this.optionsFenetre.hauteurMaxContenu + 'px;',
          );
        }
        if (this.optionsFenetre.largeurMin > 0) {
          lStyleContenuFenetre.push(
            'min-width: ' + this.optionsFenetre.largeurMin + 'px;',
          );
        }
        if (this.optionsFenetre.hauteurMin > 0) {
          lStyleContenuFenetre.push(
            'min-height: ' + this.optionsFenetre.hauteurMin + 'px;',
          );
        }
        lHTML.push(
          '<div id="',
          this.Nom + '_Res" class="Fenetre_Espace',
          this.optionsFenetre.avecScroll ? ' Fenetre_Scroll' : '',
          this.optionsFenetre.sansPaddingLR ? ' SansPaddingLR' : '',
          '">',
          '<div id="',
          this.IdContenu,
          '" class="Fenetre_Contenu',
          this.optionsFenetre.avecScrollY_force ? ' overflow-y-scroll' : '',
          '"',
          ' style="',
          lStyleContenuFenetre.join(''),
          '"',
          '>',
          ObjetChaine_1.GChaine.simpleHtmlToSafeHtml(this.composeContenu()),
          '</div>',
          '</div>',
        );
        lHTML.push(
          '<div ie-display="avecZoneBas" class="NePasImprimer">',
          '<div class="zone-bas">',
          lHtmlBas !== ''
            ? '<div class="zone-bas-gauche Fenetre_Bas">' + lHtmlBas + '</div>'
            : '',
          lHtmlBoutons,
          '</div>',
          '</div>',
        );
        if (this.optionsFenetre.avecRetaillage) {
          lHTML.push(
            (0, tag_1.tag)('div', {
              class: 'fenetre-resize right',
              'ie-draggable': 'getDragResize',
            }),
            (0, tag_1.tag)('div', {
              class: 'fenetre-resize bottom',
              'ie-draggable': 'getDragResize',
            }),
            (0, tag_1.tag)('div', {
              class: 'fenetre-resize left',
              'ie-draggable': 'getDragResize',
            }),
            (0, tag_1.tag)('div', {
              class: 'fenetre-resize top',
              'ie-draggable': 'getDragResize',
            }),
            (0, tag_1.tag)('div', {
              class: 'fenetre-resize coin Image_Retailler',
              'ie-draggable': 'getDragResize',
            }),
          );
        }
        lHTML.push('</div>');
        lHTML.push(
          '</div>',
          '<span class="sr-only" tabindex="0" onfocus="' +
            this.Nom +
            '.focusSurPremierElement();"></span>',
        );
        return lHTML.join('');
      }
      composeBoutons() {
        const lHTML = [];
        lHTML.push(
          '<div ie-if="avecBoutons" class="btn-conteneur">',
          '<div ie-repeat="bouton in listeBoutons" ie-html="htmlRepeatBoutons(bouton)"></div>',
          '</div>',
        );
        return lHTML.join('');
      }
      existeCoordonnees() {
        return (
          this.optionsFenetre.conserverCoordonnees &&
          this.coordonnees !== null &&
          this.coordonnees !== undefined &&
          !!(this.coordonnees.left && this.coordonnees.top)
        );
      }
      resetCoordonnees() {
        this.coordonnees = Object.assign(this.coordonnees || {}, {
          left: null,
          top: null,
          width: null,
          height: null,
        });
      }
      setCoordonnees() {
        if (!this.optionsFenetre.conserverCoordonnees) {
          return;
        }
        Object.assign(this.coordonnees || {}, {
          left: ObjetPosition_1.GPosition.getLeft(this.Nom),
          top: ObjetPosition_1.GPosition.getTop(this.Nom),
          width: this.optionsFenetre.avecRetaillage
            ? this.optionsFenetre.largeur
            : null,
          height: this.optionsFenetre.avecRetaillage
            ? this.optionsFenetre.hauteur
            : null,
        });
        if (this.optionsFenetre.identConservationCoordonnees) {
          uCoordonneesBackup[this.optionsFenetre.identConservationCoordonnees] =
            this.coordonnees;
        }
        if (this.optionsFenetre.callbackDeplacer) {
          this.optionsFenetre.callbackDeplacer(this.coordonnees);
        }
      }
      positionnerFenetre(aParams) {
        const lParams = Object.assign(
          {
            left: null,
            top: null,
            id: '',
            positionSurSouris: false,
            positionSurSourisSiAffiche: false,
            enAffichage: null,
            centrerParDefaut: true,
          },
          aParams,
        );
        if (ObjetStyle_1.GStyle.styleSheetDisabled()) {
          return;
        }
        let lEnAffichage = this.EnAffichage;
        if (lParams.enAffichage === false || lParams.enAffichage === true) {
          lEnAffichage = lParams.enAffichage;
        }
        if (this.existeCoordonnees() && ObjetPosition_1.GPosition.placer) {
          ObjetPosition_1.GPosition.placer(
            this.Nom,
            this.coordonnees.left,
            this.coordonnees.top,
          );
        } else if (
          MethodesObjet_1.MethodesObjet.isNumber(lParams.top) &&
          MethodesObjet_1.MethodesObjet.isNumber(lParams.left) &&
          ObjetPosition_1.GPosition.placer
        ) {
          ObjetPosition_1.GPosition.placer(this.Nom, lParams.left, lParams.top);
        } else if (this.optionsFenetre.idPositionnement || lParams.id) {
          ObjetPosition_1.GPosition.placerFiche(
            this.Nom,
            this.optionsFenetre.idPositionnement || lParams.id,
            lEnAffichage,
          );
        } else if (
          this.optionsFenetre.positionSurSouris ||
          lParams.positionSurSouris
        ) {
          if (!lEnAffichage || lParams.positionSurSourisSiAffiche) {
            ObjetPosition_1.GPosition.placer(
              this.Nom,
              GNavigateur.pointerX,
              GNavigateur.pointerY,
            );
          }
        } else if (lParams.centrerParDefaut) {
          ObjetPosition_1.GPosition.centrer(this.Nom);
        }
        return this;
      }
      async afficher(aHtml) {
        const lEnAffichage = this.EnAffichage;
        if (!lEnAffichage) {
          this._focusPrecedent = null;
          if (!ObjetHtml_1.GHtml.elementExiste(this.Nom)) {
            return;
          }
          if (
            !this.optionsFenetre.bloquerFocus &&
            this.optionsFenetre.restaurerFocusSurFermeture
          ) {
            this._focusPrecedent = document.activeElement;
          }
          if (this.optionsFenetre.modale) {
            this._guidBlocage =
              GestionnaireModale_1.GestionnaireModale.bloquerInterface({
                bloquer: true,
                prioriteBlocage: this.optionsFenetre.prioriteBlocageAbonnement,
                opaciteVoile: this.optionsFenetre.opaciteVoileModale,
              });
            this._interfaceEstBloquee = true;
          }
          if (
            this.optionsFenetre.avecAbonnementPremierPlan ||
            this.optionsFenetre.modale
          ) {
            GestionnaireModale_1.GestionnaireModale.abonnementPremierPlan(
              true,
              this.Nom,
            );
            GestionnaireModale_1.GestionnaireModale.enPremierPlan(this.Nom);
          }
          if (this.optionsFenetre.avecAbonnementBlocage) {
            GestionnaireModale_1.GestionnaireModale.abonnementBlocageInterface(
              true,
              this.Nom,
              this.optionsFenetre.prioriteBlocageAbonnement,
            );
          }
          ObjetHtml_1.GHtml.setDisplay(this.Nom, true);
          Invocateur_1.Invocateur.evenement('surAffichageFenetre');
          this.EnAffichage = true;
          this.controleur.$refreshSelf(true);
          this.EnAffichage = false;
          if (aHtml) {
            ObjetHtml_1.GHtml.setHtml(this.IdContenu, aHtml, {
              controleur: this.controleur,
            });
          }
          if (this.optionsFenetre.positionnerFenetreSurAfficher) {
            this._creerResizeObserver();
            this.positionnerFenetre();
          }
          this.EnAffichage = true;
          this.surFixerTaille();
          if (this.surAfficher) {
            this.surAfficher();
          }
          this.$refreshSelf();
          this.promise = new Promise((aResolve) => {
            this._promiseResolve = aResolve;
          });
        }
        try {
          if (!this.optionsFenetre.bloquerFocus) {
            this.focusSurPremierElement();
          }
        } catch (e) {}
        return this.promise;
      }
      actualiser() {
        this.surFixerTaille();
        ObjetHtml_1.GHtml.setHtml(this.IdContenu, this.composeContenu(), {
          controleur: this.controleur,
        });
      }
      setBoutonLibelle(I, aLibelle) {
        if (
          MethodesObjet_1.MethodesObjet.isObject(
            this.optionsFenetre.listeBoutons[I],
          )
        ) {
          this.optionsFenetre.listeBoutons[I].libelle = aLibelle;
        } else {
          this.optionsFenetre.listeBoutons[I] = aLibelle;
        }
        this._structureBoutons = null;
        this.$refreshSelf();
      }
      positionnerSousId(aId) {
        if (ObjetHtml_1.GHtml.elementExiste(aId)) {
          ObjetPosition_1.GPosition.placer(
            this.Nom,
            ObjetPosition_1.GPosition.getLeft(aId) + 5,
            ObjetPosition_1.GPosition.getTop(aId) +
              ObjetPosition_1.GPosition.getHeight(aId) +
              7,
          );
          this.setCoordonnees();
        }
      }
      surFixerTaille() {
        if (
          !this.optionsFenetre.avecRetaillage &&
          $('#' + this.NomFenetre.escapeJQ()).width() <
            $('#' + this.idFenetreContenu.escapeJQ()).outerWidth()
        ) {
          $('#' + this.NomFenetre.escapeJQ()).css(
            'min-width',
            $('#' + this.idFenetreContenu.escapeJQ()).width() + 'px',
          );
        }
      }
      debutRetaillage() {
        this.surFixerTaille();
        $('#' + this.idFenetreContenu.escapeJQ()).css({
          'min-height':
            ObjetPosition_1.GPosition.getHeight(this.idFenetreContenu) + 'px',
          width:
            ObjetPosition_1.GPosition.getWidth(this.idFenetreContenu) + 'px',
        });
      }
      finRetaillage() {
        this.surFixerTaille();
        this.setCoordonnees();
      }
      getHeightMaxIdSelonEcran(aId) {
        return (
          GNavigateur.ecranH -
          ($('#' + this.Nom.escapeJQ()).outerHeight() -
            $('#' + aId.escapeJQ()).height()) -
          10
        );
      }
      avecEventResizeNavigateur() {
        return false;
      }
      _initialiserOptionsFenetre() {
        this.setOptionsFenetre({
          modale: true,
          avecTitre: true,
          titre: '',
          largeur: 100,
          hauteur: 100,
          hauteurMaxContenu: 0,
          avecScroll: false,
          avecScrollY_force: false,
          marge: 12,
          avecTailleSelonContenu: false,
          avecPaddingContenu: true,
          avecCroixFermeture: true,
          indiceCroixFermeture: -1,
          cssFenetre:
            MethodesObjet_1.MethodesObjet.getObjectClass(this) + '_racine',
          avecRetaillage: false,
          largeurMin: 0,
          hauteurMin: 0,
          tailleBandeRetaillage: 3,
          callbackDeplacer: null,
          addParametresValidation: null,
          surValiderAvantFermer: null,
          callback: null,
          callbackFermer: null,
          callbackApresFermer: null,
          listeBoutons: [],
          listeBoutonsInvisibles: [],
          listeBoutonsInactifs: [],
          avecAbonnementBlocage: true,
          prioriteBlocageAbonnement:
            GestionnaireModale_1.GestionnaireModale.TypePrioriteBlocageInterface
              .standard,
          avecAbonnementPremierPlan: true,
          avecPositionnementResize: true,
          positionnerFenetreSurAfficher: true,
          idPositionnement: '',
          positionSurSouris: false,
          conserverCoordonnees: true,
          identConservationCoordonnees: '',
          avecAbonnementFermetureFenetreGenerale: true,
          bloquerFocus: false,
          restaurerFocusSurFermeture: true,
          fermerFenetreSurClicHorsFenetre: false,
          couleurFond: GCouleur.blanc,
          hauteurBandeau: GApplication.hauteurBandeau,
          couleurFondBandeau: GCouleur.fenetre.bandeau.fond,
          couleurTexteBandeau: GCouleur.fenetre.bandeau.texte,
          avecAriaDescribedByContenu: false,
        });
      }
      _surCreationNodeFenetre(aNode) {
        const lInstance = this;
        Invocateur_1.Invocateur.desabonner(
          Invocateur_1.ObjetInvocateur.events.fermerFenetres,
          this,
        );
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.fermerFenetres,
          (aForcer) => {
            if (
              aForcer ||
              this.optionsFenetre.avecAbonnementFermetureFenetreGenerale
            ) {
              this.fermer();
            }
          },
        );
        $(aNode).on({
          keyup() {
            if (GNavigateur.isToucheEchap && GNavigateur.isToucheEchap()) {
              lInstance.surValidation(
                lInstance.optionsFenetre.indiceCroixFermeture,
              );
            }
          },
          pointerdown() {
            GestionnaireModale_1.GestionnaireModale.enPremierPlan(
              lInstance.getNom(),
            );
          },
        });
      }
      _creerResizeObserver() {
        const lElement = ObjetHtml_1.GHtml.getElement(this.Nom);
        if (!lElement) {
          return;
        }
        let lPositionnerEnCours = false;
        let lObserver = new ResizeObserver((aObserveds) => {
          if (
            this.EnAffichage &&
            !lPositionnerEnCours &&
            aObserveds &&
            aObserveds[0] &&
            aObserveds[0].contentRect &&
            aObserveds[0].contentRect.height > 0
          ) {
            lPositionnerEnCours = true;
            try {
              this.positionnerFenetre();
            } finally {
              lPositionnerEnCours = false;
            }
          }
        });
        lObserver.observe(lElement);
        const lDisconnect = function (aEvent) {
          if (lObserver) {
            lObserver.disconnect();
            lObserver = null;
          }
          lElement.removeEventListener(aEvent.type, lDisconnect, true);
        };
        lElement.addEventListener('pointerdown', lDisconnect, true);
      }
      _preResizePositionnement() {
        if (
          !this.optionsFenetre.avecPositionnementResize ||
          !this.estAffiche()
        ) {
          return;
        }
        this._tempResize = {
          left: ObjetPosition_1.GPosition.getLeft(this.Nom),
          top: ObjetPosition_1.GPosition.getTop(this.Nom),
        };
        ObjetHtml_1.GHtml.setDisplay(this.Nom, false);
      }
      _postResizePositionnement() {
        if (
          !this.optionsFenetre.avecPositionnementResize ||
          !this.estAffiche() ||
          !this._tempResize
        ) {
          return;
        }
        ObjetPosition_1.GPosition.placer(this.Nom, 0, 0);
        ObjetHtml_1.GHtml.setDisplay(this.Nom, true);
        ObjetPosition_1.GPosition.placer(
          this.Nom,
          this._tempResize.left,
          this._tempResize.top,
        );
        this.setCoordonnees();
        delete this._tempResize;
      }
      _getDragFenetre(aInstance) {
        return {
          start(aParamsDrag) {
            const lJFenetre = $(`#${aInstance.Nom.escapeJQ()}`);
            aParamsDrag.rectFenetreStart =
              ObjetPosition_1.GPosition.getClientRect(lJFenetre.get(0));
            lJFenetre.addClass('on-drag');
            aInstance._fenetreEnDeplacement = true;
          },
          drag(aParamsDrag) {
            const lJFenetre = $(`#${aInstance.Nom.escapeJQ()}`);
            const lRect = ObjetPosition_1.GPosition.getClientRect(
              lJFenetre.get(0),
            );
            let lTop = Math.max(
              aParamsDrag.rectContrainte.top,
              aParamsDrag.rectFenetreStart.top + aParamsDrag.offset.y,
            );
            let lLeft = Math.max(
              aParamsDrag.rectContrainte.left,
              aParamsDrag.rectFenetreStart.left + aParamsDrag.offset.x,
            );
            lLeft = Math.min(
              lLeft,
              aParamsDrag.rectContrainte.left +
                aParamsDrag.rectContrainte.width -
                lRect.width,
            );
            lTop = Math.min(
              lTop,
              aParamsDrag.rectContrainte.top +
                aParamsDrag.rectContrainte.height -
                lRect.height,
            );
            lJFenetre.css({ left: lLeft, top: lTop });
          },
          stop() {
            $(`#${aInstance.Nom.escapeJQ()}`).removeClass('on-drag');
            aInstance.setCoordonnees();
            aInstance.focusSurPremierElement();
            setTimeout(() => {
              delete aInstance._fenetreEnDeplacement;
            }, 0);
          },
        };
      }
      _getDragResize(aInstance, aNode) {
        let lCoin = {
          gauche: aNode.classList.contains('left'),
          droit:
            aNode.classList.contains('right') ||
            aNode.classList.contains('coin'),
          haut: aNode.classList.contains('top'),
          bas:
            aNode.classList.contains('bottom') ||
            aNode.classList.contains('coin'),
        };
        return {
          start(aParamsDrag) {
            const lClassCurseur =
              lCoin.bas && lCoin.droit
                ? 'AvecResize'
                : lCoin.droit || lCoin.gauche
                  ? 'AvecResizeHorizontal'
                  : 'AvecResizeVertical';
            aParamsDrag.divBloquant = ObjetHtml_1.GHtml.htmlToDOM(
              `<div class="overlay-resize ${lClassCurseur}"></div>`,
            );
            ObjetHtml_1.GHtml.insererElementDOM(
              ObjetHtml_1.GHtml.getElement(aInstance.NomFenetre),
              aParamsDrag.divBloquant,
            );
            Object.assign(aParamsDrag, {
              OriginX: aParamsDrag.posStart.x,
              OriginY: aParamsDrag.posStart.y,
              OriginLargeur: ObjetPosition_1.GPosition.getWidth(
                aInstance.idFenetreContenu,
              ),
              OriginHauteur: ObjetPosition_1.GPosition.getHeight(
                aInstance.idFenetreContenu,
              ),
              Originleft: ObjetPosition_1.GPosition.getLeft(aInstance.Nom),
              OriginTop: ObjetPosition_1.GPosition.getTop(aInstance.Nom),
            });
            $(`#${aInstance.Nom.escapeJQ()}`).addClass('on-drag');
            aInstance.debutRetaillage();
          },
          drag(aParamsDrag) {
            const lJContenu = $('#' + aInstance.idFenetreContenu.escapeJQ());
            let lDeplacementX;
            let lDeplacementY;
            if (lCoin.droit) {
              lDeplacementX = Math.borner(
                aParamsDrag.pos.x - aParamsDrag.OriginX,
                aInstance.optionsFenetre.largeurMin - aParamsDrag.OriginLargeur,
                GNavigateur.ecranL -
                  13 -
                  aParamsDrag.OriginLargeur -
                  ObjetPosition_1.GPosition.getLeft(aInstance.idFenetreContenu),
              );
              aInstance.optionsFenetre.largeur =
                aParamsDrag.OriginLargeur + lDeplacementX;
              lJContenu.css({
                width: aParamsDrag.OriginLargeur + lDeplacementX + 'px',
              });
            }
            if (lCoin.gauche) {
              lDeplacementX = Math.borner(
                aParamsDrag.pos.x - aParamsDrag.OriginX,
                -aParamsDrag.Originleft,
                aParamsDrag.OriginLargeur - aInstance.optionsFenetre.largeurMin,
              );
              aInstance.optionsFenetre.largeur =
                aParamsDrag.OriginLargeur - lDeplacementX;
              lJContenu.css({
                width: aParamsDrag.OriginLargeur - lDeplacementX + 'px',
              });
              aInstance.coordonnees.left =
                aParamsDrag.Originleft + lDeplacementX;
              ObjetPosition_1.GPosition.setLeft(
                aInstance.Nom,
                aInstance.coordonnees.left,
              );
            }
            if (lCoin.bas) {
              lDeplacementY = Math.borner(
                aParamsDrag.pos.y - aParamsDrag.OriginY,
                aInstance.optionsFenetre.hauteurMin - aParamsDrag.OriginHauteur,
                GNavigateur.ecranH -
                  13 -
                  aParamsDrag.OriginHauteur -
                  ObjetPosition_1.GPosition.getTop(aInstance.idFenetreContenu),
              );
              aInstance.optionsFenetre.hauteur =
                aParamsDrag.OriginHauteur + lDeplacementY;
              lJContenu.css({
                'min-height': aParamsDrag.OriginHauteur + lDeplacementY + 'px',
              });
            }
            if (lCoin.haut) {
              lDeplacementY = Math.borner(
                aParamsDrag.pos.y - aParamsDrag.OriginY,
                -aParamsDrag.OriginTop,
                aParamsDrag.OriginHauteur - aInstance.optionsFenetre.hauteurMin,
              );
              aInstance.optionsFenetre.hauteur =
                aParamsDrag.OriginHauteur - lDeplacementY;
              lJContenu.css({
                'min-height': aParamsDrag.OriginHauteur - lDeplacementY + 'px',
              });
              aInstance.coordonnees.top = aParamsDrag.OriginTop + lDeplacementY;
              ObjetPosition_1.GPosition.setTop(
                aInstance.Nom,
                aInstance.coordonnees.top,
              );
            }
          },
          stop(aParamsDrag) {
            if (aParamsDrag.divBloquant) {
              ObjetHtml_1.GHtml.supprimerElementDOM(aParamsDrag.divBloquant);
            }
            $(`#${aInstance.Nom.escapeJQ()}`).removeClass('on-drag');
            aInstance.finRetaillage();
          },
        };
      }
    }
    exports.ObjetFenetreEspace = ObjetFenetreEspace;
  },
  fn: 'objetfenetre_espace.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre = void 0;
    const _ObjetFenetre_1 = require('_ObjetFenetre');
    class ObjetFenetre extends _ObjetFenetre_1._ObjetFenetre {}
    exports.ObjetFenetre = ObjetFenetre;
    if (IE.estMobile) {
      const { ObjetFenetreMobile } = require('ObjetFenetre_Mobile.js');
      exports.ObjetFenetre = ObjetFenetre = ObjetFenetreMobile;
    } else {
      const { ObjetFenetreEspace } = require('ObjetFenetre_Espace.js');
      exports.ObjetFenetre = ObjetFenetre = ObjetFenetreEspace;
    }
  },
  fn: 'objetfenetre.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetMessage = void 0;
    require('ObjetMessage.css');
    const ObjetChaine_1 = require('ObjetChaine');
    const Enumere_Action_1 = require('Enumere_Action');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const MethodesObjet_1 = require('MethodesObjet');
    const Invocateur_1 = require('Invocateur');
    const GestionnaireModale_1 = require('GestionnaireModale');
    const ObjetJSON_1 = require('ObjetJSON');
    class ObjetMessage {
      constructor() {
        this.EnAffichage = false;
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.erreurCommunication,
          () => {
            this.fermer(Enumere_Action_1.EGenreAction.Annuler);
          },
        );
      }
      async afficher(aParametres) {
        if (this.EnAffichage) {
          if (!this._pileMessage) {
            this._pileMessage = [];
          }
          this._pileMessage.push(aParametres);
          IE.log.addLog(
            'ObjetMessage.afficher : un message est deja visible, le nouveau message est empilé : ' +
              aParametres.message,
            null,
            IE.log.genre.Avertissement,
          );
          return new Promise((aResolve) => {
            aParametres.resolvePromise = aResolve;
          });
        }
        this.Accepte = Enumere_Action_1.EGenreAction.Valider;
        this.EnAffichage = true;
        return new Promise((aResolve) => {
          const lParametres = $.extend(
            {
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
              titre: '',
              message: '',
              callback: null,
              controleur: null,
              delaiFermeture: null,
              avecDecalageFocusBouton: false,
              idRessource: null,
              width: 360,
              getDisabledBouton: null,
              demanderConfirmation: true,
              restaurerFocusSurFermeture: true,
              listeBoutons: null,
              resolvePromise: aResolve,
            },
            aParametres,
          );
          if (
            lParametres.type ===
              Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation &&
            lParametres.demanderConfirmation === false
          ) {
            this.Accepte = Enumere_Action_1.EGenreAction.Valider;
            this.EnAffichage = false;
            this._fermer(lParametres);
            return;
          }
          if (lParametres.idRessource) {
            const lChaine = ObjetTraduction_1.GTraductions.getValeur(
              lParametres.idRessource,
            );
            if (lChaine !== '') {
              const lJson = ObjetJSON_1.ObjetJSON.parse(lChaine);
              if (
                lJson &&
                lJson.titre &&
                lJson.html &&
                lJson.type >= 0 &&
                lJson.boutons
              ) {
                lParametres.type = this._typeEditeurToBoiteMessage(lJson.type);
                lParametres.titre = lJson.titre;
                lParametres.message = IE.jsx.str(
                  'div',
                  {
                    class: 'mr-fiche',
                    style:
                      'width:' +
                      lJson.width +
                      'px;min-height:' +
                      lJson.height +
                      'px;',
                  },
                  lJson.html,
                );
              } else {
              }
            } else {
            }
          }
          const lDetailsMessage = this._construireMessage(lParametres);
          this.fenetre = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
            ObjetFenetreInterneMessage,
            {
              pere: this,
              initialiser: (aInstance) => {
                if (lParametres.controleur) {
                  $.extend(true, aInstance.controleur, lParametres.controleur);
                }
                aInstance.genreActionFenetre =
                  Enumere_Action_1.EGenreAction.Annuler;
                aInstance.setOptionsFenetre({
                  modale: true,
                  roleWAI: 'alertdialog',
                  prioriteBlocageAbonnement:
                    GestionnaireModale_1.GestionnaireModale
                      .TypePrioriteBlocageInterface.message,
                  cssFenetre: 'ObjetMessage ObjetMessage_' + lParametres.type,
                  avecPositionnementResize: false,
                  avecCroixFermeture: false,
                  titre: lDetailsMessage.titre,
                  listeBoutons: lDetailsMessage.listeBoutons,
                  avecTailleSelonContenu: true,
                  restaurerFocusSurFermeture:
                    lParametres.restaurerFocusSurFermeture,
                  empilerFenetre: false,
                  avecAriaDescribedByContenu: true,
                  surValiderAvantFermer: (aParams) => {
                    if (
                      aParams.bouton &&
                      aParams.bouton.genreAction !== undefined
                    ) {
                      aInstance.genreActionFenetre = aParams.bouton.genreAction;
                    }
                  },
                  callbackApresFermer: () => {
                    clearTimeout(this._timeoutFermeture);
                    this.EnAffichage = false;
                    delete this.fenetre;
                    this.Accepte = aInstance.genreActionFenetre;
                    this._fermer(lParametres);
                  },
                });
              },
            },
          );
          if (
            MethodesObjet_1.MethodesObjet.isFunction(
              lParametres.getDisabledBouton,
            )
          ) {
            this.fenetre.controleur.fenetreBtn.getDisabled = function (
              aBoutonRepeat,
            ) {
              return lParametres.getDisabledBouton(aBoutonRepeat.element);
            };
          }
          this.fenetre.controleur._getClassContenuMessage = function () {
            if (this.node.scrollHeight > this.node.clientHeight) {
              return 'contenu-scroll';
            }
            return '';
          };
          this.fenetre.afficher(lDetailsMessage.html.join(''));
          this.fenetre.setBoutonFocus(0, lParametres.avecDecalageFocusBouton);
          if (lParametres.delaiFermeture) {
            const lDelai =
              lParametres.delaiFermeture === true
                ? 30 * 1000
                : lParametres.delaiFermeture;
            this._timeoutFermeture = setTimeout(() => {
              if (this.fenetre) {
                this.fermer(Enumere_Action_1.EGenreAction.Valider);
              }
            }, lDelai);
          }
        }).catch((aArg) => {
          throw aArg;
        });
      }
      fermer(aGenreAction) {
        if (this.fenetre) {
          if (aGenreAction !== null && aGenreAction !== undefined) {
            this.fenetre.genreActionFenetre = aGenreAction;
          }
          this.fenetre.fermer();
        }
      }
      _construireMessage(aParametres) {
        const lResult = { titre: '', listeBoutons: [], html: [] };
        if (aParametres.titre && !aParametres.message) {
          aParametres.message = aParametres.titre;
          aParametres.titre = '';
        }
        if (aParametres.titre) {
          lResult.titre = aParametres.titre + '';
        } else {
          switch (aParametres.type) {
            case Enumere_BoiteMessage_1.EGenreBoiteMessage.Information:
            case Enumere_BoiteMessage_1.EGenreBoiteMessage.MrFiche:
              lResult.titre = ObjetTraduction_1.GTraductions.getValeur(
                'genreBoiteMessage.Information',
              );
              break;
            case Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation:
              lResult.titre = ObjetTraduction_1.GTraductions.getValeur(
                'genreBoiteMessage.Confirmation',
              );
              break;
            default:
          }
        }
        lResult.titre = IE.jsx.str(
          IE.jsx.fragment,
          null,
          IE.jsx.str('i', { class: 'om_iconeTitre', 'aria-hidden': 'true' }),
          lResult.titre,
        );
        const lWidth = aParametres.width || 360;
        lResult.html.push(
          aParametres.idRessource
            ? aParametres.message
            : IE.estMobile
              ? ObjetChaine_1.GChaine.replaceRCToHTML(aParametres.message + '')
              : IE.jsx.str(
                  'p',
                  {
                    style: 'width:' + lWidth + 'px;',
                    class: 'contenu',
                    'ie-class': '_getClassContenuMessage',
                  },
                  ObjetChaine_1.GChaine.replaceRCToHTML(
                    aParametres.message + '',
                  ),
                ),
        );
        if (aParametres.listeBoutons) {
          lResult.listeBoutons = aParametres.listeBoutons;
          lResult.listeBoutons.forEach((aBouton) => {
            switch (aBouton.theme) {
              case Type_ThemeBouton_1.TypeThemeBouton.neutre:
                break;
              case Type_ThemeBouton_1.TypeThemeBouton.primaire:
                aBouton.theme = Type_ThemeBouton_1.TypeThemeBouton.primaire;
                break;
              default:
                aBouton.theme = Type_ThemeBouton_1.TypeThemeBouton.secondaire;
                break;
            }
          });
        } else {
          switch (aParametres.type) {
            case Enumere_BoiteMessage_1.EGenreBoiteMessage.Information:
            case Enumere_BoiteMessage_1.EGenreBoiteMessage.MrFiche:
              lResult.listeBoutons.push({
                libelle:
                  ObjetTraduction_1.GTraductions.getValeur('principal.fermer'),
                genreAction: Enumere_Action_1.EGenreAction.Valider,
                theme: Type_ThemeBouton_1.TypeThemeBouton.secondaire,
                typeMessage: aParametres.type,
              });
              break;
            case Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation:
              lResult.listeBoutons.push(
                {
                  libelle:
                    ObjetTraduction_1.GTraductions.getValeur('principal.oui'),
                  genreAction: Enumere_Action_1.EGenreAction.Valider,
                  theme: Type_ThemeBouton_1.TypeThemeBouton.primaire,
                  typeMessage: aParametres.type,
                },
                {
                  libelle:
                    ObjetTraduction_1.GTraductions.getValeur('principal.non'),
                  genreAction: Enumere_Action_1.EGenreAction.NePasValider,
                  theme: Type_ThemeBouton_1.TypeThemeBouton.secondaire,
                  typeMessage: aParametres.type,
                },
              );
              break;
            default:
          }
        }
        return lResult;
      }
      _fermer(aParametres) {
        if (aParametres.callback) {
          if (
            'appel' in aParametres.callback &&
            MethodesObjet_1.MethodesObjet.isFunction(aParametres.callback.appel)
          ) {
            aParametres.callback.appel(this.Accepte);
          } else {
            aParametres.callback(this.Accepte);
          }
        }
        aParametres.resolvePromise(this.Accepte);
        if (this._pileMessage && this._pileMessage.length > 0) {
          if (window.GApplication && GApplication.SESSION_FINI) {
            return;
          }
          const lParametres = this._pileMessage.pop();
          if (this._pileMessage.length === 0) {
            delete this._pileMessage;
          }
          setTimeout(() => {
            this.afficher(lParametres);
          }, 200);
        }
      }
      _typeEditeurToBoiteMessage(aGenreEditeur) {
        switch (aGenreEditeur) {
          case 2:
            return Enumere_BoiteMessage_1.EGenreBoiteMessage.Information;
          case 4:
            return Enumere_BoiteMessage_1.EGenreBoiteMessage.MrFiche;
          case 3:
            return Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation;
          default:
            return Enumere_BoiteMessage_1.EGenreBoiteMessage.Information;
        }
      }
    }
    exports.ObjetMessage = ObjetMessage;
    class ObjetFenetreInterneMessage extends ObjetFenetre_1.ObjetFenetre {}
  },
  fn: 'objetmessage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetApplication = void 0;
    require('NamespaceIE.js');
    require('DeclarationExtensionsObjetNatif.js');
    require('Divers.js');
    require('IELog');
    require('jsx');
    require('IEHtmlComposants.js');
    require('DeclarationIndexFont.js');
    const DeferLoadingScript_1 = require('DeferLoadingScript');
    const ObjetMessageInformatif_1 = require('ObjetMessageInformatif');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetMessage_1 = require('ObjetMessage');
    Promise.resolve().then(() => require('pep.min.js'));
    global.GApplication = null;
    let uEstDebug = false;
    class ObjetApplication {
      constructor() {
        this.nomProduit = 'INDEX';
        this.hauteurBandeau = 22;
        this.estAppliMobile = false;
        this._objetMessage = null;
        this.mapObject = new Map();
        this.init();
        IEZoneFenetre_1.ZoneFenetre.idConteneurApp = this.getIdConteneur();
        this.messageInformatif =
          new ObjetMessageInformatif_1.ObjetMessageInformatif();
        if (!window.PointerEvent) {
          DeferLoadingScript_1.deferLoadingScript.loadAsync('pep_poly');
        }
      }
      init() {}
      getObject(aKey) {
        return this.mapObject.get(aKey);
      }
      setObject(aKey, aObject) {
        if (aObject === null) {
          return this.mapObject.delete(aKey);
        }
        const lResult = this.mapObject.has(aKey);
        this.mapObject.set(aKey, aObject);
        return lResult;
      }
      getNom() {
        return 'GApplication';
      }
      getIdConteneur() {
        return 'div';
      }
      getDemo() {
        return false;
      }
      getDateDemo() {
        return new Date();
      }
      getMessage() {
        if (!this._objetMessage) {
          this._objetMessage = new ObjetMessage_1.ObjetMessage();
        }
        return this._objetMessage;
      }
      estDebug() {
        return uEstDebug;
      }
      getModeExclusif() {
        return false;
      }
    }
    exports.ObjetApplication = ObjetApplication;
  },
  fn: 'objetapplication.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteConsultation =
      exports.ObjetRequeteSaisie =
      exports.ObjetRequeteJSON =
      exports.utils =
      exports.EGenreReponseSaisie =
      exports.c_constantesJSON =
        void 0;
    require('Divers');
    const Callback_1 = require('Callback');
    const Invocateur_1 = require('Invocateur');
    const ObjetTraduction_1 = require('ObjetTraduction');
    var c_constantesJSON;
    (function (c_constantesJSON) {
      c_constantesJSON['noeudJSON'] = 'D';
      c_constantesJSON['Signature'] = 'Signature';
      c_constantesJSON['SignatureAttente'] = '_SignatureAttente_';
      c_constantesJSON['Donnees'] = 'data';
    })(c_constantesJSON || (exports.c_constantesJSON = c_constantesJSON = {}));
    var EGenreReponseSaisie;
    (function (EGenreReponseSaisie) {
      EGenreReponseSaisie['erreur'] = 'reponseSaisie_erreur';
      EGenreReponseSaisie['annulation'] = 'reponseSaisie_annulation';
      EGenreReponseSaisie['succes'] = 'reponseSaisie_succes';
    })(
      EGenreReponseSaisie ||
        (exports.EGenreReponseSaisie = EGenreReponseSaisie = {}),
    );
    const utils = {
      getIdentNotification(aIdent) {
        return 'notificationsRequete_' + aIdent;
      },
    };
    exports.utils = utils;
    Invocateur_1.Invocateur.abonner(
      'deserialisation_notificationsPolling',
      (aJSONRacine) => {
        const lJSON = aJSONRacine[c_constantesJSON.Signature];
        if (lJSON) {
          if (lJSON.ModeExclusif !== undefined) {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.modificationModeExclusif,
              lJSON.ModeExclusif,
            );
          }
          if (ObjetRequeteJSON.modules.deserialiserPolling) {
            ObjetRequeteJSON.modules.deserialiserPolling(lJSON, aJSONRacine);
          }
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.refreshIEHtml,
          );
        }
      },
    );
    class ObjetRequeteJSON {
      constructor(aPere, aEvenementSurReussite, aEvenementSurEchec) {
        this.communication = GApplication.getCommunication();
        this.setOptions(null);
        const lSelf = this;
        const lPere = aPere;
        this.callbackReussite = new Callback_1.Callback(
          lPere || {},
          (...aParams) => {
            if (lPere && lPere.isDestroyed && lPere.isDestroyed()) {
              IE.log.addLog('callbackReussite avec un pere detruit');
              return;
            }
            const lResult = aEvenementSurReussite
                ? aEvenementSurReussite.apply(aPere, aParams)
                : null,
              lResultPromesse = lSelf._executionFonctionPromesse(
                lSelf.reussitePromesse,
                aParams,
              );
            lSelf._refreshHTML(!!aEvenementSurReussite);
            return aEvenementSurReussite ? lResult : lResultPromesse;
          },
        );
        if (!this.estUneSaisie) {
          this.callbackEchec = new Callback_1.Callback(
            lPere || {},
            (...aParams) => {
              if (lPere && lPere.isDestroyed && lPere.isDestroyed()) {
                IE.log.addLog('callbackEchec avec un pere detruit');
                return;
              }
              const lResult = aEvenementSurEchec
                  ? aEvenementSurEchec.apply(aPere, aParams)
                  : null,
                lResultPromesse = lSelf._executionFonctionPromesse(
                  lSelf.echecPromesse,
                  aParams,
                );
              lSelf._refreshHTML(!!aEvenementSurReussite);
              return aEvenementSurEchec ? lResult : lResultPromesse;
            },
          );
        }
        this.reussitePromesse = null;
        this.echecPromesse = null;
        this._jsonRacineParametres = {};
        this.JSON = {};
        if (ObjetRequeteJSON.modules.modifierRechercheSignature) {
          this.modifierRechercheSignature =
            ObjetRequeteJSON.modules.modifierRechercheSignature;
        }
        if (ObjetRequeteJSON.modules.initialiser) {
          const lFunc = (aJSONSignature) => {
            this._jsonRacineParametres[c_constantesJSON.Signature] =
              aJSONSignature;
          };
          ObjetRequeteJSON.modules.initialiser(lFunc);
        }
        if (ObjetRequeteJSON.modules.factoryModuleUploadCloud) {
          this.moduleUploadCloud =
            ObjetRequeteJSON.modules.factoryModuleUploadCloud();
        }
      }
      static declarerModules(aModules) {
        Object.assign(ObjetRequeteJSON.modules, aModules);
      }
      setOptions(aOptions) {
        if (!this.options) {
          this.options = {
            avecRefreshHTML: true,
            avecControleModeExclusif: false,
            messageDetail: '',
            gererMessageErreur: null,
            sansBlocageInterface: false,
            titreEchecModeExclusif: ObjetTraduction_1.GTraductions.getValeur(
              'ModeExclusif.UsageExclusif',
            ),
            messageEchecModeExclusif: ObjetTraduction_1.GTraductions.getValeur(
              'ModeExclusif.SaisieImpossibleConsultation',
            ),
          };
        }
        Object.assign(this.options, aOptions);
        return this;
      }
      _reponseRequete(aJSONRacine, aErreurCommunication) {
        this._jsonRacine = aJSONRacine || {};
        this.JSONReponse = {};
        this.JSONSignature = {};
        if (aErreurCommunication) {
          this.JSONReponse.erreurCommunication = aErreurCommunication;
        }
        if (this._jsonRacine[c_constantesJSON.Donnees]) {
          this.JSONReponse = this._jsonRacine[c_constantesJSON.Donnees];
        }
        if (this._jsonRacine[c_constantesJSON.Signature]) {
          this.JSONSignature = this._jsonRacine[c_constantesJSON.Signature];
        }
        this.traiterReponseRequete(aErreurCommunication);
        this.apresReponseRequete();
      }
      traiterReponseRequete(aErreurCommunication) {}
      apresReponseRequete() {}
      serialiserJSON() {
        if (this._jsonRacineParametres) {
          if (this.JSON && !$.isEmptyObject(this.JSON)) {
            this._jsonRacineParametres[c_constantesJSON.Donnees] = this.JSON;
          }
        }
      }
      async appelAsynchrone() {
        if (
          this.options.avecControleModeExclusif &&
          GApplication.getModeExclusif()
        ) {
          const lPromiseMessage = GApplication.getMessage().afficher({
            titre: this.options.titreEchecModeExclusif,
            message: this.options.messageEchecModeExclusif,
          });
          return Promise.reject({
            modeExclusif: true,
            promiseMessage: lPromiseMessage,
          });
        }
        if (!this._jsonRacineParametres) {
          IE.log.addLog(
            "La requete n'a pas de json definit !",
            null,
            IE.log.genre.Avertissement,
          );
        }
        if (this.moduleUploadCloud && this.moduleUploadCloud.actif()) {
          return this.moduleUploadCloud.lancer().then(() => {
            return this._serialisationJSONEtEnvoieRequeteSaisie();
          });
        }
        return this._serialisationJSONEtEnvoieRequeteSaisie();
      }
      lancerRequete(...aParametres) {
        if (aParametres.length > 0) {
          Object.assign(this.JSON, aParametres[0]);
        }
        return this.appelAsynchrone();
      }
      addUpload(aParams) {
        this.paramsUpload = aParams;
        if (aParams && aParams.listeDJCloud) {
          if (this.moduleUploadCloud && this.moduleUploadCloud.setListePJs) {
            this.moduleUploadCloud.setListePJs(aParams.listeDJCloud);
          } else {
          }
        }
        return this;
      }
      deserialiserSignature() {
        if (ObjetRequeteJSON.modules.deserialiserSignature) {
          ObjetRequeteJSON.modules.deserialiserSignature(this.JSONSignature);
        }
      }
      _refreshHTML(aAvecEvenementSurReussite) {
        if (this.options.avecRefreshHTML) {
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.refreshIEHtml,
          );
          if (!aAvecEvenementSurReussite) {
            setTimeout(() => {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.refreshIEHtml,
              );
            }, 0);
          }
        }
      }
      _executionFonctionPromesse(aMethodes, aArguments) {
        let lResult;
        if (aMethodes) {
          if (aArguments.length === 0) {
            lResult = aMethodes();
          } else if (aArguments.length === 1) {
            lResult = aMethodes(aArguments[0]);
          } else {
            lResult = aMethodes(Array.prototype.slice.call(aArguments));
          }
        }
        return lResult;
      }
      _serialisationJSONEtEnvoieRequeteSaisie() {
        return new Promise((aResolve, aReject) => {
          this.reussitePromesse = aResolve;
          this.echecPromesse = aReject;
          this.serialiserJSON();
          const lParams = {
            nom: this.nom,
            json: this._jsonRacineParametres,
            callbackPere: this,
            callbackEvenement: this._reponseRequete,
            numeroRequete: undefined,
            messageDetail: this.options.messageDetail,
            requetePrioritaire: this.options.requetePrioritaire,
            sansBlocageInterface: !!this.options.sansBlocageInterface,
            estRequeteDeconnexion: this.options.estRequeteDeconnexion,
            paramsUpload: this.paramsUpload,
          };
          this.paramsUpload = null;
          this.communication.appelFonctionAsynchroneXML(lParams);
        });
      }
    }
    exports.ObjetRequeteJSON = ObjetRequeteJSON;
    ObjetRequeteJSON.modules = {};
    class ObjetRequeteSaisie extends ObjetRequeteJSON {
      constructor(...aParams) {
        super(...aParams);
        this.setOptions({
          avecControleModeExclusif: true,
          messageDetail: ObjetTraduction_1.GTraductions.getValeur(
            'requete.validationEnCours',
          ),
          titreEchecValidation: ObjetTraduction_1.GTraductions.getValeur(
            'requete.validationEchec',
          ),
          titreAnnulationValidation: '',
          afficherMessageErreur: true,
        });
      }
      actionApresRequete(aGenreReponse) {
        this.callbackReussite.appel({
          JSONRapportSaisie: this.JSONRapportSaisie,
          JSONReponse: this.JSONReponse,
          genreReponse: aGenreReponse,
          messageErreur: this.messageErreur,
          promiseMessage: this.promiseMessage,
        });
      }
      traiterReponseRequete(aErreurCommunication) {
        this.actionApresRequete(
          this.traiterReponseSaisie(aErreurCommunication),
        );
      }
      _getMessageErreurSaisie(aMessagesErreurRapportSaisie, aReponse, aTitre) {
        let lDetails = '';
        if (
          aMessagesErreurRapportSaisie &&
          Array.isArray(aMessagesErreurRapportSaisie)
        ) {
          lDetails = aMessagesErreurRapportSaisie.join('\n');
        }
        let lTitre = aTitre || '';
        if (!lTitre) {
          switch (aReponse) {
            case EGenreReponseSaisie.erreur:
              lTitre = this.options.titreEchecValidation || '';
              break;
            case EGenreReponseSaisie.annulation:
              lTitre = this.options.titreAnnulationValidation || '';
              break;
          }
        }
        if (lTitre || lDetails) {
          this.messageErreur = { titre: lTitre, message: lDetails || '' };
        }
      }
      traiterReponseSaisieMessage(
        aMessagesErreurRapportSaisie,
        aReponse,
        aTitre,
      ) {
        this._getMessageErreurSaisie(
          aMessagesErreurRapportSaisie,
          aReponse,
          aTitre,
        );
        if (this.messageErreur && this.options.afficherMessageErreur) {
          this.promiseMessage = GApplication.getMessage().afficher(
            this.messageErreur,
          );
        }
      }
      traiterReponseSaisie(aErreurCommunication) {
        let lReponse = aErreurCommunication
          ? EGenreReponseSaisie.erreur
          : EGenreReponseSaisie.succes;
        if (!this.JSONRapportSaisie) {
          this.JSONRapportSaisie =
            this._jsonRacine && this._jsonRacine.RapportSaisie
              ? this._jsonRacine.RapportSaisie
              : {};
        }
        let lMessagesErreurRapportSaisie = !this.JSONRapportSaisie
          ? null
          : this.JSONRapportSaisie._messagesErreur_
            ? this.JSONRapportSaisie._messagesErreur_
            : this.JSONRapportSaisie._erreurSaisie_
              ? []
              : null;
        if (!lMessagesErreurRapportSaisie) {
          lMessagesErreurRapportSaisie =
            this.JSONSignature && this.JSONSignature.Erreur
              ? this.JSONSignature.MessageErreur
                ? [this.JSONSignature.MessageErreur]
                : []
              : null;
        }
        const lTitreErreur = !this.JSONRapportSaisie
          ? null
          : this.JSONRapportSaisie.titre_Messages_Erreur || '';
        if (this.reponseEnErreur()) {
          lReponse = EGenreReponseSaisie.erreur;
        } else if (lMessagesErreurRapportSaisie) {
          lReponse = EGenreReponseSaisie.annulation;
        }
        if (lMessagesErreurRapportSaisie) {
          this.traiterReponseSaisieMessage(
            lMessagesErreurRapportSaisie,
            lReponse,
            lTitreErreur,
          );
        }
        this.deserialiserSignature();
        if (
          !lMessagesErreurRapportSaisie &&
          this.options.avecControleModeExclusif &&
          GApplication.getModeExclusif()
        ) {
          lReponse = EGenreReponseSaisie.annulation;
          this.messageErreur = {
            titre: this.options.titreEchecModeExclusif,
            message: this.options.messageEchecModeExclusif,
          };
          if (this.options.afficherMessageErreur) {
            this.promiseMessage = GApplication.getMessage().afficher(
              this.messageErreur,
            );
          }
        }
        return lReponse;
      }
      reponseEnErreur() {
        return (
          (this.JSONRapportSaisie && this.JSONRapportSaisie._erreurSaisie_) ||
          (this.JSONSignature && this.JSONSignature.Erreur)
        );
      }
    }
    exports.ObjetRequeteSaisie = ObjetRequeteSaisie;
    ObjetRequeteSaisie.prototype.estUneSaisie = true;
    class ObjetRequeteConsultation extends ObjetRequeteJSON {
      constructor(...aParams) {
        super(...aParams);
        this._evenementEchec = aParams[2];
        this.setOptions({
          gererMessageErreur: function (aMessage) {
            const lMessage =
              aMessage && aMessage.length > 0
                ? aMessage
                : ObjetTraduction_1.GTraductions.getValeur('requete.erreur');
            try {
              return GApplication.getMessage().afficher({ message: lMessage });
            } catch (e) {}
          },
        });
      }
      traiterReponseRequete(aErreurCommunication) {
        if (!aErreurCommunication) {
          this.deserialiserSignature();
        }
        if (
          this.callbackEchec.evenement &&
          this.JSONSignature &&
          this.JSONSignature.Erreur
        ) {
          this.traiterReponseEchecConsultation();
        } else {
          this.actionApresRequete();
        }
      }
      traiterReponseEchecConsultation() {
        const lMessage =
          this.JSONSignature && this.JSONSignature.MessageErreur
            ? this.JSONSignature.MessageErreur
            : '';
        IE.log.addLog(
          'Erreur de consultation controlé avec le message : ' + lMessage,
          null,
          IE.log.genre.Avertissement,
        );
        let lParametresEchec = lMessage;
        if (!this._evenementEchec) {
          if (this.options.gererMessageErreur) {
            lParametresEchec = {
              promiseMessage: this.options.gererMessageErreur(lMessage),
              message: lMessage,
            };
          }
        }
        if (this.callbackEchec.appel(lParametresEchec)) {
          this.actionApresRequete();
        }
      }
      actionApresRequete() {
        this.callbackReussite.appel(this.JSONReponse);
      }
    }
    exports.ObjetRequeteConsultation = ObjetRequeteConsultation;
  },
  fn: 'objetrequetejson.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Requetes = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const lCollectionRequetes = {};
    const lRequetes = function (aIdentRequete, ...aParams) {
      const lClasseRequete = lCollectionRequetes[aIdentRequete];
      if (!lClasseRequete) {
        return { lancerRequete: function () {} };
      }
      const lInstanceRequete = new lClasseRequete(...aParams);
      lInstanceRequete.nom = aIdentRequete;
      return lInstanceRequete;
    };
    exports.Requetes = lRequetes;
    lRequetes.inscrire = function (aIdentRequete, aClasse) {
      if (!aIdentRequete) {
        return this;
      }
      if (!aClasse) {
        return this;
      }
      if (lCollectionRequetes[aIdentRequete]) {
        if (lCollectionRequetes[aIdentRequete] !== aClasse) {
        }
        return this;
      }
      if (
        !(
          aClasse === ObjetRequeteJSON_1.ObjetRequeteConsultation ||
          aClasse === ObjetRequeteJSON_1.ObjetRequeteSaisie
        )
      ) {
        aClasse.prototype.nom = aIdentRequete;
      }
      lCollectionRequetes[aIdentRequete] = aClasse;
    };
    lRequetes.collection = lCollectionRequetes;
  },
  fn: 'collectionrequetes.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_MessageDynamiqueDemarrage = void 0;
    require('ObjetFenetre_MessageDynamiqueDemarrage.css');
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetTraduction_1 = require('ObjetTraduction');
    class ObjetRequeteInfosDynamiquesMarquerLu extends ObjetRequeteJSON_1.ObjetRequeteConsultation {}
    CollectionRequetes_1.Requetes.inscrire(
      'InfosDynamiquesMarquerLu',
      ObjetRequeteInfosDynamiquesMarquerLu,
    );
    class ObjetFenetre_MessageDynamiqueDemarrage extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          listeBoutons: [ObjetTraduction_1.GTraductions.getValeur('Fermer')],
          avecComposeBasInFooter: true,
          callbackFermer: () => {
            if (
              this.marquerLu &&
              this.optionsFenetre.messages &&
              this.optionsFenetre.messages.length > 0
            ) {
              const lIds = [];
              this.optionsFenetre.messages.forEach((aMessage) => {
                lIds.push(aMessage.id);
              });
              new ObjetRequeteInfosDynamiquesMarquerLu(this).lancerRequete({
                tab: lIds,
              });
            }
          },
        });
        this.marquerLu = false;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          cbLu: {
            getValue: function () {
              return !!aInstance.marquerLu;
            },
            setValue: function (aValue) {
              aInstance.marquerLu = aValue;
            },
          },
        });
      }
      composeContenu() {
        if (
          this.optionsFenetre.messages &&
          this.optionsFenetre.messages.length > 0
        ) {
          let H = [];
          this.optionsFenetre.messages.forEach((aMessage) => {
            if (aMessage && aMessage.contenu) {
              if (H.length > 0) {
                H.push('<hr class="ob_mdd_hr">');
              }
              H.push(
                '<div class="comm_contenuMessageDynamique">',
                aMessage.contenu,
                '</div>',
              );
            }
          });
          if (!IE.estMobile) {
            H = ['<div class="ob_mdd_conteneur">', H.join(''), '</div>'];
          }
          return H.join('');
        }
      }
      composeBas() {
        return [
          '<ie-checkbox ie-model="cbLu" ie-textright class="ob_mdd_cb">',
          ObjetTraduction_1.GTraductions.getValeur('messagesDyn.marquerLu'),
          '</ie-checkbox>',
        ].join('');
      }
    }
    exports.ObjetFenetre_MessageDynamiqueDemarrage =
      ObjetFenetre_MessageDynamiqueDemarrage;
  },
  fn: 'objetfenetre_messagedynamiquedemarrage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetDonneesCentraleNotifications = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const Invocateur_1 = require('Invocateur');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetFenetre_MessageDynamiqueDemarrage_1 = require('ObjetFenetre_MessageDynamiqueDemarrage');
    var TypeNotif;
    (function (TypeNotif) {
      TypeNotif['surModification'] = 'odcn_surModification';
      TypeNotif['masquerNbNotifs'] = 'odcn_masquerNbNotifs';
    })(TypeNotif || (TypeNotif = {}));
    class ObjetDonneesCentraleNotifications {
      constructor() {
        this.nbNotifs = 0;
        Invocateur_1.Invocateur.abonner(
          ObjetRequeteJSON_1.utils.getIdentNotification(
            'compteurCentraleNotif',
          ),
          (aCompteur) => {
            this.nbNotifs = aCompteur;
            this._notifSurModification({ compteurCentraleNotif: true });
          },
        );
        Invocateur_1.Invocateur.abonner(
          TypeNotif.masquerNbNotifs,
          (aNbNotifs) => {
            this.nbNotifs = Math.max(0, this.nbNotifs - aNbNotifs);
            this._notifSurModification({ masquerNbNotifs: true });
          },
        );
      }
      _notifSurModification(aParams) {
        Invocateur_1.Invocateur.evenement(
          TypeNotif.surModification,
          Object.assign(aParams || {}, this.getDonnees()),
        );
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.refreshIEHtml,
        );
      }
      getDonnees(aParam) {
        return { nbNotifs: this.nbNotifs };
      }
      addMessagesDynamiques(aTabMessages) {
        this.listeMessagesDynamiques = [];
        if (aTabMessages && aTabMessages.length > 0 && aTabMessages.forEach) {
          aTabMessages.forEach((aMessage) => {
            if (aMessage && aMessage.id && aMessage.contenu) {
              this.listeMessagesDynamiques.push(aMessage);
            } else {
            }
          });
        }
      }
      initSurInterfaceDisponible() {
        if (
          this.listeMessagesDynamiques &&
          this.listeMessagesDynamiques.length > 0
        ) {
          ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
            ObjetFenetre_MessageDynamiqueDemarrage_1.ObjetFenetre_MessageDynamiqueDemarrage,
            { pere: {} },
            { messages: this.listeMessagesDynamiques },
          ).afficher();
          this.listeMessagesDynamiques = [];
        }
        this._notifSurModification();
      }
    }
    exports.ObjetDonneesCentraleNotifications =
      ObjetDonneesCentraleNotifications;
    ObjetDonneesCentraleNotifications.typeNotif = TypeNotif;
  },
  fn: 'objetdonneescentralenotifications.js',
});
IE.fModule({
  f: function (exports, require, module, global) {},
  fn: 'declarationjournauxcp.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    require('montserrat_font.css');
  },
  fn: 'declarationfontmontserrat.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetApplicationProduit = exports.EtatApplication = void 0;
    const ObjetApplication_1 = require('ObjetApplication');
    const GUID_1 = require('GUID');
    const Invocateur_1 = require('Invocateur');
    const ObjetDonneesCentraleNotifications_1 = require('ObjetDonneesCentraleNotifications');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetWAI_1 = require('ObjetWAI');
    const ObjetHtml_1 = require('ObjetHtml');
    require('DeclarationJournauxCP.js');
    require('DeclarationFontMontserrat.js');
    require('DeclarationLottie');
    var EtatApplication;
    (function (EtatApplication) {
      EtatApplication[(EtatApplication['normal'] = 1)] = 'normal';
      EtatApplication[(EtatApplication['modeExclusif'] = 2)] = 'modeExclusif';
    })(EtatApplication || (exports.EtatApplication = EtatApplication = {}));
    global.GEtatUtilisateur = undefined;
    global.GParametres = undefined;
    global.GCouleur = undefined;
    global.GInterface = undefined;
    class ObjetApplicationProduit extends ObjetApplication_1.ObjetApplication {
      constructor() {
        super();
        this.donneesCentraleNotifications =
          new ObjetDonneesCentraleNotifications_1.ObjetDonneesCentraleNotifications();
        this.estPrimaire = false;
        this.etatApplication = EtatApplication.normal;
        this.communication = null;
        this.estDemo = false;
        this.pileAbonnementInvocateur = {};
        this.idLigneSeparateur = GUID_1.GUID.getId();
        this.idLigneBandeau = 'ligne_bandeau';
        this.idBandeau = GUID_1.GUID.getId();
        this.idBreadcrumbCombo = 'breadcrumbBandeauCombo';
        this.idBreadcrumb = 'breadcrumbBandeau';
        this.idBreadcrumbPerso = 'breadcrumbBandeauPerso';
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.erreurCommunication,
          this.finSession,
          this,
        );
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.modificationModeExclusif,
          this._setModeExclusif,
          this,
        );
      }
      getEtatUtilisateur() {
        return GEtatUtilisateur;
      }
      getObjetParametres() {
        return GParametres;
      }
      getCouleur() {
        return GCouleur;
      }
      getCommunication() {
        return this.communication;
      }
      setCommunication(aInstanceCommunication) {
        this.communication = aInstanceCommunication;
        if (this.communication) {
          this.communication.setNom(this.getNom() + '.getCommunication ()');
        }
      }
      getDemo() {
        return this.estDemo;
      }
      setDemo(aValeur) {
        this.estDemo = aValeur;
      }
      getDateDemo() {
        return this.dateDemo;
      }
      setDateDemo(aDateDemo) {
        this.dateDemo = aDateDemo;
      }
      initDateServeur(aDate) {
        this.dateServeurReferant = aDate;
        this.dateClientReferant = new Date();
      }
      getDateServeur() {
        if (!this.dateServeurReferant || !this.dateClientReferant) {
          return new Date();
        }
        return new Date(
          this.dateServeurReferant.getTime() +
            new Date().getTime() -
            this.dateClientReferant.getTime(),
        );
      }
      getEtatApplication() {
        return this.etatApplication;
      }
      getModeExclusif() {
        return this.getEtatApplication() === EtatApplication.modeExclusif;
      }
      entreeModeExclusif() {
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.modeExclusif,
          true,
        );
      }
      sortieModeExclusif() {
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.modeExclusif,
          false,
        );
      }
      changerEtatApplication(aEtat) {
        switch (this.etatApplication) {
          case EtatApplication.normal:
            switch (aEtat) {
              case EtatApplication.normal:
                break;
              case EtatApplication.modeExclusif:
                this.etatApplication = aEtat;
                this.entreeModeExclusif();
                break;
              default:
            }
            break;
          case EtatApplication.modeExclusif:
            switch (aEtat) {
              case EtatApplication.normal:
                this.etatApplication = aEtat;
                this.sortieModeExclusif();
                break;
              case EtatApplication.modeExclusif:
                break;
              default:
            }
            break;
          default:
        }
      }
      async creerFenetreDebug(aFuncGetTraitement) {}
      getOptionsDebug() {
        return this.optionsDebug;
      }
      getOptionsEspaceLocal() {
        return this.optionsEspaceLocal;
      }
      finSession(aParametres) {
        Invocateur_1.Invocateur.desabonner(
          Invocateur_1.ObjetInvocateur.events.erreurCommunication,
          this,
        );
        const lParametresFin = { constructionPage: false };
        Object.assign(lParametresFin, aParametres);
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.fermerFenetres,
          true,
        );
        Invocateur_1.Invocateur.evenement('finSession');
        Invocateur_1.Invocateur.desabonner(
          Invocateur_1.ObjetInvocateur.events.modificationModeExclusif,
          this,
        );
        $(document).off();
        $(window).off();
        Invocateur_1.Invocateur.desabonner(
          Invocateur_1.ObjetInvocateur.events.autorisationRechargementPage,
        );
        if (window.GNavigateur) {
          GNavigateur.viderCache();
        }
        if (lParametresFin.constructionPage) {
          try {
            this.construirePageFinSession(lParametresFin);
          } catch (e) {
            IE.log.addLog('Exception construirePageFinSession : ' + e);
          }
        }
        this.SESSION_FINI = true;
        if (this.communication) {
          this.communication.arreter();
        }
        this.communication = null;
      }
      construirePageFinSession(aParametres) {
        if (this._unloadEnCours) {
          return;
        }
        const lCouleur = { texte: 'black', fond: 'white', bordure: 'black' };
        if (global.GCouleur) {
          Object.assign(lCouleur, GCouleur);
        }
        const lParametresFin = {
          jsonErreur: null,
          statut: '',
          couleur: lCouleur,
          sansBoutonSeConnecter: false,
        };
        Object.assign(lParametresFin, aParametres);
        let lTitre = null;
        let lMessage = null,
          lGenreErreur;
        if (lParametresFin.jsonErreur) {
          lGenreErreur = lParametresFin.jsonErreur.G;
          lTitre = lParametresFin.jsonErreur.Titre;
          lMessage = lParametresFin.jsonErreur.Message;
        }
        lTitre =
          lTitre === null || lTitre === undefined
            ? ObjetTraduction_1.GTraductions.getValeur(
                'connexion.PageIndisponible',
              )
            : lTitre;
        lMessage =
          lMessage === null || lMessage === undefined
            ? ObjetTraduction_1.GTraductions.getValeur(
                'connexion.AffichagePageImpossible',
              )
            : lMessage;
        const lEstPrimaire = !!this.estPrimaire;
        const T = [];
        T.push(
          `<div class="page-deconnexion ImageFond bg-espace-${!lEstPrimaire ? this.nomProduit.toLowerCase() : `primaire`}">`,
        );
        try {
          T.push(this.construireEnTetePageFinSession(lParametresFin));
        } catch (e) {}
        T.push(`<div class="deco-content" role="main">`);
        T.push(
          IE.jsx.str('h1', {
            class: `deco-titre-${!lEstPrimaire ? this.nomProduit.toLowerCase() : `primaire`}`,
            'aria-label': this.nomProduit,
          }),
        );
        T.push(
          `<p id="waispan_id">${ObjetTraduction_1.GTraductions.getValeur('connexion.Deconnecter')}</p>`,
        );
        if (lTitre) {
          T.push(
            '<p class="pageDeconnexion_titre">' +
              lTitre +
              (lParametresFin.statut
                ? ' (' +
                  ObjetTraduction_1.GTraductions.getValeur('connexion.Erreur') +
                  ' ' +
                  lParametresFin.statut +
                  ')'
                : '') +
              '</p>',
          );
        }
        if (lMessage) {
          T.push(IE.jsx.str('p', { class: 'message' }, lMessage));
        }
        if (lGenreErreur !== 7 && !lParametresFin.sansBoutonSeConnecter) {
          T.push(`<ie-bouton tabindex="0" class="themeBoutonPrimaire m-top"\n      ${ObjetWAI_1.GObjetWAI ? ObjetWAI_1.GObjetWAI.composeRole(ObjetWAI_1.EGenreRole.Button) : ''}
      ${ObjetWAI_1.GObjetWAI ? ObjetWAI_1.GObjetWAI.composeAttribut({ genre: ObjetWAI_1.EGenreAttribut.describedby, valeur: 'waispan_id' }) : ''}\n      onkeyup="if (GNavigateur.isToucheSelection()) window.location.reload()" onclick="window.location.reload ()">\n      ${ObjetTraduction_1.GTraductions.getValeur('connexion.SeConnecter')}</ie-bouton>`);
        }
        T.push(`</div>`);
        ObjetHtml_1.GHtml.setHtml(this.getIdConteneur(), T.join(''));
      }
      construireEnTetePageFinSession(aParametres) {
        return '';
      }
      _setModeExclusif(aEstModeExclusif) {
        this.changerEtatApplication(
          aEstModeExclusif
            ? EtatApplication.modeExclusif
            : EtatApplication.normal,
        );
      }
      getPileAbonnement() {
        return this.pileAbonnementInvocateur;
      }
    }
    exports.ObjetApplicationProduit = ObjetApplicationProduit;
  },
  fn: 'objetapplicationproduit.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequetePageCommune = void 0;
    const CollectionRequetes_1 = require('CollectionRequetes');
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    class ObjetRequetePageCommune extends ObjetRequeteJSON_1.ObjetRequeteConsultation {}
    exports.ObjetRequetePageCommune = ObjetRequetePageCommune;
    CollectionRequetes_1.Requetes.inscrire(
      'FonctionParametres',
      ObjetRequetePageCommune,
    );
  },
  fn: 'objetrequetepagecommune.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreEspace = void 0;
    var EGenreEspace;
    (function (EGenreEspace) {
      EGenreEspace[(EGenreEspace['Commun'] = 0)] = 'Commun';
      EGenreEspace[(EGenreEspace['Professeur'] = 1)] = 'Professeur';
      EGenreEspace[(EGenreEspace['Parent'] = 2)] = 'Parent';
      EGenreEspace[(EGenreEspace['Eleve'] = 3)] = 'Eleve';
      EGenreEspace[(EGenreEspace['Entreprise'] = 4)] = 'Entreprise';
      EGenreEspace[(EGenreEspace['Academie'] = 5)] = 'Academie';
      EGenreEspace[(EGenreEspace['Mobile_Eleve'] = 6)] = 'Mobile_Eleve';
      EGenreEspace[(EGenreEspace['Mobile_Parent'] = 7)] = 'Mobile_Parent';
      EGenreEspace[(EGenreEspace['Mobile_Professeur'] = 8)] =
        'Mobile_Professeur';
      EGenreEspace[(EGenreEspace['Mobile_Commun'] = 9)] = 'Mobile_Commun';
      EGenreEspace[(EGenreEspace['Etablissement'] = 13)] = 'Etablissement';
      EGenreEspace[(EGenreEspace['Mobile_Etablissement'] = 14)] =
        'Mobile_Etablissement';
      EGenreEspace[(EGenreEspace['Gestion_SSO'] = 15)] = 'Gestion_SSO';
      EGenreEspace[(EGenreEspace['Administrateur'] = 16)] = 'Administrateur';
      EGenreEspace[(EGenreEspace['Mobile_Administrateur'] = 17)] =
        'Mobile_Administrateur';
      EGenreEspace[(EGenreEspace['Inscription'] = 18)] = 'Inscription';
      EGenreEspace[(EGenreEspace['PrimProfesseur'] = 19)] = 'PrimProfesseur';
      EGenreEspace[(EGenreEspace['PrimParent'] = 20)] = 'PrimParent';
      EGenreEspace[(EGenreEspace['Mobile_PrimProfesseur'] = 21)] =
        'Mobile_PrimProfesseur';
      EGenreEspace[(EGenreEspace['Mobile_PrimParent'] = 22)] =
        'Mobile_PrimParent';
      EGenreEspace[(EGenreEspace['PrimEleve'] = 23)] = 'PrimEleve';
      EGenreEspace[(EGenreEspace['Mobile_PrimEleve'] = 24)] =
        'Mobile_PrimEleve';
      EGenreEspace[(EGenreEspace['Accompagnant'] = 25)] = 'Accompagnant';
      EGenreEspace[(EGenreEspace['Mobile_Accompagnant'] = 26)] =
        'Mobile_Accompagnant';
      EGenreEspace[(EGenreEspace['PrimAccompagnant'] = 27)] =
        'PrimAccompagnant';
      EGenreEspace[(EGenreEspace['Mobile_PrimAccompagnant'] = 28)] =
        'Mobile_PrimAccompagnant';
      EGenreEspace[(EGenreEspace['Tuteur'] = 29)] = 'Tuteur';
      EGenreEspace[(EGenreEspace['Mobile_Tuteur'] = 30)] = 'Mobile_Tuteur';
      EGenreEspace[(EGenreEspace['PrimPeriscolaire'] = 31)] =
        'PrimPeriscolaire';
      EGenreEspace[(EGenreEspace['Mobile_PrimPeriscolaire'] = 32)] =
        'Mobile_PrimPeriscolaire';
      EGenreEspace[(EGenreEspace['PagePubliqueEtablissement'] = 33)] =
        'PagePubliqueEtablissement';
      EGenreEspace[(EGenreEspace['Mobile_PagePubliqueEtablissement'] = 34)] =
        'Mobile_PagePubliqueEtablissement';
      EGenreEspace[(EGenreEspace['PrimMairie'] = 35)] = 'PrimMairie';
      EGenreEspace[(EGenreEspace['Mobile_PrimMairie'] = 36)] =
        'Mobile_PrimMairie';
      EGenreEspace[(EGenreEspace['PrimDirection'] = 37)] = 'PrimDirection';
      EGenreEspace[(EGenreEspace['Mobile_PrimDirection'] = 38)] =
        'Mobile_PrimDirection';
    })(EGenreEspace || (exports.EGenreEspace = EGenreEspace = {}));
  },
  fn: 'enumere_espace.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('forge.min.js');
  },
  fn: 'declarationforge.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreCryptage = void 0;
    var EGenreCryptage;
    (function (EGenreCryptage) {
      EGenreCryptage[(EGenreCryptage['Aucun'] = 0)] = 'Aucun';
      EGenreCryptage[(EGenreCryptage['Unicode'] = 1)] = 'Unicode';
      EGenreCryptage[(EGenreCryptage['AES'] = 2)] = 'AES';
      EGenreCryptage[(EGenreCryptage['RSA1024'] = 3)] = 'RSA1024';
      EGenreCryptage[(EGenreCryptage['RSA2048'] = 4)] = 'RSA2048';
    })(EGenreCryptage || (exports.EGenreCryptage = EGenreCryptage = {}));
  },
  fn: 'enumere_cryptage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreIdsRequeteAjax = void 0;
    var EGenreIdsRequeteAjax;
    (function (EGenreIdsRequeteAjax) {
      EGenreIdsRequeteAjax['SignatureAttente'] = '_SignatureAttente_';
      EGenreIdsRequeteAjax['numeroSession'] = 'session';
      EGenreIdsRequeteAjax['numeroOrdre'] = 'numeroOrdre';
      EGenreIdsRequeteAjax['donneesSecurisee'] = 'donneesSec';
      EGenreIdsRequeteAjax['donneesNonSecurisee'] = 'donneesNonSec';
      EGenreIdsRequeteAjax['nomFonction'] = 'nom';
      EGenreIdsRequeteAjax['echecReseau'] = 'echecReseau';
    })(
      EGenreIdsRequeteAjax ||
        (exports.EGenreIdsRequeteAjax = EGenreIdsRequeteAjax = {}),
    );
  },
  fn: 'enumere_idsrequeteajax.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('pako.min');
    require('pako');
  },
  fn: 'declarationpako.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetCryptageAES = void 0;
    require('DeclarationForge.js');
    class ObjetCryptageAES {
      decrypter(aChaine, aCle, aIv) {
        try {
          aCle = forge.md.md5.create().update(aCle.bytes()).digest();
          aIv = aIv.length()
            ? forge.md.md5.create().update(aIv.bytes()).digest()
            : new forge.util.ByteBuffer('\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0');
          aChaine = new forge.util.ByteBuffer(forge.util.hexToBytes(aChaine));
          const lChiffreur = forge.cipher.createDecipher('AES-CBC', aCle);
          lChiffreur.start({ iv: aIv });
          lChiffreur.update(aChaine);
          return lChiffreur.finish() && lChiffreur.output.bytes();
        } catch (e) {
          return false;
        }
      }
      encrypter(aChaine, aCle, aIv) {
        try {
          aCle = forge.md.md5.create().update(aCle.bytes()).digest();
          aIv = aIv.length()
            ? forge.md.md5.create().update(aIv.bytes()).digest()
            : new forge.util.ByteBuffer('\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0');
          aChaine = new forge.util.ByteBuffer(aChaine);
          const lChiffreur = forge.cipher.createCipher('AES-CBC', aCle);
          lChiffreur.start({ iv: aIv });
          lChiffreur.update(aChaine);
          return lChiffreur.finish() && lChiffreur.output.toHex();
        } catch (e) {
          return false;
        }
      }
    }
    exports.ObjetCryptageAES = ObjetCryptageAES;
  },
  fn: 'objetcryptageaes.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetCryptageRSA = void 0;
    require('DeclarationForge.js');
    const c_rsaPub_modulo_2048 =
      '83261A50C8778C33B533BF8324A433A536DD5E9F4F08DDBC3EA6F918C3A9B17A37E5B3B1535301ADCFE4ECA4E0A5AC6000195F75C38F55CA2D1F14470EE5CB5DCDAE5750610EBA1BB0C747DC8B85A83003F9B91969704F44D2B7098039AE35A5E67BF854CD94EB1CA888AAA2EB9F5EFC8016E70DEB4E3ADB9D57621139D08918BD63F90C899703E1879A30FCAF92AC9ADDEFCAE432911D05822FDB333FC75C6D3307E4AE7FF6982E54F9F47AD6E421239F287EE110053335FFA55E25C11AA4EE6D0DA2DB90489906BE029D0AF2CBB3227802E2E19577DDA7E149D6D6DE7BFDC447AB0AE7779AC7916FC3C67A72EEFE75C4C3A5A4B694D9B44B25CF43D6075D0D';
    const c_rsaPub_exposant_2048 =
      '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001';
    const c_rsaPub_modulo_1024 =
      'B99B77A3D72D3A29B4271FC7B7300E2F791EB8948174BE7B8024667E915446D4EEA0C2424B8D1EBF7E2DDFF94691C6E994E839225C627D140A8F1146D1B0B5F18A09BBD3D8F421CA1E3E4796B301EEBCCF80D81A32A1580121B8294433C38377083C5517D5921E8A078CDC019B15775292EFDA2C30251B1CCABE812386C893E5';
    const c_rsaPub_exposant_1024 =
      '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001';
    class ObjetCryptageRSA {
      encrypter1024(aChaine) {
        return this._encrypter(
          c_rsaPub_modulo_1024,
          c_rsaPub_exposant_1024,
          aChaine,
        );
      }
      encrypter2048(aChaine) {
        return this._encrypter(
          c_rsaPub_modulo_2048,
          c_rsaPub_exposant_2048,
          aChaine,
        );
      }
      _encrypter(aModulo, aExposant, aChaine) {
        const lRSA = forge.pki.rsa.setPublicKey(
          new forge.jsbn.BigInteger(aModulo, 16),
          new forge.jsbn.BigInteger(aExposant, 16),
        );
        const lResult = forge.util.encode64(lRSA.encrypt(aChaine.bytes()), 64);
        return lResult;
      }
    }
    exports.ObjetCryptageRSA = ObjetCryptageRSA;
  },
  fn: 'objetcryptagersa.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GCryptage = void 0;
    require('DeclarationForge');
    require('DeclarationPako');
    const Enumere_Cryptage_1 = require('Enumere_Cryptage');
    const ObjetCryptageAES_1 = require('ObjetCryptageAES');
    const ObjetCryptageRSA_1 = require('ObjetCryptageRSA');
    class ObjetCryptage {
      constructor() {
        this.Minuscules = 'abcdefghijklmnopkrstuvwxyz';
        this.Majuscules = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        this.Nombres = '0123456789';
        this.Caracteres = '&#|^@£$µ?!%ù§~°()[]{}+-*/=.,;';
        this.cryptageAES = new ObjetCryptageAES_1.ObjetCryptageAES();
        this.cryptageRSA = new ObjetCryptageRSA_1.ObjetCryptageRSA();
      }
      getCryptageAES() {
        return this.cryptageAES;
      }
      getCryptageRSA() {
        return this.cryptageRSA;
      }
      genererTexteAleatoire(ALongueur) {
        const LListeCaracteres =
          this.Minuscules + this.Majuscules + this.Nombres;
        const N = LListeCaracteres.length;
        let LChaine = '';
        while (LChaine.length < ALongueur) {
          LChaine += LListeCaracteres.charAt(Math.floor(N * Math.random()));
        }
        return LChaine;
      }
      getBuffer(aChaine) {
        return new forge.util.ByteBuffer(forge.util.encodeUtf8(aChaine));
      }
      encrypter(aOptions) {
        const lDefault = {
          genreCryptage: Enumere_Cryptage_1.EGenreCryptage.Aucun,
          chaine: '',
          cle: '',
          iv: '',
          avecAlea: false,
          avecCompression: false,
        };
        const lOptions = {};
        $.extend(lOptions, lDefault, aOptions);
        lOptions.chaine = '' + lOptions.chaine;
        lOptions.chaine = forge.util.encodeUtf8(lOptions.chaine);
        if (lOptions.avecAlea) {
          lOptions.chaine = this.ajouterAlea(lOptions.chaine);
        }
        if (lOptions.avecCompression) {
          lOptions.chaine = new forge.util.ByteBuffer(lOptions.chaine).toHex();
          const lUint = window.pako.deflateRaw(lOptions.chaine, {
            level: 6,
            to: 'string',
          });
          if (typeof lUint === 'string') {
            lOptions.chaine = lUint;
          } else {
            lOptions.chaine = this.uint8ArrayToStrRaw(lUint);
          }
        }
        let lChaineEncrypte = '';
        switch (lOptions.genreCryptage) {
          case Enumere_Cryptage_1.EGenreCryptage.Aucun:
            lChaineEncrypte = lOptions.chaine;
            break;
          case Enumere_Cryptage_1.EGenreCryptage.Unicode:
            lChaineEncrypte = lOptions.chaine;
            break;
          case Enumere_Cryptage_1.EGenreCryptage.AES:
            lChaineEncrypte = this.cryptageAES.encrypter(
              lOptions.chaine,
              lOptions.cle,
              lOptions.iv,
            );
            break;
          default:
            break;
        }
        return lChaineEncrypte;
      }
      decrypter(aOptions) {
        const lDefault = {
          genreCryptage: Enumere_Cryptage_1.EGenreCryptage.Aucun,
          chaine: '',
          cle: '',
          iv: '',
          avecAlea: false,
          enBytes: false,
          avecCompression: false,
        };
        const lOptions = {};
        $.extend(lOptions, lDefault, aOptions);
        let lChaineEncrypte = lOptions.chaine;
        let lChaineDecrypte = '';
        switch (lOptions.genreCryptage) {
          case Enumere_Cryptage_1.EGenreCryptage.Aucun:
            lChaineDecrypte = lChaineEncrypte;
            break;
          case Enumere_Cryptage_1.EGenreCryptage.Unicode:
            lChaineDecrypte = lChaineEncrypte;
            break;
          case Enumere_Cryptage_1.EGenreCryptage.AES:
            lChaineDecrypte = this.cryptageAES.decrypter(
              lChaineEncrypte,
              lOptions.cle,
              lOptions.iv,
            );
            break;
          default:
            break;
        }
        if (lChaineDecrypte !== '' && lOptions.avecCompression) {
          const lUint = this.strRawToUint8Array(lChaineDecrypte);
          lChaineDecrypte = window.pako.inflateRaw(lUint, { to: 'string' });
        }
        if (lChaineDecrypte !== '') {
          try {
            lChaineDecrypte = forge.util.decodeUtf8(lChaineDecrypte);
          } catch (e) {
            lChaineDecrypte = '';
          }
        }
        if (lChaineDecrypte !== '' && lOptions.avecAlea) {
          lChaineDecrypte = this.enleverAlea(lChaineDecrypte);
        }
        if (lOptions.enBytes) {
          const lBuff = new forge.util.ByteBuffer();
          const lArrInt = lChaineDecrypte.split(',');
          for (let i = 0; i < lArrInt.length; i++) {
            lBuff.putInt(parseInt(lArrInt[i]), 8);
          }
          lChaineDecrypte = lBuff;
        }
        return lChaineDecrypte;
      }
      ajouterAlea(AChaine) {
        const N = AChaine.length;
        const LTableauAvecAlea = [];
        const LListeCaracteres =
          this.Minuscules + this.Majuscules + this.Nombres;
        const C = LListeCaracteres.length;
        for (let I = 0; I < N; I++) {
          LTableauAvecAlea.push(
            LListeCaracteres.charAt(Math.floor(C * Math.random())),
          );
          LTableauAvecAlea.push(String(AChaine).charAt(I));
        }
        return LTableauAvecAlea.join('');
      }
      enleverAlea(AChaine) {
        const N = AChaine.length;
        const LTableauSansAlea = new Array(N);
        for (let I = 0; I < N; I += 1) {
          if (I % 2 === 0) {
            LTableauSansAlea.push(AChaine.charAt(I));
          }
        }
        return LTableauSansAlea.join('');
      }
      chiffrementUrl(LChemin, LNomFichier, ACle, ANumeroSession) {
        const LUrlChiffree = this.encrypter({
          genreCryptage: Enumere_Cryptage_1.EGenreCryptage.AES,
          chaine: LChemin,
          cle: ACle,
        });
        return (
          'cheminsecurise' +
          LUrlChiffree +
          '/' +
          LNomFichier +
          '?Session=' +
          ANumeroSession
        );
      }
      strRawToUint8Array(aStr) {
        return Uint8Array.from([...aStr].map((aChar) => aChar.charCodeAt(0)));
      }
      uint8ArrayToStrRaw(aUint) {
        const cCHUNK_SZ = 0x8000;
        const lArray = [];
        for (let i = 0; i < aUint.length; i += cCHUNK_SZ) {
          lArray.push(
            String.fromCharCode.apply(
              null,
              Array.from(aUint.subarray(i, i + cCHUNK_SZ)),
            ),
          );
        }
        return lArray.join('');
      }
    }
    const GCryptage = new ObjetCryptage();
    exports.GCryptage = GCryptage;
  },
  fn: 'objetcryptage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.getXmlHttp = getXmlHttp;
    try {
      global.Document.prototype.loadXML = function (S) {
        const LDocument = new DOMParser().parseFromString(S, 'text/xml');
        while (this.hasChildNodes()) {
          this.removeChild(this.lastChild);
        }
        for (let I = 0; I < LDocument.childNodes.length; I++) {
          this.appendChild(this.importNode(LDocument.childNodes[I], true));
        }
      };
    } catch (e) {}
    try {
      global.Document.prototype.__defineGetter__('xml', function () {
        return new XMLSerializer().serializeToString(this);
      });
    } catch (e) {}
    function getXmlHttp() {
      try {
        if (global.XMLHttpRequest) {
          return new XMLHttpRequest();
        }
        const lActiveX = global.ActiveXObject;
        if (lActiveX) {
          try {
            return new lActiveX('Msxml2.XMLHTTP');
          } catch (e) {
            return new lActiveX('Microsoft.XMLHTTP');
          }
        }
      } catch (e) {
        throw new Error('XmlHttp> ' + e);
      }
    }
  },
  fn: 'xmlhttp.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeEtatRequeteAjax = void 0;
    var TypeEtatRequeteAjax;
    (function (TypeEtatRequeteAjax) {
      TypeEtatRequeteAjax[(TypeEtatRequeteAjax['initial'] = 0)] = 'initial';
      TypeEtatRequeteAjax[(TypeEtatRequeteAjax['preparationEnvoi'] = 1)] =
        'preparationEnvoi';
      TypeEtatRequeteAjax[(TypeEtatRequeteAjax['envoye'] = 2)] = 'envoye';
      TypeEtatRequeteAjax[(TypeEtatRequeteAjax['recu'] = 3)] = 'recu';
      TypeEtatRequeteAjax[(TypeEtatRequeteAjax['termine'] = 4)] = 'termine';
    })(
      TypeEtatRequeteAjax ||
        (exports.TypeEtatRequeteAjax = TypeEtatRequeteAjax = {}),
    );
  },
  fn: 'typeetatrequeteajax.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequete = void 0;
    const Enumere_IdsRequeteAjax_1 = require('Enumere_IdsRequeteAjax');
    const XmlHttp_1 = require('XmlHttp');
    const TypeEtatRequeteAjax_1 = require('TypeEtatRequeteAjax');
    class ObjetRequete {
      constructor(aParametres) {
        this.Parametres = {
          numeroSession: '0',
          asynchrone: true,
          post: true,
          nomRequete: '',
          genreEspace: 0,
          sansBlocageInterface: false,
          nomDeFonction: '',
          parametres: '',
          jsonNonSecurise: null,
          fichiers: null,
          callBackReadyStateChange: null,
          pereReponse: null,
          evenementReponse: null,
          messageDetail: '',
          jsonOrigine: null,
          echecReseau: false,
          estBackup: false,
          dataPOST: null,
          log: {},
          numeroRequete: 0,
        };
        $.extend(this.Parametres, aParametres);
        this.estUneRequete = true;
        this.etat = TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.initial;
      }
      getXmlRequest() {
        return this.Requete;
      }
      enAttente() {
        return (
          this.etat ===
            TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.preparationEnvoi ||
          this.etat === TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.envoye ||
          this.etat === TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.recu
        );
      }
      envoieRequete(aParametres) {
        const lParametres = $.extend(
          { numeroOrdre: 0, numeroOrdreChiffre: '' },
          aParametres,
        );
        const lCheminSecurise =
          this.Parametres.nomRequete +
          '/' +
          (this.Parametres.genreEspace || 0).toString() +
          '/' +
          this.Parametres.numeroSession +
          '/' +
          lParametres.numeroOrdreChiffre;
        this.Requete = (0, XmlHttp_1.getXmlHttp)();
        this.Requete.open(
          this.Parametres.post ? 'Post' : 'Get',
          lCheminSecurise,
          this.Parametres.asynchrone,
        );
        this.Requete.onreadystatechange = this.onReadyStateChange.bind(this);
        this.Requete.setRequestHeader('Content-Type', 'application/json');
        let lDataPost = null;
        if (this.Parametres.post) {
          lDataPost = this.Parametres.estBackup
            ? this.Parametres.dataPOST
            : this._getData(lParametres.numeroOrdreChiffre);
        }
        this.backupDataJSON = lDataPost;
        this.Requete.send(lDataPost);
        this.etat = TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.envoye;
        try {
          if (IE.log.getActifRequete()) {
            let lEstAttente = false;
            IE.log.addRequete({
              nomRequete: this.Parametres.nomDeFonction,
              numeroRequete: this.Parametres.numeroRequete,
              numeroOrdre: lParametres.numeroOrdre,
              chrono: { xml: '', traitement: this.Parametres.log.tempsChiffre },
              estReponse: false,
              estBackup: this.Parametres.estBackup,
              lgcontenu: this.Parametres.log.tailleDonnees,
              estPolling: this.Parametres.estPolling,
              estAttente: lEstAttente,
            });
          }
        } catch (e) {}
      }
      toString() {
        return this.Parametres.nomDeFonction;
      }
      _getData(aNumeroOrdreChiffre) {
        const lJSON = {};
        lJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.numeroSession] =
          parseInt(this.Parametres.numeroSession, 10);
        lJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.numeroOrdre] =
          aNumeroOrdreChiffre;
        lJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.nomFonction] =
          this.Parametres.nomDeFonction;
        lJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.donneesSecurisee] =
          this.Parametres.parametres;
        if (this.Parametres.jsonNonSecurise) {
          lJSON[
            Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.donneesNonSecurisee
          ] = this.Parametres.jsonNonSecurise;
        }
        if (this.Parametres.echecReseau) {
          lJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.echecReseau] =
            true;
        }
        return JSON.stringify(lJSON);
      }
      onReadyStateChange() {
        if (this.Requete.readyState === 4) {
          this.etat = TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.recu;
          if (this.Parametres.callBackReadyStateChange) {
            const lRequeteXmlHttp = this.Requete;
            delete this.Requete;
            this.Parametres.callBackReadyStateChange(
              this,
              lRequeteXmlHttp.responseText,
              lRequeteXmlHttp.status,
            );
            lRequeteXmlHttp.onreadystatechange = null;
          }
        }
      }
    }
    exports.ObjetRequete = ObjetRequete;
  },
  fn: 'objetrequete.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeEtatUpload = void 0;
    var TypeEtatUpload;
    (function (TypeEtatUpload) {
      TypeEtatUpload[(TypeEtatUpload['TEU_Inconnu'] = 0)] = 'TEU_Inconnu';
      TypeEtatUpload[(TypeEtatUpload['TEU_Reussi'] = 1)] = 'TEU_Reussi';
      TypeEtatUpload[(TypeEtatUpload['TEU_Erreur'] = 2)] = 'TEU_Erreur';
      TypeEtatUpload[(TypeEtatUpload['TEU_EnCours'] = 3)] = 'TEU_EnCours';
    })(TypeEtatUpload || (exports.TypeEtatUpload = TypeEtatUpload = {}));
  },
  fn: 'typeetatupload.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UploadFileAjax = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const XmlHttp_1 = require('XmlHttp');
    const Invocateur_1 = require('Invocateur');
    const u_blobSlice =
      global.Blob &&
      (Blob.prototype.slice ||
        Blob.prototype.webkitSlice ||
        Blob.prototype.mozSlice);
    class UploadFileAjax {
      static sendPromise(aParams) {
        const lParams = Object.assign(
          {
            url: '',
            file: null,
            remplisseurFormData: null,
            remplisseurHeaders: null,
            responseType: 'json',
            maxChunkSize: 100 * 1024,
            fournisseurAbort: null,
            callbackProgress: null,
          },
          aParams,
        );
        if (!lParams.url || !lParams.file) {
          return Promise.reject();
        }
        Object.assign(lParams, {
          _fileSize: lParams.file.size,
          funcAbort: () => {},
        });
        if (lParams.fournisseurAbort) {
          lParams.fournisseurAbort(() => {
            return lParams.funcAbort();
          });
          Invocateur_1.Invocateur.evenement(
            Invocateur_1.ObjetInvocateur.events.refreshIEHtml,
          );
        }
        return this._sendChunk(lParams, 0).finally(() => {
          if (lParams.fournisseurAbort) {
            lParams.fournisseurAbort(null);
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.refreshIEHtml,
            );
          }
        });
      }
      static _sendChunk(aParams, aIndexStart) {
        let lIndexStartSuivant = aIndexStart;
        return new Promise((aResolve, aReject) => {
          if (aParams._aborted) {
            aReject({
              fail: true,
              isAborted: true,
              estReponseRequete: false,
              statut: 0,
              response: null,
            });
            return;
          }
          const lRequete = (0, XmlHttp_1.getXmlHttp)();
          if (aParams.responseType) {
            lRequete.responseType = aParams.responseType;
          }
          lRequete.open('POST', aParams.url);
          let lFile = null;
          if (
            aParams._fileSize > aParams.maxChunkSize &&
            aParams.maxChunkSize > 0 &&
            u_blobSlice
          ) {
            const lIndexEnd = Math.min(
              aIndexStart + aParams.maxChunkSize,
              aParams._fileSize,
            );
            lFile = u_blobSlice.call(
              aParams.file,
              aIndexStart,
              lIndexEnd,
              aParams.file.type,
            );
            lRequete.setRequestHeader(
              'content-range',
              `bytes ${aIndexStart}-${lIndexEnd - 1}/${aParams._fileSize}`,
            );
            lIndexStartSuivant += aParams.maxChunkSize;
          } else {
            lFile = aParams.file;
            lIndexStartSuivant += aParams._fileSize;
          }
          if (aParams.file.name) {
            lRequete.setRequestHeader(
              'content-disposition',
              `attachment; filename="${encodeURI(aParams.file.name)}"`,
            );
          }
          let lBody = null;
          if (
            MethodesObjet_1.MethodesObjet.isFunction(
              aParams.remplisseurFormData,
            )
          ) {
            lBody = new FormData();
            aParams.remplisseurFormData(lBody, lFile);
          } else {
            lBody = lFile;
          }
          if (
            MethodesObjet_1.MethodesObjet.isFunction(aParams.remplisseurHeaders)
          ) {
            aParams.remplisseurHeaders(lRequete);
          }
          lRequete.onreadystatechange = () => {
            if (lRequete.readyState === 4) {
              aParams.funcAbort = () => {
                aParams._aborted = true;
              };
              if (aParams.callbackProgress) {
                aParams.callbackProgress({
                  pourcent:
                    (Math.min(
                      aIndexStart + aParams.maxChunkSize,
                      aParams._fileSize,
                    ) *
                      100) /
                    aParams._fileSize,
                });
              }
              const lResult = {
                estReponseRequete: true,
                statut: lRequete.status,
                response: lRequete.response,
              };
              if (lRequete.status >= 200 && lRequete.status < 300) {
                aResolve(Object.assign(lResult, { done: true }));
              } else {
                aReject(
                  Object.assign(lResult, {
                    fail: true,
                    isAborted: !!lRequete._aborted && lRequete.status === 0,
                  }),
                );
              }
            }
          };
          aParams.funcAbort = () => {
            lRequete._aborted = true;
            lRequete.abort();
          };
          lRequete.send(lBody);
        }).then((aResult) => {
          if (lIndexStartSuivant < aParams._fileSize) {
            return this._sendChunk(aParams, lIndexStartSuivant);
          }
          return aResult;
        });
      }
    }
    exports.UploadFileAjax = UploadFileAjax;
  },
  fn: 'uploadfileajax.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteUploadFile = void 0;
    const IEHtml = require('IEHtml');
    const Invocateur_1 = require('Invocateur');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const TypeEtatUpload_1 = require('TypeEtatUpload');
    const TypeEtatRequeteAjax_1 = require('TypeEtatRequeteAjax');
    const MethodesObjet_1 = require('MethodesObjet');
    const UploadFileAjax_1 = require('UploadFileAjax');
    let uIdFichier = 0;
    class ObjetRequeteUploadFile {
      constructor(aParametres) {
        this.estUneRequete = false;
        this.estUploadFile = true;
        this.etat = TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.initial;
        this.donnees = Object.assign(
          {
            listeFichiers: null,
            maxChunkSize: 100 * 1024,
            messageEchec: ObjetTraduction_1.GTraductions.getValeur(
              'inputFile.echecEnvoi',
            ),
            callbackDone: null,
            callback: null,
            callbackEach: null,
            getFormData: null,
            getUrl: null,
            callbackInterrupt: null,
            moduleMD5: null,
          },
          aParametres,
        );
        this.progression = {
          requete: this,
          listeFichiersEnAttente: this.donnees.listeFichiers.getListeElements(),
          nbReussi: 0,
          error: null,
        };
      }
      estVide() {
        return (
          !this.donnees ||
          !this.donnees.listeFichiers ||
          !this.donnees.listeFichiers.count ||
          this.donnees.listeFichiers.count() === 0
        );
      }
      envoiRequete(aParams) {
        this.etat = TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.envoye;
        Object.assign(this.donnees, aParams);
        const lSelf = this;
        let lParams = null;
        if (this.donnees.callbackInterrupt) {
          lParams = {
            htmlPied:
              '<ie-bouton ie-model="btnInterrupt">' +
              ObjetTraduction_1.GTraductions.getValeur(
                'inputFile.AnnulerLEnvoi',
              ) +
              '</ie-bouton>',
            controleur: {
              btnInterrupt: {
                event: function () {
                  if (lSelf.progression.funcAbortRequete) {
                    lSelf.progression.funcAbortRequete();
                  }
                },
                getDisabled: function () {
                  return !lSelf.progression.funcAbortRequete;
                },
              },
            },
          };
        }
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.eventIOAjax,
          {
            emission: true,
            upload: true,
            nombreFichiers: this.donnees.listeFichiers.getNbrElementsExistes(),
            init: true,
            params: lParams,
          },
        );
        this._sendNextFile();
      }
      enAttente() {
        return (
          this.etat ===
            TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.preparationEnvoi ||
          this.etat === TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.envoye ||
          this.etat === TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.recu
        );
      }
      _eventAjaxIOProgression(aParams) {
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.eventIOAjax,
          {
            emission: true,
            upload: true,
            message:
              aParams.message ||
              ObjetTraduction_1.GTraductions.getValeur('requete.transfertPJ'),
            nombreFichiers: this.donnees.listeFichiers.getNbrElementsExistes(),
            ignorerBlocageClavier: true,
            progress: {
              personnalise: true,
              actualFile: this.progression.nbReussi + 1,
              percent: aParams.pourcent || 0,
              md5: aParams.md5 || false,
            },
          },
        );
      }
      _send(aFichier, aMD5) {
        return new Promise((aResolve) => {
          this._eventAjaxIOProgression({});
          if (!aFichier.idFichier) {
            uIdFichier += 1;
            aFichier.idFichier = 'reqUpl_' + uIdFichier + '_' + Date.now();
          }
          this.progression.json = null;
          const lFormData = this.donnees.getFormData(aFichier) || {};
          if (aMD5) {
            lFormData.md5 = aMD5;
          }
          return UploadFileAjax_1.UploadFileAjax.sendPromise({
            url: this.donnees.getUrl(),
            file: aFichier.file,
            remplisseurFormData: (aFormData, aFile) => {
              Object.keys(lFormData).forEach((aKeys) => {
                aFormData.append(aKeys, lFormData[aKeys]);
              });
              aFormData.append('files[]', aFile, aFichier.file.name);
            },
            maxChunkSize: this.donnees.maxChunkSize,
            fournisseurAbort: (aAbortRequete) => {
              this.progression.funcAbortRequete = aAbortRequete;
            },
            callbackProgress: (aParams) => {
              const lProgressBar = Math.round(aParams.pourcent);
              this._eventAjaxIOProgression({ pourcent: lProgressBar });
            },
          })
            .then(
              (aResult) => {
                if (
                  aResult.response &&
                  MethodesObjet_1.MethodesObjet.isNumber(aResult.response.etat)
                ) {
                  this.progression.json = aResult.response;
                  if (
                    aResult.response.etat ===
                    TypeEtatUpload_1.TypeEtatUpload.TEU_Reussi
                  ) {
                    this.progression.nbReussi += 1;
                  } else {
                    this.progression.error = {
                      message: aResult.response.message,
                    };
                  }
                } else {
                  this.progression.error = {};
                }
              },
              (aError) => {
                if (aError) {
                  if (aError.isAborted) {
                    this.progression.error = {
                      abort: true,
                      message: ObjetTraduction_1.GTraductions.getValeur(
                        'inputFile.msgEnvoiFichierAnnule',
                      ),
                    };
                  } else {
                    this.progression.error = { fail: true };
                  }
                  if (aError.response) {
                    this.progression.json = aError.response;
                    if (
                      this.progression.json &&
                      this.progression.json.message
                    ) {
                      this.progression.error.message =
                        this.progression.json.message;
                    }
                  }
                } else {
                  IE.log.addLog(`echec fichier ${aError}`);
                  this.progression.error = { fail: true };
                }
              },
            )
            .finally(() => {
              IEHtml.refresh();
              aResolve(aFichier);
            });
        });
      }
      _debloquerPatience() {
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.eventIOAjax,
          { emission: false, upload: true, debloquerForcer: true },
        );
      }
      _doneFile(aFichier) {
        this.progression.funcAbortRequete = null;
        IEHtml.refresh();
        let lErreurSession = null;
        const lSurAnnulationUpload =
          this.progression.error && this.progression.error.abort;
        if (
          !lSurAnnulationUpload &&
          this.donnees.callbackEach &&
          this.progression.json
        ) {
          lErreurSession = this.donnees.callbackEach(this.progression.json);
        }
        if (lErreurSession) {
          this.progression.error = {};
        }
        if (this.progression.error) {
          this.progression.listeFichiersEnAttente =
            new ObjetListeElements_1.ObjetListeElements();
          this._debloquerPatience();
          if (
            lSurAnnulationUpload &&
            !lErreurSession &&
            this.donnees.callbackInterrupt
          ) {
            this.donnees.callbackInterrupt();
          }
          Promise.resolve()
            .then(() => {
              if (!lErreurSession) {
                return GApplication.getMessage().afficher({
                  titre: this.progression.error.titre || '',
                  message:
                    this.progression.error.message || this.donnees.messageEchec,
                });
              }
            })
            .then(() => {
              this._doneAll(lErreurSession);
            });
        } else {
          this._sendNextFile();
        }
      }
      _doneAll(aErreurSession) {
        this.etat = TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.recu;
        this._debloquerPatience();
        let lErreurSession = aErreurSession;
        if (
          this.progression &&
          this.progression.error &&
          this.progression.json &&
          this.progression.json.Erreur
        ) {
          lErreurSession = this.progression.json.Erreur;
        }
        if (this.donnees.callbackDone) {
          this.donnees.callbackDone({
            requete: this,
            progression: this.progression,
            erreurSession: lErreurSession,
            callback: this.donnees.callback,
          });
        }
        if (this.donnees.callback) {
          this.donnees.callback(this.progression);
        }
        IEHtml.refresh();
      }
      _sendNextFile() {
        if (this.progression.listeFichiersEnAttente.count() > 0) {
          const lFichier = this.progression.listeFichiersEnAttente.get(0);
          this.progression.listeFichiersEnAttente.remove(0);
          let lPromise = null;
          if (this.donnees.moduleMD5 && this.donnees.moduleMD5.calculMD5) {
            lPromise = this.donnees.moduleMD5.calculMD5({
              instance: this,
              fichier: lFichier,
              eventAjaxIOProgression: this._eventAjaxIOProgression,
            });
          }
          return Promise.resolve(lPromise)
            .then(
              (aMD5) => {
                return this._send(lFichier, aMD5);
              },
              () => {
                IE.log.addLog('Echec calcul md5 (erreur ou fichier trop gros)');
                return this._send(lFichier, '');
              },
            )
            .catch((aErreur) => {
              this.progression.error = {
                abort: true,
                message: ObjetTraduction_1.GTraductions.getValeur(
                  'inputFile.msgEnvoiFichierAnnule',
                ),
              };
            })
            .then(() => {
              return this._doneFile(lFichier);
            });
        } else {
          this._doneAll();
        }
      }
    }
    exports.ObjetRequeteUploadFile = ObjetRequeteUploadFile;
  },
  fn: 'objetrequeteuploadfile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ModuleMD5_RequeteUploadFile = void 0;
    require('DeclarationForge');
    const ObjetTraduction_1 = require('ObjetTraduction');
    function _toBinaryString(aParams) {
      return new Promise((aResolve) => {
        const lChunk = 100 * 1024;
        if (aParams.start >= aParams.bytes.length) {
          aParams.done = true;
        } else {
          aParams.tabResult.push(
            String.fromCharCode.apply(
              null,
              aParams.bytes.slice(aParams.start, aParams.start + lChunk),
            ),
          );
        }
        aParams.eventAjaxIOProgression.call(aParams.instance, {
          message: ObjetTraduction_1.GTraductions.getValeur(
            'inputFile.msgPreparationFichier',
          ),
          pourcent: Math.round(
            (aParams.compteur * lChunk) / (aParams.bytes.length * 100 * 1024),
          ),
          md5: true,
        });
        aParams.start += lChunk;
        aParams.compteur += 1;
        setTimeout(() => {
          aResolve(aParams);
        }, 0);
      });
    }
    function _toBinaryStringPromise(aParams) {
      return _toBinaryString(aParams).then(() => {
        if (!aParams.done) {
          return _toBinaryStringPromise(aParams);
        }
      });
    }
    exports.ModuleMD5_RequeteUploadFile = {
      calculMD5(aParams) {
        const lParams = Object.assign(
          {
            instance: null,
            fichier: null,
            eventAjaxIOProgression: null,
            maxSizePourMD5: 30 * 1024 * 1024,
          },
          aParams,
        );
        return new Promise((aResolve, aReject) => {
          if (!window.FileReader || !window.Uint8Array) {
            IE.log.addLog(
              'FileReader ou Uint8Array non supporté => pas de controle de MD5',
            );
            aReject();
            return;
          }
          if (lParams.fichier.file.size > lParams.maxSizePourMD5) {
            IE.log.addLog('Fichier trop gros pur calculer le MD5');
            aReject();
            return;
          }
          try {
            lParams.eventAjaxIOProgression.call(lParams.instance, {
              message: ObjetTraduction_1.GTraductions.getValeur(
                'inputFile.msgPreparationFichier',
              ),
            });
            const lReader = new FileReader();
            lReader.onload = function () {
              try {
                const lParamsReader = Object.assign(
                  {
                    bytes: new Uint8Array(lReader.result),
                    tabResult: [],
                    start: 0,
                    compteur: 0,
                  },
                  lParams,
                );
                if (!lParamsReader.bytes.slice) {
                  lParamsReader.bytes = Array.from(lParamsReader.bytes);
                }
                _toBinaryStringPromise(lParamsReader).then(
                  () => {
                    let lMd5 = '';
                    if (lParamsReader.done) {
                      lMd5 = forge.md.md5
                        .create()
                        .update(lParamsReader.tabResult.join(''))
                        .digest()
                        .toHex();
                    }
                    aResolve(lMd5);
                  },
                  () => {
                    aReject();
                  },
                );
              } catch (e) {}
            }.bind(lParams.instance);
            lReader.onerror = function () {
              aReject();
            }.bind(lParams.instance);
            lReader.readAsArrayBuffer(lParams.fichier.file);
          } catch (e) {
            aReject();
          }
        });
      },
    };
  },
  fn: 'modulemd5_requeteuploadfile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.CommunicationProduit = void 0;
    require('Divers');
    require('DeclarationForge');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const Enumere_Cryptage_1 = require('Enumere_Cryptage');
    const Enumere_IdsRequeteAjax_1 = require('Enumere_IdsRequeteAjax');
    const ObjetCryptage_1 = require('ObjetCryptage');
    const ObjetRequete_1 = require('ObjetRequete');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetJSON_1 = require('ObjetJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const ObjetRequeteUploadFile_1 = require('ObjetRequeteUploadFile');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const TypeEtatRequeteAjax_1 = require('TypeEtatRequeteAjax');
    const ModuleMD5_RequeteUploadFile_1 = require('ModuleMD5_RequeteUploadFile');
    CollectionRequetes_1.Requetes.inscrire(
      'annulation',
      ObjetRequeteJSON_1.ObjetRequeteConsultation,
    );
    class CommunicationProduit {
      constructor(AGenreEspace, aNumeroSession) {
        this.nom = 'GCommunication';
        this._pileTimerEnAttente = {};
        this._attenteEnCours = false;
        this.FDureeEnCours = 1000 * 0.5;
        this._dureeTimerPresence = CommunicationProduit.cDureeTimerPresence;
        this.GenreEspace = AGenreEspace;
        this.NomRequete = 'appelfonction';
        this.pileRequetes = [];
        this.compteurRequete = 0;
        this.NumeroDeSession = aNumeroSession ? aNumeroSession : '0';
        this.NumeroOrdreCommunication = 1;
        this.cleAES = new forge.util.ByteBuffer();
        this.ivAES = new forge.util.ByteBuffer();
        this.ivAESTemp = new forge.util.ByteBuffer(forge.random.generate(16));
        this.backupAjax = {
          nbBackupEchec: 20,
          delaiTimeoutEchecReseau: 30 * 60 * 1000,
          delaiRepetitionEchecReseau: 3 * 1000,
        };
        this.polling = {
          nbRequetes: 0,
          numeroOrdre: 1,
          nbRepetitionEchecReseau: 15,
          delaiRepetitionEchecReseau: 3000,
          delaiTimeoutEchecReseau: 30 * 60 * 1000,
          delaiTimeoutRequete: 10 * 60 * 1000,
        };
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.modificationPresenceUtilisateur,
          this._modificationPresenceUtilisateur.bind(this),
        );
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.interruption_Requete,
          this._eventInterruptionRequete.bind(this),
        );
        window.addEventListener(
          'pagehide',
          this._requeteBeaconDeconnexion.bind(this),
        );
      }
      getNom() {
        return this.nom;
      }
      setNom(aNom) {
        this.nom = aNom;
      }
      arreter() {
        if (this.estArrete) {
          return;
        }
        this._requeteBeaconDeconnexion();
        clearTimeout(this._timeoutRequeteBackup);
        this.estArrete = true;
        this.desactiverPresence();
        delete this.ivAES;
        delete this.cleAES;
        delete this.NumeroOrdreCommunication;
      }
      getIvAES() {
        return this.ivAES;
      }
      setIvAES() {
        this.ivAES = this.ivAESTemp;
        delete this.ivAESTemp;
      }
      setCleAES(aCleAES) {
        this.cleAES = aCleAES;
      }
      appelFonctionAsynchroneXML(aParametres) {
        if (this.estArrete) {
          return;
        }
        const lParametresAppel = {
          nom: '',
          json: {},
          callbackPere: null,
          callbackEvenement: null,
          requetePrioritaire: false,
          sansBlocageInterface: false,
          messageDetail: '',
          estBackup: false,
          backupDataJSON: null,
        };
        $.extend(lParametresAppel, aParametres);
        let lRequeteUpload = null;
        const lParamsRequete = {
          numeroSession: this.NumeroDeSession,
          numeroRequete: this.compteurRequete,
          nomRequete: this.NomRequete,
          genreEspace: this.GenreEspace,
          sansBlocageInterface: lParametresAppel.sansBlocageInterface === true,
          nomDeFonction: lParametresAppel.nom,
          callBackReadyStateChange: this._evenementSurReponseRequete.bind(
            this,
            lParametresAppel,
          ),
          pereReponse: lParametresAppel.callbackPere,
          evenementReponse: lParametresAppel.callbackEvenement,
          messageDetail: lParametresAppel.messageDetail,
          log: { tailleDonnees: '', tempsChiffre: '' },
        };
        if (!lParametresAppel.estBackup) {
          const lJSONCollection = {};
          lParametresAppel.json = ObjetJSON_1.ObjetJSON.preparerJSON(
            lParametresAppel.json,
            { JSONCollection: lJSONCollection },
          );
          if (
            lParametresAppel.paramsUpload &&
            lParametresAppel.paramsUpload.listeFichiers
          ) {
            lRequeteUpload = this._factoryRequeteUploadFile(
              Object.assign(
                { nomRequete: lParametresAppel.nom },
                lParametresAppel.paramsUpload,
              ),
            );
            if (!lRequeteUpload.estVide()) {
              this.pileRequetes.push(lRequeteUpload);
              this._envoieRequete();
            } else {
              lRequeteUpload = null;
            }
          }
          const lResultJSON = this._traiterJSONEnvoi(lParametresAppel.json);
          Object.assign(lParamsRequete, {
            parametres: lResultJSON.JSON,
            jsonOrigine: lParametresAppel.json,
            jsonNonSecurise: $.isEmptyObject(lJSONCollection)
              ? null
              : lJSONCollection,
            log: {
              tailleDonnees: lResultJSON.JSONStr_clair.length,
              tempsChiffre: lResultJSON.chronoStr,
            },
          });
        } else {
          Object.assign(lParamsRequete, {
            estBackup: true,
            dataPOST: lParametresAppel.backupDataJSON,
          });
        }
        const lRequete = new ObjetRequete_1.ObjetRequete(lParamsRequete);
        if (lParametresAppel.estBackup) {
          this.pileRequetes.splice(0, 0, lRequete);
        } else if (lParametresAppel.requetePrioritaire && !lRequeteUpload) {
          this.pileRequetes.splice(1, 0, lRequete);
        } else {
          this.pileRequetes.push(lRequete);
        }
        this.compteurRequete += 1;
        if (lRequeteUpload) {
          lRequeteUpload.requeteSaisieApresUpload = lRequete;
        }
        this._envoieRequete();
        return lRequete;
      }
      setMAJServeurEnCours(aMAJEnCours) {
        this._MAJServeurEnCours = aMAJEnCours;
        if (this._requetePresenceActive) {
          this._requetePresenceDelai();
        }
      }
      activerPresence() {
        this._requetePresenceActive = true;
        this._requetePresenceDelai();
        this._envoiRequetePolling();
      }
      desactiverPresence() {
        this._requetePresenceActive = false;
        window.clearTimeout(this.timerPresence);
      }
      setDureeTimerPresence(aDureeMs) {
        this._dureeTimerPresence = aDureeMs;
        if (this._requetePresenceActive) {
          this._requetePresenceDelai();
        }
      }
      requeteEnCours() {
        return (
          (this.pileRequetes[0] && this.pileRequetes[0].enAttente()) ||
          this._attenteEnCours
        );
      }
      composeUrlFichier(aPrefix, aNomFichier, aParam) {
        let lResult = '';
        if (aPrefix !== '') {
          lResult += aPrefix + '/';
        }
        lResult += this.getChaineChiffreeAES(
          JSON.stringify(
            aParam && aParam.toJSONAll ? aParam.toJSONAll() : aParam,
          ),
        );
        lResult += '/' + aNomFichier;
        lResult += '?Session=' + this.NumeroDeSession;
        if (aParam.miniature !== null && aParam.miniature !== undefined) {
          lResult += '&miniature=' + aParam.miniature;
        }
        return lResult;
      }
      composeUrlFichierExterne(aNomFichier, aParam) {
        return this.composeUrlFichier(
          'FichiersExternes',
          ObjetChaine_1.GChaine.enleverEntites(aNomFichier),
          aParam,
        );
      }
      getChaineChiffreeAES(aChaine) {
        return ObjetCryptage_1.GCryptage.encrypter({
          genreCryptage: Enumere_Cryptage_1.EGenreCryptage.AES,
          chaine: aChaine,
          cle: this.cleAES,
          iv: this.ivAES,
        });
      }
      getChaineDechiffreeAES(aChaine) {
        return ObjetCryptage_1.GCryptage.decrypter({
          genreCryptage: Enumere_Cryptage_1.EGenreCryptage.AES,
          chaine: aChaine,
          cle: this.cleAES,
          iv: this.ivAES,
        });
      }
      serialiserIVAESPourSeveur() {
        if (CommunicationProduit.optionsSecurite.http) {
          return ObjetCryptage_1.GCryptage.getCryptageRSA().encrypter1024(
            this.ivAESTemp,
          );
        }
        return forge.util.encode64(this.ivAESTemp.bytes(), 64);
      }
      sendLogClient(aMessage) {
        if (aMessage && navigator && navigator.sendBeacon) {
          try {
            navigator.sendBeacon(
              'LogClientLeger',
              ObjetJSON_1.ObjetJSON.toJSON({
                ns: parseInt(this.NumeroDeSession, 10),
                msg: aMessage,
              }),
            );
          } catch (e) {}
        }
      }
      startPolling() {
        this._envoiRequetePolling();
      }
      _traiterJSONEnvoi(aJSON) {
        const lResult = { JSON: aJSON, JSONStr_clair: '', chronoStr: '' };
        if (!aJSON) {
          return lResult;
        }
        const lSecurise = !CommunicationProduit.optionsSecurite.sansCryptageAES;
        let lChrono;
        if (lSecurise) {
          if (
            IE.log &&
            IE.log.getActifRequete &&
            IE.log.getActifRequete() &&
            Chronometre_1.Chronometre
          ) {
            lChrono = new Chronometre_1.Chronometre();
          }
          lResult.JSONStr_clair = JSON.stringify(lResult.JSON) || '';
          lResult.JSON = ObjetCryptage_1.GCryptage.encrypter({
            genreCryptage: lSecurise
              ? Enumere_Cryptage_1.EGenreCryptage.AES
              : Enumere_Cryptage_1.EGenreCryptage.Unicode,
            chaine: lResult.JSONStr_clair,
            cle: this.cleAES,
            iv: lSecurise ? this.ivAES : null,
            avecCompression:
              lSecurise &&
              !CommunicationProduit.optionsSecurite.sansCompressionAES,
          });
          if (lChrono) {
            lResult.chronoStr = lChrono.toString();
          }
        } else {
        }
        return lResult;
      }
      _factoryRequeteUploadFile(aDonnees) {
        const lDonnees = Object.assign(
          {
            listeFichiers: null,
            moduleMD5:
              ModuleMD5_RequeteUploadFile_1.ModuleMD5_RequeteUploadFile,
            conserverIdFichier: false,
            filtreFichiers: function (D) {
              return (
                !!D &&
                (D.getEtat() === Enumere_Etat_1.EGenreEtat.Creation ||
                  D.getEtat() === Enumere_Etat_1.EGenreEtat.Modification) &&
                D.existe() &&
                D.idFichier !== CommunicationProduit.c_IdFichierAIgnorer &&
                D.idFichier !== undefined &&
                !!D.file
              );
            },
            getFormData: (aFichier) => {
              return {
                numeroOrdre: this.getChaineChiffreeAES(
                  this.NumeroOrdreCommunication,
                ),
                numeroSession: this.NumeroDeSession,
                nomRequete: lDonnees.nomRequete,
                idFichier: aFichier.idFichier,
              };
            },
            getUrl: () => {
              return ObjetChaine_1.GChaine.format('%s/%s/%s', [
                'uploadfilesession',
                this.GenreEspace,
                this.NumeroDeSession,
              ]);
            },
            callbackInterrupt: function () {
              (0, CollectionRequetes_1.Requetes)('annulation')
                .setOptions({ requetePrioritaire: true })
                .lancerRequete({ annulationUpload: true });
            },
            callbackEach: (aJSON) => {
              let lNumeroOrdre = null;
              try {
                if (aJSON && aJSON.numeroOrdre) {
                  lNumeroOrdre = parseInt(
                    ObjetCryptage_1.GCryptage.decrypter({
                      genreCryptage: Enumere_Cryptage_1.EGenreCryptage.AES,
                      chaine: aJSON.numeroOrdre,
                      cle: this.cleAES,
                      iv: this.ivAES,
                    }),
                    10,
                  );
                }
              } catch (e) {}
              if (lNumeroOrdre !== this.NumeroOrdreCommunication + 1) {
                return this._getErreurConnexionInterrompue();
              } else {
                this.NumeroOrdreCommunication += 2;
              }
              return null;
            },
            callbackDone: (aParams) => {
              if (aParams.erreurSession) {
                this._composePageErreur(aParams.erreurSession);
                return;
              }
              if (
                aParams.requete &&
                aParams.requete.requeteSaisieApresUpload &&
                aParams.requete.requeteSaisieApresUpload.etat ===
                  TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.initial &&
                aParams.progression.error &&
                (aParams.requete.donnees.annulerSurErreurUpload ||
                  (aParams.progression.error.abort &&
                    aParams.requete.donnees.annulerSurAbortUpload))
              ) {
                aParams.requete.requeteSaisieApresUpload.estRequeteAnnulee = true;
              }
              if (
                aParams.requete.estUploadFile &&
                aParams.requete.enAttente()
              ) {
                this._setRequeteEtatTermine(aParams.requete);
              } else {
              }
              if (!CommunicationProduit.optionsSecurite.avecPollingActif) {
                this.activerPresence();
              }
              this._envoieRequete();
            },
          },
          aDonnees,
        );
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        if (lDonnees.listeFichiers && lDonnees.listeFichiers.parcourir) {
          lDonnees.listeFichiers.parcourir((D) => {
            if (lDonnees.filtreFichiers && lDonnees.filtreFichiers(D)) {
              const lElement = MethodesObjet_1.MethodesObjet.dupliquer(D);
              lElement.file = D.file;
              lListe.addElement(lElement);
              if (!lDonnees.conserverIdFichier) {
                D.idFichier = CommunicationProduit.c_IdFichierAIgnorer;
              }
            }
          });
        }
        lDonnees.listeFichiers = lListe;
        return new ObjetRequeteUploadFile_1.ObjetRequeteUploadFile(lDonnees);
      }
      _envoieRequete() {
        clearTimeout(this._timeoutRequeteBackup);
        const lRequete = this.pileRequetes[0];
        if (!lRequete) {
          return;
        }
        const lEstRequeteAjax = lRequete instanceof ObjetRequete_1.ObjetRequete;
        const lEstRequeteUpload =
          lRequete instanceof ObjetRequeteUploadFile_1.ObjetRequeteUploadFile;
        if (
          lRequete.estRequeteAnnulee &&
          !lRequete.enAttente() &&
          lEstRequeteAjax
        ) {
          this._surReception(lRequete, null, { annulationRequete: true });
          return;
        }
        if (!lRequete.enAttente()) {
          lRequete.etat =
            TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.preparationEnvoi;
          if (
            !this._attenteEnCours &&
            (lEstRequeteUpload ||
              (lEstRequeteAjax &&
                (!lRequete.Parametres ||
                  !lRequete.Parametres.sansBlocageInterface)))
          ) {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.eventIOAjax,
              {
                emission: true,
                upload: !lRequete.estUneRequete,
                message: lEstRequeteAjax
                  ? lRequete.Parametres.messageDetail
                  : null,
                delai:
                  this.pileRequetes.length > 1 ||
                  (lEstRequeteAjax &&
                    lRequete.Parametres &&
                    lRequete.Parametres.estBackup)
                    ? 0
                    : null,
              },
            );
          }
          if (lRequete.estUneRequete && lEstRequeteAjax) {
            lRequete.envoieRequete({
              numeroOrdre: this.NumeroOrdreCommunication,
              numeroOrdreChiffre: this.getChaineChiffreeAES(
                this.NumeroOrdreCommunication,
              ),
            });
          } else if (lRequete.estUploadFile && lEstRequeteUpload) {
            if (!CommunicationProduit.optionsSecurite.avecPollingActif) {
              this.desactiverPresence();
            }
            lRequete.envoiRequete();
          } else {
          }
        } else {
          if (
            lRequete &&
            lEstRequeteAjax &&
            lRequete.etat ===
              TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.envoye &&
            !this._attenteEnCours &&
            lRequete.Parametres &&
            lRequete.Parametres.sansBlocageInterface
          ) {
            let lAvecBlocageEnAttente = false;
            this.pileRequetes.every((aRequete, aIndex) => {
              if (
                aRequete &&
                (aRequete instanceof
                  ObjetRequeteUploadFile_1.ObjetRequeteUploadFile ||
                  (aRequete instanceof ObjetRequete_1.ObjetRequete &&
                    (!aRequete.Parametres ||
                      !aRequete.Parametres.sansBlocageInterface)))
              ) {
                lAvecBlocageEnAttente = true;
                this.pileRequetes.every((aRequete, aIndex2) => {
                  if (
                    aRequete &&
                    aRequete instanceof ObjetRequete_1.ObjetRequete &&
                    aRequete.Parametres &&
                    aRequete.Parametres.sansBlocageInterface
                  ) {
                    aRequete.Parametres.sansBlocageInterface = false;
                  }
                  return aIndex2 < aIndex;
                });
                return false;
              }
              return true;
            });
            if (lAvecBlocageEnAttente) {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.eventIOAjax,
                { emission: true, upload: false, delai: 0 },
              );
            }
          }
        }
      }
      _getErreurConnexionInterrompue() {
        return {
          Titre: '',
          Message: ObjetTraduction_1.GTraductions.getValeur(
            'connexion.ErreurConnexionInterrompue',
          ),
        };
      }
      _getXmlReponseStatut200(ARequete, AReponse, aJSON, aSurPolling) {
        if (this.estArrete) {
          return;
        }
        const lNumeroSession =
          aJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.numeroSession];
        const lNumeroOrdre =
          aJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.numeroOrdre];
        const lDonneesSecurisees =
          aJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.donneesSecurisee];
        const lSecurise = !CommunicationProduit.optionsSecurite.sansCryptageAES;
        let lNomRequete =
          aJSON[Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.nomFonction] +
          'Reponse';
        const lErreur = this._getErreurConnexionInterrompue();
        if (aSurPolling) {
          lNomRequete = 'pollingReponse';
        }
        if (
          parseInt(this.NumeroDeSession, 10) !== lNumeroSession &&
          lNumeroSession !== 0
        ) {
          if (!aJSON.Erreur) {
            aJSON.Erreur = lErreur;
          }
          return null;
        }
        const lNumOrdreServeur = parseInt(
          ObjetCryptage_1.GCryptage.decrypter({
            genreCryptage: Enumere_Cryptage_1.EGenreCryptage.AES,
            chaine: lNumeroOrdre,
            cle: this.cleAES,
            iv: this.ivAES,
          }),
          10,
        );
        let lEstErreurNumeroOrdre = false;
        if (aSurPolling) {
          lEstErreurNumeroOrdre =
            lNumOrdreServeur !== this.polling.numeroOrdre - 1;
        } else {
          lEstErreurNumeroOrdre =
            lNumOrdreServeur !== this.NumeroOrdreCommunication + 1;
        }
        if (lEstErreurNumeroOrdre) {
          if (!aJSON.Erreur) {
            aJSON.Erreur = lErreur;
          }
          return null;
        }
        if (!aSurPolling) {
          this.NumeroOrdreCommunication += 2;
        }
        let lChrono;
        let lChronoTrait = '';
        if (lSecurise) {
          if (
            IE.log &&
            IE.log.getActifRequete &&
            IE.log.getActifRequete() &&
            Chronometre_1.Chronometre
          ) {
            lChrono = new Chronometre_1.Chronometre();
          }
          const lReponse = ObjetCryptage_1.GCryptage.decrypter({
            genreCryptage: CommunicationProduit.optionsSecurite.sansCryptageAES
              ? Enumere_Cryptage_1.EGenreCryptage.Unicode
              : Enumere_Cryptage_1.EGenreCryptage.AES,
            chaine: lDonneesSecurisees,
            cle: this.cleAES,
            iv: this.ivAES,
            avecCompression:
              !CommunicationProduit.optionsSecurite.sansCompressionAES,
          });
          aJSON.donnees = ObjetJSON_1.ObjetJSON.parseJSON(lReponse);
          if (lChrono && IE.log.getActifRequete()) {
            lChronoTrait = lChrono.toString();
          }
        } else {
          aJSON.donnees = lDonneesSecurisees;
        }
        delete aJSON[
          Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.donneesSecurisee
        ];
        if (!aJSON.donnees) {
          aJSON.Erreur = lErreur;
          return null;
        }
        aJSON.donnees = ObjetJSON_1.ObjetJSON.parseVariables(aJSON.donnees, {
          JSONCollection:
            aJSON[
              Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.donneesNonSecurisee
            ],
        });
        try {
          if (IE.log.getActifRequete()) {
            let lChronoServeur = null;
            let lChronoSaisieMs;
            let lEstAttente = false;
            IE.log.addRequete({
              nomRequete: lNomRequete,
              numeroRequete: ARequete.Parametres.numeroRequete,
              numeroOrdre: aSurPolling
                ? this.polling.numeroOrdre
                : this.NumeroOrdreCommunication - 1,
              chrono: {
                requeteServeurtickMs: lChronoServeur,
                traitement: lChronoTrait,
                saisieMS: lChronoSaisieMs,
              },
              estReponse: true,
              lgcontenu: AReponse.length,
              estPolling: ARequete.Parametres.estPolling,
              estAttente: lEstAttente,
            });
          }
        } catch (e) {}
      }
      _evenementSurReponseRequete(
        aParametresAppel,
        ARequete,
        AReponse,
        AStatut,
      ) {
        this._traiterPileAttenteSurReponseRequete(ARequete);
        clearTimeout(this._timeoutRequeteBackup);
        const lStatut =
          typeof AStatut === 'number' ? AStatut : parseInt(AStatut, 10);
        switch (lStatut) {
          case 200: {
            if (aParametresAppel.estRequeteDeconnexion) {
              this._requeteDeconnexionEnvoyee = true;
            }
            const lJSONReseau = ObjetJSON_1.ObjetJSON.parseJSON(AReponse);
            if (!lJSONReseau) {
              this._composePageErreur(this._getErreurConnexionInterrompue());
              return;
            } else {
              this._getXmlReponseStatut200(ARequete, AReponse, lJSONReseau);
            }
            if (
              lJSONReseau.Erreur ||
              (lJSONReseau.donnees && lJSONReseau.donnees.Erreur)
            ) {
              this._composePageErreur(
                lJSONReseau.Erreur
                  ? lJSONReseau.Erreur
                  : lJSONReseau.donnees.Erreur,
              );
            } else {
              const lJSONAttente =
                lJSONReseau.donnees[
                  Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.SignatureAttente
                ];
              const lParametresAttente = lJSONAttente
                ? this._recupererParametresAttente(lJSONAttente.Parametres)
                : {};
              if (lJSONAttente) {
                if (!lParametresAttente.sansBlocageInterface) {
                  this._attenteEnCours = !!lJSONAttente;
                }
              } else {
                this._attenteEnCours = false;
              }
              if (this._attenteEnCours) {
                if (ARequete.Parametres.sansBlocageInterface) {
                  Invocateur_1.Invocateur.evenement(
                    Invocateur_1.ObjetInvocateur.events.eventIOAjax,
                    {
                      emission: true,
                      upload: false,
                      message: ARequete.Parametres.messageDetail,
                    },
                  );
                  delete ARequete.Parametres.sansBlocageInterface;
                }
                this._declencherAttente({
                  JSONAttente: lJSONAttente,
                  requeteModele: ARequete,
                  parametresAttente: lParametresAttente,
                });
              } else {
                if (!ARequete.Parametres.sansBlocageInterface) {
                  Invocateur_1.Invocateur.evenement(
                    Invocateur_1.ObjetInvocateur.events.eventIOAjax,
                    { emission: false },
                  );
                }
                if (lJSONAttente && lParametresAttente.sansBlocageInterface) {
                  this._declencherAttente({
                    JSONAttente: lJSONAttente,
                    requeteModele: ARequete,
                    parametresAttente: lParametresAttente,
                  });
                  if (lParametresAttente.deserialisation) {
                    this._surReception(ARequete, lJSONReseau);
                  } else {
                    this._setRequeteEtatTermine(ARequete);
                    this._envoieRequete();
                  }
                } else {
                  this._surReception(ARequete, lJSONReseau);
                }
              }
            }
            break;
          }
          default: {
            IE.log.addLog(
              'échec requête ajax. requête = ' +
                ARequete +
                '. statut = ' +
                AStatut,
            );
            if (this._renvoyerRequeteSurErreur(ARequete, lStatut)) {
              return;
            }
            if (!window.GApplication || !GApplication._unloadEnCours) {
              let lMessage = `erreur ajax - requete : ${ARequete} - statut : ${AStatut}`;
              if (ARequete.Parametres && ARequete.Parametres.estBackup) {
                lMessage += ' (backup)';
              }
              this.sendLogClient(lMessage);
            }
            this._composePageErreur(null, AStatut);
            break;
          }
        }
      }
      _renvoyerRequeteSurErreur(aRequete, aStatut) {
        clearTimeout(this._timeoutRequeteBackup);
        if (
          this.estArrete ||
          !aRequete ||
          !aRequete.backupDataJSON ||
          !aRequete.Parametres
        ) {
          return false;
        }
        if (aStatut !== 0 && !aRequete.Parametres.DEBUG_decoSimule) {
          return false;
        }
        if (aRequete.nbBackup > this.backupAjax.nbBackupEchec) {
          return false;
        }
        if (
          aRequete.nbBackup >= 4 &&
          aRequete.timeDebutBackup &&
          Date.now() - aRequete.timeDebutBackup >
            this.backupAjax.delaiTimeoutEchecReseau
        ) {
          return false;
        }
        this._timeoutRequeteBackup = setTimeout(() => {
          if (!aRequete.Parametres.sansBlocageInterface) {
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.eventIOAjax,
              { emission: false },
            );
          }
          if (this.estArrete) {
            return;
          }
          this._setRequeteEtatTermine(aRequete);
          const lRequeteBackup = this.appelFonctionAsynchroneXML({
            estBackup: true,
            backupDataJSON: aRequete.backupDataJSON,
            json: null,
            nom: aRequete.Parametres.nomDeFonction,
            callbackPere: aRequete.Parametres.pereReponse,
            callbackEvenement: aRequete.Parametres.evenementReponse,
            messageDetail:
              aRequete.nbBackup > 3
                ? ObjetTraduction_1.GTraductions.getValeur(
                    'requete.ConnexionPerdue',
                  )
                : aRequete.Parametres.messageDetail,
            sansBlocageInterface: false,
          });
          if (!aRequete.timeDebutBackup) {
            lRequeteBackup.nbBackup = 1;
            lRequeteBackup.timeDebutBackup = Date.now();
          } else {
            lRequeteBackup.nbBackup = aRequete.nbBackup + 1;
            lRequeteBackup.timeDebutBackup = aRequete.timeDebutBackup;
          }
        }, this.backupAjax.delaiRepetitionEchecReseau);
        return true;
      }
      _declencherAttente(aParametres) {
        const lParametres = {
          JSONAttente: null,
          requeteModele: null,
          parametresAttente: {},
        };
        $.extend(lParametres, aParametres);
        if (!lParametres.parametresAttente.sansBlocageInterface) {
          window.clearTimeout(this.Timer);
          this.Timer = setTimeout(
            this._repeterRequeteAttente.bind(this, lParametres),
            lParametres.parametresAttente.delai,
          );
        } else {
          const lNomFunction =
            lParametres.requeteModele.Parametres.nomDeFonction;
          if (this._pileTimerEnAttente[lNomFunction]) {
            if (this._pileTimerEnAttente[lNomFunction].timer) {
              clearTimeout(this._pileTimerEnAttente[lNomFunction].timer);
            }
            delete this._pileTimerEnAttente[lNomFunction];
          }
          if (lParametres.requeteModele.__interruptionReponse) {
            delete lParametres.requeteModele.__interruptionReponse;
            return;
          }
          const lTimer = setTimeout(
            this._repeterRequeteAttente.bind(this, lParametres),
            lParametres.parametresAttente.delai,
          );
          this._pileTimerEnAttente[lNomFunction] = { timer: lTimer };
        }
      }
      _repeterRequeteAttente(aParametres) {
        let lJSON;
        const lNomRequete = aParametres.requeteModele.Parametres.nomDeFonction;
        if (aParametres.parametresAttente.repeterRequete) {
          lJSON = aParametres.requeteModele.Parametres.jsonOrigine;
          if (
            !(
              lJSON &&
              lJSON[
                Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.SignatureAttente
              ]
            ) &&
            aParametres.JSONAttente
          ) {
            lJSON[
              Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.SignatureAttente
            ] = MethodesObjet_1.MethodesObjet.dupliquer(
              aParametres.JSONAttente,
            );
          }
        } else {
          lJSON = {};
          if (aParametres.JSONAttente) {
            lJSON[
              Enumere_IdsRequeteAjax_1.EGenreIdsRequeteAjax.SignatureAttente
            ] = MethodesObjet_1.MethodesObjet.dupliquer(
              aParametres.JSONAttente,
            );
          }
        }
        this._setRequeteEtatTermine(aParametres.requeteModele);
        const lRequete = this.appelFonctionAsynchroneXML({
          nom: lNomRequete,
          json: lJSON,
          callbackPere: aParametres.requeteModele.Parametres.pereReponse,
          callbackEvenement:
            aParametres.requeteModele.Parametres.evenementReponse,
          requetePrioritaire:
            !aParametres.parametresAttente.sansBlocageInterface,
          sansBlocageInterface:
            aParametres.parametresAttente.sansBlocageInterface,
        });
        if (aParametres.parametresAttente.sansBlocageInterface) {
          lRequete.__estUneAttenteNonBloquante = true;
          this._pileTimerEnAttente[lRequete.Parametres.nomDeFonction].requete =
            lRequete;
        }
      }
      _traiterPileAttenteSurReponseRequete(aRequete) {
        if (aRequete && aRequete.__estUneAttenteNonBloquante) {
          const lNomRequete = aRequete.Parametres.nomDeFonction;
          if (this._pileTimerEnAttente[lNomRequete]) {
            if (this._pileTimerEnAttente[lNomRequete].timer) {
              clearTimeout(this._pileTimerEnAttente[lNomRequete].timer);
            }
            delete this._pileTimerEnAttente[lNomRequete];
          }
          delete aRequete.__estUneAttenteNonBloquante;
        }
      }
      _eventInterruptionRequete(aParametres) {
        if (this.estArrete) {
          return;
        }
        const lParametres = { nomRequete: '' };
        $.extend(lParametres, aParametres);
        if (
          lParametres.nomRequete &&
          this._pileTimerEnAttente[lParametres.nomRequete]
        ) {
          if (this._pileTimerEnAttente[lParametres.nomRequete].timer) {
            clearTimeout(
              this._pileTimerEnAttente[lParametres.nomRequete].timer,
            );
            delete this._pileTimerEnAttente[lParametres.nomRequete].timer;
          }
          if (this._pileTimerEnAttente[lParametres.nomRequete].requete) {
            this._pileTimerEnAttente[
              lParametres.nomRequete
            ].requete.__interruptionReponse = true;
          } else {
            delete this._pileTimerEnAttente[lParametres.nomRequete];
          }
          IE.log.addLog(
            'requete en attente : [' + lParametres.nomRequete + '] interrompu',
          );
        }
      }
      _recupererParametresAttente(aParametres) {
        const lParametres = {
          sansBlocageInterface: false,
          delai: this.FDureeEnCours,
          repeterRequete: false,
          deserialisation: false,
          date: null,
        };
        if (aParametres) {
          if (aParametres.sansBlocageInterface) {
            lParametres.sansBlocageInterface = true;
          }
          if (aParametres.delai && aParametres.delai > 0) {
            lParametres.delai = aParametres.delai * 1000;
          }
          if (aParametres.repeterRequete) {
            lParametres.repeterRequete = true;
          }
          if (aParametres.date) {
            lParametres.date = aParametres.date;
          }
          if (aParametres.deserialisation) {
            lParametres.deserialisation = aParametres.deserialisation;
          }
        }
        return lParametres;
      }
      _setRequeteEtatTermine(aRequete) {
        if (aRequete) {
          aRequete.etat = TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.termine;
          this.pileRequetes = this.pileRequetes.filter((aRequete, aIndex) => {
            return (
              !!aRequete &&
              aRequete.etat !==
                TypeEtatRequeteAjax_1.TypeEtatRequeteAjax.termine
            );
          });
        }
        this._requetePresenceDelai();
      }
      _surReception(aRequete, aJSON, aDonneesEchec) {
        this._setRequeteEtatTermine(aRequete);
        this._envoieRequete();
        if (
          aRequete.Parametres.pereReponse &&
          aRequete.Parametres.evenementReponse
        ) {
          aRequete.Parametres.evenementReponse.call(
            aRequete.Parametres.pereReponse,
            aJSON ? aJSON.donnees : {},
            aDonneesEchec,
          );
        }
      }
      _composePageErreur(aJSONErreur, aStatut) {
        const lParametres = {
          constructionPage: true,
          statut: aStatut,
          jsonErreur: aJSONErreur,
        };
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.erreurCommunication,
          lParametres,
        );
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.fermerFenetres,
          true,
        );
      }
      _requeteBeaconDeconnexion() {
        if (
          navigator &&
          navigator.sendBeacon &&
          !this.estArrete &&
          this.NumeroOrdreCommunication > 0 &&
          !this._requeteDeconnexionEnvoyee
        ) {
          this._requeteDeconnexionEnvoyee = true;
          const lNumeroOrdre = this.getChaineChiffreeAES(
            this.NumeroOrdreCommunication,
          );
          if (lNumeroOrdre) {
            try {
              navigator.sendBeacon(
                'appeldeconnexion/' + lNumeroOrdre + '/' + new Date().getTime(),
                ObjetJSON_1.ObjetJSON.toJSON({
                  ns: parseInt(this.NumeroDeSession, 10),
                  no: lNumeroOrdre,
                }),
              );
            } catch (e) {}
          }
        }
      }
      _requetePresenceDelai() {
        window.clearTimeout(this.timerPresence);
        this.timerPresence = setTimeout(
          this._requeteDePresence.bind(this),
          this._getDureeTimerPresence(),
        );
      }
      _getDureeTimerPresence() {
        return this._MAJServeurEnCours
          ? Math.min(
              CommunicationProduit.cDureeTimerPresenceMAJServeurEnCours,
              this._dureeTimerPresence,
            )
          : this._dureeTimerPresence;
      }
      _requeteDePresence() {
        if (CommunicationProduit.optionsSecurite.avecPollingActif) {
          return;
        }
        if (
          !this.requeteEnCours() &&
          this._requetePresenceActive &&
          this._requetePresenceEnPause !== true
        ) {
        }
        this._requetePresenceDelai();
      }
      _modificationPresenceUtilisateur(aPresenceUtilisateur) {
        if (this.estArrete) {
          return;
        }
        let lNomRequete;
        if (aPresenceUtilisateur) {
          delete this._requetePresenceEnPause;
          this._requeteDePresence();
          this._envoiRequetePolling({ presence: true });
        } else {
          this._requetePresenceEnPause = true;
          window.clearTimeout(this.timerPresence);
          for (lNomRequete in this._pileTimerEnAttente) {
            if (this._pileTimerEnAttente[lNomRequete]) {
              this._eventInterruptionRequete({ nomRequete: lNomRequete });
            }
          }
        }
      }
      _arretTimeoutsPolling() {
        if (this.polling.timeoutEchec) {
          clearTimeout(this.polling.timeoutEchec);
          this.polling.timeoutEchec = null;
        }
        if (this.polling.timeoutExpirationRequete) {
          clearTimeout(this.polling.timeoutExpirationRequete);
          this.polling.timeoutExpirationRequete = null;
        }
      }
      _envoiRequetePolling(aParams) {
        if (!CommunicationProduit.optionsSecurite.avecPollingActif) {
          return;
        }
        if (this.estArrete) {
          return;
        }
        const lParams = Object.assign({ presence: false }, aParams);
        this._arretTimeoutsPolling();
        if (this.polling.requeteEnCours) {
          if (!lParams.presence) {
            IE.log.addLog('Double envoi Polling');
          }
          return;
        }
        if (
          !this.polling.echecReseau &&
          (this._requetePresenceEnPause || !this._requetePresenceActive)
        ) {
          if (this.polling.messageDecoEnCours) {
            this.polling.messageDecoEnCours = false;
            Invocateur_1.Invocateur.evenement(
              Invocateur_1.ObjetInvocateur.events.eventIOAjax,
              { blocageDeconnexion: false },
            );
          }
          return;
        }
        let lJSONEnvoi = {};
        lJSONEnvoi = ObjetJSON_1.ObjetJSON.preparerJSON(lJSONEnvoi, {
          JSONCollection: {},
        });
        const lResultJSON = this._traiterJSONEnvoi(lJSONEnvoi);
        this.polling.requeteEnCours = new ObjetRequete_1.ObjetRequete({
          numeroSession: this.NumeroDeSession,
          numeroRequete: this.polling.nbRequetes,
          nomRequete: 'appelpolling',
          genreEspace: this.GenreEspace,
          nomDeFonction: 'polling',
          estPolling: true,
          parametres: lResultJSON.JSON,
          echecReseau: this.polling.echecReseau,
          callBackReadyStateChange: (aRequete, aReponse, aStatut) => {
            this.polling.requeteEnCours = null;
            this._arretTimeoutsPolling();
            if (this.estArrete) {
              return;
            }
            this.polling.nbRequetes += 1;
            const lStatut =
              typeof aStatut === 'number' ? aStatut : parseInt(aStatut, 10);
            switch (lStatut) {
              case 200: {
                this.polling.numeroOrdre += 1;
                delete this.polling.echecReseau;
                if (this.polling.messageDecoEnCours) {
                  this.polling.messageDecoEnCours = false;
                  Invocateur_1.Invocateur.evenement(
                    Invocateur_1.ObjetInvocateur.events.eventIOAjax,
                    { blocageDeconnexion: false },
                  );
                }
                const lJSONReseau = aReponse
                  ? ObjetJSON_1.ObjetJSON.parseJSON(aReponse)
                  : null;
                if (lJSONReseau) {
                  this._getXmlReponseStatut200(
                    aRequete,
                    aReponse,
                    lJSONReseau,
                    true,
                  );
                  if (
                    lJSONReseau.Erreur ||
                    (lJSONReseau.donnees && lJSONReseau.donnees.Erreur)
                  ) {
                    this._composePageErreur(
                      lJSONReseau.Erreur
                        ? lJSONReseau.Erreur
                        : lJSONReseau.donnees.Erreur,
                    );
                    return;
                  }
                  if (lJSONReseau.donnees) {
                    Invocateur_1.Invocateur.evenement(
                      'deserialisation_notificationsPolling',
                      lJSONReseau.donnees,
                    );
                  }
                }
                this._envoiRequetePolling();
                break;
              }
              default: {
                if (!this.polling.echecReseau) {
                  this.polling.echecReseau = {
                    nb: 0,
                    timeDebut: Date.now(),
                    log: '',
                  };
                }
                this.polling.echecReseau.nb += 1;
                if (
                  this.polling.echecReseau.nb >=
                    this.polling.nbRepetitionEchecReseau ||
                  (this.polling.echecReseau.timeDebut &&
                    this.polling.echecReseau.nb > 2 &&
                    Date.now() - this.polling.echecReseau.timeDebut >
                      this.polling.delaiTimeoutEchecReseau)
                ) {
                  if (
                    !global.GApplication ||
                    !global.GApplication._unloadEnCours
                  ) {
                    this.sendLogClient(`erreur polling - statut : ${aStatut}`);
                  }
                  IE.log.addLog(
                    'FIN SESSION : Echec requête polling. statut = ' + aStatut,
                  );
                  this._composePageErreur(null, aStatut);
                  return;
                }
                const lDateEchec = new Date();
                this.polling.echecReseau.log +=
                  (this.polling.echecReseau.log ? ' / ' : '') +
                  lDateEchec.getHours() +
                  ':' +
                  lDateEchec.getMinutes() +
                  ':' +
                  lDateEchec.getSeconds() +
                  ':' +
                  lDateEchec.getMilliseconds() +
                  ' -statut:' +
                  aStatut;
                if (
                  !this.polling.messageDecoEnCours &&
                  (this.polling.echecReseau.nb === 3 || lParams.presence)
                ) {
                  this.polling.messageDecoEnCours = true;
                  Invocateur_1.Invocateur.evenement(
                    Invocateur_1.ObjetInvocateur.events.eventIOAjax,
                    {
                      blocageDeconnexion: true,
                      message: ObjetTraduction_1.GTraductions.getValeur(
                        'requete.ConnexionPerdue',
                      ),
                    },
                  );
                }
                IE.log.addLog(
                  'Echec polling => rejeu requête polling. Statut = ' +
                    aStatut +
                    ' - nb:' +
                    this.polling.echecReseau.nb,
                );
                this.polling.timeoutEchec = setTimeout(() => {
                  this._envoiRequetePolling();
                }, this.polling.delaiRepetitionEchecReseau);
              }
            }
          },
          log: {
            tailleDonnees: lResultJSON.JSONStr_clair.length,
            tempsChiffre: '',
          },
        });
        this.polling.requeteEnCours.envoieRequete({
          numeroOrdre: this.polling.numeroOrdre,
          numeroOrdreChiffre: this.getChaineChiffreeAES(
            this.polling.numeroOrdre,
          ),
        });
        this.polling.timeoutExpirationRequete = setTimeout(() => {
          this.polling.timeoutExpirationRequete = null;
          IE.log.addLog('Timeout Polling');
          if (
            this.polling.requeteEnCours &&
            this.polling.requeteEnCours.getXmlRequest() &&
            this.polling.requeteEnCours.getXmlRequest().abort
          ) {
            return this.polling.requeteEnCours.getXmlRequest().abort();
          }
        }, this.polling.delaiTimeoutRequete);
      }
    }
    exports.CommunicationProduit = CommunicationProduit;
    CommunicationProduit.optionsSecurite = {};
    CommunicationProduit.cDureeTimerPresence = 2 * 60 * 1000;
    CommunicationProduit.cDureeTimerPresenceMAJServeurEnCours = 20 * 1000;
    CommunicationProduit.c_IdFichierAIgnorer = '__idFichierAIgnorer__';
    Invocateur_1.Invocateur.abonner(
      Invocateur_1.ObjetInvocateur.events.initChiffrement,
      (aParam) => {
        const lOptionsSecurite = {};
        if (aParam.http) {
          lOptionsSecurite.http = true;
        }
        if (aParam.sCrA) {
          lOptionsSecurite.sansCryptageAES = true;
        }
        if (aParam.sCoA) {
          lOptionsSecurite.sansCompressionAES = true;
        }
        if (aParam.poll) {
          lOptionsSecurite.avecPollingActif = true;
        }
        CommunicationProduit.optionsSecurite = lOptionsSecurite;
      },
    );
  },
  fn: 'communicationproduit.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ChoixThemesPourAppli =
      exports.ChoixDarkMode =
      exports.TypeThemeCollectivite =
      exports.TypeThemeProduit =
      exports.TypeThemeCouleur =
        void 0;
    exports.forEachThemesCouleurEtProduitEtCollectivite =
      forEachThemesCouleurEtProduitEtCollectivite;
    const MethodesObjet_1 = require('MethodesObjet');
    var TypeThemeCouleur;
    (function (TypeThemeCouleur) {
      TypeThemeCouleur[(TypeThemeCouleur['Bordeaux'] = 0)] = 'Bordeaux';
      TypeThemeCouleur[(TypeThemeCouleur['Jaune'] = 1)] = 'Jaune';
      TypeThemeCouleur[(TypeThemeCouleur['Bleu'] = 2)] = 'Bleu';
      TypeThemeCouleur[(TypeThemeCouleur['Turquoise'] = 3)] = 'Turquoise';
      TypeThemeCouleur[(TypeThemeCouleur['Vert'] = 4)] = 'Vert';
      TypeThemeCouleur[(TypeThemeCouleur['Violet'] = 5)] = 'Violet';
    })(TypeThemeCouleur || (exports.TypeThemeCouleur = TypeThemeCouleur = {}));
    var TypeThemeProduit;
    (function (TypeThemeProduit) {
      TypeThemeProduit[(TypeThemeProduit['ProduitPN'] = 1003)] = 'ProduitPN';
      TypeThemeProduit[(TypeThemeProduit['ProduitEDT'] = 1004)] = 'ProduitEDT';
      TypeThemeProduit[(TypeThemeProduit['ProduitHP'] = 1005)] = 'ProduitHP';
      TypeThemeProduit[(TypeThemeProduit['Pronote'] = 1006)] = 'Pronote';
      TypeThemeProduit[(TypeThemeProduit['EDT'] = 1007)] = 'EDT';
      TypeThemeProduit[(TypeThemeProduit['MobileHP'] = 1008)] = 'MobileHP';
    })(TypeThemeProduit || (exports.TypeThemeProduit = TypeThemeProduit = {}));
    var TypeThemeCollectivite;
    (function (TypeThemeCollectivite) {
      TypeThemeCollectivite[(TypeThemeCollectivite['ColIdf'] = 1009)] =
        'ColIdf';
    })(
      TypeThemeCollectivite ||
        (exports.TypeThemeCollectivite = TypeThemeCollectivite = {}),
    );
    function forEachThemesCouleurEtProduitEtCollectivite(aCallback) {
      for (const lKey of MethodesObjet_1.MethodesObjet.enumKeys(
        TypeThemeCouleur,
      )) {
        aCallback(TypeThemeCouleur[lKey], lKey);
      }
      for (const lKey of MethodesObjet_1.MethodesObjet.enumKeys(
        TypeThemeProduit,
      )) {
        aCallback(TypeThemeProduit[lKey], lKey);
      }
      for (const lKey of MethodesObjet_1.MethodesObjet.enumKeys(
        TypeThemeCollectivite,
      )) {
        aCallback(TypeThemeCollectivite[lKey], lKey);
      }
    }
    var ChoixDarkMode;
    (function (ChoixDarkMode) {
      ChoixDarkMode['systeme'] = 'systeme';
      ChoixDarkMode['clair'] = 'clair';
      ChoixDarkMode['sombre'] = 'sombre';
    })(ChoixDarkMode || (exports.ChoixDarkMode = ChoixDarkMode = {}));
    exports.ChoixThemesPourAppli = [
      TypeThemeProduit.Pronote,
      TypeThemeProduit.MobileHP,
      TypeThemeProduit.EDT,
      TypeThemeCollectivite.ColIdf,
    ];
  },
  fn: 'typethemecouleur.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ThemesCouleurs = void 0;
    const TypeThemeCouleur_1 = require('TypeThemeCouleur');
    const Invocateur_1 = require('Invocateur');
    class ObjetThemesCouleurs {
      constructor() {
        var _a;
        this.elementZoneFenetre = null;
        this.choixDarkMode = TypeThemeCouleur_1.ChoixDarkMode.clair;
        this.estDarkModeSysteme = false;
        this.avecChoixForcerDarkMode_DEBUG = !IE.estMobile;
        this.setTheme(null, true);
        Invocateur_1.Invocateur.abonner('creationZoneFenetre', (aElement) => {
          this.elementZoneFenetre = aElement;
          $(this.elementZoneFenetre).addClass(this.getClassThemeCourant());
        });
        if (global.matchMedia) {
          try {
            this.estDarkModeSysteme =
              (_a = global.matchMedia) === null || _a === void 0
                ? void 0
                : _a.call(global, '(prefers-color-scheme: dark)').matches;
            global
              .matchMedia('(prefers-color-scheme: dark)')
              .addEventListener('change', (event) => {
                var _a;
                this.estDarkModeSysteme =
                  (_a = global.matchMedia) === null || _a === void 0
                    ? void 0
                    : _a.call(global, '(prefers-color-scheme: dark)').matches;
                this.actualiserDarkMode();
              });
          } catch (e) {}
        }
      }
      setTheme(aGenreTheme, aModeAccessible) {
        this.genreTheme = aGenreTheme;
        this.estModeAccessible = aModeAccessible;
        if (document.body && global.GApplication) {
          this.setModeAccessible(aModeAccessible);
          this.actualiserDarkMode();
          this.actualiserTheme();
        }
      }
      getClassThemeCourant() {
        if (!this.estModeAccessible) {
          let lNomTheme = '';
          (0, TypeThemeCouleur_1.forEachThemesCouleurEtProduitEtCollectivite)(
            (aTheme, aKey) => {
              if (aTheme === this.genreTheme) {
                lNomTheme = aKey;
              }
            },
          );
          if (lNomTheme) {
            return 'Theme' + lNomTheme;
          } else {
            return 'ThemeNeutre';
          }
        }
        return 'ThemeNeutre';
      }
      actualiserTheme() {
        const lTabRemove = ['ThemeNeutre'];
        (0, TypeThemeCouleur_1.forEachThemesCouleurEtProduitEtCollectivite)(
          (aTheme, aKey) => {
            lTabRemove.push('Theme' + aKey);
          },
        );
        const lNomTheme = this.getClassThemeCourant();
        $('#' + GApplication.getIdConteneur().escapeJQ())
          .removeClass(lTabRemove.join(' '))
          .addClass(lNomTheme);
        if (this.elementZoneFenetre) {
          $(this.elementZoneFenetre)
            .removeClass(lTabRemove.join(' '))
            .addClass(lNomTheme);
        }
      }
      getDarkMode() {
        var _a, _b, _c, _d, _e;
        if (
          this.avecChoixForcerDarkMode_DEBUG &&
          ((_b =
            (_a = global.GApplication) === null || _a === void 0
              ? void 0
              : _a.estDebug) === null || _b === void 0
            ? void 0
            : _b.call(_a))
        ) {
          return (_e =
            (_d =
              (_c = global.GApplication) === null || _c === void 0
                ? void 0
                : _c.getOptionsDebug) === null || _d === void 0
              ? void 0
              : _d.call(_c)) === null || _e === void 0
            ? void 0
            : _e.forcerDarkMode;
        }
        switch (this.choixDarkMode) {
          case TypeThemeCouleur_1.ChoixDarkMode.clair: {
            return false;
          }
          case TypeThemeCouleur_1.ChoixDarkMode.sombre: {
            return true;
          }
          case TypeThemeCouleur_1.ChoixDarkMode.systeme: {
            return this.estDarkModeSysteme;
          }
          default:
        }
        return false;
      }
      setChoixDarkMode(aChoixThemeSombre) {
        this.choixDarkMode = aChoixThemeSombre;
        this.actualiserDarkMode();
      }
      actualiserDarkMode() {
        if (this.getDarkMode()) {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.remove('dark-mode');
        }
      }
      getModeAccessible() {
        return this.estModeAccessible;
      }
      setModeAccessible(aModeAccessible) {
        this.estModeAccessible = aModeAccessible;
        if (this.estModeAccessible) {
          document.body.classList.add('ThemeAccessible');
        } else {
          document.body.classList.remove('ThemeAccessible');
        }
        this.actualiserTheme();
      }
    }
    exports.ThemesCouleurs = new ObjetThemesCouleurs();
  },
  fn: 'themescouleurs.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireCouleur = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const UtilitaireCouleur = {
      hslDelphiMax: 240,
      couleurToRGB: function (aHex) {
        if (
          !aHex ||
          !aHex.substring ||
          aHex[0] !== '#' ||
          (aHex.length !== 4 && aHex.length < 7)
        ) {
          return { r: 0, g: 0, b: 0 };
        }
        if (aHex.length === 4) {
          const lRGBHex = {
            r: aHex.substring(1, 2),
            g: aHex.substring(2, 3),
            b: aHex.substring(3, 4),
          };
          return {
            r: parseInt(lRGBHex.r + lRGBHex.r, 16),
            g: parseInt(lRGBHex.g + lRGBHex.g, 16),
            b: parseInt(lRGBHex.b + lRGBHex.b, 16),
          };
        }
        return {
          r: parseInt(aHex.substring(1, 3), 16),
          g: parseInt(aHex.substring(3, 5), 16),
          b: parseInt(aHex.substring(5, 7), 16),
        };
      },
      couleurToHSV: function (hex) {
        return this.rgbToHSV(this.couleurToRGB(hex));
      },
      rgbToCouleur: function (aRGB) {
        if (!aRGB) {
          return null;
        }
        let lRGB = null;
        if (typeof aRGB === 'string') {
          const lRegex = /rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/;
          const lRGBRegex = lRegex.exec(aRGB);
          if (lRGBRegex) {
            lRGB = {
              r: parseInt(lRGBRegex[1]),
              g: parseInt(lRGBRegex[2]),
              b: parseInt(lRGBRegex[3]),
            };
          }
        } else {
          lRGB = aRGB;
        }
        if (
          !lRGB ||
          isNaN(lRGB.r) ||
          isNaN(lRGB.g) ||
          isNaN(lRGB.b) ||
          lRGB.r < 0 ||
          lRGB.g < 0 ||
          lRGB.b < 0
        ) {
          return null;
        }
        const hex = [
          lRGB.r.toString(16),
          lRGB.g.toString(16),
          lRGB.b.toString(16),
        ];
        $.each(hex, (nr, val) => {
          if (val.length === 1) {
            hex[nr] = '0' + val;
          }
        });
        return '#' + hex.join('');
      },
      rgbToHSV: function (rgb) {
        let rr, gg, bb;
        const r = rgb.r / 255,
          g = rgb.g / 255,
          b = rgb.b / 255;
        let h, s;
        const v = Math.max(r, g, b),
          diff = v - Math.min(r, g, b),
          diffc = function (c) {
            return (v - c) / 6 / diff + 1 / 2;
          };
        if (diff === 0) {
          h = s = 0;
        } else {
          s = diff / v;
          rr = diffc(r);
          gg = diffc(g);
          bb = diffc(b);
          if (r === v) {
            h = bb - gg;
          } else if (g === v) {
            h = 1 / 3 + rr - bb;
          } else if (b === v) {
            h = 2 / 3 + gg - rr;
          }
          if (h < 0) {
            h += 1;
          } else if (h > 1) {
            h -= 1;
          }
        }
        return {
          h: Math.round(h * 360),
          s: Math.round(s * 100),
          l: Math.round(v * 100),
        };
      },
      hsvToCouleur: function (hsl) {
        return this.rgbToCouleur(this.hsvToRGB(hsl));
      },
      hsvToRGB: function (hsl) {
        const rgb = {};
        let h = Math.round(hsl.h);
        const s = Math.round((hsl.s * 255) / 100);
        const v = Math.round((hsl.l * 255) / 100);
        if (s === 0) {
          rgb.r = rgb.g = rgb.b = v;
        } else {
          const t1 = v;
          const t2 = ((255 - s) * v) / 255;
          const t3 = ((t1 - t2) * (h % 60)) / 60;
          if (h === 360) {
            h = 0;
          }
          if (h < 60) {
            rgb.r = t1;
            rgb.b = t2;
            rgb.g = t2 + t3;
          } else if (h < 120) {
            rgb.g = t1;
            rgb.b = t2;
            rgb.r = t1 - t3;
          } else if (h < 180) {
            rgb.g = t1;
            rgb.r = t2;
            rgb.b = t2 + t3;
          } else if (h < 240) {
            rgb.b = t1;
            rgb.r = t2;
            rgb.g = t1 - t3;
          } else if (h < 300) {
            rgb.b = t1;
            rgb.g = t2;
            rgb.r = t2 + t3;
          } else if (h < 360) {
            rgb.r = t1;
            rgb.g = t2;
            rgb.b = t1 - t3;
          } else {
            rgb.r = 0;
            rgb.g = 0;
            rgb.b = 0;
          }
        }
        return {
          r: Math.round(rgb.r),
          g: Math.round(rgb.g),
          b: Math.round(rgb.b),
        };
      },
      hsvToHSLDelphi: function (hsv) {
        const lLuminance = ((200 - hsv.s) * hsv.l) / 200,
          lHSL = {
            h: (hsv.h * this.hslDelphiMax) / 360,
            s: 0,
            l: (lLuminance * this.hslDelphiMax) / 100,
          };
        lHSL.s =
          ((hsv.l > 0
            ? (hsv.s * hsv.l) /
              (lLuminance < 50 ? lLuminance * 2 : 200 - lLuminance * 2)
            : hsv.s) *
            this.hslDelphiMax) /
          100;
        if (isNaN(lHSL.s)) {
          lHSL.s = 0;
        }
        return lHSL;
      },
      hslDelphiToHSV: function (hsl) {
        const lHSV = {
          h: (hsl.h * 360) / this.hslDelphiMax,
          s: (hsl.s * 100) / this.hslDelphiMax,
          l: (hsl.l * 100) / this.hslDelphiMax,
        };
        const t = (lHSV.s * (lHSV.l < 50 ? lHSV.l : 100 - lHSV.l)) / 100;
        lHSV.s = lHSV.l > 0 ? (200 * t) / (lHSV.l + t) : lHSV.s;
        if (isNaN(lHSV.s)) {
          lHSV.s = 0;
        }
        lHSV.l = t + lHSV.l;
        return lHSV;
      },
      getContrastedColor(aColor) {
        const lWhite = '#FFFFFF';
        const lBlack = '#000000';
        if (
          this.contrastRatio(aColor, lWhite) >
          this.contrastRatio(aColor, lBlack)
        ) {
          return lWhite;
        }
        return lBlack;
      },
      contrastRatio(aColor1, aColor2) {
        let ratio =
          (0.05 + this.relativeLum(aColor1)) /
          (0.05 + this.relativeLum(aColor2));
        if (ratio < 1) {
          ratio = 1 / ratio;
        }
        return ratio;
      },
      relativeLum(aColor) {
        let lRGB = null;
        if (MethodesObjet_1.MethodesObjet.isString(aColor)) {
          lRGB = this.couleurToRGB(aColor);
        } else if (aColor && 'r' in aColor) {
          lRGB = aColor;
        }
        if (!lRGB) {
          return 1;
        }
        lRGB.r = (lRGB.r || 0) / 255;
        lRGB.g = (lRGB.g || 0) / 255;
        lRGB.b = (lRGB.b || 0) / 255;
        let transformed = {};
        for (let x in lRGB) {
          if (lRGB[x] <= 0.03928) {
            transformed[x] = lRGB[x] / 12.92;
          } else {
            transformed[x] = Math.pow((lRGB[x] + 0.055) / 1.055, 2.4);
          }
        }
        let lum =
          transformed.r * 0.2126 +
          transformed.g * 0.7152 +
          transformed.b * 0.0722;
        return lum;
      },
    };
    exports.UtilitaireCouleur = UtilitaireCouleur;
  },
  fn: 'utilitairecouleur.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjectCouleurCelluleListe =
      exports.ObjectCouleurCellule =
      exports._ObjetCouleur =
        void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const UtilitaireCouleur_1 = require('UtilitaireCouleur');
    if (!global.GCouleur) {
      global.GCouleur = null;
    }
    class _ObjetCouleur {
      constructor(aAvecNonEditable) {
        this.blanc = 'var(--color-background)';
        this.noir = 'var(--color-text)';
        this.eleve = { garcon: '#2D24F0', fille: '#EE01F6' };
        this.fond = 'var(--color-background)';
        this.themeNeutre = {};
        [
          'light',
          'legere',
          'legere2',
          'claire',
          'moyen1',
          'moyen2',
          'moyen3',
          'foncee',
          'sombre',
        ].forEach((aKey) => {
          this.themeNeutre[aKey] = `var(--theme-neutre-${aKey})`;
        });
        this.themeCouleur = {};
        ['claire', 'moyen1', 'foncee', 'sombre'].forEach((aKey) => {
          this.themeCouleur[aKey] = `var(--theme-${aKey})`;
        });
        this.texte = this.noir;
        this.bordure = this.trait = this.themeNeutre.moyen2;
        this.cumul = this.themeNeutre.moyen2;
        this.nonEditable = {
          fond: 'var(--color-background-non-editable)',
          texte: this.themeNeutre.foncee,
          bordure: this.themeNeutre.moyen2,
        };
        this.intermediaire = this.themeNeutre.claire;
        this.avecNonEditable =
          aAvecNonEditable === null || aAvecNonEditable === undefined
            ? true
            : aAvecNonEditable;
        this.texteListeCreation = '#444444';
        this.fenetre = {
          fond: this.fond,
          bordure: this.bordure,
          bandeau: { fond: this.blanc, texte: this.noir },
          nonEditable: this.nonEditable,
          cumul: this.cumul,
          texte: this.themeNeutre.foncee,
          intermediaire: this.themeNeutre.claire,
        };
        this.rouge = 'var(--color-red)';
        this.rougeClair = 'var(--color-light-red)';
        this.vert = 'var(--color-green)';
        this.grisTresClair = this.fenetre.nonEditable;
        this.grisClair = this.fenetre.intermediaire;
        this.grisFonce = this.fenetre.cumul;
        this.grisTresFonce = this.fenetre.texte;
        this.standard = new ObjectCouleurCellule(this.blanc, this.noir);
        this.selection = new ObjectCouleurCelluleFC(
          'var(--couleur-selection)',
          this.blanc,
        );
        this.selection.fondClair = 'var(--couleur-selection-fond-clair)';
        this.inactif = new ObjectCouleurCellule('#F0F0F0', '#AAAAAA');
        this.grille = {
          fond: this.themeNeutre.moyen1,
          bordure: '#848484',
          texte: 'black',
          gabarit: 'var(--color-grille-gabarit)',
          fondCoursSuperpose: '#f9f4f0',
          selectionCours: this.selection.fond,
        };
        this.bandeau = {
          fond: this.themeNeutre.moyen1,
          texte: this.noir,
          bordure: this.themeNeutre.light,
          separateur: this.themeCouleur.foncee,
        };
        this.titre = new ObjectCouleurCellule(
          this.themeNeutre.light,
          this.themeCouleur.foncee,
          this.bordure,
        );
        this.liste = new ObjectCouleurCelluleListe();
        this.liste.bordure = this.bordure;
        this.liste.cellule = new ObjectCouleurCellule(
          this.fond,
          this.texte,
          this.bordure,
        );
        this.liste.editable = new ObjectCouleurCellule(
          this.blanc,
          this.noir,
          this.bordure,
        );
        this.liste.editableAlternee1 = new ObjectCouleurCellule(
          this.themeNeutre.light,
          this.noir,
          this.bordure,
        );
        this.liste.editableAlternee2 = new ObjectCouleurCellule(
          this.blanc,
          this.noir,
          this.bordure,
        );
        this.liste.nonEditable = new ObjectCouleurCellule(
          this.avecNonEditable ? this.themeNeutre.legere2 : this.blanc,
          this.noir,
          this.bordure,
        );
        this.liste.nonEditableAlternee1 = new ObjectCouleurCellule(
          this.themeNeutre.claire,
          this.noir,
          this.bordure,
        );
        this.liste.nonEditableAlternee2 = new ObjectCouleurCellule(
          this.themeNeutre.legere2,
          this.noir,
          this.bordure,
        );
        this.liste.nonApplicable = new ObjectCouleurCellule(
          this.themeNeutre.moyen1,
          this.noir,
          this.bordure,
        );
        this.liste.colonneFixe = new ObjectCouleurCellule(
          this.themeNeutre.claire,
          this.noir,
          this.bordure,
        );
        this.liste.colonneFixeAlternee1 = new ObjectCouleurCellule(
          this.themeNeutre.claire,
          this.noir,
          this.bordure,
        );
        this.liste.colonneFixeAlternee2 = new ObjectCouleurCellule(
          this.themeNeutre.legere2,
          this.noir,
          this.bordure,
        );
        this.liste.moyenne = new ObjectCouleurCellule(
          this.themeNeutre.claire,
          this.noir,
          this.bordure,
        );
        this.liste.moyenneAlternee1 = new ObjectCouleurCellule(
          this.themeNeutre.claire,
          this.noir,
          this.bordure,
        );
        this.liste.moyenneAlternee2 = new ObjectCouleurCellule(
          this.themeNeutre.legere2,
          this.noir,
          this.bordure,
        );
        this.liste.total = new ObjectCouleurCellule(
          this.themeNeutre.foncee,
          this.blanc,
          this.bordure,
        );
        this.liste.totalAlternee1 = new ObjectCouleurCellule(
          this.themeNeutre.sombre,
          this.blanc,
          this.bordure,
        );
        this.liste.totalAlternee2 = new ObjectCouleurCellule(
          this.themeNeutre.foncee,
          this.blanc,
          this.bordure,
        );
        this.liste.cumul = new ObjectCouleurCelluleCumul(
          this.themeCouleur.claire,
          this.noir,
          this.bordure,
        );
        this.liste.cumul[0] = new ObjectCouleurCellule(
          this.themeCouleur.moyen1,
          this.blanc,
          this.bordure,
        );
        this.liste.cumul[1] = new ObjectCouleurCellule(
          this.themeCouleur.claire,
          this.noir,
          this.bordure,
        );
        this.liste.cumul[2] = new ObjectCouleurCellule(
          this.themeNeutre.moyen1,
          this.noir,
          this.bordure,
        );
        this.liste.cumul[3] = new ObjectCouleurCellule(
          this.themeNeutre.claire,
          this.noir,
          this.bordure,
        );
        this.listeNeutre = MethodesObjet_1.MethodesObjet.dupliquer(this.liste);
        this.listeNeutre.cumul[0].fond = this.themeNeutre.claire;
        this.listeNeutre.cumul[1].fond = this.themeNeutre.claire;
        this.listeNeutre.cumul[2].fond = this.themeNeutre.claire;
        this.listeNeutre.cumul[3].fond = this.themeNeutre.claire;
        this.correspondance = {};
        this.accessible = {};
        this.devoir = {
          commeUnBonus: '#00FF00',
          commeUneNote: 'darkorange',
          commeUnSeuil: '#9933FF',
        };
        this.surlignageTexte = '#99cde4';
      }
      getCouleurCellule(aEditable, aSelectionne) {
        if (aSelectionne) {
          return this.selection;
        }
        return aEditable ? this.liste.editable : this.liste.nonEditable;
      }
      couleurToRGB(aHex) {
        return UtilitaireCouleur_1.UtilitaireCouleur.couleurToRGB(aHex);
      }
      couleurToHSV(hex) {
        return UtilitaireCouleur_1.UtilitaireCouleur.couleurToHSV(hex);
      }
      rgbToCouleur(aRGB) {
        return UtilitaireCouleur_1.UtilitaireCouleur.rgbToCouleur(aRGB);
      }
      rgbToHSV(rgb) {
        return UtilitaireCouleur_1.UtilitaireCouleur.rgbToHSV(rgb);
      }
      hsvToCouleur(hsl) {
        return UtilitaireCouleur_1.UtilitaireCouleur.hsvToCouleur(hsl);
      }
      hsvToRGB(hsl) {
        return UtilitaireCouleur_1.UtilitaireCouleur.hsvToRGB(hsl);
      }
      hsvToHSLDelphi(hsv) {
        return UtilitaireCouleur_1.UtilitaireCouleur.hsvToHSLDelphi(hsv);
      }
      hslDelphiToHSV(hsl) {
        return UtilitaireCouleur_1.UtilitaireCouleur.hslDelphiToHSV(hsl);
      }
      getCouleurCorrespondance(aCouleur) {
        return UtilitaireCouleur_1.UtilitaireCouleur.getContrastedColor(
          aCouleur,
        );
      }
      getCouleurAccessible(aCouleur) {
        if (!aCouleur || !aCouleur.substring) {
          return aCouleur;
        }
        if (this.accessible[aCouleur] !== undefined) {
          return this.accessible[aCouleur];
        }
        let r = parseInt(aCouleur.substring(1, 3), 16) / 255;
        let g = parseInt(aCouleur.substring(3, 5), 16) / 255;
        let b = parseInt(aCouleur.substring(5, 7), 16) / 255;
        const max = Math.max(r, g, b),
          min = Math.min(r, g, b);
        const l = (max + min) / 2;
        r = g = b = Math.round(l * 255);
        this.accessible[aCouleur] =
          '#' +
          (r < 16 ? '0' : '') +
          r.toString(16) +
          (g < 16 ? '0' : '') +
          g.toString(16) +
          (b < 16 ? '0' : '') +
          b.toString(16);
        return this.accessible[aCouleur];
      }
      getCouleurTransparente(aColor, aOpacity, aBackground, aBackOpa) {
        if (!aColor || !aColor.substring) {
          return false;
        }
        if (aOpacity < 0 || aOpacity > 1) {
          return false;
        }
        if (!aBackOpa || aBackOpa < 0 || aBackOpa > 1) {
          aBackOpa = 1;
        }
        const lDest = [];
        const lFond = [255, 255, 255];
        const lOrig = [];
        if (aBackground && aBackground.substring) {
          lFond[0] = parseInt(aBackground.substring(1, 3), 16);
          lFond[1] = parseInt(aBackground.substring(3, 5), 16);
          lFond[2] = parseInt(aBackground.substring(5, 7), 16);
        }
        lDest[0] = parseInt(aColor.substring(1, 3), 16);
        lDest[1] = parseInt(aColor.substring(3, 5), 16);
        lDest[2] = parseInt(aColor.substring(5, 7), 16);
        for (let i = 0; i < 3; i++) {
          lOrig[i] = Math.floor(
            (lDest[i] * (aOpacity + aBackOpa * (1 - aOpacity)) -
              lFond[i] * aBackOpa * (1 - aOpacity)) /
              aOpacity,
          );
          if (lOrig[i] > 255 || lOrig[i] < 0) {
            return false;
          }
        }
        return (
          '#' +
          (lOrig[0] < 16 ? '0' : '') +
          lOrig[0].toString(16) +
          (lOrig[1] < 16 ? '0' : '') +
          lOrig[1].toString(16) +
          (lOrig[2] < 16 ? '0' : '') +
          lOrig[2].toString(16)
        );
      }
      getCouleurTransformationCours(aCouleur) {
        const lRGB = this.couleurToRGB(aCouleur),
          lHSL = this.hsvToHSLDelphi(this.rgbToHSV(lRGB));
        let lEstProcheDuGris =
          Math.abs(lRGB.r - lRGB.g) < 10 &&
          Math.abs(lRGB.r - lRGB.b) < 10 &&
          Math.abs(lRGB.g - lRGB.b) < 10;
        if (!lEstProcheDuGris) {
          lEstProcheDuGris = lHSL.s < 8;
        }
        if (lEstProcheDuGris) {
          lRGB.r = Math.borner(lRGB.r + 50, 180, 255);
          lRGB.g = Math.borner(lRGB.g + 50, 180, 255);
          lRGB.b = Math.borner(lRGB.b + 50, 180, 255);
          return this.rgbToCouleur(lRGB);
        } else {
          lHSL.s = Math.max(lHSL.s - 100, 60);
          if (lHSL.l < 140) {
            lHSL.l = 160;
          } else if (lHSL.l < 160) {
            lHSL.l = 200;
          } else {
            lHSL.l = 220;
          }
          return this.hsvToCouleur(this.hslDelphiToHSV(lHSL));
        }
      }
      getCouleurContrastee(aCouleur, aCouleurFond, aParametresContraste) {
        if (!aCouleur || !aCouleurFond) {
          return aCouleur || '#000';
        }
        if (!aParametresContraste) {
          aParametresContraste = {};
        }
        if (aParametresContraste.ponderationFoncee === undefined) {
          aParametresContraste.ponderationFoncee = 1;
        }
        if (aParametresContraste.ponderationClaire === undefined) {
          aParametresContraste.ponderationClaire = 1;
        }
        const lHSL = UtilitaireCouleur_1.UtilitaireCouleur.hsvToHSLDelphi(
          UtilitaireCouleur_1.UtilitaireCouleur.couleurToHSV(aCouleur),
        );
        const lHSLFond = UtilitaireCouleur_1.UtilitaireCouleur.hsvToHSLDelphi(
          UtilitaireCouleur_1.UtilitaireCouleur.couleurToHSV(aCouleurFond),
        );
        const lDeltaInitial = 30;
        const lDeltaRenduPlusFoncee =
          lDeltaInitial * aParametresContraste.ponderationFoncee;
        const lDeltaRenduPlusClair =
          lDeltaInitial * aParametresContraste.ponderationClaire;
        if (lHSLFond.l > 75) {
          if (lHSL.l >= lDeltaRenduPlusFoncee) {
            lHSL.l += -1 * lDeltaRenduPlusFoncee;
          } else {
            lHSL.l = 0;
          }
        } else {
          lHSL.l =
            UtilitaireCouleur_1.UtilitaireCouleur.hslDelphiMax -
            lDeltaRenduPlusClair;
        }
        return UtilitaireCouleur_1.UtilitaireCouleur.hsvToCouleur(
          UtilitaireCouleur_1.UtilitaireCouleur.hslDelphiToHSV(lHSL),
        );
      }
    }
    exports._ObjetCouleur = _ObjetCouleur;
    _ObjetCouleur.hslDelphiMax =
      UtilitaireCouleur_1.UtilitaireCouleur.hslDelphiMax;
    class ObjectCouleurCellule {
      constructor(aFond, aTexte, aBordure) {
        this.fond = aFond;
        this.texte = aTexte;
        this.bordure = aBordure;
      }
      getFond(aPourImpression) {
        return aPourImpression ? global.GCouleur.blanc : this.fond;
      }
      getTexte(aPourImpression) {
        return aPourImpression ? global.GCouleur.noir : this.texte;
      }
      getBordure(aPourImpression) {
        return aPourImpression ? global.GCouleur.noir : this.bordure;
      }
    }
    exports.ObjectCouleurCellule = ObjectCouleurCellule;
    class ObjectCouleurCelluleCumul extends ObjectCouleurCellule {}
    class ObjectCouleurCelluleFC extends ObjectCouleurCellule {}
    class ObjectCouleurCelluleListe extends ObjectCouleurCellule {}
    exports.ObjectCouleurCelluleListe = ObjectCouleurCelluleListe;
  },
  fn: '_objetcouleur.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireRedirection = void 0;
    class UtilitaireRedirection {
      constructor() {
        this.parametresAConserver = [
          'login',
          'fd',
          'redirect',
          'redirect_sauthm',
        ];
        this.parametres = [];
        const lSearches = window.location.search.replace(/^\?/, '').split('&');
        for (const i in lSearches) {
          const lItems = lSearches[i].split('=');
          if (lItems.length === 2) {
            this.parametres.push({ parametre: lItems[0], valeur: lItems[1] });
          }
        }
      }
      getParametresUrl(aObjet) {
        let lParamUrl = '';
        const lParametres = [];
        let lParametre;
        if (aObjet && aObjet.parametresAConserver) {
          this.parametresAConserver = aObjet.parametresAConserver;
        }
        for (const i in this.parametres) {
          lParametre = this.parametres[i];
          const lRegExpParametre = new RegExp(lParametre.parametre, 'i');
          if (
            lRegExpParametre.test(this.parametresAConserver.join(' ')) &&
            (!aObjet ||
              !aObjet.parametresASupprimer ||
              !lRegExpParametre.test(aObjet.parametresASupprimer.join(' ')))
          ) {
            lParametres.push(lParametre);
          }
        }
        if (aObjet && aObjet.parametres) {
          for (const i in aObjet.parametres) {
            lParametre = aObjet.parametres[i];
            if (!this.existParametre(lParametre.parametre)) {
              lParametres.push(lParametre);
            }
          }
        }
        for (const i in lParametres) {
          lParametre = lParametres[i];
          lParamUrl +=
            (lParamUrl ? '&' : '') +
            lParametre.parametre +
            '=' +
            lParametre.valeur;
        }
        return (lParamUrl ? '?' : '') + lParamUrl;
      }
      existParametre(aParametre) {
        const obj = this.parametres.filter((aItem) => {
          return aItem.parametre === aParametre;
        });
        return obj !== undefined && obj.length > 0;
      }
    }
    exports.UtilitaireRedirection = UtilitaireRedirection;
  },
  fn: 'utilitaireredirection.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreWidgetUtil = exports.EGenreWidget = void 0;
    var EGenreWidget;
    (function (EGenreWidget) {
      EGenreWidget[(EGenreWidget['discussions'] = 0)] = 'discussions';
      EGenreWidget[(EGenreWidget['casier'] = 1)] = 'casier';
      EGenreWidget[(EGenreWidget['appelNonFait'] = 2)] = 'appelNonFait';
      EGenreWidget[(EGenreWidget['CDTNonSaisi'] = 3)] = 'CDTNonSaisi';
      EGenreWidget[(EGenreWidget['conseilDeClasse'] = 4)] = 'conseilDeClasse';
      EGenreWidget[(EGenreWidget['menuDeLaCantine'] = 5)] = 'menuDeLaCantine';
      EGenreWidget[(EGenreWidget['vieScolaire'] = 6)] = 'vieScolaire';
      EGenreWidget[(EGenreWidget['travailAFaire'] = 7)] = 'travailAFaire';
      EGenreWidget[(EGenreWidget['agenda'] = 8)] = 'agenda';
      EGenreWidget[(EGenreWidget['actualites'] = 9)] = 'actualites';
      EGenreWidget[(EGenreWidget['notes'] = 10)] = 'notes';
      EGenreWidget[(EGenreWidget['QCM'] = 11)] = 'QCM';
      EGenreWidget[(EGenreWidget['EDT'] = 12)] = 'EDT';
      EGenreWidget[(EGenreWidget['ressources'] = 13)] = 'ressources';
      EGenreWidget[(EGenreWidget['kiosque'] = 14)] = 'kiosque';
      EGenreWidget[(EGenreWidget['ressourcePedagogique'] = 15)] =
        'ressourcePedagogique';
      EGenreWidget[(EGenreWidget['DS'] = 16)] = 'DS';
      EGenreWidget[(EGenreWidget['aide'] = 17)] = 'aide';
      EGenreWidget[(EGenreWidget['competences'] = 18)] = 'competences';
      EGenreWidget[(EGenreWidget['coursNonAssures'] = 19)] = 'coursNonAssures';
      EGenreWidget[(EGenreWidget['penseBete'] = 20)] = 'penseBete';
      EGenreWidget[(EGenreWidget['DSEvaluation'] = 21)] = 'DSEvaluation';
      EGenreWidget[(EGenreWidget['RetourEspace'] = 22)] = 'RetourEspace';
      EGenreWidget[(EGenreWidget['carnetDeCorrespondance'] = 23)] =
        'carnetDeCorrespondance';
      EGenreWidget[(EGenreWidget['Encouragement'] = 24)] = 'Encouragement';
      EGenreWidget[(EGenreWidget['TAFARendre'] = 25)] = 'TAFARendre';
      EGenreWidget[(EGenreWidget['Intendance_Execute'] = 26)] =
        'Intendance_Execute';
      EGenreWidget[(EGenreWidget['lienUtile'] = 27)] = 'lienUtile';
      EGenreWidget[(EGenreWidget['partenaireCDI'] = 28)] = 'partenaireCDI';
      EGenreWidget[(EGenreWidget['partenaireAgate'] = 29)] = 'partenaireAgate';
      EGenreWidget[(EGenreWidget['incidents'] = 30)] = 'incidents';
      EGenreWidget[(EGenreWidget['donneesVS'] = 31)] = 'donneesVS';
      EGenreWidget[(EGenreWidget['donneesProfs'] = 32)] = 'donneesProfs';
      EGenreWidget[(EGenreWidget['tableauDeBord'] = 33)] = 'tableauDeBord';
      EGenreWidget[(EGenreWidget['communications'] = 34)] = 'communications';
      EGenreWidget[(EGenreWidget['connexionsEnCours'] = 35)] =
        'connexionsEnCours';
      EGenreWidget[(EGenreWidget['partenaireARD'] = 36)] = 'partenaireARD';
      EGenreWidget[(EGenreWidget['personnelsAbsents'] = 37)] =
        'personnelsAbsents';
      EGenreWidget[(EGenreWidget['tachesSecretariat_Execute'] = 38)] =
        'tachesSecretariat_Execute';
      EGenreWidget[(EGenreWidget['Planning'] = 39)] = 'Planning';
      EGenreWidget[(EGenreWidget['elections'] = 40)] = 'elections';
      EGenreWidget[(EGenreWidget['activite'] = 41)] = 'activite';
      EGenreWidget[(EGenreWidget['enseignementADistance'] = 42)] =
        'enseignementADistance';
      EGenreWidget[(EGenreWidget['TAFPrimaire'] = 43)] = 'TAFPrimaire';
      EGenreWidget[(EGenreWidget['absRetardsJustifiesParents'] = 44)] =
        'absRetardsJustifiesParents';
      EGenreWidget[(EGenreWidget['blog_filActu'] = 45)] = 'blog_filActu';
      EGenreWidget[(EGenreWidget['maintenanceInfoExecute'] = 46)] =
        'maintenanceInfoExecute';
      EGenreWidget[(EGenreWidget['TAFEtActivites'] = 47)] = 'TAFEtActivites';
      EGenreWidget[(EGenreWidget['evenementRappel'] = 48)] = 'evenementRappel';
      EGenreWidget[(EGenreWidget['exclusions'] = 49)] = 'exclusions';
      EGenreWidget[(EGenreWidget['partenaireApplicam'] = 50)] =
        'partenaireApplicam';
      EGenreWidget[(EGenreWidget['commande_Execute'] = 51)] =
        'commande_Execute';
      EGenreWidget[(EGenreWidget['registreAppel'] = 52)] = 'registreAppel';
      EGenreWidget[(EGenreWidget['previsionnelAbsServiceAnnexe'] = 53)] =
        'previsionnelAbsServiceAnnexe';
      EGenreWidget[(EGenreWidget['partenaireFAST'] = 54)] = 'partenaireFAST';
      EGenreWidget[(EGenreWidget['modificationEDT'] = 55)] = 'modificationEDT';
      EGenreWidget[(EGenreWidget['RemplacementsEnseignants'] = 56)] =
        'RemplacementsEnseignants';
    })(EGenreWidget || (exports.EGenreWidget = EGenreWidget = {}));
    const MethodesObjet_1 = require('MethodesObjet');
    const EGenreWidgetUtil = {
      getNomClasseWidget(aGenreWidget) {
        const lListeKeysWidget =
          MethodesObjet_1.MethodesObjet.enumKeys(EGenreWidget);
        return lListeKeysWidget[aGenreWidget].toLowerCase();
      },
    };
    exports.EGenreWidgetUtil = EGenreWidgetUtil;
  },
  fn: 'enumere_widget.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Widget = void 0;
    const ObjetIdentite_1 = require('ObjetIdentite');
    var Widget;
    (function (Widget) {
      class ObjetWidget extends ObjetIdentite_1.Identite {}
      Widget.ObjetWidget = ObjetWidget;
    })(Widget || (exports.Widget = Widget = {}));
  },
  fn: 'objetwidget.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeFormatDureeEnChaine = void 0;
    var TypeFormatDureeEnChaine;
    (function (TypeFormatDureeEnChaine) {
      TypeFormatDureeEnChaine[
        (TypeFormatDureeEnChaine['fdcHeuresMinutes'] = 0)
      ] = 'fdcHeuresMinutes';
      TypeFormatDureeEnChaine[
        (TypeFormatDureeEnChaine['fdcHeuresCentiemes'] = 1)
      ] = 'fdcHeuresCentiemes';
      TypeFormatDureeEnChaine[(TypeFormatDureeEnChaine['fdcSequences'] = 2)] =
        'fdcSequences';
      TypeFormatDureeEnChaine[
        (TypeFormatDureeEnChaine['fdcPersonnalise'] = 3)
      ] = 'fdcPersonnalise';
    })(
      TypeFormatDureeEnChaine ||
        (exports.TypeFormatDureeEnChaine = TypeFormatDureeEnChaine = {}),
    );
  },
  fn: 'typeformatdureeenchaine.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TUtilitaireDuree = TUtilitaireDuree;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const C_HeuresParJour = 24,
      C_MinutesParHeure = 60,
      C_SecondesParMinute = 60,
      C_MilliSecondesParSeconde = 1000,
      C_MinutesParJour = C_MinutesParHeure * C_HeuresParJour,
      C_SecondesParJour = C_SecondesParMinute * C_MinutesParJour;
    function TUtilitaireDuree() {}
    TUtilitaireDuree.dureeEnHeures = function (aDuree, aSansArrondi) {
      if (MethodesObjet_1.MethodesObjet.isNumber(aDuree)) {
        return _get(aDuree * C_HeuresParJour, aSansArrondi);
      }
      return 0;
    };
    TUtilitaireDuree.dureeEnHeuresMinutes = function (aDuree) {
      const lResult = {
        jours: 0,
        heures: 0,
        minutes: 0,
        toString: function (aFormat) {
          let lFormat = '%hh:%mm';
          if (aFormat === true) {
            lFormat = '%oh%sh%om%sm';
          } else if (typeof aFormat === 'string') {
            lFormat = aFormat;
          }
          lFormat = lFormat.replace(
            '%jj',
            (this.jours < 10 ? '0' : '') + this.jours,
          );
          lFormat = lFormat.replace('%xj', this.jours + '');
          lFormat = lFormat.replace(
            '%oj%sj',
            this.jours > 0
              ? this.jours +
                  ObjetTraduction_1.GTraductions.getValeur(
                    'date.separateurJour',
                  )
              : '',
          );
          lFormat = lFormat.replace(
            '%oj',
            this.jours > 0 ? this.jours + '' : '',
          );
          lFormat = lFormat.replace(
            '%sj',
            ObjetTraduction_1.GTraductions.getValeur('date.separateurJour'),
          );
          lFormat = lFormat.replace(
            '%hh',
            (this.heures < 10 ? '0' : '') + this.heures,
          );
          lFormat = lFormat.replace('%xh', this.heures + '');
          lFormat = lFormat.replace(
            '%oh%sh',
            this.heures > 0
              ? this.heures +
                  ObjetTraduction_1.GTraductions.getValeur(
                    'date.separateurHeure',
                  )
              : '',
          );
          lFormat = lFormat.replace(
            '%oh',
            this.heures > 0 ? this.heures + '' : '',
          );
          lFormat = lFormat.replace(
            '%sh',
            ObjetTraduction_1.GTraductions.getValeur('date.separateurHeure'),
          );
          lFormat = lFormat.replace(
            '%mm',
            (this.minutes < 10 ? '0' : '') + this.minutes,
          );
          lFormat = lFormat.replace('%xm', this.minutes + '');
          lFormat = lFormat.replace(
            '%om%sm',
            this.minutes > 0
              ? (this.heures > 0 && this.minutes < 10 ? '0' : '') +
                  this.minutes +
                  ObjetTraduction_1.GTraductions.getValeur('date.separateurMin')
              : '',
          );
          lFormat = lFormat.replace(
            '%om',
            this.minutes > 0 ? this.minutes + '' : '',
          );
          lFormat = lFormat.replace(
            '%sm',
            ObjetTraduction_1.GTraductions.getValeur('date.separateurMin'),
          );
          return lFormat;
        },
      };
      if (MethodesObjet_1.MethodesObjet.isNumber(aDuree)) {
        let lDureeEnMS = _get(
          aDuree * C_MilliSecondesParSeconde * C_SecondesParJour,
        );
        lResult.heures = Math.floor(lDureeEnMS / (60 * 60 * 1000));
        lDureeEnMS = lDureeEnMS - lResult.heures * (60 * 60 * 1000);
        lResult.minutes = Math.floor(lDureeEnMS / (60 * 1000));
      }
      return lResult;
    };
    TUtilitaireDuree.dureeEnJoursHeuresMinutes = function (aDuree) {
      let lResult = TUtilitaireDuree.dureeEnHeuresMinutes(aDuree);
      lResult.jours = Math.floor(lResult.heures / C_HeuresParJour);
      lResult.heures = lResult.heures % C_HeuresParJour;
      return lResult;
    };
    TUtilitaireDuree.heuresEnDuree = function (aVal) {
      if (MethodesObjet_1.MethodesObjet.isNumber(aVal)) {
        return aVal / C_HeuresParJour;
      }
      return 0;
    };
    TUtilitaireDuree.dureeEnMin = function (aDuree, aSansArrondi) {
      if (MethodesObjet_1.MethodesObjet.isNumber(aDuree)) {
        return _get(aDuree * C_MinutesParJour, aSansArrondi);
      }
      return 0;
    };
    TUtilitaireDuree.minEnDuree = function (aVal) {
      if (MethodesObjet_1.MethodesObjet.isNumber(aVal)) {
        return aVal / C_MinutesParJour;
      }
      return 0;
    };
    TUtilitaireDuree.dureeEnMs = function (aDuree, aSansArrondi) {
      if (MethodesObjet_1.MethodesObjet.isNumber(aDuree)) {
        return _get(
          aDuree * C_MilliSecondesParSeconde * C_SecondesParJour,
          aSansArrondi,
        );
      }
      return 0;
    };
    TUtilitaireDuree.msEnDuree = function (aVal) {
      if (MethodesObjet_1.MethodesObjet.isNumber(aVal)) {
        return aVal / (C_MilliSecondesParSeconde * C_SecondesParJour);
      }
      return 0;
    };
    TUtilitaireDuree.minEnMs = function (aVal) {
      if (MethodesObjet_1.MethodesObjet.isNumber(aVal)) {
        return aVal * C_SecondesParMinute * C_MilliSecondesParSeconde;
      }
      return 0;
    };
    function _get(aVal, aSansArrondi) {
      return aSansArrondi === true ? aVal : Math.round(aVal);
    }
  },
  fn: 'utilitaireduree.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GDate = exports.ObjetDate = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const TypeDomaine_1 = require('TypeDomaine');
    const TypeFormatDureeEnChaine_1 = require('TypeFormatDureeEnChaine');
    const UtilitaireDuree_1 = require('UtilitaireDuree');
    const IEHtml = require('IEHtml');
    class ObjetDate {
      constructor() {
        this.DureeMillisecondes = 1;
        this.DureeSecondes = 1000 * this.DureeMillisecondes;
        this.DureeMinutes = 60 * this.DureeSecondes;
        this.DureeHeures = 60 * this.DureeMinutes;
        this.DureeJours = 24 * this.DureeHeures;
        this.DureeSemaines = 7 * this.DureeJours;
        this.semainesParAn = 52;
        this.aujourdhui = new Date();
        this.demain = new Date();
        this.demain.setDate(this.demain.getDate() + 1);
        this.hier = new Date();
        this.hier.setDate(this.hier.getDate() - 1);
        this.parametres = {
          numeroPremiereSemaine: null,
          formatDureeEnChaine:
            TypeFormatDureeEnChaine_1.TypeFormatDureeEnChaine.fdcHeuresMinutes,
        };
        this._cacheSemainesCalendaires = {};
      }
      setDonnees(
        APremierLundi,
        aPremiereDate,
        aDerniereDate,
        APlacesParJour,
        APlacesParHeure,
        ADureeSequence,
        APremiereHeure,
        AListeHeures1,
        AListeHeures2,
        aJoursOuvres,
        aJour,
      ) {
        this.PremierLundi = APremierLundi;
        this.premiereDate = aPremiereDate;
        this.derniereDate = aDerniereDate;
        this.PlacesParJour = APlacesParJour;
        this.PlacesParHeure = APlacesParHeure;
        this.DureeSequence = ADureeSequence;
        this.PremiereHeure = APremiereHeure;
        this.ListeHeures =
          AListeHeures1 || new ObjetListeElements_1.ObjetListeElements();
        this.ListeHeuresFin = AListeHeures2;
        this.joursOuvres =
          aJoursOuvres || new TypeDomaine_1.TypeDomaine(true, 7);
        this.jour = this.getDateDemiJour(aJour || new Date());
      }
      setParametresDate(aParams) {
        Object.assign(this.parametres, aParams);
        return this;
      }
      getDerniereDate() {
        return this.derniereDate;
      }
      estUnJourOuvre(aDate) {
        return this.joursOuvres.getValeur(GDate.getJourDeDate(aDate) + 1);
      }
      estDateEgale(aDate1, aDate2) {
        if (aDate1 && aDate2) {
          if (!this.estDateValide(aDate1) || !this.estDateValide(aDate2)) {
            return false;
          }
          return aDate1.getTime() - aDate2.getTime() === 0;
        } else {
          return false;
        }
      }
      estJourEgal(aDate1, aDate2) {
        return (
          aDate1 &&
          aDate2 &&
          aDate1.getDate() === aDate2.getDate() &&
          aDate1.getMonth() === aDate2.getMonth() &&
          aDate1.getFullYear() === aDate2.getFullYear()
        );
      }
      estJourSemaineEgal(aDate1, aDate2) {
        return (
          aDate1 &&
          aDate2 &&
          aDate1.getDay() === aDate2.getDay() &&
          aDate1.getMonth() === aDate2.getMonth() &&
          aDate1.getFullYear() === aDate2.getFullYear()
        );
      }
      estJourCourant(aDate, aBorner) {
        return this.estJourEgal(aDate, this.getDateCourante(aBorner));
      }
      estAvantJourCourant(aDate, aBorner) {
        if (aDate) {
          if (!this.estDateValide(aDate)) {
            return false;
          }
          return aDate.getTime() - this.getDateCourante(aBorner).getTime() < 0;
        } else {
          return false;
        }
      }
      estAvantJour(aDate1, aDate2) {
        if (aDate1 && aDate2) {
          if (!this.estDateValide(aDate1) || !this.estDateValide(aDate2)) {
            return false;
          }
          return aDate1.getTime() - aDate2.getTime() < 0;
        }
      }
      estDateValide(aDate) {
        return (
          MethodesObjet_1.MethodesObjet.isDate(aDate) && !isNaN(aDate.getTime())
        );
      }
      getDateJour(aDate, aBorner = false) {
        let lDate = aDate;
        if (!this.estDateValide(aDate)) {
          lDate = new Date();
        }
        if (aBorner) {
          lDate = this.getDateBornee(lDate);
        }
        return new Date(lDate.getFullYear(), lDate.getMonth(), lDate.getDate());
      }
      getPrecedentJourOuvre(aDate) {
        let lDate = aDate;
        do {
          lDate = this.getJourSuivant(lDate, -1);
        } while (!this.estUnJourOuvre(lDate) && lDate > this.premiereDate);
        return lDate;
      }
      getProchainJourOuvre(aDate) {
        let lDate = aDate;
        do {
          lDate = this.getJourSuivant(lDate);
        } while (!this.estUnJourOuvre(lDate) && lDate < this.derniereDate);
        return lDate;
      }
      getDateBornee(aDate) {
        if (
          aDate < this.premiereDate &&
          !this.estJourEgal(aDate, this.premiereDate)
        ) {
          return new Date(this.premiereDate.getTime());
        }
        if (
          aDate > this.derniereDate &&
          !this.estJourEgal(aDate, this.derniereDate)
        ) {
          return new Date(this.derniereDate.getTime());
        }
        return aDate;
      }
      getDateCourante(aBorner = false) {
        let lDate = new Date();
        lDate = new Date(
          lDate.getFullYear(),
          lDate.getMonth(),
          lDate.getDate(),
        );
        return aBorner === false ? lDate : this.getDateBornee(lDate);
      }
      getDateHeureCourante() {
        return this.getDateBornee(new Date());
      }
      dateEntreLesDates(
        aDate,
        aBorneDateDebut,
        aBorneDateFin,
        aComparaisonTime = false,
      ) {
        if (!aDate) {
          return false;
        }
        return (
          (!aBorneDateDebut ||
            aDate >= aBorneDateDebut ||
            (aComparaisonTime !== true &&
              this.estJourEgal(aDate, aBorneDateDebut))) &&
          (!aBorneDateFin ||
            aDate <= aBorneDateFin ||
            (aComparaisonTime !== true &&
              this.estJourEgal(aDate, aBorneDateFin)))
        );
      }
      estDateJourAvant(aDate1, aDate2) {
        if (aDate1 && aDate2) {
          if (!this.estDateValide(aDate1) || !this.estDateValide(aDate2)) {
            return false;
          }
          return (
            this.estAvantJour(aDate1, aDate2) &&
            !this.estJourEgal(aDate1, aDate2)
          );
        } else {
          return false;
        }
      }
      estDateDansAnneeScolaire(aDate) {
        return this.dateEntreLesDates(
          aDate,
          this.premiereDate,
          this.derniereDate,
        );
      }
      getDateDemiJour(aDate) {
        return new Date(
          aDate.getFullYear(),
          aDate.getMonth(),
          aDate.getDate(),
          12,
        );
      }
      premierJourOuvreDeLaSemaine(aNrSemaine) {
        return IE.Cycles.datePremierJourOuvreCycle(aNrSemaine);
      }
      dernierJourOuvreDeLaSemaine(aNrSemaine) {
        return IE.Cycles.dateDernierJourOuvreCycle(aNrSemaine);
      }
      getJour(aDate, N = 0) {
        return new Date(
          aDate.getFullYear(),
          aDate.getMonth(),
          aDate.getDate(),
          N === null || N === undefined ? 0 : 24 * N,
        );
      }
      getJourDeSemaine(ADate, B) {
        return (7 + ADate.getDay() - (B ? this.PremierLundi.getDay() : 1)) % 7;
      }
      getSemaineSuivante(ADate, N = 1) {
        return new Date(
          ADate.getTime() +
            (N === null || N === undefined ? 1 : N) * this.DureeSemaines,
        );
      }
      getJourSuivant(ADate, N = 1) {
        if (!ADate || !ADate.getTime) {
          return null;
        }
        let lDate = new Date(ADate.getTime());
        const lNombreJours = MethodesObjet_1.MethodesObjet.isNumber(N) ? N : 1;
        lDate.setDate(lDate.getDate() + lNombreJours);
        if (
          Math.abs(lNombreJours) === 1 &&
          ADate.getDate() === lDate.getDate()
        ) {
          const lDateCorrigee = new Date(ADate.getTime());
          lDateCorrigee.setHours(ADate.getHours() + 1);
          if (lDateCorrigee.getDate() !== ADate.getDate()) {
            lDateCorrigee.setHours(ADate.getHours() - 1);
          }
          lDateCorrigee.setDate(lDateCorrigee.getDate() + lNombreJours);
          lDate = lDateCorrigee;
        }
        return lDate;
      }
      estAnneeBissextile(aAnnee) {
        return new Date(aAnnee, 1, 29).getDate() === 29;
      }
      estUnJourDuWE(AAnnee, AMois, AJour) {
        const D = new Date(AAnnee, AMois, AJour).getDay();
        return D === 0 || D === 6;
      }
      getNombreJoursDuMois(AAnnee, AMois) {
        AMois = (AMois + 1) % 12;
        if (AMois === 0) {
          AAnnee++;
        }
        return new Date(AAnnee, AMois, 0).getDate();
      }
      getPremierJourDuMois(AAnnee, AMois) {
        return new Date(AAnnee, AMois, 1, 12);
      }
      getPremierLundiDuMois(AAnnee, AMois) {
        const LJour = this.getPremierJourDuMois(AAnnee, AMois),
          lJourPremierLundi = this.PremierLundi
            ? GDate.getJourDeSemaine(this.PremierLundi)
            : 0;
        return this.getJourSuivant(
          LJour,
          (lJourPremierLundi - (7 + GDate.getJourDeSemaine(LJour))) % 7,
        );
      }
      getDernierJourDuMois(AAnnee, AMois) {
        return new Date(
          AAnnee,
          AMois,
          this.getNombreJoursDuMois(AAnnee, AMois),
          12,
        );
      }
      estUnJourDuMois(AAnnee, AMois, AJour) {
        return new Date(AAnnee, AMois, AJour).getMonth() === AMois;
      }
      estHeureIdentique(aDate1, aDate2) {
        return (
          aDate1.getHours() === aDate2.getHours() &&
          aDate1.getMinutes() === aDate2.getMinutes()
        );
      }
      jourEstDansLaPeriode(AAnnee, AMois, AJour, ADateDebut, ADateFin) {
        const LDate = new Date(AAnnee, AMois, AJour);
        return LDate >= ADateDebut && LDate <= ADateFin;
      }
      strMoisCourt(AAnnee, AMois, AAvecAnnee) {
        return (
          ObjetTraduction_1.GTraductions.getValeur('MoisCourt')[AMois] +
          (AAvecAnnee ? '&nbsp;' + AAnnee : '')
        );
      }
      nombreMoisSurPeriode(ADateDebut, ADateFin) {
        return (
          12 * (ADateFin.getFullYear() - ADateDebut.getFullYear()) +
          (ADateFin.getMonth() - ADateDebut.getMonth()) +
          1
        );
      }
      nombresSemainesDansLAnnee(aSemaine) {
        let lDate;
        if (aSemaine > 0) {
          lDate = IE.Cycles.dateDebutCycle(aSemaine);
        } else {
          lDate = this.PremierLundi;
        }
        return this.getNombresSemainesPourLAnnee(lDate.getFullYear());
      }
      getNombresSemainesPourLAnnee(aAnnee) {
        const lDate = new Date(aAnnee, 0, 1);
        const lDay = this.getJourDeDate(lDate);
        return lDay === 3 ||
          (lDay === 2 && this.estAnneeBissextile(lDate.getFullYear()))
          ? this.semainesParAn + 1
          : this.semainesParAn;
      }
      getJourDeDate(ADate) {
        return (ADate.getDay() + 7 - 1) % 7;
      }
      getFuseau(aDate) {
        return aDate ? aDate.getTimezoneOffset() / 60 : 0;
      }
      getEcartFuseau(aDate1, aDate2) {
        return this.getFuseau(aDate1) - this.getFuseau(aDate2);
      }
      getSemaine(aDate) {
        return IE.Cycles.cycleDeLaDate(aDate || new Date());
      }
      getNbrJoursDepuisPremiereLundi(aDate) {
        return this.getNbrJoursEntreDeuxDates(this.PremierLundi, aDate);
      }
      getNbrJoursEntreDeuxDates(aDateDebut, aDateFin) {
        if (
          !aDateDebut ||
          !aDateDebut.getFullYear ||
          !aDateFin ||
          !aDateFin.getFullYear
        ) {
          return 0;
        }
        return (
          Date.UTC(
            aDateFin.getFullYear(),
            aDateFin.getMonth(),
            aDateFin.getDate(),
          ) /
            this.DureeJours -
          Date.UTC(
            aDateDebut.getFullYear(),
            aDateDebut.getMonth(),
            aDateDebut.getDate(),
          ) /
            this.DureeJours
        );
      }
      getSemaineCalendaire() {
        return (
          1 +
          Math.round(
            (this.PremierLundi.getTime() -
              new Date(this.PremierLundi.getFullYear(), 0, 1).getTime()) /
              this.DureeSemaines,
          )
        );
      }
      semaineToCalendaire(aSemaine, aNumeroPremiereSemaine) {
        let lNumero = aNumeroPremiereSemaine;
        if (!MethodesObjet_1.MethodesObjet.isNumber(lNumero)) {
          lNumero = this.parametres.numeroPremiereSemaine;
        }
        if (!MethodesObjet_1.MethodesObjet.isNumber(lNumero)) {
          lNumero = 1;
        }
        if (lNumero < 0) {
          if (!this._cacheSemainesCalendaires[aSemaine]) {
            const lNbSemaines = this.nombresSemainesDansLAnnee(aSemaine);
            if (aSemaine <= 1) {
              this._cacheSemainesCalendaires[aSemaine] =
                ((aSemaine - 1 + (this.getSemaineCalendaire() - 1)) %
                  lNbSemaines) +
                1;
            } else if (aSemaine > 0) {
              let lSemaineCalPrec =
                this._cacheSemainesCalendaires[aSemaine - 1];
              if (!lSemaineCalPrec) {
                lSemaineCalPrec = this.semaineToCalendaire(
                  aSemaine - 1,
                  lNumero,
                );
              }
              this._cacheSemainesCalendaires[aSemaine] =
                lSemaineCalPrec + 1 > lNbSemaines ? 1 : lSemaineCalPrec + 1;
            }
          }
          return this._cacheSemainesCalendaires[aSemaine];
        }
        return aSemaine + lNumero - 1;
      }
      strDateCalendaireDeSemaine(aSemaine, avecDuAu) {
        const lNumeroSemaine = this.semaineToCalendaire(aSemaine);
        const H = [];
        H.push(
          ObjetTraduction_1.GTraductions.getValeur('Semaine') +
            ' ' +
            lNumeroSemaine,
        );
        if (avecDuAu === true) {
          const lDateDeb = this.formatDate(
            this.premierJourOuvreDeLaSemaine(aSemaine),
            '%JJ/%MM/%AAAA',
          );
          const lDateFin = this.formatDate(
            this.dernierJourOuvreDeLaSemaine(aSemaine),
            '%JJ/%MM/%AAAA',
          );
          H.push(', ');
          H.push(
            ObjetTraduction_1.GTraductions.getValeur('Du') + ' ' + lDateDeb,
          );
          H.push(' ');
          H.push(
            ObjetTraduction_1.GTraductions.getValeur('Au') + ' ' + lDateFin,
          );
        }
        return H.join('');
      }
      getDifferenceJours(aDate1, aDate2) {
        const lJour1 = aDate1
          ? Math.floor(this.getJour(aDate1).getTime() / this.DureeJours)
          : 0;
        const lJour2 = aDate2
          ? Math.floor(this.getJour(aDate2).getTime() / this.DureeJours)
          : 0;
        return lJour1 - lJour2;
      }
      getDifferenceJoursPar24h(aDate1, aDate2) {
        const lDureeInMs =
          this.estDateValide(aDate1) && this.estDateValide(aDate2)
            ? aDate1.getTime() - aDate2.getTime()
            : 0;
        return Math.floor(lDureeInMs / this.DureeJours);
      }
      getDifferenceTime(aDate1, aDate2) {
        const lDureeInMs =
          this.estDateValide(aDate1) && this.estDateValide(aDate2)
            ? aDate1.getTime() - aDate2.getTime()
            : 0;
        const reste_heures =
          lDureeInMs -
          Math.floor(lDureeInMs / this.DureeJours) * this.DureeJours;
        const nb_heures = Math.floor(reste_heures / this.DureeHeures);
        const reste_minutes =
          lDureeInMs -
          Math.floor(lDureeInMs / this.DureeHeures) * this.DureeHeures;
        const nb_minutes = Math.floor(reste_minutes / this.DureeMinutes);
        const reste_secondes =
          lDureeInMs -
          Math.floor(lDureeInMs / this.DureeMinutes) * this.DureeMinutes;
        const nb_secondes = Math.floor(reste_secondes / this.DureeSecondes);
        return (
          (nb_heures < 10 ? '0' : '') +
          nb_heures +
          ':' +
          (nb_minutes < 10 ? '0' : '') +
          nb_minutes +
          ':' +
          (nb_secondes < 10 ? '0' : '') +
          nb_secondes
        );
      }
      formatDate(ADate, AFormat) {
        if (!ADate || !MethodesObjet_1.MethodesObjet.isDate(ADate)) {
          IE.log.addLog(
            "ObjetDate.formatDate, ADate n'est pas une date : " + ADate,
          );
          return '';
        }
        if (!AFormat || !MethodesObjet_1.MethodesObjet.isString(AFormat)) {
          IE.log.addLog(
            "ObjetDate.formatDate, AFormat n'est pas format valide : " +
              AFormat,
          );
          return '';
        }
        AFormat = AFormat.replace(
          /\[(.*?)\]/gi,
          !this.estJourEgal(ADate, this.aujourdhui)
            ? !this.estJourEgal(ADate, this.demain)
              ? !this.estJourEgal(ADate, this.hier)
                ? '$1'
                : ObjetTraduction_1.GTraductions.getValeur('Hier')
              : ObjetTraduction_1.GTraductions.getValeur('Demain')
            : ObjetTraduction_1.GTraductions.getValeur('Aujourdhui'),
        );
        const LHour = ADate.getHours();
        const LMinute = ADate.getMinutes();
        const LSecond = ADate.getSeconds();
        const LDay = this.getJourDeDate(ADate);
        const LDate = ADate.getDate();
        const LMonth = ADate.getMonth() + 1;
        const LYear = ADate.getFullYear();
        AFormat = AFormat.replace('%hh', (LHour < 10 ? '0' : '') + LHour);
        AFormat = AFormat.replace('%xh', LHour + '');
        AFormat = AFormat.replace('%mm', (LMinute < 10 ? '0' : '') + LMinute);
        AFormat = AFormat.replace('%ss', (LSecond < 10 ? '0' : '') + LSecond);
        AFormat = AFormat.replace(
          '%sh',
          ObjetTraduction_1.GTraductions.getValeur('date.separateurHeure'),
        );
        AFormat = AFormat.replace(
          '%JJJJ',
          ObjetTraduction_1.GTraductions.getValeur('Jours')[LDay],
        );
        AFormat = AFormat.replace(
          '%Jjjj',
          ObjetTraduction_1.GTraductions.getValeur('Jours')[LDay].ucfirst(),
        );
        AFormat = AFormat.replace(
          '%JJJ',
          ObjetTraduction_1.GTraductions.getValeur('JoursCourt')[LDay],
        );
        AFormat = AFormat.replace(
          '%Jjj',
          ObjetTraduction_1.GTraductions.getValeur('JoursCourt')[
            LDay
          ].ucfirst(),
        );
        AFormat = AFormat.replace('%JJ', (LDate < 10 ? '0' : '') + LDate);
        AFormat = AFormat.replace('%J', LDate + '');
        AFormat = AFormat.replace(
          '%MMMM',
          ObjetTraduction_1.GTraductions.getValeur('Mois')[LMonth - 1],
        );
        AFormat = AFormat.replace(
          '%MMM',
          ObjetTraduction_1.GTraductions.getValeur('MoisCourt')[LMonth - 1],
        );
        AFormat = AFormat.replace(
          '%Mmm',
          ObjetTraduction_1.GTraductions.getValeur('MoisCourt')[
            LMonth - 1
          ].ucfirst(),
        );
        AFormat = AFormat.replace('%MM', (LMonth < 10 ? '0' : '') + LMonth);
        AFormat = AFormat.replace('%AAAA', LYear + '');
        AFormat = AFormat.replace(
          '%AA',
          (LYear % 100 < 10 ? '0' : '') + (LYear % 100),
        );
        return AFormat;
      }
      estDateParticulier(ADate) {
        return (
          this.estJourEgal(ADate, this.aujourdhui) ||
          this.estJourEgal(ADate, this.demain) ||
          this.estJourEgal(ADate, this.hier)
        );
      }
      formatDureeEnMillisecondes(
        aDureeEnMillisecondes,
        aFormat,
        aForcerFormatDuree,
      ) {
        if (!MethodesObjet_1.MethodesObjet.isNumber(aDureeEnMillisecondes)) {
          return '';
        }
        let lFormatDureeEnChaine = this.parametres.formatDureeEnChaine;
        if (MethodesObjet_1.MethodesObjet.isNumber(aForcerFormatDuree)) {
          lFormatDureeEnChaine = aForcerFormatDuree;
        }
        switch (lFormatDureeEnChaine) {
          case TypeFormatDureeEnChaine_1.TypeFormatDureeEnChaine
            .fdcHeuresMinutes:
          case TypeFormatDureeEnChaine_1.TypeFormatDureeEnChaine
            .fdcPersonnalise: {
            let lFormat = aFormat || '%hh%sh%mm';
            lFormat = lFormat.replace(
              '%sh',
              ObjetTraduction_1.GTraductions.getValeur('date.separateurHeure'),
            );
            if (
              lFormat.lastIndexOf('%hh') > -1 ||
              lFormat.lastIndexOf('%xh') > -1
            ) {
              const LHour = Math.floor(
                aDureeEnMillisecondes / this.DureeHeures,
              );
              lFormat = lFormat.replace('%hh', (LHour < 10 ? '0' : '') + LHour);
              lFormat = lFormat.replace('%xh', LHour + '');
              aDureeEnMillisecondes =
                aDureeEnMillisecondes - LHour * this.DureeHeures;
            }
            if (
              lFormat.lastIndexOf('%mm') > -1 ||
              lFormat.lastIndexOf('%xm') > -1
            ) {
              const LMinute = Math.floor(
                aDureeEnMillisecondes / this.DureeMinutes,
              );
              lFormat = lFormat.replace(
                '%mm',
                (LMinute < 10 ? '0' : '') + LMinute,
              );
              lFormat = lFormat.replace('%xm', LMinute + '');
              aDureeEnMillisecondes =
                aDureeEnMillisecondes - LMinute * this.DureeMinutes;
            }
            const LSecond = Math.floor(
              aDureeEnMillisecondes / this.DureeSecondes,
            );
            lFormat = lFormat.replace(
              '%ss',
              (LSecond < 10 ? '0' : '') + LSecond,
            );
            return lFormat;
          }
          case TypeFormatDureeEnChaine_1.TypeFormatDureeEnChaine
            .fdcHeuresCentiemes: {
            const lNbHeures = Math.floor(
              aDureeEnMillisecondes / GDate.DureeHeures,
            );
            let lMinutesEnCentiemes = Math.floor(
              (aDureeEnMillisecondes / GDate.DureeHeures - lNbHeures) * 100,
            );
            if (lMinutesEnCentiemes < 10) {
              lMinutesEnCentiemes = '0' + lMinutesEnCentiemes;
            }
            return lNbHeures + ',' + lMinutesEnCentiemes;
          }
          case TypeFormatDureeEnChaine_1.TypeFormatDureeEnChaine.fdcSequences: {
            const lNbSequences = Math.round10(
              aDureeEnMillisecondes /
                UtilitaireDuree_1.TUtilitaireDuree.dureeEnMs(
                  this.DureeSequence,
                ),
              -2,
            );
            const lPartieEntiere = Math.floor(lNbSequences);
            let lPartieDecimale = Math.floor(
              (lNbSequences - lPartieEntiere) * 100,
            );
            if (lPartieDecimale < 10) {
              lPartieDecimale = '0' + lPartieDecimale;
            }
            return lPartieEntiere + ',' + lPartieDecimale;
          }
          default:
        }
        return '';
      }
      dureeEnMillisecondesToHMS(aDureeEnMillisecondes) {
        const lResult = { heures: 0, minutes: 0, secondes: 0 };
        if (!MethodesObjet_1.MethodesObjet.isNumber(aDureeEnMillisecondes)) {
          return lResult;
        }
        lResult.heures = Math.floor(aDureeEnMillisecondes / this.DureeHeures);
        aDureeEnMillisecondes =
          aDureeEnMillisecondes - lResult.heures * this.DureeHeures;
        lResult.minutes = Math.floor(aDureeEnMillisecondes / this.DureeMinutes);
        aDureeEnMillisecondes =
          aDureeEnMillisecondes - lResult.minutes * this.DureeMinutes;
        lResult.secondes = Math.floor(
          aDureeEnMillisecondes / this.DureeSecondes,
        );
        return lResult;
      }
      hmsToDureeEnMillisecondes(aHMS) {
        const lHMS = {
          heures: aHMS && aHMS.heures ? aHMS.heures : 0,
          minutes: aHMS && aHMS.minutes ? aHMS.minutes : 0,
          secondes: aHMS && aHMS.secondes ? aHMS.secondes : 0,
        };
        return (
          lHMS.heures * this.DureeHeures +
          lHMS.minutes * this.DureeMinutes +
          lHMS.secondes * this.DureeSecondes
        );
      }
      formatDureeEnPlaces(aPlaces, aFormat, aForcerFormatDuree) {
        if (!MethodesObjet_1.MethodesObjet.isNumber(aPlaces)) {
          return '';
        }
        return this.formatDureeEnMillisecondes(
          this.nombrePlacesEnMillisecondes(aPlaces),
          aFormat,
          aForcerFormatDuree,
        );
      }
      enCentiemeDHeure(aDureeEnMillisecondes) {
        const lDuree = Math.floor(aDureeEnMillisecondes);
        if (!MethodesObjet_1.MethodesObjet.isNumber(lDuree)) {
          return '';
        }
        const lNbHeures = Math.floor(lDuree / GDate.DureeHeures);
        let lMinutesEnCentiemes = Math.floor(
          (lDuree / GDate.DureeHeures - lNbHeures) * 100,
        );
        if (lMinutesEnCentiemes < 10) {
          lMinutesEnCentiemes = '0' + lMinutesEnCentiemes;
        }
        return lNbHeures + ',' + lMinutesEnCentiemes;
      }
      strSemaine(
        aNumeroSemaine,
        aFormatDebut,
        aFormatFin,
        aSeparateur1,
        aSeparateur2,
        aSeparateur3,
      ) {
        const lDateDeb = this.formatDate(
          this.premierJourOuvreDeLaSemaine(aNumeroSemaine),
          aFormatDebut,
        );
        const lDateFin = this.formatDate(
          this.dernierJourOuvreDeLaSemaine(aNumeroSemaine),
          aFormatFin,
        );
        return (
          (aSeparateur1 || '') +
          lDateDeb +
          (aSeparateur2 || '') +
          lDateFin +
          (aSeparateur3 || '')
        );
      }
      strSemaineSelonCycle(
        aCycle,
        aNumeroSemaine,
        aFormatDebut,
        aFormatFin,
        aSeparateur1,
        aSeparateur2,
        aSeparateur3,
      ) {
        const lDateDeb = this.formatDate(
          aCycle.datePremierJourOuvreCycle(aNumeroSemaine),
          aFormatDebut,
        );
        const lDateFin = this.formatDate(
          aCycle.dateDernierJourOuvreCycle(aNumeroSemaine),
          aFormatFin,
        );
        return (
          (aSeparateur1 || '') +
          lDateDeb +
          (aSeparateur2 || '') +
          lDateFin +
          (aSeparateur3 || '')
        );
      }
      strDomaine(
        aDomaine,
        aFormatDebut,
        aFormatFin,
        aSeparateur1,
        aSeparateur2,
        aSeparateur3,
      ) {
        const lDateDeb = this.formatDate(
          IE.Cycles.datePremierJourOuvreCycle(aDomaine.getPremierePosition()),
          aFormatDebut,
        );
        const lDateFin = this.formatDate(
          IE.Cycles.dateDernierJourOuvreCycle(aDomaine.getDernierePosition()),
          aFormatFin,
        );
        return (
          (aSeparateur1 || '') +
          lDateDeb +
          (aSeparateur2 || '') +
          lDateFin +
          (aSeparateur3 || '')
        );
      }
      strDates(aDateDebut, aDateFin, aParams) {
        const lParams = {
          sansHoraire: false,
          sansCrochet: false,
          formatDate: '%J %MMMM',
        };
        $.extend(lParams, aParams);
        const formatHeure =
          ' %hh' +
          ObjetTraduction_1.GTraductions.getValeur('date.separateurHeure') +
          '%mm';
        const lResult = [];
        if (GDate.getNbrJoursEntreDeuxDates(aDateDebut, aDateFin) >= 1) {
          if (lParams.sansHoraire) {
            lResult.push(
              this.formatDate(
                aDateDebut,
                ObjetTraduction_1.GTraductions.getValeur('Du') +
                  ' ' +
                  lParams.formatDate,
              ),
            );
            lResult.push(' ');
            lResult.push(
              this.formatDate(
                aDateFin,
                ObjetTraduction_1.GTraductions.getValeur('Au') +
                  ' ' +
                  lParams.formatDate,
              ),
            );
          } else {
            lResult.push(
              this.formatDate(
                aDateDebut,
                ObjetTraduction_1.GTraductions.getValeur('Du') +
                  ' ' +
                  lParams.formatDate,
              ) +
                ' ' +
                (estMinuit.call(this, aDateDebut)
                  ? ''
                  : GDate.formatDate(
                      aDateDebut,
                      ObjetTraduction_1.GTraductions.getValeur('A') +
                        formatHeure,
                    )),
            );
            lResult.push(' ');
            lResult.push(
              this.formatDate(
                aDateFin,
                ObjetTraduction_1.GTraductions.getValeur('Au') +
                  ' ' +
                  lParams.formatDate,
              ) +
                ' ' +
                (estMinuit.call(this, aDateFin)
                  ? ''
                  : GDate.formatDate(
                      aDateFin,
                      ObjetTraduction_1.GTraductions.getValeur('A') +
                        formatHeure,
                    )),
            );
          }
        } else if (GDate.estDateEgale(aDateDebut, aDateFin)) {
          lResult.push(
            GDate.formatDate(
              aDateDebut,
              (lParams.sansCrochet ? '' : '[') +
                ObjetTraduction_1.GTraductions.getValeur('Le') +
                ' ' +
                lParams.formatDate +
                (lParams.sansCrochet ? '' : ']'),
            ),
          );
          lResult.push(' ');
          lResult.push(
            lParams.sansHoraire
              ? ''
              : estMinuit.call(this, aDateFin)
                ? ''
                : GDate.formatDate(
                    aDateFin,
                    ObjetTraduction_1.GTraductions.getValeur('A') + formatHeure,
                  ),
          );
        } else {
          lResult.push(
            GDate.formatDate(
              aDateDebut,
              (lParams.sansCrochet ? '' : '[') +
                ObjetTraduction_1.GTraductions.getValeur('Le') +
                ' ' +
                lParams.formatDate +
                (lParams.sansCrochet ? '' : ']'),
            ),
          );
          lResult.push(' ');
          lResult.push(
            lParams.sansHoraire
              ? ''
              : this.formatDate(
                  aDateDebut,
                  ObjetTraduction_1.GTraductions.getValeur('De') + formatHeure,
                ) +
                  ' ' +
                  GDate.formatDate(
                    aDateFin,
                    ObjetTraduction_1.GTraductions.getValeur('A') + formatHeure,
                  ),
          );
        }
        return lResult.join('');
      }
      strDatesAvecDemiJournees(
        aDateDebut,
        aDateDebutEstMatin,
        aDateFin,
        aDateFinEstMatin,
        aParams,
      ) {
        const lParams = { formatDate: '%JJ/%MM' };
        $.extend(lParams, aParams);
        const lResult = [];
        if (!aDateFin || GDate.estJourEgal(aDateDebut, aDateFin)) {
          const lEstJourneeComplete =
            !!aDateFin &&
            GDate.estJourEgal(aDateDebut, aDateFin) &&
            aDateDebutEstMatin !== aDateFinEstMatin;
          lResult.push(
            GDate.formatDate(
              aDateDebut,
              '[' +
                ObjetTraduction_1.GTraductions.getValeur('Le') +
                ' ' +
                lParams.formatDate +
                ']',
            ),
          );
          if (!lEstJourneeComplete) {
            lResult.push(
              ' ',
              aDateDebutEstMatin
                ? ObjetTraduction_1.GTraductions.getValeur('Matin')
                : ObjetTraduction_1.GTraductions.getValeur('ApresMidi'),
            );
          }
        } else {
          lResult.push(
            this.formatDate(
              aDateDebut,
              ObjetTraduction_1.GTraductions.getValeur('Du') +
                ' ' +
                lParams.formatDate,
            ),
          );
          if (!aDateDebutEstMatin) {
            lResult.push(
              ' ',
              ObjetTraduction_1.GTraductions.getValeur('ApresMidi'),
            );
          }
          lResult.push(' ');
          lResult.push(
            this.formatDate(
              aDateFin,
              ObjetTraduction_1.GTraductions.getValeur('Au') +
                ' ' +
                lParams.formatDate,
            ),
          );
          if (!!aDateFinEstMatin) {
            lResult.push(
              ' ',
              ObjetTraduction_1.GTraductions.getValeur('Matin'),
            );
          }
        }
        return lResult.join('');
      }
      placeAnnuelleEnDate(APlace, AEstDateFin) {
        const LJour = this.getJourSuivant(
          IE.Cycles.dateDebutPremierCycle(),
          Math.floor(APlace / this.PlacesParJour),
        );
        const lHrMin = this._getHrMinDeListeHeures(
          APlace % this.PlacesParJour,
          AEstDateFin,
        );
        return new Date(
          LJour.getFullYear(),
          LJour.getMonth(),
          LJour.getDate(),
          lHrMin.h,
          lHrMin.m,
        );
      }
      dateEnPlaceAnnuelle(aDate, aEstDateFin = false) {
        const lPlaceAnnuelleJour =
          this.getNbrJoursEntreDeuxDates(
            IE.Cycles.dateDebutPremierCycle(),
            aDate,
          ) * this.PlacesParJour;
        if (lPlaceAnnuelleJour < 0) {
          return 0;
        }
        return lPlaceAnnuelleJour + this._dateEnPlaceJour(aDate, aEstDateFin);
      }
      placeParJourEnDate(APlace) {
        const LJour = this.getDateCourante();
        const lHrMin = this._getHrMinDeListeHeures(APlace);
        return new Date(
          LJour.getFullYear(),
          LJour.getMonth(),
          LJour.getDate(),
          lHrMin.h,
          lHrMin.m,
        );
      }
      dateEnPlaceHebdomadaire(ADate, AEstDateFin = false) {
        let lJour = 0;
        const lResult = IE.Cycles.dateEnCycleEtJourCycle(ADate, null);
        if (lResult.trouve) {
          lJour = lResult.indice;
        } else {
          const lResult = IE.Cycles.dateEnCycleEtJourCycle(
            ADate,
            IE.Cycles.recherche.autoriserPrecedents,
          );
          if (lResult.trouve) {
            return lResult.indice * this.PlacesParJour - 1;
          }
        }
        return (
          lJour * this.PlacesParJour + this._dateEnPlaceJour(ADate, AEstDateFin)
        );
      }
      placeEnDate(aNumeroCycle, aPlace, aEstPlaceFin = false, aInstanceCycles) {
        const lCycles = aInstanceCycles || IE.Cycles,
          lNumeroJour = Math.floor(aPlace / this.PlacesParJour),
          lNumeroCycle = Math.max(1, aNumeroCycle),
          LJour = lCycles.jourCycleEnDate(lNumeroJour, lNumeroCycle);
        let lPlaceJour = aPlace % this.PlacesParJour;
        if (
          lNumeroJour >
          lCycles.cache.datesAfficheesParCycle[lNumeroCycle].length
        ) {
          lPlaceJour = this.PlacesParJour - 1;
        }
        const lHrMin = this._getHrMinDeListeHeures(lPlaceJour, aEstPlaceFin);
        return lHrMin && lHrMin.ok
          ? new Date(
              LJour.getFullYear(),
              LJour.getMonth(),
              LJour.getDate(),
              lHrMin.h,
              lHrMin.m,
            )
          : new Date(LJour.getFullYear(), LJour.getMonth(), LJour.getDate());
      }
      placeEnDateHeure(aPlace, aEstPlaceFin = false) {
        return this.placeEnDate(1, aPlace, aEstPlaceFin);
      }
      nombrePlacesEnDuree(aPlaces) {
        if (!MethodesObjet_1.MethodesObjet.isNumber(aPlaces)) {
          return 0;
        }
        return (aPlaces * this.DureeSequence) / this.PlacesParHeure;
      }
      minutesEnNombrePlaces(aDureeEnMinutes) {
        if (!MethodesObjet_1.MethodesObjet.isNumber(aDureeEnMinutes)) {
          return 0;
        }
        const lDuree1PlaceEnMinutes =
          UtilitaireDuree_1.TUtilitaireDuree.dureeEnMin(
            this.nombrePlacesEnDuree(1),
          );
        const lResult = aDureeEnMinutes / lDuree1PlaceEnMinutes;
        if (lResult !== Math.floor(lResult)) {
        }
        return lResult;
      }
      nombrePlacesEnMillisecondes(aPlaces) {
        return UtilitaireDuree_1.TUtilitaireDuree.dureeEnMs(
          this.nombrePlacesEnDuree(aPlaces),
        );
      }
      getDateDeChaine(aChaine, aDateDebut, aDateFin) {
        aDateDebut = aDateDebut || this.PremierLundi;
        aDateFin = aDateFin || this.derniereDate;
        const T = aChaine.split('/');
        if (T[2] && T[2].length === 2) {
          T[2] = '20' + T[2];
        }
        const lDate = new Date(T[2], T[1] - 1, T[0]);
        const lEstValide =
          (lDate.getFullYear() === parseInt(T[2]) ||
            lDate.getFullYear() === parseInt('20' + T[2], 10)) &&
          lDate.getMonth() === Number(T[1] - 1) &&
          lDate.getDate() === parseInt(T[0]) &&
          lDate >= aDateDebut &&
          lDate <= aDateFin;
        return lEstValide ? lDate : null;
      }
      getListeSemaines(aSemaineDebut, aSemaineFin, aGenreTri) {
        let lLibelle, LDateDeb, LDateFin;
        const lSemaineCourante = IE.Cycles.cycleDeLaDate(new Date());
        const lListeSemaines = new ObjetListeElements_1.ObjetListeElements();
        const lSemaineDeb = Math.max(0, aSemaineDebut);
        const lSemaineFin = Math.min(
          IE.Cycles.nombreCyclesAnneeScolaire(),
          aSemaineFin,
        );
        for (let lSemaine = lSemaineDeb; lSemaine <= lSemaineFin; lSemaine++) {
          if (lSemaine === lSemaineCourante) {
            lLibelle =
              ObjetTraduction_1.GTraductions.getValeur('SemaineEnCours');
          } else if (lSemaine === lSemaineCourante + 1) {
            lLibelle =
              ObjetTraduction_1.GTraductions.getValeur('SemaineSuivante');
          } else if (lSemaine === lSemaineCourante - 1) {
            lLibelle =
              ObjetTraduction_1.GTraductions.getValeur('SemainePrecedente');
          } else {
            LDateDeb = GDate.formatDate(
              IE.Cycles.dateDebutCycle(lSemaine),
              '%JJ/%MM',
            );
            LDateFin = GDate.formatDate(
              IE.Cycles.dateDernierJourOuvreCycle(lSemaine),
              '%JJ/%MM',
            );
            lLibelle =
              ObjetTraduction_1.GTraductions.getValeur('Du') +
              ' ' +
              LDateDeb +
              ' ' +
              ObjetTraduction_1.GTraductions.getValeur('Au') +
              ' ' +
              LDateFin;
          }
          lListeSemaines.addElement(
            new ObjetElement_1.ObjetElement(lLibelle, null, lSemaine),
          );
        }
        lListeSemaines.setTri([ObjetTri_1.ObjetTri.init('Genre')]);
        lListeSemaines.trier(aGenreTri);
        return lListeSemaines;
      }
      getListeMoisAPartirDeDate(
        aDateDebut,
        aDateFin,
        aFormatMois = '%MMMM %AAAA',
      ) {
        const lListeMois = new ObjetListeElements_1.ObjetListeElements();
        let lElement,
          lAnnee,
          lMois,
          lDate,
          lVrai = true;
        const lPremiereDate = aDateDebut || this.premiereDate,
          lDerniereDate = aDateFin || this.derniereDate,
          lAnneeDebut = lPremiereDate.getFullYear(),
          lMoisDebut = lPremiereDate.getMonth(),
          lAnneeFin = lDerniereDate.getFullYear(),
          lMoisFin = lDerniereDate.getMonth();
        if (
          this.estAvantJour(lPremiereDate, lDerniereDate) ||
          this.estJourEgal(lPremiereDate, lDerniereDate)
        ) {
          lMois = lMoisDebut;
          lAnnee = lAnneeDebut;
          while (lVrai) {
            if (
              (lMois >= lMoisFin && lAnnee >= lAnneeFin) ||
              lAnnee > lAnneeFin
            ) {
              lVrai = false;
            }
            lDate = new Date(lAnnee, lMois);
            lElement = new ObjetElement_1.ObjetElement(
              GDate.formatDate(lDate, aFormatMois).ucfirst(),
            );
            lElement.annee = lAnnee;
            lElement.mois = lMois;
            lDate = this.getPremierJourDuMois(lAnnee, lMois);
            lElement.dateDebut = lDate >= lPremiereDate ? lDate : lPremiereDate;
            lDate = this.getDernierJourDuMois(lAnnee, lMois);
            lElement.dateFin = lDate <= lDerniereDate ? lDate : lDerniereDate;
            lListeMois.addElement(lElement);
            lMois += 1;
            if (lMois > 11) {
              lAnnee += 1;
              lMois = 0;
            }
          }
        }
        return lListeMois;
      }
      parseHeureMinute(aValue, aDureeMinEnMin = 0, aDureeMaxEnMin = 1440) {
        function _estUnChiffre(aCar) {
          return /[0-9]/.test(aCar);
        }
        const lResult = { heure: 0, minute: 0, ok: false, erreurMinMax: false };
        const lDureeMinEnMin = aDureeMinEnMin || 0,
          lDureeMaxEnMin = aDureeMaxEnMin || 24 * 60;
        if (!MethodesObjet_1.MethodesObjet.isString(aValue)) {
          return lResult;
        }
        const lValue = aValue.trim();
        let lHeure,
          lMinute = 0;
        let lIndice = 0;
        let lZeroDevant = false;
        if (!_estUnChiffre(lValue[lIndice]) && lValue[lIndice] !== '+') {
          return lResult;
        }
        if (lValue[lIndice] === '+') {
          lIndice += 1;
          while (lIndice < lValue.length && lValue[lIndice] === ' ') {
            lIndice += 1;
          }
        }
        lZeroDevant = lValue[lIndice] === '0';
        lHeure = 0;
        while (lIndice < lValue.length && _estUnChiffre(lValue[lIndice])) {
          lHeure = lHeure * 10 + parseInt(lValue[lIndice], 10);
          lIndice += 1;
        }
        while (lIndice < lValue.length && !_estUnChiffre(lValue[lIndice])) {
          lIndice += 1;
        }
        if (lIndice >= lValue.length) {
          if (lZeroDevant || (lHeure >= 100 && lHeure * 60 >= lDureeMaxEnMin)) {
            lMinute = lHeure % 100;
            lHeure = Math.floor(lHeure / 100);
          } else {
            lMinute = 0;
          }
        } else {
          lMinute = 0;
          while (lIndice < lValue.length && _estUnChiffre(lValue[lIndice])) {
            lMinute = lMinute * 10 + parseInt(lValue[lIndice], 10);
            lIndice += 1;
          }
          while (lIndice < lValue.length && !_estUnChiffre(lValue[lIndice])) {
            lIndice += 1;
          }
          if (lIndice < lValue.length) {
            return lResult;
          }
        }
        if (lMinute >= 60 || lMinute < 0 || lHeure < 0) {
          return lResult;
        }
        lResult.heure = lHeure;
        lResult.minute = lMinute;
        if (
          lHeure * 60 + lMinute < lDureeMinEnMin ||
          lHeure * 60 + lMinute >= lDureeMaxEnMin
        ) {
          lResult.erreurMinMax = true;
          return lResult;
        }
        lResult.ok = true;
        return lResult;
      }
      dateEnPlaceJour(aDate, AEstDateFin = false) {
        return this._dateEnPlaceJour(aDate, AEstDateFin);
      }
      _dateEnPlaceJour(ADate, AEstDateFin) {
        let I;
        let lNbMinutesLibelleHeure;
        const lNbMinutesLibelleHeureDebut = this._getNbrMinutesLibelleHeure(0);
        for (I = this.PlacesParJour - 1; I >= 0; I--) {
          lNbMinutesLibelleHeure = this._getNbrMinutesLibelleHeure(I);
          if (lNbMinutesLibelleHeure < lNbMinutesLibelleHeureDebut) {
            lNbMinutesLibelleHeure += 24 * 60;
          }
          if (
            _GetNbrMinutes.call(this, ADate) - (AEstDateFin ? 1 : 0) >=
            lNbMinutesLibelleHeure
          ) {
            break;
          }
        }
        return Math.max(I, 0);
      }
      _getHrMinDeListeHeures(aPlace, aEstPlaceFin) {
        const lResult = { h: 0, m: 0, ok: false };
        let lChaine = null;
        let lElement = null;
        if (aEstPlaceFin) {
          lElement = this.ListeHeuresFin
            ? this.ListeHeuresFin.get(aPlace)
            : this.ListeHeures.get(aPlace + 1);
        } else {
          lElement = this.ListeHeures.get(aPlace);
        }
        if (lElement) {
          lChaine = lElement.getLibelle();
        }
        if (!lChaine || !lChaine.indexOf || !lChaine.split) {
          return lResult;
        }
        let lTab = lChaine.split(ObjetDate.separateurHeureDelphi);
        if (lTab.length < 2) {
          lTab = lChaine.split(':');
          if (lTab.length < 2) {
            return lResult;
          }
        }
        lResult.h = parseInt(lTab[0], 0) || 0;
        if (lTab.length > 1) {
          lResult.m = parseInt(lTab[1], 0) || 0;
        }
        lResult.ok = true;
        return lResult;
      }
      _getNbrMinutesLibelleHeure(I) {
        const lHrMin = this._getHrMinDeListeHeures(I);
        return lHrMin.h * 60 + lHrMin.m;
      }
    }
    exports.ObjetDate = ObjetDate;
    ObjetDate.separateurHeureDelphi = 'h';
    function estMinuit(aDate) {
      const lHeure = aDate.getHours();
      const lMin = aDate.getMinutes();
      return lHeure === 0 && lMin === 0;
    }
    function _GetNbrMinutes(aDate) {
      return aDate.getHours() * 60 + aDate.getMinutes();
    }
    const GDate = new ObjetDate();
    exports.GDate = GDate;
    IEHtml.setObjetDate(
      GDate.formatDate.bind(GDate),
      GDate.parseHeureMinute.bind(GDate),
    );
  },
  fn: 'objetdate.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.MoteurSelecteurDate = void 0;
    const ObjetDate_1 = require('ObjetDate');
    class MoteurSelecteurDate {
      constructor(aParams) {
        (this.options = {
          premiereDate: ObjetDate_1.GDate.premiereDate,
          derniereDate: ObjetDate_1.GDate.derniereDate,
          premiereDateSaisissable: undefined,
          afficherPremiereDateSaisissable: true,
          avecSelectionSemaine: false,
          joursSemaineValide: null,
          domaineValide: undefined,
          joursFeries: null,
          joursValidesAnnuels: undefined,
          estJoursValidesAnnuelsSelonPremiereDate: false,
          joursMarques: undefined,
          estJoursMarquesSelonPremiereDate: false,
        }),
          this.setOptions(aParams);
      }
      setOptions(aOptions) {
        Object.assign(this.options, aOptions);
        if (
          this.options.premiereDate &&
          this.options.derniereDate &&
          this.options.derniereDate < this.options.premiereDate
        ) {
          this.options.derniereDate = new Date(
            this.options.premiereDate.getTime(),
          );
        }
        if (this.options.premiereDateSaisissable) {
          this.options.premiereDateSaisissable = this.getDateBornee(
            this.options.premiereDateSaisissable,
          );
        }
        return this;
      }
      estDateValide(aDate) {
        if (!aDate || !aDate.getDay) {
          return false;
        }
        if (!this.estDateDansBorne(aDate, true)) {
          return false;
        }
        if (!this.estJoursSemaineValide(aDate)) {
          return false;
        }
        if (!IE.Cycles) {
          return true;
        }
        const lDateDebCycle = IE.Cycles.dateDebutPremierCycle();
        const lNbjours =
          ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(lDateDebCycle, aDate) + 1;
        if (
          this.options.joursFeries &&
          this.options.joursFeries.getValeur(lNbjours)
        ) {
          return false;
        }
        const lNbJoursPremDate = this.options
          .estJoursValidesAnnuelsSelonPremiereDate
          ? ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(
              this.options.premiereDate,
              aDate,
            )
          : ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(lDateDebCycle, aDate) +
            1;
        if (
          this.options.joursValidesAnnuels &&
          !this.options.joursValidesAnnuels.getValeur(lNbJoursPremDate)
        ) {
          return false;
        }
        if (this.options.domaineValide) {
          const lNumeroCycle = IE.Cycles.cycleDeLaDate(aDate);
          if (
            lNumeroCycle <= 0 ||
            !this.options.domaineValide.getValeur(lNumeroCycle)
          ) {
            return false;
          }
        }
        return true;
      }
      getPremiereDateValide() {
        return this.options.premiereDateSaisissable
          ? this.options.premiereDateSaisissable
          : this.options.premiereDate;
      }
      estJoursSemaineValide(aDate) {
        const lJour = ObjetDate_1.GDate.getJourDeDate(aDate);
        return this.options.joursSemaineValide
          ? this.options.joursSemaineValide.getValeur(lJour + 1)
          : true;
      }
      estDateDansBorne(aDate, aAvecDateValide) {
        const lPremiereDate = aAvecDateValide
          ? this.getPremiereDateValide()
          : this.options.premiereDate;
        if (
          lPremiereDate &&
          ObjetDate_1.GDate.getDifferenceJours(aDate, lPremiereDate) < 0
        ) {
          return false;
        }
        if (
          this.options.derniereDate &&
          ObjetDate_1.GDate.getDifferenceJours(
            aDate,
            this.options.derniereDate,
          ) > 0
        ) {
          return false;
        }
        return true;
      }
      getDateBornee(aDate, aAvecDateValide) {
        const lPremiereDate = aAvecDateValide
          ? this.getPremiereDateValide()
          : this.options.premiereDate;
        if (
          lPremiereDate &&
          aDate < lPremiereDate &&
          !ObjetDate_1.GDate.estJourEgal(aDate, lPremiereDate)
        ) {
          return new Date(lPremiereDate.getTime());
        }
        if (
          this.options.derniereDate &&
          aDate > this.options.derniereDate &&
          !ObjetDate_1.GDate.estJourEgal(aDate, this.options.derniereDate)
        ) {
          return new Date(this.options.derniereDate.getTime());
        }
        return new Date(aDate.getTime());
      }
      rechercheSuivantValide(aDate, aSensRechercheInverse) {
        if (this.options.avecSelectionSemaine) {
          return this._getSemaineSuivanteValide(
            aDate,
            aSensRechercheInverse,
            true,
          );
        } else {
          return this._getJourSuivantValide(aDate, aSensRechercheInverse, true);
        }
      }
      getDateSelonValidite(aDate) {
        if (this.options.derniereDate && aDate > this.options.derniereDate) {
          return (
            this._getJourSuivantValide(this.options.derniereDate, true) || aDate
          );
        }
        if (this.options.premiereDate && aDate < this.options.premiereDate) {
          return (
            this._getJourSuivantValide(this.options.premiereDate, false) ||
            aDate
          );
        }
        return this._getJourSuivantValide(aDate, false) || aDate;
      }
      _getJourSuivantValide(
        aDateCourant,
        aSensRechercheInverse,
        aAvecIncrement,
      ) {
        const lNrJours = aSensRechercheInverse ? -1 : 1;
        let lDateCourant = aAvecIncrement
          ? ObjetDate_1.GDate.getJourSuivant(aDateCourant, lNrJours)
          : aDateCourant;
        const lAvecArret =
          (aSensRechercheInverse && !this.getPremiereDateValide()) ||
          (!aSensRechercheInverse && !this.options.derniereDate);
        let lCompteurArret = 30;
        if (
          !this.estDateValide(lDateCourant) &&
          this.estDateDansBorne(lDateCourant, true)
        ) {
          do {
            lDateCourant = ObjetDate_1.GDate.getJourSuivant(
              lDateCourant,
              lNrJours,
            );
            if (lAvecArret) {
              lCompteurArret -= 1;
            }
          } while (
            !this.estDateValide(lDateCourant) &&
            this.estDateDansBorne(lDateCourant, true) &&
            lCompteurArret >= 0
          );
        }
        if (!this.estDateValide(lDateCourant)) {
          return null;
        } else {
          return lDateCourant;
        }
      }
      _getSemaineSuivanteValide(aDate, aSensRechercheInverse, aAvecIncrement) {
        let lDateCourant = aDate;
        const lNumeroCycle = IE.Cycles.cycleDeLaDate(lDateCourant);
        const lIncrement = aSensRechercheInverse ? -1 : 1;
        const lAvecArret =
          (aSensRechercheInverse && !this.getPremiereDateValide()) ||
          (!aSensRechercheInverse && !this.options.derniereDate);
        if (aAvecIncrement) {
          lDateCourant = aSensRechercheInverse
            ? IE.Cycles.dateDernierJourOuvreCycle(lNumeroCycle - 1)
            : IE.Cycles.dateDebutCycle(lNumeroCycle + 1);
        }
        if (
          !this.estDateValide(lDateCourant) &&
          this.estDateDansBorne(
            ObjetDate_1.GDate.getJourSuivant(lDateCourant, lIncrement),
            true,
          )
        ) {
          do {
            lDateCourant = ObjetDate_1.GDate.getJourSuivant(
              lDateCourant,
              lIncrement,
            );
          } while (
            !this.estDateValide(lDateCourant) &&
            this.estDateDansBorne(lDateCourant, true) &&
            !lAvecArret
          );
        }
        if (!this.estDateValide(lDateCourant)) {
          return null;
        }
        return this.getDateBornee(lDateCourant, true);
      }
    }
    exports.MoteurSelecteurDate = MoteurSelecteurDate;
  },
  fn: 'moteurselecteurdate.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.InterfaceSelecteurDate = void 0;
    require('InterfaceSelectionDate.css');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_EvenementObjetSaisie_1 = require('Enumere_EvenementObjetSaisie');
    const Enumere_StructureAffichage_1 = require('Enumere_StructureAffichage');
    const ObjetDate_1 = require('ObjetDate');
    const ObjetInterface_1 = require('ObjetInterface');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const tag_1 = require('tag');
    const MoteurSelecteurDate_1 = require('MoteurSelecteurDate');
    const ToucheClavier_1 = require('ToucheClavier');
    class InterfaceSelecteurDate extends ObjetInterface_1.ObjetInterface {
      constructor(...aParams) {
        super(...aParams);
        this.IdContenu = this.Nom + '_Contenu';
        this.nbrLignes = 6;
        this.nbrColonnes = 7;
        this.idJours = this.Nom + '_Jours';
        this.parametres = {
          listeMois: new ObjetListeElements_1.ObjetListeElements(),
          indiceMoisCourant: -1,
        };
        this.moteurDate = new MoteurSelecteurDate_1.MoteurSelecteurDate();
      }
      setMoteurDate(aMoteurDate) {
        this.moteurDate = aMoteurDate;
      }
      setParametresGeneraux() {
        this.GenreStructure =
          Enumere_StructureAffichage_1.EStructureAffichage.Autre;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          comboMois: {
            init(aCombo) {
              aInstance.comboMois = aCombo;
              aCombo.setOptionsObjetSaisie({
                longueur: aInstance._avecComboAnnee() ? 80 : 120,
                avecDesignMobile: IE.estMobile,
                avecBouton: !IE.estMobile,
                avecBoutonsPrecSuiv: true,
                labelWAICellule: ObjetTraduction_1.GTraductions.getValeur(
                  'Fenetre_Date.WAI.SelectionMois',
                ),
              });
            },
            event: aInstance._eventSurSelecMois.bind(aInstance),
            getDisabled() {
              const lListeArticles = aInstance.comboMois.getListeElements();
              return !lListeArticles || lListeArticles.count() < 2;
            },
          },
          comboAnnee: {
            init(aCombo) {
              aInstance.comboAnnee = aCombo;
              aCombo.setOptionsObjetSaisie({
                longueur: 40,
                avecDesignMobile: IE.estMobile,
                avecBouton: !IE.estMobile,
                avecBoutonsPrecSuiv: true,
                labelWAICellule: ObjetTraduction_1.GTraductions.getValeur(
                  'Fenetre_Date.WAI.SelectionAnnee',
                ),
              });
            },
            event: aInstance._eventSelecAnnee.bind(aInstance),
            getDisabled() {
              const lListeArticles = aInstance.comboAnnee.getListeElements();
              return !lListeArticles || lListeArticles.count() < 2;
            },
          },
        });
      }
      construireStructureAffichageAutre() {
        const H = [];
        H.push(
          '<div class="InterfaceSelectionDate" id="',
          this.IdContenu,
          '"></div>',
        );
        return H.join('');
      }
      setDonnees(aDate, aAvecDate) {
        if (aAvecDate === undefined) {
          aAvecDate = true;
        }
        this.dateCourante = ObjetDate_1.GDate.getDateCourante(
          this.moteurDate.options.bornerDateCourante,
        );
        this.avecDate = aDate !== null && aDate !== undefined && aAvecDate;
        this.date = this.avecDate
          ? this.moteurDate.getDateBornee.call(this, aDate)
          : this.dateCourante;
        const lDateBornee = this.moteurDate.getDateBornee(this.date);
        if (!this._avecComboAnnee()) {
          this.parametres.listeMois =
            ObjetDate_1.GDate.getListeMoisAPartirDeDate(
              this.moteurDate.options.premiereDate,
              this.moteurDate.options.derniereDate,
            );
        } else {
          this.parametres.listeMois = this._construireListeMoisDAnnee(
            lDateBornee.getFullYear(),
          );
        }
        ObjetHtml_1.GHtml.setHtml(this.IdContenu, this.composeContenu(), {
          controleur: this.controleur,
        });
        this.afficher();
        if (this.comboAnnee) {
          this._construireListeAnnees(this.date);
        }
        this.parametres.indiceMoisCourant = this._getIndiceMoisDeDate(
          this.date,
        );
        this.comboMois.setDonnees(
          this.parametres.listeMois,
          this.parametres.indiceMoisCourant,
        );
        $('#' + this.idJours.escapeJQ()).on(
          {
            focusin: function (event) {
              const lInfo = _getLigneEtColonne(this);
              event.data.instance.surSurvol(lInfo.i, lInfo.j, true);
            },
            focusout: function (event) {
              const lInfo = _getLigneEtColonne(this);
              event.data.instance.surSurvol(lInfo.i, lInfo.j, false);
            },
            keyup: function (event) {
              const lInfo = _getLigneEtColonne(this);
              event.data.instance._surKeyUp(lInfo.i, lInfo.j, event);
            },
            pointerover: function (event) {
              const lInfo = _getLigneEtColonne(this);
              event.data.instance.surSurvol(lInfo.i, lInfo.j, true);
            },
            pointerout: function (event) {
              const lInfo = _getLigneEtColonne(this);
              event.data.instance.surSurvol(lInfo.i, lInfo.j, false);
            },
            click: function (event) {
              const lInfo = _getLigneEtColonne(this);
              event.data.instance.surSelection(lInfo.i, lInfo.j);
            },
          },
          'td.date',
          { instance: this },
        );
      }
      composeContenu() {
        if (this.dateCourante === null || this.dateCourante === undefined) {
          return '';
        }
        const lAvecComboAnnee = this._avecComboAnnee();
        const T = [];
        T.push(
          (0, tag_1.tag)(
            'div',
            { class: ['combos-container'] },
            (0, tag_1.tag)('ie-combo', {
              'ie-model': 'comboMois',
              class: 'combo-selecteur',
            }),
            lAvecComboAnnee
              ? (0, tag_1.tag)('ie-combo', {
                  'ie-model': 'comboAnnee',
                  class: 'combo-selecteur',
                })
              : '',
          ),
          (0, tag_1.tag)('div', { id: this.idJours }),
        );
        return T.join('');
      }
      composeJour(I, J) {
        const lHtml = [];
        const lDate = ObjetDate_1.GDate.getJourSuivant(
          this.premierLundiDuMois,
          I * 7 + J,
        );
        const lPremDateSais = this.moteurDate.getPremiereDateValide();
        const lEstJoursActif = this.estJourActif(I, J);
        const lEstJourCourant = ObjetDate_1.GDate.estJourCourant(lDate, false);
        let lEstDateSelectionnee = false;
        const lId = this.Nom + '_' + I + '_' + J;
        const lIdTD = this.Nom + '_td_' + I + '_' + J;
        let lClass = ['date'];
        if (lEstJoursActif) {
          lClass.push('actif');
        }
        if (this.estJourDuMois(I, J)) {
          lClass.push('current-month');
        }
        if (lEstJourCourant) {
          lClass.push('current-date');
        }
        if (this.avecDate) {
          if (
            this.moteurDate.options.avecSelectionSemaine && IE.Cycles
              ? lEstJoursActif &&
                IE.Cycles.cycleDeLaDate(lDate) ===
                  IE.Cycles.cycleDeLaDate(this.date)
              : ObjetDate_1.GDate.estJourEgal(lDate, this.date)
          ) {
            lClass.push('selected-date');
            lEstDateSelectionnee = true;
          }
        }
        if (ObjetDate_1.GDate.estDateJourAvant(lDate, this.dateCourante)) {
          lClass.push('previous-date');
        }
        if (this.estJourMarque(lDate)) {
          lClass.push('with-mark');
        }
        if (
          this.moteurDate.options.afficherPremiereDateSaisissable &&
          this.moteurDate.options.premiereDateSaisissable &&
          ObjetDate_1.GDate.estJourEgal(
            lDate,
            this.moteurDate.options.premiereDateSaisissable,
          ) &&
          !ObjetDate_1.GDate.estJourEgal(
            this.moteurDate.options.premiereDateSaisissable,
            this.moteurDate.options.premiereDate,
          )
        ) {
          lClass.push('first-selectable-date');
        }
        if (I === 0) {
          lClass.push('b-top');
        }
        if (I === this.nbrLignes - 1) {
          lClass.push('b-bottom');
        }
        if (J === 0) {
          lClass.push('b-left');
        }
        if (J === this.nbrColonnes - 1) {
          lClass.push('b-right');
        }
        const lTabIndex =
          !lPremDateSais ||
          ObjetDate_1.GDate.estJourEgal(lDate, lPremDateSais) ||
          (I === 0 &&
            J === 0 &&
            ObjetDate_1.GDate.getDifferenceJours(lDate, lPremDateSais) > 0)
            ? '0'
            : '-1';
        lHtml.push(
          IE.jsx.str(
            'td',
            {
              role: 'gridcell',
              id: lIdTD,
              class: lClass,
              tabindex: lTabIndex,
              'aria-disabled': lEstJoursActif ? false : 'true',
              'aria-current': lEstJourCourant ? 'date' : false,
              'aria-selected': lEstDateSelectionnee ? 'true' : 'false',
              'aria-label': ObjetDate_1.GDate.formatDate(
                lDate,
                '%JJJJ %J %MMM %AAAA',
              ),
            },
            IE.jsx.str(
              'div',
              null,
              IE.jsx.str(
                'div',
                { id: lId },
                IE.jsx.str(
                  'div',
                  null,
                  IE.jsx.str(
                    'div',
                    null,
                    ObjetDate_1.GDate.formatDate(lDate, '%J'),
                  ),
                ),
              ),
            ),
          ),
        );
        return lHtml.join('');
      }
      surSurvol(I, J, aSurvol) {
        const lId = this.Nom + '_td_' + I + '_' + J;
        if (
          this.ICourant &&
          this.JCourant &&
          this.JCourant !== -1 &&
          (this.ICourant !== I || this.JCourant !== J)
        ) {
          this.surSurvol(this.ICourant, this.JCourant, false);
        }
        if (aSurvol) {
          this.ICourant = I;
          this.JCourant = J;
          ObjetHtml_1.GHtml.setFocus(lId);
        }
      }
      surSelection(I, J) {
        if (!this.estJourActif(I, J)) {
          return;
        }
        if ('surValidation' in this.Pere) {
          this.Pere.date = ObjetDate_1.GDate.getDateJour(
            ObjetDate_1.GDate.getJourSuivant(
              this.premierLundiDuMois,
              I * 7 + J,
            ),
          );
          this.Pere.surValidation(1, this.mois, this.annee);
        }
      }
      estJourDuMois(I, J) {
        const lDate = ObjetDate_1.GDate.getJourSuivant(
          this.premierLundiDuMois,
          I * 7 + J,
        );
        const lMois = lDate.getMonth();
        return lMois === this.mois && this.moteurDate.estDateDansBorne(lDate);
      }
      estJourActif(I, J) {
        return this.estJourValide(I, J);
      }
      estJourValide(I, J) {
        if (!IE.Cycles) {
          return true;
        }
        const lDate = ObjetDate_1.GDate.getJourSuivant(
          this.premierLundiDuMois,
          I * 7 + J,
        );
        return this.moteurDate.estDateValide(lDate);
      }
      estJourSemaineOuvre(J) {
        return this.moteurDate.options.joursSemaineValide
          ? this.moteurDate.options.joursSemaineValide.getValeur(J + 1)
          : true;
      }
      estJourMarque(aDate) {
        if (!IE.Cycles) {
          return false;
        }
        const lNbJours = this.moteurDate.options
          .estJoursMarquesSelonPremiereDate
          ? ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(
              this.moteurDate.options.premiereDate,
              aDate,
            )
          : ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(
              IE.Cycles.dateDebutPremierCycle(),
              aDate,
            ) + 1;
        return this.moteurDate.options.joursMarques
          ? this.moteurDate.options.joursMarques.getValeur(lNbJours)
          : false;
      }
      _avecComboAnnee() {
        return (
          !this.moteurDate.options.premiereDate ||
          !this.moteurDate.options.derniereDate
        );
      }
      _eventSurSelecMois(aParams) {
        if (
          aParams.genreEvenement ===
            Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
              .selection &&
          aParams.element
        ) {
          this.parametres.indiceMoisCourant = aParams.indice;
          this._actualiserSelonMoisCourant(aParams.element);
        }
      }
      _eventSelecAnnee(aParams) {
        if (
          aParams.genreEvenement ===
          Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie.selection
        ) {
          this.parametres.listeMois = this._construireListeMoisDAnnee(
            aParams.element.annee,
          );
          let lMoisTrouve = false;
          this.parametres.listeMois.parcourir((aMoisListe, aIndex) => {
            if (this.parametres.indiceMoisCourant === aIndex) {
              lMoisTrouve = true;
              return false;
            }
          });
          if (!lMoisTrouve) {
            this.parametres.indiceMoisCourant =
              aParams.indice > this.parametres.indiceAnnee
                ? 0
                : this.parametres.listeMois.count() - 1;
          }
          this.parametres.indiceAnnee = aParams.indice;
          this.comboMois.setDonnees(
            this.parametres.listeMois,
            this.parametres.indiceMoisCourant,
          );
        }
      }
      _getIndiceMoisDeDate(aDate) {
        const lAnnee = aDate.getFullYear();
        const lMois = aDate.getMonth();
        let lIndice = 0;
        this.parametres.listeMois.parcourir((D, aIndex) => {
          if (D.mois === lMois && D.annee === lAnnee) {
            lIndice = aIndex;
            return false;
          }
        });
        return lIndice;
      }
      _actualiserSelonMoisCourant(aArticleMois) {
        this.mois = aArticleMois.mois;
        this.annee = aArticleMois.annee;
        this.premierJourDuMois = ObjetDate_1.GDate.getPremierJourDuMois(
          aArticleMois.annee,
          aArticleMois.mois,
        );
        this.premierLundiDuMois = ObjetDate_1.GDate.getPremierLundiDuMois(
          aArticleMois.annee,
          aArticleMois.mois,
        );
        this.$refreshSelf();
        this._afficherJoursDeMoisCourant();
      }
      _construireListeMoisDAnnee(aAnnee) {
        let lPremiereDate = ObjetDate_1.GDate.getPremierJourDuMois(aAnnee, 0);
        let lDerniereDate = ObjetDate_1.GDate.getDernierJourDuMois(aAnnee, 11);
        if (
          this.moteurDate.options.premiereDate &&
          this.moteurDate.options.premiereDate > lPremiereDate
        ) {
          lPremiereDate = this.moteurDate.options.premiereDate;
        }
        if (
          this.moteurDate.options.derniereDate &&
          this.moteurDate.options.derniereDate < lDerniereDate
        ) {
          lDerniereDate = this.moteurDate.options.derniereDate;
        }
        const lListe = ObjetDate_1.GDate.getListeMoisAPartirDeDate(
          lPremiereDate,
          lDerniereDate,
          '%MMMM',
        );
        return lListe;
      }
      _construireListeAnnees(aDate) {
        const lListeAnnees = new ObjetListeElements_1.ObjetListeElements();
        const lAnneeCourante = aDate.getFullYear();
        let lAnneeDebut = lAnneeCourante;
        let lAnneeFin = lAnneeCourante;
        if (this.moteurDate.options.premiereDate) {
          lAnneeDebut = this.moteurDate.options.premiereDate.getFullYear();
        } else {
          lAnneeDebut = lAnneeCourante - 100;
        }
        if (this.moteurDate.options.derniereDate) {
          lAnneeFin = this.moteurDate.options.derniereDate.getFullYear();
        } else {
          lAnneeFin = lAnneeCourante + 100;
        }
        this.parametres.indiceAnnee = 0;
        for (let lAnnee = lAnneeDebut; lAnnee <= lAnneeFin; lAnnee++) {
          lListeAnnees.add(
            ObjetElement_1.ObjetElement.create({
              Libelle: lAnnee + '',
              annee: lAnnee,
            }),
          );
          if (lAnneeCourante === lAnnee) {
            this.parametres.indiceAnnee = lListeAnnees.count() - 1;
          }
        }
        this.comboAnnee.setDonnees(lListeAnnees, this.parametres.indiceAnnee);
      }
      _getJourPremierSemaine() {
        return ObjetDate_1.GDate.PremierLundi
          ? ObjetDate_1.GDate.getJourDeDate(ObjetDate_1.GDate.PremierLundi)
          : 0;
      }
      _afficherJoursDeMoisCourant() {
        const T = [];
        T.push(
          '<table class="full-width Texte10 EspaceHaut m-top-l" role="grid">',
        );
        T.push('<tr class="titre-jours" role="row">');
        for (let J = 0; J < this.nbrColonnes; J++) {
          const lJour = (J + this._getJourPremierSemaine()) % 7;
          T.push(
            IE.jsx.str(
              'th',
              {
                role: 'columnheader',
                class: this.estJourSemaineOuvre(lJour) ? ' ouvre' : '',
                'aria-label':
                  ObjetTraduction_1.GTraductions.getValeur('Jours')[lJour],
              },
              ObjetTraduction_1.GTraductions.getValeur('JoursCourt')[lJour],
            ),
          );
        }
        T.push('</tr>');
        for (let I = 0; I < this.nbrLignes; I++) {
          T.push('<tr class="jours" role="row">');
          for (let J = 0; J < this.nbrColonnes; J++) {
            T.push(this.composeJour(I, J));
          }
          T.push('</tr>');
        }
        T.push('</table>');
        ObjetHtml_1.GHtml.setHtml(this.idJours, T.join(''), true);
      }
      _surKeyUp(I, J, aEvent) {
        if (ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent)) {
          if (this.estJourValide(I, J)) {
            this.surSelection(I, J);
          }
        } else if (
          aEvent.which === ToucheClavier_1.ToucheClavier.FlecheHaut &&
          I > 0
        ) {
          this.surSurvol(I, J, false);
          this.surSurvol(I - 1, J, true);
        } else if (
          aEvent.which === ToucheClavier_1.ToucheClavier.FlecheBas &&
          I + 1 < this.nbrLignes
        ) {
          this.surSurvol(I, J, false);
          this.surSurvol(I + 1, J, true);
        } else if (
          aEvent.which === ToucheClavier_1.ToucheClavier.FlecheGauche &&
          J > 0
        ) {
          this.surSurvol(I, J, false);
          this.surSurvol(I, J - 1, true);
        } else if (
          aEvent.which === ToucheClavier_1.ToucheClavier.FlecheDroite &&
          J + 1 < this.nbrColonnes
        ) {
          this.surSurvol(I, J, false);
          this.surSurvol(I, J + 1, true);
        } else if (aEvent.which === ToucheClavier_1.ToucheClavier.Debut) {
          this.surSurvol(I, J, false);
          this.surSurvol(aEvent.ctrlKey ? 0 : I, 0, true);
        } else if (aEvent.which === ToucheClavier_1.ToucheClavier.Fin) {
          this.surSurvol(I, J, false);
          this.surSurvol(
            aEvent.ctrlKey ? this.nbrLignes - 1 : I,
            this.nbrColonnes - 1,
            true,
          );
        }
      }
    }
    exports.InterfaceSelecteurDate = InterfaceSelecteurDate;
    function _getLigneEtColonne(aElement) {
      return {
        i: ObjetHtml_1.GHtml.extraireNombreDId(aElement.id, 1),
        j: ObjetHtml_1.GHtml.extraireNombreDId(aElement.id),
      };
    }
  },
  fn: 'interfaceselecteurdate.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_Date = void 0;
    const InterfaceSelecteurDate_1 = require('InterfaceSelecteurDate');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const MoteurSelecteurDate_1 = require('MoteurSelecteurDate');
    class ObjetFenetre_Date extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          titre: ObjetTraduction_1.GTraductions.getValeur('Fenetre_Date.Titre'),
          largeur: 330,
          hauteur: 100,
          fermerFenetreSurClicHorsFenetre: IE.estMobile,
          avecTailleSelonContenu: true,
          listeBoutons: [ObjetTraduction_1.GTraductions.getValeur('Fermer')],
          avecAucuneDate: false,
        });
        this.moteurDate = new MoteurSelecteurDate_1.MoteurSelecteurDate();
        this.parametres = {
          listeMois: new ObjetListeElements_1.ObjetListeElements(),
          indiceMoisCourant: -1,
        };
      }
      composeContenu() {
        const T = [];
        T.push(
          '<div id="',
          this.getInstance(this.identSelecteur).getNom(),
          '" class="ContentBox"></div>',
        );
        return T.join('');
      }
      setParametres(
        aPremierLundi,
        aPremiereDate,
        aDerniereDate,
        aActifJour,
        aActifSemaine,
        aJoursFeries,
        aAvecAucuneDate,
      ) {
        this.setOptionsMoteurDate({
          premiereDate: aPremiereDate,
          derniereDate: aDerniereDate,
          joursSemaineValide: aActifJour,
          domaineValide: aActifSemaine,
          joursFeries: aJoursFeries,
        });
        if (aAvecAucuneDate !== undefined) {
          this.setOptionsFenetre({ avecAucuneDate: aAvecAucuneDate });
        }
      }
      setMoteurDate(aMoteurDate) {
        this.moteurDate = aMoteurDate;
      }
      setOptionsMoteurDate(aOptions) {
        this.moteurDate.setOptions(aOptions);
      }
      setDonnees(aDate) {
        this.afficher();
        this.date = aDate;
        if (this.optionsFenetre.avecAucuneDate) {
          this.setOptionsFenetre({
            listeBoutons: [
              ObjetTraduction_1.GTraductions.getValeur(
                'Fenetre_Date.AucuneDate',
              ),
            ],
          });
        }
        this.getInstance(this.identSelecteur).setDonnees(aDate);
      }
      construireInstances() {
        this.identSelecteur = this.add(
          InterfaceSelecteurDate_1.InterfaceSelecteurDate,
          null,
          (aInstance) => {
            aInstance.setMoteurDate(this.moteurDate);
          },
        );
      }
      setJoursMarques(aJoursMarques) {
        this.moteurDate.setOptions({ joursMarques: aJoursMarques });
      }
      setPremiereDateSaisissable(aPremiereDateSaisissable, aAfficher) {
        this.moteurDate.setOptions({
          premiereDateSaisissable:
            aPremiereDateSaisissable || this.moteurDate.options.premiereDate,
          afficherPremiereDateSaisissable: aAfficher ? aAfficher : false,
        });
      }
      surValidation(aGenreBouton) {
        if (
          aGenreBouton === -1 ||
          aGenreBouton === 0 ||
          this.moteurDate.estDateDansBorne(this.date)
        ) {
          this.fermer();
          this.callback.appel(aGenreBouton, this.date);
        }
      }
    }
    exports.ObjetFenetre_Date = ObjetFenetre_Date;
  },
  fn: 'objetfenetre_date.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetCelluleDate = void 0;
    require('Form-components.css');
    const ControleSaisieEvenement_1 = require('ControleSaisieEvenement');
    const Enumere_Event_1 = require('Enumere_Event');
    const ObjetDate_1 = require('ObjetDate');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetFenetre_Date_1 = require('ObjetFenetre_Date');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetCelluleBouton_1 = require('ObjetCelluleBouton');
    const MoteurSelecteurDate_1 = require('MoteurSelecteurDate');
    const ToucheClavier_1 = require('ToucheClavier');
    const ObjetWAI_1 = require('ObjetWAI');
    class ObjetCelluleDate extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.moteurDate = new MoteurSelecteurDate_1.MoteurSelecteurDate();
        this.options = this.moteurDate.options;
        this._optionsFenetre = {};
        this.setOptions({
          avecInitDateSiVide: IE.estMobile,
          avecControleDateInit: true,
          labelWAI: '',
          ariaDescription: '',
          largeurComposant: IE.estMobile ? null : 75,
          hauteurComposant: 17,
          formatDate: '[%JJJ %JJ %MMM]',
          avecBoutonsPrecedentSuivant: false,
          genreBoutonCellule: IE.estMobile
            ? ObjetCelluleBouton_1.EGenreBoutonCellule.Aucun
            : ObjetCelluleBouton_1.EGenreBoutonCellule.Image,
          iconeGauche: IE.estMobile ? 'icon_calendar_empty' : '',
          classeCSSTexte: 'Gras',
          designMobile: IE.estMobile,
          placeHolder: '',
        });
      }
      detruireInstances() {
        this._fermerFenetreDate();
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getStyle: function () {
            return {
              width:
                aInstance.options.largeurComposant &&
                aInstance.options.largeurComposant === '100%'
                  ? '100%'
                  : '',
            };
          },
          getClassesDynamiques: function () {
            const lClasses = [];
            if (!aInstance.getActif()) {
              lClasses.push('input-wrapper-disabled');
            }
            return lClasses.join(' ');
          },
          btn: {
            event: function (aPrecedent) {
              aInstance._eventDateSuivante(aPrecedent);
            },
            getDisabled: function (aPrecedent) {
              return aInstance._getDisabledBtnPrecSuiv(aPrecedent);
            },
            getTitle: function (aPrecedent) {
              return aPrecedent
                ? ObjetTraduction_1.GTraductions.getValeur('Precedent')
                : ObjetTraduction_1.GTraductions.getValeur('Suivant');
            },
          },
          getNodeCellulePrecSuiv() {
            $(this.node).on({
              swipeleft: function () {
                if (!aInstance._getDisabledBtnPrecSuiv(false)) {
                  aInstance._eventDateSuivante(false);
                }
              },
              swiperight: function () {
                if (!aInstance._getDisabledBtnPrecSuiv(true)) {
                  aInstance._eventDateSuivante(true);
                }
              },
            });
          },
        });
      }
      setOptionsObjetCelluleDate(aOptions) {
        $.extend(this.options, aOptions);
        if (this.options.fenetre) {
          this.setOptionsFenetre(this.options.fenetre);
        }
        return this;
      }
      setOptionsFenetre(aOptions) {
        Object.assign(this._optionsFenetre, aOptions);
      }
      setParametresFenetre(
        aPremierLundi,
        aPremiereDate,
        aDerniereDate,
        aActifJour,
        aActifSemaine,
        aJoursFeries,
        aAvecAucuneDate,
        aJoursMarques,
      ) {
        this.moteurDate.setOptions({
          premiereDate: aPremiereDate,
          derniereDate: aDerniereDate,
          joursSemaineValide: aActifJour,
          domaineValide: aActifSemaine,
          joursFeries: aJoursFeries,
          joursMarques: aJoursMarques,
        });
        if (aAvecAucuneDate !== undefined) {
          this._optionsFenetre.avecAucuneDate = aAvecAucuneDate;
        }
      }
      setPremiereDateSaisissable(aPremiereDateSaisissable, aAfficher) {
        this.moteurDate.setOptions({
          premiereDateSaisissable: aPremiereDateSaisissable,
          afficherPremiereDateSaisissable: aAfficher,
        });
      }
      setDerniereDateSaisissable(aDerniereDateSaisissable) {
        this.moteurDate.setOptions({ derniereDate: aDerniereDateSaisissable });
      }
      initialiser() {
        this.cellule = new ObjetCelluleBouton_1.ObjetCelluleBouton(
          this.Nom + '.cellule',
          null,
          this,
          this.surCellule,
        );
        this.setPremierElement(this.cellule.NomEdit);
        this.cellule.setOptionsObjetCelluleBouton(this.options);
        this.cellule.setOptionsObjetCelluleBouton({
          estSaisissable: false,
          avecZoneSaisie: false,
          roleWAI: ObjetWAI_1.EGenreRole.Combobox,
          popupWAI: 'dialog',
          labelledById: this.getLabelledBy(),
          placeHolder: this.options.placeHolder,
          genreBouton: this.options.genreBoutonCellule,
          hauteur: this.options.hauteurComposant,
          largeur: this.options.largeurComposant,
          classTexte: this.options.classeCSSTexte,
          iconeGauche: this.options.avecBoutonsPrecedentSuivant
            ? ''
            : this.options.iconeGauche,
        });
        this.afficher();
        this.cellule.initialiser();
        this.cellule.setActif(this.Actif);
      }
      setDonnees(aDate, aAvecEvenement = false) {
        this.date = aDate;
        if (!this.date && this.options.avecInitDateSiVide) {
          this.date = GApplication.getDemo()
            ? GApplication.getDateDemo()
            : ObjetDate_1.GDate.getDateCourante();
        }
        if (this.options.avecControleDateInit && this.date) {
          this.date = this.moteurDate.getDateSelonValidite(this.date);
        }
        this._actualiserDate();
        if (aAvecEvenement) {
          this.surFenetreDate(null, this.date);
        }
      }
      construireAffichage() {
        return IE.jsx.str(
          IE.jsx.fragment,
          null,
          IE.jsx.str(
            'div',
            {
              class: 'ObjetCelluleDate input-wrapper ',
              'ie-class': 'getClassesDynamiques',
              'ie-style': 'getStyle',
            },
            () => {
              if (this.options.avecBoutonsPrecedentSuivant) {
                return IE.jsx.str(
                  IE.jsx.fragment,
                  null,
                  IE.jsx.str('ie-btnicon', {
                    class: [
                      'icon_angle_left fix-bloc',
                      this.options.designMobile ? '' : ' icon btnImageIcon',
                    ],
                    'ie-model': 'btn(true)',
                    'aria-labelledby': this.getLabelledBy(),
                  }),
                  IE.jsx.str('div', {
                    id: this.cellule.getNom(),
                    class: 'fluid-bloc',
                    'ie-node': 'getNodeCellulePrecSuiv',
                  }),
                  IE.jsx.str('ie-btnicon', {
                    class: [
                      'icon_angle_right fix-bloc',
                      this.options.designMobile ? '' : ' icon btnImageIcon',
                    ],
                    'ie-model': 'btn(false)',
                    style: 'flex: none;',
                    'aria-labelledby': this.getLabelledBy(),
                  }),
                );
              }
              return IE.jsx.str('div', {
                id: this.cellule.getNom(),
                style: 'flex:1 1 auto;',
              });
            },
            IE.jsx.str(
              'span',
              {
                class: 'sr-only',
                role: 'presentation',
                id: `${this.Nom}_labelwai`,
              },
              this.options.labelWAI
                ? this.options.labelWAI
                : ObjetTraduction_1.GTraductions.getValeur('Date'),
            ),
          ),
        );
      }
      _actualiserDate() {
        if (this.cellule) {
          this.cellule.setLibelle(this._getChaineDate());
        }
      }
      getLabelledBy() {
        return this.options.labelledById || `${this.Nom}_labelwai`;
      }
      surCellule(aGenreEvent, aEvent) {
        if (!this.Actif) {
          return;
        }
        switch (aGenreEvent) {
          case Enumere_Event_1.EEvent.SurClick: {
            this._ouvrirFenetreDate();
            break;
          }
          case Enumere_Event_1.EEvent.SurKeyUp: {
            if (
              aEvent.which === ToucheClavier_1.ToucheClavier.RetourChariot ||
              aEvent.which === ToucheClavier_1.ToucheClavier.FlecheBas
            ) {
              this._ouvrirFenetreDate();
            }
          }
        }
      }
      _ouvrirFenetreDate() {
        if (this.fenetreDate) {
          this._fermerFenetreDate();
        }
        if (this.options.avecAucuneDate !== undefined) {
          this._optionsFenetre.avecAucuneDate = this.options.avecAucuneDate;
        }
        this.fenetreDate = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_Date_1.ObjetFenetre_Date,
          { pere: this, evenement: this.surFenetreDate, initialiser: false },
          this._optionsFenetre,
        );
        this.fenetreDate.setOptionsFenetre({
          callbackApresFermer: () => {
            delete this.fenetreDate;
          },
        });
        this.fenetreDate.setMoteurDate(this.moteurDate);
        this.fenetreDate.initialiser();
        this.fenetreDate.setDonnees(this.date);
        this.fenetreDate.positionnerSousId(this.Nom);
      }
      _fermerFenetreDate() {
        if (this.fenetreDate) {
          this.fenetreDate.fermer();
        }
      }
      surFenetreDate(aGenreBouton, aDate) {
        this.date = aDate;
        this._actualiserDate();
        this._fermerFenetreDate();
        if (aDate) {
          (0, ControleSaisieEvenement_1.ControleSaisieEvenement)(() => {
            this.callback.appel(this.date, aGenreBouton);
          }, !this.ControleNavigation);
        }
      }
      getDate() {
        return this.date;
      }
      getBorneDates() {
        return {
          dateDebut: this.options.premiereDate,
          dateFin: this.options.derniereDate,
        };
      }
      setActif(AActif) {
        super.setActif(AActif);
        if (this.cellule) {
          this.cellule.setActif(AActif);
        }
        this.$refreshSelf();
      }
      getOptionsCelluleDate() {
        return this.options;
      }
      _getDisabledBtnPrecSuiv(aPrecedent) {
        if (!this.date || !this.getActif()) {
          return true;
        }
        return !this.moteurDate.rechercheSuivantValide(this.date, aPrecedent);
      }
      _eventDateSuivante(aPrecedent) {
        const lDate = this.moteurDate.rechercheSuivantValide(
          this.date,
          aPrecedent,
        );
        if (lDate) {
          this.surFenetreDate(null, lDate);
        }
        this.$refreshSelf();
      }
      _getPeriodeCourante() {
        const lCycleCourant = IE.Cycles.cycleDeLaDate(this.date);
        const lDateDeb = IE.Cycles.dateDebutCycle(lCycleCourant);
        const lDateFin = IE.Cycles.dateDernierJourOuvreCycle(lCycleCourant);
        return {
          dateDebut: lDateDeb,
          dateFin: lDateFin,
          estJourUnique: lDateDeb === lDateFin,
          estMoisUnique:
            lDateDeb.getMonth() === lDateFin.getMonth() &&
            lDateDeb.getFullYear() === lDateFin.getFullYear(),
          estAnneeUnique: lDateDeb.getFullYear() === lDateFin.getFullYear(),
        };
      }
      _getChaineDate() {
        if (!this.date) {
          return this.options.placeHolder ? '' : '&nbsp;';
        }
        if (this.options.avecSelectionSemaine) {
          const lPeriode = this._getPeriodeCourante();
          const lFormatDateDeb =
              '%J' +
              (lPeriode.estMoisUnique ? '' : ' %MMM') +
              (lPeriode.estAnneeUnique ? '' : ' %AA'),
            lFormatDateFin =
              '%J %MMM' + (lPeriode.estAnneeUnique ? '' : ' %AA');
          return ObjetTraduction_1.GTraductions.getValeur(
            'Dates.DuDateDebutAuDateFin',
            [
              ObjetDate_1.GDate.formatDate(lPeriode.dateDebut, lFormatDateDeb),
              ObjetDate_1.GDate.formatDate(lPeriode.dateFin, lFormatDateFin),
            ],
          );
        } else {
          return ObjetDate_1.GDate.formatDate(
            this.date,
            this.options.formatDate,
          );
        }
      }
    }
    exports.ObjetCelluleDate = ObjetCelluleDate;
  },
  fn: 'objetcelluledate.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreRepas = void 0;
    var EGenreRepas;
    (function (EGenreRepas) {
      EGenreRepas[(EGenreRepas['Midi'] = 0)] = 'Midi';
      EGenreRepas[(EGenreRepas['Soir'] = 1)] = 'Soir';
    })(EGenreRepas || (exports.EGenreRepas = EGenreRepas = {}));
  },
  fn: 'enumere_repas.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeOrigineCreationLabelAlimentaireUtil =
      exports.TypeOrigineCreationLabelAlimentaire = void 0;
    var TypeOrigineCreationLabelAlimentaire;
    (function (TypeOrigineCreationLabelAlimentaire) {
      TypeOrigineCreationLabelAlimentaire[
        (TypeOrigineCreationLabelAlimentaire['OCLA_Utilisateur'] = 0)
      ] = 'OCLA_Utilisateur';
      TypeOrigineCreationLabelAlimentaire[
        (TypeOrigineCreationLabelAlimentaire['OCLA_Bio'] = 1)
      ] = 'OCLA_Bio';
      TypeOrigineCreationLabelAlimentaire[
        (TypeOrigineCreationLabelAlimentaire['OCLA_FaitMaison'] = 2)
      ] = 'OCLA_FaitMaison';
      TypeOrigineCreationLabelAlimentaire[
        (TypeOrigineCreationLabelAlimentaire['OCLA_Assemble'] = 3)
      ] = 'OCLA_Assemble';
      TypeOrigineCreationLabelAlimentaire[
        (TypeOrigineCreationLabelAlimentaire['OCLA_Local'] = 4)
      ] = 'OCLA_Local';
    })(
      TypeOrigineCreationLabelAlimentaire ||
        (exports.TypeOrigineCreationLabelAlimentaire =
          TypeOrigineCreationLabelAlimentaire =
            {}),
    );
    const TypeOrigineCreationLabelAlimentaireUtil = {
      getClassIcone(aType) {
        let lClass;
        switch (aType) {
          case TypeOrigineCreationLabelAlimentaire.OCLA_Utilisateur:
            lClass = '';
            break;
          case TypeOrigineCreationLabelAlimentaire.OCLA_Bio:
            lClass = 'icon_cantine_bio';
            break;
          case TypeOrigineCreationLabelAlimentaire.OCLA_FaitMaison:
            lClass = 'icon_home';
            break;
          case TypeOrigineCreationLabelAlimentaire.OCLA_Assemble:
            lClass = 'icon_cantine_assembler_place';
            break;
          case TypeOrigineCreationLabelAlimentaire.OCLA_Local:
            lClass = 'icon_map_marker';
            break;
          default:
            lClass = '';
            break;
        }
        return lClass;
      },
    };
    exports.TypeOrigineCreationLabelAlimentaireUtil =
      TypeOrigineCreationLabelAlimentaireUtil;
  },
  fn: 'typeoriginecreationlabelalimentaire.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeOrigineCreationAllergeneAlimentaireUtil =
      exports.TypeOrigineCreationAllergeneAlimentaire = void 0;
    var TypeOrigineCreationAllergeneAlimentaire;
    (function (TypeOrigineCreationAllergeneAlimentaire) {
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Utilisateur'] = 0)
      ] = 'OCAA_Utilisateur';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Gluten'] = 1)
      ] = 'OCAA_Gluten';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Crustace'] = 2)
      ] = 'OCAA_Crustace';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Oeuf'] = 3)
      ] = 'OCAA_Oeuf';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Poisson'] = 4)
      ] = 'OCAA_Poisson';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Arachide'] = 5)
      ] = 'OCAA_Arachide';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Soja'] = 6)
      ] = 'OCAA_Soja';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Lait'] = 7)
      ] = 'OCAA_Lait';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_FruitACoque'] = 8)
      ] = 'OCAA_FruitACoque';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Celeri'] = 9)
      ] = 'OCAA_Celeri';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Moutarde'] = 10)
      ] = 'OCAA_Moutarde';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Sesame'] = 11)
      ] = 'OCAA_Sesame';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Sulfites'] = 12)
      ] = 'OCAA_Sulfites';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Lupin'] = 13)
      ] = 'OCAA_Lupin';
      TypeOrigineCreationAllergeneAlimentaire[
        (TypeOrigineCreationAllergeneAlimentaire['OCAA_Mollusque'] = 14)
      ] = 'OCAA_Mollusque';
    })(
      TypeOrigineCreationAllergeneAlimentaire ||
        (exports.TypeOrigineCreationAllergeneAlimentaire =
          TypeOrigineCreationAllergeneAlimentaire =
            {}),
    );
    const TypeOrigineCreationAllergeneAlimentaireUtil = {
      getClassIcone(aType) {
        let lClass;
        switch (aType) {
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Utilisateur:
            lClass = '';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Gluten:
            lClass = 'icon_allergene_gluten';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Crustace:
            lClass = 'icon_allergene_crustaces';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Oeuf:
            lClass = 'icon_allergene_oeufs';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Poisson:
            lClass = 'icon_allergene_poissons';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Arachide:
            lClass = 'icon_allergene_arachides';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Soja:
            lClass = 'icon_allergene_soja';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Lait:
            lClass = 'icon_allergene_lait';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_FruitACoque:
            lClass = 'icon_allergene_fruits_coques';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Celeri:
            lClass = 'icon_allergene_celeri';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Moutarde:
            lClass = 'icon_allergene_moutarde';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Sesame:
            lClass = 'icon_allergene_sesame';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Sulfites:
            lClass = 'icon_allergene_sulfites';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Lupin:
            lClass = 'icon_allergene_lupin';
            break;
          case TypeOrigineCreationAllergeneAlimentaire.OCAA_Mollusque:
            lClass = 'icon_allergene_mollusques';
            break;
          default:
            lClass = 'icon_exclamation_sign';
            break;
        }
        return lClass;
      },
    };
    exports.TypeOrigineCreationAllergeneAlimentaireUtil =
      TypeOrigineCreationAllergeneAlimentaireUtil;
  },
  fn: 'typeoriginecreationallergenealimentaire.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireMenus = void 0;
    const ObjetDate_1 = require('ObjetDate');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const TypeOrigineCreationLabelAlimentaire_1 = require('TypeOrigineCreationLabelAlimentaire');
    const TypeOrigineCreationAllergeneAlimentaire_1 = require('TypeOrigineCreationAllergeneAlimentaire');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetTri_1 = require('ObjetTri');
    const Enumere_Repas_1 = require('Enumere_Repas');
    exports.UtilitaireMenus = {
      composeColonne: (aParams) => {
        const lEstJourVide =
          aParams && 'estJourVide' in aParams && aParams.estJourVide;
        let lDate =
          aParams && aParams.date
            ? ObjetDate_1.GDate.formatDate(aParams.date, '%JJJJ %J %MMMM')
            : '';
        let lHtmlDate = lDate;
        if (lDate.length > 0) {
          const [lJour, lNumero, lMois] = lDate.split(' ');
          lHtmlDate = `${lJour} <span class="titre-gras">${lNumero}</span> ${lMois}`;
        }
        const H = [];
        const lClass = ['ctn-liste'];
        if (
          MethodesObjet_1.MethodesObjet.isNumber(aParams.indice) &&
          !aParams.estDernierJourCycle
        ) {
          lClass.push(
            'avecPlusieurRepas' in aParams && aParams.avecPlusieurRepas
              ? 'full-height'
              : 'half-height',
          );
        }
        H.push(
          `<div class="${lClass.join(' ')}" role="group" aria-label="${lDate}">`,
        );
        if (!IE.estMobile) {
          H.push(
            `<div class="ctn-date ie-shadow-bottom">`,
            `<h2 class="ie-texte p-y-xl">${lHtmlDate}</h2>`,
            `</div>`,
          );
        }
        if (lEstJourVide) {
          H.push(exports.UtilitaireMenus.composeJourVide());
        } else {
          H.push(exports.UtilitaireMenus.composeJour(aParams));
        }
        H.push(`</div>`);
        return H.join('');
      },
      composeJourVide: () => {
        const H = [];
        H.push(
          `<div class="ctn-vide">`,
          `<p>${ObjetTraduction_1.GTraductions.getValeur('menus.MenuVide')}</p>`,
          IE.estMobile
            ? `<div class="Image_No_Data image-colonne " aria-hidden="true"></div>`
            : '',
          `</div>`,
        );
        return H.join('');
      },
      composeJour: (aParams) => {
        const H = [];
        H.push(`<ul>`);
        if (aParams.options.avecRepasMidi) {
          if (aParams.avecRepasMidi) {
            H.push(
              exports.UtilitaireMenus.composeRepas(
                aParams,
                Enumere_Repas_1.EGenreRepas.Midi,
              ),
            );
          } else if (!IE.estMobile) {
            H.push(
              exports.UtilitaireMenus.composeRepasVide(
                Enumere_Repas_1.EGenreRepas.Midi,
              ),
            );
          }
        }
        if (aParams.options.avecRepasSoir) {
          if (aParams.avecRepasSoir) {
            H.push(
              exports.UtilitaireMenus.composeRepas(
                aParams,
                Enumere_Repas_1.EGenreRepas.Soir,
              ),
            );
          } else if (!IE.estMobile) {
            H.push(
              exports.UtilitaireMenus.composeRepasVide(
                Enumere_Repas_1.EGenreRepas.Soir,
              ),
            );
          }
        }
        H.push(`</ul>`);
        return H.join('');
      },
      composeRepas: (aParams, aGenre) => {
        let lTitre, lRepas, lAvecInversion;
        if (aParams.listeRepas) {
          aParams.listeRepas.parcourir((aRepas) => {
            if (aRepas.getGenre() === aGenre && aRepas.ListePlats) {
              lRepas = aRepas;
              return false;
            }
          });
        }
        const lLibelle =
          lRepas && lRepas.getLibelle().length > 0 ? lRepas.getLibelle() : null;
        switch (aGenre) {
          case Enumere_Repas_1.EGenreRepas.Midi:
            lTitre = ObjetTraduction_1.GTraductions.getValeur('menus.MenuMidi');
            lAvecInversion = false;
            break;
          case Enumere_Repas_1.EGenreRepas.Soir:
            lTitre = ObjetTraduction_1.GTraductions.getValeur('menus.MenuSoir');
            lAvecInversion = true;
            break;
        }
        const H = [];
        if (
          aGenre === Enumere_Repas_1.EGenreRepas.Soir &&
          aParams.options.avecRepasSoir &&
          !IE.estMobile
        ) {
          H.push(`<li class="div-horizontal" aria-hidden="true" ></li>`);
        }
        H.push(`<li class="p-top-xxl ctn-repas">`);
        if (
          (aParams.options.avecRepasSoir &&
            aParams.options.avecRepasMidi &&
            !IE.estMobile) ||
          lLibelle ||
          (IE.estMobile && !aParams.avecPlusieurRepas)
        ) {
          H.push(
            `<div  class="titre-repas ${!IE.estMobile && aParams.avecPlusieurRepas ? 'flex-contain' : ''} cols">`,
          );
          const lHtmlTitre = [];
          if (
            (aParams.options.avecRepasSoir &&
              aParams.options.avecRepasMidi &&
              !IE.estMobile) ||
            (IE.estMobile && !aParams.avecPlusieurRepas)
          ) {
            lHtmlTitre.push(`<div class="ie-sous-titre m-y-s">${lTitre}</div>`);
          }
          if (lLibelle) {
            lHtmlTitre.push(`<div class="titre-gras m-y-s">${lLibelle}</div>`);
          }
          if (lAvecInversion) {
            lHtmlTitre.reverse();
          }
          H.push(lHtmlTitre.join(''));
          H.push(`</div>`);
        }
        H.push(
          `<ul class="browser-default" aria-label="${lTitre} ${lLibelle || ''}">`,
        );
        if (lRepas) {
          lRepas.ListePlats.parcourir((aPlat) => {
            H.push(exports.UtilitaireMenus.composePlat(aPlat));
          });
        }
        H.push('</ul>');
        H.push(`</li>`);
        return H.join('');
      },
      composeRepasVide: (aGenreRepas) => {
        const H = [];
        let lTitre;
        switch (aGenreRepas) {
          case Enumere_Repas_1.EGenreRepas.Midi:
            lTitre = ObjetTraduction_1.GTraductions.getValeur('menus.MenuMidi');
            break;
          case Enumere_Repas_1.EGenreRepas.Soir:
            lTitre = ObjetTraduction_1.GTraductions.getValeur('menus.MenuSoir');
            H.push(`<div class="div-horizontal"></div>`);
            break;
        }
        H.push(`<div class="p-y-xxl ctn-repas  vide">`);
        H.push(`<div class="titre-repas">`);
        H.push(`<div class="ie-sous-titre m-y-s">${lTitre}</div>`);
        H.push(`</div>`);
        H.push(`</div>`);
        return H.join('');
      },
      composePlat: (aPlat) => {
        const H = [];
        if (aPlat && aPlat.ListeAliments) {
          const lListeAliment = aPlat.ListeAliments.trier();
          H.push(`<li class="ie-texte p-y-xl">`);
          lListeAliment.parcourir((aAliment) => {
            const lAvecLabels =
              aAliment.listeLabelsAlimentaires &&
              aAliment.listeLabelsAlimentaires.count() > 0;
            const lAvecAllergene =
              aAliment.listeAllergenesAlimentaire &&
              aAliment.listeAllergenesAlimentaire.count() > 0;
            H.push(`<div class="aliment m-y-xl">`);
            H.push(
              `<div ${lAvecLabels || lAvecAllergene ? 'class="ctn-gauche"' : ''} >${aAliment.getLibelle()}</div>`,
            );
            if (lAvecLabels || lAvecAllergene) {
              H.push(`<div class="ctn-droite flex-contain cols flex-gap ">`);
              if (lAvecLabels) {
                H.push('<div class="ctn-labels">');
                aAliment.listeLabelsAlimentaires.parcourir((aLabel) => {
                  H.push(exports.UtilitaireMenus.composeLabel(aLabel));
                });
                H.push('</div>');
              }
              if (lAvecAllergene) {
                H.push(`<div class="ctn-allergenes">`);
                const lListeAllergene = [];
                aAliment.listeAllergenesAlimentaire.parcourir((aAllergene) => {
                  H.push(exports.UtilitaireMenus.composeAllergene(aAllergene));
                  lListeAllergene.push(aAllergene.getLibelle());
                });
                H.push(`</div>`);
              }
              H.push(`</div>`);
            }
            H.push(`</div>`);
          });
          H.push(`</li>`);
        }
        return H.join('');
      },
      composeAllergene: (aAllergene) => {
        return aAllergene
          ? `<i role="img" alt="${aAllergene.getLibelle()}" class="i-medium icon ${TypeOrigineCreationAllergeneAlimentaire_1.TypeOrigineCreationAllergeneAlimentaireUtil.getClassIcone(aAllergene.getGenre())}" style="${aAllergene.couleur ? `color:${aAllergene.couleur}` : ''}" title="${aAllergene.getLibelle()}" ></i>`
          : '';
      },
      composeLabel: (aLabel) => {
        if (!aLabel) {
          return '';
        }
        if (
          aLabel.getGenre() ===
            TypeOrigineCreationLabelAlimentaire_1
              .TypeOrigineCreationLabelAlimentaire.OCLA_Utilisateur &&
          !!aLabel.icone
        ) {
          return `<img class="img-icon" src="data:image/png;base64,${aLabel.icone}" alt="${aLabel.getLibelle()}" onerror="$(this).parent().remove();" title="${aLabel.getLibelle()}" />`;
        } else {
          return `<i role="img" alt="${aLabel.getLibelle()}" class="i-medium icon ${TypeOrigineCreationLabelAlimentaire_1.TypeOrigineCreationLabelAlimentaireUtil.getClassIcone(aLabel.getGenre())}" style="${aLabel.couleur ? `color:${aLabel.couleur}` : ''}" title="${aLabel.getLibelle()}" ></i> `;
        }
      },
      formatDonnees: (aListeJours, aAvecRepasMidi, aAvecRepasSoir) => {
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        if (aListeJours && aListeJours.parcourir) {
          aListeJours.parcourir((aJour) => {
            if (aJour && aJour.ListeRepas && aJour.ListeRepas.parcourir) {
              lListe.addElement(
                exports.UtilitaireMenus.formatDonneesJour(
                  aJour,
                  aListeJours,
                  aAvecRepasMidi,
                  aAvecRepasSoir,
                ),
              );
            }
          });
        }
        lListe.setTri([
          ObjetTri_1.ObjetTri.init('Date'),
          ObjetTri_1.ObjetTri.init('Libelle'),
        ]);
        lListe.trier();
        return lListe;
      },
      formatDonneesJour: (
        aJour,
        aListeJours,
        aAvecRepasMidi,
        aAvecRepasSoir,
      ) => {
        let lAvecRepasMidi = false,
          lAvecRepasSoir = false;
        aJour.ListeRepas.parcourir((aRepas) => {
          if (aRepas.getGenre() === Enumere_Repas_1.EGenreRepas.Midi) {
            lAvecRepasMidi = true;
          }
          if (aRepas.getGenre() === Enumere_Repas_1.EGenreRepas.Soir) {
            lAvecRepasSoir = true;
          }
        });
        return ObjetElement_1.ObjetElement.create({
          Libelle: aJour.Libelle,
          Numero: aJour.Numero,
          Genre: aJour.Genre,
          Position: aJour.Position,
          Actif: aJour.Actif,
          date: aJour.Date,
          listeRepas: aJour.ListeRepas,
          avecRepasMidi: lAvecRepasMidi,
          avecRepasSoir: lAvecRepasSoir,
          avecPlusieurRepas: lAvecRepasMidi && lAvecRepasSoir,
          options: {
            avecRepasMidi: aAvecRepasMidi,
            avecRepasSoir: aAvecRepasSoir,
            donneesOriginal:
              MethodesObjet_1.MethodesObjet.dupliquer(aListeJours),
          },
        });
      },
    };
  },
  fn: 'utilitairemenus.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreEvenementWidget = void 0;
    var EGenreEvenementWidget;
    (function (EGenreEvenementWidget) {
      EGenreEvenementWidget[(EGenreEvenementWidget['NavigationVersPage'] = 0)] =
        'NavigationVersPage';
      EGenreEvenementWidget[(EGenreEvenementWidget['SaisieWidget'] = 1)] =
        'SaisieWidget';
      EGenreEvenementWidget[
        (EGenreEvenementWidget['AfficherExecutionQCM'] = 2)
      ] = 'AfficherExecutionQCM';
      EGenreEvenementWidget[(EGenreEvenementWidget['ActualiserWidget'] = 3)] =
        'ActualiserWidget';
      EGenreEvenementWidget[
        (EGenreEvenementWidget['EvenementPersonnalise'] = 4)
      ] = 'EvenementPersonnalise';
    })(
      EGenreEvenementWidget ||
        (exports.EGenreEvenementWidget = EGenreEvenementWidget = {}),
    );
  },
  fn: 'enumere_evenementwidget.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.WidgetMenu = void 0;
    const ObjetWidget_1 = require('ObjetWidget');
    const ObjetCelluleDate_1 = require('ObjetCelluleDate');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const TypeDomaine_1 = require('TypeDomaine');
    const Enumere_Repas_1 = require('Enumere_Repas');
    const TypeOrigineCreationLabelAlimentaire_1 = require('TypeOrigineCreationLabelAlimentaire');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const UtilitaireMenus_1 = require('UtilitaireMenus');
    const Enumere_EvenementWidget_1 = require('Enumere_EvenementWidget');
    const ObjetIdentite_1 = require('ObjetIdentite');
    class WidgetMenu extends ObjetWidget_1.Widget.ObjetWidget {
      creerObjetsMenu() {
        this.dateMenu = ObjetIdentite_1.Identite.creerInstance(
          ObjetCelluleDate_1.ObjetCelluleDate,
          { pere: this, evenement: this._evenementComboMenu },
        );
      }
      initialiserObjetsMenu() {
        this.dateMenu.setOptionsObjetCelluleDate({
          formatDate: '[%JJJ %JJ %MMM]',
          avecBoutonsPrecedentSuivant: true,
          classeCSSTexte: 'Maigre',
          largeurComposant: 100,
        });
        const lActifJour = new TypeDomaine_1.TypeDomaine();
        GParametres.joursDemiPension.each((i) => {
          lActifJour.setValeur(true, i + 1);
        });
        this.dateMenu.setParametresFenetre(
          GParametres.PremierLundi,
          GParametres.PremiereDate,
          GParametres.DerniereDate,
          lActifJour,
        );
        this.dateMenu.initialiser();
        this.dateMenu.setDonnees(this.donneesRequete.menuDeLaCantine.date);
      }
      construire(aParams) {
        this.donnees = aParams.donnees;
        this.creerObjetsMenu();
        const lWidget = {
          html: this.composeWidgetMenu(),
          nbrElements: null,
          afficherMessage: this.donnees.listeRepas.count() === 0,
          listeElementsGraphiques: [{ id: this.dateMenu.getNom() }],
        };
        $.extend(true, this.donnees, lWidget);
        aParams.construireWidget(this.donnees);
        this.initialiserObjetsMenu();
      }
      composeWidgetMenu() {
        const H = [];
        const lListeIconesLabel = new ObjetListeElements_1.ObjetListeElements();
        const lListeIconesAllergene =
          new ObjetListeElements_1.ObjetListeElements();
        for (
          let i = 0, nbrRepas = this.donnees.listeRepas.count();
          i < nbrRepas;
          i++
        ) {
          const lRepas = this.donnees.listeRepas.get(i);
          const lEstRepasDuSoir =
            lRepas.getGenre() === Enumere_Repas_1.EGenreRepas.Soir;
          if (nbrRepas === 2 || lEstRepasDuSoir || lRepas.getLibelle()) {
            let lLibelleRepas = [
              ObjetTraduction_1.GTraductions.getValeur('menus.RepasMidi'),
              ObjetTraduction_1.GTraductions.getValeur('menus.RepasSoir'),
            ][lRepas.getGenre()];
            if (lRepas.getLibelle()) {
              if (lLibelleRepas !== '') {
                lLibelleRepas += ' : ';
              }
              lLibelleRepas += lRepas.getLibelle();
            }
            if (lEstRepasDuSoir) {
              H.push(`<div class="divider"></div>`);
            }
            H.push('<h3 class="underline" tabindex="0">');
            H.push(lLibelleRepas);
            H.push('</h3>');
          }
          H.push('<ul class="one-line">');
          for (let j = 0; j < lRepas.listePlats.count(); j++) {
            const lPlat = lRepas.listePlats.get(j);
            H.push('<li tabindex="0">', '<div class="conteneur-aliments">');
            const lListeAliments = lPlat.listeAliments.trier();
            lListeAliments.parcourir((aElement) => {
              H.push(`<div class="aliment m-y-s">`);
              H.push(`<div>${aElement.getLibelle()}</div>`);
              const lAvecIcones =
                aElement.listeLabelsAlimentaires.count() > 0 ||
                aElement.listeAllergenesAlimentaire.count() > 0;
              if (lAvecIcones) {
                H.push(`<div>`);
                aElement.listeLabelsAlimentaires.parcourir((aElem) => {
                  H.push(this._getIconeAlimentaire(aElem));
                  if (
                    !lListeIconesLabel.getElementParNumero(aElem.getNumero())
                  ) {
                    lListeIconesLabel.addElement(aElem);
                  }
                });
                aElement.listeAllergenesAlimentaire.parcourir((aElem) => {
                  H.push(
                    UtilitaireMenus_1.UtilitaireMenus.composeAllergene(aElem),
                  );
                  if (!lListeIconesAllergene.getElementParElement(aElem)) {
                    lListeIconesAllergene.addElement(aElem);
                  }
                });
                H.push(`</div>`);
              }
              H.push(`</div>`);
            });
            H.push('</div>', '</li>');
          }
          H.push('</ul>');
        }
        if (this.donnees.listeRepas.count() > 0) {
          const lAvecIcons =
            lListeIconesLabel.count() > 0 || lListeIconesAllergene.count() > 0;
          if (lAvecIcons) {
            H.push('<div class="legende" aria-hidden="true">');
          }
          if (lListeIconesLabel.count() > 0) {
            lListeIconesLabel.parcourir((aElem) => {
              H.push(
                IE.jsx.str(
                  'span',
                  { class: 'menu' },
                  this._getIconeAlimentaire(aElem),
                  aElem.getLibelle(),
                ),
              );
            });
          }
          if (lListeIconesAllergene.count() > 0) {
            lListeIconesAllergene.parcourir((aElem) => {
              H.push(
                IE.jsx.str(
                  'span',
                  { class: 'menu' },
                  UtilitaireMenus_1.UtilitaireMenus.composeAllergene(aElem),
                  aElem.getLibelle(),
                ),
              );
            });
          }
          if (lAvecIcons) {
            H.push('</div>');
          }
        }
        return H.join('');
      }
      _evenementComboMenu(aDate) {
        this.donneesRequete.menuDeLaCantine.date = aDate;
        this.donnees.semaineSelectionnee = IE.Cycles.cycleDeLaDate(
          this.donneesRequete.menuDeLaCantine.date,
        );
        this.callback.appel(
          this.donnees.genre,
          Enumere_EvenementWidget_1.EGenreEvenementWidget.ActualiserWidget,
        );
      }
      static composeWidgetMenuAccessible(aDonnees) {
        const H = [];
        for (let i = 0; i < aDonnees.listeRepas.count(); i++) {
          const lRepas = aDonnees.listeRepas.get(i),
            lLibellePlat = [];
          H.push('<div class="PetitEspace">');
          H.push('<span class="Gras">');
          let lLibelleRepas = '';
          if (
            aDonnees.listeRepas.count() === 2 ||
            lRepas.getGenre() === Enumere_Repas_1.EGenreRepas.Soir
          ) {
            lLibelleRepas = [
              ObjetTraduction_1.GTraductions.getValeur('menus.RepasMidi'),
              ObjetTraduction_1.GTraductions.getValeur('menus.RepasSoir'),
            ][lRepas.getGenre()];
          }
          if (lRepas.getLibelle()) {
            if (lLibelleRepas !== '') {
              lLibelleRepas += ' : ';
            }
            lLibelleRepas += lRepas.getLibelle();
          }
          H.push(lLibelleRepas);
          H.push('</span>');
          if (lLibelleRepas !== '') {
            H.push(' : ');
          }
          for (let j = 0; j < lRepas.listePlats.count(); j++) {
            const lPlat = lRepas.listePlats.get(j);
            lLibellePlat.push(
              lPlat.listeAliments.getTableauLibelles().join(' / '),
            );
          }
          H.push(lLibellePlat.join(' ~ '));
          H.push('</div>');
        }
        return H.join('');
      }
      _getClassIcon(aGenre) {
        return TypeOrigineCreationLabelAlimentaire_1.TypeOrigineCreationLabelAlimentaireUtil.getClassIcone(
          aGenre,
        );
      }
      _getIconeAlimentaire(aElem) {
        const H = [];
        if (
          aElem.getGenre() ===
            TypeOrigineCreationLabelAlimentaire_1
              .TypeOrigineCreationLabelAlimentaire.OCLA_Utilisateur &&
          !!aElem.icone
        ) {
          H.push(
            '<img class="label-alimentaire" src="data:image/png;base64,',
            aElem.icone,
            '" alt="' +
              aElem.getLibelle() +
              '" onerror="$(this).parent().remove();" title="',
            aElem.getLibelle(),
            '"/>',
          );
        } else {
          H.push(
            '<i role="img" aria-label="' +
              aElem.getLibelle() +
              '" class="label-alimentaire icon ' +
              this._getClassIcon(aElem.getGenre()) +
              '" style="color:' +
              aElem.couleur +
              '" title="' +
              aElem.getLibelle() +
              '"></i>',
          );
        }
        return H.join('');
      }
    }
    exports.WidgetMenu = WidgetMenu;
  },
  fn: 'widgetmenu.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { ObjetRequeteConsultation } = require('ObjetRequeteJSON.js');
    const { Requetes } = require('CollectionRequetes.js');
    class ObjetRequeteGenerationURLRecherchePartenaire extends ObjetRequeteConsultation {
      constructor(...aParams) {
        super(...aParams);
      }
      lancerRequete(aDonnees) {
        this.JSON = aDonnees;
        return this.appelAsynchrone();
      }
      actionApresRequete() {
        this.callbackReussite.appel(this.JSONReponse.urlRecherche);
      }
    }
    Requetes.inscrire(
      'GenerationURLRecherchePartenaire',
      ObjetRequeteGenerationURLRecherchePartenaire,
    );
    module.exports = { ObjetRequeteGenerationURLRecherchePartenaire };
  },
  fn: 'objetrequetegenerationurlrecherchepartenaire.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { ObjetRequeteSaisie } = require('ObjetRequeteJSON.js');
    const { Requetes } = require('CollectionRequetes.js');
    const { GTraductions } = require('ObjetTraduction.js');
    class ObjetRequeteSaisieURLPartenaire extends ObjetRequeteSaisie {
      constructor(...aParams) {
        super(...aParams);
        this.setOptions({ avecControleModeExclusif: false });
      }
      lancerRequete(aDonnees) {
        this.JSON.SSO = aDonnees.SSO;
        return this.appelAsynchrone({
          messageDetail: GTraductions.getValeur('requete.VeuillezPatienter'),
        });
      }
      actionApresRequete() {
        this.callbackReussite.appel(this.JSONRapportSaisie.urlSSO);
      }
    }
    Requetes.inscrire('SaisieURLPartenaire', ObjetRequeteSaisieURLPartenaire);
    module.exports = { ObjetRequeteSaisieURLPartenaire };
  },
  fn: 'objetrequetesaisieurlpartenaire.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { ObjetRequeteSaisie } = require('ObjetRequeteJSON.js');
    const { Requetes } = require('CollectionRequetes.js');
    const { GTraductions } = require('ObjetTraduction.js');
    class ObjetRequeteSaisieURLPartenaireCDI extends ObjetRequeteSaisie {
      constructor(...aParams) {
        super(...aParams);
        this.setOptions({ avecControleModeExclusif: false });
      }
      lancerRequete(aDonnees) {
        this.JSON.url = aDonnees.url;
        return this.appelAsynchrone({
          messageDetail: GTraductions.getValeur('requete.VeuillezPatienter'),
        });
      }
      actionApresRequete() {
        this.callbackReussite.appel(this.JSONRapportSaisie.urlSSO);
      }
    }
    Requetes.inscrire(
      'SaisieURLPartenaireCDI',
      ObjetRequeteSaisieURLPartenaireCDI,
    );
    module.exports = { ObjetRequeteSaisieURLPartenaireCDI };
  },
  fn: 'objetrequetesaisieurlpartenairecdi.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TUtilitairePartenaire = void 0;
    const ObjetRequeteGenerationURLRecherchePartenaire_1 = require('ObjetRequeteGenerationURLRecherchePartenaire');
    const ObjetRequeteSaisieURLPartenaire_1 = require('ObjetRequeteSaisieURLPartenaire');
    const ObjetRequeteSaisieURLPartenaireCDI_1 = require('ObjetRequeteSaisieURLPartenaireCDI');
    const TUtilitairePartenaire = {
      windowURLPartenaire: null,
      ouvrirPatience() {
        try {
          if (!GApplication.estAppliMobile) {
            this.windowURLPartenaire = window.open(
              'message.html?G=patiencePartenaire',
              '_blank',
            );
          }
        } catch (e) {
          this.windowURLPartenaire = null;
        }
      },
      fermerPatience() {
        if (this.windowURLPartenaire) {
          this.windowURLPartenaire.close();
        }
      },
      ouvrirUrl(aUrl) {
        if (this.windowURLPartenaire) {
          this.windowURLPartenaire.location.replace(aUrl);
        } else {
          window.open(aUrl);
        }
      },
      ouvrirURLPartenaireCDI(aLien) {
        TUtilitairePartenaire.ouvrirPatience();
        new ObjetRequeteSaisieURLPartenaireCDI_1.ObjetRequeteSaisieURLPartenaireCDI(
          this,
          this._actionSurLienPartenaire,
        ).lancerRequete(aLien);
      },
      ouvrirURLPartenaire(aLien) {
        TUtilitairePartenaire.ouvrirPatience();
        new ObjetRequeteSaisieURLPartenaire_1.ObjetRequeteSaisieURLPartenaire(
          this,
          this._actionSurLienPartenaire,
        ).lancerRequete(aLien);
      },
      ouvrirURLPartenaireRecherche(aObjetPartenaire, aTexteRecherche) {
        TUtilitairePartenaire.ouvrirPatience();
        new ObjetRequeteGenerationURLRecherchePartenaire_1.ObjetRequeteGenerationURLRecherchePartenaire(
          this,
          this._actionSurLienPartenaire,
        ).lancerRequete({
          portailCDI: aObjetPartenaire,
          recherche: aTexteRecherche,
        });
      },
      _actionSurLienPartenaire(aUrlSSO) {
        if (aUrlSSO) {
          if (this.windowURLPartenaire) {
            setTimeout(() => {
              this.windowURLPartenaire.location.replace(aUrlSSO);
            }, 0);
          } else {
            window.open(aUrlSSO);
          }
        } else {
          TUtilitairePartenaire.fermerPatience();
        }
      },
    };
    exports.TUtilitairePartenaire = TUtilitairePartenaire;
  },
  fn: 'utilitairepartenaire.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.WidgetLienUtile = void 0;
    const ObjetChaine_1 = require('ObjetChaine');
    const UtilitairePartenaire_1 = require('UtilitairePartenaire');
    const ObjetWidget_1 = require('ObjetWidget');
    class WidgetLienUtile extends ObjetWidget_1.Widget.ObjetWidget {
      construire(aParams) {
        this.donnees = aParams.donnees;
        const lWidget = {
          html: this.composeWidgetLienUtile(),
          nbrElements: this.donnees.listeLiens.count(),
          afficherMessage: this.donnees.listeLiens.count() === 0,
        };
        $.extend(true, this.donnees, lWidget);
        aParams.construireWidget(this.donnees);
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          surLienPartenaire(aIndice) {
            $(this.node).eventValidation(() => {
              aInstance._surLienPartenaire(aIndice);
            });
          },
          surNumeroTel(aIndice) {
            $(this.node).eventValidation(() => {
              aInstance._surNumeroTel(aIndice);
            });
          },
        });
      }
      composeWidgetLienUtile() {
        const H = [];
        H.push('<ul class="liste-clickable one-line">');
        for (let i = 0; i < this.donnees.listeLiens.count(); i++) {
          const lLien = this.donnees.listeLiens.get(i);
          if (!!lLien.estFavori) {
            continue;
          }
          if (lLien.numeroTel) {
            const lBaliseMobile = `<li class="no-sso"><a tabindex="0" ie-node="surNumeroTel ('${i}')">`;
            const lBaliseDesktop = `<li tabindex="0" class="no-sso yet-unclickable" >`;
            H.push(
              IE.estMobile ? lBaliseMobile : lBaliseDesktop,
              `<div><div>${lLien.numeroTel}</div>${lLien.getLibelle() ? `<p>${lLien.getLibelle()}</p>` : ''}</div>`,
              IE.estMobile ? '</a>' : '',
              '</li>',
            );
          } else if (lLien.SSO) {
            H.push(
              '<li class="has-sso">',
              '<a class="wrapper-link" tabindex="0" ie-node="surLienPartenaire (',
              i,
              ')">',
              '<div class="wrap">',
              '<div ',
              lLien.commentaire ? ' ie-hint="' + lLien.commentaire + '"' : '',
              '>',
              lLien.getLibelle(),
              '</div>',
              lLien.commentaire ? '<p>' + lLien.commentaire + '</p>' : '',
              '</div>',
              '</a>',
              '</li>',
            );
          } else {
            H.push(
              '<li class="no-sso">',
              '<a class="wrapper-link" tabindex="0" href="',
              ObjetChaine_1.GChaine.verifierURLHttp(lLien.url),
              '">',
              '<div class="wrap">',
              '<div ',
              lLien.commentaire ? ' ie-hint="' + lLien.commentaire + '"' : '',
              '>',
              lLien.getLibelle(),
              '</div>',
              lLien.commentaire ? '<p>' + lLien.commentaire + '</p>' : '',
              '</div>',
              '</a>',
              '</li>',
            );
          }
        }
        H.push('</ul>');
        return H.join('');
      }
      _surLienPartenaire(i) {
        const lLien = this.donnees.listeLiens.get(i);
        UtilitairePartenaire_1.TUtilitairePartenaire.ouvrirURLPartenaire(lLien);
      }
      _surNumeroTel(aIndice) {
        const lLienWidget = this.donnees.listeLiens.get(aIndice);
        if (lLienWidget.numeroTel) {
          window.open(
            `tel:${ObjetChaine_1.GChaine.supprimerEspaces(lLienWidget.numeroTel)}`,
          );
        }
      }
    }
    exports.WidgetLienUtile = WidgetLienUtile;
  },
  fn: 'widgetlienutile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { Requetes } = require('CollectionRequetes.js');
    const { ObjetRequeteConsultation } = require('ObjetRequeteJSON.js');
    const { ObjetRequeteSaisie } = require('ObjetRequeteJSON.js');
    const { ObjetFenetre } = require('ObjetFenetre.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { EGenreBoiteMessage } = require('Enumere_BoiteMessage.js');
    const { EGenreEtat } = require('Enumere_Etat.js');
    const { TypeThemeBouton } = require('Type_ThemeBouton.js');
    const { EGenreAction } = require('Enumere_Action.js');
    const { MethodesObjet } = require('MethodesObjet.js');
    const { GUID } = require('GUID.js');
    require('ObjetFenetre_SaisieVisiosCours.css');
    Requetes.inscrire('FenetreSaisieVisiosCours', ObjetRequeteConsultation);
    Requetes.inscrire('SaisieVisio', ObjetRequeteSaisie);
    const TypeBoutonFenetreSaisieVisiosCours = {
      Supprimer: 'supprimer',
      Annuler: 'annuler',
      Valider: 'valider',
    };
    class ObjetFenetre_SaisieVisiosCours extends ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          titre: GTraductions.getValeur(
            'FenetreSaisieVisiosCours.URLAssocieeAuCours',
          ),
          largeur: 500,
          hauteur: 300,
          listeBoutons: [
            {
              libelle: GTraductions.getValeur('Annuler'),
              theme: TypeThemeBouton.secondaire,
              typeBouton: TypeBoutonFenetreSaisieVisiosCours.Annuler,
            },
            {
              libelle: GTraductions.getValeur('Valider'),
              theme: TypeThemeBouton.primaire,
              typeBouton: TypeBoutonFenetreSaisieVisiosCours.Valider,
            },
          ],
          avecComposeBasInFooter: true,
        });
        this.saisieDirecte = false;
        this.estPourHP = false;
        this.callbackOuvrirLienVisio = null;
        this.tailleMaxChamps = { libelle: 60, commentaire: 255 };
        this.donnees = {
          cours: null,
          progression: null,
          nbVisiosMaxProgrammes: 0,
        };
      }
      getVisioCours() {
        return this.donnees.lienVisio;
      }
      getNbVisiosProgrammesSurLaJournee() {
        let lNbVisios = 0;
        if (!!this.donnees.cours) {
          lNbVisios = this.donnees.nbVisiosMaxProgrammes || 0;
        }
        return lNbVisios;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          avecLienTesterURL() {
            const lVisioCours = aInstance.getVisioCours();
            return estLienTesterURLVisible(lVisioCours);
          },
          getNodeTestURL() {
            $(this.node).on('click', (event) => {
              event.preventDefault();
              if (!!aInstance.callbackOuvrirLienVisio) {
                const lVisioCours = aInstance.getVisioCours();
                aInstance.callbackOuvrirLienVisio(lVisioCours);
              }
            });
          },
          modelURL: {
            getValue() {
              const lVisioCours = aInstance.getVisioCours();
              return lVisioCours ? lVisioCours.url || '' : '';
            },
            setValue(aValue) {
              const lVisioCours = aInstance.getVisioCours();
              if (!!lVisioCours) {
                lVisioCours.url = aValue;
                lVisioCours.setEtat(EGenreEtat.Modification);
              }
            },
          },
          modelLibelleLien: {
            getValue() {
              const lVisioCours = aInstance.getVisioCours();
              return lVisioCours ? lVisioCours.libelleLien || '' : '';
            },
            setValue(aValue) {
              const lVisioCours = aInstance.getVisioCours();
              if (!!lVisioCours) {
                lVisioCours.libelleLien = aValue;
                lVisioCours.setEtat(EGenreEtat.Modification);
              }
            },
          },
          modelCommentaire: {
            getValue() {
              const lVisioCours = aInstance.getVisioCours();
              return lVisioCours ? lVisioCours.commentaire || '' : '';
            },
            setValue(aValue) {
              const lVisioCours = aInstance.getVisioCours();
              if (!!lVisioCours) {
                lVisioCours.commentaire = aValue;
                lVisioCours.setEtat(EGenreEtat.Modification);
              }
            },
          },
          btnSupprimer: {
            event() {
              aInstance._surValidation(
                TypeBoutonFenetreSaisieVisiosCours.Supprimer,
              );
            },
            getDisabled() {
              const lVisioCours = aInstance.getVisioCours();
              return (
                !lVisioCours ||
                !lVisioCours.existeNumero() ||
                lVisioCours.getEtat() === EGenreEtat.Creation
              );
            },
          },
          afficherNbVisiosProgrammes() {
            return aInstance.getNbVisiosProgrammesSurLaJournee() > 0;
          },
          getStrNbVisiosProgrammes() {
            const lNbVisios = aInstance.getNbVisiosProgrammesSurLaJournee();
            if (lNbVisios > 1) {
              return GTraductions.getValeur(
                'FenetreSaisieVisiosCours.XCoursEnVisioProgrammes',
                [lNbVisios],
              );
            } else {
              return GTraductions.getValeur(
                'FenetreSaisieVisiosCours.1CoursEnVisioProgramme',
              );
            }
          },
        });
      }
      setAvecSaisieDirecte(aSaisieDirecte) {
        this.saisieDirecte = !!aSaisieDirecte;
      }
      setCallbackOuvrirLienVisio(aCallbackOuvrirLienVisio) {
        this.callbackOuvrirLienVisio = aCallbackOuvrirLienVisio;
      }
      setDonnees(aParametres) {
        this.donnees.lienVisio = aParametres.lienVisio;
        this.callbackValider = aParametres.callbackValider;
        this.sauvegardeVisio = MethodesObjet.dupliquer(aParametres.lienVisio);
        if (!!aParametres) {
          if (aParametres.tailleMaxLibelle) {
            this.tailleMaxChamps.libelle = aParametres.tailleMaxLibelle;
          }
          if (aParametres.tailleMaxCommentaire) {
            this.tailleMaxChamps.commentaire = aParametres.tailleMaxCommentaire;
          }
        }
        const lThis = this;
        lThis.donnees.nbVisiosMaxProgrammes = 0;
        lThis.afficher();
      }
      composeContenu() {
        const T = [];
        const lIdInputURLCours = GUID.getId();
        const lIdInputLibelleURL = GUID.getId();
        const lIdTextareaCommentaire = GUID.getId();
        T.push('<div class="flex-contain cols">');
        T.push(
          `<div class="field-contain label-up">\n              <div class="flex-contain flex-center justify-between">\n                  <label for="${lIdInputURLCours}" class="fluid-bloc">${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampURL')} : ${GTraductions.getValeur('FenetreSaisieVisiosCours.MarqueurChampObligatoire')}</label>\n                  <span class="fluid-bloc text-end m-bottom-l" ie-node="getNodeTestURL" ie-if="avecLienTesterURL">\n                    <a href="#">${GTraductions.getValeur('FenetreSaisieVisiosCours.TesterURL')}</a>\n                  </span>\n              </div>\n\n              <input id="${lIdInputURLCours}" ie-model="modelURL" ie-trim class="round-style full-width" required="true"/>\n            </div>`,
        );
        T.push(
          `<div class="field-contain label-up">\n              <label for="${lIdInputLibelleURL}">${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampLibelleURL')} :</label>\n              <input id="${lIdInputLibelleURL}" ie-model="modelLibelleLien" ie-trim class="round-style full-width" maxlength="${this.tailleMaxChamps.libelle}"/>\n            </div>`,
        );
        T.push(
          `<div class="field-contain label-up">\n              <label for="${lIdTextareaCommentaire}">${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampCommentaireURL')} :</label>\n              <ie-textareamax id="${lIdTextareaCommentaire}" ${!IE.estMobile ? `style="height: 6rem;"` : ``}  ie-model="modelCommentaire" class="full-width" maxlength="${this.tailleMaxChamps.commentaire}" placeholder="${GTraductions.getValeur('FenetreSaisieVisiosCours.PlaceholderCommentaire')}"></ie-textareamax>\n            </div>`,
        );
        T.push(
          `<div ie-if="afficherNbVisiosProgrammes()">\n              <span ie-html="getStrNbVisiosProgrammes()"></span>\n            </div>`,
        );
        T.push(`<div class="m-top-l ${IE.estMobile ? ` m-bottom-nega-xl` : `m-bottom-nega-l`}">\n                ${GTraductions.getValeur('FenetreSaisieVisiosCours.MarqueurChampObligatoire')} ${GTraductions.getValeur('FenetreSaisieVisiosCours.ChampObligatoire')}
            </div>`);
        T.push('</div>');
        return T.join('');
      }
      composeBas() {
        const lHTML = [];
        lHTML.push('<div class="compose-bas">');
        lHTML.push(
          '<ie-btnicon ie-model="btnSupprimer" title="',
          GTraductions.getValeur('Supprimer'),
          '" class="icon_trash avecFond i-medium"></ie-btnicon>',
        );
        lHTML.push('</div>');
        return lHTML.join('');
      }
      surValidation(aNumeroBouton) {
        let lTypeBouton = TypeBoutonFenetreSaisieVisiosCours.Annuler;
        const lBouton = this.getBoutonNumero(aNumeroBouton);
        if (!!lBouton && lBouton.typeBouton !== undefined) {
          lTypeBouton = lBouton.typeBouton;
        }
        this._surValidation(lTypeBouton);
      }
      _surValidation(aTypeBouton) {
        let lVisioCours = this.getVisioCours();
        if (!lVisioCours) {
          this.fermer();
          return;
        }
        if (aTypeBouton === TypeBoutonFenetreSaisieVisiosCours.Valider) {
          const lMessagesChampsObligatoires = [];
          if (!lVisioCours.url || lVisioCours.url.length === 0) {
            lMessagesChampsObligatoires.push(
              GTraductions.getValeur(
                'FenetreSaisieVisiosCours.ChampURLEstObligatoire',
              ),
            );
          }
          if (lMessagesChampsObligatoires.length > 0) {
            GApplication.getMessage().afficher({
              type: EGenreBoiteMessage.Information,
              message: lMessagesChampsObligatoires.join('<br/>'),
            });
            return;
          }
        }
        if (aTypeBouton === TypeBoutonFenetreSaisieVisiosCours.Annuler) {
          lVisioCours = this.sauvegardeVisio;
        }
        const lThis = this;
        (aTypeBouton === TypeBoutonFenetreSaisieVisiosCours.Supprimer
          ? new Promise((aResolve) => {
              GApplication.getMessage().afficher({
                type: EGenreBoiteMessage.Confirmation,
                message: GTraductions.getValeur(
                  'FenetreSaisieVisiosCours.ConfirmationSuppression',
                ),
                callback: function (aNumeroBouton) {
                  if (aNumeroBouton === EGenreAction.Valider) {
                    aResolve();
                  }
                },
              });
            })
          : Promise.resolve()
        ).then(() => {
          if (aTypeBouton === TypeBoutonFenetreSaisieVisiosCours.Supprimer) {
            lVisioCours.setEtat(EGenreEtat.Suppression);
          } else if (
            aTypeBouton !== TypeBoutonFenetreSaisieVisiosCours.Valider
          ) {
            if (lVisioCours.getEtat() === EGenreEtat.Creation) {
              lVisioCours.setEtat(EGenreEtat.Suppression);
            }
          }
          if (
            lThis.saisieDirecte &&
            (aTypeBouton === TypeBoutonFenetreSaisieVisiosCours.Valider ||
              aTypeBouton === TypeBoutonFenetreSaisieVisiosCours.Supprimer)
          ) {
            lThis.callbackValider(aTypeBouton, lThis.donnees);
          } else {
            lThis.callback.appel(aTypeBouton, lThis.donnees);
          }
          lThis.fermer();
        });
      }
    }
    function estLienTesterURLVisible(aVisioCours) {
      let lEstLienVisible = true;
      if (!aVisioCours || !aVisioCours.url || aVisioCours.url.length === 0) {
        lEstLienVisible = false;
      }
      return lEstLienVisible;
    }
    module.exports = {
      ObjetFenetre_SaisieVisiosCours,
      TypeBoutonFenetreSaisieVisiosCours,
    };
  },
  fn: 'objetfenetre_saisievisioscours.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireVisios = void 0;
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetFenetre_SaisieVisiosCours_1 = require('ObjetFenetre_SaisieVisiosCours');
    const ObjetFenetre_SaisieVisiosCours_2 = require('ObjetFenetre_SaisieVisiosCours');
    const tag_1 = require('tag');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetElement_1 = require('ObjetElement');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    class UtilitaireVisios {
      constructor() {}
      getTailleMaxLibelle() {
        return 0;
      }
      getTailleMaxCommentaire() {
        return 0;
      }
      getNomIconeParametrageVisios() {
        return 'icon_cours_virtuel_lien';
      }
      getNomIconePresenceVisios() {
        return 'icon_cours_virtuel';
      }
      getHintListeVisiosCours(aListeVisiosCours) {
        const H = [];
        if (
          !!aListeVisiosCours &&
          aListeVisiosCours.getNbrElementsExistes() > 0
        ) {
          aListeVisiosCours.parcourir((aVisioCours) => {
            H.push(this.getHintVisio(aVisioCours));
          });
        }
        return H.join('');
      }
      getHintVisio(aElementVisios) {
        const H = [];
        if (aElementVisios) {
          if (!!aElementVisios.libelleLien) {
            H.push(
              '<span style="font-weight: bold;">',
              aElementVisios.libelleLien,
              '</span>',
            );
          } else if (!!aElementVisios.url) {
            H.push(aElementVisios.url);
          }
          if (!!aElementVisios.commentaire) {
            if (H.length > 0) {
              H.push('<br/>');
            }
            H.push(
              ObjetChaine_1.GChaine.replaceRCToHTML(aElementVisios.commentaire),
            );
          }
        }
        return H.join('');
      }
      ouvrirLiensVisioCours(aListeVisiosCours) {
        if (
          !!aListeVisiosCours &&
          aListeVisiosCours.getNbrElementsExistes() > 0
        ) {
          this.ouvrirLienVisioCours(aListeVisiosCours.getPremierElement());
        }
      }
      ouvrirLienVisioCours(aVisioCours) {
        if (
          !!aVisioCours &&
          !!aVisioCours.url &&
          aVisioCours.url !== '##BBB##'
        ) {
          const lURLCorrigee = ObjetChaine_1.GChaine.verifierURLHttp(
            aVisioCours.url,
          );
          window.open(lURLCorrigee);
        } else if (!!aVisioCours && aVisioCours.url === '##BBB##') {
          this.visioEnCours(aVisioCours).then(
            (aJSON) => {
              const lJSON = aJSON;
              if (!lJSON.estEnCours) {
                GApplication.getMessage()
                  .afficher({ message: aJSON.message })
                  .then(() => {});
              } else {
                this.visioUrl(aVisioCours).then(
                  (aJSON) => {
                    const lJSON = aJSON;
                    if (lJSON.urlVisio) {
                      window.open(lJSON.urlVisio);
                    }
                  },
                  () => {},
                );
              }
            },
            () => {},
          );
        } else {
          GApplication.getMessage()
            .afficher({
              message:
                ObjetTraduction_1.GTraductions.getValeur('requete.erreur'),
            })
            .then(() => {});
        }
      }
      ouvrirFenetreEditionVisios(
        aVisio,
        aCallbackApresModification,
        aCallbackValidation,
      ) {
        const lFenetre = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_SaisieVisiosCours_1.ObjetFenetre_SaisieVisiosCours,
          {
            pere: this,
            initialiser: function (aInstance) {
              if (aVisio.titreFenetre) {
                aInstance.setOptionsFenetre({ titre: aVisio.titreFenetre });
              }
            },
            evenement: function (aNumeroBouton) {
              if (
                aNumeroBouton ===
                ObjetFenetre_SaisieVisiosCours_2
                  .TypeBoutonFenetreSaisieVisiosCours.Annuler
              ) {
                if (aVisio.getEtat() === Enumere_Etat_1.EGenreEtat.Creation) {
                  aVisio.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
                }
              } else if (
                aNumeroBouton !==
                ObjetFenetre_SaisieVisiosCours_2
                  .TypeBoutonFenetreSaisieVisiosCours.Annuler
              ) {
                if (!!aCallbackApresModification) {
                  aCallbackApresModification();
                }
              }
            },
          },
        );
        const lParams = {
          lienVisio: aVisio,
          tailleMaxLibelle: this.getTailleMaxLibelle(),
          tailleMaxCommentaire: this.getTailleMaxCommentaire(),
          callbackValider: aCallbackValidation,
        };
        lFenetre.setAvecSaisieDirecte(true);
        lFenetre.setCallbackOuvrirLienVisio(this.ouvrirLienVisioCours);
        lFenetre.setDonnees(lParams);
      }
      ouvrirFenetreEditionVisiosCoursNSeances(
        aToutesSeances,
        aCours,
        aCallbackApresModification,
        aDomaine,
        aEstConteu,
      ) {
        let lVisio;
        if (!!aCours && !!aCours.listeVisios) {
          aCours.listeVisios.parcourir((aElt) => {
            if (aElt.concerneProgression === aToutesSeances) {
              lVisio = aElt;
            }
          });
        }
        if (!lVisio) {
          lVisio = new ObjetElement_1.ObjetElement();
          lVisio.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
          if (!aCours.listeVisios) {
            aCours.listeVisios = new ObjetListeElements_1.ObjetListeElements();
          }
          aCours.listeVisios.add(lVisio);
        }
        this.ouvrirFenetreEditionVisios(
          lVisio,
          aCallbackApresModification,
          this.callbackValidationCours.bind(
            this,
            aCours,
            aEstConteu,
            aCallbackApresModification,
            aDomaine,
          ),
        );
      }
      ouvrirFenetreEditionVisiosCours(
        aCours,
        aCallbackApresModification,
        aDomaine,
        aEstConteu,
      ) {
        let lVisio;
        if (!!aDomaine && aDomaine.getNbrValeurs() > 1) {
          lVisio = new ObjetElement_1.ObjetElement();
          lVisio.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
          if (!aCours.listeVisios) {
            aCours.listeVisios = new ObjetListeElements_1.ObjetListeElements();
          }
          aCours.listeVisios.add(lVisio);
        } else {
          lVisio = this.obtenirLienVisioDeCours(aCours);
        }
        this.ouvrirFenetreEditionVisios(
          lVisio,
          aCallbackApresModification,
          this.callbackValidationCours.bind(
            this,
            aCours,
            aEstConteu,
            aCallbackApresModification,
            aDomaine,
          ),
        );
      }
      obtenirLienVisioDeCours(aElement) {
        let lVisio;
        if (!!aElement) {
          if (!aElement.listeVisios) {
            aElement.listeVisios =
              new ObjetListeElements_1.ObjetListeElements();
          }
          if (aElement.listeVisios.getNbrElementsExistes() === 0) {
            const lNouveauVisio = new ObjetElement_1.ObjetElement();
            lNouveauVisio.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
            aElement.listeVisios.add(lNouveauVisio);
          }
          lVisio = aElement.listeVisios.getPremierElement();
          aElement.listeVisios.parcourir((aElt) => {
            if (!aElt.concerneProgression) {
              lVisio = aElt;
            }
          });
        }
        return lVisio;
      }
      ouvrirFenetreEditionVisiosProgramme(
        aProgramme,
        aEstContenu,
        aCallbackApresModification,
      ) {
        let lVisio;
        if (!!aProgramme) {
          if (!aProgramme.liensVisio) {
            aProgramme.liensVisio =
              new ObjetListeElements_1.ObjetListeElements();
          }
          if (aProgramme.liensVisio.getNbrElementsExistes() === 0) {
            const lNouveauVisio = new ObjetElement_1.ObjetElement();
            lNouveauVisio.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
            aProgramme.liensVisio.add(lNouveauVisio);
          }
          lVisio = aProgramme.liensVisio.getPremierElement();
        }
        this.ouvrirFenetreEditionVisios(
          lVisio,
          aCallbackApresModification,
          this.callbackValidationProgramme.bind(
            this,
            aProgramme,
            aEstContenu,
            aCallbackApresModification,
          ),
        );
      }
      callbackValidationCours(
        aCours,
        aEstContenu,
        aCallbackApresModification,
        aDomaine,
      ) {
        const lParamsSaisie = {
          cours: aCours.toJSON(),
          domaine: aDomaine,
          estContenu: aEstContenu,
          estProgramme: !aEstContenu,
          estCours: true,
          elementParent: aCours.toJSON(),
          listeVisio: aCours.listeVisios,
        };
        lParamsSaisie.cours.dateCours = aCours.DateDuCours;
        lParamsSaisie.listeVisio.setSerialisateurJSON({
          methodeSerialisation: function (aElement, AJSON) {
            AJSON.url = aElement.url;
            AJSON.libelleLien = aElement.libelleLien;
            AJSON.commentaire = aElement.commentaire;
          },
        });
        (0, CollectionRequetes_1.Requetes)('SaisieVisio', this)
          .lancerRequete(lParamsSaisie)
          .then(() => {
            if (aCallbackApresModification) {
              aCallbackApresModification.call(this);
            }
          });
      }
      callbackValidationProgramme(
        aProgramme,
        aEstContenu,
        aCallbackApresModification,
      ) {
        const lParamsSaisie = {
          estContenu: aEstContenu,
          estProgramme: !aEstContenu,
          estCours: false,
          elementParent: aProgramme.toJSON(),
          listeVisio: aProgramme.liensVisio,
        };
        lParamsSaisie.listeVisio.setSerialisateurJSON({
          methodeSerialisation: function (aElement, AJSON) {
            AJSON.url = aElement.url;
            AJSON.libelleLien = aElement.libelleLien;
            AJSON.commentaire = aElement.commentaire;
          },
        });
        if (
          !aProgramme.existeNumero() &&
          aProgramme.listeServices &&
          aProgramme.listeServices.count() > 0
        ) {
          aProgramme.listeServices.setSerialisateurJSON({
            methodeSerialisation: () => {
              return true;
            },
          });
          lParamsSaisie.elementParent.listeServices =
            aProgramme.listeServices.toJSON();
        }
        (0, CollectionRequetes_1.Requetes)('SaisieVisio', this)
          .lancerRequete(lParamsSaisie)
          .then(() => {
            if (aCallbackApresModification) {
              aCallbackApresModification.call(this);
            }
          });
      }
      ouvrirFenetreConsultVisio(aElementVisio, aOptions) {
        if (aElementVisio && aElementVisio.url) {
          const lUrl = aElementVisio.url;
          const lLibelleLien = aElementVisio.libelleLien;
          const lCommentaire = aElementVisio.commentaire;
          const lAvecLibelleLien = !!lLibelleLien && lLibelleLien.length > 0;
          const lAvecCommentaire = !!lCommentaire && lCommentaire.length > 0;
          if (lUrl !== '##BBB##' && (lAvecLibelleLien || lAvecCommentaire)) {
            const lMessage = [];
            lMessage.push(
              (0, tag_1.tag)(
                'div',
                { class: 'AlignementMilieu' },
                (0, tag_1.tag)(
                  'ie-chips',
                  {
                    class: ['iconic', this.getNomIconePresenceVisios()],
                    href: ObjetChaine_1.GChaine.verifierURLHttp(lUrl),
                  },
                  lAvecLibelleLien
                    ? lLibelleLien
                    : ObjetTraduction_1.GTraductions.getValeur(
                        'FenetreSaisieVisiosCours.AccederAuCoursVirtuel',
                      ),
                ),
              ),
            );
            if (lAvecCommentaire) {
              lMessage.push(
                '<div class="EspaceHaut10">',
                ObjetChaine_1.GChaine.replaceRCToHTML(lCommentaire),
                '</div>',
              );
            }
            const lFenetreLienVisioCours =
              ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
                ObjetFenetre_1.ObjetFenetre,
                {
                  pere: this,
                  initialiser: function (aInstance) {
                    aInstance.setOptionsFenetre({
                      modale: true,
                      largeur: 350,
                      titre: aOptions && aOptions.titre ? aOptions.titre : '',
                      fermerFenetreSurClicHorsFenetre: true,
                    });
                  },
                },
              );
            lFenetreLienVisioCours.afficher(lMessage.join(''));
          } else {
            this.ouvrirLienVisioCours(aElementVisio);
          }
        }
      }
      visioEnCours(aIdVisio) {
        return new ObjetRequeteVisioAttente({})
          .lancerRequete({ visioEnCours: true, visio: aIdVisio })
          .then((aJSON) => {
            return aJSON;
          })
          .catch((aError) => {
            if (aError && aError.sansMessage) {
              return Promise.reject();
            }
            return GApplication.getMessage()
              .afficher({
                message:
                  aError ||
                  ObjetTraduction_1.GTraductions.getValeur(
                    'UtilitaireVisio.echec',
                  ),
              })
              .then(() => {
                return Promise.reject();
              });
          });
      }
      visioUrl(aIdVisio) {
        return new ObjetRequeteVisioAttente({})
          .lancerRequete({ getUrlVisio: true, visio: aIdVisio })
          .then((aJSON) => {
            return aJSON;
          })
          .catch((aError) => {
            if (aError && aError.sansMessage) {
              return Promise.reject();
            }
            return GApplication.getMessage()
              .afficher({
                message:
                  aError ||
                  ObjetTraduction_1.GTraductions.getValeur(
                    'UtilitaireVisio.echec',
                  ),
              })
              .then(() => {
                return Promise.reject();
              });
          });
      }
    }
    exports.UtilitaireVisios = UtilitaireVisios;
    class ObjetRequeteVisioAttente extends ObjetRequeteJSON_1.ObjetRequeteConsultation {}
    CollectionRequetes_1.Requetes.inscrire(
      'VisioAttente',
      ObjetRequeteVisioAttente,
    );
  },
  fn: 'utilitairevisios.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireVisios = void 0;
    const UtilitaireVisios_1 = require('UtilitaireVisios');
    class UtilitaireVisiosSco extends UtilitaireVisios_1.UtilitaireVisios {
      getTailleMaxLibelle() {
        return GParametres.tailleMaxLibelleUrlCours;
      }
      getTailleMaxCommentaire() {
        return GParametres.tailleMaxCommentaireUrlCours;
      }
    }
    const lUtilitaireVisiosSco = new UtilitaireVisiosSco();
    exports.UtilitaireVisios = lUtilitaireVisiosSco;
  },
  fn: 'utilitairevisiossco.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireUrl = void 0;
    const ObjetChaine_1 = require('ObjetChaine');
    exports.UtilitaireUrl = {
      construireListeUrls(aListe, aParams) {
        const lParams = Object.assign(
          {
            genreFiltre: null,
            genreRessource: exports.UtilitaireUrl.genreRessourceDefault,
            separateur: ' ',
            IEModelChips: '',
            argsIEModelChips: null,
            maxWidth: 0,
            class: '',
          },
          aParams,
        );
        if (!aListe || !aListe.parcourir) {
          return '';
        }
        const T = [];
        aListe.parcourir((aElement, aIndex) => {
          if (aElement.existe()) {
            if (
              lParams.genreFiltre === null ||
              lParams.genreFiltre === undefined ||
              aElement.getGenre() === lParams.genreFiltre
            ) {
              let lArgsIEModel = null;
              if (!!lParams.IEModelChips) {
                lArgsIEModel = [aIndex];
                if (
                  !!lParams.argsIEModelChips &&
                  Array.isArray(lParams.argsIEModelChips)
                ) {
                  lArgsIEModel = lArgsIEModel.concat(lParams.argsIEModelChips);
                }
              }
              const lIeChips = ObjetChaine_1.GChaine.composerUrlLienExterne({
                documentJoint: aElement,
                genreRessource: lParams.genreRessource,
                maxWidth: lParams.maxWidth,
                ieModelChips: lParams.IEModelChips,
                argsIEModel: lArgsIEModel,
                class: lParams.class,
              });
              T.push(IE.jsx.str('div', null, lIeChips));
            }
          }
        });
        let lResult = T.join(lParams.separateur);
        if (T.length > 0) {
          lResult = IE.jsx.str('div', { class: 'liste-url-chips' }, lResult);
        }
        return lResult;
      },
      genreRessourceDefault: null,
    };
  },
  fn: 'utilitaireurl.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreObservationVS = void 0;
    var TypeGenreObservationVS;
    (function (TypeGenreObservationVS) {
      TypeGenreObservationVS[(TypeGenreObservationVS['OVS_DefautCarnet'] = 0)] =
        'OVS_DefautCarnet';
      TypeGenreObservationVS[
        (TypeGenreObservationVS['OVS_ObservationParent'] = 1)
      ] = 'OVS_ObservationParent';
      TypeGenreObservationVS[
        (TypeGenreObservationVS['OVS_Encouragement'] = 2)
      ] = 'OVS_Encouragement';
      TypeGenreObservationVS[(TypeGenreObservationVS['OVS_Autres'] = 3)] =
        'OVS_Autres';
    })(
      TypeGenreObservationVS ||
        (exports.TypeGenreObservationVS = TypeGenreObservationVS = {}),
    );
  },
  fn: 'typegenreobservationvs.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenrePunition = void 0;
    var TypeGenrePunition;
    (function (TypeGenrePunition) {
      TypeGenrePunition[(TypeGenrePunition['GP_ExclusionCours'] = 0)] =
        'GP_ExclusionCours';
      TypeGenrePunition[(TypeGenrePunition['GP_Retenues'] = 1)] = 'GP_Retenues';
      TypeGenrePunition[(TypeGenrePunition['GP_Devoir'] = 2)] = 'GP_Devoir';
      TypeGenrePunition[(TypeGenrePunition['GP_Autre'] = 3)] = 'GP_Autre';
    })(
      TypeGenrePunition || (exports.TypeGenrePunition = TypeGenrePunition = {}),
    );
  },
  fn: 'typegenrepunition.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreRessourceUtil = exports.EGenreRessource = void 0;
    var EGenreRessource;
    (function (EGenreRessource) {
      EGenreRessource[(EGenreRessource['Aucune'] = 0)] = 'Aucune';
      EGenreRessource[(EGenreRessource['Classe'] = 1)] = 'Classe';
      EGenreRessource[(EGenreRessource['Groupe'] = 2)] = 'Groupe';
      EGenreRessource[(EGenreRessource['Enseignant'] = 3)] = 'Enseignant';
      EGenreRessource[(EGenreRessource['Eleve'] = 4)] = 'Eleve';
      EGenreRessource[(EGenreRessource['Responsable'] = 5)] = 'Responsable';
      EGenreRessource[(EGenreRessource['Niveau'] = 6)] = 'Niveau';
      EGenreRessource[(EGenreRessource['Orientation'] = 7)] = 'Orientation';
      EGenreRessource[(EGenreRessource['Specialite'] = 8)] = 'Specialite';
      EGenreRessource[(EGenreRessource['OptionSpecialite'] = 9)] =
        'OptionSpecialite';
      EGenreRessource[(EGenreRessource['Etablissement'] = 10)] =
        'Etablissement';
      EGenreRessource[(EGenreRessource['Periode'] = 11)] = 'Periode';
      EGenreRessource[(EGenreRessource['Service'] = 12)] = 'Service';
      EGenreRessource[(EGenreRessource['Absence'] = 13)] = 'Absence';
      EGenreRessource[(EGenreRessource['Retard'] = 14)] = 'Retard';
      EGenreRessource[(EGenreRessource['Exclusion'] = 15)] = 'Exclusion';
      EGenreRessource[(EGenreRessource['Matiere'] = 16)] = 'Matiere';
      EGenreRessource[(EGenreRessource['Salle'] = 17)] = 'Salle';
      EGenreRessource[(EGenreRessource['CoEnseignant'] = 18)] = 'CoEnseignant';
      EGenreRessource[(EGenreRessource['Suivis'] = 19)] = 'Suivis';
      EGenreRessource[(EGenreRessource['Cours'] = 20)] = 'Cours';
      EGenreRessource[(EGenreRessource['Infirmerie'] = 21)] = 'Infirmerie';
      EGenreRessource[(EGenreRessource['AbsenceRepas'] = 22)] = 'AbsenceRepas';
      EGenreRessource[(EGenreRessource['Pilier'] = 23)] = 'Pilier';
      EGenreRessource[(EGenreRessource['ElementPilier'] = 24)] =
        'ElementPilier';
      EGenreRessource[(EGenreRessource['Competence'] = 25)] = 'Competence';
      EGenreRessource[(EGenreRessource['_DisciplineBrevet'] = 26)] =
        '_DisciplineBrevet';
      EGenreRessource[(EGenreRessource['Palier'] = 27)] = 'Palier';
      EGenreRessource[(EGenreRessource['SousItem'] = 28)] = 'SousItem';
      EGenreRessource[(EGenreRessource['Evaluation'] = 29)] = 'Evaluation';
      EGenreRessource[(EGenreRessource['Stage'] = 30)] = 'Stage';
      EGenreRessource[(EGenreRessource['SousMatiere'] = 31)] = 'SousMatiere';
      EGenreRessource[(EGenreRessource['MaitreDeStage'] = 32)] =
        'MaitreDeStage';
      EGenreRessource[(EGenreRessource['InspecteurPedagogique'] = 33)] =
        'InspecteurPedagogique';
      EGenreRessource[(EGenreRessource['Personnel'] = 34)] = 'Personnel';
      EGenreRessource[(EGenreRessource['EvaluationHistorique'] = 35)] =
        'EvaluationHistorique';
      EGenreRessource[(EGenreRessource['DossierProgression'] = 36)] =
        'DossierProgression';
      EGenreRessource[(EGenreRessource['ContenuDeCours'] = 37)] =
        'ContenuDeCours';
      EGenreRessource[(EGenreRessource['TravailAFaire'] = 38)] =
        'TravailAFaire';
      EGenreRessource[(EGenreRessource['Progression'] = 39)] = 'Progression';
      EGenreRessource[(EGenreRessource['Dispense'] = 40)] = 'Dispense';
      EGenreRessource[(EGenreRessource['Punition'] = 41)] = 'Punition';
      EGenreRessource[(EGenreRessource['Sanction'] = 42)] = 'Sanction';
      EGenreRessource[(EGenreRessource['Communication'] = 43)] =
        'Communication';
      EGenreRessource[(EGenreRessource['AbsenceInternat'] = 44)] =
        'AbsenceInternat';
      EGenreRessource[(EGenreRessource['Observation'] = 45)] = 'Observation';
      EGenreRessource[(EGenreRessource['ObservationProfesseurEleve'] = 46)] =
        'ObservationProfesseurEleve';
      EGenreRessource[(EGenreRessource['ConvocationVS'] = 47)] =
        'ConvocationVS';
      EGenreRessource[(EGenreRessource['DocumentJoint'] = 48)] =
        'DocumentJoint';
      EGenreRessource[(EGenreRessource['InternetCategorie'] = 49)] =
        'InternetCategorie';
      EGenreRessource[(EGenreRessource['DocJointEtablissement'] = 50)] =
        'DocJointEtablissement';
      EGenreRessource[(EGenreRessource['Option'] = 51)] = 'Option';
      EGenreRessource[(EGenreRessource['ProgrammationPunition'] = 52)] =
        'ProgrammationPunition';
      EGenreRessource[(EGenreRessource['ReportPunition'] = 53)] =
        'ReportPunition';
      EGenreRessource[(EGenreRessource['DisciplineLivretScolaire'] = 54)] =
        'DisciplineLivretScolaire';
      EGenreRessource[(EGenreRessource['QCM'] = 55)] = 'QCM';
      EGenreRessource[(EGenreRessource['ExecutionQCM'] = 56)] = 'ExecutionQCM';
      EGenreRessource[(EGenreRessource['QCMEditeur'] = 57)] = 'QCMEditeur';
      EGenreRessource[(EGenreRessource['PartieDeClasse'] = 58)] =
        'PartieDeClasse';
      EGenreRessource[(EGenreRessource['DocJointEleve'] = 59)] =
        'DocJointEleve';
      EGenreRessource[(EGenreRessource['Devoir'] = 60)] = 'Devoir';
      EGenreRessource[(EGenreRessource['InternetEnumere'] = 61)] =
        'InternetEnumere';
      EGenreRessource[
        (EGenreRessource['AppreciationBulletinCompetence'] = 62)
      ] = 'AppreciationBulletinCompetence';
      EGenreRessource[(EGenreRessource['Entreprise'] = 63)] = 'Entreprise';
      EGenreRessource[(EGenreRessource['DomaineProfessionnel'] = 64)] =
        'DomaineProfessionnel';
      EGenreRessource[(EGenreRessource['OffreDeStage'] = 65)] = 'OffreDeStage';
      EGenreRessource[(EGenreRessource['SujetDeStage'] = 66)] = 'SujetDeStage';
      EGenreRessource[(EGenreRessource['DocumentCasier'] = 67)] =
        'DocumentCasier';
      EGenreRessource[(EGenreRessource['Message'] = 68)] = 'Message';
      EGenreRessource[(EGenreRessource['PossessionMessage'] = 69)] =
        'PossessionMessage';
      EGenreRessource[
        (EGenreRessource['RelationMessageDocJointEtablissement'] = 70)
      ] = 'RelationMessageDocJointEtablissement';
      EGenreRessource[(EGenreRessource['Engagement'] = 71)] = 'Engagement';
      EGenreRessource[(EGenreRessource['MesureConservatoire'] = 72)] =
        'MesureConservatoire';
      EGenreRessource[(EGenreRessource['SousCategorieObjetDossier'] = 73)] =
        'SousCategorieObjetDossier';
      EGenreRessource[(EGenreRessource['Incident'] = 74)] = 'Incident';
      EGenreRessource[(EGenreRessource['ProtagonisteIncident'] = 75)] =
        'ProtagonisteIncident';
      EGenreRessource[
        (EGenreRessource['RelationIncidentFichierExterne'] = 76)
      ] = 'RelationIncidentFichierExterne';
      EGenreRessource[(EGenreRessource['RegimeEleve'] = 77)] = 'RegimeEleve';
      EGenreRessource[(EGenreRessource['RepasAPreparer'] = 78)] =
        'RepasAPreparer';
      EGenreRessource[(EGenreRessource['SessionDeStage'] = 79)] =
        'SessionDeStage';
      EGenreRessource[(EGenreRessource['Materiel'] = 80)] = 'Materiel';
      EGenreRessource[(EGenreRessource['Bourse'] = 81)] = 'Bourse';
      EGenreRessource[(EGenreRessource['RelationTravailAFaireEleve'] = 82)] =
        'RelationTravailAFaireEleve';
      EGenreRessource[(EGenreRessource['LieuDossier'] = 83)] = 'LieuDossier';
      EGenreRessource[(EGenreRessource['ElementProgramme'] = 84)] =
        'ElementProgramme';
      EGenreRessource[(EGenreRessource['ChapitreEltPgm'] = 85)] =
        'ChapitreEltPgm';
      EGenreRessource[(EGenreRessource['EltPgmTravailleCDT'] = 86)] =
        'EltPgmTravailleCDT';
      EGenreRessource[(EGenreRessource['Appreciation'] = 87)] = 'Appreciation';
      EGenreRessource[(EGenreRessource['ExecutionDevoirKiosque'] = 88)] =
        'ExecutionDevoirKiosque';
      EGenreRessource[(EGenreRessource['PanierRessourceKiosque'] = 89)] =
        'PanierRessourceKiosque';
      EGenreRessource[(EGenreRessource['RessourceNumeriqueKiosque'] = 90)] =
        'RessourceNumeriqueKiosque';
      EGenreRessource[(EGenreRessource['MetaMatiere'] = 91)] = 'MetaMatiere';
      EGenreRessource[(EGenreRessource['EvaluationSujet'] = 92)] =
        'EvaluationSujet';
      EGenreRessource[(EGenreRessource['EvaluationCorrige'] = 93)] =
        'EvaluationCorrige';
      EGenreRessource[(EGenreRessource['LibelleCours'] = 94)] = 'LibelleCours';
      EGenreRessource[(EGenreRessource['Site'] = 95)] = 'Site';
      EGenreRessource[(EGenreRessource['QuestionQCM'] = 96)] = 'QuestionQCM';
      EGenreRessource[
        (EGenreRessource['RelationElevePilierDeCompetence'] = 97)
      ] = 'RelationElevePilierDeCompetence';
      EGenreRessource[(EGenreRessource['QuestionCopieQCM'] = 98)] =
        'QuestionCopieQCM';
      EGenreRessource[(EGenreRessource['Coordonnees'] = 99)] = 'Coordonnees';
      EGenreRessource[(EGenreRessource['ResponsablePostulant'] = 100)] =
        'ResponsablePostulant';
      EGenreRessource[(EGenreRessource['ExecutionQCMEleve'] = 101)] =
        'ExecutionQCMEleve';
      EGenreRessource[(EGenreRessource['DocJointInscription'] = 102)] =
        'DocJointInscription';
      EGenreRessource[(EGenreRessource['CategorieDossier'] = 103)] =
        'CategorieDossier';
      EGenreRessource[(EGenreRessource['MEFGEP'] = 104)] = 'MEFGEP';
      EGenreRessource[(EGenreRessource['AutreOrientation'] = 105)] =
        'AutreOrientation';
      EGenreRessource[(EGenreRessource['Commission'] = 106)] = 'Commission';
      EGenreRessource[(EGenreRessource['ReponseEducative'] = 107)] =
        'ReponseEducative';
      EGenreRessource[(EGenreRessource['SuiviReponseEducative'] = 108)] =
        'SuiviReponseEducative';
      EGenreRessource[(EGenreRessource['NatureDocumentEleve'] = 109)] =
        'NatureDocumentEleve';
      EGenreRessource[
        (EGenreRessource['RelationCommissionFichierExterne'] = 110)
      ] = 'RelationCommissionFichierExterne';
      EGenreRessource[(EGenreRessource['Signataire'] = 111)] = 'Signataire';
      EGenreRessource[(EGenreRessource['DocumentSignature'] = 112)] =
        'DocumentSignature';
      EGenreRessource[(EGenreRessource['PersonnelHistorique'] = 113)] =
        'PersonnelHistorique';
      EGenreRessource[(EGenreRessource['EnseignantHistorique'] = 114)] =
        'EnseignantHistorique';
      EGenreRessource[(EGenreRessource['DemandeDispense'] = 115)] =
        'DemandeDispense';
      EGenreRessource[(EGenreRessource['DocJointPriseDeRDV'] = 116)] =
        'DocJointPriseDeRDV';
      EGenreRessource[(EGenreRessource['Mediatheque'] = 117)] = 'Mediatheque';
      EGenreRessource[(EGenreRessource['DossierMediatheque'] = 118)] =
        'DossierMediatheque';
    })(EGenreRessource || (exports.EGenreRessource = EGenreRessource = {}));
    const ObjetTraduction_1 = require('ObjetTraduction');
    const UtilitaireUrl_1 = require('UtilitaireUrl');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const TypeGenreObservationVS_1 = require('TypeGenreObservationVS');
    const TypeGenrePunition_1 = require('TypeGenrePunition');
    const EGenreRessourceUtil = {
      correspondAuGenreUtilisateurEspaceCourant(aGenre) {
        switch (GApplication.getEtatUtilisateur().GenreEspace) {
          case Enumere_Espace_1.EGenreEspace.Academie:
            return aGenre === EGenreRessource.InspecteurPedagogique;
          case Enumere_Espace_1.EGenreEspace.Eleve:
          case Enumere_Espace_1.EGenreEspace.Mobile_Eleve:
          case Enumere_Espace_1.EGenreEspace.PrimEleve:
          case Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve:
            return aGenre === EGenreRessource.Eleve;
          case Enumere_Espace_1.EGenreEspace.Entreprise:
            return aGenre === EGenreRessource.MaitreDeStage;
          case Enumere_Espace_1.EGenreEspace.Etablissement:
            return aGenre === EGenreRessource.Personnel;
          case Enumere_Espace_1.EGenreEspace.Parent:
          case Enumere_Espace_1.EGenreEspace.Mobile_Parent:
          case Enumere_Espace_1.EGenreEspace.PrimParent:
          case Enumere_Espace_1.EGenreEspace.Mobile_PrimParent:
            return aGenre === EGenreRessource.Responsable;
          case Enumere_Espace_1.EGenreEspace.Tuteur:
          case Enumere_Espace_1.EGenreEspace.Mobile_Tuteur:
          case Enumere_Espace_1.EGenreEspace.Accompagnant:
          case Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant:
          case Enumere_Espace_1.EGenreEspace.PrimAccompagnant:
          case Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant:
          case Enumere_Espace_1.EGenreEspace.PrimPeriscolaire:
          case Enumere_Espace_1.EGenreEspace.Mobile_PrimPeriscolaire:
          case Enumere_Espace_1.EGenreEspace.PrimMairie:
          case Enumere_Espace_1.EGenreEspace.Mobile_PrimMairie:
            return aGenre === EGenreRessource.Personnel;
          case Enumere_Espace_1.EGenreEspace.Professeur:
          case Enumere_Espace_1.EGenreEspace.Mobile_Professeur:
          case Enumere_Espace_1.EGenreEspace.PrimProfesseur:
          case Enumere_Espace_1.EGenreEspace.Mobile_PrimProfesseur:
            return aGenre === EGenreRessource.Enseignant;
          case Enumere_Espace_1.EGenreEspace.PrimDirection:
          case Enumere_Espace_1.EGenreEspace.Mobile_PrimDirection:
          case Enumere_Espace_1.EGenreEspace.Administrateur:
          case Enumere_Espace_1.EGenreEspace.Mobile_Administrateur:
            return aGenre === EGenreRessource.Personnel;
          default:
            return false;
        }
      },
      getGenrePereCompetence(aGenre, aGenrePourEvaluation) {
        switch (aGenre) {
          case EGenreRessource.ElementPilier:
            return null;
          case EGenreRessource.Competence:
            return EGenreRessource.ElementPilier;
          case EGenreRessource.SousItem:
            return EGenreRessource.Competence;
          case EGenreRessource.Evaluation:
            return aGenrePourEvaluation;
        }
      },
      getNomImageAbsence(aGenreRessource, aObjet = {}) {
        switch (aGenreRessource) {
          case EGenreRessource.ObservationProfesseurEleve:
            switch (aObjet.genreObservation) {
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_DefautCarnet:
                return 'Color_RecapVS_Lue icon_Defaut_de_carnet';
              case TypeGenreObservationVS_1.TypeGenreObservationVS.OVS_Autres:
                if (aObjet.estLue === false) {
                  return 'Color_RecapVS_NonLue icon_asterisk';
                }
                return 'Color_RecapVS_Lue icon_asterisk';
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_ObservationParent:
                if (aObjet.estLue === false) {
                  return 'Color_RecapVS_NonLue icon_observation';
                }
                return 'Color_RecapVS_Lue icon_observation';
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_Encouragement:
                if (aObjet.estLue === false) {
                  return 'Color_RecapVS_NonLue icon_smile';
                }
                return 'Color_RecapVS_Lue icon_smile';
              default:
                return '';
            }
          case EGenreRessource.Absence:
            if (
              aObjet.estUneCreationParent === true ||
              (aObjet.confirmee === true && aObjet.justifie === true)
            ) {
              if (aObjet.refusee === true) {
                return 'Color_RecapVS_NonLue iconVSDetail icon_exclamation';
              } else if (aObjet.justifie === true) {
                return 'Color_RecapVS_Lue iconVSDetail icon_absences';
              } else {
                return 'Color_RecapVS_Lue iconVSDetail icon_absences_prevue';
              }
            } else if (aObjet.justifie === false) {
              return 'Color_RecapVS_NonLue icon_absences';
            }
            return 'Color_RecapVS_Lue icon_absences';
          case EGenreRessource.AbsenceRepas:
            return 'Color_RecapVS_Lue icon_food';
          case EGenreRessource.AbsenceInternat:
            return 'Color_RecapVS_Lue icon_internat';
          case EGenreRessource.Retard:
            if (aObjet.justifie === false) {
              return 'Color_RecapVS_NonLue icon_retard';
            }
            return 'Color_RecapVS_Lue icon_retard';
          case EGenreRessource.Infirmerie:
            return 'Color_RecapVS_Lue icon_f0fe';
          case EGenreRessource.Incident:
            return 'Color_RecapVS_Lue icon_bolt';
          case EGenreRessource.Exclusion:
            return 'Color_RecapVS_Lue icon_punition_exclusion';
          case EGenreRessource.Punition:
            if (aObjet.estProgrammation) {
              return 'Color_RecapVS_Lue icon_recap_vs_programmation';
            }
            switch (aObjet.genreNature) {
              case TypeGenrePunition_1.TypeGenrePunition.GP_ExclusionCours:
                return 'Color_RecapVS_Lue icon_punition_exclusion';
              case TypeGenrePunition_1.TypeGenrePunition.GP_Retenues:
              case TypeGenrePunition_1.TypeGenrePunition.GP_Devoir:
              case TypeGenrePunition_1.TypeGenrePunition.GP_Autre:
                return 'Color_RecapVS_Lue icon_punition';
              default:
                return 'Color_RecapVS_Lue icon_punition';
            }
          case EGenreRessource.Sanction:
            if (aObjet.avecSursis === true) {
              return 'Color_RecapVS_Lue icon_legal';
            }
            return 'Color_RecapVS_Lue icon_legal';
          case EGenreRessource.MesureConservatoire:
            return 'Color_RecapVS_Lue icon_mesure_conservatoire';
          case EGenreRessource.Commission:
            return 'Color_RecapVS_Lue icon_mode_conseil_classe';
          case EGenreRessource.Dispense:
            return 'Color_RecapVS_Lue icon_dispense';
        }
        return '';
      },
      getIconAbsence(aGenreRessource, aObjet) {
        switch (aGenreRessource) {
          case EGenreRessource.Observation:
          case EGenreRessource.ObservationProfesseurEleve:
            switch (aObjet.genreObservation) {
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_DefautCarnet:
                return 'icon_Defaut_de_carnet';
              case TypeGenreObservationVS_1.TypeGenreObservationVS.OVS_Autres:
                return 'icon_asterisk';
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_ObservationParent:
                return 'icon_observation';
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_Encouragement:
                return 'icon_smile';
              default:
                return '';
            }
          case EGenreRessource.Absence:
            return 'icon_absences';
          case EGenreRessource.AbsenceRepas:
          case EGenreRessource.RepasAPreparer:
            return 'icon_food';
          case EGenreRessource.AbsenceInternat:
            return 'icon_internat';
          case EGenreRessource.Retard:
            return 'icon_retard';
          case EGenreRessource.Infirmerie:
            return 'icon_medkit';
          case EGenreRessource.Dispense:
            return 'icon_dispense';
          case EGenreRessource.Incident:
            return 'icon_bolt';
          case EGenreRessource.Exclusion:
            return 'icon_punition_exclusion';
          case EGenreRessource.Punition:
            switch (aObjet.genreNature) {
              case TypeGenrePunition_1.TypeGenrePunition.GP_ExclusionCours:
                return 'icon_punition_exclusion';
              case TypeGenrePunition_1.TypeGenrePunition.GP_Retenues:
              case TypeGenrePunition_1.TypeGenrePunition.GP_Devoir:
              case TypeGenrePunition_1.TypeGenrePunition.GP_Autre:
                return 'icon_punition';
              default:
                return 'icon_punition';
            }
          case EGenreRessource.Sanction:
            return 'icon_legal';
          case EGenreRessource.MesureConservatoire:
            return 'icon_mesure_conservatoire';
        }
        return '';
      },
      getPositionAbsence(aGenreRessource, aObjet = { genreObservation: null }) {
        let lResult = 0;
        switch (aGenreRessource) {
          case EGenreRessource.ObservationProfesseurEleve:
            switch (aObjet.genreObservation) {
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_ObservationParent:
                lResult = 0;
                break;
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_Encouragement:
                lResult = 1;
                break;
              case TypeGenreObservationVS_1.TypeGenreObservationVS
                .OVS_DefautCarnet:
                lResult = 2;
                break;
              case TypeGenreObservationVS_1.TypeGenreObservationVS.OVS_Autres:
                lResult = 60;
                break;
              default:
                lResult = 60;
                break;
            }
            break;
          case EGenreRessource.Absence:
            lResult = 10;
            break;
          case EGenreRessource.AbsenceRepas:
            lResult = 12;
            break;
          case EGenreRessource.AbsenceInternat:
            lResult = 13;
            break;
          case EGenreRessource.Retard:
            lResult = 21;
            break;
          case EGenreRessource.Dispense:
            lResult = 22;
            break;
          case EGenreRessource.Infirmerie:
            lResult = 20;
            break;
          case EGenreRessource.Incident:
            lResult = 25;
            break;
          case EGenreRessource.Exclusion:
            lResult = 30;
            break;
          case EGenreRessource.Punition:
            lResult = 30;
            break;
          case EGenreRessource.MesureConservatoire:
            lResult = 40;
            break;
          case EGenreRessource.Sanction:
            lResult = 50;
            break;
          case EGenreRessource.Commission:
            lResult = 55;
            break;
          default:
            lResult = 9999;
            break;
        }
        return lResult;
      },
      getTitreFenetreSelectionRessource(aGenre) {
        switch (aGenre) {
          case EGenreRessource.Eleve:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherEleves',
            );
          case EGenreRessource.Enseignant:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherProfesseurs',
            );
          case EGenreRessource.Responsable:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherResponsables',
            );
          case EGenreRessource.Personnel:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherPersonnel',
            );
          case EGenreRessource.MaitreDeStage:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherMaitresDeStage',
            );
          case EGenreRessource.InspecteurPedagogique:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherInspecteurs',
            );
          case EGenreRessource.Periode:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherPeriodes',
            );
          case EGenreRessource.Classe:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionRessource.CocherClasses',
            );
        }
        return '';
      },
    };
    exports.EGenreRessourceUtil = EGenreRessourceUtil;
    UtilitaireUrl_1.UtilitaireUrl.genreRessourceDefault =
      EGenreRessource.DocumentJoint;
  },
  fn: 'enumere_ressource.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreEvenementListe = void 0;
    var EGenreEvenementListe;
    (function (EGenreEvenementListe) {
      EGenreEvenementListe[(EGenreEvenementListe['Selection'] = 0)] =
        'Selection';
      EGenreEvenementListe[(EGenreEvenementListe['Creation'] = 1)] = 'Creation';
      EGenreEvenementListe[(EGenreEvenementListe['Edition'] = 2)] = 'Edition';
      EGenreEvenementListe[(EGenreEvenementListe['Suppression'] = 3)] =
        'Suppression';
      EGenreEvenementListe[(EGenreEvenementListe['Deploiement'] = 4)] =
        'Deploiement';
      EGenreEvenementListe[(EGenreEvenementListe['ApresCreation'] = 5)] =
        'ApresCreation';
      EGenreEvenementListe[(EGenreEvenementListe['ApresEdition'] = 6)] =
        'ApresEdition';
      EGenreEvenementListe[(EGenreEvenementListe['ApresSuppression'] = 7)] =
        'ApresSuppression';
      EGenreEvenementListe[(EGenreEvenementListe['SelectionClick'] = 8)] =
        'SelectionClick';
      EGenreEvenementListe[(EGenreEvenementListe['ApresErreurCreation'] = 9)] =
        'ApresErreurCreation';
      EGenreEvenementListe[(EGenreEvenementListe['SelectionDblClick'] = 10)] =
        'SelectionDblClick';
      EGenreEvenementListe[(EGenreEvenementListe['KeyPressListe'] = 11)] =
        'KeyPressListe';
      EGenreEvenementListe[(EGenreEvenementListe['KeyUpListe'] = 12)] =
        'KeyUpListe';
      EGenreEvenementListe[(EGenreEvenementListe['SelectionClickTotal'] = 13)] =
        'SelectionClickTotal';
      EGenreEvenementListe[(EGenreEvenementListe['ModificationCBLigne'] = 14)] =
        'ModificationCBLigne';
      EGenreEvenementListe[
        (EGenreEvenementListe['ModificationSelection'] = 15)
      ] = 'ModificationSelection';
    })(
      EGenreEvenementListe ||
        (exports.EGenreEvenementListe = EGenreEvenementListe = {}),
    );
  },
  fn: 'enumere_evenementliste.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreEvenementAgenda = void 0;
    var TypeGenreEvenementAgenda;
    (function (TypeGenreEvenementAgenda) {
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_Standard'] = 0)
      ] = 'tgea_Standard';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_StandardPeriodique'] = 1)
      ] = 'tgea_StandardPeriodique';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_ConseilDeClasse'] = 2)
      ] = 'tgea_ConseilDeClasse';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_ConseilDeClasseResponsableDelegue'] = 3)
      ] = 'tgea_ConseilDeClasseResponsableDelegue';
      TypeGenreEvenementAgenda[(TypeGenreEvenementAgenda['tgea_Cours'] = 4)] =
        'tgea_Cours';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_PunitionSurveillee'] = 5)
      ] = 'tgea_PunitionSurveillee';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_VisiteEntreprise'] = 6)
      ] = 'tgea_VisiteEntreprise';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_RencontreParentsProfs'] = 7)
      ] = 'tgea_RencontreParentsProfs';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_SortiePedagogique'] = 8)
      ] = 'tgea_SortiePedagogique';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_SessionDeStage'] = 9)
      ] = 'tgea_SessionDeStage';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_AbsencesRessource'] = 10)
      ] = 'tgea_AbsencesRessource';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_ConvocationVieScolaire'] = 11)
      ] = 'tgea_ConvocationVieScolaire';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_Commission'] = 12)
      ] = 'tgea_Commission';
      TypeGenreEvenementAgenda[
        (TypeGenreEvenementAgenda['tgea_RendezVous'] = 13)
      ] = 'tgea_RendezVous';
    })(
      TypeGenreEvenementAgenda ||
        (exports.TypeGenreEvenementAgenda = TypeGenreEvenementAgenda = {}),
    );
  },
  fn: 'typegenreevenementagenda.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { ObjetFenetre } = require('ObjetFenetre.js');
    const { GDate } = require('ObjetDate.js');
    const { GChaine } = require('ObjetChaine.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { EGenreEvenementListe } = require('Enumere_EvenementListe.js');
    const { UtilitaireVisios } = require('UtilitaireVisiosSco.js');
    const { tag } = require('tag.js');
    const { TypeGenreEvenementAgenda } = require('TypeGenreEvenementAgenda.js');
    const { UtilitaireUrl } = require('UtilitaireUrl.js');
    require('ObjetFenetre_DetailAgenda.css');
    class ObjetFenetre_DetailAgenda extends ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.option = {
          estFenetreAgenda: false,
          estEspaceProf: false,
          droitSaisie: false,
        };
        this.setOptionsFenetre({
          avecComposeBasInFooter: true,
          positionSurSouris: !this.option.estFenetreAgenda,
          titre: function () {
            return this.donnees
              ? `<span class="titreDetailAgenda" style="border-left-color:${this.donnees.CouleurCellule ? this.donnees.CouleurCellule : ''} ">${this.donnees.getLibelle()}</span>`
              : '';
          }.bind(this),
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getDate: function () {
            let lStrDates = '';
            const lEstPasEventPerso = !(
              aInstance.donnees &&
              aInstance.donnees.periodicite &&
              aInstance.donnees.periodicite.estEvtPerso
            );
            if (
              !!aInstance.donnees &&
              lEstPasEventPerso &&
              aInstance.donnees.DateDebut &&
              aInstance.donnees.DateFin
            ) {
              lStrDates = GDate.strDates(
                aInstance.donnees.DateDebut,
                aInstance.donnees.DateFin,
                { sansHoraire: aInstance.donnees.sansHoraire },
              );
            }
            return lStrDates;
          },
          Publie: {
            estPublie: function () {
              let lEstPartage = false;
              if (
                !!aInstance.donnees &&
                aInstance.donnees.publie &&
                aInstance.option.estEspaceProf
              ) {
                lEstPartage = true;
              }
              return lEstPartage;
            },
            getStr: function () {
              let lStrPartage = '';
              if (!!aInstance.donnees) {
                if (aInstance.donnees.publie) {
                  lStrPartage = GTraductions.getValeur(
                    'Agenda.EvenementPartage',
                  );
                }
              }
              return lStrPartage;
            },
          },
          Periodique: {
            estPeriodique: function () {
              let lEstPeriodicite = false;
              if (!!aInstance.donnees && aInstance.donnees.estPeriodique) {
                lEstPeriodicite = true;
              }
              return lEstPeriodicite;
            },
            getStr: function () {
              let lStr = '';
              if (
                !!aInstance.donnees.periodicite &&
                aInstance.donnees.estPeriodique
              ) {
                if (aInstance.donnees.periodicite.estEvtPerso) {
                  let lChaine =
                    (aInstance.donnees.DateDebut &&
                      aInstance.donnees.DateFin &&
                      GDate.strDates(
                        aInstance.donnees.DateDebut,
                        aInstance.donnees.DateFin,
                        { sansHoraire: aInstance.donnees.sansHoraire },
                      ).trim()) ||
                    '';
                  lStr = `${lChaine} - ${tag('i', { class: 'icons icon icon_refresh', 'ie-hint': `<div>${GTraductions.getValeur('Agenda.EvenementModifie')}</div>` })} ${GTraductions.getValeur('Agenda.EvenementModifie')}`;
                } else {
                  lStr = aInstance.donnees.periodicite.libelleDescription;
                }
              }
              return lStr;
            },
            getClass() {
              const lClass = [];
              lClass.push('ie-sous-titre');
              if (
                aInstance.donnees.periodicite &&
                !aInstance.donnees.periodicite.estEvtPerso
              ) {
                lClass.push('icons', 'iconic', 'icon_refresh');
              }
              return lClass.join(' ');
            },
          },
          Auteur: {
            avecAuteur: function () {
              let lAuteur = false;
              if (!!aInstance.donnees && !!aInstance.donnees.strAuteur) {
                lAuteur = true;
              }
              return lAuteur;
            },
            getStrAuteur: function () {
              let lStrAuteur = '';
              if (!!aInstance.donnees && !!aInstance.donnees.strAuteur) {
                lStrAuteur = aInstance.donnees.strAuteur;
              }
              return lStrAuteur;
            },
          },
          getCommentaire: function () {
            let lCommentaire =
              !!aInstance.donnees &&
              !!aInstance.donnees.Commentaire &&
              aInstance.donnees.Commentaire.length > 0
                ? aInstance.donnees.Commentaire
                : '';
            if (GChaine.contientAuMoinsUneURL(lCommentaire)) {
              lCommentaire = GChaine.ajouterLiensURL(lCommentaire);
            }
            return GChaine.replaceRCToHTML(lCommentaire);
          },
          estEditable: function () {
            if (
              IE.estMobile &&
              aInstance.option.droitSaisie &&
              !!aInstance.donnees &&
              !!aInstance.donnees.proprietaire
            ) {
              return true;
            } else {
              return false;
            }
          },
          estDuplicable: function () {
            if (
              IE.estMobile &&
              aInstance.option.droitSaisie &&
              !!aInstance.donnees &&
              !!aInstance.donnees.proprietaire &&
              !aInstance.donnees.estPeriodique
            ) {
              return true;
            } else {
              return false;
            }
          },
          btnDupliquer: {
            event() {
              if (!!aInstance.evenementDupliquer && aInstance.donnees) {
                aInstance.evenementDupliquer(aInstance.donnees);
                aInstance.fermer();
              }
            },
          },
          btnSupprimer: {
            event() {
              if (!!aInstance.evenementAgenda && aInstance.donnees) {
                const lParam = {
                  article: aInstance.donnees,
                  genreEvenement: EGenreEvenementListe.Suppression,
                };
                aInstance.evenementAgenda(lParam);
                aInstance.fermer();
              }
            },
          },
          ConseilClasse: {
            avecConseilClasse: function () {
              if (!!aInstance.donnees && aInstance.donnees.estConseilClasse) {
                return aInstance.donnees.estConseilClasse;
              } else {
                return false;
              }
            },
            sansConseilClasse: function () {
              if (!!aInstance.donnees && !aInstance.donnees.estConseilClasse) {
                return !aInstance.donnees.estConseilClasse;
              } else {
                return false;
              }
            },
            composeConseilClasse: function () {
              return _composeConseilClasse.call(this, aInstance.donnees);
            },
          },
          avecPublicationPageEtablissement: function () {
            if (
              aInstance.avecPublicationPageEtablissement &&
              !!aInstance.donnees &&
              aInstance.donnees.publicationPageEtablissement &&
              aInstance.donnees.publie &&
              aInstance.option.estEspaceProf &&
              (aInstance.donnees.getGenre() ===
                TypeGenreEvenementAgenda.tgea_Standard ||
                aInstance.donnees.getGenre() ===
                  TypeGenreEvenementAgenda.tgea_StandardPeriodique)
            ) {
              return true;
            }
            return false;
          },
          PublicationEtablisement: function () {
            return GTraductions.getValeur(
              'Fenetre_SaisieAgenda.partageSurPageEtablissement',
            );
          },
        });
      }
      setOptions(aOptions) {
        Object.assign(this.option, aOptions);
      }
      setDonnees(aDonnees) {
        this.donnees = aDonnees.detail;
        this.afficher(this.composeContenu());
        if (!!aDonnees.avecPublicationPageEtablissement) {
          this.avecPublicationPageEtablissement =
            aDonnees.avecPublicationPageEtablissement;
        }
        if (!!aDonnees.evenementAgenda) {
          this.evenementAgenda = aDonnees.evenementAgenda;
        }
        if (!!aDonnees.evenementDupliquer) {
          this.evenementDupliquer = aDonnees.evenementDupliquer;
        }
      }
      composeContenu() {
        const H = [];
        H.push('<section class="FenetreDetailAgenda">');
        H.push(
          '<section>',
          '<div ie-html="getDate" class="capitalize ie-sous-titre"></div>',
          '<div ie-html="Publie.getStr" ie-if="Publie.estPublie" class="ie-sous-titre icons iconic icon_fiche_cours_partage"></div>',
          `<div ie-if="avecPublicationPageEtablissement" ie-html="PublicationEtablisement" class="ie-sous-titre icons iconic icon_ecole"></div>`,
          `<div ie-html="Periodique.getStr" title="${GTraductions.getValeur('Agenda.AgendaHintEvtPEriodique')}" ie-if="Periodique.estPeriodique" ie-class="Periodique.getClass"></div>`,
          '<div ie-html="Auteur.getStrAuteur" ie-if="Auteur.avecAuteur" class="ie-sous-titre"></div>',
          '</section>',
          '<div ie-html="getCommentaire" ie-if="ConseilClasse.sansConseilClasse" class="m-top-xl commentaire"></div>',
          '<div ie-html="ConseilClasse.composeConseilClasse" ie-if="ConseilClasse.avecConseilClasse" class="m-top-xl commentaire"></div>',
        );
        if (
          this.donnees &&
          ((!!this.donnees.listeDocJoints &&
            this.donnees.listeDocJoints.count()) ||
            (!!this.donnees.listeFichiers &&
              this.donnees.listeFichiers.count()))
        ) {
          H.push('<section class="ctnListeDocJoints">');
          this.donnees.listeDocJoints.parcourir((aDocumentJoint) => {
            H.push(
              GChaine.composerUrlLienExterne({
                documentJoint: aDocumentJoint,
                genreRessource: EGenreRessource.DocJointEtablissement,
              }),
            );
          });
          if (this.donnees.listeFichiers) {
            H.push(
              UtilitaireUrl.construireListeUrls(this.donnees.listeFichiers),
            );
          }
          H.push(' </section>');
        }
        H.push('</section>');
        return H.join('');
      }
      surValidation(aIndice) {
        if (
          !!this.donnees &&
          !!this.donnees.proprietaire &&
          IE.estMobile &&
          this.option.droitSaisie &&
          aIndice === 0
        ) {
          this.callback.appel({ element: this.donnees });
        }
        this.fermer();
      }
      composeBas() {
        const H = [];
        H.push(
          `\n        <section class="compose-bas">\n            <ie-btnicon title="${GTraductions.getValeur('Dupliquer')}" class="icon_dupliquer avecFond i-medium" ie-model="btnDupliquer" ie-if="estDuplicable"></ie-btnicon>\n            <ie-btnicon title="${GTraductions.getValeur('Supprimer')}" class="icon_trash avecFond i-medium" ie-model="btnSupprimer" ie-if="estEditable"></ie-btnicon>\n        </section>\n    `,
        );
        return H.join('');
      }
    }
    function _composeConseilClasse(aEvenement) {
      const H = [];
      const lPresidentCC = !!aEvenement.presidentCC
        ? GTraductions.getValeur('Agenda.President') +
          ' : ' +
          aEvenement.presidentCC
        : '';
      let lProfPrincipaux = '';
      if (
        !!aEvenement.listeProfsPrincipaux &&
        aEvenement.listeProfsPrincipaux.count() > 0
      ) {
        lProfPrincipaux =
          aEvenement.listeProfsPrincipaux.count() > 1
            ? GTraductions.getValeur('Agenda.ProfesseursPrincipaux')
            : GTraductions.getValeur('Agenda.ProfesseurPrincipal');
        lProfPrincipaux +=
          ' : ' +
          aEvenement.listeProfsPrincipaux.getTableauLibelles().join(', ');
      }
      let lParentDelegues = '';
      if (
        !!aEvenement.listeDeleguesParents &&
        aEvenement.listeDeleguesParents.count() > 0
      ) {
        lParentDelegues =
          GTraductions.getValeur('Agenda.ParentsDelegues') + ' : ';
        lParentDelegues += aEvenement.listeDeleguesParents
          .getTableauLibelles()
          .join(', ');
      }
      let lElevesDelegues = '';
      if (
        !!aEvenement.listeDeleguesEleves &&
        aEvenement.listeDeleguesEleves.count() > 0
      ) {
        lElevesDelegues =
          GTraductions.getValeur('Agenda.ElevesDelegues') + ' : ';
        lElevesDelegues += aEvenement.listeDeleguesEleves
          .getTableauLibelles()
          .join(', ');
      }
      H.push(
        '<div class="Espace">',
        '<ul class="list-as-menu">',
        lPresidentCC ? '<li> ' + lPresidentCC + '</li>' : '',
        lProfPrincipaux ? '<li> ' + lProfPrincipaux + '</li>' : '',
        lParentDelegues ? '<li> ' + lParentDelegues + '</li>' : '',
        lElevesDelegues ? '<li> ' + lElevesDelegues + '</li>' : '',
        '</ul>',
        '</div>',
      );
      if (aEvenement.visio && aEvenement.visio.url) {
        H.push(
          tag(
            'div',
            { class: 'agenda-cc-visio' },
            tag(
              'ie-chips',
              {
                class: ['iconic', UtilitaireVisios.getNomIconePresenceVisios()],
                href: GChaine.verifierURLHttp(aEvenement.visio.url),
              },
              aEvenement.visio.libelleLien ||
                GTraductions.getValeur(
                  'FenetreSaisieVisiosCours.AccederAuCoursVirtuel',
                ),
            ),
            aEvenement.visio.commentaire
              ? tag(
                  'label',
                  GChaine.replaceRCToHTML(aEvenement.visio.commentaire),
                )
              : '',
          ),
        );
      }
      return H.join('');
    }
    module.exports = { ObjetFenetre_DetailAgenda };
  },
  fn: 'objetfenetre_detailagenda.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.WidgetAgenda = void 0;
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetWAI_1 = require('ObjetWAI');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetDate_1 = require('ObjetDate');
    const UtilitaireVisiosSco_1 = require('UtilitaireVisiosSco');
    const tag_1 = require('tag');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetFenetre_DetailAgenda_1 = require('ObjetFenetre_DetailAgenda');
    const ObjetWidget_1 = require('ObjetWidget');
    class WidgetAgenda extends ObjetWidget_1.Widget.ObjetWidget {
      construire(aParams) {
        this.idEvent = 'idEventWidget_';
        this.donnees = aParams.donnees;
        const lWidget = {
          html: this._composeWidgetAgenda(),
          nbrElements: this.donnees.listeEvenements.count(),
          afficherMessage: this.donnees.listeEvenements.count() === 0,
          fermerFiches: () => {
            this.fenetreDetailAgenda.fermer();
          },
        };
        $.extend(this.donnees, lWidget);
        aParams.construireWidget(aParams.donnees);
        this._creerObjetAgenda();
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(this), {
          getNode(aIndice) {
            $(this.node).eventValidation(() => {
              if (aInstance.fenetreDetailAgenda.estAffiche()) {
                aInstance.fenetreDetailAgenda.fermer();
              }
              aInstance.fenetreDetailAgenda.setDonnees({
                detail: aInstance.donnees.listeEvenements.get(aIndice),
                id: aInstance.idEvent + aIndice,
              });
            });
          },
          getNodeVisio(aIndice, aAvecOuvertureFenetre) {
            $(this.node).on('click', (aEvent) => {
              const lElement = aInstance.donnees.listeEvenements.get(aIndice);
              if (lElement && lElement.visio) {
                aEvent.stopPropagation();
                if (aAvecOuvertureFenetre) {
                  const lOptions = {
                    titre: ObjetTraduction_1.GTraductions.getValeur(
                      'FenetreSaisieVisiosCours.URLAssocieeAuConseil',
                    ),
                  };
                  UtilitaireVisiosSco_1.UtilitaireVisios.ouvrirFenetreConsultVisio(
                    lElement.visio,
                    lOptions,
                  );
                }
              }
            });
          },
        });
      }
      _composeEvenement(aEvenement, i) {
        var _a;
        const composeCercleEleve = (aEleve) =>
          '<span class="circle" aria-label="' +
          aEleve +
          '" ie-hint="' +
          aEleve +
          '">' +
          aEleve.substring(0, 1) +
          '</span>';
        const H = [];
        H.push('<li>');
        H.push(
          '<a class="wrapper-link" tabindex="0" id="',
          this.idEvent + i,
          '" ',
          ObjetWAI_1.GObjetWAI.composeAttribut({
            genre: ObjetWAI_1.EGenreAttribut.label,
            valeur:
              aEvenement.getLibelle() +
              ' ' +
              this.donnees.listeEvenements
                ._getLibelleEvenement({ evenement: aEvenement })
                .join(', ') +
              ((
                (_a = aEvenement.listeEleves) === null || _a === void 0
                  ? void 0
                  : _a.length
              )
                ? ', ' + aEvenement.listeEleves.join(', ')
                : '') +
              (aEvenement.eleveConvoque
                ? ', ' + aEvenement.eleveConvoque.prenom
                : ''),
          }),
          ObjetHtml_1.GHtml.composeAttr('ie-node', 'getNode', i),
          '>',
        );
        H.push('<div class="wrap">');
        H.push(
          '<div class="bloc-date-conteneur" aria-hidden="true">',
          ObjetDate_1.GDate.formatDate(
            aEvenement.DateDebut,
            '<div>%JJ</div><div>%MMM</div>',
          ),
          '</div>',
        );
        H.push('<div class="infos-agenda-conteneur">');
        H.push(
          '<h3 title="',
          ObjetTraduction_1.GTraductions.getValeur('accueil.agenda.hintLien'),
          '">',
          aEvenement.getLibelle(),
          '</h3>',
        );
        H.push(
          '<span>' +
            this.donnees.listeEvenements._getDateEvenement({
              evenement: aEvenement,
            }) +
            '</span>',
        );
        H.push('</div>');
        H.push('</div>');
        if (aEvenement.listeEleves && aEvenement.listeEleves.length > 0) {
          H.push('<div class="liste-enfants">');
          aEvenement.listeEleves.forEach((aEleve) =>
            H.push(composeCercleEleve(aEleve)),
          );
          H.push('</div>');
        }
        if (aEvenement.eleveConvoque && aEvenement.eleveConvoque.prenom) {
          H.push(composeCercleEleve(aEvenement.eleveConvoque.prenom));
        }
        if (aEvenement.visio && aEvenement.visio.url) {
          if (IE.estMobile) {
            H.push(
              (0, tag_1.tag)('i', {
                class: [
                  'btn-lien-visio',
                  UtilitaireVisiosSco_1.UtilitaireVisios.getNomIconePresenceVisios(),
                ],
                'ie-node': tag_1.tag.funcAttr('getNodeVisio', [i, true]),
              }),
            );
          } else {
            H.push(
              (0, tag_1.tag)('a', {
                class: [
                  UtilitaireVisiosSco_1.UtilitaireVisios.getNomIconePresenceVisios(),
                ],
                href: ObjetChaine_1.GChaine.verifierURLHttp(
                  aEvenement.visio.url,
                ),
                target: '_blank',
                'ie-hint':
                  UtilitaireVisiosSco_1.UtilitaireVisios.getHintVisio(
                    aEvenement.visio,
                  ) || false,
                'ie-node': tag_1.tag.funcAttr('getNodeVisio', [i, false]),
              }),
            );
          }
        }
        H.push('</a>');
        H.push('</li>');
        return H.join('');
      }
      _creerObjetAgenda() {
        this.fenetreDetailAgenda =
          ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
            ObjetFenetre_DetailAgenda_1.ObjetFenetre_DetailAgenda,
            {
              pere: this,
              initialiser(aInstance) {
                aInstance.setOptionsFenetre({
                  avecComposeBasInFooter: false,
                  avecTailleSelonContenu: true,
                });
              },
            },
          );
        this.fenetreDetailAgenda.destructionSurFermeture = false;
        this.fenetreDetailAgenda.initialiser();
      }
      _composeWidgetAgenda() {
        const H = [];
        if (this.donnees.listeEvenements.count() > 0) {
          H.push('<ul class="liste-clickable">');
          for (let I = 0; I < this.donnees.listeEvenements.count(); I++) {
            H.push(
              this._composeEvenement(this.donnees.listeEvenements.get(I), I),
            );
          }
          H.push('</ul>');
        }
        return H.join('');
      }
    }
    exports.WidgetAgenda = WidgetAgenda;
  },
  fn: 'widgetagenda.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetDroitsPN = exports.TypeDroits = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetDate_1 = require('ObjetDate');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const TypeDomaine_1 = require('TypeDomaine');
    exports.TypeDroits = {
      estEnConsultation: 1,
      cours: {
        domaineConsultationEDT: 1,
        avecReservationCreneauxLibres: 1,
        modifierElevesDetachesSurCoursDeplaceCreneauLibre: 1,
        modifierMatieres: 1,
        modifierMatieresCoursEPIEtAP: 1,
        modifierClasses: 1,
        modifierProfesseurs: 1,
        modifierSalles: 1,
        modifierMateriels: 1,
        creerCours: 1,
        creerCoursPermanenceFeuilleAppel: 1,
        deplacerCours: 1,
        estSemaineModifiable: 1,
        estGestionnaireSalle: 1,
        estGestionnaireMateriel: 1,
        avecMateriel: 1,
        avecFicheCoursConseil: 1,
        masquerPartiesDeClasse: 1,
        afficherElevesDetachesDansCours: 1,
      },
      eleves: {
        voirTousLesEleves: 1,
        consulterIdentiteEleve: 1,
        consulterFichesResponsables: 1,
        consulterPhotosEleves: 1,
        avecSaisieParcoursPedagogique: 1,
        avecAffectationElevesGroupesNonGAEV: 1,
        avecAffectationElevesGroupesGAEV: 1,
        avecSaisieProjetIndividuel: 1,
        avecSaisieAttestations: 1,
        consulterDonneesAdministrativesAutresEleves: 1,
      },
      communication: {
        toutesClasses: 1,
        avecDiscussion: 1,
        discussionDesactiveeSelonHoraire: 1,
        messageDiscussionDesactiveeSelonHoraire: 1,
        discussionInterdit: 1,
        avecDiscussionPersonnels: 1,
        avecDiscussionProfesseurs: 1,
        avecDiscussionParents: 1,
        avecDiscussionEleves: 1,
        avecMessageInstantane: 1,
        avecContactVS: 1,
        lancerAlertesPPMS: 1,
        estDestinataireChat: 1,
        avecDiscussionAvancee: 1,
        avecPublicationPageEtablissement: 0,
      },
      absences: {
        domaineRecapitulatifAbsences: 1,
        avecSaisieAppelEtVS: 1,
        avecSaisieAppel: 1,
        avecSaisieCours: 1,
        avecSaisieAbsenceOuverte: 1,
        avecSaisieHorsCours: 1,
        avecSaisieSurGrille: 1,
        avecSaisieSurGrilleAppelProf: 1,
        avecSaisieAbsence: 1,
        avecSaisieRetard: 1,
        avecSaisiePassageInfirmerie: 1,
        avecSaisieExclusion: 1,
        avecSaisiePunition: 1,
        avecSaisieObservation: 1,
        avecConsultationDefautCarnet: 1,
        avecSaisieDefautCarnet: 1,
        avecSaisieObservationsParents: 1,
        avecSaisieEncouragements: 1,
        avecAccesAuxEvenementsAutresCours: 1,
        avecSaisieAbsencesToutesPermanences: 1,
        listeDatesSaisieAbsence: 1,
        avecAnciennesFeuilleDAppel: 1,
        avecSaisieAbsencesGrilleAbsencesRepas: 1,
        avecSaisieAbsencesGrilleAbsencesInternat: 1,
        avecSuiviAbsenceRetard: 1,
        avecSaisieMotifRetard: 1,
        avecDeclarerUneAbsence: 1,
        avecDeclarerDispensePonctuelle: 1,
        avecDeclarerDispenseLongue: 1,
      },
      competence: {
        avecSaisieEvaluations: 1,
        avecSaisieItems: 1,
        avecValidationCompetences: 1,
      },
      agenda: { avecSaisieAgenda: 1 },
      actualite: { avecSaisieActualite: 1 },
      listeDiffusion: { avecPublication: 1 },
      casierNumerique: {
        avecAccesALaListeDesDocumentEleve: 1,
        avecSaisieDocumentsCasiersIntervenant: 1,
        avecSaisieDocumentsCasiersResponsable: 1,
      },
      dossierVS: {
        creerDossiersVS: 1,
        modifierDossiersVS: 1,
        saisieMotifsDossiersVS: 1,
        publierDossiersVS: 1,
        consulterMemosEleve: 1,
        saisirMemos: 1,
      },
      decrochageScolaire: { acces: 1, suivi: 1 },
      dispenses: { saisie: 1 },
      incidents: {
        acces: 1,
        uniquementMesIncidentsSignales: 1,
        saisie: 1,
        publier: 1,
      },
      punition: {
        avecPublicationPunitions: 1,
        acces: 1,
        saisie: 1,
        avecRecapPunitions: 1,
        avecRecapSanctions: 1,
      },
      creerMotifIncidentPunitionSanction: 1,
      stage: { autoriserEditionToutesOffresStages: 1 },
      cahierDeTexte: {
        avecSaisieCahierDeTexte: 1,
        creerCategoriesDeCahierDeTexte: 1,
        avecSaisiePieceJointe: 1,
        tailleMaxPieceJointe: 1,
      },
      notation: { avecSaisieDevoirs: 1 },
      compte: {
        avecSaisieIdentifiant: 1,
        avecSaisieMotDePasse: 1,
        avecSaisieMotDePasseEleve: 1,
        avecInformationsPersonnelles: 1,
        avecSaisieInfosPersoCoordonnees: 1,
        avecSaisieInfosPersoAutorisations: 1,
      },
      intendance: {
        avecDemandeTravauxIntendance: 1,
        uniquementMesTravauxIntendance: 1,
        avecExecutionTravauxIntendance: 1,
        avecGestionTravauxIntendance: 1,
        avecDemandeTachesSecretariat: 1,
        uniquementMesTachesSecretariat: 1,
        avecExecutionTachesSecretariat: 1,
        avecDemandeTachesInformatique: 1,
        uniquementMesTachesInformatique: 1,
        avecExecutionTachesInformatique: 1,
        avecGestionTachesInformatique: 1,
        avecDemandeCommandes: 1,
        uniquementMesCommandes: 1,
        avecExecutionCommandes: 1,
        avecGestionCommandes: 1,
      },
      services: { avecCreationSousServices: 1, avecModificationCoefGeneral: 1 },
      trombinoscope: { autoriseAConsulterPhotosDeTousLesEleves: 1 },
      forum: { avecCreationSujetForum: 1, avecModificationForumAPosteriori: 1 },
      autoriserImpressionBulletinReleveBrevet: 1,
      fonctionnalites: {
        gestionNotation: 1,
        gestionCompetences: 1,
        gestionBrevet: 1,
        gestionProgrammesBO: 1,
        gestionStages: 1,
        gestionIPR: 1,
        appelSaisirMotifJustifDAbsence: 1,
        gestionTwitter: 1,
        gestionBulletinClasse: 1,
        gestionNathan: 1,
        gestionPunitions: 1,
        gestionInfirmerie: 1,
        gestionPermanence: 1,
        gestionAbsencesDemiPension: 1,
        gestionAbsencesInternat: 1,
        gestionEtendueEleves: 1,
        gestionEleves: 1,
        gestionPersonnels: 1,
        forcerARInfos: 1,
        gestionSondageAnonyme: 1,
        gestionAbsenceDJParUtilisateur: 1,
        attestationEtendue: 1,
        afficherProjetsAccompagnement: 1,
        saisieEtendueAbsenceDepuisAppel: 1,
        importExportEducationNationale: 1,
        gestionCDT: 1,
        gestionPeriodeNotation: 1,
        gestionARBulletins: 1,
        avecTransformationFluxFichier: 1,
      },
      avecAccesRemplacementsProfs: 1,
      voirAbsencesEtRemplacementsProfs: 1,
      sePorterVolontaireRemplacement: 1,
      avecSaisieAppreciationsGenerales: 1,
      assistantSaisieAppreciations: 1,
      tailleMaxDocJointEtablissement: 1,
      tailleMaxRenduTafEleve: 1,
      tailleTravailAFaire: 1000,
      tailleCirconstance: 1000,
      tailleCommentaire: 1000,
      avecDroitDeconnexionMessagerie: 1,
      estDirecteur: 1,
      estEnseignant: 1,
      tailleMaxUpload: 1,
    };
    MethodesObjet_1.MethodesObjet.indenterEnumere(exports.TypeDroits);
    class ObjetDroitsPN {
      constructor() {
        this.init();
        this.initDroitsSession();
      }
      get(aGenreDroit, aNumeroSemine) {
        const lEstEnConsultation = GApplication.getModeExclusif();
        switch (aGenreDroit) {
          case exports.TypeDroits.estEnConsultation:
            return lEstEnConsultation;
          case exports.TypeDroits.tailleMaxUpload:
            return 50 * 1024 * 1024;
          case exports.TypeDroits.cours.domaineConsultationEDT:
            return this._droits.cours.domaineConsultationEDT;
          case exports.TypeDroits.cours.avecReservationCreneauxLibres:
            return (
              this._droits.cours.avecReservationCreneauxLibres &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.cours
            .modifierElevesDetachesSurCoursDeplaceCreneauLibre:
            return (
              this._droits.cours
                .modifierElevesDetachesSurCoursDeplaceCreneauLibre &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.cours.modifierMatieres:
            return this._droits.cours.modifierMatieres && !lEstEnConsultation;
          case exports.TypeDroits.cours.modifierMatieresCoursEPIEtAP:
            return (
              this._droits.cours.modifierMatieresCoursEPIEtAP &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.cours.modifierClasses:
            return this._droits.cours.modifierClasses && !lEstEnConsultation;
          case exports.TypeDroits.cours.modifierProfesseurs:
            return (
              this._droits.cours.modifierProfesseurs && !lEstEnConsultation
            );
          case exports.TypeDroits.cours.modifierSalles:
            return this._droits.cours.modifierSalles && !lEstEnConsultation;
          case exports.TypeDroits.cours.modifierMateriels:
            return this._droits.cours.modifierMateriels && !lEstEnConsultation;
          case exports.TypeDroits.cours.deplacerCours:
            return this._droits.cours.deplacerCours && !lEstEnConsultation;
          case exports.TypeDroits.cours.creerCours:
            return this._droits.cours.creerCours && !lEstEnConsultation;
          case exports.TypeDroits.cours.creerCoursPermanenceFeuilleAppel:
            return (
              this._droits.cours.creerCoursPermanenceFeuilleAppel &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.cours.estSemaineModifiable:
            if (lEstEnConsultation) {
              return false;
            }
            if (this._droits.cours.modificationNonLimiteAuxSemaine) {
              return true;
            }
            if (!this._droits.cours.domaineModificationCours) {
              return false;
            }
            return this._droits.cours.domaineModificationCours.getValeur(
              aNumeroSemine,
            );
          case exports.TypeDroits.cours.estGestionnaireSalle:
            return (
              this._droits.cours.estGestionnaireSalle && !lEstEnConsultation
            );
          case exports.TypeDroits.cours.estGestionnaireMateriel:
            return (
              this._droits.cours.estGestionnaireMateriel && !lEstEnConsultation
            );
          case exports.TypeDroits.cours.avecMateriel:
            return this._droits.cours.avecMateriel;
          case exports.TypeDroits.cours.avecFicheCoursConseil:
            return this._droits.cours.avecFicheCoursConseil;
          case exports.TypeDroits.cours.masquerPartiesDeClasse:
            return this._droits.cours.masquerPartiesDeClasse;
          case exports.TypeDroits.cours.afficherElevesDetachesDansCours:
            return this._droits.cours.afficherElevesDetachesDansCours;
          case exports.TypeDroits.eleves.voirTousLesEleves:
            return this._droits.VoirTousLesEleves;
          case exports.TypeDroits.eleves.consulterIdentiteEleve:
            return this._droits.ConsulterIdentiteEleve;
          case exports.TypeDroits.eleves.consulterFichesResponsables:
            return this._droits.ConsulterFichesResponsables;
          case exports.TypeDroits.eleves.consulterPhotosEleves:
            return this._droits.ConsulterPhotosEleves;
          case exports.TypeDroits.eleves.avecSaisieParcoursPedagogique:
            return (
              this._droits.avecSaisieParcoursPedagogique && !lEstEnConsultation
            );
          case exports.TypeDroits.eleves.avecAffectationElevesGroupesNonGAEV:
            return (
              this._droits.AvecAffectationElevesGroupesNonGAEV &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.eleves.avecAffectationElevesGroupesGAEV:
            return (
              this._droits.AvecAffectationElevesGroupesGAEV &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.eleves.avecSaisieProjetIndividuel:
            return (
              this._droits.AvecSaisieProjetIndividuel && !lEstEnConsultation
            );
          case exports.TypeDroits.eleves.avecSaisieAttestations:
            return this._droits.AvecSaisieAttestations && !lEstEnConsultation;
          case exports.TypeDroits.eleves
            .consulterDonneesAdministrativesAutresEleves:
            return this._droits.consulterDonneesAdministrativesAutresEleves;
          case exports.TypeDroits.communication.toutesClasses:
            return this._droits.AutoriserCommunicationsToutesClasses;
          case exports.TypeDroits.communication.avecDiscussion:
            return this._droits.AvecDiscussion;
          case exports.TypeDroits.communication
            .discussionDesactiveeSelonHoraire:
            return this._droits.discussionDesactiveeSelonHoraire;
          case exports.TypeDroits.communication
            .messageDiscussionDesactiveeSelonHoraire:
            return this._droits.messageDiscussionDesactiveeSelonHoraire;
          case exports.TypeDroits.communication.discussionInterdit:
            return this._droits.discussionInterdit;
          case exports.TypeDroits.communication.avecDiscussionPersonnels:
            return this._droits.AvecDiscussionPersonnels;
          case exports.TypeDroits.communication.avecDiscussionProfesseurs:
            return this._droits.AvecDiscussionProfesseurs;
          case exports.TypeDroits.communication.avecDiscussionParents:
            return this._droits.AvecDiscussionParents;
          case exports.TypeDroits.communication.avecDiscussionEleves:
            return this._droits.AvecDiscussionEleves;
          case exports.TypeDroits.communication.avecMessageInstantane:
            return this._droits.avecMessageInstantane && !lEstEnConsultation;
          case exports.TypeDroits.communication.avecContactVS:
            return this._droits.AvecContactVS && !lEstEnConsultation;
          case exports.TypeDroits.communication.lancerAlertesPPMS:
            return this._droits.lancerAlertesPPMS && !lEstEnConsultation;
          case exports.TypeDroits.communication.estDestinataireChat:
            return this._droits.estDestinataireChat;
          case exports.TypeDroits.communication.avecDiscussionAvancee:
            return this._droits.AvecDiscussionAvancee;
          case exports.TypeDroits.absences.domaineRecapitulatifAbsences:
            return this._droits.DomaineRecapitulatifAbsences;
          case exports.TypeDroits.absences.avecSaisieAppelEtVS:
            return this._droits.AvecSaisieAppelEtVS;
          case exports.TypeDroits.absences.avecSaisieAppel:
            return this._droits.AvecSaisieAppel;
          case exports.TypeDroits.absences.avecSaisieCours:
            return this._droits.AvecSaisieCours;
          case exports.TypeDroits.absences.avecSaisieAbsenceOuverte:
            return this._droits.AvecSaisieAbsenceOuverte;
          case exports.TypeDroits.absences.avecSaisieHorsCours:
            return this._droits.AvecSaisieHorsCours;
          case exports.TypeDroits.absences.avecSaisieSurGrille:
            return this._droits.AvecSaisieSurGrille;
          case exports.TypeDroits.absences.avecSaisieSurGrilleAppelProf:
            return this._droits.AvecSaisieSurGrilleAppelProf;
          case exports.TypeDroits.absences.avecSaisieAbsence:
            return this._droits.AvecSaisieAbsence;
          case exports.TypeDroits.absences.avecSaisieRetard:
            return this._droits.AvecSaisieRetard;
          case exports.TypeDroits.absences.avecSaisiePassageInfirmerie:
            return this._droits.AvecSaisiePassageInfirmerie;
          case exports.TypeDroits.absences.avecAnciennesFeuilleDAppel:
            return this._droits.avecAnciennesFeuilleDAppel;
          case exports.TypeDroits.absences.avecSaisieExclusion:
            return this._droits.AvecSaisieExclusion;
          case exports.TypeDroits.absences.avecSaisiePunition:
            return this._droits.AvecSaisiePunition;
          case exports.TypeDroits.absences.avecSaisieObservation:
            return this._droits.AvecSaisieObservation;
          case exports.TypeDroits.absences.avecConsultationDefautCarnet:
            return this._droits.AvecConsultationDefautCarnet;
          case exports.TypeDroits.absences.avecSaisieDefautCarnet:
            return this._droits.AvecSaisieDefautCarnet;
          case exports.TypeDroits.absences.avecSaisieObservationsParents:
            return this._droits.AvecSaisieObservationsParents;
          case exports.TypeDroits.absences.avecSaisieEncouragements:
            return this._droits.AvecSaisieEncouragements;
          case exports.TypeDroits.absences.avecAccesAuxEvenementsAutresCours:
            return this._droits.AvecAccesAuxEvenementsAutresCours;
          case exports.TypeDroits.absences.avecSaisieAbsencesToutesPermanences:
            return this._droits.AvecSaisieAbsencesToutesPermanences;
          case exports.TypeDroits.absences.listeDatesSaisieAbsence:
            return (
              MethodesObjet_1.MethodesObjet.dupliquer(
                this._droits.listeDatesSaisieAbsence,
              ) || new ObjetListeElements_1.ObjetListeElements()
            );
          case exports.TypeDroits.absences
            .avecSaisieAbsencesGrilleAbsencesRepas:
            return this._droits.AvecSaisieAbsencesGrilleAbsencesRepas;
          case exports.TypeDroits.absences
            .avecSaisieAbsencesGrilleAbsencesInternat:
            return this._droits.AvecSaisieAbsencesGrilleAbsencesInternat;
          case exports.TypeDroits.absences.avecSuiviAbsenceRetard:
            return this._droits.AvecSuiviAbsenceRetard;
          case exports.TypeDroits.absences.avecSaisieMotifRetard:
            return this._droits.AvecSaisieMotifRetard;
          case exports.TypeDroits.absences.avecDeclarerUneAbsence:
            return this._droits.AvecDeclarerUneAbsence;
          case exports.TypeDroits.absences.avecDeclarerDispensePonctuelle:
            return this._droits.AvecDeclarerDispensePonctuelle;
          case exports.TypeDroits.absences.avecDeclarerDispenseLongue:
            return this._droits.AvecDeclarerDispenseLongue;
          case exports.TypeDroits.competence.avecSaisieEvaluations:
            return this._droits.AvecSaisieEvaluations && !lEstEnConsultation;
          case exports.TypeDroits.competence.avecSaisieItems:
            return this._droits.AvecSaisieItems && !lEstEnConsultation;
          case exports.TypeDroits.competence.avecValidationCompetences:
            return (
              this._droits.AvecValidationCompetences && !lEstEnConsultation
            );
          case exports.TypeDroits.agenda.avecSaisieAgenda:
            return this._droits.AvecSaisieAgenda && !lEstEnConsultation;
          case exports.TypeDroits.actualite.avecSaisieActualite:
            return this._droits.AvecSaisieActualite && !lEstEnConsultation;
          case exports.TypeDroits.communication
            .avecPublicationPageEtablissement:
            return (
              this._droits.avecPublicationPageEtablissement &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.listeDiffusion.avecPublication:
            return (
              this._droits.avecPublicationListeDiffusion && !lEstEnConsultation
            );
          case exports.TypeDroits.casierNumerique
            .avecSaisieDocumentsCasiersIntervenant:
            return (
              this._droits.avecSaisieDocumentsCasiersIntervenant &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.casierNumerique
            .avecSaisieDocumentsCasiersResponsable:
            return (
              this._droits.avecSaisieDocumentsCasiersResponsable &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.casierNumerique
            .avecAccesALaListeDesDocumentEleve:
            return this._droits.avecAccesALaListeDesDocumentEleve;
          case exports.TypeDroits.dossierVS.creerDossiersVS:
            return this._droits.CreerDossiersVS && !lEstEnConsultation;
          case exports.TypeDroits.dossierVS.modifierDossiersVS:
            return this._droits.ModifierDossiersVS && !lEstEnConsultation;
          case exports.TypeDroits.dossierVS.saisieMotifsDossiersVS:
            return this._droits.SaisieMotifsDossiersVS && !lEstEnConsultation;
          case exports.TypeDroits.dossierVS.publierDossiersVS:
            return this._droits.PublierDossiersVS && !lEstEnConsultation;
          case exports.TypeDroits.dossierVS.consulterMemosEleve:
            return this._droits.ConsulterMemosEleve;
          case exports.TypeDroits.dossierVS.saisirMemos:
            return this._droits.SaisirMemos && !lEstEnConsultation;
          case exports.TypeDroits.decrochageScolaire.acces:
            return this._droits.accesDecrochage;
          case exports.TypeDroits.decrochageScolaire.suivi:
            return this._droits.suiviDecrochage && !lEstEnConsultation;
          case exports.TypeDroits.dispenses.saisie:
            return this._droits.avecSaisieDispense && !lEstEnConsultation;
          case exports.TypeDroits.incidents.acces:
            return this._droits.incidents.acces;
          case exports.TypeDroits.incidents.saisie:
            return this._droits.incidents.saisie && !lEstEnConsultation;
          case exports.TypeDroits.incidents.uniquementMesIncidentsSignales:
            return this._droits.incidents.uniquementMesIncidentsSignales;
          case exports.TypeDroits.incidents.publier:
            return this._droits.incidents.publier && !lEstEnConsultation;
          case exports.TypeDroits.punition.avecPublicationPunitions:
            return this._droits.AvecPublicationPunitions;
          case exports.TypeDroits.punition.acces:
            return this._droits.avecAccesPunitions;
          case exports.TypeDroits.punition.saisie:
            return this._droits.avecSaisiePunitions && !lEstEnConsultation;
          case exports.TypeDroits.creerMotifIncidentPunitionSanction:
            return (
              this._droits.avecCreerMotifIncidentPunitionSanction &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.punition.avecRecapPunitions:
            return this._droits.avecRecapPunitions;
          case exports.TypeDroits.punition.avecRecapSanctions:
            return this._droits.avecRecapSanctions;
          case exports.TypeDroits.stage.autoriserEditionToutesOffresStages:
            return (
              this._droits.autoriserEditionToutesOffresStages &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.cahierDeTexte.avecSaisieCahierDeTexte:
            return this._droits.avecSaisieCahierDeTexte && !lEstEnConsultation;
          case exports.TypeDroits.cahierDeTexte.creerCategoriesDeCahierDeTexte:
            return (
              this._droits.creerCategoriesDeCahierDeTexte && !lEstEnConsultation
            );
          case exports.TypeDroits.cahierDeTexte.avecSaisiePieceJointe:
            return (
              this._droits.avecSaisiePieceJointeCahierDeTexte &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.cahierDeTexte.tailleMaxPieceJointe:
            return Math.min(
              this._droits.tailleMaxPieceJointeCahierDeTexte,
              this.get(exports.TypeDroits.tailleMaxUpload),
            );
          case exports.TypeDroits.notation.avecSaisieDevoirs:
            return this._droits.AvecSaisieDevoirs && !lEstEnConsultation;
          case exports.TypeDroits.compte.avecSaisieIdentifiant:
            return (
              this._droits.compte.avecSaisieIdentifiant && !lEstEnConsultation
            );
          case exports.TypeDroits.compte.avecSaisieMotDePasse:
            return (
              this._droits.compte.avecSaisieMotDePasse && !lEstEnConsultation
            );
          case exports.TypeDroits.compte.avecSaisieMotDePasseEleve:
            return (
              this._droits.compte.avecSaisieMotDePasseEleve &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.compte.avecInformationsPersonnelles:
            return this._droits.compte.avecInformationsPersonnelles;
          case exports.TypeDroits.compte.avecSaisieInfosPersoCoordonnees:
            return (
              this._droits.compte.avecSaisieInfosPersoCoordonnees &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.compte.avecSaisieInfosPersoAutorisations:
            return (
              this._droits.compte.avecSaisieInfosPersoAutorisations &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecDemandeTravauxIntendance:
            return (
              this._droits.intendance.avecDemandeTravauxIntendance &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.uniquementMesTravauxIntendance:
            return (
              this._droits.intendance.uniquementMesTravauxIntendance &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecExecutionTravauxIntendance:
            return (
              this._droits.intendance.avecExecutionTravauxIntendance &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecGestionTravauxIntendance:
            return (
              this._droits.intendance.avecGestionTravauxIntendance &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecDemandeTachesSecretariat:
            return (
              this._droits.intendance.avecDemandeTachesSecretariat &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.uniquementMesTachesSecretariat:
            return (
              this._droits.intendance.uniquementMesTachesSecretariat &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecExecutionTachesSecretariat:
            return (
              this._droits.intendance.avecExecutionTachesSecretariat &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecDemandeTachesInformatique:
            return (
              this._droits.intendance.avecDemandeTachesInformatique &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.uniquementMesTachesInformatique:
            return (
              this._droits.intendance.uniquementMesTachesInformatique &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecExecutionTachesInformatique:
            return (
              this._droits.intendance.avecExecutionTachesInformatique &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecGestionTachesInformatique:
            return (
              this._droits.intendance.avecGestionTachesInformatique &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecDemandeCommandes:
            return (
              this._droits.intendance.avecDemandeCommandes &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.uniquementMesCommandes:
            return (
              this._droits.intendance.uniquementMesCommandes &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecExecutionCommandes:
            return (
              this._droits.intendance.avecExecutionCommandes &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.intendance.avecGestionCommandes:
            return (
              this._droits.intendance.avecGestionCommandes &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.services.avecCreationSousServices:
            return (
              this._droits.services.avecCreationSousServices &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.services.avecModificationCoefGeneral:
            return (
              this._droits.services.avecModificationCoefGeneral &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.trombinoscope
            .autoriseAConsulterPhotosDeTousLesEleves:
            return this._droits.autoriseAConsulterPhotosDeTousLesEleves;
          case exports.TypeDroits.forum.avecCreationSujetForum:
            return this._droits.avecCreationSujetForum;
          case exports.TypeDroits.forum.avecModificationForumAPosteriori:
            return this._droits.avecModificationForumAPosteriori;
          case exports.TypeDroits.avecAccesRemplacementsProfs:
            return this._droits.avecAccesRemplacementsProfs;
          case exports.TypeDroits.voirAbsencesEtRemplacementsProfs:
            return this._droits.voirAbsencesEtRemplacementsProfs;
          case exports.TypeDroits.sePorterVolontaireRemplacement:
            return this._droits.sePorterVolontaireRemplacement;
          case exports.TypeDroits.avecSaisieAppreciationsGenerales:
            return (
              this._droits.avecSaisieAppreciationsGenerales &&
              !lEstEnConsultation
            );
          case exports.TypeDroits.assistantSaisieAppreciations:
            return (
              this._droits.AssistantSaisieAppreciations && !lEstEnConsultation
            );
          case exports.TypeDroits.tailleMaxDocJointEtablissement:
            return Math.min(
              this._droits.tailleMaxDocJointEtablissement,
              this.get(exports.TypeDroits.tailleMaxUpload),
            );
          case exports.TypeDroits.tailleMaxRenduTafEleve:
            return Math.min(
              this._droits.tailleMaxRenduTafEleve,
              this.get(exports.TypeDroits.tailleMaxUpload),
            );
          case exports.TypeDroits.tailleTravailAFaire:
            return this._droits.tailleTravailAFaire;
          case exports.TypeDroits.tailleCirconstance:
            return this._droits.tailleCirconstance;
          case exports.TypeDroits.tailleCommentaire:
            return this._droits.tailleCommentaire;
          case exports.TypeDroits.autoriserImpressionBulletinReleveBrevet:
            return this._droits.autoriserImpressionBulletinReleveBrevet;
          case exports.TypeDroits.avecDroitDeconnexionMessagerie:
            return this._droits.avecDroitDeconnexionMessagerie;
          case exports.TypeDroits.estDirecteur:
            return this._droits.estDirecteur;
          case exports.TypeDroits.estEnseignant:
            return this._droits.estEnseignant;
          case exports.TypeDroits.fonctionnalites.gestionNotation:
            return this._droitsSession.fonctionnalites.gestionNotation;
          case exports.TypeDroits.fonctionnalites.gestionCompetences:
            return this._droitsSession.fonctionnalites.gestionCompetences;
          case exports.TypeDroits.fonctionnalites.gestionBrevet:
            return this._droitsSession.fonctionnalites.gestionBrevet;
          case exports.TypeDroits.fonctionnalites.gestionProgrammesBO:
            return this._droitsSession.fonctionnalites.gestionProgrammesBO;
          case exports.TypeDroits.fonctionnalites.gestionStages:
            return this._droitsSession.fonctionnalites.gestionStages;
          case exports.TypeDroits.fonctionnalites.gestionIPR:
            return this._droitsSession.fonctionnalites.gestionIPR;
          case exports.TypeDroits.fonctionnalites
            .appelSaisirMotifJustifDAbsence:
            return this._droitsSession.fonctionnalites
              .appelSaisirMotifJustifDAbsence;
          case exports.TypeDroits.fonctionnalites
            .saisieEtendueAbsenceDepuisAppel:
            return this._droitsSession.fonctionnalites
              .saisieEtendueAbsenceDepuisAppel;
          case exports.TypeDroits.fonctionnalites.gestionTwitter:
            return this._droitsSession.fonctionnalites.gestionTwitter;
          case exports.TypeDroits.fonctionnalites.gestionBulletinClasse:
            return this._droitsSession.fonctionnalites.gestionBulletinClasse;
          case exports.TypeDroits.fonctionnalites.gestionNathan:
            return this._droitsSession.fonctionnalites.gestionNathan;
          case exports.TypeDroits.fonctionnalites.gestionPunitions:
            return this._droitsSession.fonctionnalites.gestionPunitions;
          case exports.TypeDroits.fonctionnalites.gestionCDT:
            return this._droitsSession.fonctionnalites.gestionCDT;
          case exports.TypeDroits.fonctionnalites.gestionPeriodeNotation:
            return this._droitsSession.fonctionnalites.gestionPeriodeNotation;
          case exports.TypeDroits.fonctionnalites.gestionInfirmerie:
            return this._droitsSession.fonctionnalites.gestionInfirmerie;
          case exports.TypeDroits.fonctionnalites.gestionPermanence:
            return this._droitsSession.fonctionnalites.gestionPermanence;
          case exports.TypeDroits.fonctionnalites.gestionAbsencesDemiPension:
            return this._droitsSession.fonctionnalites
              .gestionAbsencesDemiPension;
          case exports.TypeDroits.fonctionnalites.gestionAbsencesInternat:
            return this._droitsSession.fonctionnalites.gestionAbsencesInternat;
          case exports.TypeDroits.fonctionnalites.gestionEtendueEleves:
            return this._droitsSession.fonctionnalites.gestionEtendueEleves;
          case exports.TypeDroits.fonctionnalites.gestionEleves:
            return this._droitsSession.fonctionnalites.gestionEleves;
          case exports.TypeDroits.fonctionnalites.gestionPersonnels:
            return this._droitsSession.fonctionnalites.gestionPersonnels;
          case exports.TypeDroits.fonctionnalites.forcerARInfos:
            return this._droitsSession.fonctionnalites.forcerARInfos;
          case exports.TypeDroits.fonctionnalites.gestionSondageAnonyme:
            return this._droitsSession.fonctionnalites.gestionSondageAnonyme;
          case exports.TypeDroits.fonctionnalites
            .gestionAbsenceDJParUtilisateur:
            return this._droitsSession.fonctionnalites
              .gestionAbsenceDJParUtilisateur;
          case exports.TypeDroits.fonctionnalites.attestationEtendue:
            return this._droitsSession.fonctionnalites.attestationEtendue;
          case exports.TypeDroits.fonctionnalites.afficherProjetsAccompagnement:
            return this._droitsSession.fonctionnalites
              .afficherProjetsAccompagnement;
          case exports.TypeDroits.fonctionnalites.gestionARBulletins:
            return this._droitsSession.fonctionnalites.gestionARBulletins;
          case exports.TypeDroits.fonctionnalites
            .importExportEducationNationale:
            return this._droitsSession.fonctionnalites
              .importExportEducationNationale;
          case exports.TypeDroits.fonctionnalites.avecTransformationFluxFichier:
            return this._droitsSession.fonctionnalites
              .avecTransformationFluxFichier;
          default:
            return false;
        }
      }
      init() {
        this._droits = {
          AssistantSaisieAppreciations: false,
          VoirTousLesEleves: false,
          ConsulterIdentiteEleve: false,
          ConsulterFichesResponsables: false,
          ConsulterPhotosEleves: false,
          avecSaisieParcoursPedagogique: false,
          AvecAffectationElevesGroupesNonGAEV: false,
          AvecAffectationElevesGroupesGAEV: false,
          AvecSaisieProjetIndividuel: false,
          AvecSaisieAttestations: false,
          consulterDonneesAdministrativesAutresEleves: true,
          AutoriserCommunicationsToutesClasses: false,
          AvecDiscussion: false,
          discussionDesactiveeSelonHoraire: false,
          messageDiscussionDesactiveeSelonHoraire: '',
          discussionInterdit: false,
          AvecDiscussionPersonnels: false,
          AvecDiscussionProfesseurs: false,
          AvecDiscussionParents: false,
          AvecDiscussionEleves: false,
          avecMessageInstantane: false,
          AvecContactVS: false,
          lancerAlertesPPMS: false,
          estDestinataireChat: false,
          AvecDiscussionAvancee: false,
          DomaineRecapitulatifAbsences: new TypeDomaine_1.TypeDomaine(),
          AvecSaisieAppelEtVS: false,
          AvecSaisieAppel: false,
          AvecSaisieCours: false,
          AvecSaisieAbsenceOuverte: false,
          AvecSaisieHorsCours: false,
          AvecSaisieSurGrille: false,
          AvecSaisieSurGrilleAppelProf: false,
          AvecSaisieAbsence: false,
          AvecSaisieRetard: false,
          AvecSaisiePassageInfirmerie: false,
          avecAnciennesFeuilleDAppel: false,
          AvecSaisieExclusion: false,
          AvecSaisiePunition: false,
          AvecSaisieObservation: false,
          AvecConsultationDefautCarnet: false,
          AvecSaisieDefautCarnet: false,
          AvecSaisieObservationsParents: false,
          AvecSaisieEncouragements: false,
          AvecAccesAuxEvenementsAutresCours: false,
          AvecSaisieAbsencesToutesPermanences: false,
          DateSaisieAbsence: null,
          AvecDeclarerUneAbsence: false,
          AvecDeclarerDispensePonctuelle: false,
          AvecDeclarerDispenseLongue: false,
          AvecSaisieAbsencesGrilleAbsencesRepas: false,
          AvecSaisieAbsencesGrilleAbsencesInternat: false,
          AvecSuiviAbsenceRetard: false,
          AvecSaisieEvaluations: false,
          AvecSaisieItems: false,
          AvecValidationCompetences: false,
          AvecSaisieAgenda: false,
          AvecSaisieActualite: false,
          avecPublicationPageEtablissement: false,
          avecPublicationListeDiffusion: false,
          avecSaisieDocumentsCasiersIntervenant: false,
          avecSaisieDocumentsCasiersResponsable: false,
          avecAccesALaListeDesDocumentEleve: false,
          CreerDossiersVS: false,
          ModifierDossiersVS: false,
          SaisieMotifsDossiersVS: false,
          PublierDossiersVS: false,
          ConsulterMemosEleve: false,
          SaisirMemos: false,
          accesDecrochage: false,
          suiviDecrochage: false,
          avecSaisieDispense: false,
          incidents: { acces: false, saisie: false, publier: false },
          AvecPublicationPunitions: false,
          avecAccesPunitions: false,
          avecSaisiePunitions: false,
          avecRecapPunitions: false,
          avecRecapSanctions: false,
          avecCreerMotifIncidentPunitionSanction: false,
          avecAccesRemplacementsProfs: false,
          voirAbsencesEtRemplacementsProfs: false,
          sePorterVolontaireRemplacement: false,
          avecSaisieAppreciationsGenerales: false,
          cours: {
            domaineConsultationEDT: new TypeDomaine_1.TypeDomaine(),
            avecReservationCreneauxLibres: false,
            modifierElevesDetachesSurCoursDeplaceCreneauLibre: false,
            modifierMatieres: false,
            modifierMatieresCoursEPIEtAP: false,
            modifierClasses: false,
            modifierProfesseurs: false,
            modifierSalles: false,
            modifierMateriels: false,
            creerCours: false,
            creerCoursPermanenceFeuilleAppel: false,
            deplacerCours: false,
            modificationNonLimiteAuxSemaine: false,
            domaineModificationCours: new TypeDomaine_1.TypeDomaine(),
            estGestionnaireSalle: false,
            estGestionnaireMateriel: false,
            avecMateriel: false,
            avecFicheCoursConseil: false,
            masquerPartiesDeClasse: false,
            afficherElevesDetachesDansCours: false,
          },
          autoriserEditionToutesOffresStages: false,
          avecSaisieCahierDeTexte: false,
          creerCategoriesDeCahierDeTexte: false,
          avecSaisiePieceJointeCahierDeTexte: false,
          tailleMaxPieceJointeCahierDeTexte: 0,
          AvecSaisieDevoirs: false,
          tailleMaxDocJointEtablissement: 0,
          tailleMaxRenduTafEleve: 0,
          tailleTravailAFaire: 1000,
          tailleCirconstance: 1000,
          tailleCommentaire: 1000,
          compte: {
            avecSaisieIdentifiant: false,
            avecSaisieMotDePasse: false,
            avecSaisieMotDePasseEleve: false,
            avecInformationsPersonnelles: false,
            avecSaisieInfosPersoCoordonnees: false,
            avecSaisieInfosPersoAutorisations: false,
          },
          intendance: {
            avecDemandeTravauxIntendance: false,
            uniquementMesTravauxIntendance: false,
            avecExecutionTravauxIntendance: false,
            avecGestionTravauxIntendance: false,
            avecDemandeTachesSecretariat: false,
            uniquementMesTachesSecretariat: false,
            avecExecutionTachesSecretariat: false,
            avecDemandeTachesInformatique: false,
            uniquementMesTachesInformatique: false,
            avecExecutionTachesInformatique: false,
            avecGestionTachesInformatique: false,
            avecDemandeCommandes: false,
            uniquementMesCommandes: false,
            avecExecutionCommandes: false,
            avecGestionCommandes: false,
          },
          services: {
            avecCreationSousServices: false,
            avecModificationCoefGeneral: false,
          },
          autoriseAConsulterPhotosDeTousLesEleves: false,
          avecCreationSujetForum: false,
          avecModificationForumAPosteriori: false,
          autoriserImpressionBulletinReleveBrevet: false,
          avecDroitDeconnexionMessagerie: false,
          estDirecteur: false,
          estEnseignant: false,
        };
      }
      initDroitsSession() {
        this._droitsSession = {
          fonctionnalites: {
            gestionNotation: true,
            gestionCompetences: true,
            gestionBrevet: true,
            gestionProgrammesBO: true,
            gestionStages: true,
            gestionIPR: true,
            appelSaisirMotifJustifDAbsence: false,
            gestionTwitter: false,
            gestionBulletinClasse: true,
            gestionNathan: true,
            gestionPunitions: true,
            gestionInfirmerie: true,
            gestionPermanence: true,
            gestionAbsencesDemiPension: true,
            gestionAbsencesInternat: true,
            gestionEtendueEleves: true,
            gestionEleves: true,
            gestionPersonnels: true,
            forcerARInfos: false,
            gestionSondageAnonyme: true,
            gestionAbsenceDJParUtilisateur: false,
            attestationEtendue: true,
            afficherProjetsAccompagnement: true,
            saisieEtendueAbsenceDepuisAppel: false,
            importExportEducationNationale: true,
            gestionCDT: true,
            gestionPeriodeNotation: true,
            gestionARBulletins: false,
            avecTransformationFluxFichier: false,
          },
        };
      }
      chargerJSON(aJSON) {
        if (aJSON && aJSON.autorisationsSession) {
          this.initDroitsSession();
          $.extend(true, this._droitsSession, aJSON.autorisationsSession);
        }
        if (aJSON && aJSON.autorisations) {
          this._autorisationsChargees = true;
          this.init();
          $.extend(true, this._droits, aJSON.autorisations);
          this._droits.listeDatesSaisieAbsence =
            new ObjetListeElements_1.ObjetListeElements();
          for (
            let I = 0;
            this._droits.DateSaisieAbsence &&
            I < this._droits.DateSaisieAbsence.length;
            I++
          ) {
            const lDate = new ObjetElement_1.ObjetElement();
            lDate.Date = aJSON.autorisations.DateSaisieAbsence[I];
            lDate.Libelle = ObjetDate_1.GDate.formatDate(
              lDate.Date,
              '%JJJJ %JJ %MMM',
            );
            this._droits.listeDatesSaisieAbsence.addElement(lDate);
          }
        }
      }
    }
    exports.ObjetDroitsPN = ObjetDroitsPN;
  },
  fn: 'objetdroitspn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreReponseInternetActualite = void 0;
    var TypeGenreReponseInternetActualite;
    (function (TypeGenreReponseInternetActualite) {
      TypeGenreReponseInternetActualite[
        (TypeGenreReponseInternetActualite['AvecAR'] = 0)
      ] = 'AvecAR';
      TypeGenreReponseInternetActualite[
        (TypeGenreReponseInternetActualite['Textuelle'] = 1)
      ] = 'Textuelle';
      TypeGenreReponseInternetActualite[
        (TypeGenreReponseInternetActualite['ChoixUnique'] = 2)
      ] = 'ChoixUnique';
      TypeGenreReponseInternetActualite[
        (TypeGenreReponseInternetActualite['ChoixMultiple'] = 3)
      ] = 'ChoixMultiple';
      TypeGenreReponseInternetActualite[
        (TypeGenreReponseInternetActualite['SansAR'] = 4)
      ] = 'SansAR';
      TypeGenreReponseInternetActualite[
        (TypeGenreReponseInternetActualite['SansReponse'] = 5)
      ] = 'SansReponse';
    })(
      TypeGenreReponseInternetActualite ||
        (exports.TypeGenreReponseInternetActualite =
          TypeGenreReponseInternetActualite =
            {}),
    );
  },
  fn: 'typegenrereponseinternetactualite.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { MethodesObjet } = require('MethodesObjet.js');
    const { GDate } = require('ObjetDate.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { ObjetTri } = require('ObjetTri.js');
    function TUtilitaireListePeriodes() {}
    (function () {
      TUtilitaireListePeriodes.choix = {
        aujourdhui: 1,
        hier: 1,
        demain: 1,
        semaineCourante: 1,
        semainePrecedente: 1,
        semaineSuivante: 1,
        moisCourant: 1,
        periodes: 1,
        annee: 1,
        mois: 1,
      };
      MethodesObjet.indenterEnumere(TUtilitaireListePeriodes.choix);
      TUtilitaireListePeriodes.construireListePeriodes = function (
        aChoixPeriodes,
        aOptions,
      ) {
        const lListe = new ObjetListeElements(),
          lOptions = $.extend(
            {
              dateDebut: GParametres.PremiereDate,
              dateFin: GParametres.DerniereDate,
              dansBornes: function (aDate) {
                return (
                  (aDate > this.dateDebut ||
                    GDate.estJourEgal(aDate, this.dateDebut)) &&
                  (aDate < this.dateFin ||
                    GDate.estJourEgal(aDate, this.dateFin))
                );
              },
              datesOK: function (aDateDebut, aDateFin) {
                return this.dansBornes(aDateDebut) || this.dansBornes(aDateFin);
              },
              borner: function (aDate) {
                if (aDate < this.dateDebut) {
                  return new Date(this.dateDebut.getTime());
                }
                if (aDate > this.dateFin) {
                  return new Date(this.dateFin.getTime());
                }
                return aDate;
              },
            },
            aOptions,
          );
        if (MethodesObjet.isArray(aChoixPeriodes)) {
          for (let i = 0; i < aChoixPeriodes.length; i++) {
            _ajouterChoix(lListe, aChoixPeriodes[i], lOptions);
          }
        }
        return lListe;
      };
      function _ajouterChoix(aListe, aChoix, aOptions) {
        let lElement = null;
        let lDate;
        let lDateDebut;
        let lDateFin;
        let lCycle;
        function _ajouterElement(aLibelle, aDateDebut, aDateFin) {
          const lElement = new ObjetElement(aLibelle);
          lElement.dates = {
            debut: aOptions.borner(aDateDebut),
            fin: aOptions.borner(aDateFin),
          };
          lElement.choix = aChoix;
          aListe.addElement(lElement);
        }
        switch (aChoix) {
          case TUtilitaireListePeriodes.choix.aujourdhui:
            _ajouterElement(
              GTraductions.getValeur('Aujourdhui').ucfirst(),
              GDate.getDateCourante(),
              GDate.getDateCourante(),
            );
            break;
          case TUtilitaireListePeriodes.choix.hier:
            lDate = GDate.getJourSuivant(GDate.getDateCourante(), -1);
            if (aOptions.datesOK(lDate, lDate)) {
              _ajouterElement(
                GTraductions.getValeur('Hier').ucfirst(),
                lDate,
                lDate,
              );
            }
            break;
          case TUtilitaireListePeriodes.choix.demain:
            lDate = GDate.getJourSuivant(GDate.getDateCourante(), 1);
            if (aOptions.datesOK(lDate, lDate)) {
              _ajouterElement(
                GTraductions.getValeur('Demain').ucfirst(),
                lDate,
                lDate,
              );
            }
            break;
          case TUtilitaireListePeriodes.choix.semaineCourante:
            lCycle = IE.Cycles.cycleCourant();
            lDateDebut = IE.Cycles.dateDebutCycle(lCycle);
            lDateFin = IE.Cycles.dateFinCycle(lCycle);
            if (aOptions.datesOK(lDateDebut, lDateFin)) {
              _ajouterElement(
                GTraductions.getValeur('SemaineEnCours'),
                lDateDebut,
                lDateFin,
              );
            }
            break;
          case TUtilitaireListePeriodes.choix.semainePrecedente:
            lCycle = IE.Cycles.cycleCourant() - 1;
            if (IE.Cycles.cycleDansAnnee(lCycle) !== lCycle) {
              return;
            }
            lDateDebut = IE.Cycles.dateDebutCycle(lCycle);
            lDateFin = IE.Cycles.dateFinCycle(lCycle);
            if (aOptions.datesOK(lDateDebut, lDateFin)) {
              _ajouterElement(
                GTraductions.getValeur('SemainePrecedente'),
                lDateDebut,
                lDateFin,
              );
            }
            break;
          case TUtilitaireListePeriodes.choix.semaineSuivante:
            lCycle = IE.Cycles.cycleCourant() + 1;
            if (IE.Cycles.cycleDansAnnee(lCycle) !== lCycle) {
              return;
            }
            lDateDebut = IE.Cycles.dateDebutCycle(lCycle);
            lDateFin = IE.Cycles.dateFinCycle(lCycle);
            if (aOptions.datesOK(lDateDebut, lDateFin)) {
              _ajouterElement(
                GTraductions.getValeur('SemaineSuivante'),
                lDateDebut,
                lDateFin,
              );
            }
            break;
          case TUtilitaireListePeriodes.choix.moisCourant:
            lDate = GDate.getDateCourante();
            lDateDebut = GDate.getPremierJourDuMois(
              lDate.getFullYear(),
              lDate.getMonth(),
            );
            lDateFin = GDate.getDernierJourDuMois(
              lDate.getFullYear(),
              lDate.getMonth(),
            );
            if (aOptions.datesOK(lDateDebut, lDateFin)) {
              _ajouterElement(
                GTraductions.getValeur('MoisEnCours'),
                lDateDebut,
                lDateFin,
              );
            }
            break;
          case TUtilitaireListePeriodes.choix.periodes: {
            const lListePeriodesSaisie = new ObjetListeElements();
            GParametres.listePeriodes.parcourir((D) => {
              if (
                D.getGenre() > 0 &&
                D.getGenre() !== 3 &&
                aOptions.datesOK(D.dates.debut, D.dates.fin)
              ) {
                lElement = MethodesObjet.dupliquer(D);
                lElement.choix = aChoix;
                lElement.dates.debut = aOptions.borner(D.dates.debut);
                lElement.dates.fin = aOptions.borner(D.dates.fin);
                lListePeriodesSaisie.addElement(lElement);
              }
            });
            lListePeriodesSaisie.setTri([
              ObjetTri.init((D) => {
                return D.getGenre() === 3 ? 0 : 1;
              }),
              ObjetTri.init((D) => {
                return D.getGenre();
              }),
            ]);
            lListePeriodesSaisie.trier();
            aListe.add(lListePeriodesSaisie);
            break;
          }
          case TUtilitaireListePeriodes.choix.annee:
            GParametres.listePeriodes.parcourir((D) => {
              if (D.getGenre() === 3) {
                lElement = MethodesObjet.dupliquer(D);
                lElement.setLibelle(GTraductions.getValeur('AnneeComplete'));
                lElement.choix = aChoix;
                lElement.dates.debut = aOptions.borner(D.dates.debut);
                lElement.dates.fin = aOptions.borner(D.dates.fin);
                aListe.addElement(lElement);
                return false;
              }
            });
            break;
          case TUtilitaireListePeriodes.choix.mois:
            GDate.getListeMoisAPartirDeDate(
              aOptions.dateDebut,
              aOptions.dateFin,
            ).parcourir((D) => {
              _ajouterElement(D.getLibelle(), D.dateDebut, D.dateFin);
            });
            break;
          default:
        }
      }
    })();
    module.exports = { TUtilitaireListePeriodes };
  },
  fn: 'utilitairelisteperiodes.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { TypeDroits } = require('ObjetDroitsPN.js');
    const { MethodesObjet } = require('MethodesObjet.js');
    const { GChaine } = require('ObjetChaine.js');
    const { GStyle } = require('ObjetStyle.js');
    const { EGenreEtat } = require('Enumere_Etat.js');
    const { EGenreTriElement } = require('Enumere_TriElement.js');
    const { GDate } = require('ObjetDate.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { ObjetTri } = require('ObjetTri.js');
    const { GObjetWAI, EGenreAttribut } = require('ObjetWAI.js');
    const { TypeDomaine } = require('TypeDomaine.js');
    const { TypeEnsembleNombre } = require('TypeEnsembleNombre.js');
    const { EGenreEspace } = require('Enumere_Espace.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    const {
      TypeGenreReponseInternetActualite,
    } = require('TypeGenreReponseInternetActualite.js');
    const { TUtilitaireListePeriodes } = require('UtilitaireListePeriodes.js');
    require('InfoSondage.css');
    function TUtilitaireInformations() {}
    TUtilitaireInformations.creerActualiteDiffusionDesResultatsSondage =
      function (aSondage, aListeCategories, aListePiecesJointesResultats) {
        let lCategorieParDefaut = null;
        if (!!aListeCategories) {
          aListeCategories.parcourir((D) => {
            if (!!D && D.estDefaut) {
              lCategorieParDefaut = D;
              return false;
            }
          });
          if (!lCategorieParDefaut) {
            lCategorieParDefaut = aListeCategories.getPremierElement();
          }
        }
        const lNouvelleActualite =
          TUtilitaireInformations.initialiserNouveauItem({
            categorie: lCategorieParDefaut,
          });
        lNouvelleActualite.setLibelle(
          GTraductions.getValeur(
            'actualites.Edition.TitreDiffusionResultatsDuSondage',
            [aSondage.getLibelle() || ''],
          ),
        );
        lNouvelleActualite.publie = true;
        lNouvelleActualite.estUneDiffusionDeResultatsSondage = true;
        const lStrTypeSondage = aSondage.reponseAnonyme
          ? GTraductions.getValeur('actualites.Anonyme')
          : GTraductions.getValeur('actualites.Nominatif');
        const lMessageNouvelleInformation = GTraductions.getValeur(
          'actualites.Edition.MessageDiffusionResultatsDuSondage',
          [lStrTypeSondage.toLowerCase(), aSondage.getLibelle() || ''],
        );
        const lPremiereQuestion =
          lNouvelleActualite.listeQuestions.getPremierElement();
        lPremiereQuestion.texte = lMessageNouvelleInformation;
        if (!lPremiereQuestion.listePiecesJointes) {
          lPremiereQuestion.listePiecesJointes = new ObjetListeElements();
        }
        aListePiecesJointesResultats.parcourir((D) => {
          lPremiereQuestion.listePiecesJointes.addElement(D);
        });
        return lNouvelleActualite;
      };
    TUtilitaireInformations.getListePiecesJointesDActualite = function (
      aActualite,
    ) {
      const lListePiecesJointes = new ObjetListeElements();
      if (!!aActualite && !!aActualite.listeQuestions) {
        aActualite.listeQuestions.parcourir((aQuestion) => {
          if (!!aQuestion && !!aQuestion.listePiecesJointes) {
            aQuestion.listePiecesJointes.parcourir((aPJQuestion) => {
              lListePiecesJointes.addElement(aPJQuestion);
            });
          }
        });
      }
      return lListePiecesJointes;
    };
    function _calculeDateFinSondage(aDate) {
      let i = 0;
      let lDate = new Date(aDate.getTime());
      do {
        lDate = GDate.getJourSuivant(lDate);
        if (
          !GParametres.JoursFeries.getValeur(
            GDate.getNbrJoursEntreDeuxDates(
              IE.Cycles.dateDebutPremierCycle(),
              aDate,
            ) + 1,
          ) &&
          GDate.estUnJourOuvre(lDate)
        ) {
          i++;
        }
      } while (i < 15 && lDate < GDate.derniereDate);
      return lDate;
    }
    TUtilitaireInformations.appliquerModeleSurExistant = function (aParam) {
      const lModele = aParam.modele;
      const lInfoSond = aParam.infoSond;
      if (lInfoSond === null || lInfoSond === undefined) {
        return null;
      }
      if (lModele === null || lModele === undefined) {
        return lInfoSond;
      }
      if (lInfoSond.estVerrouille) {
        return lInfoSond;
      }
      if (lModele.estModele !== true) {
      }
      if (
        lInfoSond.estInformation !== lModele.estInformation ||
        lInfoSond.estSondage !== lModele.estSondage
      ) {
        return lInfoSond;
      }
      lInfoSond.setLibelle(lModele.getLibelle());
      lInfoSond.categorie = lModele.categorie;
      lInfoSond.estModele = false;
      if (lModele.listeQuestions) {
        lInfoSond.listeQuestions = _copierQuestions.call(
          this,
          lModele.listeQuestions,
        );
      }
      lInfoSond.reponseAnonyme = lModele.reponseAnonyme;
      return lInfoSond;
    };
    TUtilitaireInformations.initialiserNouveauItem = function (aParam) {
      const lInformation = aParam.actualite
        ? new ObjetElement(
            GTraductions.getValeur('actualites.Edition.CopieDe', [
              aParam.actualite.getLibelle(),
            ]),
          )
        : new ObjetElement('');
      let lGenreReponse = aParam.genreReponse
        ? aParam.genreReponse
        : TypeGenreReponseInternetActualite.AvecAR;
      const lForcerAR = GApplication.droits.get(
        TypeDroits.fonctionnalites.forcerARInfos,
      );
      if (
        lGenreReponse === TypeGenreReponseInternetActualite.SansAR &&
        lForcerAR === true
      ) {
        lGenreReponse = TypeGenreReponseInternetActualite.AvecAR;
      }
      lInformation.categorie = !aParam.categorie
        ? !aParam.actualite
          ? GEtatUtilisateur.listeCategories.get(this.indiceCategorieParDefaut)
          : aParam.actualite.categorie
        : aParam.categorie;
      lInformation.auteur = GEtatUtilisateur.getUtilisateur().getLibelle();
      lInformation.reponseAnonyme = false;
      lInformation.estInformation = [
        TypeGenreReponseInternetActualite.AvecAR,
        TypeGenreReponseInternetActualite.SansAR,
      ].includes(lGenreReponse);
      lInformation.estSondage = !lInformation.estInformation;
      lInformation.date = '';
      lInformation.publie =
        aParam.publie !== null && aParam.publie !== undefined
          ? aParam.publie
          : !aParam.actualite;
      lInformation.estModele = aParam.estModele === true;
      const lDateDebut = GDate.getDateCourante();
      const lDateFin = lInformation.estInformation
        ? GDate.derniereDate
        : _calculeDateFinSondage(lDateDebut);
      lInformation.dateDebut =
        aParam.actualite && aParam.actualite.dateDebut
          ? aParam.actualite.dateDebut
          : lDateDebut;
      lInformation.dateFin = aParam.actualite
        ? aParam.actualite.dateFin
        : lDateFin;
      lInformation.avecReponse = TUtilitaireInformations.avecReponse;
      lInformation.aToutRepondu = TUtilitaireInformations.aToutRepondu;
      lInformation.lue = false;
      lInformation.public = new ObjetElement('');
      lInformation.genrePublic = -1;
      lInformation.visible = true;
      if (aParam.actualite && aParam.actualite.listeQuestions) {
        lInformation.listeQuestions = _copierQuestions.call(
          this,
          aParam.actualite.listeQuestions,
        );
      } else {
        lInformation.listeQuestions = new ObjetListeElements();
        lInformation.listeQuestions.addElement(
          TUtilitaireInformations.creerQuestionOuTexteSondage({
            genreReponse: lGenreReponse,
          }),
        );
      }
      lInformation.estVerrouille = false;
      lInformation.nombreDestinataire = aParam.actualite
        ? aParam.actualite.nombreDestinataire
        : 0;
      lInformation.nomDestinataire = aParam.actualite
        ? aParam.actualite.nomDestinataire
        : GTraductions.getValeur('actualites.Aucun');
      lInformation.detailPublic = aParam.actualite
        ? aParam.actualite.detailPublic
        : GTraductions.getValeur('actualites.AucunDestinataire');
      lInformation.avecModificationPublic = !!(
        aParam.actualite || aParam.listePublic
      );
      lInformation.avecElevesRattaches = false;
      lInformation.genresPublicEntite = aParam.actualite
        ? MethodesObjet.dupliquer(aParam.actualite.genresPublicEntite)
        : new TypeEnsembleNombre();
      lInformation.listePublicEntite = aParam.actualite
        ? MethodesObjet.dupliquer(aParam.actualite.listePublicEntite)
        : new ObjetListeElements();
      if (aParam.listePublic && aParam.genresPublic) {
        lInformation.listePublicEntite = new ObjetListeElements();
        lInformation.listePublicIndividu = new ObjetListeElements();
        if (aParam.genresPublic.length > 0) {
          if (
            this.getGenresRessourceAffDestinataire().includes(
              EGenreRessource.Classe,
            ) ||
            this.getGenresRessourceAffDestinataire().includes(
              EGenreRessource.Groupe,
            )
          ) {
            lInformation.listePublicEntite = aParam.listePublic;
          } else {
            lInformation.listePublicIndividu = aParam.listePublic;
          }
        }
      } else {
        lInformation.listePublicEntite = aParam.actualite
          ? MethodesObjet.dupliquer(aParam.actualite.listePublicEntite)
          : new ObjetListeElements();
        lInformation.listePublicIndividu = aParam.actualite
          ? MethodesObjet.dupliquer(aParam.actualite.listePublicIndividu)
          : new ObjetListeElements();
      }
      lInformation.getDate = TUtilitaireInformations.getDate.bind(lInformation);
      return lInformation;
    };
    TUtilitaireInformations.creerQuestionOuTexteSondage = function (aParams) {
      const lParams = aParams || {};
      const lRang = lParams.rang ? lParams.rang : 1;
      const lGenreReponse =
        !lParams.genreReponse ||
        (lParams.genreReponse === TypeGenreReponseInternetActualite.SansAR &&
          GApplication.droits.get(TypeDroits.fonctionnalites.forcerARInfos))
          ? TypeGenreReponseInternetActualite.AvecAR
          : lParams.genreReponse;
      const lRangElement = lParams.rangElement ? lParams.rangElement : lRang;
      let lLibelle;
      if (
        !!aParams.genreReponse &&
        aParams.genreReponse === TypeGenreReponseInternetActualite.SansReponse
      ) {
        lLibelle = GTraductions.getValeur('actualites.Edition.TexteN', [
          lRangElement,
        ]);
      } else {
        lLibelle = GTraductions.getValeur('actualites.Edition.QuestionN', [
          lRangElement,
        ]);
      }
      const lResult = new ObjetElement(lLibelle);
      lResult.rang = lRang;
      lResult.indice = lRangElement;
      lResult.genreReponse = lGenreReponse;
      lResult.texte = '';
      lResult.titre = '';
      lResult.tailleReponse = 200;
      lResult.listePiecesJointes = new ObjetListeElements();
      lResult.listeChoix = new ObjetListeElements();
      lResult.reponse = new ObjetElement();
      if (lGenreReponse === TypeGenreReponseInternetActualite.Textuelle) {
        lResult.reponse.valeurReponse = '';
      } else if (
        [
          TypeGenreReponseInternetActualite.ChoixMultiple,
          TypeGenreReponseInternetActualite.ChoixUnique,
        ].includes(lGenreReponse)
      ) {
        lResult.reponse.valeurReponse = new TypeDomaine();
      }
      lResult.reponse.avecReponse = false;
      return lResult;
    };
    TUtilitaireInformations.getDate = function () {
      return (
        GTraductions.getValeur('Du') +
        GDate.formatDate(this.dateDebut, ' %JJ/%MM/%AAAA ') +
        GTraductions.getValeur('Au') +
        GDate.formatDate(this.dateFin, ' %JJ/%MM/%AAAA')
      );
    };
    TUtilitaireInformations.avecReponse = function () {
      let lResult = false;
      for (let i = 0; i < this.listeQuestions.count() && !lResult; i++) {
        const lQuestion = this.listeQuestions.get(i);
        lResult =
          lQuestion.reponse.avecReponse ||
          lQuestion.genreReponse === TypeGenreReponseInternetActualite.SansAR;
      }
      return lResult;
    };
    TUtilitaireInformations.aToutRepondu = function () {
      let lResult = true;
      for (let i = 0; i < this.listeQuestions.count() && lResult; i++) {
        const lQuestion = this.listeQuestions.get(i);
        lResult =
          lQuestion.reponse.avecReponse ||
          [
            TypeGenreReponseInternetActualite.SansAR,
            TypeGenreReponseInternetActualite.SansReponse,
          ].includes(lQuestion.genreReponse);
      }
      return lResult;
    };
    function _copierQuestions(aListeQuestions) {
      const lResult = new ObjetListeElements();
      for (let i = 0; i < aListeQuestions.count(); i++) {
        if (aListeQuestions.existe(i)) {
          const lElement = _copieQuestion(aListeQuestions.get(i));
          lElement.setEtat(EGenreEtat.Creation);
          lResult.addElement(lElement);
        }
      }
      return lResult;
    }
    function _copieQuestion(aQuestion) {
      const lNouvelleQuestion =
        TUtilitaireInformations.creerQuestionOuTexteSondage(aQuestion);
      lNouvelleQuestion.setLibelle(aQuestion.getLibelle());
      lNouvelleQuestion.rang = aQuestion.rang;
      lNouvelleQuestion.indice = aQuestion.indice;
      lNouvelleQuestion.genreReponse = aQuestion.genreReponse;
      lNouvelleQuestion.texte = aQuestion.texte;
      lNouvelleQuestion.tailleReponse = aQuestion.tailleReponse;
      lNouvelleQuestion.listePiecesJointes = _copierDocuments(
        aQuestion.listePiecesJointes,
      );
      lNouvelleQuestion.listeChoix = _copierChoixReponses(aQuestion.listeChoix);
      lNouvelleQuestion.avecMaximum = aQuestion.avecMaximum;
      lNouvelleQuestion.titre = aQuestion.titre;
      return lNouvelleQuestion;
    }
    function _copierDocuments(aListeDocuments) {
      const lResult = MethodesObjet.dupliquer(aListeDocuments);
      for (let i = 0; i < lResult.count(); i++) {
        if (lResult.existe(i)) {
          const lElement = lResult.get(i);
          lElement.setEtat(EGenreEtat.Creation);
        }
      }
      return lResult;
    }
    function _copierChoixReponses(aListeChoix) {
      const lResult = new ObjetListeElements();
      for (let i = 0; i < aListeChoix.count(); i++) {
        if (aListeChoix.existe(i)) {
          const lElement = aListeChoix.get(i);
          const lChoix = new ObjetElement(lElement.getLibelle());
          lChoix.rang = lElement.rang;
          lChoix.setEtat(EGenreEtat.Creation);
          if (
            lElement.estReponseLibre !== null &&
            lElement.estReponseLibre !== undefined
          ) {
            lChoix.estReponseLibre = lElement.estReponseLibre;
          }
          lResult.addElement(lChoix);
        }
      }
      return lResult;
    }
    TUtilitaireInformations.getIDReponse = function (aParams) {
      return aParams.instance.Nom + '_reponse_' + aParams.indice;
    };
    TUtilitaireInformations.composeReponse = function (aParams) {
      const H = [];
      if (aParams.avecLibelleQuestion) {
        H.push(
          '<div class="Actu_Question" style="padding: 2px 0px;">',
          aParams.question.genreReponse !==
            TypeGenreReponseInternetActualite.SansReponse
            ? aParams.question.getLibelle()
            : '',
          '</div>',
        );
      }
      const lIdReponse = TUtilitaireInformations.getIDReponse(aParams);
      if (
        aParams.question.genreReponse ===
          TypeGenreReponseInternetActualite.ChoixMultiple &&
        aParams.question.avecMaximum
      ) {
        H.push(
          '<div style="padding: 2px 0px 1px 0px;">',
          GTraductions.getValeur('actualites.Edition.NbrMaxChoix', [
            aParams.question.nombreReponsesMax,
          ]),
          '</div>',
        );
      }
      H.push(
        '<div id="titre_',
        lIdReponse,
        '" class="AvecSelectionTexte" style="padding: 2px 0px 1px 0px;">',
        aParams.question.texte,
        '</div>',
      );
      H.push('<div id="', lIdReponse, '" class="PetitEspaceBas">');
      let lSurKeyUp = '';
      let lSurSaisie = '';
      switch (aParams.question.genreReponse) {
        case TypeGenreReponseInternetActualite.AvecAR:
          lSurKeyUp =
            aParams.instance.Nom + '.surKeyUpReponse (' + aParams.indice + ');';
          lSurSaisie =
            aParams.instance.Nom + '.surSaisieReponse(' + aParams.indice + ');';
          H.push('<div class="Actu_AR">');
          if (aParams.question.reponse.estRepondant === false) {
            H.push(
              GTraductions.getValeur('actualites.XAPrisConnaissanceLeX', [
                aParams.question.reponse.strRepondant,
                GDate.formatDate(
                  aParams.question.reponse.reponduLe,
                  '%JJ/%MM/%AAAA',
                ),
              ]),
            );
          } else {
            H.push(
              '<ie-checkbox tabindex="-1" id="',
              lIdReponse,
              '_0" class="',
              this._classActualiteSaisieDirect,
              '" ',
              GObjetWAI.composeAttribut({
                genre: EGenreAttribut.label,
                valeur: GTraductions.getValeur('accueil.prisConnaissance'),
              }),
              'onclick="',
              lSurSaisie,
              '"',
              'onkeyup=" ',
              lSurKeyUp,
              '"',
              aParams.question.reponse.avecReponse
                ? ' checked="checked" disabled'
                : aParams.estAffEditionActualite
                  ? ' disabled'
                  : '',
              '><label class="EspaceGauche" for="',
              lIdReponse,
              '">',
              GTraductions.getValeur('accueil.prisConnaissance'),
              '</label></ie-checkbox>',
            );
          }
          H.push('</div>');
          break;
        case TypeGenreReponseInternetActualite.Textuelle:
          lSurSaisie =
            aParams.instance.Nom +
            '.surSaisieReponse (' +
            aParams.indice +
            ',value);';
          H.push(
            '<div style="padding:1px 1px;"><textarea maxlength="0" tabindex="-1" id="',
            lIdReponse,
            '_0" class="Texte10" style="width: 100%; overflow : hidden; ',
            GStyle.composeCouleurBordure(GCouleur.grisClair),
            '" rows="3" ',
            GObjetWAI.composeAttribut({
              genre: EGenreAttribut.label,
              valeur: GTraductions.getValeur('accueil.saisirReponse'),
            }),
            'onkeyup="',
            lSurSaisie,
            '" maxlength="' +
              aParams.question.tailleReponse +
              '" placeholder="',
            GTraductions.getValeur('actualites.SaisirReponse'),
            '"',
            aParams.estAffEditionActualite ? ' disabled' : '',
            '>',
            aParams.question.reponse.valeurReponse,
            '</textarea></div>',
          );
          break;
        case TypeGenreReponseInternetActualite.ChoixUnique:
        case TypeGenreReponseInternetActualite.ChoixMultiple: {
          const lNombreCoche =
            aParams.question &&
            aParams.question.reponse &&
            aParams.question.reponse.valeurReponse
              ? aParams.question.reponse.valeurReponse.getNbrValeurs()
              : 0;
          for (let I = 0; I < aParams.question.listeChoix.count(); I++) {
            const lNr = I + 1;
            const lValeurReponse =
              aParams.question.reponse && aParams.question.reponse.valeurReponse
                ? aParams.question.reponse.valeurReponse.getValeur(lNr)
                : undefined;
            let lDisabled = false;
            if (
              aParams.question.genreReponse ===
                TypeGenreReponseInternetActualite.ChoixMultiple &&
              aParams.question.avecMaximum &&
              lNombreCoche >= aParams.question.nombreReponsesMax
            ) {
              lDisabled = !lValeurReponse;
            }
            const ieInput =
              aParams.question.genreReponse ===
              TypeGenreReponseInternetActualite.ChoixMultiple
                ? 'ie-checkbox'
                : 'ie-radio';
            lSurSaisie =
              aParams.instance.Nom +
              '.surSaisieReponse (' +
              aParams.indice +
              ', value, checked);';
            H.push(
              '<div class="Actu_InfoCoche NoWrap" ><',
              ieInput,
              ' class="InlineBlock AlignementMilieuVertical" id="',
              lIdReponse,
              '_',
              I,
              '" name="coches_',
              lIdReponse,
              '" ',
              GObjetWAI.composeAttribut({
                genre: EGenreAttribut.label,
                valeur: aParams.question.listeChoix.getLibelle(I),
              }),
              'onclick="',
              lSurSaisie,
              '" value="',
              lNr,
              '"' +
                (lValeurReponse ? ' checked="checked"' : '') +
                (aParams.estAffEditionActualite || lDisabled
                  ? ' disabled'
                  : '') +
                ' ></',
              ieInput,
              '><label class="EspaceGauche InlineBlock AlignementMilieuVertical" for="',
              lIdReponse,
              '_',
              I,
              '">' +
                aParams.question.listeChoix.getLibelle(I) +
                '</label></div>',
            );
          }
          break;
        }
        default:
          break;
      }
      H.push('</div>');
      if (
        aParams.question.listePiecesJointes &&
        aParams.question.listePiecesJointes.count() > 0
      ) {
        H.push(
          '<div class="PetitEspace">',
          TUtilitaireInformations.composeDocuments(
            aParams.question.listePiecesJointes,
          ),
          '</div>',
        );
      }
      return H.join('');
    };
    TUtilitaireInformations.composeDocuments = function (
      aListeDocumentsJoints,
    ) {
      const lHtml = [];
      for (let I = 0; I < aListeDocumentsJoints.count(); I++) {
        const lDocumentJoint = aListeDocumentsJoints.get(I);
        lHtml.push(
          GChaine.composerUrlLienExterne({
            documentJoint: lDocumentJoint,
            genreRessource: EGenreRessource.DocJointEtablissement,
          }),
        );
      }
      return lHtml.join('<br/>');
    };
    TUtilitaireInformations.initListePeriodes = function () {
      return TUtilitaireListePeriodes.construireListePeriodes([
        TUtilitaireListePeriodes.choix.aujourdhui,
        TUtilitaireListePeriodes.choix.semaineCourante,
        TUtilitaireListePeriodes.choix.moisCourant,
        TUtilitaireListePeriodes.choix.annee,
        TUtilitaireListePeriodes.choix.periodes,
        TUtilitaireListePeriodes.choix.mois,
      ]);
    };
    TUtilitaireInformations.avecCumul = function (aListe) {
      if (
        [
          EGenreEspace.Parent,
          EGenreEspace.Mobile_Parent,
          EGenreEspace.Entreprise,
        ].includes(GEtatUtilisateur.GenreEspace)
      ) {
        if (GEtatUtilisateur.Identification.ListeRessources.count() > 1) {
          return true;
        } else {
          const lGenre =
            GEtatUtilisateur.GenreEspace === EGenreEspace.Entreprise
              ? EGenreRessource.MaitreDeStage
              : EGenreRessource.Responsable;
          return (
            aListe.getIndiceElementParFiltre((aElement) => {
              return (
                aElement.public.getNumero() ===
                  GEtatUtilisateur.getUtilisateur().getNumero() &&
                aElement.public.getNumero() === lGenre
              );
            }) > -1
          );
        }
      } else {
        return false;
      }
    };
    TUtilitaireInformations.avecInfoPublic = function (aActualite) {
      if (
        [
          EGenreEspace.Parent,
          EGenreEspace.Mobile_Parent,
          EGenreEspace.Entreprise,
          EGenreEspace.PrimParent,
          EGenreEspace.Mobile_PrimParent,
        ].includes(GEtatUtilisateur.GenreEspace)
      ) {
        const lGenre =
          GEtatUtilisateur.GenreEspace === EGenreEspace.Entreprise
            ? EGenreRessource.MaitreDeStage
            : EGenreRessource.Responsable;
        const lEstActuDUtilisateur =
          aActualite.public.getNumero() ===
            GEtatUtilisateur.getUtilisateur().getNumero() &&
          aActualite.public.getGenre() === lGenre;
        return !lEstActuDUtilisateur;
      } else {
        return false;
      }
    };
    TUtilitaireInformations.formaterListePourCumul = function (aListe) {
      for (let I = 0; I < aListe.count(); I++) {
        const lElement = aListe.get(I);
        if (lElement.public) {
          let lCumulPere = aListe.getElementParNumeroEtGenre(
            lElement.public.getNumero(),
            lElement.public.getGenre(),
          );
          if (!lCumulPere) {
            const lGenre =
              GEtatUtilisateur.GenreEspace === EGenreEspace.Entreprise
                ? EGenreRessource.MaitreDeStage
                : EGenreRessource.Responsable;
            const lATitreIndividuel =
              lElement.public.getNumero() ===
                GEtatUtilisateur.getUtilisateur().getNumero() &&
              lElement.public.getGenre() === lGenre;
            const lLibelle = lATitreIndividuel
              ? GTraductions.getValeur('actualites.ATitreIndividuel')
              : GTraductions.getValeur('actualites.AProposDe', [
                  lElement.public.prenom &&
                  GEtatUtilisateur.GenreEspace !== EGenreEspace.Entreprise
                    ? lElement.public.prenom
                    : lElement.public.getLibelle(),
                ]);
            lCumulPere = new ObjetElement(
              lLibelle,
              lElement.public.getNumero(),
              lElement.public.getGenre(),
            );
            lCumulPere.estUnDeploiement = true;
            lCumulPere.estDeploye = true;
            lCumulPere.aTitreIndividuel = lATitreIndividuel;
            aListe.addElement(lCumulPere);
          }
          lElement.pere = lCumulPere;
        }
      }
      aListe.setTri(
        ObjetTri.initRecursif('pere', [
          ObjetTri.init('aTitreIndividuel'),
          ObjetTri.init((D) => {
            return D.estUnDeploiement ? D.getLibelle() : D.pere.getLibelle();
          }),
          ObjetTri.init((D) => {
            return D.dateDebut;
          }, EGenreTriElement.Decroissant),
          ObjetTri.init((D) => {
            return D.dateFin;
          }),
          ObjetTri.init('Libelle'),
          ObjetTri.init('Numero'),
        ]),
      );
      aListe.trier();
    };
    module.exports = { TUtilitaireInformations };
  },
  fn: 'utilitaireinformations.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreOnglet = void 0;
    var EGenreOnglet;
    (function (EGenreOnglet) {
      EGenreOnglet[(EGenreOnglet['MenuOnglets'] = -2)] = 'MenuOnglets';
      EGenreOnglet[(EGenreOnglet['GeneralAccueil'] = -1)] = 'GeneralAccueil';
      EGenreOnglet[(EGenreOnglet['GeneralRacine'] = 0)] = 'GeneralRacine';
      EGenreOnglet[(EGenreOnglet['GeneralVieEtablissement'] = 2)] =
        'GeneralVieEtablissement';
      EGenreOnglet[(EGenreOnglet['GeneralNotes'] = 3)] = 'GeneralNotes';
      EGenreOnglet[(EGenreOnglet['GeneralBulletins'] = 4)] = 'GeneralBulletins';
      EGenreOnglet[(EGenreOnglet['GeneralVieScolaire'] = 5)] =
        'GeneralVieScolaire';
      EGenreOnglet[(EGenreOnglet['GeneralCompte'] = 6)] = 'GeneralCompte';
      EGenreOnglet[(EGenreOnglet['Accueil'] = 7)] = 'Accueil';
      EGenreOnglet[(EGenreOnglet['Informations'] = 8)] = 'Informations';
      EGenreOnglet[(EGenreOnglet['Agenda'] = 9)] = 'Agenda';
      EGenreOnglet[(EGenreOnglet['Menus'] = 10)] = 'Menus';
      EGenreOnglet[(EGenreOnglet['Vacances'] = 11)] = 'Vacances';
      EGenreOnglet[(EGenreOnglet['Releve'] = 12)] = 'Releve';
      EGenreOnglet[(EGenreOnglet['Bulletins'] = 13)] = 'Bulletins';
      EGenreOnglet[(EGenreOnglet['Orientation'] = 14)] = 'Orientation';
      EGenreOnglet[(EGenreOnglet['SaisieOrientation'] = 15)] =
        'SaisieOrientation';
      EGenreOnglet[(EGenreOnglet['EmploiDuTemps'] = 16)] = 'EmploiDuTemps';
      EGenreOnglet[(EGenreOnglet['CahierDeTexte'] = 17)] = 'CahierDeTexte';
      EGenreOnglet[(EGenreOnglet['Remplacements'] = 18)] = 'Remplacements';
      EGenreOnglet[(EGenreOnglet['VieScolaire_Recapitulatif'] = 19)] =
        'VieScolaire_Recapitulatif';
      EGenreOnglet[(EGenreOnglet['Dossiers'] = 20)] = 'Dossiers';
      EGenreOnglet[(EGenreOnglet['Compte'] = 21)] = 'Compte';
      EGenreOnglet[(EGenreOnglet['CompteEleve'] = 22)] = 'CompteEleve';
      EGenreOnglet[(EGenreOnglet['SaisieNotes'] = 23)] = 'SaisieNotes';
      EGenreOnglet[(EGenreOnglet['DEV_AppelEtSuivi'] = 24)] =
        'DEV_AppelEtSuivi';
      EGenreOnglet[(EGenreOnglet['SaisieAppreciationsBulletin'] = 25)] =
        'SaisieAppreciationsBulletin';
      EGenreOnglet[(EGenreOnglet['SaisieAppreciationsBulletinGroupe'] = 26)] =
        'SaisieAppreciationsBulletinGroupe';
      EGenreOnglet[(EGenreOnglet['SaisieAppreciationsGenerales'] = 27)] =
        'SaisieAppreciationsGenerales';
      EGenreOnglet[(EGenreOnglet['SaisieCahierDeTextes'] = 28)] =
        'SaisieCahierDeTextes';
      EGenreOnglet[(EGenreOnglet['SaisieAbsences'] = 29)] = 'SaisieAbsences';
      EGenreOnglet[(EGenreOnglet['SaisieAppreciationsReleve'] = 30)] =
        'SaisieAppreciationsReleve';
      EGenreOnglet[(EGenreOnglet['SaisieAppreciationsReleve_Gpe'] = 31)] =
        'SaisieAppreciationsReleve_Gpe';
      EGenreOnglet[(EGenreOnglet['FicheBrevet'] = 34)] = 'FicheBrevet';
      EGenreOnglet[(EGenreOnglet['CompteGadget'] = 35)] = 'CompteGadget';
      EGenreOnglet[(EGenreOnglet['InfoMedicale'] = 36)] = 'InfoMedicale';
      EGenreOnglet[(EGenreOnglet['EquipePedagogique'] = 37)] =
        'EquipePedagogique';
      EGenreOnglet[(EGenreOnglet['Graphique'] = 38)] = 'Graphique';
      EGenreOnglet[(EGenreOnglet['GeneralResultats'] = 39)] =
        'GeneralResultats';
      EGenreOnglet[(EGenreOnglet['GeneralOrientations'] = 40)] =
        'GeneralOrientations';
      EGenreOnglet[(EGenreOnglet['ConseilDeClasse'] = 41)] = 'ConseilDeClasse';
      EGenreOnglet[(EGenreOnglet['SaisieAppreciationDeFinDeStage'] = 42)] =
        'SaisieAppreciationDeFinDeStage';
      EGenreOnglet[(EGenreOnglet['GeneralDansLaClasse'] = 43)] =
        'GeneralDansLaClasse';
      EGenreOnglet[(EGenreOnglet['SuiviPluriannuel'] = 44)] =
        'SuiviPluriannuel';
      EGenreOnglet[(EGenreOnglet['BilanParDomaine'] = 45)] = 'BilanParDomaine';
      EGenreOnglet[(EGenreOnglet['CahierDeTextes_Contenu'] = 47)] =
        'CahierDeTextes_Contenu';
      EGenreOnglet[(EGenreOnglet['CahierDeTextes_TravailAFaire'] = 48)] =
        'CahierDeTextes_TravailAFaire';
      EGenreOnglet[(EGenreOnglet['InfosPerso'] = 49)] = 'InfosPerso';
      EGenreOnglet[(EGenreOnglet['GeneralStage'] = 52)] = 'GeneralStage';
      EGenreOnglet[(EGenreOnglet['SaisieAppreciationsFicheBrevet'] = 53)] =
        'SaisieAppreciationsFicheBrevet';
      EGenreOnglet[(EGenreOnglet['GeneralCompetence'] = 55)] =
        'GeneralCompetence';
      EGenreOnglet[(EGenreOnglet['Evaluation'] = 56)] = 'Evaluation';
      EGenreOnglet[(EGenreOnglet['GeneralBrevet'] = 57)] = 'GeneralBrevet';
      EGenreOnglet[(EGenreOnglet['GeneralEquipePedagogique'] = 58)] =
        'GeneralEquipePedagogique';
      EGenreOnglet[(EGenreOnglet['GeneralMesClasses'] = 59)] =
        'GeneralMesClasses';
      EGenreOnglet[(EGenreOnglet['EmploiDuTempsClasse'] = 60)] =
        'EmploiDuTempsClasse';
      EGenreOnglet[(EGenreOnglet['General_CahierDeTextes'] = 61)] =
        'General_CahierDeTextes';
      EGenreOnglet[(EGenreOnglet['CahierDeTextesClasse'] = 62)] =
        'CahierDeTextesClasse';
      EGenreOnglet[(EGenreOnglet['ResultatsClasses'] = 64)] =
        'ResultatsClasses';
      EGenreOnglet[(EGenreOnglet['ListeEvaluation'] = 65)] = 'ListeEvaluation';
      EGenreOnglet[(EGenreOnglet['ListeEvaluationHistorique'] = 67)] =
        'ListeEvaluationHistorique';
      EGenreOnglet[(EGenreOnglet['Punitions'] = 68)] = 'Punitions';
      EGenreOnglet[(EGenreOnglet['Entreprise'] = 69)] = 'Entreprise';
      EGenreOnglet[(EGenreOnglet['CahierDeTexte_Progression'] = 71)] =
        'CahierDeTexte_Progression';
      EGenreOnglet[(EGenreOnglet['Dispenses'] = 72)] = 'Dispenses';
      EGenreOnglet[(EGenreOnglet['AbsencesEtRetards'] = 73)] =
        'AbsencesEtRetards';
      EGenreOnglet[(EGenreOnglet['SuivisAbsenceRetard'] = 74)] =
        'SuivisAbsenceRetard';
      EGenreOnglet[(EGenreOnglet['Affectation_Progression'] = 75)] =
        'Affectation_Progression';
      EGenreOnglet[(EGenreOnglet['RecapitulatifAbsences'] = 76)] =
        'RecapitulatifAbsences';
      EGenreOnglet[(EGenreOnglet['TrombinoscopeClasse'] = 77)] =
        'TrombinoscopeClasse';
      EGenreOnglet[(EGenreOnglet['Saisie_CarnetCorrespondance'] = 78)] =
        'Saisie_CarnetCorrespondance';
      EGenreOnglet[(EGenreOnglet['IManuels'] = 79)] = 'IManuels';
      EGenreOnglet[(EGenreOnglet['EmploiDuTempsSalle'] = 81)] =
        'EmploiDuTempsSalle';
      EGenreOnglet[(EGenreOnglet['Trombinoscope'] = 82)] = 'Trombinoscope';
      EGenreOnglet[(EGenreOnglet['LivretScolaire_Fiche'] = 83)] =
        'LivretScolaire_Fiche';
      EGenreOnglet[(EGenreOnglet['QCM'] = 84)] = 'QCM';
      EGenreOnglet[(EGenreOnglet['QCM_Saisie'] = 85)] = 'QCM_Saisie';
      EGenreOnglet[(EGenreOnglet['QCM_Bibliotheque'] = 86)] =
        'QCM_Bibliotheque';
      EGenreOnglet[(EGenreOnglet['QCM_Reponse'] = 87)] = 'QCM_Reponse';
      EGenreOnglet[(EGenreOnglet['CDT_TAF'] = 88)] = 'CDT_TAF';
      EGenreOnglet[(EGenreOnglet['CDT_Contenu'] = 89)] = 'CDT_Contenu';
      EGenreOnglet[(EGenreOnglet['Rencontre'] = 90)] = 'Rencontre';
      EGenreOnglet[(EGenreOnglet['Rencontre_Indisponibilites'] = 91)] =
        'Rencontre_Indisponibilites';
      EGenreOnglet[(EGenreOnglet['Rencontre_Desideratas'] = 92)] =
        'Rencontre_Desideratas';
      EGenreOnglet[(EGenreOnglet['CreneauxLibres'] = 93)] = 'CreneauxLibres';
      EGenreOnglet[(EGenreOnglet['General_Rencontre_Planning'] = 94)] =
        'General_Rencontre_Planning';
      EGenreOnglet[(EGenreOnglet['QCM_BibliothequeNathan'] = 96)] =
        'QCM_BibliothequeNathan';
      EGenreOnglet[(EGenreOnglet['EmploiDuTempsProfesseur'] = 97)] =
        'EmploiDuTempsProfesseur';
      EGenreOnglet[(EGenreOnglet['SaisieOffresStage'] = 98)] =
        'SaisieOffresStage';
      EGenreOnglet[(EGenreOnglet['RessourcePedagogique'] = 99)] =
        'RessourcePedagogique';
      EGenreOnglet[(EGenreOnglet['BulletinCompetences'] = 100)] =
        'BulletinCompetences';
      EGenreOnglet[(EGenreOnglet['OffresStage'] = 101)] = 'OffresStage';
      EGenreOnglet[(EGenreOnglet['Casier'] = 102)] = 'Casier';
      EGenreOnglet[(EGenreOnglet['Casier_Documents'] = 103)] =
        'Casier_Documents';
      EGenreOnglet[(EGenreOnglet['Casier_MonCasier'] = 104)] =
        'Casier_MonCasier';
      EGenreOnglet[(EGenreOnglet['ListeEleves'] = 105)] = 'ListeEleves';
      EGenreOnglet[(EGenreOnglet['Genral_Classes'] = 106)] = 'Genral_Classes';
      EGenreOnglet[(EGenreOnglet['General_Salles'] = 107)] = 'General_Salles';
      EGenreOnglet[(EGenreOnglet['LivretScolaire'] = 108)] = 'LivretScolaire';
      EGenreOnglet[(EGenreOnglet['LivretScolaire_Appreciations'] = 109)] =
        'LivretScolaire_Appreciations';
      EGenreOnglet[(EGenreOnglet['LivretScolaire_Competences'] = 110)] =
        'LivretScolaire_Competences';
      EGenreOnglet[(EGenreOnglet['Graphique_Profil'] = 111)] =
        'Graphique_Profil';
      EGenreOnglet[(EGenreOnglet['Graphique_Evolution'] = 112)] =
        'Graphique_Evolution';
      EGenreOnglet[(EGenreOnglet['SaisieAbsences_AppelEtSuivi'] = 113)] =
        'SaisieAbsences_AppelEtSuivi';
      EGenreOnglet[(EGenreOnglet['SaisieAbsences_Appel'] = 114)] =
        'SaisieAbsences_Appel';
      EGenreOnglet[(EGenreOnglet['Remplacements_Grille'] = 118)] =
        'Remplacements_Grille';
      EGenreOnglet[(EGenreOnglet['Remplacements_Tableau'] = 119)] =
        'Remplacements_Tableau';
      EGenreOnglet[(EGenreOnglet['Rencontre_Planning_Liste'] = 120)] =
        'Rencontre_Planning_Liste';
      EGenreOnglet[(EGenreOnglet['Rencontre_Planning_Grille'] = 121)] =
        'Rencontre_Planning_Grille';
      EGenreOnglet[(EGenreOnglet['GeneralReleveDeNotes'] = 122)] =
        'GeneralReleveDeNotes';
      EGenreOnglet[(EGenreOnglet['ListeProfesseurs'] = 123)] =
        'ListeProfesseurs';
      EGenreOnglet[(EGenreOnglet['ListeClasses'] = 124)] = 'ListeClasses';
      EGenreOnglet[(EGenreOnglet['ListeGroupes'] = 125)] = 'ListeGroupes';
      EGenreOnglet[(EGenreOnglet['ListeResponsables'] = 126)] =
        'ListeResponsables';
      EGenreOnglet[(EGenreOnglet['ListePersonnels'] = 127)] = 'ListePersonnels';
      EGenreOnglet[(EGenreOnglet['Genral_Eleves'] = 128)] = 'Genral_Eleves';
      EGenreOnglet[(EGenreOnglet['General_Professeurs'] = 129)] =
        'General_Professeurs';
      EGenreOnglet[(EGenreOnglet['EmploiDuTempsEleve'] = 130)] =
        'EmploiDuTempsEleve';
      EGenreOnglet[(EGenreOnglet['Messagerie'] = 131)] = 'Messagerie';
      EGenreOnglet[(EGenreOnglet['General_Messagerie'] = 132)] =
        'General_Messagerie';
      EGenreOnglet[
        (EGenreOnglet['EmploiDuTempsPersonnelEtablissement'] = 134)
      ] = 'EmploiDuTempsPersonnelEtablissement';
      EGenreOnglet[(EGenreOnglet['Incidents'] = 135)] = 'Incidents';
      EGenreOnglet[(EGenreOnglet['SaisieAbsences_Appel_Professeur'] = 136)] =
        'SaisieAbsences_Appel_Professeur';
      EGenreOnglet[(EGenreOnglet['AutorisationSortie'] = 137)] =
        'AutorisationSortie';
      EGenreOnglet[(EGenreOnglet['RecapAbsences'] = 138)] = 'RecapAbsences';
      EGenreOnglet[(EGenreOnglet['RecapFeuilleAppel'] = 139)] =
        'RecapFeuilleAppel';
      EGenreOnglet[(EGenreOnglet['RecapPunitions'] = 140)] = 'RecapPunitions';
      EGenreOnglet[(EGenreOnglet['ProgrammesBO'] = 141)] = 'ProgrammesBO';
      EGenreOnglet[(EGenreOnglet['Trombinoscope_Professeur'] = 142)] =
        'Trombinoscope_Professeur';
      EGenreOnglet[(EGenreOnglet['Trombinoscope_Personnel'] = 143)] =
        'Trombinoscope_Personnel';
      EGenreOnglet[(EGenreOnglet['ParametresUtilisateur'] = 144)] =
        'ParametresUtilisateur';
      EGenreOnglet[(EGenreOnglet['ListeStagiaires'] = 145)] = 'ListeStagiaires';
      EGenreOnglet[(EGenreOnglet['CoursNonAssures'] = 146)] = 'CoursNonAssures';
      EGenreOnglet[(EGenreOnglet['General_Personnels'] = 147)] =
        'General_Personnels';
      EGenreOnglet[(EGenreOnglet['DocumentsATelecharger'] = 148)] =
        'DocumentsATelecharger';
      EGenreOnglet[(EGenreOnglet['General_Progression'] = 149)] =
        'General_Progression';
      EGenreOnglet[(EGenreOnglet['BibliothequeProgression'] = 150)] =
        'BibliothequeProgression';
      EGenreOnglet[(EGenreOnglet['General_CahierDeTextes_Saisie'] = 151)] =
        'General_CahierDeTextes_Saisie';
      EGenreOnglet[
        (EGenreOnglet['General_CahierDeTextes_Consultation'] = 152)
      ] = 'General_CahierDeTextes_Consultation';
      EGenreOnglet[(EGenreOnglet['General_Documentation'] = 153)] =
        'General_Documentation';
      EGenreOnglet[(EGenreOnglet['ListeDevoirSurTable'] = 154)] =
        'ListeDevoirSurTable';
      EGenreOnglet[(EGenreOnglet['AbsencesGrille'] = 155)] = 'AbsencesGrille';
      EGenreOnglet[(EGenreOnglet['General_Materiels'] = 156)] =
        'General_Materiels';
      EGenreOnglet[(EGenreOnglet['EmploiDuTempsMateriel'] = 157)] =
        'EmploiDuTempsMateriel';
      EGenreOnglet[(EGenreOnglet['ListeDiffusion'] = 158)] = 'ListeDiffusion';
      EGenreOnglet[(EGenreOnglet['RecapitulatifScolarite'] = 161)] =
        'RecapitulatifScolarite';
      EGenreOnglet[(EGenreOnglet['PlanningParSemaine'] = 162)] =
        'PlanningParSemaine';
      EGenreOnglet[(EGenreOnglet['PlanningParSemaine_Professeur'] = 163)] =
        'PlanningParSemaine_Professeur';
      EGenreOnglet[(EGenreOnglet['PlanningParSemaine_Eleve'] = 164)] =
        'PlanningParSemaine_Eleve';
      EGenreOnglet[(EGenreOnglet['PlanningParSemaine_Classe'] = 165)] =
        'PlanningParSemaine_Classe';
      EGenreOnglet[(EGenreOnglet['PlanningParSemaine_Salle'] = 166)] =
        'PlanningParSemaine_Salle';
      EGenreOnglet[
        (EGenreOnglet['PlanningParSemaine_PersonnelEtablissement'] = 167)
      ] = 'PlanningParSemaine_PersonnelEtablissement';
      EGenreOnglet[(EGenreOnglet['PlanningParSemaine_Materiel'] = 168)] =
        'PlanningParSemaine_Materiel';
      EGenreOnglet[(EGenreOnglet['PlanningParRessource_Professeur'] = 169)] =
        'PlanningParRessource_Professeur';
      EGenreOnglet[(EGenreOnglet['PlanningParRessource_Eleve'] = 170)] =
        'PlanningParRessource_Eleve';
      EGenreOnglet[(EGenreOnglet['PlanningParRessource_Classe'] = 171)] =
        'PlanningParRessource_Classe';
      EGenreOnglet[(EGenreOnglet['PlanningParRessource_Salle'] = 172)] =
        'PlanningParRessource_Salle';
      EGenreOnglet[
        (EGenreOnglet['PlanningParRessource_PersonnelEtablissement'] = 173)
      ] = 'PlanningParRessource_PersonnelEtablissement';
      EGenreOnglet[(EGenreOnglet['PlanningParRessource_Materiel'] = 174)] =
        'PlanningParRessource_Materiel';
      EGenreOnglet[(EGenreOnglet['General_Intendance'] = 175)] =
        'General_Intendance';
      EGenreOnglet[(EGenreOnglet['Intendance_SaisieDemandesTravaux'] = 176)] =
        'Intendance_SaisieDemandesTravaux';
      EGenreOnglet[(EGenreOnglet['RessourcePedagogique_Partage'] = 177)] =
        'RessourcePedagogique_Partage';
      EGenreOnglet[(EGenreOnglet['BilanFinDeCycle'] = 178)] = 'BilanFinDeCycle';
      EGenreOnglet[(EGenreOnglet['Trombinoscope_EquipePedagogique'] = 179)] =
        'Trombinoscope_EquipePedagogique';
      EGenreOnglet[(EGenreOnglet['ParcoursEducatif_Bulletin'] = 180)] =
        'ParcoursEducatif_Bulletin';
      EGenreOnglet[(EGenreOnglet['ParcoursEducatif_BullCompetence'] = 181)] =
        'ParcoursEducatif_BullCompetence';
      EGenreOnglet[
        (EGenreOnglet['General_Competences_NouveauSocleCommun'] = 182)
      ] = 'General_Competences_NouveauSocleCommun';
      EGenreOnglet[(EGenreOnglet['Saisie_Punitions'] = 192)] =
        'Saisie_Punitions';
      EGenreOnglet[(EGenreOnglet['Saisie_Dispenses'] = 193)] =
        'Saisie_Dispenses';
      EGenreOnglet[(EGenreOnglet['ListeDevoirs'] = 194)] = 'ListeDevoirs';
      EGenreOnglet[(EGenreOnglet['EvaluationAccueilStage'] = 195)] =
        'EvaluationAccueilStage';
      EGenreOnglet[(EGenreOnglet['ListeServices'] = 196)] = 'ListeServices';
      EGenreOnglet[(EGenreOnglet['RecapitulatifExportLSU'] = 197)] =
        'RecapitulatifExportLSU';
      EGenreOnglet[(EGenreOnglet['DernieresNotes'] = 198)] = 'DernieresNotes';
      EGenreOnglet[(EGenreOnglet['Competences_GrillesParDomaine'] = 199)] =
        'Competences_GrillesParDomaine';
      EGenreOnglet[(EGenreOnglet['Competences_GrillesParMatiere'] = 200)] =
        'Competences_GrillesParMatiere';
      EGenreOnglet[(EGenreOnglet['DernieresEvaluations'] = 201)] =
        'DernieresEvaluations';
      EGenreOnglet[(EGenreOnglet['ReleveEvaluationsParService'] = 202)] =
        'ReleveEvaluationsParService';
      EGenreOnglet[(EGenreOnglet['General_Competences_Grilles'] = 203)] =
        'General_Competences_Grilles';
      EGenreOnglet[(EGenreOnglet['General_Competences_Evaluation'] = 204)] =
        'General_Competences_Evaluation';
      EGenreOnglet[
        (EGenreOnglet['General_Competences_BilanPeriodique'] = 205)
      ] = 'General_Competences_BilanPeriodique';
      EGenreOnglet[
        (EGenreOnglet['General_Competences_BilanFinDeCycle'] = 206)
      ] = 'General_Competences_BilanFinDeCycle';
      EGenreOnglet[(EGenreOnglet['General_MonEmploiDuTemps'] = 207)] =
        'General_MonEmploiDuTemps';
      EGenreOnglet[(EGenreOnglet['General_MesEleves'] = 208)] =
        'General_MesEleves';
      EGenreOnglet[(EGenreOnglet['General_MesCollegues'] = 209)] =
        'General_MesCollegues';
      EGenreOnglet[(EGenreOnglet['General_OutilsPedagogiques'] = 210)] =
        'General_OutilsPedagogiques';
      EGenreOnglet[(EGenreOnglet['General_CDT'] = 211)] = 'General_CDT';
      EGenreOnglet[(EGenreOnglet['General_VieScolaire_Recapitulatif'] = 212)] =
        'General_VieScolaire_Recapitulatif';
      EGenreOnglet[(EGenreOnglet['General_RessourcesPedagogiques'] = 214)] =
        'General_RessourcesPedagogiques';
      EGenreOnglet[(EGenreOnglet['ReleveEvaluationsParClasse'] = 215)] =
        'ReleveEvaluationsParClasse';
      EGenreOnglet[(EGenreOnglet['NiveauxDeMaitriseParMatiere'] = 216)] =
        'NiveauxDeMaitriseParMatiere';
      EGenreOnglet[(EGenreOnglet['General_BulletinsEleveClasse'] = 217)] =
        'General_BulletinsEleveClasse';
      EGenreOnglet[
        (EGenreOnglet['General_BulletinCompetencesEleveClasse'] = 218)
      ] = 'General_BulletinCompetencesEleveClasse';
      EGenreOnglet[(EGenreOnglet['BulletinCompetencesClasse'] = 219)] =
        'BulletinCompetencesClasse';
      EGenreOnglet[(EGenreOnglet['General_MesColleguesPersonnels'] = 220)] =
        'General_MesColleguesPersonnels';
      EGenreOnglet[(EGenreOnglet['General_ProceduresDisciplinaires'] = 221)] =
        'General_ProceduresDisciplinaires';
      EGenreOnglet[(EGenreOnglet['General_Dispenses'] = 222)] =
        'General_Dispenses';
      EGenreOnglet[(EGenreOnglet['General_Competences_BilanDomaine'] = 223)] =
        'General_Competences_BilanDomaine';
      EGenreOnglet[
        (EGenreOnglet['SaisieAppreciationsGenerales_Competences'] = 224)
      ] = 'SaisieAppreciationsGenerales_Competences';
      EGenreOnglet[(EGenreOnglet['General_Appreciations'] = 225)] =
        'General_Appreciations';
      EGenreOnglet[(EGenreOnglet['General_Appreciations_Competences'] = 226)] =
        'General_Appreciations_Competences';
      EGenreOnglet[(EGenreOnglet['BulletinAnneesPrec_Note'] = 227)] =
        'BulletinAnneesPrec_Note';
      EGenreOnglet[(EGenreOnglet['BulletinAnneesPrec_Competence'] = 228)] =
        'BulletinAnneesPrec_Competence';
      EGenreOnglet[(EGenreOnglet['ListeMatieres'] = 229)] = 'ListeMatieres';
      EGenreOnglet[(EGenreOnglet['ReleveDeCompetences'] = 230)] =
        'ReleveDeCompetences';
      EGenreOnglet[(EGenreOnglet['TableauDeBord'] = 231)] = 'TableauDeBord';
      EGenreOnglet[(EGenreOnglet['ServicesPeriscolaires'] = 232)] =
        'ServicesPeriscolaires';
      EGenreOnglet[(EGenreOnglet['Inscriptions'] = 233)] = 'Inscriptions';
      EGenreOnglet[(EGenreOnglet['EmploiDuTemps_Annuel_Classe'] = 234)] =
        'EmploiDuTemps_Annuel_Classe';
      EGenreOnglet[(EGenreOnglet['InfosEnfant_Prim'] = 235)] =
        'InfosEnfant_Prim';
      EGenreOnglet[(EGenreOnglet['General_BilanParDomaine'] = 237)] =
        'General_BilanParDomaine';
      EGenreOnglet[(EGenreOnglet['General_CahierJournal'] = 238)] =
        'General_CahierJournal';
      EGenreOnglet[(EGenreOnglet['SaisieProgressions'] = 239)] =
        'SaisieProgressions';
      EGenreOnglet[(EGenreOnglet['General_PyramideDesAges'] = 240)] =
        'General_PyramideDesAges';
      EGenreOnglet[(EGenreOnglet['PyramideDesAges_Histogramme'] = 241)] =
        'PyramideDesAges_Histogramme';
      EGenreOnglet[(EGenreOnglet['PyramideDesAges_Repartition'] = 242)] =
        'PyramideDesAges_Repartition';
      EGenreOnglet[
        (EGenreOnglet['General_CahierDeTextes_Planification'] = 243)
      ] = 'General_CahierDeTextes_Planification';
      EGenreOnglet[(EGenreOnglet['CDT_Planning'] = 244)] = 'CDT_Planning';
      EGenreOnglet[(EGenreOnglet['QCM_Collaboratif'] = 245)] =
        'QCM_Collaboratif';
      EGenreOnglet[(EGenreOnglet['AppreciationsBulletinParEleve'] = 246)] =
        'AppreciationsBulletinParEleve';
      EGenreOnglet[(EGenreOnglet['Intendance_SaisieSecretariat'] = 247)] =
        'Intendance_SaisieSecretariat';
      EGenreOnglet[
        (EGenreOnglet['Competences_GrillesCompetencesNumeriques'] = 248)
      ] = 'Competences_GrillesCompetencesNumeriques';
      EGenreOnglet[(EGenreOnglet['CompetencesNumeriques'] = 249)] =
        'CompetencesNumeriques';
      EGenreOnglet[(EGenreOnglet['ManuelsNumeriques'] = 250)] =
        'ManuelsNumeriques';
      EGenreOnglet[(EGenreOnglet['General_Blog'] = 251)] = 'General_Blog';
      EGenreOnglet[(EGenreOnglet['Blog_FilActu'] = 253)] = 'Blog_FilActu';
      EGenreOnglet[(EGenreOnglet['Blog_Mediatheque'] = 254)] =
        'Blog_Mediatheque';
      EGenreOnglet[(EGenreOnglet['SaisieTravailAFaire'] = 255)] =
        'SaisieTravailAFaire';
      EGenreOnglet[(EGenreOnglet['General_InscriptionsEtablissement'] = 256)] =
        'General_InscriptionsEtablissement';
      EGenreOnglet[(EGenreOnglet['InscriptionsEtablissement'] = 257)] =
        'InscriptionsEtablissement';
      EGenreOnglet[
        (EGenreOnglet['SaisieAbsences_AppelEtSuiviProfesseur'] = 259)
      ] = 'SaisieAbsences_AppelEtSuiviProfesseur';
      EGenreOnglet[(EGenreOnglet['SaisieAvisProfesseur'] = 260)] =
        'SaisieAvisProfesseur';
      EGenreOnglet[(EGenreOnglet['SuiviElevesTutores'] = 261)] =
        'SuiviElevesTutores';
      EGenreOnglet[(EGenreOnglet['Onglet_General_Suivi'] = 262)] =
        'Onglet_General_Suivi';
      EGenreOnglet[(EGenreOnglet['SuiviJustificationsAbsencesRetards'] = 263)] =
        'SuiviJustificationsAbsencesRetards';
      EGenreOnglet[
        (EGenreOnglet['Intendance_SaisieDemandesInformatique'] = 264)
      ] = 'Intendance_SaisieDemandesInformatique';
      EGenreOnglet[(EGenreOnglet['Intendance_SaisieCommandes'] = 265)] =
        'Intendance_SaisieCommandes';
      EGenreOnglet[(EGenreOnglet['SaisieCahierJournal'] = 266)] =
        'SaisieCahierJournal';
      EGenreOnglet[(EGenreOnglet['Onglet_General_Apprentissages'] = 267)] =
        'Onglet_General_Apprentissages';
      EGenreOnglet[(EGenreOnglet['ListeApprentissages'] = 268)] =
        'ListeApprentissages';
      EGenreOnglet[(EGenreOnglet['CarnetDeSuivi'] = 269)] = 'CarnetDeSuivi';
      EGenreOnglet[(EGenreOnglet['SyntheseAcquis'] = 270)] = 'SyntheseAcquis';
      EGenreOnglet[(EGenreOnglet['DocumentsParents'] = 271)] =
        'DocumentsParents';
      EGenreOnglet[(EGenreOnglet['RecapDevoirRendu'] = 272)] =
        'RecapDevoirRendu';
      EGenreOnglet[(EGenreOnglet['SaisieAvisParcoursup'] = 273)] =
        'SaisieAvisParcoursup';
      EGenreOnglet[(EGenreOnglet['SaisieAppelPeriScolaire'] = 274)] =
        'SaisieAppelPeriScolaire';
      EGenreOnglet[(EGenreOnglet['ForumPedagogique'] = 275)] =
        'ForumPedagogique';
      EGenreOnglet[
        (EGenreOnglet['General_Competences_SuiviCompetences'] = 276)
      ] = 'General_Competences_SuiviCompetences';
      EGenreOnglet[(EGenreOnglet['SuiviResultatsCompetences'] = 277)] =
        'SuiviResultatsCompetences';
      EGenreOnglet[(EGenreOnglet['BilanCompetencesParMatiere'] = 278)] =
        'BilanCompetencesParMatiere';
      EGenreOnglet[(EGenreOnglet['SaisieApprGeneralesReleve'] = 279)] =
        'SaisieApprGeneralesReleve';
      EGenreOnglet[(EGenreOnglet['Onglet_General_Pedagogie'] = 280)] =
        'Onglet_General_Pedagogie';
      EGenreOnglet[(EGenreOnglet['BilanAnnuelApprentissage'] = 281)] =
        'BilanAnnuelApprentissage';
      EGenreOnglet[(EGenreOnglet['General_SuiviApprentissages'] = 282)] =
        'General_SuiviApprentissages';
      EGenreOnglet[(EGenreOnglet['Commissions'] = 283)] = 'Commissions';
      EGenreOnglet[(EGenreOnglet['RDV'] = 284)] = 'RDV';
      EGenreOnglet[(EGenreOnglet['RemplacementsEnseignants'] = 285)] =
        'RemplacementsEnseignants';
      EGenreOnglet[(EGenreOnglet['SaisieAppelInternat'] = 286)] =
        'SaisieAppelInternat';
      EGenreOnglet[(EGenreOnglet['General_RemplacementsEnseignants'] = 287)] =
        'General_RemplacementsEnseignants';
    })(EGenreOnglet || (exports.EGenreOnglet = EGenreOnglet = {}));
  },
  fn: 'enumere_onglet.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeItemEnumUtil =
      exports.TypeModeAff =
      exports.TypeItemEnum =
      exports.TypeEtatPublication =
        void 0;
    var TypeEtatPublication;
    (function (TypeEtatPublication) {
      TypeEtatPublication[(TypeEtatPublication['Publiee'] = 0)] = 'Publiee';
      TypeEtatPublication[(TypeEtatPublication['PublieeFutur'] = 1)] =
        'PublieeFutur';
      TypeEtatPublication[(TypeEtatPublication['PublieePasse'] = 2)] =
        'PublieePasse';
      TypeEtatPublication[(TypeEtatPublication['Brouillon'] = 3)] = 'Brouillon';
    })(
      TypeEtatPublication ||
        (exports.TypeEtatPublication = TypeEtatPublication = {}),
    );
    var TypeItemEnum;
    (function (TypeItemEnum) {
      TypeItemEnum[(TypeItemEnum['IE_Reception'] = 0)] = 'IE_Reception';
      TypeItemEnum[(TypeItemEnum['IE_Diffusion_Tout'] = 1)] =
        'IE_Diffusion_Tout';
      TypeItemEnum[(TypeItemEnum['IE_Diffusion_Publiee'] = 2)] =
        'IE_Diffusion_Publiee';
      TypeItemEnum[(TypeItemEnum['IE_Diffusion_PublieeFutur'] = 3)] =
        'IE_Diffusion_PublieeFutur';
      TypeItemEnum[(TypeItemEnum['IE_Diffusion_PublieePasse'] = 4)] =
        'IE_Diffusion_PublieePasse';
      TypeItemEnum[(TypeItemEnum['IE_Brouillon'] = 5)] = 'IE_Brouillon';
      TypeItemEnum[(TypeItemEnum['IE_Modele_Sondage'] = 6)] =
        'IE_Modele_Sondage';
      TypeItemEnum[(TypeItemEnum['IE_Modele_Info'] = 7)] = 'IE_Modele_Info';
    })(TypeItemEnum || (exports.TypeItemEnum = TypeItemEnum = {}));
    var TypeModeAff;
    (function (TypeModeAff) {
      TypeModeAff[(TypeModeAff['MA_Reception'] = 0)] = 'MA_Reception';
      TypeModeAff[(TypeModeAff['MA_Diffusion'] = 1)] = 'MA_Diffusion';
      TypeModeAff[(TypeModeAff['MA_Brouillon'] = 2)] = 'MA_Brouillon';
      TypeModeAff[(TypeModeAff['MA_Modele'] = 3)] = 'MA_Modele';
    })(TypeModeAff || (exports.TypeModeAff = TypeModeAff = {}));
    const ObjetTraduction_1 = require('ObjetTraduction');
    const TypeItemEnumUtil = {
      getStr(aItem) {
        switch (aItem) {
          case TypeItemEnum.IE_Reception:
            return ObjetTraduction_1.GTraductions.getValeur('infoSond.recus');
          case TypeItemEnum.IE_Diffusion_Tout:
            return ObjetTraduction_1.GTraductions.getValeur(
              'infoSond.diffuses',
            );
          case TypeItemEnum.IE_Diffusion_Publiee:
            return ObjetTraduction_1.GTraductions.getValeur('infoSond.enCours');
          case TypeItemEnum.IE_Diffusion_PublieeFutur:
            return ObjetTraduction_1.GTraductions.getValeur('infoSond.aVenir');
          case TypeItemEnum.IE_Diffusion_PublieePasse:
            return ObjetTraduction_1.GTraductions.getValeur('infoSond.passes');
          case TypeItemEnum.IE_Brouillon:
            return ObjetTraduction_1.GTraductions.getValeur(
              'infoSond.brouillons',
            );
          case TypeItemEnum.IE_Modele_Sondage:
            return ObjetTraduction_1.GTraductions.getValeur(
              'infoSond.modelesSondage',
            );
          case TypeItemEnum.IE_Modele_Info:
            return ObjetTraduction_1.GTraductions.getValeur(
              'infoSond.modelesInfo',
            );
          default:
            return '';
        }
      },
      getIcon(aItem) {
        switch (aItem) {
          case TypeItemEnum.IE_Reception:
            return 'icon_inbox';
          case TypeItemEnum.IE_Diffusion_Tout:
            return 'icon_envoyer';
          case TypeItemEnum.IE_Diffusion_Publiee:
            return 'icon_info_sondage_publier mix-icon_ok';
          case TypeItemEnum.IE_Diffusion_PublieeFutur:
            return 'icon_info_sondage_publier mix-icon_edt_permanence';
          case TypeItemEnum.IE_Diffusion_PublieePasse:
            return 'icon_info_sondage_publier';
          case TypeItemEnum.IE_Brouillon:
            return 'icon_brouillon_discussion';
          case TypeItemEnum.IE_Modele_Sondage:
            return 'icon_diffuser_sondage';
          case TypeItemEnum.IE_Modele_Info:
            return 'icon_diffuser_information';
          default:
            return '';
        }
      },
      getTypeModeAffDeTypeItemEnum(aItem) {
        switch (aItem) {
          case TypeItemEnum.IE_Reception:
            return TypeModeAff.MA_Reception;
          case TypeItemEnum.IE_Diffusion_Tout:
          case TypeItemEnum.IE_Diffusion_PublieePasse:
          case TypeItemEnum.IE_Diffusion_Publiee:
          case TypeItemEnum.IE_Diffusion_PublieeFutur:
            return TypeModeAff.MA_Diffusion;
          case TypeItemEnum.IE_Brouillon:
            return TypeModeAff.MA_Brouillon;
          case TypeItemEnum.IE_Modele_Sondage:
          case TypeItemEnum.IE_Modele_Info:
            return TypeModeAff.MA_Modele;
          default:
            return null;
        }
      },
    };
    exports.TypeItemEnumUtil = TypeItemEnumUtil;
  },
  fn: 'typeetatpublication.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { GDate } = require('ObjetDate.js');
    const { GTraductions } = require('ObjetTraduction.js');
    function TUtilitaireInfoSondage() {}
    TUtilitaireInfoSondage.getDate = function () {
      return (
        GTraductions.getValeur('Du') +
        GDate.formatDate(this.dateDebut, ' %JJ/%MM/%AAAA ') +
        GTraductions.getValeur('Au') +
        GDate.formatDate(this.dateFin, ' %JJ/%MM/%AAAA')
      );
    };
    TUtilitaireInfoSondage.avecReponse = function () {
      let lResult = false;
      for (let i = 0; i < this.listeQuestions.count() && !lResult; i++) {
        const lQuestion = this.listeQuestions.get(i);
        lResult =
          lQuestion.reponse.avecReponse ||
          !lQuestion.reponse.estReponseAttendue;
      }
      return lResult;
    };
    TUtilitaireInfoSondage.aToutRepondu = function () {
      let lResult = true;
      for (let i = 0; i < this.listeQuestions.count() && lResult; i++) {
        const lQuestion = this.listeQuestions.get(i);
        lResult =
          lQuestion.reponse.avecReponse ||
          !lQuestion.reponse.estReponseAttendue;
      }
      return lResult;
    };
    module.exports = { TUtilitaireInfoSondage };
  },
  fn: 'utilitaireinfosondage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreEvntActuUtil = exports.EGenreEvntActu = void 0;
    var EGenreEvntActu;
    (function (EGenreEvntActu) {
      EGenreEvntActu[(EGenreEvntActu['SurAR'] = 1)] = 'SurAR';
      EGenreEvntActu[(EGenreEvntActu['SurValidationSondage'] = 2)] =
        'SurValidationSondage';
      EGenreEvntActu[(EGenreEvntActu['SurMenuCtxActu'] = 3)] = 'SurMenuCtxActu';
      EGenreEvntActu[(EGenreEvntActu['SurValidationModif'] = 4)] =
        'SurValidationModif';
      EGenreEvntActu[(EGenreEvntActu['SurCreationActu'] = 5)] =
        'SurCreationActu';
      EGenreEvntActu[(EGenreEvntActu['SurValidationDirecte'] = 6)] =
        'SurValidationDirecte';
      EGenreEvntActu[(EGenreEvntActu['SurDiffusionResultats'] = 7)] =
        'SurDiffusionResultats';
      EGenreEvntActu[(EGenreEvntActu['SurSelectionInfoSondage'] = 8)] =
        'SurSelectionInfoSondage';
      EGenreEvntActu[(EGenreEvntActu['SurAnnulationSondage'] = 9)] =
        'SurAnnulationSondage';
      EGenreEvntActu[(EGenreEvntActu['SurVoirResultats'] = 10)] =
        'SurVoirResultats';
      EGenreEvntActu[(EGenreEvntActu['SurMarquerVuSansAR'] = 11)] =
        'SurMarquerVuSansAR';
    })(EGenreEvntActu || (exports.EGenreEvntActu = EGenreEvntActu = {}));
    const EGenreEvntActuUtil = {
      estEvntSaisieReponse(aGenreEvntActu) {
        switch (aGenreEvntActu) {
          case EGenreEvntActu.SurValidationSondage:
          case EGenreEvntActu.SurAR:
          case EGenreEvntActu.SurValidationDirecte:
            return true;
        }
        return false;
      },
    };
    exports.EGenreEvntActuUtil = EGenreEvntActuUtil;
  },
  fn: 'egenreevntactu.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.Toast = exports.ETypeToast = void 0;
    const ObjetHtml_1 = require('ObjetHtml');
    const GUID_1 = require('GUID');
    const ObjetChaine_1 = require('ObjetChaine');
    require('Toast.css');
    var ETypeToast;
    (function (ETypeToast) {
      ETypeToast['info'] = 'info';
      ETypeToast['alerte'] = 'alerte';
      ETypeToast['succes'] = 'succes';
      ETypeToast['erreur'] = 'erreur';
      ETypeToast['message'] = 'message';
    })(ETypeToast || (exports.ETypeToast = ETypeToast = {}));
    const ETypeToastUtil = {
      getClasseCss(aType) {
        switch (aType) {
          case ETypeToast.info:
            return 'info';
          case ETypeToast.alerte:
            return 'alert';
          case ETypeToast.succes:
            return 'success';
          case ETypeToast.erreur:
            return 'error';
          case ETypeToast.message:
            return 'message';
        }
      },
      getClasseIcon(aType) {
        switch (aType) {
          case ETypeToast.info:
            return 'icon_diffuser_information';
          case ETypeToast.alerte:
            return 'icon_exclamation';
          case ETypeToast.succes:
            return 'icon_ok';
          case ETypeToast.erreur:
            return 'icon_punition';
          case ETypeToast.message:
            return 'icon_diffuser_information';
        }
      },
      getClassePosition(aType) {
        switch (aType) {
          case ETypeToast.erreur:
            return 'top';
          default:
            return IE.estMobile ? '' : 'to-right';
        }
      },
    };
    const uIdConteneurToast = GUID_1.GUID.getId();
    let uTimeoutFermeture = null;
    class Toast {
      static getHtmlToast(aParam) {
        const lClassTypeToast = ETypeToastUtil.getClasseCss(aParam.type);
        const lClassPosition = ETypeToastUtil.getClassePosition(aParam.type);
        const lIconToast =
          aParam.icon !== null && aParam.icon !== undefined
            ? aParam.icon
            : ETypeToastUtil.getClasseIcon(aParam.type);
        return IE.jsx.str(
          'div',
          { class: ['toast ', lClassTypeToast, lClassPosition, lIconToast] },
          IE.jsx.str(
            'p',
            { role: 'alert', 'aria-live': 'assertive' },
            ObjetChaine_1.GChaine.replaceRCToHTML(aParam.msg),
          ),
        );
      }
      static afficher(aParam) {
        const lParams = Object.assign(
          { msg: '', type: ETypeToast.succes, dureeAffichage: 4500 },
          aParam,
        );
        Toast.fermer();
        const lIdPere = GApplication.getIdConteneur();
        const lConteneurPere = ObjetHtml_1.GHtml.getElement(lIdPere);
        if (lConteneurPere) {
          const lConteneurToast = document.createElement('div');
          lConteneurToast.innerHTML = Toast.getHtmlToast(lParams);
          lConteneurToast.id = uIdConteneurToast;
          lConteneurPere.appendChild(lConteneurToast);
        }
        return Toast.showToast(lParams).then(() => {
          Toast.fermer();
        });
      }
      static showToast(aParam) {
        return new Promise((aResolve) => {
          const _target = $('.toast');
          _target.siblings('.toast').removeClass('shown');
          !_target.hasClass('shown')
            ? _target.addClass('shown')
            : _target.removeClass('shown');
          uTimeoutFermeture = setTimeout(() => {
            uTimeoutFermeture = null;
            _target.removeClass('shown');
            aResolve();
          }, aParam.dureeAffichage);
        });
      }
      static fermer() {
        const lIdPere = GApplication.getIdConteneur();
        const lConteneurPere = ObjetHtml_1.GHtml.getElement(lIdPere);
        if (lConteneurPere !== null && lConteneurPere !== undefined) {
          const lConteneurToast =
            ObjetHtml_1.GHtml.getElement(uIdConteneurToast);
          if (lConteneurToast) {
            lConteneurPere.removeChild(lConteneurToast);
            ObjetHtml_1.GHtml.supprimerElementDOM(uIdConteneurToast);
            if (uTimeoutFermeture) {
              clearTimeout(uTimeoutFermeture);
              uTimeoutFermeture = null;
            }
          }
        }
      }
    }
    exports.Toast = Toast;
  },
  fn: 'toast.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ETypeAffEnModeMixte = void 0;
    var ETypeAffEnModeMixte;
    (function (ETypeAffEnModeMixte) {
      ETypeAffEnModeMixte[(ETypeAffEnModeMixte['ellipsis'] = 1)] = 'ellipsis';
      ETypeAffEnModeMixte[(ETypeAffEnModeMixte['icon'] = 2)] = 'icon';
      ETypeAffEnModeMixte[(ETypeAffEnModeMixte['bouton'] = 3)] = 'bouton';
    })(
      ETypeAffEnModeMixte ||
        (exports.ETypeAffEnModeMixte = ETypeAffEnModeMixte = {}),
    );
  },
  fn: 'enumere_menuctxmodemixte.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.MoteurDestinataires = void 0;
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Toast_1 = require('Toast');
    class MoteurDestinataires {
      constructor(aParam) {
        this.utilitaires = { genreEspace: aParam.genreEspace };
      }
      controlerSurValidation(aParam) {
        const lDonnee = aParam.donnee;
        const lNbPublicEntite =
          lDonnee.listePublicEntite.getNbrElementsExistes();
        const lNbGenreEntite = lDonnee.genresPublicEntite.count();
        const lAvecIndividus =
          lDonnee.listePublicIndividu.getNbrElementsExistes() > 0 ||
          (this.utilitaires.genreEspace.estPourPrimaire() &&
            !!lDonnee.avecDirecteur);
        let lMessagePbDestinataires = null;
        if (lDonnee.publicationPageEtablissement !== true) {
          if (lNbGenreEntite > 0 && lNbPublicEntite === 0) {
            lMessagePbDestinataires = ObjetTraduction_1.GTraductions.getValeur(
              'actualites.MsgSelectionnerUneClasseGroupe',
            );
          } else if (lNbGenreEntite === 0 && lNbPublicEntite > 0) {
            lMessagePbDestinataires = ObjetTraduction_1.GTraductions.getValeur(
              'actualites.MsgSelectionnerUneEntite',
            );
          } else if (lNbPublicEntite === 0 && !lAvecIndividus) {
            lMessagePbDestinataires = ObjetTraduction_1.GTraductions.getValeur(
              'actualites.MsgAucunUnDestinataire',
            );
          }
        }
        if (lMessagePbDestinataires !== null) {
          if (IE.estMobile) {
            Toast_1.Toast.afficher({
              msg: lMessagePbDestinataires,
              type: Toast_1.ETypeToast.info,
            });
          } else {
            GApplication.getMessage().afficher({
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
              message: lMessagePbDestinataires,
            });
          }
          return false;
        } else {
          return true;
        }
      }
      avecDestinataires(aParam) {
        const lDonnee = aParam.donnee;
        return (
          (lDonnee.listePublicEntite !== null &&
            lDonnee.listePublicEntite !== undefined &&
            lDonnee.listePublicEntite.getNbrElementsExistes() > 0 &&
            lDonnee.genresPublicEntite !== null &&
            lDonnee.genresPublicEntite !== undefined &&
            lDonnee.genresPublicEntite.count() > 0) ||
          (lDonnee.listePublicIndividu !== null &&
            lDonnee.listePublicIndividu !== undefined &&
            lDonnee.listePublicIndividu.getNbrElementsExistes() > 0) ||
          !!lDonnee.avecDirecteur
        );
      }
    }
    exports.MoteurDestinataires = MoteurDestinataires;
  },
  fn: 'moteurdestinataires.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireChangementLangueProduit = void 0;
    require('ChangementLangue.css');
    const uNomCookieLangue = 'ielang';
    exports.UtilitaireChangementLangueProduit = {
      affecterLangue(aIdLang) {
        const lDate = new Date();
        lDate.setDate(lDate.getDate() + 365);
        document.cookie =
          uNomCookieLangue +
          '=' +
          aIdLang +
          '; expires=' +
          lDate.toUTCString() +
          '; path=/;';
        window.location.reload();
      },
      getImageCss(aLangId) {
        switch (aLangId) {
          case 12:
          case 1036:
            return 'Image_flagFR';
          case 1033:
            return 'Image_flagGB';
          case 1031:
            return 'Image_flagDE';
          case 9:
          case 2057:
            return 'Image_flagGB';
          case 2060:
            return 'Image_flagBE';
          case 3084:
            return 'Image_flagCA';
          case 4108:
            return 'Image_flagCH';
          case 16:
          case 1040:
            return 'Image_flagIT';
          case 2067:
            return 'Image_flagNL';
          case 6145:
            return 'Image_flagMA';
          case 10:
          case 3082:
            return 'Image_flagES';
          default:
            return 'Image_flagFR';
        }
      },
      getCodeLangueIso639(aLangId) {
        switch (aLangId) {
          case 12:
          case 1036:
            return 'fr';
          case 1033:
            return 'en';
          case 1031:
            return 'de';
          case 9:
          case 2057:
            return 'en';
          case 2060:
            return 'fr';
          case 3084:
            return 'ca';
          case 4108:
            return 'ch';
          case 16:
          case 1040:
            return 'it';
          case 2067:
            return 'nl';
          case 6145:
            return 'ar';
          case 10:
          case 3082:
            return 'es';
          default:
            return 'fr';
        }
      },
      getCodeLangueIetf(aLangId) {
        switch (aLangId) {
          case 12:
          case 1036:
            return 'fr-FR';
          case 1033:
            return 'en-US';
          case 1031:
            return 'de-DE';
          case 9:
          case 2057:
            return 'en-GB';
          case 2060:
            return 'fr-BE';
          case 3084:
            return 'fr-CA';
          case 4108:
            return 'fr-CH';
          case 16:
          case 1040:
            return 'it-IT';
          case 2067:
            return 'nl-BE';
          case 6145:
            return 'ar-MA';
          case 10:
          case 3082:
            return 'es-ES';
          default:
            return 'fr-FR';
        }
      },
    };
  },
  fn: 'utilitairechangementlangueproduit.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.SyntheseVocale = void 0;
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetPosition_1 = require('ObjetPosition');
    const tag_1 = require('tag');
    const UtilitaireChangementLangueProduit_1 = require('UtilitaireChangementLangueProduit');
    class UtilitaireSyntheseVocale {
      constructor() {
        this.applicationProduit = GApplication;
        this.supportee = !!window.speechSynthesis;
        this.active = false;
        this.avecSurlignage = false;
        this.estInitialise = false;
        this.listeVoixCompatible = [];
        this.listeVoixLangue = [];
        this.listeVoix = [];
      }
      getActif() {
        this.initialiser();
        return this.active;
      }
      getAvecSurLignage() {
        this.initialiser();
        return this.avecSurlignage;
      }
      initialiser(aForce) {
        var _a;
        if (!this.supportee) {
          if (
            (_a = this.applicationProduit) === null || _a === void 0
              ? void 0
              : _a.estAppliMobile
          ) {
            this.initApp();
          }
          return;
        }
        if (!this.estInitialise || aForce === true) {
          this.initVoix();
          speechSynthesis.onvoiceschanged = () => {
            this.initVoix();
          };
        }
      }
      getListeVoix() {
        this.initialiser();
        const lResult = new ObjetListeElements_1.ObjetListeElements();
        let lElement;
        if (this.listeVoixCompatible.length > 0) {
          this.listeVoixCompatible.forEach((aElement, aIndex) => {
            lElement = ObjetElement_1.ObjetElement.create({
              Libelle: aElement.name,
              Genre: aIndex,
              voix: aElement,
            });
            lResult.addElement(lElement);
          });
        } else if (this.listeVoixLangue.length > 0) {
          this.listeVoixLangue.forEach((aElement, aIndex) => {
            lElement = ObjetElement_1.ObjetElement.create({
              Libelle: aElement.name,
              Genre: aIndex,
              voix: aElement,
            });
            lResult.addElement(lElement);
          });
        }
        return lResult;
      }
      getVoix() {
        this.initialiser();
        return this.voix;
      }
      initApp() {
        var _a, _b, _c, _d, _e;
        this.active =
          (_e =
            (_d =
              (_c =
                (_b =
                  (_a = this.applicationProduit) === null || _a === void 0
                    ? void 0
                    : _a.getOptionsEspaceLocal) === null || _b === void 0
                  ? void 0
                  : _b.call(_a)) === null || _c === void 0
                ? void 0
                : _c.getSyntheseVocaleActif) === null || _d === void 0
              ? void 0
              : _d.call(_c)) !== null && _e !== void 0
            ? _e
            : false;
      }
      initVoix() {
        var _a, _b, _c;
        let lResult;
        let lAvecDefault = false;
        if (
          ((_a = this.applicationProduit) === null || _a === void 0
            ? void 0
            : _a.getOptionsEspaceLocal) &&
          this.applicationProduit.getOptionsEspaceLocal()
        ) {
          this.active = this.applicationProduit
            .getOptionsEspaceLocal()
            .getSyntheseVocaleActif();
          this.avecSurlignage = this.applicationProduit
            .getOptionsEspaceLocal()
            .getSyntheseVocaleAvecSurlignage();
          this.uriCookie =
            this.applicationProduit
              .getOptionsEspaceLocal()
              .getVoixSyntheseVocale() || '';
        } else {
          this.active = true;
        }
        this.listeVoix = speechSynthesis.getVoices();
        if (this.estInitialise) {
          this.listeVoixCompatible = [];
          this.listeVoixLangue = [];
        }
        this.estInitialise = true;
        for (let i = 0; i < this.listeVoix.length; i++) {
          const lVoix = this.listeVoix[i];
          if (this.uriCookie !== '' && lVoix.voiceURI === this.uriCookie) {
            lResult = lVoix;
            lAvecDefault = true;
          }
          const lLangID =
            ((_b = global.GParametres) === null || _b === void 0
              ? void 0
              : _b.langID) || 1036;
          const lLangue =
            ((_c = global.GParametres) === null || _c === void 0
              ? void 0
              : _c.langue) || 'fr';
          const lEstVoixCompatible =
            lVoix.lang ===
            UtilitaireChangementLangueProduit_1.UtilitaireChangementLangueProduit.getCodeLangueIetf(
              lLangID,
            );
          const lEstLangueCompatible = lVoix.lang.substring(0, 2) === lLangue;
          if (lEstVoixCompatible) {
            if (!lAvecDefault && lVoix.default) {
              lResult = lVoix;
              lAvecDefault = true;
            }
            this.listeVoixCompatible.push(lVoix);
            this.listeVoixLangue.push(lVoix);
          } else if (lEstLangueCompatible) {
            this.listeVoixLangue.push(lVoix);
          }
        }
        if (!lAvecDefault) {
          if (this.listeVoixCompatible.length > 0) {
            lResult = this.listeVoixCompatible[0];
          } else if (this.listeVoixLangue.length > 0) {
            lResult = this.listeVoixLangue[0];
          }
        }
        if ((!this.voix || !this.listeVoix.includes(lResult)) && lResult) {
          this.voix = lResult;
          this.saisieVoix(lResult);
        }
      }
      modifierVoix(aVoix) {
        this.saisieVoix(aVoix);
      }
      saisieVoix(aVoix) {
        var _a;
        this.voix = aVoix;
        if (this.voix && this.uriCookie !== this.voix.voiceURI) {
          this.uriCookie = this.voix.voiceURI;
          if (
            ((_a = this.applicationProduit) === null || _a === void 0
              ? void 0
              : _a.getOptionsEspaceLocal) &&
            this.applicationProduit.getOptionsEspaceLocal()
          ) {
            this.applicationProduit
              .getOptionsEspaceLocal()
              .setVoixSyntheseVocale(this.uriCookie);
          }
        }
      }
      saisieActive(aActif) {
        var _a;
        this.active = aActif;
        if (
          ((_a = this.applicationProduit) === null || _a === void 0
            ? void 0
            : _a.getOptionsEspaceLocal) &&
          this.applicationProduit.getOptionsEspaceLocal()
        ) {
          this.applicationProduit
            .getOptionsEspaceLocal()
            .setSyntheseVocaleActif(aActif);
        }
      }
      saisieAvecSurlignage(aValeur) {
        var _a;
        this.avecSurlignage = aValeur;
        if (
          ((_a = this.applicationProduit) === null || _a === void 0
            ? void 0
            : _a.getOptionsEspaceLocal) &&
          this.applicationProduit.getOptionsEspaceLocal()
        ) {
          this.applicationProduit
            .getOptionsEspaceLocal()
            .setSyntheseVocaleAvecSurlignage(aValeur);
        }
      }
      speak(aNode, aNodeBouton, aResult) {
        this.infoPrecedente = this.infoAttente;
        this.infoAttente = {
          node: aNode,
          nodeBouton: aNodeBouton,
          result: aResult,
        };
        if (!this.active) {
          return;
        }
        const lText = aResult.text;
        if (!this.supportee) {
          if (window.messageData) {
            this.applicationProduit.callbackSyntheseVocale = () => {
              this.reset(aNodeBouton);
            };
            const lEstBtnPlay = aNodeBouton.hasClass('icon_play_sign');
            const lEstBtnStop = aNodeBouton.hasClass('icon_stop_sign');
            if (lEstBtnPlay) {
              window.messageData.push({ action: 'tts', message: lText });
              $(this.infoAttente.nodeBouton).addClass('icon_stop_sign');
              $(this.infoAttente.nodeBouton).removeClass('icon_play_sign');
              return;
            }
            if (lEstBtnStop) {
              window.messageData.push({ action: 'stopTts' });
              $(this.infoAttente.nodeBouton).removeClass('icon_stop_sign');
              $(this.infoAttente.nodeBouton).addClass('icon_play_sign');
              return;
            }
          }
          return;
        }
        if (speechSynthesis.speaking) {
          if (this.nodeSurligne) {
            $(this.nodeSurligne)
              .removeClass('surlignage-conteneur')
              .find(`.${'surlignage-recherche-texte'}`)
              .remove();
            this.nodeSurligne = null;
          }
          if (lText === this.utterance.text) {
            this.reset(this.infoAttente.nodeBouton);
            speechSynthesis.cancel();
          } else {
            this.reset(this.infoPrecedente.nodeBouton);
            speechSynthesis.cancel();
            this.creerUtterance(lText);
          }
        } else if (lText) {
          this.creerUtterance(lText);
        }
      }
      creerUtterance(aTexte) {
        const lNodes = this.getTextNodesIn(this.infoAttente.node);
        let lIndiceOffset = 0;
        let lIndiceOffsetNode = 0;
        $(this.infoAttente.nodeBouton).addClass('icon_stop_sign');
        $(this.infoAttente.nodeBouton).removeClass('icon_play_sign');
        this.utterance = new SpeechSynthesisUtterance(aTexte);
        this.utterance.voice = this.voix;
        let lIndiceNodeCourant = 0;
        let lNodeCourant = lNodes[lIndiceNodeCourant];
        let lNodeSurligne;
        let lRange = null;
        this.utterance.onend = () => {
          if (this.nodeSurligne) {
            $(this.nodeSurligne)
              .removeClass('surlignage-conteneur')
              .find(`.${'surlignage-recherche-texte'}`)
              .remove();
            this.nodeSurligne = null;
          }
          this.reset(this.infoAttente.nodeBouton);
          if (
            this.infoAttente.result.idSuivant !== undefined &&
            this.infoAttente.result.idSuivant !== null
          ) {
            const lIDSuivant = this.infoAttente.result.idSuivant
              ? `#${this.infoAttente.result.idSuivant}`
              : '';
            if (lIDSuivant !== '') {
              $(lIDSuivant).trigger('click');
            }
          }
        };
        this.utterance.onboundary = (aEvent) => {
          if (aEvent.name !== 'word' || !this.avecSurlignage) {
            return;
          }
          if (aEvent.charIndex >= lIndiceOffset) {
            if (aEvent.charIndex > lIndiceOffset) {
              lIndiceOffset = aEvent.charIndex;
            }
            let lWord = aTexte
              .substring(lIndiceOffset, lIndiceOffset + aEvent.charLength)
              .trim();
            if (lWord.startsWith('. ')) {
              lWord = lWord.substring(2);
            }
            if (['.', ',', ':', ';', '?'].includes(lWord)) {
              return;
            }
            let lResultFindWord = this.getDebutFinInNode(
              lNodeCourant,
              lWord,
              lIndiceOffsetNode,
              aEvent.charLength,
            );
            let lStart = lResultFindWord.debut;
            let lEnd = lResultFindWord.fin;
            let lIndiceRecherche = lIndiceNodeCourant;
            while (lStart === -1 && lIndiceRecherche < lNodes.length) {
              lIndiceOffsetNode = 0;
              lIndiceRecherche++;
              lNodeCourant = lNodes[lIndiceRecherche];
              lResultFindWord = this.getDebutFinInNode(
                lNodeCourant,
                lWord,
                lIndiceOffsetNode,
                aEvent.charLength,
              );
              lStart = lResultFindWord.debut;
              lEnd = lResultFindWord.fin;
              if (lStart > -1) {
                lIndiceNodeCourant = lIndiceRecherche;
              }
            }
            if (lNodeSurligne) {
              $(lNodeSurligne)
                .removeClass('surlignage-conteneur')
                .find(`.${'surlignage-recherche-texte'}`)
                .remove();
              lNodeSurligne = null;
            }
            if (lStart > -1) {
              lNodeSurligne = lNodeCourant;
              if (lNodeCourant.nodeType === 3) {
                lNodeSurligne = lNodeCourant.parentElement;
              }
              const lRectConteneur =
                ObjetPosition_1.GPosition.getClientRect(lNodeSurligne);
              let lRects;
              if (lEnd === 0 && lNodeCourant.nodeType === 1) {
                lRects = [lRectConteneur];
              } else {
                lRange = new Range();
                lRange.setStart(lNodeCourant, lStart);
                lRange.setEnd(lNodeCourant, lEnd);
                lRects = lRange.getClientRects();
              }
              this.setRange(lNodeSurligne, lRectConteneur, lRects);
              lIndiceOffset = lIndiceOffset + aEvent.charLength;
              lIndiceOffsetNode = lEnd;
            }
          }
        };
        speechSynthesis.speak(this.utterance);
      }
      forcerArretLecture() {
        var _a, _b, _c;
        if (!this.supportee) {
          if (
            (_a = this.applicationProduit) === null || _a === void 0
              ? void 0
              : _a.estAppliMobile
          ) {
            (_c =
              (_b = window.messageData) === null || _b === void 0
                ? void 0
                : _b.push) === null || _c === void 0
              ? void 0
              : _c.call(_b, { action: 'stopTts' });
          }
          return;
        }
        if (this.supportee && speechSynthesis.speaking) {
          if (this.nodeSurligne) {
            $(this.nodeSurligne)
              .removeClass('surlignage-conteneur')
              .find(`.${'surlignage-recherche-texte'}`)
              .remove();
            this.nodeSurligne = null;
          }
          this.reset(this.infoAttente.nodeBouton);
          speechSynthesis.cancel();
        }
      }
      setRange(aNode, aRectCellule, aRects) {
        this.nodeSurligne = aNode;
        const lRectCellule = aRectCellule;
        for (let i = 0; i < aRects.length; i++) {
          const lRect = aRects[i];
          if (lRect.width > 0 && lRect.height > 0) {
            if (i > 0) {
              const lRectPrec = aRects[i - 1];
              if (
                lRectPrec.x === lRect.x &&
                lRectPrec.y === lRect.y &&
                lRectPrec.width === lRect.width &&
                lRectPrec.height === lRect.height
              ) {
                continue;
              }
            }
            $(aNode)
              .addClass('surlignage-conteneur')
              .append(
                (0, tag_1.tag)('div', {
                  class: 'surlignage-recherche-texte',
                  style: `top:${lRect.y - lRectCellule.y}px; left:${lRect.x - lRectCellule.x}px; width:${lRect.width}px; height:${lRect.height}px;"`,
                }),
              );
          }
        }
      }
      reset(aNodePlay = this.infoAttente.nodeBouton) {
        $(aNodePlay).removeClass('icon_stop_sign');
        $(aNodePlay).addClass('icon_play_sign');
      }
      getTextNodesDUneChaineHTML(aChaine) {
        const lElement = document.createElement('div');
        lElement.innerHTML = aChaine;
        return this.getTextNodesIn(lElement);
      }
      getTextesDUneChaineHTML(aChaine) {
        const lNodes = this.getTextNodesDUneChaineHTML(aChaine);
        const lResult = [];
        lNodes.forEach((aNode) => {
          const lJNode = $(aNode);
          const lText = lJNode.text() || lJNode.val();
          lResult.push(lText);
        });
        return lResult;
      }
      getTextNodesIn(node) {
        let textNodes = [],
          nonWhitespaceMatcher = /\S/;
        function getTextNodes(node) {
          if (node.classList && node.classList.contains('noSpeechSynthesis')) {
            return;
          }
          if (node.nodeType === 3) {
            if (nonWhitespaceMatcher.test(node.nodeValue)) {
              textNodes.push(node);
            }
          } else if (
            node.nodeType === 1 &&
            (!!node.ariaLabel ||
              !!node.title ||
              (!!node.attributes.alt && node.attributes.alt.nodeValue))
          ) {
            node.data =
              node.ariaLabel || node.title || node.attributes.alt.nodeValue;
            textNodes.push(node);
          } else {
            for (let i = 0, len = node.childNodes.length; i < len; ++i) {
              getTextNodes(node.childNodes[i]);
            }
          }
        }
        getTextNodes(node);
        return textNodes;
      }
      getDebutFinInNode(aNode, aWord, aIndiceDebut, aLength) {
        const lObj = { debut: -1, fin: -1 };
        const lEstNodeTexte = !!aNode && !!aNode.nodeValue;
        if (!lEstNodeTexte) {
          if (!!aNode) {
            lObj.debut = aNode.data.indexOf(aWord, aIndiceDebut);
            if (lObj.debut > -1) {
              lObj.debut = 0;
            }
            lObj.fin = 0;
          }
        } else {
          lObj.debut = aNode.data.indexOf(aWord, aIndiceDebut);
          lObj.fin = lObj.debut + aLength;
        }
        return lObj;
      }
    }
    exports.SyntheseVocale = new UtilitaireSyntheseVocale();
  },
  fn: 'utilitairesynthesevocale.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { GTraductions } = require('ObjetTraduction.js');
    const { GChaine } = require('ObjetChaine.js');
    const { GDate } = require('ObjetDate.js');
    const { GHtml } = require('ObjetHtml.js');
    const { TUtilitaireInfoSondage } = require('UtilitaireInfoSondage.js');
    const { EGenreEvntActu } = require('EGenreEvntActu.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { ObjetTri } = require('ObjetTri.js');
    const { EGenreTriElement } = require('Enumere_TriElement.js');
    const { Toast, ETypeToast } = require('Toast.js');
    const { MethodesObjet } = require('MethodesObjet.js');
    const { TypeEnsembleNombre } = require('TypeEnsembleNombre.js');
    const { TypeDomaine } = require('TypeDomaine.js');
    const { EGenreEtat } = require('Enumere_Etat.js');
    const { EGenreBoiteMessage } = require('Enumere_BoiteMessage.js');
    const { EGenreAction } = require('Enumere_Action.js');
    const { ETypeAffEnModeMixte } = require('Enumere_MenuCtxModeMixte.js');
    const { UtilitaireUrl } = require('UtilitaireUrl.js');
    const { MoteurDestinataires } = require('MoteurDestinataires.js');
    const { SyntheseVocale } = require('UtilitaireSyntheseVocale.js');
    require('InfoSondage.css');
    const EGenreEvntMenuCtxBlocInfoSondage = {
      editerActu: 1,
      supprimerActu: 2,
      dupliquerActu: 3,
      publier: 4,
      depublier: 5,
      marquerLu: 6,
      marquerNonLu: 7,
      supprimerConsult: 8,
      demarrerDiscussion: 9,
      creerModeleDepuisExistant: 10,
      recupererModele: 11,
      voirResultats: 12,
      publierModele: 13,
      nePasPublierModele: 14,
      exporterModele: 15,
      publierPageEtablissement: 17,
      depublierPageEtablissement: 18,
      relancerSelection: 19,
    };
    class MoteurInfoSondage {
      constructor(aParam) {
        this.utilitaires = {
          genreReponse: aParam.genreReponse,
          genreRessource: aParam.genreRessource,
          genreEspace: aParam.genreEspace,
        };
        this.moteurDestinataires = new MoteurDestinataires(this.utilitaires);
      }
      composeComposanteInfoSondage(aParam) {
        if (aParam.actu.estSondage) {
          return this.composeComposanteSondage(aParam);
        } else {
          return this.composeComposanteInfo(aParam);
        }
      }
      composePiecesJointes(aParam) {
        const H = [];
        const lListePJ = new ObjetListeElements();
        let lAvecImage = false;
        if (
          !!aParam.composante.listePiecesJointes &&
          aParam.composante.listePiecesJointes.count()
        ) {
          aParam.composante.listePiecesJointes.parcourir((aElement) => {
            if (!aElement.avecMiniaturePossible) {
              lListePJ.add(aElement);
            } else {
              lAvecImage = true;
            }
          });
          if (lListePJ.count()) {
            H.push(
              '<div style="margin-top: 1.5rem;">',
              UtilitaireUrl.construireListeUrls(lListePJ, {
                genreRessource:
                  this.utilitaires.genreRessource.getRessourceDocJointEtablissement(),
                separateur: '<br>',
              }),
              '</div>',
            );
          }
          if (lAvecImage) {
            H.push(
              `<div ie-identite="getCarrouselInfoSondage('${aParam.composante.getNumero()}')"></div>`,
            );
          }
        }
        return H.join('');
      }
      composeContenuTexte(aParam, aId) {
        const H = [];
        H.push(
          '<div class="tiny-view" id="',
          this.getIdTexteComposante(aId),
          '">',
          this.getTexteComposante(aParam),
          '</div>',
        );
        return H.join('');
      }
      getTexteComposante(aParam) {
        return aParam.composante.texte;
      }
      getIdReponse(aParam) {
        return aParam.instance.Nom + '_reponse_' + aParam.indice;
      }
      getIdReponseInputTexteLibre(aId, I) {
        return aId + '_reponselibre_' + I;
      }
      getIdTexteComposante(aId) {
        return 'titre_' + aId;
      }
      composeDescriptif(aParam) {
        const lActu = aParam.actualite;
        const lEstModeReception = !aParam.avecEditionActualite;
        const lEstModeDiffusion = aParam.avecEditionActualite;
        const H = [];
        if (lActu) {
          H.push('<div class="Actu_InfoSondage">');
          H.push(
            '<div class="zoneTitreIntegral-info-sondage ',
            lEstModeDiffusion ? 'modeDiffusion' : '',
            '">',
          );
          H.push(this.composeIconInfoSond({ actualite: lActu }));
          H.push('<div class="zoneTitre-info-sondage">');
          if (aParam.avecTitre) {
            H.push('<div class="titre-info-sondage">');
            H.push(lActu.getLibelle());
            H.push('</div>');
          }
          H.push('<div>');
          const lAvecCategorie =
            lActu.categorie !== null && lActu.categorie !== undefined;
          if (lAvecCategorie) {
            H.push(lActu.categorie.getLibelle());
          }
          if (lEstModeReception && !!lActu.auteur) {
            H.push(lAvecCategorie ? ' - ' : '');
            H.push(lActu.auteur);
          }
          H.push('</div>');
          if (lEstModeReception && this.avecInfoPublic(lActu)) {
            H.push('<div>');
            H.push(lActu.public.getLibelle());
            H.push('</div>');
          }
          if (lEstModeReception && aParam.avecDate) {
            H.push('<div>');
            H.push(GDate.formatDate(lActu.dateDebut, '%JJJ %JJ %MMMM'));
            H.push('</div>');
          }
          if (lActu.estSondage) {
            H.push('<div>');
            H.push(
              lActu.reponseAnonyme
                ? GTraductions.getValeur('actualites.InfoAnonyme')
                : GTraductions.getValeur('actualites.InfoNominatif'),
            );
            if (
              lActu.reponseAnonyme &&
              lActu.strInfoSondageAnonyme !== null &&
              lActu.strInfoSondageAnonyme !== undefined
            ) {
              H.push(' (', lActu.strInfoSondageAnonyme, ')');
            }
            H.push('</div>');
          }
          if (lEstModeDiffusion && !lActu.estModele) {
            H.push(
              '<div class="publication-info-sondage">',
              this.composeInfoPublication(aParam),
              this.composeInfoDiffusionPageEtablissement(aParam),
              '</div>',
            );
            if (
              !lActu.estInformation &&
              lActu.listeIndividusPartage !== null &&
              lActu.listeIndividusPartage !== undefined
            ) {
              const lNbrPartage = lActu.listeIndividusPartage.count();
              if (lNbrPartage > 0) {
                const lStr =
                  lNbrPartage > 1
                    ? GTraductions.getValeur('infoSond.detailPartageSondN', [
                        lNbrPartage,
                      ])
                    : GTraductions.getValeur('infoSond.detailPartageSondage', [
                        lActu.listeIndividusPartage.getLibelle(0),
                      ]);
                H.push('<div class="partage-info-sondage">', lStr, '</div>');
              }
            }
          }
          if (lEstModeDiffusion) {
            const lModeSuccinct = aParam.avecDetailPublicSuccinct === true;
            const lDetailPublic = lModeSuccinct
              ? lActu.detailPublicSuccinct
                ? GChaine.replaceRCToHTML(lActu.detailPublicSuccinct)
                : ''
              : lActu.detailPublic
                ? lActu.detailPublic
                : '';
            const lClassPublic = lModeSuccinct
              ? 'publicSucc-info-sondage'
              : 'public-info-sondage';
            H.push('<div class="', lClassPublic, '">', lDetailPublic, '</div>');
          }
          const lAvecPourcentageTauxDeReponse =
            Object.prototype.hasOwnProperty.call(lActu, 'pourcentRepondu') &&
            MethodesObjet.isNumeric(lActu.pourcentRepondu);
          if (lAvecPourcentageTauxDeReponse) {
            const lTrad = GTraductions.getValeur(
              lActu.estSondage
                ? 'infoSond.TauxReponse'
                : lActu.estInformation
                  ? 'infoSond.TauxLecture'
                  : '',
            );
            H.push(
              `<div>${lTrad} : <span class="Gras">${lActu.pourcentRepondu}</span> %</div>`,
            );
          }
          H.push('</div>');
          H.push('</div>');
          H.push('</div>');
        }
        return H.join('');
      }
      composeDescriptifLecture(aActu, aEstModeReception) {
        const H = [];
        const lEstModeReception = aEstModeReception;
        const lEstModeDiffusion = !aEstModeReception;
        const lStr = aActu.estSondage
          ? GTraductions.getValeur('infoSond.sondage')
          : GTraductions.getValeur('infoSond.information');
        H.push(lStr + ' : ' + aActu.getLibelle().enleverEntites() + '. ');
        const lAvecCategorie =
          aActu.categorie !== null && aActu.categorie !== undefined;
        if (lAvecCategorie) {
          H.push(aActu.categorie.getLibelle());
        }
        if (lEstModeReception && !!aActu.auteur) {
          H.push(lAvecCategorie ? '-' : '');
          H.push(aActu.auteur + '. ');
        }
        if (lEstModeReception && this.avecInfoPublic(aActu)) {
          H.push(aActu.public.getLibelle().enleverEntites() + '. ');
        }
        if (lEstModeReception) {
          H.push(GDate.formatDate(aActu.dateDebut, '%JJJ %JJ %MMMM') + '. ');
        }
        if (aActu.estSondage) {
          H.push(
            aActu.reponseAnonyme
              ? GTraductions.getValeur('actualites.InfoAnonyme')
              : GTraductions.getValeur('actualites.InfoNominatif'),
          );
          if (
            aActu.reponseAnonyme &&
            aActu.strInfoSondageAnonyme !== null &&
            aActu.strInfoSondageAnonyme !== undefined
          ) {
            const lContenu = aActu.strInfoSondageAnonyme.enleverEntites();
            if (lContenu) {
              H.push(' (', lContenu, ')');
            }
          }
          H.push('. ');
        }
        if (lEstModeDiffusion && !aActu.estModele) {
          H.push(
            this.composeInfoPublicationLecture(aActu),
            this.composeInfoDiffusionPageEtablissementLecture(aActu),
          );
          if (
            !aActu.estInformation &&
            aActu.listeIndividusPartage !== null &&
            aActu.listeIndividusPartage !== undefined
          ) {
            const lNbrPartage = aActu.listeIndividusPartage.count();
            if (lNbrPartage > 0) {
              const lStr =
                lNbrPartage > 1
                  ? GTraductions.getValeur('infoSond.detailPartageSondN', [
                      lNbrPartage,
                    ])
                  : GTraductions.getValeur('infoSond.detailPartageSondage', [
                      aActu.listeIndividusPartage.getLibelle(0),
                    ]);
              H.push(lStr);
            }
          }
        }
        if (lEstModeDiffusion && aActu.detailPublic) {
          const lJNode = $(aActu.detailPublic);
          const lContenu = lJNode.text() || lJNode.val();
          H.push(lContenu);
        }
        const lAvecPourcentageTauxDeReponse =
          Object.prototype.hasOwnProperty.call(aActu, 'pourcentRepondu') &&
          MethodesObjet.isNumeric(aActu.pourcentRepondu);
        if (lAvecPourcentageTauxDeReponse) {
          const lTrad = GTraductions.getValeur(
            aActu.estSondage
              ? 'infoSond.TauxReponse'
              : aActu.estInformation
                ? 'infoSond.TauxLecture'
                : '',
          );
          H.push(`${lTrad} : ${aActu.pourcentRepondu}%. `);
        }
        for (let i = 0, lNbr = aActu.listeQuestions.count(); i < lNbr; i++) {
          const lQuestion = aActu.listeQuestions.get(i);
          const lParam = {
            actu: aActu,
            composante: lQuestion,
            indice: i,
            avecLibelleQuestion: aActu.listeQuestions.count() > 1,
            estAffEditionActualite: lEstModeDiffusion,
          };
          if (aActu.estSondage) {
            if (
              lParam.avecLibelleQuestion &&
              this.estComposanteQuestion(lParam)
            ) {
              H.push(lQuestion.getLibelle().enleverEntites() + '. ');
            }
            if (
              this.estComposanteQuestChoixMultiple(lParam) &&
              this.estComposanteAvecMaximum(lParam)
            ) {
              H.push(
                GTraductions.getValeur('actualites.Edition.NbrMaxChoix', [
                  this.getNbReponsesMaxDeComposante(lParam),
                ]),
              );
            }
            const lJNodeQ = $(lQuestion.texte);
            const lContenuQ = lJNodeQ.text() || lJNodeQ.val();
            H.push(lContenuQ + '. ');
            if (this.estComposanteQuestTextuelle(lParam) && lQuestion.reponse) {
              H.push(
                lQuestion.reponse.valeurReponse
                  ? lQuestion.reponse.valeurReponse + '. '
                  : '',
              );
            } else if (
              this.estComposanteQuestChoixUnique(lParam) ||
              this.estComposanteQuestChoixMultiple(lParam)
            ) {
              const lHtmlChoix = this.composeReponseChoix(lParam, '');
              const lArrTextes =
                SyntheseVocale.getTextesDUneChaineHTML(lHtmlChoix);
              H.push(lArrTextes.join('. ') + '. ');
            }
            H.push(this.composePJLecture(lQuestion) + '. ');
          } else {
            const lJNodeQ = $(lQuestion.texte);
            const lContenuQ = lJNodeQ.text() || lJNodeQ.val();
            H.push(lContenuQ + '. ');
            H.push(this.composePJLecture(lQuestion) + '. ');
            if (this.estComposanteAvecAR(lParam)) {
              if (lQuestion.reponse.estRepondant === false) {
                H.push(
                  GTraductions.getValeur('actualites.XAPrisConnaissanceLeX', [
                    lQuestion.reponse.strRepondant,
                    GDate.formatDate(
                      lQuestion.reponse.reponduLe,
                      '%JJ/%MM/%AAAA',
                    ),
                  ]),
                );
              } else {
                H.push(GTraductions.getValeur('accueil.prisConnaissance'));
              }
            }
          }
        }
        return H.join(' ');
      }
      composePJLecture(aQuestion) {
        const H = [];
        if (
          !!aQuestion.listePiecesJointes &&
          aQuestion.listePiecesJointes.count()
        ) {
          const lListePJ = new ObjetListeElements();
          aQuestion.listePiecesJointes.parcourir((aElement) => {
            if (!aElement.avecMiniaturePossible) {
              lListePJ.add(aElement);
            }
          });
          if (lListePJ.count()) {
            let lArrDocs = lListePJ.getTableauLibelles();
            if (lArrDocs.length > 0) {
              H.push(
                lArrDocs.length > 1
                  ? GTraductions.getValeur('actualites.DocumentsJoints')
                  : GTraductions.getValeur('actualites.DocumentJoint'),
                ' : ',
                lArrDocs.join(', '),
              );
            }
          }
        }
        return H.join(' ');
      }
      composeIconInfoSond(aParam) {
        const lIcon = aParam.actualite.estSondage
          ? 'icon_diffuser_sondage'
          : 'icon_diffuser_information';
        const lStr = aParam.actualite.estSondage
          ? GTraductions.getValeur('infoSond.sondage')
          : GTraductions.getValeur('infoSond.information');
        return (
          '<i role="img" aria-label="' +
          lStr +
          '" class="' +
          lIcon +
          ' icon-titre" aria-hidden="true"></i>'
        );
      }
      composeIconDiffusionPageEtablissement(aParam) {
        const H = [];
        if (
          !!aParam.actualite &&
          aParam.actualite.publicationPageEtablissement
        ) {
          const lInfos = this.getInfosPublication(aParam.actualite);
          const lIcon = 'icon_ecole';
          const lColor = _getFlatClassColorPublication.call(this, lInfos);
          const lStr = GTraductions.getValeur(
            'actualites.Edition.DiffuseSurPageEtab',
          );
          H.push(
            '<i role="img" alt="',
            lStr,
            '" title="',
            lStr,
            '" class="icon ' + lIcon + ' ' + lColor + '"></i>',
          );
        }
        return H.join('');
      }
      composeInfoDiffusionPageEtablissement(aParam) {
        const H = [];
        if (
          !!aParam.actualite &&
          aParam.actualite.publicationPageEtablissement
        ) {
          const lInfos = this.getInfosPublication(aParam.actualite);
          const lIcon = 'icon_ecole';
          const lCssColor = _getFlatClassColorPublication.call(this, lInfos);
          const lStr = GTraductions.getValeur(
            'actualites.Edition.DiffuseSurPageEtab',
          );
          H.push(
            '<div><div class="infos-icon ',
            lIcon,
            ' ',
            lCssColor,
            '">',
            lStr,
            '</div></div>',
          );
        }
        return H.join('');
      }
      composeInfoDiffusionPageEtablissementLecture(aActu) {
        const H = [];
        if (!!aActu && aActu.publicationPageEtablissement) {
          const lStr = GTraductions.getValeur(
            'actualites.Edition.DiffuseSurPageEtab',
          );
          H.push(lStr);
        }
        return H.join('');
      }
      composeIconPublication(aParam) {
        const lInfos = this.getInfosPublication(aParam.actualite);
        const lIcon = _getIconePublication.call(this, lInfos);
        const lColor = _getFlatClassColorPublication.call(this, lInfos);
        const lStr = _getStrPublication.call(this, lInfos);
        const H = [];
        H.push(
          '<i title="',
          lStr,
          '" class="icon ' + lIcon + ' ' + lColor + '"></i>',
        );
        return H.join('');
      }
      composeInfoPublication(aParam) {
        const lActu = aParam.actualite;
        const H = [];
        const lInfos = this.getInfosPublication(lActu);
        const lIcon = _getIconePublication.call(this, lInfos);
        const lCssColor = _getFlatClassColorPublication.call(this, lInfos);
        const lStr = _getStrPublication.call(this, lInfos);
        const lDatesPublication =
          lInfos.estPubliee && lActu.date ? ' - ' + lActu.date : '';
        H.push(
          '<div class="infos-icon has-text ',
          lIcon,
          ' ',
          lCssColor,
          '"><span class="libelle">',
          lStr + lDatesPublication,
          '</span></div>',
        );
        return H.join('');
      }
      composeInfoPublicationLecture(aActu) {
        const H = [];
        const lInfos = this.getInfosPublication(aActu);
        const lStr = _getStrPublication.call(this, lInfos);
        const lDatesPublication =
          lInfos.estPubliee && aActu.date ? ' - ' + aActu.date : '';
        H.push(lStr + lDatesPublication);
        return H.join('');
      }
      estComposanteTexte(aParam) {
        return this.utilitaires.genreReponse.estGenreSansReponse(
          aParam.composante.genreReponse,
        );
      }
      estComposanteQuestion(aParam) {
        return !this.estComposanteTexte(aParam);
      }
      estComposanteQuestChoixMultiple(aParam) {
        return this.utilitaires.genreReponse.estGenreChoixMultiple(
          aParam.composante.genreReponse,
        );
      }
      estComposanteQuestChoixUnique(aParam) {
        return this.utilitaires.genreReponse.estGenreChoixUnique(
          aParam.composante.genreReponse,
        );
      }
      estComposanteQuestTextuelle(aParam) {
        return this.utilitaires.genreReponse.estGenreTextuelle(
          aParam.composante.genreReponse,
        );
      }
      estComposanteAvecMaximum(aParam) {
        return aParam.composante.avecMaximum;
      }
      getNbReponsesMaxDeComposante(aParam) {
        return aParam.composante.nombreReponsesMax;
      }
      getLibelleComposante(aParam) {
        return aParam.composante.getLibelle();
      }
      getLibelleAffichageComposanteQuest(aParam) {
        const lComposante = aParam.composante;
        const lAvecAbbr =
          lComposante.titre !== null &&
          lComposante.titre !== undefined &&
          lComposante.titre !== '';
        const lEstTxt = this.utilitaires.genreReponse.estGenreSansReponse(
          lComposante.genreReponse,
        );
        const lCleTraductionLibelleConflit = lAvecAbbr
          ? lEstTxt
            ? 'actualites.Edition.AbbrTxtN'
            : 'actualites.Edition.AbbrQuN'
          : lEstTxt
            ? 'actualites.Edition.TexteN'
            : 'actualites.Edition.QuestionN';
        let lResult = GTraductions.getValeur(lCleTraductionLibelleConflit, [
          aParam.rang,
        ]);
        if (lAvecAbbr) {
          lResult = lResult + ' : ' + lComposante.titre;
        }
        return lResult;
      }
      composeComposanteSondage(aParam) {
        const H = [];
        const lId = this.getIdReponse(aParam);
        if (aParam.avecLibelleQuestion && this.estComposanteQuestion(aParam)) {
          H.push(
            '<div class="InfoSond_Question">',
            this.getLibelleComposante(aParam),
            '</div>',
          );
        }
        if (
          this.estComposanteQuestChoixMultiple(aParam) &&
          this.estComposanteAvecMaximum(aParam)
        ) {
          H.push(
            '<div class="InfoSond_NbChoixLimite">',
            GTraductions.getValeur('actualites.Edition.NbrMaxChoix', [
              this.getNbReponsesMaxDeComposante(aParam),
            ]),
            '</div>',
          );
        }
        H.push(this.composeContenuTexte(aParam, lId));
        H.push(this.composeReponsesSondage(aParam, lId));
        H.push(this.composePiecesJointes(aParam));
        return H.join('');
      }
      composeReponsesSondage(aParam, aId) {
        const H = [];
        H.push('<div id="', aId, '">');
        if (this.estComposanteQuestTextuelle(aParam)) {
          H.push(this.composeReponseTextuelle(aParam, aId));
        } else if (
          this.estComposanteQuestChoixUnique(aParam) ||
          this.estComposanteQuestChoixMultiple(aParam)
        ) {
          H.push(this.composeReponseChoix(aParam, aId));
        }
        H.push('</div>');
        return H.join('');
      }
      composeReponseTextuelle(aParam, aId) {
        const H = [];
        H.push(
          '<div style="width:calc(100% - 1rem); margin-top:1rem; margin-bottom:1rem;">',
        );
        H.push(
          '<ie-textareamax tabindex="-1" id="',
          aId,
          '_0" ',
          GHtml.composeAttr(
            'ie-model',
            'surSaisieReponseTextuelle',
            aParam.indice,
          ),
          ' maxlength="' + aParam.composante.tailleReponse + '" placeholder="',
          GTraductions.getValeur('actualites.SaisirReponse'),
          '" ',
          IE.estMobile ? '' : ' style="height:6rem;" rows="6" ',
          aParam.estAffEditionActualite || GApplication.getModeExclusif()
            ? ' disabled'
            : '',
          '></ie-textareamax>',
        );
        H.push('</div>');
        return H.join('');
      }
      composeReponseChoix(aParam, aId) {
        const H = [];
        const lComposante = aParam.composante;
        if (lComposante) {
          const lEstQuestChoixMulti =
            this.estComposanteQuestChoixMultiple(aParam);
          const lEstAvecMax =
            lEstQuestChoixMulti && this.estComposanteAvecMaximum(aParam);
          const lNombreCoche = lEstAvecMax
            ? lComposante.reponse && lComposante.reponse.valeurReponse
              ? lComposante.reponse.valeurReponse.getNbrValeurs()
              : 0
            : 0;
          for (
            let I = 0, lNbr = lComposante.listeChoix.count();
            I < lNbr;
            I++
          ) {
            const lReponseChoix = lComposante.listeChoix.get(I);
            const lNr = I + 1;
            const lValeurReponse =
              !aParam.estAffEditionActualite &&
              lComposante.reponse &&
              lComposante.reponse.valeurReponse
                ? lComposante.reponse.valeurReponse.getValeur(lNr)
                : undefined;
            const lEstAffichageEnLectureSeule =
              aParam.estAffEditionActualite || GApplication.getModeExclusif();
            let lEstCocheDisabled = false;
            if (lEstAffichageEnLectureSeule) {
              lEstCocheDisabled = true;
            } else if (
              lEstAvecMax &&
              lNombreCoche >= lComposante.nombreReponsesMax
            ) {
              lEstCocheDisabled = !lValeurReponse;
            }
            const ieInput = lEstQuestChoixMulti ? 'ie-checkbox' : 'ie-radio';
            const lSurSaisie = aParam.instance
              ? aParam.instance.Nom +
                '.surSaisieReponse (' +
                aParam.indice +
                ', value, checked);'
              : '';
            const lIdCoche = aId + '_' + I;
            H.push('<div class="InfoSond_InfoCoche" >');
            H.push(
              '<',
              ieInput,
              ' ie-textright id="',
              lIdCoche,
              '" name="coches_',
              aId,
              '"',
              ' onclick="',
              lSurSaisie,
              '" value="',
              lNr,
              '"' +
                (lValeurReponse ? ' checked="checked"' : '') +
                (lEstCocheDisabled ? ' disabled' : '') +
                ' >',
            );
            H.push(lReponseChoix.getLibelle());
            H.push('</', ieInput, '>');
            if (lReponseChoix.estReponseLibre) {
              const lTailleMaxReponseLibre = 30;
              const lIdReponseLibre = this.getIdReponseInputTexteLibre(aId, I);
              let lReponseLibreDisabled = lEstAffichageEnLectureSeule;
              if (!lReponseLibreDisabled) {
                lReponseLibreDisabled = !lValeurReponse;
              }
              const lSurSaisieTexteLibre = aParam.instance
                ? aParam.instance.Nom +
                  '.surSaisieReponseLibre (' +
                  aParam.indice +
                  ', value);'
                : '';
              const lValeurReponseLibre = lComposante.reponse
                ? lComposante.reponse.valeurReponseLibre || ''
                : '';
              H.push(
                `<input type="text" style="width:30rem;" maxlength="${lTailleMaxReponseLibre}" class="like-input m-left-xl" id="${lIdReponseLibre}" `,
                lReponseLibreDisabled ? ' disabled' : '',
                ` onkeyup="${lSurSaisieTexteLibre}" value="${lValeurReponseLibre}"/>`,
              );
            }
            H.push('</div>');
          }
        }
        return H.join('');
      }
      estComposanteAvecAR(aParam) {
        const lEstAvecAR = this.utilitaires.genreReponse.estGenreAvecAR(
          aParam.composante.genreReponse,
        );
        if (lEstAvecAR !== null) {
          return lEstAvecAR;
        } else {
          return aParam.composante.avecAR;
        }
      }
      composeComposanteInfo(aParam) {
        const H = [];
        const lId = this.getIdReponse(aParam);
        H.push(this.composeContenuTexte(aParam, lId));
        H.push(this.composePiecesJointes(aParam));
        if (aParam && aParam.estModeSansAuth !== true) {
          H.push(this.composeReponseInfo(aParam));
        }
        return H.join('');
      }
      composeReponseInfo(aParam) {
        const H = [];
        if (this.estComposanteAvecAR(aParam)) {
          H.push('<div style="margin-top: 1.5rem;">');
          H.push(this.composeReponseAvecAR(aParam));
          H.push('</div>');
        }
        return H.join('');
      }
      composeReponseAvecAR(aParam) {
        const H = [];
        aParam.instance.controleur['cbAR'] = {
          getValue() {
            return aParam.composante.reponse.avecReponse;
          },
          setValue(aChecked) {
            aParam.instance.surSaisieReponse(aParam.indice);
          },
          getDisabled() {
            return aParam.composante.reponse.avecReponse
              ? true
              : GApplication.getModeExclusif();
          },
        };
        H.push('<div class="info-AR">');
        if (aParam.composante.reponse.estRepondant === false) {
          H.push(
            GTraductions.getValeur('actualites.XAPrisConnaissanceLeX', [
              aParam.composante.reponse.strRepondant,
              GDate.formatDate(
                aParam.composante.reponse.reponduLe,
                '%JJ/%MM/%AAAA',
              ),
            ]),
          );
        } else {
          if (aParam.estAffEditionActualite) {
            if (aParam.composante.avecAR) {
              H.push(
                `<p>${GTraductions.getValeur('actualites.Edition.AvecAR')}</p>`,
              );
            }
          } else {
            H.push(
              '<ie-checkbox ie-model="cbAR">',
              GTraductions.getValeur('accueil.prisConnaissance'),
              '</ie-checkbox>',
            );
          }
        }
        H.push('</div>');
        return H.join('');
      }
      avecInfoPublic(aActualite) {
        const lEspace = GEtatUtilisateur.GenreEspace;
        const lEstEspaceParent =
          this.utilitaires.genreEspace.estEspaceParent(lEspace);
        const lEstEspaceEntreprise =
          this.utilitaires.genreEspace.estEspaceEntreprise(lEspace);
        if (lEstEspaceParent || lEstEspaceEntreprise) {
          const lUtilisateurConnecte = GEtatUtilisateur.getUtilisateur();
          const lGenre = lEstEspaceEntreprise
            ? this.utilitaires.genreRessource.getRessourceEntreprise()
            : this.utilitaires.genreRessource.getRessourceParent();
          const lEstActuDUtilisateur =
            aActualite.public.getNumero() ===
              lUtilisateurConnecte.getNumero() &&
            aActualite.public.getGenre() === lGenre;
          return !lEstActuDUtilisateur;
        }
        return false;
      }
      avecCumul(aListeInfoSond) {
        const lEspace = GEtatUtilisateur.GenreEspace;
        const lEstEspaceParent =
          this.utilitaires.genreEspace.estEspaceParent(lEspace);
        const lEstEspaceEntreprise =
          this.utilitaires.genreEspace.estEspaceEntreprise(lEspace);
        if (lEstEspaceParent || lEstEspaceEntreprise) {
          if (GEtatUtilisateur.avecPlusieursMembres()) {
            return true;
          } else {
            const lGenre = lEstEspaceEntreprise
              ? this.utilitaires.genreRessource.getRessourceEntreprise()
              : this.utilitaires.genreRessource.getRessourceParent();
            const lUtilisateurConnecte = GEtatUtilisateur.getUtilisateur();
            return (
              aListeInfoSond.getIndiceElementParFiltre((aElement) => {
                return (
                  aElement.public.getNumero() ===
                    lUtilisateurConnecte.getNumero() &&
                  aElement.public.getGenre() === lGenre
                );
              }) > -1
            );
          }
        } else {
          return false;
        }
      }
      formaterListePourCumul(aListeInfoSond) {
        const lEspace = GEtatUtilisateur.GenreEspace;
        const lEstEspaceEntreprise =
          this.utilitaires.genreEspace.estEspaceEntreprise(lEspace);
        const lGenre = lEstEspaceEntreprise
          ? this.utilitaires.genreRessource.getRessourceEntreprise()
          : this.utilitaires.genreRessource.getRessourceParent();
        const lUtilisateurConnecte = GEtatUtilisateur.getUtilisateur();
        for (let i = 0, lNbr = aListeInfoSond.count(); i < lNbr; i++) {
          const lElement = aListeInfoSond.get(i);
          if (lElement.public) {
            let lCumulPere = aListeInfoSond.getElementParNumeroEtGenre(
              lElement.public.getNumero(),
              lElement.public.getGenre(),
            );
            if (!lCumulPere) {
              const lATitreIndividuel =
                lElement.public.getNumero() ===
                  lUtilisateurConnecte.getNumero() &&
                lElement.public.getGenre() === lGenre;
              const lLibelle = lATitreIndividuel
                ? GTraductions.getValeur('actualites.ATitreIndividuel')
                : GTraductions.getValeur('actualites.AProposDe', [
                    lElement.public.prenom && !lEstEspaceEntreprise
                      ? lElement.public.prenom
                      : lElement.public.getLibelle(),
                  ]);
              lCumulPere = new ObjetElement(
                lLibelle,
                lElement.public.getNumero(),
                lElement.public.getGenre(),
              );
              lCumulPere.estUnDeploiement = true;
              lCumulPere.estDeploye = true;
              lCumulPere.aTitreIndividuel = lATitreIndividuel;
              aListeInfoSond.addElement(lCumulPere);
            }
            lElement.pere = lCumulPere;
          }
        }
        aListeInfoSond.setTri(
          ObjetTri.initRecursif('pere', [
            ObjetTri.init('aTitreIndividuel'),
            ObjetTri.init((D) => {
              return D.estUnDeploiement ? D.getLibelle() : D.pere.getLibelle();
            }),
            ObjetTri.init((D) => {
              return D.dateDebut;
            }, EGenreTriElement.Decroissant),
            ObjetTri.init((D) => {
              return D.dateFin;
            }),
            ObjetTri.init('Libelle'),
            ObjetTri.init('Numero'),
          ]),
        );
        aListeInfoSond.trier();
      }
      aToutRepondu(aActualite) {
        let lResult = true;
        for (
          let i = 0, lNbr = aActualite.listeQuestions.count();
          i < lNbr && lResult;
          i++
        ) {
          const lQuestion = aActualite.listeQuestions.get(i);
          lResult =
            lQuestion.reponse.avecReponse ||
            this.utilitaires.genreReponse.estGenreSansReponse(
              lQuestion.genreReponse,
            ) ||
            this.utilitaires.genreReponse.estGenreSansAR(
              lQuestion.genreReponse,
            );
        }
        return lResult;
      }
      getDerniereReponse(aActualite) {
        let lResult = null;
        aActualite.listeQuestions.parcourir((aQuestion) => {
          if (
            aQuestion.reponse.avecReponse &&
            !this.utilitaires.genreReponse.estGenreSansReponse(
              aQuestion.genreReponse,
            ) &&
            !this.utilitaires.genreReponse.estGenreSansAR(
              aQuestion.genreReponse,
            )
          ) {
            if (!lResult) {
              lResult = aQuestion;
            } else {
              if (
                GDate.estAvantJour(
                  lResult.reponse.reponduLe,
                  aQuestion.reponse.reponduLe,
                )
              ) {
                lResult = aQuestion;
              }
            }
          }
        });
        return lResult;
      }
      estAvecVisuReponses(aActualite) {
        const lPremierQ = aActualite.listeQuestions.getPremierElement();
        return (
          ((aActualite.estSondage && !IE.estMobile) ||
            (!aActualite.estSondage &&
              !!lPremierQ &&
              ((lPremierQ.genreReponse !== null &&
                lPremierQ.genreReponse !== undefined &&
                !this.utilitaires.genreReponse.estGenreSansAR(
                  lPremierQ.genreReponse,
                )) ||
                lPremierQ.avecAR === true))) &&
          (aActualite.listePublicEntite.getNbrElementsExistes() > 0 ||
            aActualite.listePublicIndividu.getNbrElementsExistes() > 0 ||
            (this.utilitaires.genreEspace.estPourPrimaire() &&
              aActualite.avecDirecteur))
        );
      }
      formatterListeActusPourBlocs(aParam) {
        for (let i = 0, lNbr = aParam.listeActualites.count(); i < lNbr; i++) {
          const lActu = aParam.listeActualites.get(i);
          lActu.DateDebut = lActu.dateDebut;
          lActu.avecReponse = TUtilitaireInfoSondage.avecReponse.bind(lActu);
          lActu.aToutRepondu = TUtilitaireInfoSondage.aToutRepondu.bind(lActu);
          lActu.getDate = TUtilitaireInfoSondage.getDate.bind(lActu);
        }
      }
      getParamSaisie(aInfoSondage, aGenreEvnt, aParam) {
        if (aGenreEvnt === EGenreEvntActu.SurValidationSondage) {
          aParam.avecMsgConfirm = true;
        }
        const lListeActualites = new ObjetListeElements();
        lListeActualites.addElement(aInfoSondage);
        return {
          listeActualite: lListeActualites,
          validationDirecte: true,
          saisieActualite: aParam.modeAuteur,
        };
      }
      afficherToast(aActualite, aGenreEvnt, aParam) {
        let lMessage, lIcon;
        switch (aGenreEvnt) {
          case EGenreEvntActu.SurValidationSondage:
            lMessage = GTraductions.getValeur(
              'actualites.msgConfirmValidation',
              [GDate.formatDate(aActualite.dateFin, '%J/%MM/%AAAA')],
            );
            lIcon = 'icon_diffuser_sondage';
            break;
          case EGenreEvntActu.SurAR:
            lMessage = GTraductions.getValeur('infoSond.msgSurAR');
            lIcon = null;
            break;
          default:
            lMessage = '';
        }
        if (lMessage !== '') {
          Toast.fermer();
          Toast.afficher({
            msg: lMessage,
            type: ETypeToast.succes,
            icon: lIcon,
          });
          if (!!aParam.avecRecupDonnees) {
            aParam.clbckRecupDonnees.call(aParam.pereRecupDonnees);
          }
        } else {
          if (!!aParam.avecRecupDonnees) {
            aParam.clbckRecupDonnees.call(aParam.pereRecupDonnees);
          }
        }
      }
      initialiserNouveauItem(aParam) {
        const lInformation = new ObjetElement('');
        let lGenreReponse =
          aParam.genreReponse !== null && aParam.genreReponse !== undefined
            ? aParam.genreReponse
            : this.utilitaires.genreReponse.getGenreAvecAR();
        if (aParam.forcerAR === true) {
          if (this.utilitaires.genreReponse.estGenreSansAR(lGenreReponse)) {
            lGenreReponse = this.utilitaires.genreReponse.getGenreAvecAR();
          } else {
            lInformation.avecAR = true;
          }
        }
        if (aParam.categorie !== null && aParam.categorie !== undefined) {
          lInformation.categorie = aParam.categorie;
        }
        lInformation.auteur = GEtatUtilisateur.getUtilisateur().getLibelle();
        if (!aParam.estInformation) {
          lInformation.reponseAnonyme = false;
        }
        lInformation.estInformation = aParam.estInformation;
        lInformation.estSondage = !lInformation.estInformation;
        lInformation.date = '';
        lInformation.publie =
          aParam.publie !== null && aParam.publie !== undefined
            ? aParam.publie
            : !aParam.actualite;
        lInformation.estModele = aParam.estModele === true;
        const lDateDebut = GDate.getDateCourante();
        const lDateFin = lInformation.estInformation
          ? _calculeDateFinInfo({ derniereDate: aParam.dateFinDerniereDate })
          : _calculeDateFinSondage(lDateDebut);
        lInformation.dateDebut =
          aParam.actualite && aParam.actualite.dateDebut
            ? aParam.actualite.dateDebut
            : lDateDebut;
        lInformation.dateFin = aParam.actualite
          ? aParam.actualite.dateFin
          : lDateFin;
        lInformation.avecReponse = TUtilitaireInfoSondage.avecReponse;
        lInformation.aToutRepondu = TUtilitaireInfoSondage.aToutRepondu;
        lInformation.lue = false;
        lInformation.public = new ObjetElement('');
        lInformation.genrePublic = -1;
        lInformation.visible = true;
        if (aParam.actualite && aParam.actualite.listeQuestions) {
          lInformation.listeQuestions = _copierQuestions.call(
            this,
            aParam.actualite.listeQuestions,
          );
        } else {
          lInformation.listeQuestions = new ObjetListeElements();
          lInformation.listeQuestions.addElement(
            this.creerQuestionOuTexteSondage({ genreReponse: lGenreReponse }),
          );
        }
        lInformation.estVerrouille = false;
        lInformation.detailPublic = aParam.actualite
          ? aParam.actualite.detailPublic
          : GTraductions.getValeur('actualites.AucunDestinataire');
        lInformation.avecModificationPublic = !!(
          aParam.actualite || aParam.listePublic
        );
        lInformation.avecElevesRattaches = false;
        lInformation.genresPublicEntite = aParam.actualite
          ? MethodesObjet.dupliquer(aParam.actualite.genresPublicEntite)
          : new TypeEnsembleNombre();
        lInformation.listePublicEntite = aParam.actualite
          ? MethodesObjet.dupliquer(aParam.actualite.listePublicEntite)
          : new ObjetListeElements();
        lInformation.listePublicIndividu = aParam.actualite
          ? MethodesObjet.dupliquer(aParam.actualite.listePublicIndividu)
          : new ObjetListeElements();
        if (!aParam.estInformation) {
          lInformation.listeIndividusPartage = aParam.actualite
            ? MethodesObjet.dupliquer(aParam.actualite.listeIndividusPartage)
            : new ObjetListeElements();
        }
        if (aParam.listePublic && aParam.genresPublic) {
          if (aParam.genresPublic.length > 0) {
            const lEstGenreClasseOuGroupe = aParam.genresPublic.includes(
              this.utilitaires.genreRessource.getRessourceClasse(),
              this.utilitaires.genreRessource.getRessourceGroupe(),
            );
            if (lEstGenreClasseOuGroupe) {
              lInformation.listePublicEntite = aParam.listePublic;
            } else {
              lInformation.listePublicIndividu = aParam.listePublic;
            }
          }
        }
        lInformation.getDate =
          TUtilitaireInfoSondage.getDate.bind(lInformation);
        return lInformation;
      }
      creerQuestionOuTexteSondage(aParams) {
        const lUtil = this.utilitaires.genreReponse;
        const lParams = aParams || {};
        const lRang = lParams.rang ? lParams.rang : 1;
        const lGenreReponse =
          lParams.genreReponse === null ||
          lParams.genreReponse === undefined ||
          (lUtil.estGenreSansAR(lParams.genreReponse) && aParams.forcerAR)
            ? lUtil.getGenreAvecAR()
            : lParams.genreReponse;
        const lRangElement = lParams.rangElement ? lParams.rangElement : lRang;
        let lLibelle;
        if (
          !!aParams.genreReponse &&
          lUtil.estGenreSansReponse(aParams.genreReponse)
        ) {
          lLibelle = GTraductions.getValeur('actualites.Edition.TexteN', [
            lRangElement,
          ]);
        } else {
          lLibelle = GTraductions.getValeur('actualites.Edition.QuestionN', [
            lRangElement,
          ]);
        }
        const lResult = new ObjetElement(lLibelle);
        lResult.rang = lRang;
        lResult.indice = lRangElement;
        lResult.genreReponse = lGenreReponse;
        if (lGenreReponse === null || lGenreReponse === undefined) {
          lResult.avecAR = true;
        } else {
          lResult.avecAR = lUtil.estGenreAvecAR(lGenreReponse);
        }
        lResult.texte = '';
        lResult.titre = '';
        lResult.tailleReponse = 200;
        lResult.listePiecesJointes = new ObjetListeElements();
        lResult.listeChoix = new ObjetListeElements();
        lResult.reponse = new ObjetElement();
        if (lUtil.estGenreTextuelle(lGenreReponse)) {
          lResult.reponse.valeurReponse = '';
        } else if (
          lUtil.estGenreChoixUnique(lGenreReponse) ||
          lUtil.estGenreChoixMultiple(lGenreReponse)
        ) {
          lResult.reponse.valeurReponse = new TypeDomaine();
        }
        lResult.reponse.avecReponse = false;
        return lResult;
      }
      creerInfoDiffusionDesResultatsSondage(
        aSondage,
        aListeCategories,
        aListePiecesJointesResultats,
      ) {
        const lCategorieParDefaut = _getCategorieParDefaut.call(
          this,
          aListeCategories,
        );
        const lNouvelleActualite = this.initialiserNouveauItem({
          categorie: lCategorieParDefaut,
          estInformation: true,
        });
        lNouvelleActualite.setLibelle(
          GTraductions.getValeur(
            'actualites.Edition.TitreDiffusionResultatsDuSondage',
            [aSondage.getLibelle() || ''],
          ),
        );
        lNouvelleActualite.publie = true;
        lNouvelleActualite.estUneDiffusionDeResultatsSondage = true;
        const lStrTypeSondage = aSondage.reponseAnonyme
          ? GTraductions.getValeur('actualites.Anonyme')
          : GTraductions.getValeur('actualites.Nominatif');
        const lMessageNouvelleInformation = GTraductions.getValeur(
          'actualites.Edition.MessageDiffusionResultatsDuSondage',
          [lStrTypeSondage.toLowerCase(), aSondage.getLibelle() || ''],
        );
        const lPremiereQuestion =
          lNouvelleActualite.listeQuestions.getPremierElement();
        lPremiereQuestion.texte = lMessageNouvelleInformation;
        if (!lPremiereQuestion.listePiecesJointes) {
          lPremiereQuestion.listePiecesJointes = new ObjetListeElements();
        }
        aListePiecesJointesResultats.parcourir((D) => {
          lPremiereQuestion.listePiecesJointes.addElement(D);
        });
        return lNouvelleActualite;
      }
      getListePiecesJointesDActualite(aActualite) {
        const lListePiecesJointes = new ObjetListeElements();
        if (!!aActualite && !!aActualite.listeQuestions) {
          aActualite.listeQuestions.parcourir((aQuestion) => {
            if (!!aQuestion && !!aQuestion.listePiecesJointes) {
              aQuestion.listePiecesJointes.parcourir((aPJQuestion) => {
                lListePiecesJointes.addElement(aPJQuestion);
              });
            }
          });
        }
        return lListePiecesJointes;
      }
      afficherInfoNonDispoSurMobile() {
        const lMessage = GTraductions.getValeur('infoSond.nonDispoSurMobile');
        Toast.afficher({ msg: lMessage, type: ETypeToast.info });
      }
      initCommandesMenuCtxDInfoSond(aMenu, aActualite, aParam) {
        if (aParam.avecEditionActualite) {
          this.initCommandesMenuCtxDInfoSondDiffusion(
            aMenu,
            aActualite,
            aParam,
          );
        } else {
          this.initCommandesMenuCtxDInfoSondReception(
            aMenu,
            aActualite,
            aParam,
          );
        }
      }
      initCommandesMenuCtxDInfoSondDiffusion(aMenu, aActualite, aParam) {
        if (!GApplication.getModeExclusif()) {
          const lAvecDroitSaisie = aParam.droitSaisie;
          const lDroitPublicationPageEtablissement =
            !!aParam.droitPublicationPageEtablissement &&
            !!aActualite &&
            aActualite.estInformation;
          const lEstCtxModele = aParam.estCtxModeles === true;
          if (lAvecDroitSaisie) {
            const lEstAuteurActu = aActualite.estAuteur;
            aMenu.add(
              GTraductions.getValeur('actualites.Edition.Modification'),
              lAvecDroitSaisie && lEstAuteurActu,
              (aLigneMenu) => {
                if (IE.estMobile && aActualite.estSondage) {
                  this.afficherInfoNonDispoSurMobile();
                } else {
                  aParam.evenementMenuContextuel(
                    aActualite,
                    EGenreEvntActu.SurMenuCtxActu,
                    { cmd: aLigneMenu },
                  );
                }
              },
              {
                icon: 'icon_pencil',
                Numero: EGenreEvntMenuCtxBlocInfoSondage.editerActu,
                typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
              },
            );
            if (lEstCtxModele) {
              aMenu.add(
                GTraductions.getValeur('actualites.utiliserModele'),
                lAvecDroitSaisie,
                (aLigneMenu) => {
                  if (IE.estMobile && aActualite.estSondage) {
                    this.afficherInfoNonDispoSurMobile();
                  } else {
                    aParam.evenementMenuContextuel(
                      aActualite,
                      EGenreEvntActu.SurMenuCtxActu,
                      { cmd: aLigneMenu },
                    );
                  }
                },
                {
                  icon: 'icon_transferer_discussion',
                  Numero: EGenreEvntMenuCtxBlocInfoSondage.recupererModele,
                  typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
                },
              );
              if (lEstAuteurActu) {
                const lEstPartage = aActualite.estModelePartage === true;
                aMenu.add(
                  lEstPartage
                    ? GTraductions.getValeur('actualites.nePasPartagerModele')
                    : GTraductions.getValeur('actualites.partagerModele'),
                  lAvecDroitSaisie && lEstAuteurActu,
                  () => {
                    _changerEtatPartageModele.call(
                      this,
                      aActualite,
                      !lEstPartage,
                      aParam,
                    );
                  },
                  {
                    icon: lEstPartage
                      ? 'icon_retirer_bibliotheque'
                      : 'icon_sondage_bibliotheque',
                    Numero: lEstPartage
                      ? EGenreEvntMenuCtxBlocInfoSondage.nePasPublierModele
                      : EGenreEvntMenuCtxBlocInfoSondage.publierModele,
                    typeAffEnModeMixte: ETypeAffEnModeMixte.ellipsis,
                  },
                );
              }
              if (!IE.estMobile && aActualite.estSondage) {
                aMenu.add(
                  GTraductions.getValeur('actualites.exporterModeleSondage'),
                  lAvecDroitSaisie,
                  (aLigneMenu) => {
                    aParam.evenementMenuContextuel(
                      aActualite,
                      EGenreEvntActu.SurMenuCtxActu,
                      { cmd: aLigneMenu },
                    );
                  },
                  {
                    icon: 'icon_upload_alt',
                    Numero: EGenreEvntMenuCtxBlocInfoSondage.exporterModele,
                    typeAffEnModeMixte: ETypeAffEnModeMixte.ellipsis,
                  },
                );
              }
            }
            if (!lEstCtxModele) {
              aMenu.add(
                GTraductions.getValeur('actualites.Edition.Dupliquer'),
                lAvecDroitSaisie,
                () => {
                  if (IE.estMobile && aActualite.estSondage) {
                    this.afficherInfoNonDispoSurMobile();
                  } else {
                    const lActualite = MethodesObjet.dupliquer(aActualite);
                    lActualite.setEtat(EGenreEtat.Modification);
                    lActualite.estADupliquer = true;
                    lActualite.dupliquerPublic = true;
                    aParam.evenementMenuContextuel(
                      lActualite,
                      EGenreEvntActu.SurCreationActu,
                    );
                  }
                },
                {
                  icon: 'icon_copier_liste',
                  Numero: EGenreEvntMenuCtxBlocInfoSondage.dupliquerActu,
                  typeAffEnModeMixte: ETypeAffEnModeMixte.ellipsis,
                },
              );
              if (aActualite.publie) {
                aMenu.add(
                  GTraductions.getValeur('actualites.Edition.Depublier'),
                  lAvecDroitSaisie && lEstAuteurActu,
                  () => {
                    _changerEtatPublie.call(this, aActualite, false, aParam);
                  },
                  {
                    icon: 'icon_info_sondage_non_publier',
                    Numero: EGenreEvntMenuCtxBlocInfoSondage.depublier,
                    typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
                  },
                );
              } else {
                aMenu.add(
                  GTraductions.getValeur('actualites.Edition.Publier'),
                  _estPublicationAutorisee.call(this, aActualite, aParam),
                  () => {
                    _changerEtatPublie.call(this, aActualite, true, aParam);
                  },
                  {
                    icon: 'icon_info_sondage_publier',
                    Numero: EGenreEvntMenuCtxBlocInfoSondage.publier,
                    typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
                  },
                );
              }
              if (lDroitPublicationPageEtablissement) {
                if (aActualite.publicationPageEtablissement) {
                  aMenu.add(
                    GTraductions.getValeur(
                      'actualites.Edition.DepublierPageEtab',
                    ),
                    lAvecDroitSaisie && lEstAuteurActu,
                    () => {
                      _changerPublicationPageEtablissement.call(
                        this,
                        aActualite,
                        false,
                        aParam,
                      );
                    },
                    {
                      icon: 'icon_ecole mix-icon_fermeture_widget i-small',
                      Numero:
                        EGenreEvntMenuCtxBlocInfoSondage.depublierPageEtablissement,
                      typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
                    },
                  );
                } else {
                  aMenu.add(
                    GTraductions.getValeur(
                      'actualites.Edition.PublierPageEtab',
                    ),
                    lAvecDroitSaisie && lEstAuteurActu && aActualite.publie,
                    () => {
                      _changerPublicationPageEtablissement.call(
                        this,
                        aActualite,
                        true,
                        aParam,
                      );
                    },
                    {
                      icon: 'icon_ecole',
                      Numero:
                        EGenreEvntMenuCtxBlocInfoSondage.publierPageEtablissement,
                      typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
                    },
                  );
                }
              }
              if (aParam.avecModeles === true) {
                aMenu.add(
                  GTraductions.getValeur('actualites.creerModele'),
                  lAvecDroitSaisie && lEstAuteurActu,
                  () => {
                    const lActualite = MethodesObjet.dupliquer(aActualite);
                    lActualite.setEtat(EGenreEtat.Modification);
                    lActualite.estAModeliser = true;
                    aParam.evenementMenuContextuel(
                      lActualite,
                      EGenreEvntActu.SurCreationActu,
                    );
                  },
                  {
                    icon: aActualite.estSondage
                      ? 'icon_diffuser_sondage mix-icon_plus'
                      : 'icon_diffuser_information mix-icon_plus',
                    Numero:
                      EGenreEvntMenuCtxBlocInfoSondage.creerModeleDepuisExistant,
                    typeAffEnModeMixte: ETypeAffEnModeMixte.ellipsis,
                  },
                );
              }
            }
            aMenu.add(
              GTraductions.getValeur('actualites.Edition.Supprimer'),
              lAvecDroitSaisie && lEstAuteurActu,
              () => {
                const lMsgConfirmSuppression = aActualite.estVerrouille
                  ? GTraductions.getValeur('actualites.ConfirmationSuppression')
                  : GTraductions.getValeur('liste.suppressionSelection');
                GApplication.getMessage().afficher({
                  type: EGenreBoiteMessage.Confirmation,
                  message: lMsgConfirmSuppression,
                  callback: _evntSuppressionActu.bind(this, aActualite, aParam),
                });
              },
              {
                icon: 'icon_trash',
                Numero: EGenreEvntMenuCtxBlocInfoSondage.supprimerActu,
                typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
              },
            );
            const lAvecBoutonRelance =
              aActualite.nbIndividusSansReponses > 0 &&
              aActualite.pourcentRepondu < 100 &&
              aActualite.publie &&
              (GDate.estAvantJourCourant(aActualite.dateDebut) ||
                GDate.estJourCourant(aActualite.dateDebut)) &&
              !GDate.estAvantJourCourant(aActualite.dateFin);
            if (lAvecBoutonRelance) {
              aMenu.add(
                GTraductions.getValeur('actualites.RelancerNonRepondants'),
                true,
                (aLigneMenu) => {
                  const lMsgConfirm = GTraductions.getValeur(
                    aActualite.estSondage
                      ? 'actualites.ConfirmationSondage'
                      : aActualite.estInformation
                        ? 'actualites.ConfirmationInformation'
                        : '',
                    [aActualite.nbIndividusSansReponses],
                  );
                  GApplication.getMessage().afficher({
                    type: EGenreBoiteMessage.Confirmation,
                    message: lMsgConfirm,
                    callback: _evntRelanceActu.bind(
                      this,
                      aActualite,
                      aParam,
                      aLigneMenu,
                    ),
                  });
                },
                {
                  icon: 'icon_reply',
                  Numero: EGenreEvntMenuCtxBlocInfoSondage.relancerSelection,
                  typeAffEnModeMixte: ETypeAffEnModeMixte.ellipsis,
                },
              );
            }
            if (!lEstCtxModele) {
              if (
                aParam.avecVisuResultats &&
                this.estAvecVisuReponses(aActualite)
              ) {
                aMenu.add(
                  GTraductions.getValeur('actualites.Edition.OngletResultats'),
                  true,
                  (aLigneMenu) => {
                    aParam.evenementMenuContextuel(
                      aActualite,
                      EGenreEvntActu.SurMenuCtxActu,
                      { cmd: aLigneMenu },
                    );
                  },
                  {
                    icon: 'icon_qcm',
                    Numero: EGenreEvntMenuCtxBlocInfoSondage.voirResultats,
                    typeAffEnModeMixte: ETypeAffEnModeMixte.bouton,
                  },
                );
              }
            }
          }
        }
      }
      initCommandesMenuCtxDInfoSondReception(aMenu, aActualite, aParam) {
        if (!GApplication.getModeExclusif()) {
          if (aActualite.lue) {
            aMenu.add(
              GTraductions.getValeur('actualites.MarquerNonLu'),
              aActualite.lue,
              () => {
                _changerEtatLue.call(this, aActualite, false, aParam);
              },
              {
                icon: 'icon_eye_close',
                Numero: EGenreEvntMenuCtxBlocInfoSondage.marquerNonLu,
                typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
              },
            );
          } else {
            aMenu.add(
              GTraductions.getValeur('actualites.MarquerLu'),
              !aActualite.lue,
              () => {
                _changerEtatLue.call(this, aActualite, true, aParam);
              },
              {
                icon: 'icon_eye_open',
                Numero: EGenreEvntMenuCtxBlocInfoSondage.marquerLu,
                typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
              },
            );
          }
          if (aParam.avecSuppressionActusRecues) {
            aMenu.add(
              GTraductions.getValeur('actualites.MarquerSupprimee'),
              true,
              () => {
                GApplication.getMessage().afficher({
                  type: EGenreBoiteMessage.Confirmation,
                  message: GTraductions.getValeur('liste.suppressionSelection'),
                  callback: function (aGenreAction) {
                    if (aGenreAction === EGenreAction.Valider) {
                      _changerEtatSupprimee.call(this, aActualite, aParam);
                    }
                  }.bind(this),
                });
              },
              {
                icon: 'icon_trash',
                Numero: EGenreEvntMenuCtxBlocInfoSondage.supprimerConsult,
                typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
              },
            );
          }
          if (
            aParam.avecDiscussion &&
            aActualite.elmauteur &&
            aActualite.elmauteur.avecDiscussion
          ) {
            aMenu.addSeparateur();
            aMenu.add(
              GTraductions.getValeur('actualites.discussion.demarrer'),
              true,
              (aLigneMenu) => {
                aParam.evenementMenuContextuel(
                  aActualite,
                  EGenreEvntActu.SurMenuCtxActu,
                  { cmd: aLigneMenu },
                );
              },
              {
                icon: 'icon_nouvelle_discussion',
                Numero: EGenreEvntMenuCtxBlocInfoSondage.demarrerDiscussion,
                typeAffEnModeMixte: ETypeAffEnModeMixte.icon,
              },
            );
          }
        }
      }
      verifierEtatModification(aParam) {
        const lDonnee = aParam.donnee;
        const lDonneeOrigine = aParam.donneeOrigine;
        const lTest =
          lDonnee.getLibelle() !== lDonneeOrigine.getLibelle() ||
          (lDonnee.categorie !== null &&
            lDonnee.categorie !== undefined &&
            lDonneeOrigine.categorie !== null &&
            lDonneeOrigine.categorie !== undefined &&
            lDonnee.categorie.getNumero() !==
              lDonneeOrigine.categorie.getNumero()) ||
          lDonnee.publie !== lDonneeOrigine.publie ||
          !GDate.estJourEgal(lDonnee.dateDebut, lDonneeOrigine.dateDebut) ||
          !GDate.estJourEgal(lDonnee.dateFin, lDonneeOrigine.dateFin) ||
          lDonnee.listeQuestions.existeElementPourValidation() ||
          lDonnee.avecModificationPublic ||
          lDonnee.publicationPageEtablissement !==
            lDonneeOrigine.publicationPageEtablissement ||
          !!lDonnee.partageAEteModifie;
        return lTest ? EGenreEtat.Modification : EGenreEtat.Aucun;
      }
      validerEdition(aParam) {
        const lListeActualites = new ObjetListeElements();
        lListeActualites.addElement(aParam.donnee);
        const lObjetSaisie = {
          listeActualite: lListeActualites,
          validationDirecte: false,
          saisieActualite: true,
          listeDocuments: aParam.listePJ,
          genresAffDestinataire: aParam.genresRessAffDestinataire,
        };
        aParam.envoyerRequete(lObjetSaisie);
      }
      formatterDonnees(aParam) {
        aParam.listeInfoSond.parcourir((aActu) => {
          if (aActu.estInformation) {
            aActu.listeQuestions.parcourir((aQuestion) => {
              aQuestion.avecAR =
                aParam.forcerAR === true ||
                this.estComposanteAvecAR({ composante: aQuestion });
            });
          }
        });
      }
      formatterDonneesAvantSaisie(aParam) {
        aParam.listeInfoSond.parcourir((aActu) => {
          if (aActu.estInformation) {
            aActu.listeQuestions.parcourir((aQuestion) => {
              aQuestion.genreReponse = aQuestion.avecAR
                ? this.utilitaires.genreReponse.getGenreAvecAR()
                : this.utilitaires.genreReponse.getGenreSansAR();
            });
          }
        });
      }
      composeFormText(aParam) {
        const H = [];
        H.push(
          '<input type="text" id="',
          aParam.id,
          '" ie-node="',
          aParam.node,
          '" ie-model="',
          aParam.model,
          '" class="',
          aParam.classCss,
          '" />',
        );
        return H.join('');
      }
      getInfosPublication(aActualite) {
        const lEstPubliee = aActualite.publie === true;
        let lEnCours = false;
        let lFutur = false;
        let lPassee = false;
        if (lEstPubliee) {
          lEnCours = GDate.dateEntreLesDates(
            GDate.getDateCourante(false),
            aActualite.dateDebut,
            aActualite.dateFin,
            true,
          );
          lFutur = GDate.estDateJourAvant(
            GDate.getDateCourante(false),
            aActualite.dateDebut,
          );
          lPassee = !lEnCours && !lFutur;
        }
        return {
          estPubliee: lEstPubliee,
          estEnCours: lEnCours,
          estFutur: lFutur,
          estPassee: lPassee,
        };
      }
      dupliquerQuestion(aQuestion) {
        return _copieQuestion.call(this, aQuestion);
      }
    }
    function _getIconePublication(aInfos) {
      if (aInfos.estPubliee) {
        if (aInfos.estFutur) {
          return 'icon_info_sondage_publier mix-icon_edt_permanence';
        } else if (aInfos.estPassee) {
          return 'icon_info_sondage_publier';
        } else if (aInfos.estEnCours) {
          return 'icon_info_sondage_publier mix-icon_ok';
        }
      } else {
        return 'icon_brouillon_discussion';
      }
      return '';
    }
    function _getFlatClassColorPublication(aInfos) {
      return aInfos.estPubliee && !aInfos.estPassee ? 'on' : 'off';
    }
    function _getStrPublication(aInfos) {
      return aInfos.estPubliee
        ? aInfos.estEnCours
          ? GTraductions.getValeur('actualites.Publie')
          : aInfos.estFutur
            ? GTraductions.getValeur('infoSond.publicationFutur')
            : GTraductions.getValeur('infoSond.publicationPassee')
        : GTraductions.getValeur('actualites.NonPubliee');
    }
    function _calculeDateFinSondage(aDate) {
      let i = 0;
      let lDate = new Date(aDate.getTime());
      do {
        lDate = GDate.getJourSuivant(lDate);
        if (
          !GParametres.JoursFeries.getValeur(
            GDate.getNbrJoursEntreDeuxDates(
              IE.Cycles.dateDebutPremierCycle(),
              aDate,
            ) + 1,
          ) &&
          GDate.estUnJourOuvre(lDate)
        ) {
          i++;
        }
      } while (i < 15 && lDate < GDate.derniereDate);
      return lDate;
    }
    function _calculeDateFinInfo(aParam) {
      if (
        aParam !== null &&
        aParam !== undefined &&
        aParam.derniereDate === true
      ) {
        return GDate.derniereDate;
      } else {
        const lDerniereSemaine = IE.Cycles.nombreCyclesAnneeScolaire();
        return IE.Cycles.dateDernierJourOuvreCycle(lDerniereSemaine);
      }
    }
    function _copierQuestions(aListeQuestions) {
      const lResult = new ObjetListeElements();
      for (let i = 0; i < aListeQuestions.count(); i++) {
        if (aListeQuestions.existe(i)) {
          const lElement = _copieQuestion(aListeQuestions.get(i));
          lElement.setEtat(EGenreEtat.Creation);
          lResult.addElement(lElement);
        }
      }
      return lResult;
    }
    function _copieQuestion(aQuestion) {
      const lNouvelleQuestion = this.creerQuestionOuTexteSondage(aQuestion);
      lNouvelleQuestion.setLibelle(aQuestion.getLibelle());
      lNouvelleQuestion.rang = aQuestion.rang;
      lNouvelleQuestion.indice = aQuestion.indice;
      lNouvelleQuestion.genreReponse = aQuestion.genreReponse;
      lNouvelleQuestion.texte = aQuestion.texte;
      lNouvelleQuestion.tailleReponse = aQuestion.tailleReponse;
      lNouvelleQuestion.listePiecesJointes = _copierDocuments(
        aQuestion.listePiecesJointes,
      );
      lNouvelleQuestion.listeChoix = _copierChoixReponses(aQuestion.listeChoix);
      lNouvelleQuestion.avecMaximum = aQuestion.avecMaximum;
      lNouvelleQuestion.nombreReponsesMax = aQuestion.nombreReponsesMax;
      lNouvelleQuestion.titre = aQuestion.titre;
      return lNouvelleQuestion;
    }
    function _copierDocuments(aListeDocuments) {
      const lResult = MethodesObjet.dupliquer(aListeDocuments);
      for (let i = 0; i < lResult.count(); i++) {
        if (lResult.existe(i)) {
          const lElement = lResult.get(i);
          lElement.setEtat(EGenreEtat.Creation);
        }
      }
      return lResult;
    }
    function _copierChoixReponses(aListeChoix) {
      const lResult = new ObjetListeElements();
      for (let i = 0; i < aListeChoix.count(); i++) {
        if (aListeChoix.existe(i)) {
          const lElement = aListeChoix.get(i);
          const lChoix = new ObjetElement(lElement.getLibelle());
          lChoix.rang = lElement.rang;
          lChoix.setEtat(EGenreEtat.Creation);
          if (
            lElement.estReponseLibre !== null &&
            lElement.estReponseLibre !== undefined
          ) {
            lChoix.estReponseLibre = lElement.estReponseLibre;
          }
          lResult.addElement(lChoix);
        }
      }
      return lResult;
    }
    function _getCategorieParDefaut(aListeCategories) {
      let lCategorieParDefaut = null;
      if (!!aListeCategories) {
        aListeCategories.parcourir((D) => {
          if (!!D && D.estDefaut) {
            lCategorieParDefaut = D;
            return false;
          }
        });
        if (!lCategorieParDefaut) {
          lCategorieParDefaut = aListeCategories.getPremierElement();
        }
      }
      return lCategorieParDefaut;
    }
    function _changerEtatPartageModele(aArticle, aPartage, aParam) {
      if (aArticle.estModelePartage !== aPartage) {
        aArticle.estModelePartage = aPartage;
        aArticle.changePartageModeleSeulement = true;
        aParam.evenementMenuContextuel(
          aArticle,
          EGenreEvntActu.SurValidationDirecte,
          { avecRecupDonnees: true },
        );
      }
    }
    function _changerEtatPublie(aArticle, aPublie, aParam) {
      if (aArticle && aParam.avecEditionActualite) {
        aArticle.publie = aPublie;
        if (!aArticle.publie && aArticle.estInformation) {
          aArticle.publicationPageEtablissement = false;
        }
        aArticle.setEtat(EGenreEtat.Modification);
        aParam.evenementMenuContextuel(
          aArticle,
          EGenreEvntActu.SurValidationModif,
        );
      }
    }
    function _changerPublicationPageEtablissement(aArticle, aPublie, aParam) {
      const lDroitPublicationPageEtablissement =
        aParam.avecEditionActualite &&
        !!aParam.droitPublicationPageEtablissement &&
        !!aArticle &&
        aArticle.estInformation;
      if (lDroitPublicationPageEtablissement) {
        aArticle.publicationPageEtablissement = aPublie;
        aArticle.setEtat(EGenreEtat.Modification);
        aParam.evenementMenuContextuel(
          aArticle,
          EGenreEvntActu.SurValidationModif,
        );
      }
    }
    function _estPublicationAutorisee(aArticle, aParam) {
      const lAvecPublic = this.moteurDestinataires.avecDestinataires({
        donnee: aArticle,
      });
      const lEstAuteurActu = aArticle.estAuteur;
      return aParam.droitSaisie && lAvecPublic && !!lEstAuteurActu;
    }
    function _evntSuppressionActu(aArticle, aParam, aGenreAction) {
      if (aGenreAction === EGenreAction.Valider) {
        aArticle.setEtat(EGenreEtat.Suppression);
        aArticle.visible = false;
        aParam.evenementMenuContextuel(
          aArticle,
          EGenreEvntActu.SurValidationModif,
        );
      }
    }
    function _changerEtatLue(aArticle, aEtat, aParam) {
      if (aArticle.lue !== aEtat) {
        aArticle.lue = aEtat;
        aArticle.marqueLueSeulement = true;
        aParam.evenementMenuContextuel(
          aArticle,
          EGenreEvntActu.SurValidationDirecte,
          { avecRecupDonnees: true },
        );
      }
    }
    function _changerEtatSupprimee(aArticle, aParam) {
      aArticle.supprimee = true;
      aArticle.marqueLueSeulement = true;
      aParam.evenementMenuContextuel(
        aArticle,
        EGenreEvntActu.SurValidationDirecte,
        { avecRecupDonnees: true },
      );
    }
    function _evntRelanceActu(aActualite, aParams, aLigneMenu, aGenreAction) {
      if (aGenreAction === EGenreAction.Valider) {
        aParams.evenementMenuContextuel(
          aActualite,
          EGenreEvntActu.SurMenuCtxActu,
          { cmd: aLigneMenu },
        );
      }
    }
    module.exports = { MoteurInfoSondage, EGenreEvntMenuCtxBlocInfoSondage };
  },
  fn: 'moteurinfosondage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EModeAffichageTimeline = void 0;
    var EModeAffichageTimeline;
    (function (EModeAffichageTimeline) {
      EModeAffichageTimeline[(EModeAffichageTimeline['classique'] = 1)] =
        'classique';
      EModeAffichageTimeline[(EModeAffichageTimeline['widget'] = 2)] = 'widget';
      EModeAffichageTimeline[(EModeAffichageTimeline['grille'] = 3)] = 'grille';
      EModeAffichageTimeline[(EModeAffichageTimeline['compact'] = 4)] =
        'compact';
      EModeAffichageTimeline[(EModeAffichageTimeline['liste'] = 5)] = 'liste';
    })(
      EModeAffichageTimeline ||
        (exports.EModeAffichageTimeline = EModeAffichageTimeline = {}),
    );
  },
  fn: 'enumere_modeaffichagetimeline.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireAudio = void 0;
    require('IEHtml.Chips.js');
    const ObjetChaine_1 = require('ObjetChaine');
    const tag_1 = require('tag');
    const ObjetTraduction_1 = require('ObjetTraduction');
    exports.UtilitaireAudio = {
      IconeLecture: 'icon_play_sign',
      IconePause: 'icon_pause',
      IconeStop: 'icon_pause',
      ExceptionFichierNonValide: 0,
      construitChipsAudio: function (aInfoChips) {
        const H = [];
        const lInfosChips = Object.assign(
          {
            base64Audio: '',
            url: '',
            libelle: '',
            idChips: '',
            idAudio: '',
            ieModel: '',
            argsIEModel: [],
            classes: [],
          },
          aInfoChips,
        );
        H.push('<ie-chips');
        if (!!lInfosChips.idChips) {
          H.push(' id="', lInfosChips.idChips, '"');
        }
        if (!!lInfosChips.ieModel) {
          H.push(
            ' ',
            tag_1.tag.composeAttr(
              'ie-model',
              lInfosChips.ieModel,
              lInfosChips.argsIEModel,
            ),
          );
        }
        lInfosChips.classes.push('ChipsAudio');
        lInfosChips.classes.push('iconic', this.IconeLecture);
        if (!lInfosChips.libelle) {
          lInfosChips.classes.push('no-label');
        }
        if (!lInfosChips.ieModel) {
          lInfosChips.classes.push('avec-event');
        }
        H.push(' class="', lInfosChips.classes.join(' '), '">');
        let lSrc;
        let lType;
        if (!!lInfosChips.url) {
          lSrc = lInfosChips.url;
          let lExt = ObjetChaine_1.GChaine.extraireExtensionFichier(
            lInfosChips.url,
          );
          if (!!lExt) {
            const lTab = lExt.split('?');
            if (lTab.length > 1) {
              lExt = lTab[0];
            }
            lType = exports.UtilitaireAudio.getTypeFromExtension(lExt);
          }
        } else {
          lSrc = 'data:audio/mp3;base64,' + lInfosChips.base64Audio;
        }
        H.push(
          '<audio><source src="',
          lSrc,
          '"',
          lType ? ' type="' + lType + '"' : '',
        );
        if (!!lInfosChips.idAudio) {
          H.push(' id="', lInfosChips.idAudio, '"');
        }
        H.push('></audio>');
        H.push('<span>', lInfosChips.libelle, '</span>');
        H.push('</ie-chips>');
        return H.join('');
      },
      jouerAudio: function (aElementAudio) {
        if (!!aElementAudio && aElementAudio.duration > 0) {
          if (aElementAudio.paused) {
            aElementAudio.play();
          }
        } else {
          throw this.ExceptionFichierNonValide;
        }
      },
      pauseAudio: function (aElementAudio) {
        if (!!aElementAudio && aElementAudio.duration > 0) {
          aElementAudio.pause();
        }
      },
      stopAudio: function (aElementAudio) {
        if (!!aElementAudio && aElementAudio.duration > 0) {
          aElementAudio.currentTime = 0;
          this.pauseAudio(aElementAudio);
        }
      },
      estEnCoursDeLecture: function (aElementAudio) {
        let lEstEnCoursDeLecture = false;
        const laElementAudio = aElementAudio;
        if (!!laElementAudio && laElementAudio.duration > 0) {
          lEstEnCoursDeLecture = !laElementAudio.paused;
        }
        return lEstEnCoursDeLecture;
      },
      getTypeMimeAudio: function (
        aAvecPlusieursFormatsAudio,
        aPourVerification,
      ) {
        const lAudios = ['audio/mp3'];
        if (aPourVerification) {
          lAudios.push('audio/mpeg');
        }
        if (!!aAvecPlusieursFormatsAudio) {
          lAudios.push(
            'audio/mp4',
            'audio/ogg',
            'audio/webm',
            'audio/m4a',
            'audio/x-m4a',
          );
        }
        return lAudios.join(',');
      },
      getTypeFromExtension: function (aExtension) {
        switch (aExtension) {
          case 'mp4':
            return 'audio/m4a';
          case 'oga':
          case 'ogg':
            return 'audio/ogg';
          case 'weba':
          case 'webm':
            return 'audio/webm';
          default:
            return '';
        }
      },
      estFichierAudioValide: function (aFichier, aAvecPlusieursFormatsAudio) {
        let lResult =
          !!aFichier &&
          !!aFichier.file &&
          !!aFichier.file.type &&
          exports.UtilitaireAudio.getTypeMimeAudio(
            !!aAvecPlusieursFormatsAudio,
            true,
          ).includes(aFichier.file.type);
        if (lResult) {
          return exports.UtilitaireAudio.canPlay(aFichier.file);
        }
        return Promise.resolve(false);
      },
      canPlay: function (aFile) {
        return new Promise((aResolve) => {
          if (aFile) {
            const lAudio = new Audio();
            const reader = new FileReader();
            reader.readAsDataURL(aFile);
            reader.addEventListener('load', () => {
              lAudio.src = reader.result;
              $(lAudio).on('canplay', () => {
                aResolve(true);
              });
              $(lAudio).on('error', () => {
                aResolve(false);
              });
            });
          }
        });
      },
      messageErreurFormat: function (aFichier) {
        GApplication.getMessage().afficher({
          message: ObjetChaine_1.GChaine.format(
            ObjetTraduction_1.GTraductions.getValeur(
              'EnregistrementAudio.echecFormat',
            ),
            [aFichier.getLibelle() || ''],
          ),
        });
      },
      executeClicChipsParDefaut: function (aNodeChips) {
        $(aNodeChips)
          .toggleClass(exports.UtilitaireAudio.IconeLecture)
          .toggleClass(exports.UtilitaireAudio.IconeStop);
        const lElemAudio = $(aNodeChips).find('audio')[0];
        if (exports.UtilitaireAudio.estEnCoursDeLecture(lElemAudio)) {
          exports.UtilitaireAudio.stopAudio(lElemAudio);
        } else {
          try {
            exports.UtilitaireAudio.jouerAudio(lElemAudio);
          } catch (error) {
            if (error === exports.UtilitaireAudio.ExceptionFichierNonValide) {
              $(aNodeChips)
                .addClass(exports.UtilitaireAudio.IconeLecture)
                .removeClass(exports.UtilitaireAudio.IconeStop);
            }
          }
        }
      },
    };
  },
  fn: 'utilitaireaudio.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { TypeThemeBouton } = require('Type_ThemeBouton.js');
    const { EGenreDocumentJoint } = require('Enumere_DocumentJoint.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { GChaine } = require('ObjetChaine.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { GUID } = require('GUID.js');
    const { GStyle } = require('ObjetStyle.js');
    const { GHtml } = require('ObjetHtml.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { GDate } = require('ObjetDate.js');
    const { UtilitaireUrl } = require('UtilitaireUrl.js');
    const {
      EModeAffichageTimeline,
    } = require('Enumere_ModeAffichageTimeline.js');
    const { UtilitaireAudio } = require('UtilitaireAudio.js');
    require('UtilitaireBloc.css');
    const EGenreTitreBloc = { texte: 0, document: 1 };
    const EGenreProfondeurBloc = { petite: 0, moyenne: 1, grande: 2 };
    const EGenreBoutonBloc = {
      bouton: 0,
      texte: 1,
      selecFile: 2,
      chips: 3,
      chipsAudio: 4,
    };
    function TUtilitaireBloc() {}
    TUtilitaireBloc.compose = function (aParams) {
      const lDefault = {
        genreTitre: EGenreTitreBloc.texte,
        titre: '',
        estSelectionne: false,
        estTitreAvecEspace: true,
        estTitreMaigre: false,
        estPlie: false,
        sansContenu: false,
        htmlContenu: '',
        widthColDroite: 150,
        widthBtnAction: 120,
        eventPropagationTitre: null,
        eventPropagationSurBlocEntier: false,
        infoSousTitre: { avecInfo: false, strInfo: '' },
        infoTitre: { avecInfo: false, strInfo: '' },
        marqueurV: {
          avecMarqueur: true,
          surTitreUniquement: true,
          couleur: GCouleur.themeNeutre.sombre,
          epaisseur: 4,
        },
        documents: {
          genreRessource: aParams.genreRessourceDocumentJoint,
          avecDocuments: false,
          listeDocuments: new ObjetListeElements(),
        },
        ombre: { avecOmbre: true, profondeur: EGenreProfondeurBloc.petite },
        bordure: { avecBordure: false, couleur: GCouleur.themeNeutre.claire },
        avecArrondis: true,
        avecVoile: false,
        avecMargeGauche: true,
        avecNoWrap: false,
        couleursBloc: {
          fondBloc: '#ffffff',
          fondTitre: '#ffffff',
          fondContenu: '#ffffff',
          texteTitre: 'black',
          texteContenu: 'black',
        },
        menuContextuel: { actif: false, avecBtn3Pts: false, param: {} },
        boutonsActions: [],
      };
      const lParams = $.extend(true, {}, lDefault, aParams);
      return this.composeHtml({
        param: lParams,
        titre: this.composeTitre(lParams),
        contenu: this.composeContenu(lParams),
      });
    };
    TUtilitaireBloc.getCssProfondeur = function (aProfondeur) {
      switch (aProfondeur) {
        case EGenreProfondeurBloc.petite:
          return 'z-depth-1';
        case EGenreProfondeurBloc.moyenne:
          return 'z-depth-3';
        case EGenreProfondeurBloc.grande:
          return 'z-depth-5';
        default:
          break;
      }
    };
    TUtilitaireBloc.composeHtml = function (aParams) {
      const H = [];
      const lEstListe = aParams.param.estListe;
      const lClass = aParams.param.estSelectionne ? 'selection' : '';
      const lClassArrondis =
        aParams.param.avecArrondis && !lEstListe
          ? 'ArrondisBloc z-depth-1'
          : '';
      const lClassMargeGauche =
        aParams.param.avecMargeGauche && !lEstListe ? 'MargeGaucheBloc' : '';
      const lAvecVoile = aParams.param.avecVoile ? 'opacity:0.5;' : '';
      const lStyleBordure =
        !aParams.param.ombre.avecOmbre && aParams.param.bordure.avecBordure
          ? GStyle.composeCouleurBordure(aParams.param.bordure.couleur)
          : '';
      const lStyle = lEstListe
        ? ''
        : 'position:relative;margin: 0px 5px 10px 5px;';
      const lStyleFond = GStyle.composeCouleurFond(
        aParams.param.couleursBloc.fondBloc,
      );
      const lClassDivBloc = aParams.param.estListe
        ? 'DivBlocListe '
        : 'DivBloc ';
      const lEventStopPropagation = aParams.param.eventPropagationTitre
        ? ' ie-node="eventPropagationTitre" role="button"'
        : '';
      H.push(
        '<div style="',
        lStyle,
        lAvecVoile,
        lStyleBordure,
        lStyleFond,
        '" class="',
        lClassDivBloc,
        lClass,
        ' ',
        lClassArrondis,
        ' ',
        lClassMargeGauche,
        ' "',
        lEventStopPropagation,
        ' id="event_' +
          aParams.param.controleur.$GUID +
          '" tabindex="' +
          (aParams.param.estPlie ? '0' : '-1') +
          '">',
      );
      const lIdTitre = GUID.getId();
      const lAvecZoneAction =
        aParams.param.menuContextuel.actif ||
        aParams.param.boutonsActions.length > 0;
      const lDisplayInfoComp =
        aParams.param.infoTitre.avecInfo && aParams.param.infoTitre.strInfo
          ? 'display:block;'
          : 'display:none';
      H.push('<div class="Timeline UtilitaireBloc_containerGauche">');
      let lDisplay = aParams.param.avecDateAffichee ? '' : 'display:none;';
      H.push('<div class="UtilitaireBloc_itemGauche" style="', lDisplay, '">');
      const lDate = aParams.param.dateAffichee || new Date();
      const lCouleurBloc = GDate.estAvantJourCourant(lDate)
        ? GCouleur.themeNeutre.legere2
        : GCouleur.themeCouleur.claire;
      const lCouleurTexte = GDate.estAvantJourCourant(lDate)
        ? GCouleur.themeNeutre.foncee
        : GCouleur.themeCouleur.foncee;
      H.push(
        '<div class="UtilitaireBloc_Date AlignementMilieu ie-ellipsis ',
        lClass,
        '" style="font-weight:bold;' +
          (aParams.param.estSelectionne
            ? ''
            : GStyle.composeCouleurFond(lCouleurBloc)) +
          '">',
      );
      H.push(
        '  <span style="' + GStyle.composeCouleurTexte(lCouleurTexte) + '">',
        GDate.formatDate(lDate, '%JJ'),
        '</span>',
      );
      H.push(
        '  <span style="' + GStyle.composeCouleurTexte(lCouleurTexte) + '">',
        GDate.formatDate(lDate, '%MMM'),
        '</span>',
      );
      H.push('</div>');
      H.push('</div>');
      H.push(
        '<div class="UtilitaireBloc_itemGauche" role="group" aria-labelledby="' +
          lIdTitre +
          '">',
      );
      H.push(
        '<div class="AvecMain UtilitaireBloc_containerInverse" style="',
        aParams.param.avecNoWrap ? 'flex-wrap:nowrap;' : '',
        '" id="' + lIdTitre + '">',
      );
      H.push(
        '<div class="UtilitaireBloc_itemInverse" style="display:inline-flex">',
      );
      H.push(this.composeCelluleMarqueur(aParams, false, false));
      const lMinWidth = aParams.param.infoTitre.minWidth
        ? 'min-width:' + aParams.param.infoTitre.minWidth + ';'
        : 'min-width:150px;';
      H.push(
        '<div style="color : ',
        aParams.param.couleursBloc.texteTitre,
        '; ',
        GStyle.composeWidthCalc(aParams.param.marqueurV.epaisseur),
        '">',
        aParams.titre,
        '</div></div>',
        '<div style="',
        lMinWidth,
        'color : ',
        aParams.param.couleursBloc.texteTitre,
        ';',
        lDisplayInfoComp,
        '" class="UtilitaireBloc_itemInverse Bloc_InfoCompl',
        aParams.param.infoTitre.avecInfo && aParams.param.infoTitre.alignement
          ? ' ' + aParams.param.infoTitre.alignement
          : ' AlignementDroit AlignementHaut EspaceHaut',
        '">',
        aParams.param.infoTitre.avecInfo
          ? aParams.param.infoTitre.strInfo
          : '&nbsp;',
        '</div>',
      );
      H.push('</div>');
      lDisplay = aParams.param.estPlie === true ? 'display:none; ' : '';
      let lPropagation = aParams.param.eventPropagationSurBlocEntier
        ? ''
        : 'onclick="event.stopPropagation();"';
      H.push(
        '<div class="elementPliable " style="',
        lDisplay,
        '" ',
        lPropagation,
        '>',
      );
      const lDisplayActions = lAvecZoneAction
        ? 'display:block'
        : 'display:none';
      if (aParams.param.sansContenu !== true) {
        const lClassVertical =
          aParams.param.modeAffichage === EModeAffichageTimeline.grille
            ? 'containerVertical'
            : '';
        H.push(
          '<div class="UtilitaireBloc_containerNormal ',
          lClassVertical,
          '" style="',
          aParams.param.avecNoWrap ? 'flex-wrap:nowrap;' : '',
          '">',
        );
        H.push(
          '<div class="Bloc_Contenu UtilitaireBloc_itemNormal">',
          '<div>',
          aParams.contenu,
          '</div>',
          '</div>',
        );
        lPropagation = aParams.param.eventPropagationSurBlocEntier
          ? 'onclick="event.stopPropagation();"'
          : '';
        H.push(
          '<div class="UtilitaireBloc_itemNormal" style="',
          lDisplayActions,
          ' ',
          '" ',
          lPropagation,
          '>',
          lAvecZoneAction ? this.composeZoneBoutonsAction(aParams) : '',
          '</div>',
        );
        H.push('</div>');
        if (aParams.param.documents.avecDocuments) {
          H.push('<div>' + this.composeEspaceDocuments(aParams) + '</div>');
        }
      }
      H.push('</div>');
      H.push('</div>');
      H.push('</div>');
      return H.join('');
    };
    TUtilitaireBloc.composeCelluleMarqueur = function (
      aParams,
      avecTop,
      avecBottom,
    ) {
      const H = [];
      if (aParams.param.marqueurV.avecMarqueur) {
        const lArrondiTop = avecTop ? 'border-top-left-radius: 20px 30px;' : '';
        const lArrondiBottom = avecBottom
          ? 'border-bottom-left-radius: 20px 30px;'
          : '';
        H.push(
          '<div class="celluleMarqueur" style="width:',
          aParams.param.marqueurV.epaisseur,
          'px; background-color:',
          aParams.param.marqueurV.couleur,
          '; ',
          lArrondiTop,
          ' ',
          lArrondiBottom,
          ' border-radius:3px;">&nbsp;</div>',
        );
      }
      return H.join('');
    };
    TUtilitaireBloc.composeBtnAction = function (aBouton, aNumeroArticle) {
      const H = [];
      const lArrayAttr = [];
      lArrayAttr.push(aBouton.genreBtn);
      if (aNumeroArticle !== undefined) {
        lArrayAttr.push(aNumeroArticle);
      }
      const lIdBtnAction = GUID.getId();
      const lClassesBouton = [];
      lClassesBouton.push(TypeThemeBouton.secondaire);
      lClassesBouton.push('small-bt');
      let lGenreAffichageBouton = aBouton.genreAffichage;
      if (lGenreAffichageBouton === undefined) {
        lGenreAffichageBouton = EGenreBoutonBloc.bouton;
      }
      if (lGenreAffichageBouton === EGenreBoutonBloc.bouton) {
        H.push(
          '<ie-bouton id="',
          lIdBtnAction,
          '" ',
          GHtml.composeAttr('ie-model', 'btnAction', lArrayAttr),
          ' class="',
          lClassesBouton.join(' '),
          '">',
          aBouton.libelle,
          '</ie-bouton>',
        );
      } else if (lGenreAffichageBouton === EGenreBoutonBloc.selecFile) {
        H.push(
          '<ie-bouton id="',
          lIdBtnAction,
          '" ',
          GHtml.composeAttr('ie-model', 'btnSelecFile', lArrayAttr),
          ' ie-selecfile class="',
          lClassesBouton.join(' '),
          '">',
          aBouton.libelle,
          '</ie-bouton>',
        );
      } else if (lGenreAffichageBouton === EGenreBoutonBloc.texte) {
        H.push(
          '<div id="',
          lIdBtnAction,
          '" class="btn-texte">',
          aBouton.libelle,
          '</div>',
        );
      } else if (lGenreAffichageBouton === EGenreBoutonBloc.chips) {
        H.push(
          '<div><ie-chips ',
          GHtml.composeAttr('ie-model', 'chipsAction', lArrayAttr),
          '>',
          aBouton.libelle,
          '</ie-chips></div>',
        );
      } else if (lGenreAffichageBouton === EGenreBoutonBloc.chipsAudio) {
        H.push(
          '<div>',
          UtilitaireAudio.construitChipsAudio({
            libelle: aBouton.libelle,
            url: aBouton.url,
            ieModel: 'chipsAudio',
            argsIEModel: aBouton.argsIEModel,
            idAudio: aBouton.id,
            estLien: true,
          }),
          '</div>',
        );
      }
      return H.join('');
    };
    TUtilitaireBloc.composeEspaceDocumentsTitre = function (aParam) {
      const H = [];
      const lElement = aParam.titre.document;
      const lDocumentJoint = new ObjetElement(
        lElement.getLibelle(),
        lElement.getNumero(),
        EGenreDocumentJoint.Fichier,
      );
      const lLien = GChaine.composerUrlLienExterne({
        documentJoint: lDocumentJoint,
        genreRessource: lElement.getGenre(),
      });
      let lEvnt = '';
      if (aParam.titre.avecEvnt === true) {
        lEvnt =
          'onclick="' + aParam.titre.pereEvnt.Nom + '.evntSurDocumentTitre()"';
      }
      H.push('<div class="InlineBlock" ', lEvnt, '>' + lLien + '</div>');
      return H.join('');
    };
    TUtilitaireBloc.composeEspaceDocuments = function (aParam) {
      const H = [];
      let lListeDocuments = '';
      if (!!aParam.param.documents && !!aParam.param.documents.listeDocuments) {
        lListeDocuments = UtilitaireUrl.construireListeUrls(
          aParam.param.documents.listeDocuments,
          { genreRessource: aParam.param.documents.genreRessource },
        );
      }
      H.push(
        '<div style="',
        GStyle.composeCouleurFond(GCouleur.fond),
        'margin:.8rem .4rem .8rem 0;">',
      );
      H.push(
        '<div style="',
        GStyle.composeCouleurTexte(GCouleur.grisTresFonce),
        '">',
        GTraductions.getValeur('Bloc.Documents'),
        '</div>',
      );
      H.push(
        '<div style="word-break: break-all;">',
        lListeDocuments,
        ' </div>',
      );
      H.push('</div>');
      return H.join('');
    };
    TUtilitaireBloc.composeZoneBoutonsAction = function (aParams) {
      const lParamBtn = {
        libelle:
          aParams.param.menuContextuel.libelle ||
          GTraductions.getValeur('Editer'),
      };
      const H = [];
      const lIdBtn = GUID.getId();
      H.push('<div class="zone-boutons-action">');
      if (aParams.param.menuContextuel.actif) {
        if (IE.estMobile || aParams.param.menuContextuel.avecBtn3Pts) {
          const lVisibility = aParams.param.menuContextuel.estMasque
            ? 'hidden'
            : 'visible';
          H.push(
            '<ie-btnimage id="',
            lIdBtn,
            '" ie-model="btnMenuCtx" class="btnImageIcon icon_ellipsis_vertical" style="padding:1rem; ',
            IE.estMobile ? 'font-size:1.2rem;' : 'font-size:2rem;',
            ' color: ',
            GCouleur.themeCouleur.foncee,
            '; visibility:',
            lVisibility,
            '"></ie-btnimage>',
          );
        } else {
          H.push(
            '<ie-bouton id="',
            lIdBtn,
            '" ie-model="btnMenuCtx" class="small-bt">',
            lParamBtn.libelle,
            '</ie-bouton>',
          );
        }
      }
      if (
        !!aParams.param.boutonsActions &&
        aParams.param.boutonsActions.length > 0
      ) {
        aParams.param.boutonsActions.forEach((aBouton) => {
          H.push(this.composeBtnAction(aBouton));
        });
      }
      H.push('</div>');
      return H.join('');
    };
    TUtilitaireBloc.composeTitre = function (aParams) {
      const H = [];
      H.push(
        '<div class="Bloc_Titre_container ',
        aParams.estTitreAvecEspace ? 'Espace' : 'EspaceGauche EspaceDroit',
        '">',
      );
      const lClass = aParams.estTitreMaigre
        ? 'Bloc_Titre_Maigre'
        : 'Bloc_Titre';
      H.push('<div class="', lClass, '">');
      switch (aParams.genreTitre) {
        case EGenreTitreBloc.document:
          H.push(this.composeEspaceDocumentsTitre(aParams));
          break;
        default:
          H.push(aParams.titre ? aParams.titre : '&nbsp;');
          break;
      }
      H.push('</div>');
      if (aParams.infoSousTitre.avecInfo) {
        H.push('<div class="Bloc_SSTitre">');
        H.push(aParams.infoSousTitre.strInfo);
        H.push('</div>');
      }
      H.push('</div>');
      return H.join('');
    };
    TUtilitaireBloc.composeContenu = function (aParams) {
      const H = [];
      if (
        aParams.htmlContenu !== '' &&
        aParams.htmlContenu !== undefined &&
        aParams.htmlContenu !== null
      ) {
        H.push(
          '<div style="color : ',
          aParams.couleursBloc.texteContenu,
          '; height:100%;" >',
        );
        H.push(aParams.htmlContenu);
        H.push('</div>');
      } else {
        H.push(this.composeMsgAucuneDonnee(aParams));
      }
      return H.join('');
    };
    TUtilitaireBloc.composeMsgAucuneDonnee = function (aParams) {
      const H = [];
      H.push(
        '<div class="PetitEspace Italique" style="margin: 3px;">',
        aParams.msg ? aParams.msg : '',
        '</div>',
      );
      return H.join('');
    };
    module.exports = {
      TUtilitaireBloc,
      EGenreTitreBloc,
      EGenreProfondeurBloc,
      EGenreBoutonBloc,
    };
  },
  fn: 'utilitairebloc.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { Identite } = require('ObjetIdentite.js');
    const { TUtilitaireBloc } = require('UtilitaireBloc.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { EGenreTitreBloc } = require('UtilitaireBloc.js');
    const { EGenreProfondeurBloc } = require('UtilitaireBloc.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { ObjetInterface } = require('ObjetInterface.js');
    const {
      EModeAffichageTimeline,
    } = require('Enumere_ModeAffichageTimeline.js');
    const { GHtml } = require('ObjetHtml.js');
    class GestionnaireBlocDeBase extends Identite {
      constructor(...aParams) {
        super(...aParams);
        this._instances = [];
        this._options = {};
      }
      setOptions(aOptions) {
        $.extend(this._options, aOptions);
      }
      instancierObjetMetier(
        aDataBloc,
        aConstructeurObjMetier,
        aParamObjMetier,
      ) {
        const lIndiceObjMetier = this._instances.length;
        $.extend(aDataBloc, {
          indiceInstanceMetier: lIndiceObjMetier,
          estSelectionne: false,
        });
        this._instances[lIndiceObjMetier] = new aConstructeurObjMetier(
          this.Nom + '._instances',
          lIndiceObjMetier,
          aParamObjMetier.pere,
          aParamObjMetier.evenement,
        );
        this._instances[lIndiceObjMetier].setParametres(
          aDataBloc,
          this._options,
        );
        return this._instances[lIndiceObjMetier];
      }
      getInstanceObjetMetier(aDataBloc, aConstructeurObjMetier) {
        const lIndice = aDataBloc.indiceInstanceMetier;
        if (
          lIndice !== null &&
          lIndice !== undefined &&
          this._instances[lIndice] !== null &&
          this._instances[lIndice] !== undefined
        ) {
          return this._instances[lIndice];
        } else {
          return this.instancierObjetMetier(aDataBloc, aConstructeurObjMetier, {
            pere: this,
            evenement: this.surEvntMetier.bind(this),
          });
        }
      }
      surEvntMetier(aDataBloc, aGenreEvnt, aParam) {
        if (this.Pere && this.Evenement) {
          this.callback.appel(aDataBloc, aGenreEvnt, aParam);
        }
      }
      composeZoneInstance(aInstance) {
        return (
          '<div id="' +
          aInstance.getNom() +
          '" tabindex="0" class="container-bloc"></div>'
        );
      }
      composeBloc() {}
      refresh() {
        const lNbr = this._instances.length;
        for (let i = 0; i < lNbr; i++) {
          this.refreshInstance(i);
        }
      }
      refreshInstance(aIndice) {
        const lInstance = this._instances[aIndice];
        if (lInstance !== null && lInstance !== undefined) {
          lInstance.initialiser();
        }
      }
      reinit() {
        const lNbr = this._instances.length;
        for (let i = 0; i < lNbr; i++) {
          this.reInitInstance(i);
        }
        this._instances = [];
      }
      reInitInstance(aIndice) {
        const lInstance = this._instances[aIndice];
        const lNomInstance = lInstance.getNom();
        if (lInstance && !lInstance._estDetruite && lInstance.free) {
          lInstance.free();
        }
        this._instances[aIndice] = null;
        return lNomInstance;
      }
      setDataInstance(aIndice, aDataBloc) {
        const lInstance = this._instances[aIndice];
        if (lInstance !== null && lInstance !== undefined) {
          lInstance.setParametres(aDataBloc, this._options);
          lInstance.initialiser();
        }
      }
      getInstanceObjetMetierDeNumeroDataBloc(aNumeroDataBloc) {
        for (let i = 0, lNbr = this._instances.length; i < lNbr; i++) {
          const lInstance = this._instances[i];
          if (lInstance !== null && lInstance !== undefined) {
            const lDataBloc = lInstance.donnee;
            if (lDataBloc !== null && lDataBloc !== undefined) {
              if (lDataBloc.getNumero() === aNumeroDataBloc) {
                return lInstance;
              }
            }
          }
        }
      }
      rafraichirBloc(aDataBloc) {
        const lEltBloc = this.composeBlocComplet(aDataBloc);
        GHtml.setHtml(aDataBloc.idBloc, lEltBloc.html, {
          controleur: lEltBloc.controleur,
        });
        this.refreshInstance(aDataBloc.indiceInstanceMetier);
      }
    }
    class GestionnaireBloc extends GestionnaireBlocDeBase {
      constructor(...aParams) {
        super(...aParams);
        this._options = { avecZoneAction: true, avecPastille: false };
      }
      setGenreBloc(aGenreBloc) {
        this.GenreBloc = aGenreBloc;
      }
      saisGererBloc(aDataBloc) {
        return aDataBloc.genreBloc === this.GenreBloc;
      }
      getParamsBloc() {
        return {};
      }
      setConstructeurBloc(aConstructeurBloc) {
        this.constructeurBloc = aConstructeurBloc;
      }
      setUtilitaires(aUtilitaires) {
        this.utilitaires = aUtilitaires;
      }
      composeBlocComplet(aDataBloc) {
        const lParamBloc = Object.assign(
          {
            estSelectionne: aDataBloc.estSelectionne,
            dateAffichee: aDataBloc.DateDebut,
          },
          this.getParamsBloc(aDataBloc),
        );
        lParamBloc.genreRessourceDocumentJoint =
          this.getRessourceDocumentJoint();
        return {
          html: TUtilitaireBloc.compose(lParamBloc),
          controleur: lParamBloc.controleur,
        };
      }
      getRessourceDocumentJoint() {
        return this.utilitaires.genreRessource.getRessourceDocumentJoint();
      }
      getRessourceAucune() {
        return this.utilitaires.genreRessource.getRessourceAucune();
      }
      memoriserContexteAvantRedirection() {}
      redirection(aOnglet, aGenreRessource, aNumeroDataBloc, aEvent) {
        this.memoriserContexteAvantRedirection(aNumeroDataBloc);
        const lPage = { Onglet: aOnglet };
        if (aGenreRessource !== this.getRessourceAucune()) {
          $.extend(lPage, { ressource: aGenreRessource });
        }
        GEtatUtilisateur.setPage(lPage);
        if (GEtatUtilisateur.getGenreOnglet()) {
          const lOnglet = new ObjetElement(
            '',
            0,
            GEtatUtilisateur.getGenreOnglet(),
          );
          if (GInterface.getInstance(GInterface.IdentBandeauEntete)) {
            GInterface.getInstance(
              GInterface.IdentBandeauEntete,
            ).evenementSurMenuOnglets(lOnglet);
          }
        }
        aEvent.stopPropagation();
      }
      getInfosPastille() {}
      getAvecPastille() {
        return this._options.avecPastille;
      }
      setDataPastille(aData) {
        this.dataPastille = aData;
      }
      getDataPastille() {
        return this.dataPastille;
      }
    }
    class ObjetBloc extends ObjetInterface {
      constructor(...aParams) {
        super(...aParams);
        this.donneesRecues = false;
        this._options = {};
      }
      setUtilitaires(aUtilitaires) {
        this.utilitaires = aUtilitaires;
      }
      setParametres(aElement, aOptions) {
        this.donneesRecues = true;
        this._options = $.extend(this._options, aOptions);
        this.donnee = aElement;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          eventPropagationTitre() {
            $(this.node).eventValidation((aEvent) => {
              aInstance.eventPropagationTitre(aEvent);
            });
          },
        });
      }
      memoriserContexteAvantRedirection() {}
      getParamsBloc() {
        return {
          estListe: this.getAvecDateAffichee(),
          controleur: this.controleur,
          titre: this.getTitre(),
          estTitreAvecEspace: this.estTitreAvecEspace(),
          estTitreMaigre: this.avecTitreMaigre(),
          infoSousTitre: this.getInfoSsTitre(),
          infoTitre: this.getInfoTitre(),
          widthColDroite: this.getWidthColDroite(),
          widthBtnAction: this.getWidthBtnAction(),
          eventParDefaut: this.getEventParDefaut(),
          marqueurV: {
            couleur: this.getCouleurMarqueur(),
            avecMarqueur: this.getAvecMarqueurV(),
            epaisseur: this.getEpaisseurMarqueur(),
          },
          avecArrondis: this.getAvecArrondis(),
          avecDateAffichee: this.getAvecDateAffichee(),
          avecMargeGauche: this.getAvecMargeGauche(),
          avecNoWrap: this.getAvecNoWrap(),
          couleursBloc: {
            fondBloc: this.getCouleurFondBloc(),
            texteBloc: this.getCouleurTexteBloc(),
            fondTitre: this.getCouleurFondTitre(),
            fondContenu: this.getCouleurFondContenu(),
            texteTitre: this.getCouleurTexteTitre(),
            texteContenu: this.getCouleurTexteContenu(),
          },
          ombre: {
            avecOmbre: this.avecOmbre(),
            profondeur: this.getProfondeurOmbre(),
          },
          bordure: {
            avecBordure: this.avecBordure(),
            couleur: this.couleurBordure(),
          },
          menuContextuel: {
            actif: this.avecMenuContextuel(),
            libelle: this.libelleMenuContextuel(),
            avecBtn3Pts: this.avecMenuContextuelBtn3Pts(),
            estMasque: this.estMenuContextuelMasque(),
            param: { pere: this },
          },
          documents: {
            genreRessource: this.getGenreRessourceDocuments(),
            avecDocuments: this.getAvecDocuments(),
            listeDocuments: this.getListeDocuments(),
          },
          boutonsActions: this.getTabBtnActions(),
          avecVoile: this.avecVoile(),
          estPlie: this.estBlocFerme(),
          eventPropagationTitre: this.eventPropagationTitre
            ? this.Nom + '.eventPropagationTitre'
            : null,
          eventPropagationSurBlocEntier:
            this.getEventPropagationSurBlocEntier(),
          modeAffichage: this._options.modeAffichage,
        };
      }
      getCouleurMarqueur() {
        return GCouleur.themeNeutre.sombre;
      }
      getAvecMarqueurV() {
        return this._options.modeAffichage !== EModeAffichageTimeline.compact;
      }
      getAvecArrondis() {
        return this._options.modeAffichage !== EModeAffichageTimeline.compact;
      }
      getAvecDateAffichee() {
        return this._options.modeAffichage === EModeAffichageTimeline.liste;
      }
      getAvecMargeGauche() {
        return !IE.estMobile;
      }
      getAvecNoWrap() {
        return false;
      }
      getEpaisseurMarqueur() {
        return 3;
      }
      getCouleurFondBloc() {
        return GCouleur.blanc;
      }
      getCouleurTexteBloc() {
        return GCouleur.themeCouleur.foncee;
      }
      getCouleurFondTitre() {
        return '#ffffff';
      }
      getCouleurFondContenu() {
        return '#ffffff';
      }
      getCouleurTexteTitre() {
        return 'black';
      }
      getCouleurTexteContenu() {
        return 'black';
      }
      avecVoile() {
        return false;
      }
      avecOmbre() {
        return true;
      }
      avecBordure() {
        return false;
      }
      couleurBordure() {
        return GCouleur.themeNeutre.claire;
      }
      estBlocFerme() {
        return false;
      }
      getEventPropagationSurBlocEntier() {
        return false;
      }
      getProfondeurOmbre() {
        return EGenreProfondeurBloc.petite;
      }
      getGenreTitre() {
        return EGenreTitreBloc.texte;
      }
      getTitre(aTitre) {
        if (this.getGenreTitre() === EGenreTitreBloc.texte) {
          let lResult = aTitre !== null && aTitre !== undefined ? aTitre : '';
          if (lResult === '') {
            lResult = GTraductions.getValeur('SansTitre');
          }
          return lResult;
        }
        return new ObjetElement();
      }
      avecTitreMaigre() {
        return false;
      }
      estTitreAvecEspace() {
        return true;
      }
      getInfoSsTitre() {
        const lStrSsTitre = [];
        return { avecInfo: false, strInfo: lStrSsTitre.join('') };
      }
      getInfoTitre() {
        const lAvecInfo = false;
        const lStrInfo = [];
        return { avecInfo: lAvecInfo, strInfo: lStrInfo.join('') };
      }
      getGenreRessourceDocuments() {
        return this.utilitaires.genreRessource.getRessourceDocumentJoint();
      }
      getAvecDocuments() {
        return false;
      }
      getListeDocuments() {
        return new ObjetListeElements();
      }
      getWidthColDroite(aValeur) {
        if (
          this._options !== null &&
          this._options !== undefined &&
          this._options.avecZoneAction === false &&
          this.getInfoTitre().avecInfo === false
        ) {
          return 0;
        }
        return aValeur;
      }
      getEventParDefaut() {
        return 'toggleElement';
      }
      getWidthBtnAction(aValeur) {
        if (
          this._options !== null &&
          this._options !== undefined &&
          this._options.avecZoneAction === false
        ) {
          return 0;
        }
        return aValeur;
      }
      avecMenuContextuel(aValeur) {
        if (
          this._options !== null &&
          this._options !== undefined &&
          this._options.avecZoneAction === false
        ) {
          return false;
        }
        return aValeur !== null && aValeur !== undefined ? aValeur : false;
      }
      libelleMenuContextuel() {
        return GTraductions.getValeur('Editer');
      }
      avecMenuContextuelBtn3Pts() {
        return false;
      }
      estMenuContextuelMasque() {
        return false;
      }
      getTabBtnActions() {
        const lResult = [];
        return lResult;
      }
      estEspaceParent(aGenreEspace) {
        return this.utilitaires.genreEspace.estEspaceParent(aGenreEspace);
      }
    }
    module.exports = { GestionnaireBlocDeBase, GestionnaireBloc, ObjetBloc };
  },
  fn: 'gestionnairebloc.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { GestionnaireBloc } = require('GestionnaireBloc.js');
    const { ObjetBloc } = require('GestionnaireBloc.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    const { EGenreEspace } = require('Enumere_Espace.js');
    const {
      TypeGenreReponseInternetActualite,
    } = require('TypeGenreReponseInternetActualite.js');
    class UtilitaireGenreRessource {
      constructor() {}
      getRessourceDocumentJoint() {
        return EGenreRessource.DocumentJoint;
      }
      getRessourceAucune() {
        return EGenreRessource.Aucune;
      }
      getRessourceDocJointEtablissement() {
        return EGenreRessource.DocJointEtablissement;
      }
      getRessourceEleve() {
        return EGenreRessource.Eleve;
      }
      getRessourceParent() {
        return EGenreRessource.Responsable;
      }
      getRessourceProf() {
        return EGenreRessource.Enseignant;
      }
      getRessourcePersonnel() {
        return EGenreRessource.Personnel;
      }
      getRessourceEntreprise() {
        return EGenreRessource.MaitreDeStage;
      }
      getRessourceInspecteur() {
        return EGenreRessource.InspecteurPedagogique;
      }
      getRessourceClasse() {
        return EGenreRessource.Classe;
      }
      getRessourceGroupe() {
        return EGenreRessource.Groupe;
      }
    }
    class UtilitaireGenreEspace {
      constructor() {}
      estEspaceParent(aGenreEspace) {
        return [
          EGenreEspace.Parent,
          EGenreEspace.Mobile_Parent,
          EGenreEspace.PrimParent,
          EGenreEspace.Mobile_PrimParent,
        ].includes(aGenreEspace);
      }
      estEspaceEntreprise(aGenreEspace) {
        return [EGenreEspace.Entreprise].includes(aGenreEspace);
      }
      estPourPrimaire() {
        return GEtatUtilisateur.pourPrimaire();
      }
    }
    class UtilitaireGenreReponse {
      constructor() {}
      estGenreSansReponse(aGenreReponse) {
        return [TypeGenreReponseInternetActualite.SansReponse].includes(
          aGenreReponse,
        );
      }
      estGenreChoixMultiple(aGenreReponse) {
        return [TypeGenreReponseInternetActualite.ChoixMultiple].includes(
          aGenreReponse,
        );
      }
      estGenreChoixUnique(aGenreReponse) {
        return [TypeGenreReponseInternetActualite.ChoixUnique].includes(
          aGenreReponse,
        );
      }
      estGenreTextuelle(aGenreReponse) {
        return [TypeGenreReponseInternetActualite.Textuelle].includes(
          aGenreReponse,
        );
      }
      estGenreAvecAR(aGenreReponse) {
        return [TypeGenreReponseInternetActualite.AvecAR].includes(
          aGenreReponse,
        );
      }
      estGenreSansAR(aGenreReponse) {
        return [TypeGenreReponseInternetActualite.SansAR].includes(
          aGenreReponse,
        );
      }
      getGenreSansReponse() {
        return TypeGenreReponseInternetActualite.SansReponse;
      }
      getGenreChoixMultiple() {
        return TypeGenreReponseInternetActualite.ChoixMultiple;
      }
      getGenreChoixUnique() {
        return TypeGenreReponseInternetActualite.ChoixUnique;
      }
      getGenreTextuelle() {
        return TypeGenreReponseInternetActualite.Textuelle;
      }
      getGenreAvecAR() {
        return TypeGenreReponseInternetActualite.AvecAR;
      }
      getGenreSansAR() {
        return TypeGenreReponseInternetActualite.SansAR;
      }
    }
    class GestionnaireBlocPN extends GestionnaireBloc {
      constructor(...aParams) {
        super(...aParams);
        this.setUtilitaires({ genreRessource: new UtilitaireGenreRessource() });
      }
    }
    class ObjetBlocPN extends ObjetBloc {
      constructor(...aParams) {
        super(...aParams);
        this.setUtilitaires({ genreRessource: new UtilitaireGenreRessource() });
      }
    }
    module.exports = {
      GestionnaireBlocPN,
      UtilitaireGenreRessource,
      UtilitaireGenreEspace,
      UtilitaireGenreReponse,
      ObjetBlocPN,
    };
  },
  fn: 'gestionnaireblocpn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    require('ObjetVignette.css');
    const { Identite } = require('ObjetIdentite.js');
    const { GUID } = require('GUID.js');
    const { GHtml } = require('ObjetHtml.js');
    const { EGenreEtat } = require('Enumere_Etat.js');
    const { EGenreBoiteMessage } = require('Enumere_BoiteMessage.js');
    const { EGenreAction } = require('Enumere_Action.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { GChaine } = require('ObjetChaine.js');
    const { EGenreDocumentJoint } = require('Enumere_DocumentJoint.js');
    const {
      EFormatDocJoint,
      EFormatDocJointUtil,
    } = require('Enumere_FormatDocJoint.js');
    const ETypeEtatVignette = {
      survol: 'survol',
      selectionne: 'selectionne',
      nonSelectionne: 'nonSelectionne',
    };
    const ETypeEvntVignette = {
      suppression: 'suppression',
      editionLegende: 'editionLegende',
      selectionVignette: 'selectionVignette',
    };
    class ObjetVignette extends Identite {
      constructor(...aParams) {
        super(...aParams);
        this.ids = { vignette: GUID.getId() };
        this.default = {
          largeur: 150,
          hauteur: 150,
          hauteurEntete: 30,
          avecImage: false,
          avecImgViewer: true,
          estDiapo: false,
          avecEtiquette: false,
          avecSelection: true,
          avecSurvol: true,
          avecSuppression: false,
          avecEditionLegende: false,
          sansBlocLibelle: false,
          altImage: '',
        };
        this.estSurvole = false;
        this.estSelectionne = false;
        this.donneesRecues = false;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getNodeVignette: function () {
            if (aInstance.param.avecSurvol === true) {
              const lMap = {
                mouseover: function () {
                  this.estSurvole = true;
                  _actualiserSelonEtat.call(this);
                }.bind(aInstance),
                mouseout: function () {
                  this.estSurvole = false;
                  _actualiserSelonEtat.call(this);
                }.bind(aInstance),
              };
              $(this.node).on(lMap);
            }
          },
          cbSelection: {
            getValue: function () {
              return aInstance.donnees.data.estSelectionne;
            },
            setValue: function (aValue) {
              if (aInstance.param.avecSelection) {
                const lData = aInstance.donnees.data;
                lData.estSelectionne = aValue;
                aInstance.estSelectionne = aValue;
                _actualiserSelonEtat.call(aInstance);
                aInstance.callback.appel({
                  evnt: ETypeEvntVignette.selectionVignette,
                  data: lData,
                  estSelectionne: aValue,
                });
              }
            },
          },
          estCbSelectionVisible: function () {
            return aInstance.param.avecSelection;
          },
          btnSuppr: {
            event(aEvent) {
              const lMsg = GTraductions.getValeur('MsgConfirmSupprDe', [
                aInstance.donnees.data.libelle ||
                  (aInstance.donnees.data.documentCasier
                    ? aInstance.donnees.data.documentCasier.getLibelle()
                    : ''),
              ]);
              GApplication.getMessage().afficher({
                type: EGenreBoiteMessage.Confirmation,
                message: lMsg,
                callback: function (aAccepte) {
                  aInstance.evntSuppr(aAccepte);
                },
              });
              aEvent.stopPropagation();
            },
          },
          legendeVignette: {
            getValue: function () {
              return !!aInstance.donnees ? aInstance.donnees.data.libelle : '';
            },
            setValue: function (aValue) {
              aInstance.donnees.data.libelle = aValue;
              aInstance.donnees.data.libelleEnModification = true;
            },
          },
          getNodePhoto: function () {
            const lMap = {
              click: function () {
                _ouvrirLien.call(this);
              }.bind(aInstance),
              error: function () {
                $(this)
                  .parent()
                  .append(
                    '<div style="text-align:center; width:100%;" ie-node="getNodeDoc"><i class="icon_warning_sign" style="font-size:30px;"></i></div>',
                  );
                $(this)
                  .parent()
                  .on({
                    click: function () {
                      _ouvrirLien.call(this);
                    }.bind(aInstance),
                  });
                $(this).remove();
              },
            };
            $(this.node).on(lMap);
          },
          getNodeDoc: function () {
            const lMap = {
              click: function () {
                _ouvrirLien.call(this);
              }.bind(aInstance),
            };
            $(this.node).on(lMap);
          },
        });
      }
      setParam(aParam) {
        this.param = $.extend(this.default, aParam);
      }
      setDonnees(aParam) {
        this.donneesRecues = true;
        this.donnees = aParam;
        this.data = aParam.data;
        if (
          this.data.estSelectionne !== null &&
          this.data.estSelectionne !== undefined
        ) {
          this.estSelectionne = this.data.estSelectionne;
        }
      }
      afficher() {
        const H = [];
        if (this.donneesRecues) {
          const lHeight =
            this.param.avecImage && this.param.hauteur > 0
              ? 'height:' + this.param.hauteur + 'px;'
              : '';
          const lWidth =
            this.param.avecImage && this.param.largeur > 0
              ? 'width:' + this.param.largeur + 'px;'
              : '';
          const lHautLien = this.param.hauteurEntete;
          H.push(
            '<div class="vignette ',
            this.param.estDiapo ? ' modeDiapo ' : '',
            ' nonSelectionne" id="',
            this.ids.vignette,
            '" ',
            GHtml.composeAttr('ie-node', 'getNodeVignette'),
            ' style="',
            lWidth,
            '">',
          );
          if (this.param.avecImage) {
            H.push('<div class="zoneImage" style="', lHeight, '">');
            if (this.donnees.estImg === true) {
              const lLibelleImgViewer = this.donnees.data.libelle;
              H.push(
                '<img ie-load-src="',
                this.donnees.lien,
                '" ',
                this.param.avecImgViewer
                  ? ' ie-imgviewer '
                  : 'ie-node="getNodePhoto" ',
                this.param.avecImgViewer
                  ? 'data-libelle="' +
                      GChaine.toAttrValue(lLibelleImgViewer) +
                      '"'
                  : '',
                ' alt="',
                GChaine.toAttrValue(this.param.altImage || lLibelleImgViewer),
                '" tabindex="0"/>',
              );
            } else {
              let lIcon = '';
              const lGenreFichier = EFormatDocJointUtil.getGenreDeFichier(
                GChaine.extraireExtensionFichier(
                  this.donnees.data.documentCasier.getLibelle(),
                ),
              );
              if (lGenreFichier !== EFormatDocJoint.Inconnu) {
                lIcon = EFormatDocJointUtil.getClassIconDeGenre(lGenreFichier);
              } else {
                if (
                  this.donnees.data.documentCasier.getGenre() ===
                  EGenreDocumentJoint.Cloud
                ) {
                  lIcon = 'icon_cloud';
                } else if (
                  this.donnees.data.documentCasier.getGenre() ===
                  EGenreDocumentJoint.Url
                ) {
                  lIcon = 'icon_globe';
                } else if (
                  this.donnees.data.documentCasier.getGenre() ===
                  EGenreDocumentJoint.LienKiosque
                ) {
                  lIcon = 'icon_external_link';
                } else if (
                  this.donnees.data.documentCasier.getGenre() ===
                  EGenreDocumentJoint.LienVisio
                ) {
                  lIcon = 'icon_cours_virtuel';
                } else {
                  lIcon = 'icon_file_alt';
                }
              }
              const lTaillePoliceIcone = this.param.taillePoliceIcone;
              H.push(
                '<div class="docs-wrapper" ie-node="getNodeDoc">',
                '<i class="',
                lIcon,
                '" style="font-size:',
                lTaillePoliceIcone,
                'px;"></i>',
                this.param.avecSelection
                  ? '<div class="libelle m-top-l ellipsis-multilignes" title="' +
                      this.donnees.data.libelle +
                      '">' +
                      this.donnees.data.libelle +
                      '</div>'
                  : '',
                '</div>',
              );
            }
            if (this.param.avecEtiquette && this.donnees.strEtiquette) {
              H.push(
                '<ie-chips class="etiquette tag-style color-theme">',
                this.donnees.strEtiquette,
                '</ie-chips>',
              );
            }
            if (this.param.avecSelection) {
              H.push(
                '<ie-checkbox class="actionHautDroite" ie-model="cbSelection" ie-display="estCbSelectionVisible"></ie-checkbox>',
              );
            } else if (this.param.avecSuppression) {
              H.push(
                '<ie-btnicon ie-model="btnSuppr" class="icon_remove actionHautDroite"></ie-btnicon>',
              );
            }
            H.push('</div>');
          }
          if (!this.param.avecSelection && !this.param.sansBlocLibelle) {
            H.push(
              '<div style="height:',
              lHautLien,
              'px;" class="zoneLibelle',
              this.param.avecImage ? '' : ' sansImage',
              this.param.avecEditionLegende ? ' edit' : '',
              !this.param.avecSelection ? ' centrer' : '',
              '">',
            );
            if (this.param.avecEditionLegende) {
              H.push('<div class="m-top-xl" style="width:100%">');
              H.push(
                '<div class="ie-titre-petit">',
                GTraductions.getValeur('blog.billet.titre'),
                '</div>',
              );
              H.push(
                '<input type="text" class="round-style" ie-model="legendeVignette" style="width:100%" placeholder="',
                GTraductions.getValeur('blog.billet.rediger'),
                '"/>',
              );
              H.push('</div>');
            } else {
              H.push(
                '<div class="ellipsis-multilignes" title="',
                this.donnees.data.libelle,
                '">',
                this.donnees.data.libelle,
                '</div>',
              );
            }
            H.push('</div>');
          }
          H.push('</div>');
        }
        return H.join('');
      }
      evntSuppr(aAccepte) {
        if (aAccepte !== EGenreAction.Valider) {
          return;
        }
        const lData = this.donnees.data;
        lData.setEtat(EGenreEtat.Suppression);
        this.callback.appel({
          evnt: ETypeEvntVignette.suppression,
          data: lData,
          vignette: this.donnees,
        });
      }
    }
    function _getEtatCourant() {
      return this.param.avecSurvol && this.estSurvole === true
        ? ETypeEtatVignette.survol
        : this.param.avecSelection && this.estSelectionne
          ? ETypeEtatVignette.selectionne
          : ETypeEtatVignette.nonSelectionne;
    }
    function getClassEtat() {
      const lEtat = _getEtatCourant.call(this);
      switch (lEtat) {
        case ETypeEtatVignette.survol:
          return 'survol';
        case ETypeEtatVignette.selectionne:
          return 'selectionne';
        case ETypeEtatVignette.nonSelectionne:
          return 'nonSelectionne';
      }
    }
    function _actualiserSelonEtat() {
      const lClassEtat = getClassEtat.call(this);
      $('#' + this.ids.vignette.escapeJQ())
        .removeClass('nonSelectionne survol selectionne')
        .addClass(lClassEtat);
    }
    function _ouvrirLien() {
      window.open(this.donnees.lien);
    }
    module.exports = { ObjetVignette, ETypeEvntVignette };
  },
  fn: 'objetvignette.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { GChaine } = require('ObjetChaine.js');
    const { ObjetVignette } = require('ObjetVignette.js');
    const { EGenreEtat } = require('Enumere_Etat.js');
    class ObjetDiapoCarrousel extends ObjetVignette {
      constructor(...aParams) {
        super(...aParams);
      }
      construireAffichage() {
        return this.afficher();
      }
      setParametres(aElement, aOptions) {
        const lOptions = {
          genreRessource: null,
          dimensionPhoto: 300,
          avecEtiquette: false,
          avecSuppression: false,
          avecEditionLegende: false,
          afficherNomFichierSiLibelleVide: false,
          sansBlocLibelle: false,
          altImage: '',
        };
        if (aOptions === null || aOptions === undefined) {
          aOptions = {};
        }
        $.extend(lOptions, aOptions);
        const lParamVignette = {
          avecSurvol: true,
          avecSelection: false,
          avecImage: true,
          avecImgViewer: true,
          estDiapo: true,
          avecEtiquette: lOptions.avecEtiquette,
          avecSuppression: lOptions.avecSuppression,
          avecEditionLegende: lOptions.avecEditionLegende,
          largeur: lOptions.dimensionPhoto,
          hauteur: lOptions.dimensionPhoto,
          hauteurEntete: 50,
          sansBlocLibelle: lOptions.sansBlocLibelle,
          altImage: lOptions.altImage,
        };
        this.setParam(lParamVignette);
        const lDocCasier = aElement.documentCasier;
        $.extend(aElement, {
          libelle: !!aElement.libelle
            ? aElement.libelle
            : aElement.getLibelle() !== ''
              ? aElement.getLibelle()
              : lOptions.afficherNomFichierSiLibelleVide === true
                ? lDocCasier.getLibelle()
                : '',
        });
        const lData = {
          data: aElement,
          lien:
            lDocCasier.getEtat() === EGenreEtat.Creation
              ? lDocCasier.urlBlob
              : GChaine.creerUrlBruteLienExterne(lDocCasier, {
                  genreRessource: lOptions.genreRessource,
                  miniature: lDocCasier.miniature,
                }),
          strEtiquette:
            lParamVignette.avecEtiquette && aElement.strEtiquette
              ? aElement.strEtiquette
              : '',
          estImg: true,
          estSiteWeb: false,
          estFichier: false,
          estCloud: false,
        };
        this.setDonnees(lData);
      }
    }
    module.exports = { ObjetDiapoCarrousel };
  },
  fn: 'objetdiapocarrousel.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { GestionnaireBlocDeBase } = require('GestionnaireBloc.js');
    const { ObjetDiapoCarrousel } = require('ObjetDiapoCarrousel.js');
    class GestionnaireBlocDiapoCarrousel extends GestionnaireBlocDeBase {
      constructor(...aParams) {
        super(...aParams);
      }
      composeBloc(aDataBloc) {
        const lInstance = this.getInstanceObjetMetier(
          aDataBloc,
          ObjetDiapoCarrousel,
        );
        return {
          html: this.composeZoneInstance(lInstance),
          controleur: lInstance.controleur,
        };
      }
      composeZoneInstance(aInstance) {
        return (
          '<div id="' + aInstance.getNom() + '" class="container-bloc"></div>'
        );
      }
    }
    module.exports = { GestionnaireBlocDiapoCarrousel };
  },
  fn: 'gestionnaireblocdiapocarrousel.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeCallbackObjetGalerieCarrousel = exports.ObjetGalerieCarrousel =
      void 0;
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const GUID_1 = require('GUID');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const GestionnaireBlocDiapoCarrousel_1 = require('GestionnaireBlocDiapoCarrousel');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetVignette_1 = require('ObjetVignette');
    const ObjetListeElements_1 = require('ObjetListeElements');
    require('ObjetGalerieCarrousel.css');
    var TypeCallbackObjetGalerieCarrousel;
    (function (TypeCallbackObjetGalerieCarrousel) {
      TypeCallbackObjetGalerieCarrousel[
        (TypeCallbackObjetGalerieCarrousel['SuppressionDiapo'] = 0)
      ] = 'SuppressionDiapo';
    })(
      TypeCallbackObjetGalerieCarrousel ||
        (exports.TypeCallbackObjetGalerieCarrousel =
          TypeCallbackObjetGalerieCarrousel =
            {}),
    );
    class ObjetGalerieCarrousel extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.ids = {
          conteneurDiapos: GUID_1.GUID.getId(),
          zoneNavigation: GUID_1.GUID.getId(),
          indicateursNavigation: GUID_1.GUID.getId(),
        };
        this.gestionnaireBlocsDiapos = ObjetIdentite_1.Identite.creerInstance(
          GestionnaireBlocDiapoCarrousel_1.GestionnaireBlocDiapoCarrousel,
          { pere: this, evenement: this.surEvntGestionnaireDiapos },
        );
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          nodeZoneVisu: function () {
            $(this.node).on({
              swipeleft: function () {
                aInstance._naviguerDiapoSuivante();
                if (!aInstance.options.bouclerSurNavigation) {
                  aInstance.$refresh();
                }
              },
              swiperight: function () {
                aInstance._naviguerDiapoPrecedente();
                if (!aInstance.options.bouclerSurNavigation) {
                  aInstance.$refresh();
                }
              },
            });
          },
          avecAffBtnAutour: function () {
            return (
              aInstance.options.avecFlechesAutourDesDiapos &&
              aInstance._avecAffichageZoneNavigation()
            );
          },
          avecAffBtnZoneNav: function () {
            return !aInstance.options.avecFlechesAutourDesDiapos;
          },
          btnPrec: {
            event() {
              aInstance._naviguerDiapoPrecedente();
            },
            getTitle() {
              return ObjetTraduction_1.GTraductions.getValeur('Precedent');
            },
            getDisabled() {
              return aInstance.options.bouclerSurNavigation
                ? false
                : !aInstance._existeDiapoPrecedente();
            },
          },
          btnSuiv: {
            event() {
              aInstance._naviguerDiapoSuivante();
            },
            getTitle() {
              return ObjetTraduction_1.GTraductions.getValeur('Suivant');
            },
            getDisabled() {
              if (aInstance.options.bouclerSurNavigation) {
                return false;
              }
              let lSuivanteDerniereVisible =
                aInstance._getNumDerniereDiapoVisible() + 1;
              return !aInstance._estDiapoExistante(lSuivanteDerniereVisible);
            },
          },
          avecAffIndicateursNav: function () {
            return aInstance.options.avecIndicateursNavigation;
          },
        });
      }
      construireAffichage() {
        const H = [];
        H.push('<div class="ObjetGalerieCarrousel">');
        H.push('<div class="zoneContenu">');
        H.push(
          '<ie-btnicon ie-model="btnPrec" ie-display="avecAffBtnAutour" class="icon_angle_left btnAutour"></ie-btnicon>',
        );
        H.push('<div class="zoneVisu" ie-node="nodeZoneVisu">');
        H.push(
          '<div id="',
          this.ids.conteneurDiapos,
          '" class="conteneurDiapos ie-imgviewer-container">',
        );
        H.push('</div>');
        H.push('</div>');
        H.push(
          '<ie-btnicon ie-model="btnSuiv" ie-display="avecAffBtnAutour" class="icon_angle_right btnAutour"></ie-btnicon>',
        );
        H.push('</div>');
        H.push(
          '<div id="',
          this.ids.zoneNavigation,
          '" class="zoneNavigation">',
        );
        H.push('</div>');
        H.push('</div>');
        return H.join('');
      }
      setOptions(aOptions) {
        this.options = $.extend(
          {
            dimensionPhoto: 50,
            tailleFixe: false,
            nbMaxDiaposEnZoneVisible: 4,
            bouclerSurNavigation: true,
            avecCmpSurDiapo: false,
            avecFlechesAutourDesDiapos: true,
            avecIndicateursNavigation: false,
            avecSuppression: false,
            avecEditionLegende: false,
            sansBlocLibelle: false,
            justifieAGauche: false,
            altImage: '',
          },
          aOptions,
        );
        return this;
      }
      initialiserCarrousel() {
        this.numDiapoCourante = 1;
        this.numDerniereDiapo = 0;
        this.dimensionPhotoAdaptee = null;
        this.nbTotalDiapos = 0;
      }
      setDonnees(aParam) {
        this.initialiserCarrousel();
        this.listeDiapos = aParam.listeDiapos;
        const lRessourceDocJoint = aParam.ressourceDocJoint;
        this.nbDiaposVisibles = this._determinerNbDiaposAAfficher();
        this.gestionnaireBlocsDiapos.setOptions({
          genreRessource: lRessourceDocJoint,
          dimensionPhoto:
            this.dimensionPhotoAdaptee !== null
              ? this.dimensionPhotoAdaptee
              : this.options.dimensionPhoto,
          avecEtiquette: this.options.avecCmpSurDiapo,
          avecSuppression: this.options.avecSuppression,
          avecEditionLegende: this.options.avecEditionLegende,
          sansBlocLibelle: this.options.sansBlocLibelle,
          afficherNomFichierSiLibelleVide:
            this.options.afficherNomFichierSiLibelleVide,
          altImage: this.options.altImage,
        });
        ObjetHtml_1.GHtml.setHtml(
          this.ids.conteneurDiapos,
          this.composerDiapos(),
          { instance: this },
        );
        if (
          this.options.justifieAGauche &&
          !(
            this.options.avecFlechesAutourDesDiapos &&
            this._avecAffichageZoneNavigation()
          )
        ) {
          $('#' + this.ids.conteneurDiapos.escapeJQ()).addClass('justifyLeft');
        }
        this.gestionnaireBlocsDiapos.refresh();
        if (this._avecUnEltDeLaZoneNavigation()) {
          ObjetHtml_1.GHtml.setHtml(
            this.ids.zoneNavigation,
            this.composerZoneNavigation(),
            { instance: this },
          );
          this._actualiserZoneNavigation();
        } else {
          this._cacherEltParId(this.ids.zoneNavigation);
          this.$refresh();
        }
      }
      composerDiapos() {
        const H = [];
        if (
          this.listeDiapos !== null &&
          this.listeDiapos !== undefined &&
          this.listeDiapos.count() > 0
        ) {
          let lCmp = 0;
          let lNumDiapoCourante = 0;
          let lListeDiapos = this.listeDiapos.getListeElements((D) => {
            return D.existe();
          });
          this.nbTotalDiapos = lListeDiapos.count();
          const lAvecEtiquette =
            this.options.avecCmpSurDiapo && this._avecAffichageZoneNavigation();
          let lCss;
          lListeDiapos.parcourir((D) => {
            lCmp++;
            lNumDiapoCourante = lCmp;
            this.numDerniereDiapo = lCmp;
            lCss = lNumDiapoCourante <= this.nbDiaposVisibles ? 'on' : 'off';
            D.numDiapo = lNumDiapoCourante;
            if (lAvecEtiquette) {
              D.strEtiquette =
                this._strClassementDiapoNumero(lNumDiapoCourante);
            }
            H.push(
              this._composerHtmlDiapo({
                numDiapo: lNumDiapoCourante,
                orderDiapo: lCmp,
                dataDiapo: D,
                cssDiapo: lCss,
              }),
            );
          });
        }
        return H.join('');
      }
      composerZoneNavigation() {
        const H = [];
        H.push(
          '<ie-btnicon ie-model="btnPrec" ie-display="avecAffBtnZoneNav" class="icon_angle_left"></ie-btnicon>',
        );
        H.push(
          '<div ie-display="avecAffIndicateursNav" id="',
          this.ids.indicateursNavigation,
          '" class="indicateurNav"></div>',
        );
        H.push(
          '<ie-btnicon ie-model="btnSuiv" ie-display="avecAffBtnZoneNav" class="icon_angle_right"></ie-btnicon>',
        );
        return H.join('');
      }
      surEvntGestionnaireDiapos(aParam) {
        if (aParam) {
          switch (aParam.evnt) {
            case ObjetVignette_1.ETypeEvntVignette.suppression:
              this._surSuppressionDiapo(aParam.data);
              break;
          }
        }
      }
      libererUrlsBlob() {
        this.listeDiapos.parcourir((aDiapo) => {
          if (
            this._docDeLaDiapoEstUnBlob(aDiapo) &&
            aDiapo.documentCasier.urlBlob
          ) {
            URL.revokeObjectURL(aDiapo.documentCasier.urlBlob);
            aDiapo.documentCasier.urlBlob = null;
          }
        });
      }
      ajouterDiapo(aData) {
        if (aData.existe()) {
          if (this.listeDiapos === null || this.listeDiapos === undefined) {
            this.listeDiapos = new ObjetListeElements_1.ObjetListeElements();
          }
          if (this._docDeLaDiapoEstUnBlob(aData)) {
            aData.documentCasier.urlBlob = URL.createObjectURL(
              aData.documentCasier.fichier.file,
            );
          }
          this.listeDiapos.addElement(aData);
          const lEstCas1ereDiapo = this.numDerniereDiapo === 0;
          if (!lEstCas1ereDiapo) {
            this._decalerOrdreDesDiaposSuivantLaDiapoNumero(
              this.numDerniereDiapo,
              1,
            );
          }
          let lNumDerniereDiapoApresAjout = this.numDerniereDiapo + 1;
          aData.numDiapo = lNumDerniereDiapoApresAjout;
          let lOrderDiapoAAjouter = lEstCas1ereDiapo
            ? 1
            : this._getOrderDiapoNumero(this.numDerniereDiapo) + 1;
          let lHtmlDiapo = this._composerHtmlDiapo({
            numDiapo: lNumDerniereDiapoApresAjout,
            orderDiapo: lOrderDiapoAAjouter,
            dataDiapo: aData,
            cssDiapo: 'off',
          });
          $('#' + this.ids.conteneurDiapos.escapeJQ()).append(lHtmlDiapo);
          this.gestionnaireBlocsDiapos.refreshInstance(
            aData.indiceInstanceMetier,
          );
          this.nbTotalDiapos = this.nbTotalDiapos + 1;
          this.numDerniereDiapo = lNumDerniereDiapoApresAjout;
          if (lEstCas1ereDiapo) {
            this._montrerLesDiaposVisibles();
          } else {
            this._deplacerDiaposDansCarrousel(-(lOrderDiapoAAjouter - 1));
          }
          this._actualiserZoneNavigation();
        }
      }
      _docDeLaDiapoEstUnBlob(aDiapo) {
        let lDoc = aDiapo.documentCasier;
        return (
          lDoc &&
          lDoc.getEtat() === Enumere_Etat_1.EGenreEtat.Creation &&
          lDoc.fichier &&
          lDoc.fichier.file
        );
      }
      _composerHtmlDiapo(aParam) {
        let lStyle = this.options.bouclerSurNavigation
          ? 'order:' + aParam.orderDiapo + '; '
          : '';
        const H = [];
        H.push(
          '<div id="',
          this._getIdDiapoNumero(aParam.numDiapo),
          '" class="diapo ',
          aParam.cssDiapo,
          '" style="',
          lStyle,
          ' width:',
          this.dimensionPhotoAdaptee !== null
            ? this.dimensionPhotoAdaptee
            : this.options.dimensionPhoto,
          'px;">',
        );
        let lBloc = this.gestionnaireBlocsDiapos.composeBloc(aParam.dataDiapo);
        H.push(lBloc.html);
        H.push('</div>');
        return H.join('');
      }
      _decalerOrdreDesDiaposSuivantLaDiapoNumero(aNumDiapo, aDecalage) {
        let lOrdreCourantDiapoDeRef = this._getOrderDiapoNumero(aNumDiapo);
        let lNbDiaposADecaler = this.numDerniereDiapo - lOrdreCourantDiapoDeRef;
        for (let i = 1, lNbr = lNbDiaposADecaler; i <= lNbr; i++) {
          let lNumADecaler = aNumDiapo + i;
          if (
            this._estDiapoExistante(lNumADecaler) ||
            this.options.bouclerSurNavigation
          ) {
            let lNumADecalerSelonModulo =
              this._getNumDiapoSelonModulo(lNumADecaler);
            let lEltDiapoADecaler = this._getIdDiapoNumero(
              lNumADecalerSelonModulo,
            );
            let lOrdreCourant = this._getOrderDiapoNumero(
              lNumADecalerSelonModulo,
            );
            let lOrdreAVenir = lOrdreCourant + aDecalage;
            $('#' + lEltDiapoADecaler.escapeJQ()).css('order', lOrdreAVenir);
          }
        }
      }
      _getOrderDiapoNumero(aNumDiapo) {
        let lEltDiapo = this._getIdDiapoNumero(aNumDiapo);
        return parseInt($('#' + lEltDiapo.escapeJQ()).css('order'));
      }
      _composerIndicateursNavigation() {
        return this._strClassementDiapoNumero(this.numDiapoCourante);
      }
      _actualiserIndicateursNavigation() {
        if (this.options.avecIndicateursNavigation) {
          ObjetHtml_1.GHtml.setHtml(
            this.ids.indicateursNavigation,
            this._composerIndicateursNavigation(),
            { instance: this },
          );
        }
      }
      _avecUnEltDeLaZoneNavigation() {
        const lAvecFlechesDansZoneNav =
          !this.options.avecFlechesAutourDesDiapos;
        const lAvecIndicateursNav = this.options.avecIndicateursNavigation;
        return lAvecFlechesDansZoneNav || lAvecIndicateursNav;
      }
      _actualiserZoneNavigation() {
        if (this._avecUnEltDeLaZoneNavigation()) {
          let lId = this.ids.zoneNavigation;
          if (this._avecAffichageZoneNavigation()) {
            this._montrerEltParId(lId);
            this._actualiserIndicateursNavigation();
          } else {
            this._cacherEltParId(lId);
          }
        }
      }
      _determinerNbDiaposAffichables() {
        let lWidthDispo =
          ObjetPosition_1.GPosition.getWidth(this.ids.conteneurDiapos) - 2 * 20;
        if (
          this.options.avecSuppression ||
          (this.options.avecFlechesAutourDesDiapos &&
            !this._avecAffichageZoneNavigation())
        ) {
          lWidthDispo = lWidthDispo - 2 * 40;
        }
        let lWidthDiapo = this.options.dimensionPhoto + 20;
        let lResult = Math.floor(lWidthDispo / lWidthDiapo);
        if (lResult <= 1) {
          this.dimensionPhotoAdaptee = lWidthDispo;
        }
        if (lResult <= 1) {
          this.dimensionPhotoAdaptee = this.dimensionPhotoAdaptee + 2 * 20;
          $('#' + this.ids.conteneurDiapos.escapeJQ()).addClass('onlyOne');
          if (this.options.tailleFixe && lResult !== 0) {
            this.dimensionPhotoAdaptee = this.options.dimensionPhoto;
          }
          lResult = 1;
        }
        return lResult;
      }
      _determinerNbDiaposAAfficher() {
        let lNbDiaposPossibles = this._determinerNbDiaposAffichables();
        let lNbDiaposMax = this.options.nbMaxDiaposEnZoneVisible;
        return Math.min(lNbDiaposMax, lNbDiaposPossibles);
      }
      _existeDiapoPrecedente() {
        return this.numDiapoCourante > 1;
      }
      _estDiapoExistante(aNum) {
        return aNum >= 1 && aNum <= this.numDerniereDiapo;
      }
      _avecAffichageZoneNavigation() {
        let lResult = true;
        if (
          !this._contientAuMoinsUneDiapo() ||
          this._contientDiapoUnique() ||
          this._toutesLesDiaposSontVisibles()
        ) {
          lResult = false;
        }
        return lResult;
      }
      _getNumDerniereDiapoVisible() {
        return this.numDiapoCourante + this.nbDiaposVisibles - 1;
      }
      _getIdDiapoNumero(aNum) {
        return this.Nom + '_' + aNum;
      }
      _cacherEltParId(aId) {
        $('#' + aId.escapeJQ())
          .removeClass('on')
          .addClass('off');
      }
      _montrerEltParId(aId) {
        $('#' + aId.escapeJQ())
          .removeClass('off')
          .addClass('on');
      }
      _cacherLesDiaposVisibles() {
        for (
          let i = this.numDiapoCourante,
            lNbr = this.numDiapoCourante + this.nbDiaposVisibles - 1;
          i <= lNbr;
          i++
        ) {
          this._cacherDiapoNumero(this._getNumDiapoSelonModulo(i));
        }
      }
      _montrerLesDiaposVisibles() {
        for (
          let i = this.numDiapoCourante,
            lNbr = this.numDiapoCourante + this.nbDiaposVisibles - 1;
          i <= lNbr;
          i++
        ) {
          this._montrerDiapoNumero(this._getNumDiapoSelonModulo(i));
        }
      }
      _cacherDiapoNumero(aNumDiapo) {
        let lId = this._getIdDiapoNumero(aNumDiapo);
        this._cacherEltParId(lId);
      }
      _montrerDiapoNumero(aNumDiapo) {
        let lId = this._getIdDiapoNumero(aNumDiapo);
        this._montrerEltParId(lId);
      }
      _contientAuMoinsUneDiapo() {
        return this.nbTotalDiapos > 0;
      }
      _contientDiapoUnique() {
        return this.nbTotalDiapos === 1;
      }
      _toutesLesDiaposSontVisibles() {
        return this.nbTotalDiapos <= this.nbDiaposVisibles;
      }
      _strClassementDiapoNumero(aNumDiapo) {
        return aNumDiapo + '/' + this.nbTotalDiapos;
      }
      _reordonnerDiapos(aDecalage) {
        if (this.options.bouclerSurNavigation) {
          for (let i = 1, lNbr = this.numDerniereDiapo; i <= lNbr; i++) {
            let lEltDiapo = this._getIdDiapoNumero(i);
            let lOrdreCourant = this._getOrderDiapoNumero(i);
            let lOrdreAVenir = lOrdreCourant + aDecalage;
            if (aDecalage < 0 && lOrdreAVenir < 1) {
              lOrdreAVenir = lOrdreAVenir + this.numDerniereDiapo;
            }
            if (aDecalage > 0 && lOrdreAVenir > this.numDerniereDiapo) {
              lOrdreAVenir = lOrdreAVenir - this.numDerniereDiapo;
            }
            $('#' + lEltDiapo.escapeJQ()).css('order', lOrdreAVenir);
          }
        }
      }
      _getNumDiapoSelonModulo(aNum) {
        let lNumModulo = aNum % this.numDerniereDiapo;
        if (lNumModulo === 0) {
          lNumModulo = this.numDerniereDiapo;
        }
        return lNumModulo;
      }
      _deplacerDiaposDansCarrousel(aDecalage) {
        if (!this.options.bouclerSurNavigation) {
          return;
        }
        this._cacherLesDiaposVisibles();
        this._reordonnerDiapos(aDecalage);
        this.numDiapoCourante = this._getNumDiapoSelonModulo(
          this.numDiapoCourante - aDecalage,
        );
        this._montrerLesDiaposVisibles();
        this._actualiserIndicateursNavigation();
      }
      _naviguerDiapoSuivante() {
        this._deplacerDiaposDansCarrousel(-1);
      }
      _naviguerDiapoPrecedente() {
        this._deplacerDiaposDansCarrousel(1);
      }
      _surSuppressionDiapo(aData) {
        let lNumDiapo = aData.numDiapo;
        let lNumDiapoAMontrer = this._getNumDerniereDiapoVisible() + 1;
        if (
          this._estDiapoExistante(lNumDiapoAMontrer) ||
          this.options.bouclerSurNavigation
        ) {
          this._montrerDiapoNumero(
            this._getNumDiapoSelonModulo(lNumDiapoAMontrer),
          );
        }
        let lIdDiapoASupprimer = this._getIdDiapoNumero(lNumDiapo);
        this._decalerOrdreDesDiaposSuivantLaDiapoNumero(lNumDiapo, -1);
        let lEltDomASupprimer = document.getElementById(lIdDiapoASupprimer);
        if (lEltDomASupprimer.parentNode) {
          lEltDomASupprimer.parentNode.removeChild(lEltDomASupprimer);
        }
        for (
          let i = lNumDiapo + 1, lNbr = this.numDerniereDiapo;
          i <= lNbr;
          i++
        ) {
          let lNouveauNum = i - 1;
          let lNouvelId = this._getIdDiapoNumero(lNouveauNum);
          let lEltAModifier = document.getElementById(
            this._getIdDiapoNumero(i),
          );
          lEltAModifier.id = lNouvelId;
        }
        this.numDerniereDiapo = this.numDerniereDiapo - 1;
        this.nbTotalDiapos = this.nbTotalDiapos - 1;
        this._actualiserInstancesDiaposSurSuppression(aData);
        this._actualiserZoneNavigation();
        this.callback.appel(TypeCallbackObjetGalerieCarrousel.SuppressionDiapo);
      }
      _actualiserInstancesDiaposSurSuppression(aData) {
        let lIndInstance = aData.indiceInstanceMetier;
        aData.numDiapo = null;
        for (
          let i = lIndInstance + 1,
            lNbr = this.gestionnaireBlocsDiapos._instances.length;
          i < lNbr;
          i++
        ) {
          let lInstanceDiapo = this.gestionnaireBlocsDiapos._instances[i];
          let lDataDiapo = lInstanceDiapo.data;
          if (lDataDiapo.numDiapo !== null) {
            lDataDiapo.numDiapo = lDataDiapo.numDiapo - 1;
          }
        }
      }
    }
    exports.ObjetGalerieCarrousel = ObjetGalerieCarrousel;
  },
  fn: 'objetgaleriecarrousel.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreMiniature = void 0;
    var TypeGenreMiniature;
    (function (TypeGenreMiniature) {
      TypeGenreMiniature['GM_100'] = 'GM_100';
      TypeGenreMiniature['GM_200'] = 'GM_200';
      TypeGenreMiniature['GM_300'] = 'GM_300';
      TypeGenreMiniature['GM_400'] = 'GM_400';
      TypeGenreMiniature['GM_500'] = 'GM_500';
      TypeGenreMiniature['GM_600'] = 'GM_600';
    })(
      TypeGenreMiniature ||
        (exports.TypeGenreMiniature = TypeGenreMiniature = {}),
    );
  },
  fn: 'typegenreminiature.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.WidgetActualites = void 0;
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const UtilitaireInformations_1 = require('UtilitaireInformations');
    const Enumere_Onglet_1 = require('Enumere_Onglet');
    const TypeEtatPublication_1 = require('TypeEtatPublication');
    const MoteurInfoSondage_1 = require('MoteurInfoSondage');
    const GestionnaireBlocPN_1 = require('GestionnaireBlocPN');
    const GestionnaireBlocPN_2 = require('GestionnaireBlocPN');
    const GestionnaireBlocPN_3 = require('GestionnaireBlocPN');
    const Enumere_EvenementWidget_1 = require('Enumere_EvenementWidget');
    const ObjetGalerieCarrousel_1 = require('ObjetGalerieCarrousel');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetElement_1 = require('ObjetElement');
    const TypeGenreMiniature_1 = require('TypeGenreMiniature');
    const ObjetWidget_1 = require('ObjetWidget');
    class WidgetActualites extends ObjetWidget_1.Widget.ObjetWidget {
      constructor(...aParams) {
        super(...aParams);
        const lApplicationSco = GApplication;
        this.etatUtilisateurSco = lApplicationSco.getEtatUtilisateur();
      }
      construire(aParams) {
        this.donnees = aParams.donnees;
        this.options =
          aParams.options !== null && aParams.options !== undefined
            ? aParams.options
            : { estModeSansAuth: false };
        if (this.options.estModeSansAuth === true) {
          this.moteur = new MoteurInfoSondage_1.MoteurInfoSondage({
            genreRessource: new GestionnaireBlocPN_1.UtilitaireGenreRessource(),
            genreEspace: new GestionnaireBlocPN_2.UtilitaireGenreEspace(),
            genreReponse: new GestionnaireBlocPN_3.UtilitaireGenreReponse(),
          });
        }
        this.listeActualites =
          this.donnees.listeModesAff[
            TypeEtatPublication_1.TypeModeAff.MA_Reception
          ].listeActualites;
        const lNbrElements = this.listeActualites.count();
        const lAvecCumul =
          this.options.estModeSansAuth === true
            ? false
            : UtilitaireInformations_1.TUtilitaireInformations.avecCumul(
                this.listeActualites,
              );
        this.listeActualites.setTri([
          ObjetTri_1.ObjetTri.init((a) => {
            return a.categorie ? a.categorie.getLibelle() : '';
          }),
        ]);
        this.listeActualites.trier();
        if (lAvecCumul) {
          UtilitaireInformations_1.TUtilitaireInformations.formaterListePourCumul(
            this.listeActualites,
          );
        } else {
          this.listeActualites.setTri([
            ObjetTri_1.ObjetTri.init(
              'dateDebut',
              Enumere_TriElement_1.EGenreTriElement.Decroissant,
            ),
            ObjetTri_1.ObjetTri.init(
              'dateCreation',
              Enumere_TriElement_1.EGenreTriElement.Decroissant,
            ),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]);
          this.listeActualites.trier();
        }
        let lNbrListes = 0;
        for (let i = 0, lNbr = this.listeActualites.count(); i < lNbr; i++) {
          if (this.listeActualites.get(i).estUnDeploiement) {
            lNbrListes++;
          }
        }
        const lWidget = {
          html: this.composeWidgetActualites(),
          nbrElements: lNbrElements,
          nbrListes: lNbrListes,
          liste: this.listeActualites,
          afficherMessage: lNbrElements === 0,
        };
        $.extend(true, aParams.donnees, lWidget);
        aParams.construireWidget(this.donnees);
      }
      composeWidgetActualites() {
        const H = [];
        const lEstModeSansAuth = this.options.estModeSansAuth === true;
        if (this.listeActualites.count() > 0) {
          H.push('<ul class="liste-imbriquee">');
          for (let I = 0; I < this.listeActualites.count(); I++) {
            const lElement = this.listeActualites.get(I);
            lElement.avecReponse = lEstModeSansAuth
              ? false
              : UtilitaireInformations_1.TUtilitaireInformations.avecReponse;
            lElement.aToutRepondu =
              UtilitaireInformations_1.TUtilitaireInformations.aToutRepondu;
            if (lElement.estUnDeploiement) {
              if (I !== 0) {
                H.push('</ul></li>');
              }
              H.push(
                '<li tabindex="0">',
                '<h3>',
                lElement.getLibelle(),
                '</h3>',
              );
              H.push('<ul class="liste-clickable">');
            } else {
              if (I === 0) {
                H.push(
                  '<li><ul class="',
                  lEstModeSansAuth ? '' : 'liste-clickable',
                  '">',
                );
              }
              H.push(this.composeActualite(lElement, I));
            }
          }
          H.push('</ul></li>');
          H.push('</ul>');
        }
        return H.join('');
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(this), {
          getCarrouselInfoSondage(aNumeroInfoSondage) {
            return {
              class: ObjetGalerieCarrousel_1.ObjetGalerieCarrousel,
              pere: aInstance,
              init: (aCarrousel) => {
                aCarrousel.setOptions({
                  dimensionPhoto: 300,
                  tailleFixe: true,
                  nbMaxDiaposEnZoneVisible: 10,
                  sansBlocLibelle: true,
                  altImage: ObjetTraduction_1.GTraductions.getValeur(
                    'infoSond.altImgViewer',
                  ),
                });
                aCarrousel.initialiser();
              },
              start: (aCarrousel) => {
                let lComposante = null;
                aInstance.listeActualites.parcourir((aActualite) => {
                  if (!lComposante) {
                    lComposante =
                      aActualite.listeQuestions.getElementParNumero(
                        aNumeroInfoSondage,
                      );
                  }
                });
                const lListeDiapos =
                  new ObjetListeElements_1.ObjetListeElements();
                if (lComposante && lComposante.listePiecesJointes) {
                  lComposante.listePiecesJointes.parcourir((aPJ) => {
                    if (aPJ.avecMiniaturePossible) {
                      let lDiapo = new ObjetElement_1.ObjetElement();
                      lDiapo.setLibelle(aPJ.getLibelle());
                      aPJ.miniature =
                        TypeGenreMiniature_1.TypeGenreMiniature.GM_600;
                      lDiapo.documentCasier = aPJ;
                      lListeDiapos.add(lDiapo);
                    }
                  });
                }
                aCarrousel.setDonnees({ listeDiapos: lListeDiapos });
              },
            };
          },
          surActualite(aIndiceActualite) {
            $(this.node).eventValidation(() => {
              aInstance._surActualite(aIndiceActualite);
            });
          },
        });
      }
      composeActualite(aActualite, i) {
        const H = [];
        const lID = this.donnees.id + '_div_' + i;
        const lLabel = aActualite.estInformation
          ? ObjetTraduction_1.GTraductions.getValeur(
              'accueil.informations.hintLien.information',
            )
          : ObjetTraduction_1.GTraductions.getValeur(
              'accueil.informations.hintLien.sondage',
            );
        let lTitre = aActualite.getLibelle();
        if (lTitre === null || lTitre === undefined || lTitre === '') {
          lTitre = ObjetTraduction_1.GTraductions.getValeur('SansTitre');
        }
        const lAriaLabel =
          ' aria-label="' +
          lLabel +
          (lTitre ? ' : ' + lTitre : '') +
          (aActualite.auteur
            ? ', ' +
              ObjetTraduction_1.GTraductions.getValeur(
                'accueil.informations.wai.par',
                [aActualite.auteur],
              )
            : '') +
          '"';
        const lClass =
          'as-offset ' +
          (aActualite.estInformation
            ? 'icon_diffuser_information'
            : 'icon_diffuser_sondage');
        const lEstModeSansAuth = this.options.estModeSansAuth === true;
        H.push('<li');
        H.push(lEstModeSansAuth ? ' class="' + lClass + '"' : '');
        H.push(lAriaLabel);
        H.push(lEstModeSansAuth ? ' tabindex="0"' : '', '>');
        if (lEstModeSansAuth) {
          H.push('<div class="full-width">');
        } else {
          H.push(
            '<a class="wrapper-link ',
            lClass,
            '" tabindex="0" id="',
            lID,
            '"',
            ' title="' +
              (aActualite.estInformation
                ? ObjetTraduction_1.GTraductions.getValeur(
                    'accueil.informations.hintLien.information',
                  )
                : ObjetTraduction_1.GTraductions.getValeur(
                    'accueil.informations.hintLien.sondage',
                  )) +
              '"',
            ' ie-node="surActualite(',
            i,
            ')"',
            lAriaLabel,
            '>',
          );
        }
        H.push('<div class="wrap">');
        H.push(
          '<h4>',
          lTitre,
          '</h4>',
          aActualite.auteur ? aActualite.auteur : '',
        );
        H.push('</div>');
        if (
          this.options.estModeSansAuth !== true &&
          (this.etatUtilisateurSco.GenreEspace ===
            Enumere_Espace_1.EGenreEspace.Parent ||
            this.etatUtilisateurSco.GenreEspace ===
              Enumere_Espace_1.EGenreEspace.Mobile_Parent) &&
          aActualite.prenom
        ) {
          H.push(
            '<div class="circle" ie-hint="',
            aActualite.prenom,
            '">' + aActualite.prenom.substring(0, 1).toUpperCase() + '</div>',
          );
        }
        if (lEstModeSansAuth) {
          if (aActualite.listeQuestions) {
            const lComposanteInfo = aActualite.listeQuestions.get(0);
            H.push('<div style="margin-top:1rem; margin-bottom : 1rem;">');
            H.push(
              this.moteur.composeComposanteInfoSondage({
                instance: this,
                actu: aActualite,
                composante: lComposanteInfo,
                indice: 0,
                avecLibelleQuestion: false,
                estAffEditionActualite: false,
                estModeSansAuth: lEstModeSansAuth,
              }),
            );
            H.push('</div>');
          }
          H.push('</div>');
        } else {
          H.push('</a>');
        }
        H.push('</li>');
        return H.join('');
      }
      _surActualite(i) {
        const lActuSelectionne = this.listeActualites.get(i);
        this.etatUtilisateurSco.setInfoSond(lActuSelectionne);
        const lGenreOnglet = Enumere_Onglet_1.EGenreOnglet.Informations;
        let lPageDestination;
        if (this.etatUtilisateurSco.estEspaceMobile()) {
          lPageDestination = { genreOngletDest: lGenreOnglet };
        } else {
          lPageDestination = { Onglet: lGenreOnglet };
        }
        this.callback.appel(
          this.donnees.genre,
          Enumere_EvenementWidget_1.EGenreEvenementWidget.NavigationVersPage,
          lPageDestination,
        );
      }
    }
    exports.WidgetActualites = WidgetActualites;
  },
  fn: 'widgetactualites.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.WidgetEdito = void 0;
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetWidget_1 = require('ObjetWidget');
    class WidgetEdito extends ObjetWidget_1.Widget.ObjetWidget {
      construire(aParams) {
        this.donnees = aParams.donnees;
        const lWidget = { html: this.composeWidgetEdito() };
        $.extend(true, aParams.donnees, lWidget);
        aParams.construireWidget(this.donnees);
      }
      composeWidgetEdito() {
        const H = [];
        H.push(
          IE.jsx.str(
            IE.jsx.fragment,
            null,
            IE.jsx.str(
              'div',
              null,
              ObjetChaine_1.GChaine.replaceRCToHTML(this.donnees.contenu),
            ),
          ),
        );
        return H.join('');
      }
    }
    exports.WidgetEdito = WidgetEdito;
  },
  fn: 'widgetedito.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireWidget = void 0;
    const GUID_1 = require('GUID');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetChaine_1 = require('ObjetChaine');
    const jsx_1 = require('jsx');
    require('Widgets-dashboard.css');
    const UtilitaireWidget = {
      parametres: {
        avecFermer: false,
        avecToutVoir: false,
        avecCompteur: false,
      },
      nbrItemsVisible: 3,
      suffixIdWidget: GUID_1.GUID.getId(),
      suffixIdContenu: '',
      suffixIdWrapper: GUID_1.GUID.getId(),
      suffixIdActualiser: GUID_1.GUID.getId(),
      suffixIdToutVoir: GUID_1.GUID.getId(),
      suffixIdFooter: GUID_1.GUID.getId(),
      invisible: false,
      setParametres(aParametres) {
        this.parametres = aParametres;
      },
      compose(aParams) {
        const H = [];
        H.push(this.composeTitre(aParams));
        H.push(aParams.contenu);
        return H.join('');
      },
      composeTitre(aParams) {
        if (UtilitaireWidget.invisible) {
          return '';
        }
        const H = [];
        H.push(
          '<header',
          aParams.hint ? ' title="' + aParams.hint + '">' : '>',
          aParams.titre ? aParams.titre : '',
          '</header>',
        );
        return H.join('');
      },
      composeWidget(aWidget) {
        return UtilitaireWidget.compose({
          titre: UtilitaireWidget.composeTitreWidget(aWidget),
          hint: aWidget.hint,
          contenu: UtilitaireWidget.composeContenuWidget(aWidget),
        });
      },
      composeTitreWidget(aWidget) {
        const lExistePage =
          (aWidget.page &&
            (GEtatUtilisateur.existeGenreOnglet
              ? GEtatUtilisateur.existeGenreOnglet(aWidget.page.Onglet)
              : true)) ||
          aWidget.getPage;
        const H = [];
        if (aWidget.titre) {
          const lAttrSupplementairesTitre = [];
          if (!aWidget.hint && !aWidget.titreFixe) {
            lAttrSupplementairesTitre.push('ie-ellipsis');
          }
          if (lExistePage) {
            lAttrSupplementairesTitre.push(
              'ie-node="boutons.surToutVoir(' + aWidget.genre + ')"',
            );
            lAttrSupplementairesTitre.push('class="clickable"');
            lAttrSupplementairesTitre.push(
              'aria-describedby="' +
                aWidget.id +
                UtilitaireWidget.suffixIdToutVoir +
                '"',
            );
          }
          lAttrSupplementairesTitre.push('id="' + aWidget.id + '_TitreText"');
          const lTitre =
            aWidget.titre +
            (aWidget.nbrElements > 0 &&
            (this.parametres.avecCompteur ||
              UtilitaireWidget._avecCompteur(aWidget))
              ? ' (' + aWidget.nbrElements + ')'
              : '');
          H.push(
            '<h2 tabindex="0" ',
            lAttrSupplementairesTitre.join(' '),
            aWidget.hint
              ? ' aria-label="' +
                  ObjetChaine_1.GChaine.toTitle(lTitre + ' - ' + aWidget.hint) +
                  '"'
              : '',
            '>',
            '<span>',
            lTitre,
            '</span>',
            '</h2>',
          );
        } else {
          H.push(
            '<h2 tabindex="0"  class="wai_hidden" id="' +
              aWidget.id +
              '_TitreText">',
            aWidget.hint ? aWidget.hint : '',
            '</h2>',
          );
        }
        H.push('<div class="cta-conteneur">');
        if (lExistePage) {
          H.push(
            UtilitaireWidget.composeToutVoir(
              aWidget,
              this.parametres.avecToutVoir
                ? ObjetTraduction_1.GTraductions.getValeur('accueil.toutVoir')
                : ObjetTraduction_1.GTraductions.getValeur(
                    'accueil.hint.toutVoir',
                  ),
            ),
          );
        }
        if (aWidget && aWidget.avecActualisation) {
          H.push(
            IE.jsx.str('i', {
              role: 'button',
              tabindex: '0',
              'aria-label': ObjetTraduction_1.GTraductions.getValeur(
                'accueil.hint.refresh',
              ),
              title: ObjetTraduction_1.GTraductions.getValeur(
                'accueil.hint.refresh',
              ),
              id: aWidget.id + UtilitaireWidget.suffixIdActualiser,
              class: 'as-button bt-widget icon icon_refresh',
              'ie-node': (0, jsx_1.jsxFuncAttr)(
                'boutons.surActualiser',
                aWidget.genre,
              ),
            }),
          );
        }
        if (this.parametres.avecFermer) {
          H.push(
            IE.jsx.str('i', {
              role: 'button',
              tabindex: '0',
              'aria-label': ObjetTraduction_1.GTraductions.getValeur(
                'accueil.hint.fermer',
              ),
              class: 'as-button bt-close icon icon_fermeture_widget',
              title: ObjetTraduction_1.GTraductions.getValeur(
                'accueil.hint.fermer',
              ),
              'ie-node': (0, jsx_1.jsxFuncAttr)(
                'boutons.surFermer',
                aWidget.genre,
              ),
            }),
          );
        }
        if (
          aWidget.listeElementsGraphiques &&
          aWidget.listeElementsGraphiques.length
        ) {
          aWidget.listeElementsGraphiques.forEach((D) => {
            !!D.htmlMrFiche ? H.push(D.htmlMrFiche) : '';
          });
        }
        H.push('</div>');
        return H.join('');
      },
      composeContenuWidget(aWidget) {
        const H = [];
        aWidget.nbrItemsVisible =
          aWidget.nbrItemsVisible === undefined
            ? this.nbrItemsVisible
            : aWidget.nbrItemsVisible;
        if (aWidget.listeElementsGraphiques !== undefined) {
          H.push('<div class="filtre-conteneur">');
          aWidget.listeElementsGraphiques.forEach((D) => {
            if (!!D.id) {
              H.push('<div id="' + D.id + '" ></div>');
            } else if (!!D.html) {
              H.push(D.html);
            }
          });
          H.push('</div>');
        }
        H.push(
          '<div class="content-container overflow-auto" id="',
          aWidget.id,
          UtilitaireWidget.suffixIdWrapper,
          '" ',
          ' role="presentation">',
        );
        H.push(
          '<div id="',
          aWidget.id + UtilitaireWidget.suffixIdContenu,
          '">',
        );
        H.push(
          aWidget.afficherMessage && aWidget.message
            ? UtilitaireWidget.composeMessageAucuneDonnee(aWidget)
            : aWidget.html,
        );
        H.push('</div>');
        H.push(
          IE.jsx.str('div', {
            id: aWidget.id + UtilitaireWidget.suffixIdFooter,
            class: 'as-footer',
          }),
        );
        H.push('</div>');
        return H.join('');
      },
      actualiserWidget(aInstanceWidget) {
        const lWidget = aInstanceWidget.donnees;
        if (!lWidget.avecActualisation) {
          ObjetHtml_1.GHtml.addClass(
            lWidget.id + UtilitaireWidget.suffixIdActualiser,
            'hideActualiser',
          );
        } else {
          ObjetHtml_1.GHtml.delClass(
            lWidget.id + UtilitaireWidget.suffixIdActualiser,
            'hideActualiser',
          );
        }
        ObjetHtml_1.GHtml.setHtml(
          lWidget.id + UtilitaireWidget.suffixIdContenu,
          lWidget.afficherMessage && lWidget.message
            ? UtilitaireWidget.composeMessageAucuneDonnee(lWidget)
            : lWidget.html,
          { controleur: aInstanceWidget.controleur },
        );
        ObjetHtml_1.GHtml.setHtml(
          lWidget.id + '_TitreText',
          lWidget.titre +
            (lWidget.nbrElements > 0 ? ' (' + lWidget.nbrElements + ')' : ''),
          { controleur: aInstanceWidget.controleur },
        );
        this.actualiserFooter(lWidget);
        this.afficherMasquerListe(lWidget);
      },
      composeMessageAucuneDonnee(aWidget, aMessage) {
        const H = [];
        H.push(
          '<div class="no-events" tabindex="0" aria-label="',
          aWidget && aWidget.message ? aWidget.message : aMessage,
          '"><p>',
          aWidget && aWidget.message ? aWidget.message : aMessage,
          '</p></div>',
        );
        return H.join('');
      },
      composeToutVoir(aWidget, aTrad) {
        return IE.jsx.str('i', {
          id: aWidget.id + UtilitaireWidget.suffixIdToutVoir,
          role: 'button',
          title: aTrad,
          class: 'as-button bt-widget icon icon_affichage_widget',
          'ie-node': (0, jsx_1.jsxFuncAttr)(
            'boutons.surToutVoir',
            aWidget.genre,
          ),
          tabindex: '0',
          'aria-label': aTrad,
        });
      },
      actualiserFooter(aWidget) {
        const lJQFooter = $('#' + aWidget.id + UtilitaireWidget.suffixIdFooter);
        lJQFooter.hide();
        if (aWidget.isCollapsible) {
          let lNbElementsAffichables = -1;
          if (!!aWidget.nbrListes && aWidget.nbrListes > 0 && !!aWidget.liste) {
            lNbElementsAffichables =
              UtilitaireWidget._getNbrElementsNonVisibles(aWidget);
          } else if (aWidget.nbrElements > aWidget.nbrItemsVisible) {
            lNbElementsAffichables =
              aWidget.nbrElements - aWidget.nbrItemsVisible;
          }
          if (lNbElementsAffichables > 0) {
            lJQFooter.show();
            lJQFooter.html(
              IE.jsx.str(
                'a',
                {
                  class: 'btn-collapse',
                  tabindex: '0',
                  role: 'button',
                  'aria-label': ObjetTraduction_1.GTraductions.getValeur(
                    'accueil.hintAfficherElements',
                  ),
                },
                IE.jsx.str('i', {
                  class: 'icon_eye_open',
                  'aria-hidden': 'true',
                }),
                IE.jsx.str('span', { class: 'counter' }, '+'),
                lNbElementsAffichables,
              ),
            );
          }
        }
      },
      afficherMasquerListe(aWidget) {
        aWidget.nbrItemsVisible =
          aWidget.nbrItemsVisible === undefined
            ? this.nbrItemsVisible
            : aWidget.nbrItemsVisible;
        if (aWidget.isCollapsible) {
          const lWidgetComplet = $('#' + aWidget.id).closest('.widget');
          let lListItems;
          if (
            aWidget.nomDonnees === 'actualites' &&
            lWidgetComplet.find('ul ul').length > 1
          ) {
            lListItems = lWidgetComplet.find('ul.liste-clickable');
          } else {
            lListItems = lWidgetComplet.find('ul');
          }
          let lItems = lListItems.find(
            ' > li:gt(' + (aWidget.nbrItemsVisible - 1) + ')',
          );
          lItems.addClass('more masked');
          lItems.attr('aria-hidden', 'true');
          lItems.toArray().forEach((aNodeItems) => {
            const lTabElements =
              ObjetHtml_1.GHtml.getElementsFocusablesDElement(aNodeItems, {
                ignoreAriaHidden: false,
              });
            lTabElements.forEach((aNode) => {
              $(aNode).attr('tabindex', -1);
            });
          });
          $('.btn-collapse', lWidgetComplet).eventValidation(function () {
            const lIconBt = $(this).find('i');
            const more = lListItems.find('li.more');
            lIconBt.hasClass('icon_eye_close')
              ? lIconBt.toggleClass('icon_eye_close icon_eye_open')
              : lIconBt.toggleClass('icon_eye_open icon_eye_close');
            let lAriaLabelBouton;
            if (more.hasClass('masked')) {
              lAriaLabelBouton = ObjetTraduction_1.GTraductions.getValeur(
                'accueil.hintCacherElements',
              );
              more.toggleClass('masked unmasked');
              lItems.toArray().forEach((aNodeItems) => {
                const lTabElements =
                  ObjetHtml_1.GHtml.getElementsFocusablesDElement(aNodeItems, {
                    ignoreAriaHidden: false,
                  });
                lTabElements.forEach((aNode) => {
                  $(aNode).attr('tabindex', 0);
                });
              });
              more.attr('aria-hidden', 'false');
              if (more[0]) {
                more[0].focus();
              }
              $(this).find('span.counter').text('-');
            } else {
              lAriaLabelBouton = ObjetTraduction_1.GTraductions.getValeur(
                'accueil.hintAfficherElements',
              );
              more.toggleClass('unmasked masked');
              lItems.toArray().forEach((aNodeItems) => {
                const lTabElements =
                  ObjetHtml_1.GHtml.getElementsFocusablesDElement(aNodeItems, {
                    ignoreAriaHidden: false,
                  });
                lTabElements.forEach((aNode) => {
                  $(aNode).attr('tabindex', -1);
                });
              });
              more.attr('aria-hidden', 'true');
              $(this).find('span.counter').text('+');
            }
            $(this).attr('aria-label', lAriaLabelBouton);
          });
        }
      },
      _getNbrElementsNonVisibles(aWidget) {
        let lNbrElements = 0;
        const lListes = [];
        for (let i = 0, j = -1, lNbr = aWidget.liste.count(); i < lNbr; i++) {
          if (aWidget.liste.get(i).estUnDeploiement) {
            j++;
            lListes[j] = new ObjetListeElements_1.ObjetListeElements();
            continue;
          }
          lListes[j].add(aWidget.liste.get(i));
        }
        for (let i = 0, lNbr = lListes.length; i < lNbr; i++) {
          if (lListes[i].count() > aWidget.nbrItemsVisible) {
            lNbrElements =
              lNbrElements + (lListes[i].count() - aWidget.nbrItemsVisible);
          }
        }
        return lNbrElements;
      },
      _avecCompteur(aWidget) {
        return ['discussions'].includes(aWidget.nomDonnees);
      },
    };
    exports.UtilitaireWidget = UtilitaireWidget;
  },
  fn: 'utilitairewidget.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetCycles = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const TypeDomaine_1 = require('TypeDomaine');
    const TypeEnsembleNombre_1 = require('TypeEnsembleNombre');
    const ObjetDate_1 = require('ObjetDate');
    const C_JourCycleHorsGrille = -1;
    const C_MaxJoursParSemaine = 7;
    const { C_MaxDomaineCycle } = TypeDomaine_1.TypeDomaine;
    const C_NbJoursCaches = C_MaxDomaineCycle * 7 + 21;
    var EnumRecherche;
    (function (EnumRecherche) {
      EnumRecherche[(EnumRecherche['strict'] = 0)] = 'strict';
      EnumRecherche[(EnumRecherche['autoriserSuivants'] = 1)] =
        'autoriserSuivants';
      EnumRecherche[(EnumRecherche['autoriserPrecedents'] = 2)] =
        'autoriserPrecedents';
    })(EnumRecherche || (EnumRecherche = {}));
    class ObjetCycles {
      constructor() {
        this.donneesCycles = {
          premiereDate: null,
          derniereDate: null,
          dateDebutPremierCycle: null,
          joursOuvresParCycle: null,
          premierJourSemaine: 2,
          joursOuvres: null,
          joursFeries: new TypeEnsembleNombre_1.TypeEnsembleNombre(),
          cyclesSansFeries: false,
          cyclesHebdomadaire: true,
        };
        this.cache = {
          datePremierJourOuvre: null,
          cycleEtIndiceParDate: [],
          datesAfficheesParCycle: [],
          bornesCycles: [],
          nombreCyclesAnneeScolaire: null,
          domaineFerie: null,
          indicesJoursOuvres: null,
        };
        this.recherche = EnumRecherche;
      }
      init(aParametres) {
        $.extend(this.donneesCycles, aParametres);
        this._calculer();
        return this;
      }
      nombreJoursOuvresParCycle() {
        return this.donneesCycles.joursOuvresParCycle;
      }
      dateDebutPremierCycle() {
        return new Date(this.cache.bornesCycles[1].DateDebut);
      }
      dateFinDernierCycle() {
        return new Date(
          this.cache.bornesCycles[this.cache.nombreCyclesAnneeScolaire].DateFin,
        );
      }
      dateEnCycleEtJourCycle(aDate, aTypeRecherche) {
        let LDate;
        let LCycleEtIndice = { cycle: -1, indice: C_JourCycleHorsGrille };
        let lResult = { trouve: false };
        try {
          LDate = aDate;
          if (LDate < this.dateDebutPremierCycle()) {
            if (aTypeRecherche !== ObjetCycles.recherche.autoriserSuivants) {
              return lResult;
            }
            LDate = this.dateDebutPremierCycle();
          }
          if (LDate > this.dateFinDernierCycle()) {
            if (aTypeRecherche !== ObjetCycles.recherche.autoriserPrecedents) {
              return lResult;
            }
            LDate = this.dateFinDernierCycle();
          }
          while (
            LCycleEtIndice.indice === C_JourCycleHorsGrille &&
            LDate >= this.dateDebutPremierCycle() &&
            LDate <= this.dateFinDernierCycle()
          ) {
            LCycleEtIndice = this.cycleEtIndiceCycleDeDate(LDate);
            if (LCycleEtIndice.indice === C_JourCycleHorsGrille) {
              switch (aTypeRecherche) {
                case ObjetCycles.recherche.autoriserSuivants:
                  LDate = ObjetDate_1.GDate.getJourSuivant(LDate, 1);
                  break;
                case ObjetCycles.recherche.autoriserPrecedents:
                  LDate = ObjetDate_1.GDate.getJourSuivant(LDate, -1);
                  break;
                default:
                  return lResult;
              }
            }
          }
        } finally {
          lResult.cycle = LCycleEtIndice.cycle;
          lResult.indice = LCycleEtIndice.indice;
          lResult.trouve = lResult.indice !== C_JourCycleHorsGrille;
        }
        return lResult;
      }
      nombreCyclesAnneeScolaire() {
        return this.cache.nombreCyclesAnneeScolaire;
      }
      cycleDeLaDate(aDate) {
        const LDate = this._getDateBornee(aDate),
          lObj = this.cycleEtIndiceCycleDeDate(LDate);
        return lObj ? lObj.cycle : 0;
      }
      dateEnJourCycle(aDate) {
        const lTimeJour = new Date(
          aDate.getFullYear(),
          aDate.getMonth(),
          aDate.getDate(),
        ).getTime();
        if (!this._cacheDateEnJourCycle) {
          this._cacheDateEnJourCycle = {};
        }
        if (
          !this._cacheDateEnJourCycle[lTimeJour] &&
          this._cacheDateEnJourCycle[lTimeJour] !== 0
        ) {
          const lResult = this.dateEnCycleEtJourCycle(
            aDate,
            ObjetCycles.recherche.autoriserPrecedents,
          );
          if (lResult.trouve) {
            this._cacheDateEnJourCycle[lTimeJour] = lResult.indice;
          }
        }
        const lJourCycle = this._cacheDateEnJourCycle[lTimeJour];
        return lJourCycle === undefined ? 0 : lJourCycle;
      }
      cycleCourant() {
        return this.cycleDeLaDate(new Date());
      }
      dateDebutCycle(aCycle) {
        const lDate =
          this.cache.bornesCycles[
            Math.borner(aCycle, 1, this.nombreCyclesAnneeScolaire())
          ].DateDebut;
        return MethodesObjet_1.MethodesObjet.isDate(lDate)
          ? new Date(lDate)
          : lDate;
      }
      dateFinCycle(aCycle) {
        const lDate =
          this.cache.bornesCycles[
            Math.borner(aCycle, 1, this.nombreCyclesAnneeScolaire())
          ].DateFin;
        return MethodesObjet_1.MethodesObjet.isDate(lDate)
          ? new Date(lDate)
          : lDate;
      }
      datePremierJourOuvreCycle(aCycle) {
        const lCycle = Math.borner(aCycle, 1, this.nombreCyclesAnneeScolaire());
        let lResult = null;
        for (
          let lIndice = 0;
          lIndice < this.donneesCycles.joursOuvresParCycle;
          lIndice++
        ) {
          lResult = this.cache.datesAfficheesParCycle[lCycle][lIndice] || null;
          if (lResult !== null) {
            break;
          }
        }
        return MethodesObjet_1.MethodesObjet.isDate(lResult)
          ? new Date(lResult)
          : lResult;
      }
      dateDernierJourOuvreCycle(aCycle) {
        const lCycle = Math.borner(aCycle, 1, this.nombreCyclesAnneeScolaire());
        let lIndice = this.donneesCycles.joursOuvresParCycle;
        let lResult = null;
        while (lResult === null && lIndice >= 0) {
          lResult = this.cache.datesAfficheesParCycle[lCycle][lIndice] || null;
          lIndice += -1;
        }
        return MethodesObjet_1.MethodesObjet.isDate(lResult)
          ? new Date(lResult)
          : lResult;
      }
      jourCycleEnDate(AJourCycle, ACycle) {
        if (ACycle < 1) {
          return this.dateDebutPremierCycle();
        }
        if (ACycle > this.cache.nombreCyclesAnneeScolaire) {
          return this.dateFinCycle(this.cache.nombreCyclesAnneeScolaire);
        }
        if (AJourCycle < 0) {
          return this.dateDebutCycle(ACycle);
        }
        if (!this.cache.datesAfficheesParCycle[ACycle]) {
          return this.dateDebutPremierCycle();
        }
        if (AJourCycle >= this.cache.datesAfficheesParCycle[ACycle].length) {
          return this.dateFinCycle(ACycle);
        }
        const lDate = this.cache.datesAfficheesParCycle[ACycle][AJourCycle];
        return MethodesObjet_1.MethodesObjet.isDate(lDate)
          ? new Date(lDate)
          : lDate;
      }
      estDateFerie(aDate) {
        if (this.donneesCycles.joursFeries) {
          const lJourAnnuel = ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(
            this.dateDebutPremierCycle(),
            aDate,
          );
          return this.donneesCycles.joursFeries.contains(lJourAnnuel + 1);
        }
        return false;
      }
      getDomaineFerie() {
        if (!this.cache.domaineFerie) {
          this.cache.domaineFerie = new TypeDomaine_1.TypeDomaine();
          let lJourCycle,
            LSemaineFeriee,
            lNombreCycles = this.nombreCyclesAnneeScolaire(),
            lNombreJoursCycle = this.nombreJoursOuvresParCycle(),
            lDate;
          for (let lCycle = 1; lCycle <= lNombreCycles; lCycle += 1) {
            LSemaineFeriee = true;
            for (
              lJourCycle = 0;
              lJourCycle < lNombreJoursCycle && LSemaineFeriee;
              lJourCycle += 1
            ) {
              lDate = this.jourCycleEnDate(lJourCycle, lCycle);
              LSemaineFeriee =
                this.estDateFerie(lDate) || !this._dateDansBorne(lDate);
            }
            this.cache.domaineFerie.setValeur(LSemaineFeriee, lCycle);
          }
        }
        return this.cache.domaineFerie;
      }
      cycleDansAnnee(aCycle) {
        return Math.max(1, Math.min(this.nombreCyclesAnneeScolaire(), aCycle));
      }
      indicesJoursOuvres() {
        if (!this.cache.indicesJoursOuvres) {
          this.cache.indicesJoursOuvres = [];
          if (this.donneesCycles.cyclesHebdomadaire) {
            for (let i = 0; i < 7; i++) {
              if (this.donneesCycles.joursOuvres.contains(i)) {
                let lJour = (i + this.donneesCycles.premierJourSemaine - 2) % 7;
                if (lJour < 0) {
                  lJour = 6;
                }
                this.cache.indicesJoursOuvres.push(lJour);
              }
            }
          } else {
            for (let i = 0; i < this.donneesCycles.joursOuvresParCycle; i++) {
              this.cache.indicesJoursOuvres.push(i);
            }
          }
        }
        return this.cache.indicesJoursOuvres;
      }
      _calculer() {
        let lDatesAIgnorer = new TypeEnsembleNombre_1.TypeEnsembleNombre(),
          lEnSemaine,
          lJourSemaine,
          iJour,
          iCycle,
          lIndiceCycle,
          lJourHebdo,
          LCycle,
          IDate,
          LIndiceJourAnnee,
          LPasToutRempli,
          lTab,
          i;
        this._cacheDateEnJourCycle = null;
        if (
          !this.donneesCycles.joursOuvres ||
          this.donneesCycles.joursOuvres.count() === 0
        ) {
          return;
        }
        if (
          this.donneesCycles.cyclesSansFeries &&
          this.donneesCycles.joursFeries
        ) {
          lTab = this.donneesCycles.joursFeries.items();
          for (i in lTab) {
            lDatesAIgnorer.add(
              ObjetDate_1.GDate.getJourSuivant(
                this.donneesCycles.dateDebutPremierCycle,
                lTab[i] - 1,
              ).getTime(),
            );
          }
        }
        this.cache.datePremierJourOuvre = this.donneesCycles.premiereDate;
        lEnSemaine =
          lDatesAIgnorer.count() === 0 &&
          this.donneesCycles.joursOuvresParCycle %
            this.donneesCycles.joursOuvres.count() ===
            0;
        if (lEnSemaine) {
          lJourSemaine = this.cache.datePremierJourOuvre.getDay() + 1;
          while (lJourSemaine !== this.donneesCycles.premierJourSemaine) {
            this.cache.datePremierJourOuvre = ObjetDate_1.GDate.getJourSuivant(
              this.cache.datePremierJourOuvre,
              -1,
            );
            lJourSemaine = this.cache.datePremierJourOuvre.getDay() + 1;
          }
        }
        for (iJour = 0; iJour <= C_NbJoursCaches; iJour++) {
          this.cache.cycleEtIndiceParDate[iJour] = {
            cycle: 1,
            indice: C_JourCycleHorsGrille,
          };
        }
        for (iCycle = 0; iCycle <= ObjetCycles.C_MaxDomaineCycle; iCycle += 1) {
          this.cache.datesAfficheesParCycle[iCycle] = [];
          this.cache.bornesCycles[iCycle] = {
            DateDebut: new Date(0),
            DateFin: new Date(0),
          };
        }
        this.cache.bornesCycles[1].DateDebut = this.cache.datePremierJourOuvre;
        lIndiceCycle = -1;
        lJourHebdo =
          _DateEnJourHebdo(
            this.cache.datePremierJourOuvre,
            this.donneesCycles.premierJourSemaine,
          ) - 1;
        LCycle = 0;
        let lIncDate = 0;
        this.cache.nombreCyclesAnneeScolaire = 0;
        LIndiceJourAnnee = 0;
        LPasToutRempli = true;
        while (LPasToutRempli) {
          IDate = ObjetDate_1.GDate.getJourSuivant(
            this.cache.datePremierJourOuvre,
            lIncDate,
          );
          lIncDate++;
          lJourHebdo = _IncJourHebdo(lJourHebdo);
          if (
            lDatesAIgnorer.contains(IDate.getTime()) ||
            (!lEnSemaine &&
              IDate.getTime() < this.donneesCycles.premiereDate.getTime()) ||
            !this.donneesCycles.joursOuvres.contains(lJourHebdo)
          ) {
            if (LIndiceJourAnnee <= C_NbJoursCaches) {
              this.cache.cycleEtIndiceParDate[LIndiceJourAnnee] = {
                cycle: Math.max(1, LCycle),
                indice: C_JourCycleHorsGrille,
              };
            }
          } else {
            lIndiceCycle =
              (lIndiceCycle + 1) % this.donneesCycles.joursOuvresParCycle;
            if (lIndiceCycle === 0) {
              LCycle += 1;
            }
            if (LIndiceJourAnnee <= C_NbJoursCaches) {
              this.cache.cycleEtIndiceParDate[LIndiceJourAnnee] = {
                cycle: LCycle,
                indice: lIndiceCycle,
              };
            }
            if (LCycle <= ObjetCycles.C_MaxDomaineCycle) {
              this.cache.datesAfficheesParCycle[LCycle][lIndiceCycle] = IDate;
            }
            if (lIndiceCycle === 0 && LCycle > 1) {
              if (LCycle <= ObjetCycles.C_MaxDomaineCycle) {
                this.cache.bornesCycles[LCycle].DateDebut = new Date(
                  IDate.getTime(),
                );
              }
              if (LCycle - 1 <= ObjetCycles.C_MaxDomaineCycle) {
                this.cache.bornesCycles[LCycle - 1].DateFin =
                  ObjetDate_1.GDate.getJourSuivant(IDate, -1);
              }
            }
          }
          if (
            ObjetDate_1.GDate.estJourEgal(
              IDate,
              this.donneesCycles.derniereDate,
            )
          ) {
            this.cache.nombreCyclesAnneeScolaire = LCycle;
          }
          LIndiceJourAnnee += 1;
          LPasToutRempli =
            LCycle <= ObjetCycles.C_MaxDomaineCycle ||
            LIndiceJourAnnee <= C_NbJoursCaches;
        }
      }
      cycleEtIndiceCycleDeDate(aDate) {
        const lDate = ObjetDate_1.GDate.getJour(aDate);
        const LDateRef = this.cache.bornesCycles[1].DateDebut;
        let lResult = { cycle: -1, indice: C_JourCycleHorsGrille };
        if (
          lDate.getTime() >= LDateRef.getTime() &&
          lDate.getTime() <=
            this.cache.bornesCycles[
              this.cache.nombreCyclesAnneeScolaire
            ].DateFin.getTime()
        ) {
          lResult =
            this.cache.cycleEtIndiceParDate[
              ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(LDateRef, lDate)
            ];
        }
        return lResult;
      }
      _getDateBornee(aDate) {
        if (aDate < this.donneesCycles.premiereDate) {
          return new Date(this.donneesCycles.premiereDate.getTime());
        }
        if (aDate > this.donneesCycles.derniereDate) {
          return new Date(this.donneesCycles.derniereDate.getTime());
        } else {
          return aDate;
        }
      }
      _dateDansBorne(aDate) {
        return (
          (aDate >= this.donneesCycles.premiereDate ||
            ObjetDate_1.GDate.estJourEgal(
              aDate,
              this.donneesCycles.premiereDate,
            )) &&
          (aDate <= this.donneesCycles.derniereDate ||
            ObjetDate_1.GDate.estJourEgal(
              aDate,
              this.donneesCycles.derniereDate,
            ))
        );
      }
    }
    exports.ObjetCycles = ObjetCycles;
    ObjetCycles.C_IndicePremierJourCycle = 0;
    ObjetCycles.C_IndiceDernierJourCycle = Number.MAX_VALUE;
    ObjetCycles.C_IndiceDernierJourOuvreCycle = Number.MAX_VALUE - 1;
    ObjetCycles.C_MaxDomaineCycle = C_MaxDomaineCycle;
    ObjetCycles.recherche = EnumRecherche;
    function _DateEnJourHebdo(ADate, APremierJourSemaine) {
      let LPremierJour = APremierJourSemaine;
      if (LPremierJour > C_MaxJoursParSemaine) {
        LPremierJour = LPremierJour - C_MaxJoursParSemaine;
      }
      let LJourTt = ADate.getDay() + 1;
      if (LJourTt >= LPremierJour) {
        return LJourTt - LPremierJour;
      }
      return LJourTt + C_MaxJoursParSemaine - LPremierJour;
    }
    function _IncJourHebdo(aJourHebdo) {
      return (aJourHebdo + 1) % C_MaxJoursParSemaine;
    }
  },
  fn: 'objetcycles.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeEtatExecutionQCMPourRepondant = void 0;
    var TypeEtatExecutionQCMPourRepondant;
    (function (TypeEtatExecutionQCMPourRepondant) {
      TypeEtatExecutionQCMPourRepondant[
        (TypeEtatExecutionQCMPourRepondant['EQR_EnCours'] = 0)
      ] = 'EQR_EnCours';
      TypeEtatExecutionQCMPourRepondant[
        (TypeEtatExecutionQCMPourRepondant['EQR_Termine'] = 1)
      ] = 'EQR_Termine';
      TypeEtatExecutionQCMPourRepondant[
        (TypeEtatExecutionQCMPourRepondant['EQR_DureeMaxDepassee'] = 2)
      ] = 'EQR_DureeMaxDepassee';
      TypeEtatExecutionQCMPourRepondant[
        (TypeEtatExecutionQCMPourRepondant['EQR_ARefaire'] = 3)
      ] = 'EQR_ARefaire';
    })(
      TypeEtatExecutionQCMPourRepondant ||
        (exports.TypeEtatExecutionQCMPourRepondant =
          TypeEtatExecutionQCMPourRepondant =
            {}),
    );
  },
  fn: 'typeetatexecutionqcmpourrepondant.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeModeCorrectionQCM = void 0;
    var TypeModeCorrectionQCM;
    (function (TypeModeCorrectionQCM) {
      TypeModeCorrectionQCM[(TypeModeCorrectionQCM['FBQ_CorrigeSans'] = 0)] =
        'FBQ_CorrigeSans';
      TypeModeCorrectionQCM[
        (TypeModeCorrectionQCM['FBQ_CorrigeApresQuestion'] = 1)
      ] = 'FBQ_CorrigeApresQuestion';
      TypeModeCorrectionQCM[(TypeModeCorrectionQCM['FBQ_CorrigeALaFin'] = 2)] =
        'FBQ_CorrigeALaFin';
      TypeModeCorrectionQCM[(TypeModeCorrectionQCM['FBQ_CorrigeALaDate'] = 3)] =
        'FBQ_CorrigeALaDate';
    })(
      TypeModeCorrectionQCM ||
        (exports.TypeModeCorrectionQCM = TypeModeCorrectionQCM = {}),
    );
  },
  fn: 'typemodecorrectionqcm.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreRenduTAFUtil = exports.TypeGenreRenduTAF = void 0;
    var TypeGenreRenduTAF;
    (function (TypeGenreRenduTAF) {
      TypeGenreRenduTAF[(TypeGenreRenduTAF['GRTAF_AucunRendu'] = 0)] =
        'GRTAF_AucunRendu';
      TypeGenreRenduTAF[(TypeGenreRenduTAF['GRTAF_RenduPapier'] = 1)] =
        'GRTAF_RenduPapier';
      TypeGenreRenduTAF[(TypeGenreRenduTAF['GRTAF_RenduPronote'] = 2)] =
        'GRTAF_RenduPronote';
      TypeGenreRenduTAF[(TypeGenreRenduTAF['GRTAF_RenduKiosque'] = 3)] =
        'GRTAF_RenduKiosque';
      TypeGenreRenduTAF[
        (TypeGenreRenduTAF['GRTAF_RenduPronoteEnregistrementAudio'] = 4)
      ] = 'GRTAF_RenduPronoteEnregistrementAudio';
    })(
      TypeGenreRenduTAF || (exports.TypeGenreRenduTAF = TypeGenreRenduTAF = {}),
    );
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const TypeGenreRenduTAFUtil = {
      estGenreValable(aGenre) {
        const lParametresPN = GParametres;
        let lResult = true;
        if (
          lParametresPN &&
          lParametresPN.general &&
          lParametresPN.general.genresRenduTAFValable
        ) {
          lResult =
            lParametresPN.general.genresRenduTAFValable.contains(aGenre);
        }
        return lResult;
      },
      getDureeMaxEnregistrementAudio() {
        const lParametresPN = GParametres;
        let lTailleMax = 30;
        if (
          lParametresPN &&
          lParametresPN.general &&
          lParametresPN.general.tailleMaxEnregistrementAudioRenduTAF
        ) {
          lTailleMax =
            lParametresPN.general.tailleMaxEnregistrementAudioRenduTAF * 60;
        }
        return lTailleMax;
      },
      getLibelle(aGenre) {
        switch (aGenre) {
          case TypeGenreRenduTAF.GRTAF_AucunRendu:
            return ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.TAFARendre.AucunRenduPrevu',
            );
          case TypeGenreRenduTAF.GRTAF_RenduPapier:
            return ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.TAFARendre.ARemettre',
            );
          case TypeGenreRenduTAF.GRTAF_RenduPronote:
            return ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.TAFARendre.ADeposer',
            );
          case TypeGenreRenduTAF.GRTAF_RenduKiosque:
            return ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.TAFARendre.ACompleterEditeur',
            );
          case TypeGenreRenduTAF.GRTAF_RenduPronoteEnregistrementAudio:
            return ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.TAFARendre.EnregistrementADeposer',
            );
          default:
        }
        return '';
      },
      getOrdre(aGenre) {
        return [0, 1, 2, 3, 4][aGenre];
      },
      toElement(aGenre) {
        const lElement = new ObjetElement_1.ObjetElement(
          TypeGenreRenduTAFUtil.getLibelle(aGenre),
          0,
          aGenre,
        );
        lElement.ordre = TypeGenreRenduTAFUtil.getOrdre(aGenre);
        return lElement;
      },
      fromElement(aElt) {
        return aElt !== null && aElt !== undefined
          ? aElt.getGenre()
          : TypeGenreRenduTAF.GRTAF_AucunRendu;
      },
      toListe(aGenresAExclure) {
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        for (const lKey of MethodesObjet_1.MethodesObjet.enumKeys(
          TypeGenreRenduTAF,
        )) {
          const lRendu = TypeGenreRenduTAF[lKey];
          if (
            TypeGenreRenduTAFUtil.estGenreValable(lRendu) &&
            (!aGenresAExclure || !aGenresAExclure.includes(lRendu))
          ) {
            let lElement = TypeGenreRenduTAFUtil.toElement(lRendu);
            lListe.addElement(lElement);
          }
        }
        lListe.setTri([ObjetTri_1.ObjetTri.init('ordre')]);
        lListe.trier();
        return lListe;
      },
      estUnRenduEnligne(aGenre, aInclureKiosque = true) {
        if (aGenre === undefined || aGenre === null) {
          return false;
        }
        const lArrTypes = [
          TypeGenreRenduTAF.GRTAF_RenduPronote,
          TypeGenreRenduTAF.GRTAF_RenduPronoteEnregistrementAudio,
        ];
        if (aInclureKiosque !== false) {
          lArrTypes.push(TypeGenreRenduTAF.GRTAF_RenduKiosque);
        }
        return lArrTypes.includes(aGenre);
      },
      estUnRenduPapier(aGenre) {
        if (aGenre === undefined || aGenre === null) {
          return false;
        }
        return [TypeGenreRenduTAF.GRTAF_RenduPapier].includes(aGenre);
      },
      estSansRendu(aGenre) {
        if (aGenre === undefined || aGenre === null) {
          return true;
        }
        return [TypeGenreRenduTAF.GRTAF_AucunRendu].includes(aGenre);
      },
      estUnRenduKiosque(aGenre) {
        if (aGenre === undefined || aGenre === null) {
          return false;
        }
        return [TypeGenreRenduTAF.GRTAF_RenduKiosque].includes(aGenre);
      },
      estUnRenduMedia(aGenre) {
        if (aGenre === undefined || aGenre === null) {
          return false;
        }
        return [
          TypeGenreRenduTAF.GRTAF_RenduPronoteEnregistrementAudio,
        ].includes(aGenre);
      },
      getLibelleConsultation(aGenre, aPourEleve) {
        switch (aGenre) {
          case TypeGenreRenduTAF.GRTAF_AucunRendu:
            return '';
          case TypeGenreRenduTAF.GRTAF_RenduPapier:
            return '';
          case TypeGenreRenduTAF.GRTAF_RenduPronote:
            return ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.TAFARendre.Eleve.CopieDeposee',
            );
          case TypeGenreRenduTAF.GRTAF_RenduKiosque:
            return aPourEleve
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'CahierDeTexte.TAFARendre.Eleve.ConsulterMesReponses',
                )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'CahierDeTexte.TAFARendre.Eleve.ConsulterLesReponses',
                );
          case TypeGenreRenduTAF.GRTAF_RenduPronoteEnregistrementAudio:
            return ObjetTraduction_1.GTraductions.getValeur(
              'EnregistrementAudio.depose',
            );
        }
        return '';
      },
      getLibelleDeposer(aGenre, aPourEleve) {
        switch (aGenre) {
          case TypeGenreRenduTAF.GRTAF_AucunRendu:
            return '';
          case TypeGenreRenduTAF.GRTAF_RenduPapier:
            return ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.TAFARendre.Eleve.RenduPapier',
            );
          case TypeGenreRenduTAF.GRTAF_RenduPronote:
            return aPourEleve
              ? GApplication.getEtatUtilisateur().pourPrimaire()
                ? ObjetTraduction_1.GTraductions.getValeur(
                    'CahierDeTexte.TAFARendre.Eleve.RenduPrimaire',
                  )
                : ObjetTraduction_1.GTraductions.getValeur(
                    'CahierDeTexte.TAFARendre.Eleve.RenduPronote',
                  )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'CahierDeTexte.TAFARendre.Eleve.RenduNumerique',
                );
          case TypeGenreRenduTAF.GRTAF_RenduKiosque:
            return aPourEleve
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'CahierDeTexte.TAFARendre.ACompleterEditeurSite',
                )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'CahierDeTexte.TAFARendre.ACompleterEditeur',
                );
          case TypeGenreRenduTAF.GRTAF_RenduPronoteEnregistrementAudio:
            return aPourEleve
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'EnregistrementAudio.deposer',
                )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'CahierDeTexte.TAFARendre.Eleve.RenduNumerique',
                );
        }
        return '';
      },
    };
    exports.TypeGenreRenduTAFUtil = TypeGenreRenduTAFUtil;
  },
  fn: 'typegenrerendutaf.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeHttpMarqueurContenuCours = void 0;
    var TypeHttpMarqueurContenuCours;
    (function (TypeHttpMarqueurContenuCours) {
      TypeHttpMarqueurContenuCours[
        (TypeHttpMarqueurContenuCours['hmcc_ReservePar'] = 0)
      ] = 'hmcc_ReservePar';
      TypeHttpMarqueurContenuCours[
        (TypeHttpMarqueurContenuCours['hmcc_LibelleHoraire'] = 1)
      ] = 'hmcc_LibelleHoraire';
      TypeHttpMarqueurContenuCours[
        (TypeHttpMarqueurContenuCours['hmcc_TitreCDT'] = 2)
      ] = 'hmcc_TitreCDT';
      TypeHttpMarqueurContenuCours[
        (TypeHttpMarqueurContenuCours['hmcc_Remplacant'] = 3)
      ] = 'hmcc_Remplacant';
      TypeHttpMarqueurContenuCours[
        (TypeHttpMarqueurContenuCours['hmcc_PeriodeAnnuel'] = 4)
      ] = 'hmcc_PeriodeAnnuel';
      TypeHttpMarqueurContenuCours[
        (TypeHttpMarqueurContenuCours['hmcc_PartiesCours'] = 5)
      ] = 'hmcc_PartiesCours';
      TypeHttpMarqueurContenuCours[
        (TypeHttpMarqueurContenuCours['hmcc_ElevesAccompagnes'] = 6)
      ] = 'hmcc_ElevesAccompagnes';
    })(
      TypeHttpMarqueurContenuCours ||
        (exports.TypeHttpMarqueurContenuCours = TypeHttpMarqueurContenuCours =
          {}),
    );
  },
  fn: 'typehttpmarqueurcontenucours.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetDeserialiser = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    const ObjetDate_1 = require('ObjetDate');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const TypeEtatExecutionQCMPourRepondant_1 = require('TypeEtatExecutionQCMPourRepondant');
    const TypeModeCorrectionQCM_1 = require('TypeModeCorrectionQCM');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const TypeGenrePunition_1 = require('TypeGenrePunition');
    const TypeGenreRenduTAF_1 = require('TypeGenreRenduTAF');
    const TypeHttpMarqueurContenuCours_1 = require('TypeHttpMarqueurContenuCours');
    class ObjetDeserialiser {
      listeEvenementsVS(aListe, aPourAccueil) {
        this.pourAccueil = aPourAccueil;
        aListe.parcourir(this._enrichirEvenementVS.bind(this, aListe));
        aListe.setTri([
          ObjetTri_1.ObjetTri.init(
            'aRegulariser',
            Enumere_TriElement_1.EGenreTriElement.Decroissant,
          ),
          ObjetTri_1.ObjetTri.init((D) => {
            return D.dateDebut ? D.dateDebut : D.dateDemande;
          }, Enumere_TriElement_1.EGenreTriElement.Decroissant),
        ]);
        aListe.trier();
        return aListe;
      }
      _formaterEvenementVS(aParam) {
        aParam.element.avecSaisie = !!aParam.element.avecSaisie;
        if (aParam.element.date) {
          aParam.element.dateDebut = aParam.element.date;
          aParam.element.dateFin = aParam.element.date;
        }
        if (!aParam.element.dateFin) {
          aParam.element.dateFin = aParam.element.dateDebut;
        }
        aParam.element.estDemiJournee = !!aParam.element.estMatin;
        if (
          aParam.element.getGenre() ===
            Enumere_Ressource_1.EGenreRessource.Punition &&
          (aParam.element.nature.getGenre() ===
            TypeGenrePunition_1.TypeGenrePunition.GP_ExclusionCours ||
            !aParam.pourAccueil)
        ) {
          aParam.element.dateDebut = aParam.element.dateDemande;
          aParam.element.dateFin = aParam.element.dateDemande;
          aParam.element.place = aParam.element.placeDemande;
          if (!aParam.pourAccueil && aParam.liste) {
            for (
              let I = 0;
              aParam.element.programmation &&
              I < aParam.element.programmation.count();
              I++
            ) {
              const lNewElement = MethodesObjet_1.MethodesObjet.dupliquer(
                aParam.element,
              );
              const lProg = aParam.element.programmation.get(I);
              lNewElement.dateDebut = lProg.date;
              lNewElement.dateFin = lProg.date;
              lNewElement.estProgrammation = true;
              if (lProg.place !== null && lProg.place !== undefined) {
                lNewElement.place = lProg.place;
              }
              if (lProg.duree) {
                lNewElement.duree = lProg.duree;
              } else {
                lNewElement.duree = aParam.element.duree;
              }
              lNewElement.Position =
                Enumere_Ressource_1.EGenreRessourceUtil.getPositionAbsence(
                  lNewElement.getGenre(),
                  { genreObservation: lNewElement.genreObservation },
                );
              aParam.liste.addElement(lNewElement);
            }
          }
        }
        if (aParam.element.programmation) {
          aParam.element.programmation.setTri([
            ObjetTri_1.ObjetTri.init('date'),
          ]);
          aParam.element.programmation.trier();
        }
        aParam.element.Position =
          Enumere_Ressource_1.EGenreRessourceUtil.getPositionAbsence(
            aParam.element.getGenre(),
            { genreObservation: aParam.element.genreObservation },
          );
        aParam.element.aRegulariser = this._evenementVSARegulariser(
          aParam.element,
        );
      }
      _evenementVSARegulariser(aElement) {
        switch (aElement.getGenre()) {
          case Enumere_Ressource_1.EGenreRessource.Absence:
          case Enumere_Ressource_1.EGenreRessource.Retard: {
            let lIlYADejaInfoSaisie = false;
            if (aElement.avecSaisie) {
              if (
                !!aElement.aJustifierParParents &&
                aElement.reglee &&
                !aElement.confirmee
              ) {
                return false;
              }
              lIlYADejaInfoSaisie = !!aElement.motifParent;
              if (
                !!aElement.aJustifierParParents &&
                (!lIlYADejaInfoSaisie || aElement.confirmee)
              ) {
                lIlYADejaInfoSaisie = !!aElement.justification;
                if (!lIlYADejaInfoSaisie && !!aElement.documents) {
                  lIlYADejaInfoSaisie =
                    aElement.documents.getNbrElementsExistes() > 0;
                }
              }
              return !lIlYADejaInfoSaisie;
            } else {
              return false;
            }
          }
          case Enumere_Ressource_1.EGenreRessource.ObservationProfesseurEleve:
            return !aElement.estLue;
          case Enumere_Ressource_1.EGenreRessource.Punition:
            return !!(
              aElement.nature &&
              aElement.nature.estAvecARParent &&
              !aElement.parentAAccuseDeReception
            );
          default:
            return false;
        }
      }
      listeCours(aJSON) {
        const lListe = new ObjetListeElements_1.ObjetListeElements().fromJSON(
          aJSON.ListeCours,
          this._ajouterCours.bind(this),
        );
        lListe.setTri([ObjetTri_1.ObjetTri.init('DateDuCours')]);
        lListe.trier();
        return lListe;
      }
      _ajouterCours(aJSON, aElement) {
        aElement.copieJSON(aJSON);
        aElement.Debut = aElement.place;
        aElement.Fin = aElement.place + aElement.duree - 1;
        aElement.AppelFait =
          aElement.NomImageAppelFait === 'AppelFait' ||
          aElement.NomImageAppelFait === 'AppelVerrouFait';
        aElement.estAppelVerrouille =
          aElement.NomImageAppelFait === 'AppelVerrouNonFait' ||
          aElement.NomImageAppelFait === 'AppelVerrouFait';
        if (aJSON.estSortiePedagogique) {
          aElement.couleurFondHorsBordure = '#FFFFFF';
          aElement.ListeContenus =
            new ObjetListeElements_1.ObjetListeElements();
          let lElement = Object.assign(
            new ObjetElement_1.ObjetElement(
              ObjetTraduction_1.GTraductions.getValeur(
                'EDT.AbsRess.SortiePedagogique',
              ),
            ),
            { marqueur: 'titreSortie', estLibelleTitreSortie: true },
          );
          aElement.ListeContenus.addElement(lElement);
          lElement = Object.assign(
            new ObjetElement_1.ObjetElement(aElement.strDateDebut),
            { marqueur: 'titreSortie' },
          );
          aElement.ListeContenus.addElement(lElement);
          if (aElement.strDateFin) {
            lElement = Object.assign(
              new ObjetElement_1.ObjetElement(aElement.strDateFin),
              { marqueur: 'titreSortie' },
            );
            aElement.ListeContenus.addElement(lElement);
          }
          const lMotif = new ObjetElement_1.ObjetElement(
            aElement.motif,
            0,
            Enumere_Ressource_1.EGenreRessource.Matiere,
          );
          aElement.matiere = lMotif;
          aElement.ListeContenus.addElement(lMotif);
          if (aElement.pourAcc && aElement.strRess) {
            aElement.ListeContenus.addElement(
              new ObjetElement_1.ObjetElement(
                aElement.strRess,
                0,
                Enumere_Ressource_1.EGenreRessource.Classe,
              ),
            );
          }
          if (aElement.accompagnateurs && aElement.accompagnateurs.forEach) {
            aElement.accompagnateurs.forEach((aStr) => {
              aElement.ListeContenus.addElement(
                new ObjetElement_1.ObjetElement(
                  aStr,
                  0,
                  Enumere_Ressource_1.EGenreRessource.Enseignant,
                ),
              );
            });
          }
          if (aElement.forcerAppelVerrou) {
            aElement.estAppelVerrouille = true;
          }
        } else if (aJSON.estRetenue) {
          aElement.CouleurFond = '#FF0000';
          aElement.couleurFondHorsBordure = '#FFFFFF';
        } else {
          aElement.estAnnule = !!aJSON.estAnnule;
          aElement.estPermanence = !!aJSON.estPermanence;
          aElement.utilisable = aJSON.utilisable !== false;
          aElement.utilisableCDT = aJSON.utilisableCDT !== false;
          aElement.utilisableAppel = aJSON.utilisableAppel !== false;
          aElement.modifiable = !!aJSON.modifiable;
          aElement.ressourcesModifiables = !!aJSON.ressourcesModifiables;
          aElement.verrouDeplacement = !!aJSON.verrouDeplacement;
          aElement.cdtAffecte =
            aJSON.CahierDeTextes && aJSON.CahierDeTextes.Affecte;
          aElement.avecTafPublie = aJSON.AvecTafPublie;
          aElement.avecChargeTAF = !!aJSON.AvecChargeTAF;
          aElement.estGAEV = !!aJSON.estGAEV;
          aElement.estCoEnseignement = !!aJSON.estCoEnseignement;
          aElement.ListeContenus.parcourir((aContenu) => {
            if (
              aContenu.getGenre() ===
              Enumere_Ressource_1.EGenreRessource.Matiere
            ) {
              aElement.matiere = aContenu;
            }
            if (
              aContenu.getGenre() ===
                Enumere_Ressource_1.EGenreRessource.Materiel ||
              aContenu.getGenre() === Enumere_Ressource_1.EGenreRessource.Salle
            ) {
              aContenu.nombre = aContenu.nombre || 1;
            }
          });
          aElement.ListeContenus.setTri([
            ObjetTri_1.ObjetTri.init((D) => {
              switch (D.getGenre()) {
                case Enumere_Ressource_1.EGenreRessource.Matiere:
                  return -1;
                case Enumere_Ressource_1.EGenreRessource.LibelleCours:
                  return -0.4;
                case Enumere_Ressource_1.EGenreRessource.Enseignant:
                  return 0;
                case Enumere_Ressource_1.EGenreRessource.Groupe:
                  return 1;
                case Enumere_Ressource_1.EGenreRessource.Classe:
                  return 2;
                case Enumere_Ressource_1.EGenreRessource.PartieDeClasse:
                  return 3;
                case Enumere_Ressource_1.EGenreRessource.Salle:
                  return 4;
                case Enumere_Ressource_1.EGenreRessource.Site:
                  return 5;
                case Enumere_Ressource_1.EGenreRessource.Personnel:
                  return 6;
                case Enumere_Ressource_1.EGenreRessource.Materiel:
                  return 7;
                case Enumere_Ressource_1.EGenreRessource.Service:
                  return 8;
              }
              switch (D.marqueur) {
                case TypeHttpMarqueurContenuCours_1.TypeHttpMarqueurContenuCours
                  .hmcc_ReservePar:
                  return -0.6;
                case TypeHttpMarqueurContenuCours_1.TypeHttpMarqueurContenuCours
                  .hmcc_LibelleHoraire:
                  return 99999;
                case TypeHttpMarqueurContenuCours_1.TypeHttpMarqueurContenuCours
                  .hmcc_TitreCDT:
                  return -0.5;
                case TypeHttpMarqueurContenuCours_1.TypeHttpMarqueurContenuCours
                  .hmcc_ElevesAccompagnes:
                  return -0.3;
                case TypeHttpMarqueurContenuCours_1.TypeHttpMarqueurContenuCours
                  .hmcc_Remplacant:
                  return 4.5;
                case TypeHttpMarqueurContenuCours_1.TypeHttpMarqueurContenuCours
                  .hmcc_PeriodeAnnuel:
                  return -9999;
                case TypeHttpMarqueurContenuCours_1.TypeHttpMarqueurContenuCours
                  .hmcc_PartiesCours:
                  return -10;
              }
              return 1000;
            }),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]);
          aElement.ListeContenus.trier();
          if (aElement.matiere) {
            aElement.matiere.CouleurFond = aElement.CouleurFond;
          }
        }
        if (aElement.DateDuCours) {
          aElement.numeroSemaine = IE.Cycles.cycleDeLaDate(
            aElement.DateDuCours,
          );
        }
      }
      _ajouterQCM(aJSON, aElement) {
        aElement.copieJSON(aJSON);
        if (
          aElement.getGenre() ===
          Enumere_Ressource_1.EGenreRessource.ExecutionQCM
        ) {
          aElement.QCM = new ObjetElement_1.ObjetElement().fromJSON(aJSON.QCM);
          aElement.QCM.copieJSON(aJSON.QCM);
          const lEspaceQCMConsult = [
            Enumere_Espace_1.EGenreEspace.Parent,
            Enumere_Espace_1.EGenreEspace.PrimParent,
            Enumere_Espace_1.EGenreEspace.Mobile_Parent,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
            Enumere_Espace_1.EGenreEspace.Accompagnant,
            Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
            Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
            Enumere_Espace_1.EGenreEspace.Tuteur,
            Enumere_Espace_1.EGenreEspace.Mobile_Tuteur,
            Enumere_Espace_1.EGenreEspace.Entreprise,
          ].includes(GEtatUtilisateur.GenreEspace);
          if (
            lEspaceQCMConsult &&
            (aElement.etatCloture === undefined ||
              aElement.etatCloture ===
                TypeEtatExecutionQCMPourRepondant_1
                  .TypeEtatExecutionQCMPourRepondant.EQR_EnCours)
          ) {
            aElement.modeDiffusionCorrige =
              TypeModeCorrectionQCM_1.TypeModeCorrectionQCM.FBQ_CorrigeSans;
            IE.log.addLog('modification modeDiffusionCorrige');
          }
        } else {
          aElement.niveau = new ObjetElement_1.ObjetElement().fromJSON(
            aJSON.niveau,
          );
          aElement.proprietaire = new ObjetElement_1.ObjetElement().fromJSON(
            aJSON.proprietaire,
          );
        }
        if (
          !aElement.matiere ||
          !MethodesObjet_1.MethodesObjet.isFunction(
            aElement.matiere.existeNumero,
          )
        ) {
          aElement.matiere = new ObjetElement_1.ObjetElement().fromJSON(
            aJSON.matiere,
          );
        }
      }
      getListeEvenements(aJSON, aCroissant) {
        const lListeEvenements =
          new ObjetListeElements_1.ObjetListeElements().fromJSON(
            aJSON,
            this._ajouterEvenement.bind(this),
          );
        lListeEvenements.setTri([
          ObjetTri_1.ObjetTri.init(
            (D) => {
              return D.sansHoraire
                ? new Date(
                    D.DateDebut.getFullYear(),
                    D.DateDebut.getMonth(),
                    D.DateDebut.getDate(),
                  )
                : D.DateDebut;
            },
            aCroissant
              ? Enumere_TriElement_1.EGenreTriElement.Croissant
              : Enumere_TriElement_1.EGenreTriElement.Decroissant,
          ),
          ObjetTri_1.ObjetTri.init(
            (D) => {
              return D.sansHoraire
                ? new Date(
                    D.DateFin.getFullYear(),
                    D.DateFin.getMonth(),
                    D.DateFin.getDate(),
                  )
                : D.DateFin;
            },
            aCroissant
              ? Enumere_TriElement_1.EGenreTriElement.Croissant
              : Enumere_TriElement_1.EGenreTriElement.Decroissant,
          ),
          ObjetTri_1.ObjetTri.init('Libelle'),
        ]);
        lListeEvenements.trier();
        lListeEvenements._getLibelleEvenement = this._getLibelleEvenement;
        lListeEvenements._getDateEvenement = this._getDateEvenement;
        return lListeEvenements;
      }
      deserialiserTAF(aTAF) {
        if (
          aTAF.avecMiseEnForme === undefined ||
          aTAF.avecMiseEnForme === null
        ) {
          aTAF.avecMiseEnForme = true;
        }
        aTAF.descriptif = ObjetChaine_1.GChaine.nettoyerCommentaire(
          aTAF.descriptif,
        );
        aTAF.estVide = false;
        if (!aTAF.genreRendu) {
          aTAF.genreRendu =
            TypeGenreRenduTAF_1.TypeGenreRenduTAF.GRTAF_AucunRendu;
        }
        if (!aTAF.ListePieceJointe) {
          aTAF.ListePieceJointe = new ObjetListeElements_1.ObjetListeElements();
        }
        aTAF.ListePieceJointe.parcourir((aPieceJointeDeTAF) => {
          aPieceJointeDeTAF.Url =
            ObjetChaine_1.GChaine.creerUrlBruteLienExterne(aPieceJointeDeTAF);
        });
        if (!!aTAF.executionQCM) {
          const lExecutionQCMaRemplir = new ObjetElement_1.ObjetElement();
          new ObjetDeserialiser()._ajouterQCM(
            aTAF.executionQCM,
            lExecutionQCMaRemplir,
          );
          aTAF.executionQCM = lExecutionQCMaRemplir;
        }
      }
      deserialiserContenuDeCours(aContenuCours) {
        aContenuCours.descriptif = ObjetChaine_1.GChaine.nettoyerCommentaire(
          aContenuCours.descriptif,
        );
        aContenuCours.objectifs = ObjetChaine_1.GChaine.nettoyerCommentaire(
          aContenuCours.objectifs || '',
        );
        if (!aContenuCours.categorie) {
          aContenuCours.categorie = new ObjetElement_1.ObjetElement('', 0);
        }
        aContenuCours.estVide = false;
        if (!aContenuCours.ListePieceJointe) {
          aContenuCours.ListePieceJointe =
            new ObjetListeElements_1.ObjetListeElements();
        }
        aContenuCours.ListePieceJointe.parcourir(
          (aPieceJointeDeContenuDeCours) => {
            aPieceJointeDeContenuDeCours.Url =
              ObjetChaine_1.GChaine.creerUrlBruteLienExterne(
                aPieceJointeDeContenuDeCours,
              );
          },
        );
        aContenuCours.ListePieceJointe.setTri([
          ObjetTri_1.ObjetTri.init((D) => {
            return (
              D.getGenre() !==
              Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier
            );
          }),
          ObjetTri_1.ObjetTri.init('Libelle'),
          ObjetTri_1.ObjetTri.init('Numero'),
        ]).trier();
        aContenuCours.listeExecutionQCM =
          new ObjetListeElements_1.ObjetListeElements();
        if (!!aContenuCours.training) {
          const lDeserialiser = new ObjetDeserialiser();
          aContenuCours.listeExecutionQCM =
            new ObjetListeElements_1.ObjetListeElements().fromJSON(
              aContenuCours.training.ListeExecutionsQCM,
              lDeserialiser._ajouterQCM.bind(lDeserialiser),
            );
        }
      }
      deserialiserCahierDeTexte(aCahierDeTexte) {
        const lThis = this;
        if (!aCahierDeTexte.listeContenus) {
          aCahierDeTexte.listeContenus =
            new ObjetListeElements_1.ObjetListeElements();
        }
        aCahierDeTexte.listeContenus.parcourir((aContenu) => {
          lThis.deserialiserContenuDeCours(aContenu);
        });
        aCahierDeTexte.listeContenus.aUnElementVide =
          ObjetDeserialiser._aUnElementVide;
        aCahierDeTexte.listeContenus.verifierAvantValidation =
          ObjetDeserialiser._verifierAvantValidation;
        if (!!aCahierDeTexte.Matiere) {
          aCahierDeTexte.Matiere.CouleurFond = aCahierDeTexte.CouleurFond;
        }
        if (!aCahierDeTexte.ListeTravailAFaire) {
          aCahierDeTexte.ListeTravailAFaire =
            new ObjetListeElements_1.ObjetListeElements();
        }
        aCahierDeTexte.ListeTravailAFaire.parcourir((aTaf) => {
          lThis.deserialiserTAF(aTaf);
        });
        aCahierDeTexte.ListeTravailAFaire.setTri([
          ObjetTri_1.ObjetTri.init('DonneLe'),
          ObjetTri_1.ObjetTri.init('Genre'),
        ]);
        aCahierDeTexte.ListeTravailAFaire.trier();
        aCahierDeTexte.ListeTravailAFaire.aUnElementVide =
          ObjetDeserialiser._aUnElementVide;
        aCahierDeTexte.ListeTravailAFaire.verifierAvantValidation =
          ObjetDeserialiser._verifierAvantValidation;
      }
      static _aUnElementVide() {
        let lResult = false;
        for (let I = 0; I < this.count() && !lResult; I++) {
          if (this.existe(I) && this.get(I).estVide) {
            lResult = true;
          }
        }
        return lResult;
      }
      static _verifierAvantValidation() {
        for (let I = 0; I < this.count(); I++) {
          if (this.existe(I) && this.get(I).estVide) {
            if (!this.get(I).executionQCM) {
              this.get(I).setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
            }
          }
        }
      }
      _enrichirEvenementVS(aListe, aElement) {
        new ObjetDeserialiser()._formaterEvenementVS({
          element: aElement,
          pourAccueil: this.pourAccueil,
          liste: aListe,
        });
      }
      _ajouterEvenement(aJSON, aElement) {
        aElement.DateDebut = aJSON.DateDebut;
        if (!aJSON.DateDebut) {
          aElement.DateDebut = GParametres.PremiereDate;
        }
        aElement.DateFin = aJSON.DateFin;
        aElement.sansHoraire = aJSON.sansHoraire;
        aElement.Commentaire = aJSON.Commentaire;
        aElement.CouleurCellule = aJSON.CouleurCellule;
        aElement.estConseilClasse = aJSON.estConseilClasse;
        aElement.famille = aJSON.famille;
        aElement.strAuteur = aJSON.strAuteur;
        aElement.listeFichiers = aJSON.listeFichiers;
        aElement.estPeriodique = aJSON.estPeriodique;
        aElement.periodicite = aJSON.Periodicite;
        aElement.publie = !aJSON.nonPublie;
        aElement.proprietaire = aJSON.Proprietaire;
        aElement.listeEleves = aJSON.listeEleves;
        aElement.genresPublicEntite = aJSON.genresPublicEntite;
        aElement.avecElevesRattaches = aJSON.avecElevesRattaches;
        aElement.listePublicEntite = aJSON.listePublicEntite;
        aElement.listePublicIndividu = aJSON.listePublicIndividu;
        aElement.presidentCC = aJSON.presidentCC;
        aElement.listeProfsPrincipaux = aJSON.listeProfsPrincipaux;
        aElement.listeDeleguesParents = aJSON.listeDeleguesParents;
        aElement.listeDeleguesEleves = aJSON.listeDeleguesEleves;
        aElement.avecDirecteur = !!aJSON.avecDirecteur;
        aElement.publicationPageEtablissement =
          !!aJSON.publicationPageEtablissement;
        aElement.listeDocJoints =
          new ObjetListeElements_1.ObjetListeElements().fromJSON(
            aJSON.PiecesJointes,
            this._ajouterDocJoint,
          );
        aElement.navigation = aJSON.navigation;
        aElement.visio = aJSON.visio;
        aElement.eleveConvoque = aJSON.eleveConvoque;
      }
      _ajouterDocJoint(aJSON, aElement) {
        aElement.url = aJSON.url;
        aElement.Url = ObjetChaine_1.GChaine.creerUrlBruteLienExterne(aElement);
      }
      _composeListeDelegues(aTitre, aListe) {
        let lResult = '';
        lResult += aTitre + ' : ';
        const lArrayDelegues = [];
        for (let I = 0; I < aListe.count() && I < 2; I++) {
          const lElement = aListe.get(I);
          lArrayDelegues.push(lElement.getLibelle());
        }
        lResult += lArrayDelegues.join(', ');
        if (aListe.count() > 2) {
          lResult += ', ...';
        }
        return lResult;
      }
      _getLibelleEvenement(aParam) {
        const lTab = [],
          lParam = {
            evenement: null,
            avecTitre: false,
            avecDetailConseil: false,
            avecDateDuJour: true,
            formatDateDuJour:
              '[' +
              ObjetTraduction_1.GTraductions.getValeur('Le').ucfirst() +
              ' %J %MMMM' +
              ']',
          };
        $.extend(lParam, aParam);
        if (lParam.avecTitre) {
          lTab.push(lParam.evenement.getLibelle());
        }
        if (
          lParam.evenement &&
          lParam.evenement.DateDebut &&
          lParam.evenement.DateFin
        ) {
          const lChaine = ObjetDate_1.GDate.strDates(
            lParam.evenement.DateDebut,
            lParam.evenement.DateFin,
            { sansHoraire: lParam.evenement.sansHoraire },
          );
          lTab.push(lChaine.trim());
        }
        lTab.push(lParam.evenement.Commentaire);
        if (lParam.avecDetailConseil) {
          if (lParam.evenement.salle) {
            lTab.push(
              ObjetTraduction_1.GTraductions.getValeur('Agenda.Salle') +
                ' : ' +
                lParam.evenement.salle,
            );
          }
          if (
            lParam.evenement.president &&
            lParam.evenement.president.getLibelle()
          ) {
            lTab.push(
              ObjetTraduction_1.GTraductions.getValeur('Agenda.President') +
                ' : ' +
                lParam.evenement.president.getLibelle(),
            );
          }
          if (
            lParam.evenement.listeParentsDelegues &&
            lParam.evenement.listeParentsDelegues.count() > 0
          ) {
            lTab.push(
              this._composeListeDelegues(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Agenda.ParentsDelegues',
                ),
                lParam.evenement.listeParentsDelegues,
              ),
            );
          }
          if (
            lParam.evenement.listeElevesDelegues &&
            lParam.evenement.listeElevesDelegues.count() > 0
          ) {
            lTab.push(
              this._composeListeDelegues(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Agenda.ElevesDelegues',
                ),
                lParam.evenement.listeElevesDelegues,
              ),
            );
          }
        }
        return lTab;
      }
      _getDateEvenement(aParam) {
        const lParam = {
          evenement: null,
          avecDateDuJour: true,
          formatDateDuJour:
            '[' +
            ObjetTraduction_1.GTraductions.getValeur('Le') +
            ' %J %MMM' +
            ']',
        };
        $.extend(lParam, aParam);
        const lChaine =
          lParam.evenement &&
          lParam.evenement.DateDebut &&
          lParam.evenement.DateFin
            ? ObjetDate_1.GDate.strDates(
                lParam.evenement.DateDebut,
                lParam.evenement.DateFin,
                {
                  sansHoraire: lParam.evenement.sansHoraire,
                  formatDate: ' %J %MMM',
                },
              )
            : '';
        return lChaine.toLowerCase().ucfirst();
      }
    }
    exports.ObjetDeserialiser = ObjetDeserialiser;
  },
  fn: 'objetdeserialiser.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteMentionsLegales = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    class ObjetRequeteMentionsLegales extends ObjetRequeteJSON_1.ObjetRequeteConsultation {}
    exports.ObjetRequeteMentionsLegales = ObjetRequeteMentionsLegales;
    CollectionRequetes_1.Requetes.inscrire(
      'MentionsLegales',
      ObjetRequeteMentionsLegales,
    );
  },
  fn: 'objetrequetementionslegales.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_MentionsLegales = void 0;
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetHtml_1 = require('ObjetHtml');
    class ObjetFenetre_MentionsLegales extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.idContenu = this.getNom() + '_Contenu';
        this.setOptionsFenetre({
          largeur: 450,
          hauteur: 320,
          listeBoutons: [ObjetTraduction_1.GTraductions.getValeur('Fermer')],
        });
      }
      composerContenu(aParametres) {
        const H = [];
        H.push(
          IE.jsx.str(
            'p',
            { class: 'ie-titre-petit PetitEspaceBas' },
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.adresseEtablissement',
            ),
          ),
        );
        H.push(
          aParametres.adresseEtablissement &&
            IE.jsx.str('p', null, aParametres.adresseEtablissement),
        );
        H.push(
          IE.jsx.str(
            'p',
            { class: 'GrandEspaceHaut ie-titre-petit PetitEspaceBas' },
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.formeJuridique',
            ),
          ),
        );
        H.push(
          aParametres.formeJuridique &&
            IE.jsx.str('p', null, aParametres.formeJuridique),
        );
        H.push(
          IE.jsx.str(
            'p',
            { class: 'GrandEspaceHaut ie-titre-petit PetitEspaceBas' },
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.hebergeur',
            ),
          ),
        );
        H.push(
          aParametres.hebergeur && IE.jsx.str('p', null, aParametres.hebergeur),
        );
        H.push(
          IE.jsx.str(
            'p',
            { class: 'GrandEspaceHaut ie-titre-petit PetitEspaceBas' },
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.responsablePublication',
            ),
          ),
        );
        H.push(
          aParametres.responsablePublication &&
            IE.jsx.str('p', null, aParametres.responsablePublication),
        );
        if (!!aParametres.informationsComplementaires) {
          H.push(
            IE.jsx.str(
              'p',
              { class: 'GrandEspaceHaut ie-titre-petit PetitEspaceBas' },
              ObjetTraduction_1.GTraductions.getValeur(
                'FenetreMentionsLegales.informationsComplementaires',
              ),
            ),
          );
          H.push(aParametres.informationsComplementaires);
        }
        H.push(
          IE.jsx.str(
            'h2',
            { class: 'ie-titre m-top-xxl m-bottom-xl' },
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.utilisationCookie',
            ),
          ),
        );
        H.push(
          IE.jsx.str(
            'p',
            null,
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.informationCookie',
              [GApplication.nomProduit],
            ),
            ' ',
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.informationCookieSuite',
              [GApplication.nomProduit],
            ),
          ),
        );
        H.push(
          IE.jsx.str(
            'p',
            { class: 'm-y' },
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreMentionsLegales.utilisationCookieTitre',
            ),
          ),
        );
        H.push(
          IE.jsx.str(
            'ul',
            { class: 'dot m-left xl' },
            IE.jsx.str(
              'li',
              null,
              ObjetTraduction_1.GTraductions.getValeur(
                'FenetreMentionsLegales.utilisationCookieCASTGC',
              ),
            ),
            IE.jsx.str(
              'li',
              null,
              ObjetTraduction_1.GTraductions.getValeur(
                'FenetreMentionsLegales.utilisationCookieLang',
              ),
            ),
          ),
        );
        return H.join('');
      }
      setDonnees(aParam) {
        ObjetHtml_1.GHtml.setHtml(this.idContenu, this.composerContenu(aParam));
        this.afficher();
      }
      composeContenu() {
        return IE.jsx.str('div', { id: this.idContenu });
      }
      surValidation() {
        this.fermer();
      }
    }
    exports.ObjetFenetre_MentionsLegales = ObjetFenetre_MentionsLegales;
  },
  fn: 'objetfenetre_mentionslegales.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.IELocalStorage = void 0;
    let lLocalStorage = null;
    try {
      lLocalStorage =
        window.localStorage ||
        (window.globalStorage
          ? window.globalStorage[window.location.hostname]
          : null);
      if (lLocalStorage.setItem) {
        lLocalStorage.setItem('_bidon_', '1');
        lLocalStorage.removeItem('_bidon_');
      }
    } catch (e) {
      lLocalStorage = null;
    }
    exports.IELocalStorage = {
      actif: !!lLocalStorage,
      getItem(aCle) {
        if (lLocalStorage) {
          try {
            return lLocalStorage.getItem
              ? lLocalStorage.getItem(aCle)
              : lLocalStorage[aCle];
          } catch (e) {}
        }
        return null;
      },
      getItemJSON(aCle) {
        const lResult = this.getItem(aCle);
        let lJSON = null;
        try {
          lJSON = lResult ? JSON.parse(lResult) : null;
        } catch (e) {
          lJSON = null;
        }
        return lJSON;
      },
      setItem(aCle, aValeur) {
        if (lLocalStorage) {
          try {
            if (lLocalStorage.setItem) {
              lLocalStorage.setItem(aCle, aValeur);
            } else {
              lLocalStorage[aCle] = aValeur;
            }
          } catch (e) {}
        }
      },
      setItemJSON(aCle, aJSON) {
        let lChaineJSON = '';
        try {
          lChaineJSON = JSON.stringify(aJSON);
        } catch (e) {}
        this.setItem(aCle, lChaineJSON || '');
      },
      removeItem(aCle) {
        if (lLocalStorage) {
          try {
            if (lLocalStorage.removeItem) {
              lLocalStorage.removeItem(aCle);
            } else {
              lLocalStorage[aCle] = null;
            }
          } catch (e) {}
        }
      },
    };
  },
  fn: 'localstorage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFiche_DesktopMobile = void 0;
    const ObjetFenetre_1 = require('ObjetFenetre');
    class ObjetFiche_DesktopMobile extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.EnAffichage = false;
        this.idContenu = this.Nom + '_ContenuFiche';
        this.IdPremierElement = this.idContenu;
        this.setOptionsFenetre({
          estFicheMobile: true,
          modale: false,
          largeur: null,
          hauteur: null,
          avecAbonnementBlocage: true,
          avecAbonnementPremierPlan: true,
          htmlContenu: '',
          labelledBy: '',
        });
      }
      compose() {
        return IE.jsx.str(
          IE.jsx.fragment,
          null,
          IE.jsx.str(
            'div',
            { tabindex: '-1', id: this.idContenu },
            this.optionsFenetre.htmlContenu || this.composeContenu(),
          ),
        );
      }
      surPreAffichage() {}
      surAfficher() {
        if (this.surPreAffichage) {
          this.surPreAffichage();
        }
      }
      actualiser(...aParams) {
        return this.afficher();
      }
      afficher() {
        return super.afficher(this.compose());
      }
      afficherFiche(aParams) {
        return this.afficher();
      }
      fermer(aSurInteractionUtilisateur) {
        const lEstEnAffichage = this.EnAffichage;
        const lProm = super.fermer();
        if (lEstEnAffichage) {
          const LSurInteractionUtilisateur =
            aSurInteractionUtilisateur === null ||
            aSurInteractionUtilisateur === undefined
              ? true
              : aSurInteractionUtilisateur;
          if (LSurInteractionUtilisateur) {
            this.callback.appel();
          }
        }
        return lProm;
      }
    }
    exports.ObjetFiche_DesktopMobile = ObjetFiche_DesktopMobile;
  },
  fn: 'objetfiche_desktopmobile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFiche_Espace = void 0;
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_1 = require('ObjetStyle');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetWAI_1 = require('ObjetWAI');
    const tag_1 = require('tag');
    const ObjetFiche_DesktopMobile_1 = require('ObjetFiche_DesktopMobile');
    class ObjetFiche_Espace extends ObjetFiche_DesktopMobile_1.ObjetFiche_DesktopMobile {
      constructor(...aParams) {
        super(...aParams);
        this.EnAffichage = false;
        this.idContenuFenetre = this.IdContenu;
        this.idContenu = this.Nom + '_ContenuFiche';
        this.IdPremierElement = this.idContenu;
        this.idCorpsContenu = this.Nom + '_corpsContenu';
        this.idBandeau = this.Nom + '_Bandeau';
        this.avecBandeau = true;
        this.avecDeplacementSurBandeau = true;
        this.avecDeplacementSurFiche = false;
        this.avecBoutonFermer = true;
        this.setOptionsFenetre({
          modale: false,
          largeur: null,
          hauteur: null,
          avecAbonnementBlocage: true,
          avecAbonnementPremierPlan: true,
          avecTailleSelonContenu: true,
          positionnerFenetreSurAfficher: false,
          conserverCoordonnees: false,
          htmlContenu: '',
          labelledBy: '',
          bloquerFocus: false,
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          eventBoutonFermer: function (event) {
            switch (event.type) {
              case 'keyup':
                if (GNavigateur.isToucheSelection()) {
                  aInstance.fermer();
                }
                break;
              case 'click':
                aInstance.fermer();
                break;
            }
          },
        });
      }
      compose() {
        const H = [];
        H.push(
          '<span class="sr-only" tabindex="0" onfocus="',
          this.Nom,
          '.focusSurPremierElement();"></span>',
        );
        H.push(
          '<div tabindex="-1" id="',
          this.idContenu,
          '" class="ObjetFenetre_Espace ',
          this.optionsFenetre.cssFenetre || '',
          '"',
          ObjetWAI_1.GObjetWAI.composeRole(ObjetWAI_1.EGenreRole.Dialog),
          this.optionsFenetre.labelledBy
            ? ObjetWAI_1.GObjetWAI.composeAttribut({
                genre: ObjetWAI_1.EGenreAttribut.labelledby,
                valeur: this.optionsFenetre.labelledBy,
              })
            : '',
          '>',
        );
        H.push(
          '<div class="Fenetre_Cadre ombre-cadre" style="',
          ObjetStyle_1.GStyle.composeWidth(this.optionsFenetre.largeur),
          ObjetStyle_1.GStyle.composeCouleurFond(
            this.optionsFenetre.couleurFond,
          ),
          '">',
        );
        if (this.avecBandeau) {
          H.push(
            '<div id="',
            this.idBandeau,
            '" class="bandeau-header">',
            this.composeBandeau(this.avecBoutonFermer),
            '</div>',
          );
        } else if (this.avecBoutonFermer) {
          H.push(
            (0, tag_1.tag)(
              'div',
              { class: 'Fenetre_Titre sans-bandeau' },
              _construireBtnFermer(),
            ),
          );
        }
        H.push(
          (0, tag_1.tag)(
            'div',
            {
              id: this.idCorpsContenu,
              class:
                'ObjetFenetre_Edition content ' +
                (this.avecDeplacementSurFiche ? 'AvecMove' : ''),
              'ie-draggable': this.avecDeplacementSurFiche
                ? 'getDragFenetre'
                : '',
              style: 'height:100%;',
              tabindex: '0',
            },
            this.optionsFenetre.htmlContenu || this.composeContenu(),
          ),
        );
        H.push('</div>');
        H.push('</div>');
        H.push(
          '<span class="sr-only" tabindex="0" onfocus="',
          this.Nom,
          '.focusSurPremierElement();"></span>',
        );
        return H.join('');
      }
      composeBandeau(AAvecBoutonFermer) {
        const lHtml = [];
        this.avecBoutonFermer = AAvecBoutonFermer;
        lHtml.push('<div class="Fenetre_Titre">');
        lHtml.push(
          (0, tag_1.tag)('h1', {
            id: this.IdTitre,
            class: this.avecDeplacementSurBandeau ? 'AvecMove' : false,
            'ie-draggable': this.avecDeplacementSurBandeau
              ? 'getDragFenetre'
              : '',
            'ie-html': 'getTitre',
            tabindex: '0',
          }),
        );
        if (AAvecBoutonFermer) {
          lHtml.push(_construireBtnFermer());
        }
        lHtml.push('</div>');
        return lHtml.join('');
      }
      actualiser() {
        return this.afficher(this.idCours);
      }
      surAfficher() {
        if (this.surPreAffichage) {
          this.surPreAffichage();
        }
        this.positionnerFenetre(this._parametresAffichageFiche);
      }
      focusSurPremierElement() {
        if (ObjetHtml_1.GHtml.elementExiste(this.IdTitre)) {
          ObjetHtml_1.GHtml.setFocus(this.IdTitre);
        } else if (ObjetHtml_1.GHtml.elementExiste(this.idCorpsContenu)) {
          ObjetHtml_1.GHtml.setFocus(this.idCorpsContenu);
        } else {
        }
      }
      construireStructureAffichageAutre() {
        return (
          '<div ie-node="getNodeFenetre" id="' +
          this.idContenuFenetre +
          '"></div>'
        );
      }
      afficher(AIdCours, aLeft, aTop) {
        return this.afficherFiche({
          id: AIdCours,
          left: aLeft,
          top: aTop,
          positionSurSouris: true,
          positionSurSourisSiAffiche: false,
        });
      }
      afficherFiche(aParametres) {
        this._parametresAffichageFiche = $.extend(
          {
            enAffichage: this.EnAffichage,
            left: null,
            top: null,
            id: null,
            positionSurSouris: false,
            positionSurSourisSiAffiche: false,
            centrerParDefaut: false,
          },
          aParametres,
        );
        if (this.EnAffichage) {
          if (this.destructionSurFermeture === true) {
            this._parametresAffichageFiche.enAffichage = false;
            this.EnAffichage = false;
            ObjetHtml_1.GHtml.setHtml(this.idContenuFenetre, '');
          } else {
            this.fermer(false);
          }
        }
        this.idCours = this._parametresAffichageFiche.id;
        const lProm = super.afficher();
        if (!this.optionsFenetre.bloquerFocus) {
          ObjetHtml_1.GHtml.setFocus(this.IdPremierElement);
        }
        if (this.surAfficher) {
          this.surAfficher();
        }
        return lProm;
      }
      fermer(aSurInteractionUtilisateur) {
        const lProm = super.fermer(aSurInteractionUtilisateur);
        ObjetHtml_1.GHtml.setHtml(this.idContenuFenetre, '');
        return lProm;
      }
      surValidation() {
        this.fermer();
      }
    }
    exports.ObjetFiche_Espace = ObjetFiche_Espace;
    function _construireBtnFermer() {
      return IE.jsx.str(
        'div',
        { class: 'cta-conteneur' },
        IE.jsx.str('ie-btnimage', {
          class: 'btnImageIcon as-button icon_fermeture_widget',
          'ie-model': 'btnCroixFermeture',
          title: ObjetTraduction_1.GTraductions.getValeur('Fermer'),
        }),
      );
    }
  },
  fn: 'objetfiche_espace.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFiche = void 0;
    const ObjetFiche_DesktopMobile_1 = require('ObjetFiche_DesktopMobile');
    class ObjetFiche extends ObjetFiche_DesktopMobile_1.ObjetFiche_DesktopMobile {}
    exports.ObjetFiche = ObjetFiche;
    if (!IE.estMobile) {
      exports.ObjetFiche = ObjetFiche =
        require('ObjetFiche_Espace.js').ObjetFiche_Espace;
    } else {
      exports.ObjetFiche = ObjetFiche =
        require('ObjetFiche_DesktopMobile.js').ObjetFiche_DesktopMobile;
    }
  },
  fn: 'objetfiche.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteSaisieAccepterReglement = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    class ObjetRequeteSaisieAccepterReglement extends ObjetRequeteJSON_1.ObjetRequeteSaisie {}
    exports.ObjetRequeteSaisieAccepterReglement =
      ObjetRequeteSaisieAccepterReglement;
    CollectionRequetes_1.Requetes.inscrire(
      'SaisieAccepterReglement',
      ObjetRequeteSaisieAccepterReglement,
    );
  },
  fn: 'objetrequetesaisieaccepterreglement.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeFichierExterneHttpSco = void 0;
    var TypeFichierExterneHttpSco;
    (function (TypeFichierExterneHttpSco) {
      TypeFichierExterneHttpSco['Aucun'] = 'Aucun';
      TypeFichierExterneHttpSco['EvaluationSujet'] = 'EvaluationSujet';
      TypeFichierExterneHttpSco['EvaluationCorrige'] = 'EvaluationCorrige';
      TypeFichierExterneHttpSco['DevoirSujet'] = 'DevoirSujet';
      TypeFichierExterneHttpSco['DevoirCorrige'] = 'DevoirCorrige';
      TypeFichierExterneHttpSco['TAFRenduEleve'] = 'TAFRenduEleve';
      TypeFichierExterneHttpSco['TAFCorrigeRenduEleve'] =
        'TAFCorrigeRenduEleve';
      TypeFichierExterneHttpSco['EtablissementReglement'] =
        'EtablissementReglement';
      TypeFichierExterneHttpSco['EtablissementCharte'] = 'EtablissementCharte';
      TypeFichierExterneHttpSco['DocJointInscription'] = 'DocJointInscription';
    })(
      TypeFichierExterneHttpSco ||
        (exports.TypeFichierExterneHttpSco = TypeFichierExterneHttpSco = {}),
    );
  },
  fn: 'typefichierexternehttpsco.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GImage = void 0;
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_1 = require('ObjetStyle');
    const UtilitaireCss_1 = require('UtilitaireCss');
    const GImage = {
      compose(aClass, aLargeur) {
        return (
          '<div' +
          (aClass ? ' class="' + aClass + '"' : '') +
          ' style="margin-left:auto; margin-right:auto; width:' +
          (aLargeur ? aLargeur + 'px' : '100%;') +
          '">&nbsp;</div>'
        );
      },
      composeImage(aClass, aLargeur, aPourImpression = false) {
        if (!aClass) {
          IE.log.addLog('ObjetImage.composeImage : aClass non definie');
          return '';
        }
        if (aPourImpression) {
          const lRegleCss = '.' + aClass;
          const lUrl =
            UtilitaireCss_1.UtilitaireCss.extraireUrlReglesCss(lRegleCss);
          if (!lUrl) {
            IE.log.addLog(
              'ObjetImage.composeImage : lUrl non trouvé dans la regle Css : ' +
                aClass,
            );
            return '';
          }
          let lPosition =
            UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss(
              lRegleCss,
              'position',
            );
          const lHeight =
            UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss(
              lRegleCss,
              'height',
            );
          if (!lPosition) {
            lPosition = 'relative';
          }
          let lLargeur = aLargeur;
          if (!lLargeur) {
            lLargeur = parseInt(
              UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss(
                lRegleCss,
                'width',
              ),
            );
          }
          let lLeft,
            lTop = '0';
          const lBackGroundPosition =
            UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss(
              lRegleCss,
              'backgroundPosition',
            );
          if (lBackGroundPosition) {
            const lTab = lBackGroundPosition.split(' ');
            if (lTab.length === 2) {
              lLeft = lTab[0];
              lTop = lTab[1];
            }
          } else {
            lLeft = UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss(
              lRegleCss,
              'left',
            );
            lTop = UtilitaireCss_1.UtilitaireCss.chercherAttributReglesCss(
              lRegleCss,
              'top',
            );
          }
          let lStyle = '';
          if (lPosition) {
            lStyle += 'position:' + lPosition + ';';
          }
          if (lHeight) {
            lStyle += 'height:' + lHeight + ';';
          }
          if (lLeft) {
            lStyle += 'left:' + lLeft + ';';
          }
          if (lTop) {
            lStyle += 'top:' + lTop + ';';
          }
          return (
            '<div style="' +
            ObjetStyle_1.GStyle.composeWidth(lLargeur) +
            'margin-left:auto; margin-right:auto; overflow: hidden">' +
            '<img src="' +
            lUrl +
            '" style="' +
            lStyle +
            '" /></div>'
          );
        } else {
          return (
            '<div class="' +
            aClass +
            '" style="' +
            (aLargeur ? ObjetStyle_1.GStyle.composeWidth(aLargeur) : '') +
            'margin-left:auto; margin-right:auto;">&nbsp;</div>'
          );
        }
      },
      setImage(aId, aClass) {
        ObjetHtml_1.GHtml.setHtml(aId, this.compose(aClass));
      },
    };
    exports.GImage = GImage;
  },
  fn: 'objetimage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetMenuContextuel = void 0;
    require('ObjetMenuContextuel.css');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetStyle_1 = require('ObjetStyle');
    const Enumere_Direction_1 = require('Enumere_Direction');
    const Enumere_Event_1 = require('Enumere_Event');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetImage_1 = require('ObjetImage');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const GestionnaireModale_1 = require('GestionnaireModale');
    const ObjetChaine_1 = require('ObjetChaine');
    const ToucheClavier_1 = require('ToucheClavier');
    const Enumere_MenuCtxModeMixte_1 = require('Enumere_MenuCtxModeMixte');
    const tag_1 = require('tag');
    const EGenreLigneMenu = {
      Separateur: 0,
      Commande: 1,
      Deploiement: 2,
      Titre: 3,
    };
    const c_delaiFermetureSousMenu = 300;
    const c_delaiOuvertureSousMenu = 200;
    class ObjetMenuContextuel extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.ListeLignes = new ObjetListeElements_1.ObjetListeElements();
        this._callbacksAfficherLignes = [];
        this.IdNomMenuContextuel = this.Nom + '_MenuContextuel';
        this.IdPremierElement = this.IdNomMenuContextuel;
        this.IdPrecedent = '';
        this.ajouterEvenementGlobal(
          Enumere_Event_1.EEvent.SurPreResize,
          this.fermer,
        );
        this.options = {
          largeurMin: null,
          largeurMaxLibelle: 400,
          largeurColonneGauche: 25,
          couleurFond: GCouleur.blanc,
          couleurBordureDroiteImage: GCouleur.bordure,
          heightLigne: 16,
          preventScrollSurRestaurationFocus: false,
          estModeMixte: false,
        };
      }
      static afficher(aParametres) {
        const lParametres = Object.assign(
          {
            pere: null,
            evenement: null,
            initCommandes: null,
            affichageSurInitCommandes: false,
            id: null,
            options: null,
          },
          aParametres,
        );
        if (!lParametres.pere) {
          return null;
        }
        if (!lParametres.initCommandes) {
          return null;
        }
        const lInstance = ObjetIdentite_1.Identite.creerInstance(
          ObjetMenuContextuel,
          { pere: lParametres.pere, evenement: lParametres.evenement },
        );
        lInstance.destructionSurFermeture = true;
        lInstance.setOptions(lParametres.options);
        IEZoneFenetre_1.ZoneFenetre.ajouterFenetre(lInstance.getNom());
        $('#' + lInstance.getNom().escapeJQ()).on('destroyed', () => {
          lInstance.free();
        });
        lParametres.initCommandes.call(lParametres.pere, lInstance);
        if (!lInstance.contientAuMoinsUneLigne()) {
          return;
        }
        lInstance.surKeyUp = lParametres.surKeyUp;
        lInstance.surKeyPress = lParametres.surKeyPress;
        if (!lParametres.affichageSurInitCommandes) {
          lInstance.setDonnees(lParametres.id);
        }
        return lInstance;
      }
      add(aLibelle, aActif, aCallback, aExtend) {
        const lElement = this.addCommande(0, aLibelle, aActif);
        lElement.setCallback(aCallback);
        if (aExtend) {
          $.extend(lElement, aExtend);
        }
        return this;
      }
      addTitre(aLibelle) {
        const lElement = new ObjetElement_1.ObjetElement(
          aLibelle,
          null,
          EGenreLigneMenu.Titre,
        );
        this._addElement(lElement);
        return lElement;
      }
      addSousMenu(aLibelle, aInitialisationSousMenu, aParametres) {
        const lElement = new ObjetElement_1.ObjetElement(
          aLibelle,
          null,
          EGenreLigneMenu.Deploiement,
        );
        lElement._initSousMenu = aInitialisationSousMenu;
        lElement.parametresSousMenu = $.extend(
          { callback: null, options: null },
          aParametres,
        );
        this._addElement(lElement);
        return lElement;
      }
      addCommande(ANumeroCommande, ALibelle, AActif, aData, aCallbackAfficher) {
        const LElement = new ObjetElement_1.ObjetElement(
          ALibelle,
          ANumeroCommande,
          EGenreLigneMenu.Commande,
        );
        LElement.actif =
          AActif !== null && AActif !== undefined ? AActif : true;
        LElement.data = aData;
        LElement.callbackAfficher = aCallbackAfficher;
        LElement.callbackValidation = null;
        LElement.setCallback = function (aCallback) {
          this.callbackValidation = aCallback;
          return this;
        };
        this._addElement(LElement);
        return LElement;
      }
      addSelecFile(aLibelle, aExtend, aActif) {
        if (!aExtend || !aExtend.getOptionsSelecFile || !aExtend.addFiles) {
        }
        return this.add(
          aLibelle,
          aActif !== false,
          null,
          $.extend({ estSelecFile: true }, aExtend),
        );
      }
      addSeparateur() {
        delete this._prochaineCommandeAvecSeparateur;
        if (this.ListeLignes.count() > 0) {
          this.ListeLignes.addElement(
            new ObjetElement_1.ObjetElement('', -1, EGenreLigneMenu.Separateur),
          );
        }
      }
      getListeLignes() {
        return this.ListeLignes;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          menuEventOut() {
            const lNodesExclus = [];
            let lCpt = 0;
            let lSousMenu = aInstance._instanceSousMenu;
            while (lSousMenu && lCpt < 20) {
              lNodesExclus.push(ObjetHtml_1.GHtml.getElement(lSousMenu.Nom));
              lSousMenu = lSousMenu._instanceSousMenu;
              lCpt += 1;
            }
            lCpt = 0;
            let lPereMenu = aInstance._pereMenu;
            while (lPereMenu && lCpt < 20) {
              lNodesExclus.push(ObjetHtml_1.GHtml.getElement(lPereMenu.Nom));
              lPereMenu = lPereMenu._pereMenu;
              lCpt += 1;
            }
            return {
              nodesExclus: lNodesExclus,
              callback: function () {
                aInstance.fermer();
              },
            };
          },
          nodeMenuContextuel() {
            $(this.node).on({
              mouseout: function () {
                if (aInstance.ligne) {
                  aInstance.selectionnerLigne(false, aInstance.ligne);
                }
              },
              keydown: function (aEvent) {
                if (aEvent.which === ToucheClavier_1.ToucheClavier.Tab) {
                  aEvent.preventDefault();
                }
              },
              keypress: function (aEvent) {
                if (
                  aInstance.surKeyPress &&
                  aInstance.surKeyPress(aEvent) === true
                ) {
                  aInstance.fermer(true);
                }
              },
              keyup: function (aEvent) {
                const lEstToucheFleche =
                  ToucheClavier_1.ToucheClavierUtil.estToucheFleche(
                    aEvent.which,
                  );
                const lEstToucheEchap =
                  aEvent.which === ToucheClavier_1.ToucheClavier.Echap;
                if (lEstToucheFleche || lEstToucheEchap) {
                  if (
                    aInstance.estSousMenu &&
                    aInstance._pereMenu &&
                    (lEstToucheEchap ||
                      aEvent.which ===
                        ToucheClavier_1.ToucheClavier.FlecheGauche)
                  ) {
                    aInstance._pereMenu._stopperTimeoutsSousMenus();
                    aInstance.fermer();
                    delete aInstance._pereMenu._instanceSousMenu;
                  } else {
                    if (lEstToucheEchap) {
                      aInstance.fermer(true);
                      aInstance.callback.appel();
                    }
                    if (lEstToucheFleche) {
                      aInstance.navigationClavier(this.id);
                    }
                  }
                  GNavigateur.stopperEvenement(aEvent.originalEvent);
                } else if (aInstance.surKeyUp) {
                  if (aInstance.surKeyUp(aEvent) === true) {
                    aInstance.fermer(true);
                  }
                }
              },
            });
          },
          getNodeWAI() {
            $(this.node).on('focus', () => {
              aInstance.focusSurPremierElement();
            });
          },
          getNodeLigne(aPositionLigne, aActif) {
            const lElement = aInstance.ListeLignes.get(aPositionLigne);
            const lMap = {
              mousedown: function (aEvent) {
                if (lElement.getGenre() === EGenreLigneMenu.Deploiement) {
                  aEvent.stopPropagation();
                  return false;
                }
              },
              pointerdown(aEvent) {
                if (aEvent.pointerType === 'touch') {
                  aInstance.surSelection(this.id, aActif, aPositionLigne);
                }
                if (aInstance._avecSousMenu(lElement)) {
                  aInstance.surSelection(this.id, aActif, aPositionLigne);
                  aInstance._ouvertureSousMenu(lElement, false);
                  aEvent.stopPropagation();
                  return false;
                }
              },
              mouseenter: function () {
                aInstance._ouvertureSousMenu(lElement, true);
              },
              mouseover: function () {
                if (aInstance.estSousMenu) {
                  if (aInstance._timeoutFermetureSousMenu) {
                    clearTimeout(aInstance._timeoutFermetureSousMenu);
                  }
                  aInstance._timeoutFermetureSousMenu = null;
                }
              },
              mouseleave: function () {
                aInstance._stopperTimeoutsSousMenus();
                if (aInstance._instanceSousMenu) {
                  aInstance._instanceSousMenu._timeoutFermetureSousMenu =
                    setTimeout(() => {
                      aInstance._instanceSousMenu.fermer();
                      delete aInstance._instanceSousMenu;
                    }, c_delaiFermetureSousMenu);
                }
                if (aInstance.estSousMenu) {
                  aInstance._timeoutFermetureSousMenu = setTimeout(() => {
                    let lRacineSousMenu = aInstance;
                    let i = 0;
                    while (
                      lRacineSousMenu._pereMenu &&
                      lRacineSousMenu._pereMenu.estSousMenu &&
                      i < 100
                    ) {
                      lRacineSousMenu = lRacineSousMenu._pereMenu;
                      i++;
                    }
                    lRacineSousMenu.fermer();
                  }, c_delaiFermetureSousMenu);
                }
              },
            };
            $.extend(lMap, {
              click: function () {
                if (
                  aActif &&
                  lElement.getGenre() !== EGenreLigneMenu.Deploiement
                ) {
                  if (lElement.surValidationElement) {
                    lElement.surValidationElement();
                  } else {
                    aInstance.surValidation(aPositionLigne);
                  }
                }
              },
              keyup: function (aEvent) {
                const lPourSousMenu =
                  aInstance._avecSousMenu(lElement) &&
                  !aInstance._instanceSousMenu;
                if (
                  ToucheClavier_1.ToucheClavierUtil.estEventRetourChariot(
                    aEvent,
                  ) ||
                  ToucheClavier_1.ToucheClavierUtil.estEventEspace(aEvent)
                ) {
                  if (lPourSousMenu) {
                    aInstance._ouvertureSousMenu(lElement, false);
                  } else if (aActif) {
                    if (lElement.surValidationElement) {
                      lElement.surValidationElement();
                    } else {
                      aInstance.surValidation(aPositionLigne);
                    }
                  }
                } else if (
                  aEvent.which === ToucheClavier_1.ToucheClavier.FlecheDroite
                ) {
                  if (lPourSousMenu) {
                    aInstance._ouvertureSousMenu(lElement, false);
                  }
                } else if (
                  aEvent.which === ToucheClavier_1.ToucheClavier.FlecheGauche
                ) {
                  aInstance._pereMenu._stopperTimeoutsSousMenus();
                  aInstance.fermer();
                  delete aInstance._pereMenu._instanceSousMenu;
                }
              },
            });
            $(this.node).on(lMap);
          },
          modelSelecFile: {
            getOptionsSelecFile(aPositionLigne, aActif, aGetSelecFile) {
              const lElement = aInstance.ListeLignes.get(aPositionLigne);
              if (lElement) {
                lElement.surValidationElement = aGetSelecFile();
                return Object.assign(
                  {
                    surOuvertureSelecteur: function () {
                      aInstance._stopperTimeoutsSousMenus();
                      setTimeout(() => {
                        aInstance._stopperTimeoutsSousMenus();
                      }, c_delaiFermetureSousMenu);
                    },
                  },
                  lElement.getOptionsSelecFile(),
                );
              }
            },
            addFiles(aPositionLigne, aActif, aParams) {
              const lElement = aInstance.ListeLignes.get(aPositionLigne);
              const lResult =
                lElement && aActif
                  ? lElement.addFiles(aParams, lElement, aPositionLigne)
                  : false;
              aInstance.surValidation(aPositionLigne);
              return lResult;
            },
            getDisabled(aPositionLigne, aActif) {
              return !aActif;
            },
          },
        });
      }
      free() {
        if (!this.isDestroyed()) {
          super.free();
          this.fermer();
        }
      }
      construireAffichage() {
        this._callbacksAfficherLignes = [];
        const lInfosMenu = {
          nbColonnesTexte: 1,
          nbColonnes: 1,
          avecDeploiement: false,
        };
        this.ListeLignes.parcourir((D) => {
          if (D.getGenre() !== EGenreLigneMenu.Separateur) {
            const lLibelle = D.getLibelle();
            if (Array.isArray(lLibelle)) {
              lInfosMenu.nbColonnesTexte = Math.max(
                lInfosMenu.nbColonnesTexte,
                lLibelle.length,
              );
            }
          }
          if (D.getGenre() === EGenreLigneMenu.Deploiement) {
            lInfosMenu.avecDeploiement = true;
          }
          if (this.options.estModeMixte === true) {
            if (
              D.getGenre() === EGenreLigneMenu.Commande &&
              D.typeAffEnModeMixte ===
                Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.bouton
            ) {
              D.afficher = null;
            }
          }
        });
        lInfosMenu.nbColonnes =
          lInfosMenu.nbColonnesTexte + (lInfosMenu.avecDeploiement ? 1 : 0);
        const H = [];
        H.push(
          '<div id="' + this.IdNomMenuContextuel + '" ',
          ' role="menu"',
          ' ie-node="nodeMenuContextuel"',
          ' ie-eventout="menuEventOut"',
          ' class="ObjetMenuContexutel" tabindex="-1">',
        );
        H.push('<ul role="presentation">');
        this.ListeLignes.parcourir((aLigne, aIndex) => {
          if (aLigne && aLigne.afficher !== null) {
            H.push(this._composeLigne(aLigne, aIndex, lInfosMenu));
          }
        });
        H.push('</ul>');
        H.push('</div>');
        return H.join('');
      }
      getIdCelluleTexteParCommande(aGenreCommande) {
        const lIndice = this.ListeLignes.getIndiceParNumeroEtGenre(
          aGenreCommande,
          EGenreLigneMenu.Commande,
        );
        return lIndice >= 0 ? this._getIdCelluleTexte(lIndice) : false;
      }
      recupererDonnees() {
        ObjetStyle_1.GStyle.setDisplay(this.Nom, false);
      }
      setParametres(aMinLargeur, aAfficherAbbreviation) {
        this.setOptions({
          largeurMin: aMinLargeur,
          largeurColonneGauche: aAfficherAbbreviation ? 30 : undefined,
        });
      }
      setDonnees(aID, aListeElements, aGenre, aAfficher) {
        if (aAfficher !== false) {
          this.afficher(aID);
        }
      }
      contientAuMoinsUneLigne() {
        return !!this.ListeLignes && this.ListeLignes.count() > 0;
      }
      vider() {
        this.ListeLignes = new ObjetListeElements_1.ObjetListeElements();
        delete this._prochaineCommandeAvecSeparateur;
        if (this.EstAffiche) {
          this.fermer();
        }
      }
      avecSeparateurSurSuivant(aAnnuler) {
        if (aAnnuler === true) {
          delete this._prochaineCommandeAvecSeparateur;
        } else {
          this._prochaineCommandeAvecSeparateur = true;
        }
        return this;
      }
      activerCommande(ANumeroCommande, AActiver) {
        const LElement = this.ListeLignes.getElementParNumeroEtGenre(
          ANumeroCommande,
          EGenreLigneMenu.Commande,
        );
        if (LElement) {
          LElement.actif = AActiver;
          ObjetHtml_1.GHtml.setHtml(this.Nom, this.construireAffichage(), {
            controleur: this.controleur,
          });
        }
      }
      setLibelleCommande(ANumeroCommande, ALibelle) {
        const LElement = this.ListeLignes.getElementParNumeroEtGenre(
          ANumeroCommande,
          EGenreLigneMenu.Commande,
        );
        if (LElement) {
          LElement.Libelle = ALibelle;
          ObjetHtml_1.GHtml.setHtml(this.Nom, this.construireAffichage(), {
            controleur: this.controleur,
          });
        }
      }
      afficher(AId, aEstUnSousMenu) {
        if (!this.EstAffiche) {
          this.ligne = null;
          if (!this.contientAuMoinsUneLigne()) {
            IE.log.addLog('Afficher : aucun élément à afficher');
            return;
          }
          ObjetHtml_1.GHtml.setHtml(this.Nom, this.construireAffichage(), {
            controleur: this.controleur,
          });
          ObjetStyle_1.GStyle.setDisplay(this.Nom, true);
          if (AId) {
            if (typeof AId === 'string' || ObjetHtml_1.GHtml.estElement(AId)) {
              if (aEstUnSousMenu) {
                ObjetPosition_1.GPosition.placerFiche(this.Nom, AId, null, {
                  x: 0,
                  y: 0,
                });
              } else {
                ObjetPosition_1.GPosition.placerFiche(this.Nom, AId);
              }
            } else if (
              MethodesObjet_1.MethodesObjet.isNumber(AId.x) &&
              MethodesObjet_1.MethodesObjet.isNumber(AId.y)
            ) {
              ObjetPosition_1.GPosition.placer(this.Nom, AId.x, AId.y);
            }
          } else {
            ObjetPosition_1.GPosition.placer(
              this.Nom,
              GNavigateur.pointerX + 5,
              GNavigateur.pointerY + 5,
            );
          }
          this.EstAffiche = true;
          GestionnaireModale_1.GestionnaireModale.abonnementPremierPlan(
            true,
            this.Nom,
          );
          GestionnaireModale_1.GestionnaireModale.enPremierPlan(this.Nom);
          GestionnaireModale_1.GestionnaireModale.abonnementBlocageInterface(
            true,
            this.Nom,
          );
          this._focusPrecedent = document.activeElement;
          this.focusSurPremierElement();
          if (this._callbacksAfficherLignes) {
            this._callbacksAfficherLignes.forEach((aCallback) => {
              if (aCallback) {
                aCallback();
              }
            });
          }
        }
      }
      fermer(aToutFermer) {
        if (this.EstAffiche) {
          this.EstAffiche = false;
          this._stopperTimeoutsSousMenus();
          if (this._instanceSousMenu) {
            this._instanceSousMenu.fermer();
            delete this._instanceSousMenu;
          }
          try {
            if (
              this._focusPrecedent &&
              this._focusPrecedent.focus &&
              $(this._focusPrecedent).length === 1
            ) {
              this._focusPrecedent.focus({
                preventScroll: this.options.preventScrollSurRestaurationFocus,
              });
              this._focusPrecedent = null;
            }
          } catch (e) {}
          ObjetStyle_1.GStyle.setDisplay(this.Nom, false);
          this.effacer();
          this.resetTableauxNavigation();
          this.IdPrecedent = '';
          GestionnaireModale_1.GestionnaireModale.abonnementPremierPlan(
            false,
            this.Nom,
          );
          GestionnaireModale_1.GestionnaireModale.abonnementBlocageInterface(
            false,
            this.Nom,
          );
          if (this.destructionSurFermeture) {
            this.free();
          }
          if (aToutFermer && this._pereMenu) {
            this._pereMenu.fermer(true);
          }
        }
      }
      surSelection(aId, aActif, aPositionLigne) {
        if (this.ligne) {
          this.selectionnerLigne(false, this.ligne);
        }
        this.ligne = this.ListeLignes.get(aPositionLigne);
        this.ligne.id = aId;
        this.ligne.actif = aActif;
        this.selectionnerLigne(true, this.ligne);
      }
      selectionnerLigne(aSelectionner, aLigne) {
        if (!aLigne) {
          return;
        }
        ObjetHtml_1.GHtml.modifierClass(
          aLigne.id,
          aSelectionner ? 'no-focus' : 'on-focus',
          aSelectionner ? 'on-focus' : 'no-focus',
        );
      }
      selectionnerLigneParPosition(aId, aSelectionner, aPosition) {
        const lLigne = this.ListeLignes.get(aPosition);
        lLigne.id = aId;
        lLigne.actif = true;
        this.selectionnerLigne(aSelectionner, lLigne);
      }
      getZIndex() {
        return 1200;
      }
      surValidation(aPositionLigne) {
        this.ligne = this.ListeLignes.get(aPositionLigne);
        this.ligne.id = this._getIdCelluleTexte(aPositionLigne);
        if (this.ligne.getGenre() !== EGenreLigneMenu.Deploiement) {
          this.fermer(true);
          if (
            this.ligne &&
            MethodesObjet_1.MethodesObjet.isFunction(
              this.ligne.callbackValidation,
            )
          ) {
            this.ligne.callbackValidation.call(this.Pere || this, this.ligne);
          } else {
            this.callback.appel(this.ligne);
          }
        }
      }
      estObjetGraphiqueFenetre() {
        return true;
      }
      _ouvertureSousMenu(aElement, aAvecDelai) {
        if (aElement && this._instanceSousMenu) {
          clearTimeout(this._instanceSousMenu._timeoutFermetureSousMenu);
          this._instanceSousMenu.fermer();
          delete this._instanceSousMenu;
        }
        this._stopperTimeoutsSousMenus();
        if (this._avecSousMenu(aElement)) {
          this._timeoutOuvertureSousMenu = setTimeout(
            () => {
              this._afficherSousMenu(aElement);
            },
            aAvecDelai ? c_delaiOuvertureSousMenu : 0,
          );
        }
      }
      _stopperTimeoutsSousMenus() {
        if (this._timeoutFermetureSousMenu) {
          clearTimeout(this._timeoutFermetureSousMenu);
        }
        if (this._timeoutOuvertureSousMenu) {
          clearTimeout(this._timeoutOuvertureSousMenu);
        }
        this._timeoutFermetureSousMenu = null;
        this._timeoutOuvertureSousMenu = null;
        if (this._pereMenu) {
          this._pereMenu._stopperTimeoutsSousMenus();
        }
      }
      _avecSousMenu(aElement) {
        return (
          aElement &&
          aElement.getGenre() === EGenreLigneMenu.Deploiement &&
          !!aElement._initSousMenu
        );
      }
      _afficherSousMenu(aElementSousMenu) {
        const lThis = this;
        this._instanceSousMenu = ObjetMenuContextuel.afficher({
          pere: this,
          evenement: function (aLigne) {
            if (
              MethodesObjet_1.MethodesObjet.isFunction(
                aElementSousMenu.parametresSousMenu.callback,
              )
            ) {
              aElementSousMenu.parametresSousMenu.callback.call(
                this.Pere || this,
                aLigne,
              );
            } else {
              lThis.callback.appel(aLigne);
            }
          },
          initCommandes: aElementSousMenu._initSousMenu,
          affichageSurInitCommandes: true,
          options: aElementSousMenu.parametresSousMenu.options || this.options,
          surKeyUp: this.surKeyUp,
          surKeyPress: this.surKeyPress,
        });
        if (this._instanceSousMenu) {
          this._instanceSousMenu._pereMenu = this;
          this._instanceSousMenu.estSousMenu = true;
          this._instanceSousMenu.afficher(aElementSousMenu.id, true);
        }
      }
      _composeLigne(aLigne, aPositionLigne, aInfosMenu) {
        switch (aLigne.getGenre()) {
          case EGenreLigneMenu.Separateur:
            return this._composeSeparateur();
          case EGenreLigneMenu.Commande:
          case EGenreLigneMenu.Deploiement:
            return this._composeTexte(aLigne, aPositionLigne, aInfosMenu);
          case EGenreLigneMenu.Titre:
            return this._composeTitre(aLigne);
        }
      }
      _getIdCelluleTexte(aPositionLigne) {
        return this.Nom + '_' + aPositionLigne;
      }
      _composeTitre(aLigne) {
        const H = [];
        H.push(
          '<li class="titre" role="presentation">',
          '<h5>',
          aLigne.getLibelle(),
          '</h5>',
          '</li>',
        );
        return H.join('');
      }
      _composeSeparateur() {
        const H = [];
        H.push('<li class="separateur" role="separator"></li>');
        return H.join('');
      }
      _composeTexte(aLigne, aPositionLigne, aInfosMenu) {
        const H = [];
        const lId = this._getIdCelluleTexte(aPositionLigne);
        const lEstDeploiement =
          aLigne.getGenre() === EGenreLigneMenu.Deploiement;
        const lLibelles = Array.isArray(aLigne.getLibelle())
          ? aLigne.getLibelle()
          : [aLigne.getLibelle()];
        const lNbColonnes = Math.max(
          lLibelles.length,
          aInfosMenu.nbColonnesTexte,
        );
        let lNumeroColonne;
        let lInfoLibelle;
        let lActif = aLigne.actif;
        if (lActif === null || lActif === undefined) {
          lActif = true;
        }
        lActif = !!lActif;
        if (aLigne.callbackAfficher) {
          this._callbacksAfficherLignes.push(() => {
            aLigne.callbackAfficher.call(
              this.Pere || this,
              lId,
              lActif,
              aLigne,
            );
          });
        }
        const lOnKeyNav =
          this.Nom +
          '.navigationClavier (id); if (GNavigateur.isToucheFleche ()) GNavigateur.stopperEvenement (event);';
        const lOnFocus =
          lActif === true
            ? this.Nom +
              ".selectionnerLigneParPosition ('" +
              lId +
              "', true , " +
              aPositionLigne +
              ')'
            : '';
        const lOnBlur =
          lActif === true
            ? this.Nom +
              ".selectionnerLigneParPosition ('" +
              lId +
              "', false , " +
              aPositionLigne +
              ')'
            : '';
        H.push(
          '<li id="' + lId + '" ',
          ObjetHtml_1.GHtml.composeAttr('ie-node', 'getNodeLigne', [
            aPositionLigne,
            lActif,
          ]),
          ` role="menuitem" tabindex="-1" onkeyup="${lOnKeyNav}" onfocus="${lOnFocus}" onblur="${lOnBlur}"`,
          lActif === true ? '' : ' aria-disabled="true"',
          aInfosMenu.avecDeploiement && lEstDeploiement
            ? ' aria-haspopup="true"'
            : '',
          ' class="',
          lActif && !aLigne.visuInactif ? 'active-color' : ' inactive-color',
          '" ',
          aLigne.title
            ? ' title="' + ObjetChaine_1.GChaine.toTitle(aLigne.title) + '"'
            : '',
          aLigne.estSelecFile && lActif
            ? ObjetHtml_1.GHtml.composeAttr('ie-model', 'modelSelecFile', [
                aPositionLigne,
                lActif,
              ]) + ' ie-selecfile '
            : '',
          ' onmousemove="' +
            this.Nom +
            '.surSelection (id, ' +
            lActif +
            ', ' +
            aPositionLigne +
            ')">',
        );
        H.push(
          aLigne.imageFormate
            ? '<div class="img-contain" aria-hidden="true">' +
                (aLigne.image ? aLigne.image : '') +
                '</div>'
            : '<div class="mc-icon-contain" aria-hidden="true">' +
                (aLigne.icon
                  ? '<i class="' + aLigne.icon + '"></i>'
                  : '' +
                    (aLigne.image
                      ? ObjetImage_1.GImage.compose(
                          aLigne.image,
                          aLigne.largeurImage ? aLigne.largeurImage : 16,
                        )
                      : '')) +
                '</div>',
        );
        for (
          lNumeroColonne = 0;
          lNumeroColonne < lNbColonnes;
          lNumeroColonne++
        ) {
          lInfoLibelle = [];
          if (lNumeroColonne < lLibelles.length) {
            lInfoLibelle = [
              '<div style="',
              (this.options.largeurMaxLibelle
                ? 'max-width: ' + this.options.largeurMaxLibelle + 'px;'
                : '') +
                '" class="libelle" ' +
                (this.options.largeurMaxLibelle && !IE.estMobile
                  ? ' ie-ellipsis'
                  : '') +
                '>' +
                lLibelles[lNumeroColonne] +
                '</div>',
            ];
          }
          H.push('<div class="libelle-contain">');
          if (lNumeroColonne === 0) {
            H.push(
              (0, tag_1.tag)(
                'div',
                { id: lId + '_', class: 'libelle' },
                lInfoLibelle.join(''),
              ),
            );
          } else {
            H.push(lInfoLibelle.join(''));
          }
          if (aInfosMenu.avecDeploiement) {
            H.push(
              lEstDeploiement
                ? '<i id="' +
                    lId +
                    '_flechedroite" class="btn-deploiement icon_fleche_num" aria-hidden="true"></i>'
                : '',
            );
          }
          H.push('</div>');
        }
        H.push('</li>');
        if (this.IdPrecedent === '') {
          this.ajouterAuTableaux(
            this.IdPremierElement,
            lId,
            null,
            Enumere_Direction_1.EGenreDirection.SensNormal,
          );
        } else {
          this.ajouterAuTableaux(
            this.IdPrecedent,
            lId,
            null,
            Enumere_Direction_1.EGenreDirection.DeuxSenses,
          );
        }
        this.IdPrecedent = lId;
        return H.join('');
      }
      _addElement(aElement) {
        if (this._prochaineCommandeAvecSeparateur) {
          this.addSeparateur();
        }
        this.ListeLignes.addElement(aElement);
      }
    }
    exports.ObjetMenuContextuel = ObjetMenuContextuel;
  },
  fn: 'objetmenucontextuel.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetModulePJ = void 0;
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    require('IEHtml.SelecFile.js');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const UtilitaireUrl_1 = require('UtilitaireUrl');
    const ToucheClavier_1 = require('ToucheClavier');
    const tag_1 = require('tag');
    const ObjetChaine_1 = require('ObjetChaine');
    class ObjetModulePJ extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.id_trombone = this.Nom + '_trombone';
        this.idOrigPJ = true;
        this.id_libellesPJ = this.Nom + '_libellesPJ';
        this.genreCommande = { menuContext: 0, click: 1 };
        this.setOptions({
          genrePJ: Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
          forcerEvenementSurClickIcon: false,
          IEModelChipsPJ: null,
          controleur: null,
          title: '',
          maxWidthLibelle: 0,
          addFiles: null,
          getDisabledFiles: null,
          libelleSelecteur: '',
          masquerListeChips: false,
          input: {},
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getNodeConteneur: function () {
            $(this.node).on('contextmenu', (event) => {
              event.stopImmediatePropagation();
              event.preventDefault();
              aInstance.callback.appel({
                action: aInstance.genreCommande.menuContext,
              });
              return false;
            });
          },
          getClassNodeConteneur() {
            return aInstance.Actif ? '' : 'is-disabled';
          },
          nodeTrombone: function () {
            if (
              aInstance.options.genrePJ ===
                Enumere_DocumentJoint_1.EGenreDocumentJoint.Url ||
              aInstance.options.forcerEvenementSurClickIcon
            ) {
              $(this.node).on('click keyup', (event) => {
                if (
                  event.type === 'keyup' &&
                  event.which !== ToucheClavier_1.ToucheClavier.RetourChariot &&
                  event.which !== ToucheClavier_1.ToucheClavier.Espace
                ) {
                  return;
                }
                event.stopImmediatePropagation();
                event.preventDefault();
                aInstance.callback.appel({
                  action: aInstance.genreCommande.click,
                  id: aInstance.getNomTrombone(),
                });
                return false;
              });
            }
          },
          getClassNodeTrombone: function () {
            return aInstance.options.libelleSelecteur && aInstance.Actif
              ? ' LienAccueil'
              : '';
          },
          trombone: {
            getOptionsSelecFile: function () {
              return aInstance.options.getOptionsSelecFile();
            },
            addFiles: function (aParams) {
              if (aInstance.options.addFiles) {
                aInstance.options.addFiles(aParams);
                this.controleur.$refreshSelf();
              }
            },
            getDisabled: function () {
              return (
                aInstance.options.genrePJ ===
                  Enumere_DocumentJoint_1.EGenreDocumentJoint.Url ||
                !aInstance.Actif ||
                !!(
                  aInstance.options.getDisabledFiles &&
                  aInstance.options.getDisabledFiles()
                )
              );
            },
          },
        });
      }
      setGenrePJ(aGenrePJ) {
        this.options.genrePJ = aGenrePJ;
      }
      getIdTrombone() {
        return this.id_trombone;
      }
      construireAffichage() {
        if (!this._avecDonnees) {
          return '';
        }
        const H = [];
        const lImage = IE.jsx.str('i', {
          role: 'presentation',
          class:
            'btnImage pj-icon ' +
            (this.options.genrePJ ===
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
              ? 'icon_globe'
              : 'icon_piece_jointe'),
        });
        H.push(
          '<div class="pj-global-conteneur flex-gap-s" ie-node="getNodeConteneur" ie-class="getClassNodeConteneur">',
        );
        H.push(
          '<div id="',
          this.getNomTrombone(),
          '" role="button" ie-node="nodeTrombone" class="flex-inline-contain" tabindex="0"',
          this.options.title
            ? ' title="' +
                ObjetChaine_1.GChaine.toTitle(this.options.title) +
                '" aria-label="' +
                ObjetChaine_1.GChaine.toTitle(this.options.title) +
                '"'
            : '',
          this.options.genrePJ !==
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Url &&
            !this.options.forcerEvenementSurClickIcon
            ? ' ie-model="trombone" ie-selecfile '
            : '',
          '>',
          this.options.libelleSelecteur
            ? (0, tag_1.tag)(
                'div',
                { class: 'select-file' },
                lImage,
                (0, tag_1.tag)(
                  'span',
                  { class: '' },
                  this.options.libelleSelecteur,
                ),
              )
            : (0, tag_1.tag)('div', { class: 'select-file' }, lImage),
          '</div>',
        );
        if (this.idOrigPJ && !this.options.masquerListeChips) {
          H.push(
            '<div id="',
            this.id_libellesPJ,
            '" class="pj-liste-conteneur"></div>',
          );
        }
        H.push('</div>');
        return H.join('');
      }
      setDonnees(aParam) {
        this._avecDonnees = true;
        this.genreRessourcePJ = aParam.genreRessourcePJ;
        this.afficher();
        if (aParam.idListePJ) {
          this.setIdPourLibellesPJ(aParam.idListePJ);
        }
        if (aParam.listePJ) {
          this.setLibellesPJ(aParam.listePJ);
        }
      }
      getNomTrombone() {
        return this.id_trombone;
      }
      setLibellesPJ(aListePJ) {
        if (aListePJ && !this.options.masquerListeChips) {
          $('#' + this.id_libellesPJ.escapeJQ()).ieHtml(
            UtilitaireUrl_1.UtilitaireUrl.construireListeUrls(aListePJ, {
              genreFiltre: this.options.genrePJ,
              genreRessource: this.genreRessourcePJ,
              IEModelChips: this.Actif ? this.options.IEModelChipsPJ : '',
              maxWidth: this.options.maxWidthLibelle,
            }),
            { controleur: this.options.controleur },
          );
        }
      }
      setIdPourLibellesPJ(aIdListePJ) {
        this.idOrigPJ = false;
        this.id_libellesPJ = aIdListePJ;
      }
      setActif(AActif) {
        this.Actif = AActif;
        this.$refreshSelf();
      }
    }
    exports.ObjetModulePJ = ObjetModulePJ;
  },
  fn: 'objetmodulepj.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_ActionContextuelle = void 0;
    const ObjetFenetre_1 = require('ObjetFenetre');
    const tag_1 = require('tag');
    const MethodesObjet_1 = require('MethodesObjet');
    const SelecFile_1 = require('SelecFile');
    const ObjetTraduction_1 = require('ObjetTraduction');
    require('ObjetFenetre_ActionContextuelle.css');
    class ObjetFenetre_ActionContextuelle extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          modale: false,
          largeur: 380,
          hauteur: 200,
          fermerFenetreSurClicHorsFenetre: true,
          titre: ObjetTraduction_1.GTraductions.getValeur(
            'fenetre_ActionContextuelle.titre',
          ),
        });
      }
      static ouvrir(aTabActions, aParam) {
        var _a;
        if (
          aTabActions &&
          aTabActions.length === 1 &&
          aTabActions[0].selecFile === true
        ) {
          const [lAction] = aTabActions;
          SelecFile_1.SelecFile.select(lAction.optionsSelecFile).then(
            (aResult) => {
              var _a;
              if (aResult) {
                (_a =
                  lAction === null || lAction === void 0
                    ? void 0
                    : lAction.event) === null || _a === void 0
                  ? void 0
                  : _a.call(lAction, aResult);
              }
            },
          );
        } else {
          ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
            ObjetFenetre_ActionContextuelle,
            {
              pere: (_a = aParam.pere) !== null && _a !== void 0 ? _a : {},
              initialiser: function (aInstance) {
                if (
                  MethodesObjet_1.MethodesObjet.isObject(aParam.optionsFenetre)
                ) {
                  aInstance.setOptionsFenetre(aParam.optionsFenetre);
                }
              },
            },
          ).setDonnees(aTabActions);
        }
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          action: {
            event: function (aIndice) {
              if (!!aInstance.actions[aIndice].event) {
                if (!aInstance.actions[aIndice].selecFile) {
                  aInstance.fermer();
                  aInstance.actions[aIndice].event();
                }
              } else {
              }
            },
            getOptionsSelecFile: function (aIndice) {
              return aInstance.actions[aIndice].optionsSelecFile;
            },
            addFiles: function (aIndice, aParams) {
              aInstance.fermer();
              aInstance.actions[aIndice].event.call(aInstance, aParams);
            },
          },
        });
      }
      setDonnees(aTabActions) {
        this.actions = aTabActions;
        this.afficher(this.composeContenu());
      }
      composeContenu() {
        return this.actions
          ? '<div class="fenetre-actionContextuelle"><div class="btas-wrapper cnt-' +
              this.actions.length +
              '">' +
              this._construireActions() +
              '</div></div>'
          : '';
      }
      _construireActions() {
        const H = [];
        if (!!this.actions && this.actions.length) {
          this.actions.forEach((aActions, i) => {
            if (!!aActions.icon) {
              H.push(
                (0, tag_1.tag)(
                  'div',
                  { class: 'bta-contain' },
                  (0, tag_1.tag)('ie-btnicon', {
                    class:
                      'bt-activable bt-big ' +
                      aActions.icon +
                      (!!aActions.class ? ' ' + aActions.class : ''),
                    title: aActions.libelle || '',
                    'ie-model': 'action(' + i + ')',
                    'ie-selecFile': !!aActions.selecFile,
                  }),
                  aActions.libelle
                    ? (0, tag_1.tag)('label', aActions.libelle)
                    : '',
                ),
              );
            }
          });
        }
        return H.join('');
      }
    }
    exports.ObjetFenetre_ActionContextuelle = ObjetFenetre_ActionContextuelle;
  },
  fn: 'objetfenetre_actioncontextuelle.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetSelecteurPJCP = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_Action_1 = require('Enumere_Action');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetInterface_1 = require('ObjetInterface');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetMenuContextuel_1 = require('ObjetMenuContextuel');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetModulePJ_1 = require('ObjetModulePJ');
    const ObjetFenetre_ActionContextuelle_1 = require('ObjetFenetre_ActionContextuelle');
    const UtilitaireSelecFile_1 = require('UtilitaireSelecFile');
    class ObjetSelecteurPJCP extends ObjetInterface_1.ObjetInterface {
      constructor(...aParams) {
        super(...aParams);
        this.AvecCadre = false;
        this.genreMenuContextuel = {
          ajouterPJNouvelle: 0,
          ajouterPJExistante: 1,
          supprimerPJ: 2,
        };
        this._initialiserOptions();
      }
      _initialiserOptions() {
        this._options = {
          genrePJ: Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
          genreRessourcePJ: -1,
          title: '',
          maxFiles: 0,
          maxSize: 1048576,
          avecAjoutExistante: false,
          interdireDoublonsLibelle: true,
          avecCmdAjoutNouvelle: true,
          idLibellePJ: '',
          avecEtatSaisie: true,
          avecBoutonSupp: false,
          avecMenuSuppressionPJ: !IE.estMobile,
          maxWidthLibelle: 0,
          libelleSelecteur: '',
          avecInActifVisible: false,
          ouvrirFenetreChoixTypesAjout: false,
          ouvrirFenetreGestionnaireSurClick: false,
          avecMenuContextuel: true,
          masquerListeChips: false,
          fenetrePieceJointe: {
            avecBoutonActualiser: true,
            avecFiltreExtensionSurRemplacer: false,
          },
          avecCallbackAjouterPJs: false,
          multiple: false,
          acceptDragDrop: true,
          avecTransformationFlux: true,
          optionsCloud: {
            avecCloud: false,
            callbackChoixFichierParFichier: null,
            callbackChoixFichierFinal: null,
          },
        };
      }
      estUtilisateurConnecteEnModeConsultation() {
        return false;
      }
      setOptions(aOptions) {
        $.extend(this._options, aOptions);
        if (this._options.maxFiles === 1) {
          this._options.avecCmdAjoutNouvelle = false;
        }
        return this;
      }
      supprimerPJ(aElementPJ) {
        this._supprimerPJ(aElementPJ);
        return this;
      }
      construireInstances() {
        this.identPJ = this.add(
          ObjetModulePJ_1.ObjetModulePJ,
          this.evntModulePJ,
          this.initModulePJ,
        );
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          chipsPieceJointe: {
            eventBtn: function (aIndice) {
              const lElement = aInstance.listePJ
                ? aInstance.listePJ.get(aIndice)
                : null;
              if (lElement) {
                aInstance._supprimerPJ(lElement);
              }
            },
            getOptions() {
              return {
                avecBtn: !aInstance.estUtilisateurConnecteEnModeConsultation(),
              };
            },
            getDisabled: function (aIndice) {
              const lElement = aInstance.listePJ
                ? aInstance.listePJ.get(aIndice)
                : null;
              return !lElement;
            },
          },
        });
      }
      composeContenu() {
        const H = [];
        H.push(
          '<div class="EspaceHaut" id="',
          this.getNomInstance(this.identPJ),
          '"></div>',
        );
        return H.join('');
      }
      setActif(AActif) {
        this.Actif = AActif;
        if (this.getInstance(this.identPJ)) {
          this.getInstance(this.identPJ).setActif(AActif);
          this.getInstance(this.identPJ).setLibellesPJ(this.listePJ);
        }
      }
      setDonnees(aParam) {
        this.avecInputFile =
          this._options.genrePJ !==
          Enumere_DocumentJoint_1.EGenreDocumentJoint.Url;
        this.listePJTotale = aParam.listeTotale;
        this.listePJ = aParam.listePJ;
        this.idContextFocus = aParam.idContextFocus;
        const lParam = {
          listePJ: this.listePJ,
          genreRessourcePJ: this._options.genreRessourcePJ,
          idListePJ: undefined,
        };
        if (aParam.idListePJ) {
          lParam.idListePJ = aParam.idListePJ;
        }
        this.getInstance(this.identPJ)
          .setOptions({
            genrePJ: this._options.genrePJ,
            addFiles: this._addFiles.bind(this),
            getDisabledFiles: this._getDisabledFiles.bind(this),
            getOptionsSelecFile: this._getOptionsSelecFile.bind(this),
          })
          .setDonnees(lParam);
      }
      setTailleMaxPJ(aTailleMax) {
        this._options.maxSize = aTailleMax;
      }
      controlerFichierSelectionne(aParam) {
        if (
          !UtilitaireSelecFile_1.UtilitaireSelecFile.estFichierCloudPartage(
            aParam,
          ) &&
          this._isLibelleFichierExiste(aParam.getLibelle())
        ) {
          return {
            succes: false,
            msg: ObjetTraduction_1.GTraductions.getValeur(
              'inputFile.msgEchecLibelleFichierAvecInfo',
            ),
          };
        }
        return { succes: true, msg: '' };
      }
      _isLibelleFichierExiste(aNomFichier) {
        if (!this._options.interdireDoublonsLibelle) {
          return false;
        }
        const lNbrElts = this.listePJTotale.count();
        for (let I = 0; I < lNbrElts; I++) {
          let lElt = this.listePJTotale.get(I);
          const lLibelle = lElt.getLibelle();
          if (
            lElt.existe() &&
            lLibelle &&
            aNomFichier &&
            lLibelle.toLowerCase &&
            aNomFichier.toLowerCase &&
            lLibelle.trim().toLowerCase() === aNomFichier.trim().toLowerCase()
          ) {
            return true;
          }
        }
        return false;
      }
      initModulePJ(aInstance) {
        if (this._options.idLibellePJ) {
          aInstance.setIdPourLibellesPJ(this._options.idLibellePJ);
        }
        aInstance.setOptions({
          genrePJ: this._options.genrePJ,
          forcerEvenementSurClickIcon:
            this._options.ouvrirFenetreGestionnaireSurClick ||
            !!this._options.ouvrirFenetreChoixTypesAjout,
          IEModelChipsPJ: this._options.avecBoutonSupp
            ? 'chipsPieceJointe'
            : '',
          controleur: this._options.avecBoutonSupp ? this.controleur : null,
          title: this._options.title,
          maxWidthLibelle: this._options.maxWidthLibelle,
          libelleSelecteur: this._options.libelleSelecteur,
          masquerListeChips: this._options.masquerListeChips,
        });
      }
      initEditionPJ(aInstance) {
        if (aInstance.setOptionsFenetre) {
          aInstance.setOptionsFenetre(this._options.fenetrePieceJointe);
        }
      }
      addFilesDeSelecFile(aParams) {
        return this._addFiles(aParams);
      }
      evntModulePJ(aParam) {
        if (!this.Actif) {
          return;
        }
        switch (aParam.action) {
          case this.getInstance(this.identPJ).genreCommande.menuContext:
            if (this._options.avecMenuContextuel) {
              this._afficherMenuContextuel();
            }
            break;
          case this.getInstance(this.identPJ).genreCommande.click:
            if (
              this._options.avecAjoutExistante &&
              this._options.ouvrirFenetreChoixTypesAjout
            ) {
              this._ouvrirFenetreChoixTypesAjout(
                this._options.optionsCloud,
                aParam.id,
              );
            } else if (
              this._options.avecAjoutExistante &&
              (this._options.genrePJ ===
                Enumere_DocumentJoint_1.EGenreDocumentJoint.Url ||
                this._options.ouvrirFenetreGestionnaireSurClick)
            ) {
              this._ouvrirFenetrePJ();
            }
            break;
          default:
            break;
        }
      }
      evntEditionPJ() {
        if (!this.Actif) {
          return;
        }
        const alisteDocumentsJoints = this.listePJTotale;
        if (!alisteDocumentsJoints) {
          return;
        }
        for (let I = 0; I < alisteDocumentsJoints.count(); I++) {
          const lDocumentJoint = this.listePJ.getElementParNumero(
            alisteDocumentsJoints.getNumero(I),
          );
          const lActif =
            alisteDocumentsJoints.get(I).Actif &&
            alisteDocumentsJoints.existe(I);
          if (lDocumentJoint) {
            if (!lActif) {
              lDocumentJoint.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
            } else {
              const lDoc = alisteDocumentsJoints.get(I);
              if (lDoc.getEtat() === Enumere_Etat_1.EGenreEtat.Modification) {
                lDocumentJoint.Libelle = lDoc.Libelle;
              }
            }
          } else {
            if (lActif) {
              const lDoc = alisteDocumentsJoints.get(I);
              if (lDoc.Fichier) {
                lDoc.idFichier = lDoc.Fichier.idFichier;
                lDoc.Libelle = lDoc.Fichier.Libelle;
                lDoc.nomOriginal = lDoc.Fichier.nomOriginal;
                lDoc.file = lDoc.Fichier.file;
              }
              let lEltFichier = MethodesObjet_1.MethodesObjet.dupliquer(lDoc);
              lEltFichier.file = lDoc.file;
              lEltFichier.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
              this.listePJ.addElement(lEltFichier);
            }
          }
        }
        this.getInstance(this.identPJ).setLibellesPJ(this.listePJ);
        this.callback.appel({ evnt: ObjetSelecteurPJCP.genreEvnt.editionPJ });
      }
      setIdPourLibellesPJ(aIdListePJ) {
        this.getInstance(this.identPJ).setIdPourLibellesPJ(aIdListePJ);
      }
      ouvrirFenetreChoixListeCloud(aCallbackParFichier, aCallbackFinal) {}
      _getOptionsSelecFile() {
        return {
          title: this._options.title,
          maxFiles: this._options.maxFiles,
          maxSize: this._options.maxSize,
          genrePJ: this._options.genrePJ,
          multiple: this._options.multiple,
          acceptDragDrop: this._options.acceptDragDrop,
          avecTransformationFlux: this._options.avecTransformationFlux,
        };
      }
      _getDisabledFiles() {
        return (
          !this.Actif ||
          (this._options.maxFiles !== 0 &&
            this.listePJ.getNbrElementsExistes() >= this._options.maxFiles)
        );
      }
      _addFiles(aParams) {
        const lListeFichiersClouds =
          UtilitaireSelecFile_1.UtilitaireSelecFile.extraireListeFichiersCloudsPartage(
            aParams.listeFichiers,
          );
        let lParam;
        const lFiles = [];
        aParams.listeFichiers.parcourir((aFichier) => {
          const lControle = this.controlerFichierSelectionne(aFichier);
          lParam = null;
          if (lControle.succes) {
            this.listePJTotale.addElement(aFichier);
            this.listePJ.addElement(aFichier);
            lParam = {
              evnt: ObjetSelecteurPJCP.genreEvnt.selectionPJ,
              fichier: aFichier,
            };
            lFiles.push(aFichier);
            if (this._options.avecEtatSaisie) {
              this.setEtatSaisie(true);
            }
          } else {
            GApplication.getMessage().afficher({
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
              message: lControle.msg,
            });
          }
          this.getInstance(this.identPJ).setLibellesPJ(this.listePJ);
          if (lParam) {
            this.callback.appel(lParam);
          }
        });
        if (lFiles.length > 0 && this._options.avecCallbackAjouterPJs) {
          this.callback.appel({
            evnt: ObjetSelecteurPJCP.genreEvnt.ajouterPJs,
            tabFichiers: lFiles,
          });
        }
        if (lListeFichiersClouds.count() > 0) {
          if (
            this._options.optionsCloud &&
            this._options.optionsCloud.callbackChoixFichierParFichier &&
            this._options.optionsCloud.callbackChoixFichierFinal
          ) {
            lListeFichiersClouds.parcourir((aFichier) => {
              this._options.optionsCloud.callbackChoixFichierParFichier(
                aFichier,
              );
            });
            this._options.optionsCloud.callbackChoixFichierFinal();
          } else {
          }
        }
      }
      _ouvrirFenetreChoixTypesAjout(aParametresCloud = {}, aId) {
        const lThis = this;
        const lTabActions = [];
        lTabActions.push({
          libelle: ObjetTraduction_1.GTraductions.getValeur(
            'CahierDeTexte.piecesJointes.FichierParmiUtilises',
          ),
          icon: 'icon_file_alt',
          event() {
            lThis._ouvrirFenetrePJ();
          },
          class: 'bg-util-vert-claire',
        });
        if (GEtatUtilisateur.avecGestionAppareilPhoto()) {
          lTabActions.push({
            libelle: ObjetTraduction_1.GTraductions.getValeur(
              'fenetre_ActionContextuelle.prendrePhoto',
            ),
            icon: 'icon_camera',
            event(aParamsInput) {
              if (aParamsInput) {
                lThis._addFiles(aParamsInput);
              }
            },
            optionsSelecFile: {
              title: '',
              maxFiles: this._options.maxFiles,
              maxSize: this._options.maxSize,
              genrePJ: Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
              acceptDragDrop: false,
              capture: 'environment',
              accept: 'image/*',
            },
            selecFile: true,
            class: 'bg-util-marron-claire',
          });
          lTabActions.push({
            libelle: ObjetTraduction_1.GTraductions.getValeur(
              'blog.billet.ouvrirGalerie',
            ),
            icon: 'icon_picture',
            event(aParamsInput) {
              if (aParamsInput) {
                lThis._addFiles(aParamsInput);
              }
            },
            optionsSelecFile: {
              title: '',
              maxFiles: this._options.maxFiles,
              maxSize: this._options.maxSize,
              genrePJ: Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
              multiple: this._options.maxFiles !== 1,
              acceptDragDrop: false,
              accept: 'image/*',
            },
            selecFile: true,
            class: 'bg-util-marron-claire',
          });
        }
        const lAvecCloud =
          GEtatUtilisateur.avecCloudDisponibles() && aParametresCloud.avecCloud;
        lTabActions.push({
          libelle: IE.estMobile
            ? ObjetTraduction_1.GTraductions.getValeur(
                'CahierDeTexte.piecesJointes.FichierDepuisDocument',
              )
            : ObjetTraduction_1.GTraductions.getValeur(
                'CahierDeTexte.piecesJointes.FichierDepuisDisque',
              ),
          icon: 'icon_folder_open',
          selecFile: true,
          optionsSelecFile: {
            maxSize: this._options.maxSize,
            maxFiles: this._options.maxFiles,
            multiple: this._options.maxFiles !== 1,
            avecTransformationFlux: this._options.avecTransformationFlux,
            avecTransformationFlux_versCloud: lAvecCloud,
          },
          event(aParamsInput) {
            if (aParamsInput) {
              lThis._addFiles(aParamsInput);
            }
          },
          class: 'bg-util-marron-claire',
        });
        if (lAvecCloud) {
          lTabActions.push({
            libelle: ObjetTraduction_1.GTraductions.getValeur(
              'CahierDeTexte.piecesJointes.FichierDepuisCloud',
            ),
            icon: 'icon_cloud',
            event() {
              lThis.ouvrirFenetreChoixListeCloud(
                aParametresCloud.callbackChoixFichierParFichier,
                aParametresCloud.callbackChoixFichierFinal,
              );
            },
            class: 'bg-util-marron-claire',
          });
        }
        const lParams = {};
        if (lTabActions.length > 1) {
          lParams.optionsFenetre = { idPositionnement: aId };
          lParams.pere = this;
        }
        ObjetFenetre_ActionContextuelle_1.ObjetFenetre_ActionContextuelle.ouvrir(
          lTabActions,
          lParams,
        );
      }
      _ouvrirFenetrePJ() {
        this.getInstance(this.identEditionPJ).afficherFenetrePJ({
          listePJTot: this.listePJTotale,
          listePJContexte: this.listePJ,
          genreFenetrePJ: this._options.genrePJ,
          genrePJ: this._options.genrePJ,
          genreRessourcePJ: this._options.genreRessourcePJ,
          avecFiltre: { date: true },
          avecEtatSaisie: this._options.avecEtatSaisie,
          avecInActifVisible: this._options.avecInActifVisible,
          optionsSelecFile: this._getOptionsSelecFile(),
        });
      }
      _afficherMenuContextuel() {
        ObjetMenuContextuel_1.ObjetMenuContextuel.afficher({
          pere: this,
          evenement: function () {},
          initCommandes: (aInstance) => {
            if (this._options.avecCmdAjoutNouvelle && this.avecInputFile) {
              aInstance.addSelecFile(
                this._options.genrePJ ===
                  Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'selecteurPJ.ajoutNouveauLien',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'selecteurPJ.ajoutNouvellePJ',
                    ),
                {
                  getOptionsSelecFile: this._getOptionsSelecFile.bind(this),
                  addFiles: this._addFiles.bind(this),
                },
                !this._getDisabledFiles(),
              );
              aInstance.avecSeparateurSurSuivant();
            }
            if (this._options.avecAjoutExistante) {
              aInstance.add(
                this._options.genrePJ ===
                  Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'selecteurPJ.ajoutLienExistant',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'selecteurPJ.ajoutPJExistante',
                    ),
                true,
                () => {
                  this._ouvrirFenetrePJ();
                },
              );
            }
            if (this._options.avecMenuSuppressionPJ) {
              if (
                this._options.avecCmdAjoutNouvelle ||
                this._options.avecAjoutExistante
              ) {
                aInstance.avecSeparateurSurSuivant();
              }
              const lListePJ = new ObjetListeElements_1.ObjetListeElements();
              if (this.listePJ && this.listePJ.getNbrElementsExistes() > 0) {
                this.listePJ.parcourir((aElement) => {
                  if (
                    aElement.existe() &&
                    (aElement.getGenre() === undefined ||
                      aElement.getGenre() === null ||
                      aElement.getGenre() === this._options.genrePJ)
                  ) {
                    lListePJ.addElement(aElement);
                  }
                });
              }
              if (lListePJ.count() > 0) {
                aInstance.addSousMenu(
                  ObjetTraduction_1.GTraductions.getValeur(
                    'selecteurPJ.supprimerPJ',
                  ),
                  (aInstanceSousMenu) => {
                    lListePJ.parcourir((aElement) => {
                      aInstanceSousMenu.add(
                        aElement.getLibelle(),
                        aElement.actif,
                        () => {
                          this._supprimerPJ(aElement);
                        },
                        {
                          image: aElement.image,
                          largeurImage: aElement.largeurImage,
                        },
                      );
                    });
                  },
                );
              }
            }
          },
        });
      }
      _supprimerPJ(aElementASupprimer) {
        if (!this.Actif || !aElementASupprimer) {
          return;
        }
        const message =
          '<div style="word-break: break-all;">' +
          (this._options.genrePJ ===
          Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
            ? ObjetTraduction_1.GTraductions.getValeur(
                'selecteurPJ.msgConfirmLien',
                [aElementASupprimer.getLibelle()],
              )
            : ObjetTraduction_1.GTraductions.getValeur(
                'selecteurPJ.msgConfirmPJ',
                [aElementASupprimer.getLibelle()],
              )) +
          '</div>';
        GApplication.getMessage()
          .afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
            message: message,
          })
          .then((aAccepte) => {
            if (this.existeInstance(this.identEditionPJ)) {
              this.getInstance(this.identEditionPJ).fermer();
            }
            if (aAccepte !== Enumere_Action_1.EGenreAction.Valider) {
              return;
            }
            aElementASupprimer.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
            if (this._options.avecEtatSaisie) {
              this.setEtatSaisie(true);
            }
            this.getInstance(this.identPJ).setLibellesPJ(this.listePJ);
            this.callback.appel({
              evnt: ObjetSelecteurPJCP.genreEvnt.suppressionPJ,
            });
            this.$refresh();
          });
      }
    }
    exports.ObjetSelecteurPJCP = ObjetSelecteurPJCP;
    ObjetSelecteurPJCP.genreEvnt = {
      selectionPJ: 1,
      suppressionPJ: 2,
      editionPJ: 3,
      ajouterPJs: 4,
    };
  },
  fn: 'objetselecteurpjcp.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreCommandeMenu = void 0;
    var EGenreCommandeMenu;
    (function (EGenreCommandeMenu) {
      EGenreCommandeMenu['Creation'] = 'cmdMenu_creation';
      EGenreCommandeMenu['Edition'] = 'cmdMenu_edition';
      EGenreCommandeMenu['Suppression'] = 'cmdMenu_suppression';
    })(
      EGenreCommandeMenu ||
        (exports.EGenreCommandeMenu = EGenreCommandeMenu = {}),
    );
  },
  fn: 'enumere_commandemenu.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetIndexsUnique = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    class ObjetIndexsUnique {
      constructor() {
        this._indexsUnique = [];
      }
      ajouterIndex(aChamps) {
        if (
          !MethodesObjet_1.MethodesObjet.isArray(aChamps) &&
          !MethodesObjet_1.MethodesObjet.isString(aChamps)
        ) {
          return this;
        }
        if (!this._indexsUnique) {
          this._indexsUnique = [];
        }
        const lChamps = [];
        let lChampIndexCalcul;
        if (!Array.isArray(aChamps)) {
          aChamps = [aChamps];
        }
        for (let i = 0; i < aChamps.length; i++) {
          const lChampIndex = aChamps[i];
          if (
            typeof lChampIndex === 'string' ||
            typeof lChampIndex === 'function'
          ) {
            lChampIndexCalcul = ObjetIndexsUnique.ajouterChamp(lChampIndex);
          } else {
            lChampIndexCalcul = lChampIndex;
          }
          lChamps.push(lChampIndexCalcul);
        }
        this._indexsUnique.push(lChamps);
        return this;
      }
      estDoublon(a, b) {
        for (let i = 0; i < this._indexsUnique.length; i++) {
          if (_estDoublonComparaisonET(this._indexsUnique[i], a, b)) {
            return true;
          }
        }
        return false;
      }
      estDoublonDansTableau(aElement, aTableau) {
        for (const i in aTableau) {
          if (this.estDoublon(aElement, aTableau[i])) {
            return true;
          }
        }
        return false;
      }
      existeIndex() {
        return this._indexsUnique.length > 0;
      }
      static ajouterChamp(aValeur, aVideEstDoublon, aSensibleCasse) {
        return {
          valeur: aValeur,
          videEstDoublon: !!aVideEstDoublon,
          sensibleCasse: !!aSensibleCasse,
          estFonction: MethodesObjet_1.MethodesObjet.isFunction(aValeur),
          estAccesseurChaine:
            MethodesObjet_1.MethodesObjet.isString(aValeur) &&
            aValeur.indexOf('.') >= 0,
        };
      }
    }
    exports.ObjetIndexsUnique = ObjetIndexsUnique;
    function _estDoublonComparaisonET(aIndexUnique, a, b) {
      let lResult = false;
      for (let i = 0; i < aIndexUnique.length; i++) {
        if (aIndexUnique[i]) {
          if (_comparateurChampIndex(aIndexUnique[i], a, b)) {
            lResult = true;
          } else {
            return false;
          }
        }
      }
      return lResult;
    }
    function _comparateurChampIndex(aChampIndex, a, b) {
      if (!aChampIndex || !aChampIndex.valeur) {
        return false;
      }
      if (!a || !b) {
        return false;
      }
      let lValeurA;
      let lValeurB;
      if (aChampIndex.estFonction) {
        lValeurA = aChampIndex.valeur(a);
        lValeurB = aChampIndex.valeur(b);
      } else if (aChampIndex.estAccesseurChaine) {
        lValeurA = MethodesObjet_1.MethodesObjet.get(a, aChampIndex.valeur);
        lValeurB = MethodesObjet_1.MethodesObjet.get(b, aChampIndex.valeur);
      } else {
        lValeurA = a[aChampIndex.valeur];
        lValeurB = b[aChampIndex.valeur];
      }
      if (lValeurA && lValeurA.getTime) {
        lValeurA = lValeurA.getTime();
      }
      if (lValeurB && lValeurB.getTime) {
        lValeurB = lValeurB.getTime();
      }
      if (aChampIndex.sensibleCasse !== true) {
        if (lValeurA && lValeurA.toLowerCase) {
          lValeurA = lValeurA.toLowerCase();
        }
        if (lValeurB && lValeurB.toLowerCase) {
          lValeurB = lValeurB.toLowerCase();
        }
      }
      if (
        lValeurA === lValeurB &&
        (lValeurA === '' || lValeurA === undefined || lValeurA === null)
      ) {
        return !!aChampIndex.videEstDoublon;
      } else {
        return lValeurA === lValeurB;
      }
    }
  },
  fn: 'objetindexsunique.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetDonneesListe = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetStyle_1 = require('ObjetStyle');
    const Enumere_CommandeMenu_1 = require('Enumere_CommandeMenu');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetDate_1 = require('ObjetDate');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetIndexsUnique_1 = require('ObjetIndexsUnique');
    const TypeNote_1 = require('TypeNote');
    const ObjetHtml_1 = require('ObjetHtml');
    const UtilitaireDuree_1 = require('UtilitaireDuree');
    class ObjetDonneesListe {
      constructor(aDonnees) {
        this.estFlatDesign = false;
        this.mapPereFils = null;
        this.Donnees = !aDonnees
          ? new ObjetListeElements_1.ObjetListeElements()
          : aDonnees;
        this.enImpression = false;
        this.enConstruction_cacheRechercheTexte = false;
        this.options = {
          avecSelection: true,
          avecEdition: true,
          avecSuppression: true,
          editionApresSelection: true,
          editionSurSelectionApresFinEdition: false,
          avecEvnt_Selection: false,
          avecEvnt_ModificationSelection: false,
          avecEvnt_SelectionClick: false,
          avecEvnt_SelectionDblClick: false,
          avecEvnt_Edition: false,
          avecEvnt_ApresEdition: false,
          avecEvnt_ApresEditionValidationSansModification: false,
          avecEvnt_Creation: false,
          avecEvnt_ApresCreation: false,
          avecEvnt_Suppression: false,
          avecEvnt_ApresSuppression: false,
          avecEvnt_KeyPressListe: false,
          avecTimeoutEvent_KeyPressListe: true,
          avecEvnt_KeyUpListe: false,
          avecEvnt_Deploiement: false,
          avecSurvolCelluleVisible: true,
          avecMultiSelection: false,
          selectionParCellule: false,
          avecMultiSelectionSurCtrl: true,
          avecMultiSelectionSurShift: true,
          avecMultiSelectionSurLigneFusion: true,
          avecSelectionSurNavigationClavier: false,
          avecNavigationClavierFlechesEnEdition: false,
          avecCelluleSuivanteSurFinEdition: false,
          avecRechercheSelectionMiroir: false,
          avecDeselectionSurNonSelectionnable: true,
          avecDeselectionMonoSelectionClick: false,
          avecDeselectionMonoSelectionClickCtrl: false,
          avecEtatSaisie: true,
          avecTri: true,
          avecContenuTronque: false,
          avecEllipsisContenuTronque: true,
          avecDeploiement: false,
          avecDeploiementSurColonne: true,
          avecImageSurColonneDeploiement: false,
          avecEventDeploiementSurCellule: true,
          avecInterruptionSuppression: false,
          avecTrimSurEdition: false,
          indentationCelluleEnfant: 12,
          hauteurMinCellule: ObjetDonneesListe.hauteurMinCellule,
          hauteurMinContenuCellule: 0,
          alignVCenter: false,
          avecLigneDraggable: false,
          avecLigneDroppable: false,
          dragNDropLigneInsertion: true,
          avecHtmlDetailsDraggableOver: true,
          getValeur: null,
          nonEditable: false,
          avecPereVisibleSurRechercheTexte: true,
          ignorerDeploiementSurRechercheTexte: true,
          racineCss: MethodesObjet_1.MethodesObjet.getObjectClass(this),
        };
        this.paramsListe = {
          liste: null,
          idWAILigneLue: '',
          versionMobile: false,
          getIdsColonnes: null,
          getParams: null,
          avecRechercheTexteEnCours: false,
        };
      }
      setOptions(aOptions) {
        $.extend(this.options, aOptions);
        return this;
      }
      getControleur(aDonneeListe, aListe) {
        return null;
      }
      avecSelection(aParams) {
        return this.options.avecSelection;
      }
      avecDeselection(aParams) {
        return this.avecMultiSelection()
          ? true
          : this.options.avecDeselectionMonoSelectionClickCtrl ||
              this.options.avecDeselectionMonoSelectionClick;
      }
      selectionParCellule(aColonne, aArticle) {
        return this.options.selectionParCellule;
      }
      avecEdition(aParams) {
        return this.options.avecEdition;
      }
      avecEditionApresSelection(aParams) {
        if (aParams.typeValeur === ObjetDonneesListe.ETypeCellule.Coche) {
          return false;
        }
        return this.options.editionApresSelection;
      }
      getColonneTransfertEdition(aParams) {
        return null;
      }
      avecSuppression(aParams) {
        return this.options.avecSuppression;
      }
      avecEtatSaisie(aParamsCellule) {
        return this.options.avecEtatSaisie;
      }
      avecTri() {
        return this.options.avecTri;
      }
      avecMenuContextuel(aParams) {
        return aParams.article && aParams.ligne >= 0
          ? this.options.avecContextMenuSansSelection ||
              this.avecSelection(aParams)
          : false;
      }
      avecContenuTronque(aParams) {
        return this.options.avecContenuTronque;
      }
      avecDeploiement() {
        return this.options.avecDeploiement;
      }
      avecDeploiementSurColonne(aParams) {
        return this.options.avecDeploiementSurColonne;
      }
      avecImageSurColonneDeploiement(aParams) {
        return this.options.avecImageSurColonneDeploiement;
      }
      avecEventDeploiementSurCellule(aParams) {
        return this.options.avecEventDeploiementSurCellule;
      }
      getIndentationCelluleSelonParente(aParams) {
        if (!aParams) {
          return 0;
        }
        let lIndent = 0,
          lArticle = aParams.article;
        while (lArticle && lArticle.pere) {
          lIndent += this.options.indentationCelluleEnfant || 0;
          lArticle = lArticle.pere;
        }
        return lIndent;
      }
      getIndentationCellule(aParams) {
        return 0;
      }
      avecAlternanceCouleurLigne(aParamsCellule) {
        if (
          this.estUnDeploiement(aParamsCellule) ||
          (aParamsCellule.celluleLignePrecedente &&
            this.estUnDeploiement(aParamsCellule.celluleLignePrecedente))
        ) {
          return 0;
        }
        return true;
      }
      surDeploiement(I, J, D) {
        D.estDeploye = !D.estDeploye;
      }
      avecEvenementSelection(aParams) {
        return this.options.avecEvnt_Selection;
      }
      avecEvenementSelectionClick(aParams) {
        return this.options.avecEvnt_SelectionClick;
      }
      avecEvenementSelectionDblClick(aParams) {
        return this.options.avecEvnt_SelectionDblClick;
      }
      avecEvenementCreation() {
        return this.options.avecEvnt_Creation;
      }
      avecEvenementEdition(aParams) {
        return this.options.avecEvnt_Edition;
      }
      avecEvenementSuppression(aParams) {
        return this.options.avecEvnt_Suppression;
      }
      avecEvenementDeploiement(aParams) {
        return this.options.avecEvnt_Deploiement;
      }
      avecEvenementApresCreation() {
        return this.options.avecEvnt_ApresCreation;
      }
      avecEvenementApresErreurCreation() {
        return false;
      }
      avecEvenementApresEdition(aParams) {
        return this.options.avecEvnt_ApresEdition;
      }
      avecEvenementApresSuppression() {
        return this.options.avecEvnt_ApresSuppression;
      }
      avecInterruptionSuppression() {
        return this.options.avecInterruptionSuppression;
      }
      surSelectionLigne(aLigne, aDonnee, aSelectionner) {}
      surSelection(aColonne, aDonnee, aLigne, aSelectionner) {}
      surCreation(D, V, J) {
        return;
      }
      avecCreationElementsDynamique(aListeValeurs, aLigneCreation) {
        return false;
      }
      surEdition(aParams, V) {}
      forcerActualisationListeSurEdition(aParams) {
        return true;
      }
      surSuppression(aArticle) {
        aArticle.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
      }
      avecSelecFile(aParams) {
        return false;
      }
      getOptionsSelecFile(aParams) {
        return null;
      }
      evenementSurSelecFile(aParams, aParamsSelecFile) {}
      avecLigneDraggable(aParams) {
        return this.options.avecLigneDraggable;
      }
      getLibelleDraggable(aParams) {
        return '';
      }
      getHtmlDetailsDraggableOver(aParams, aDataDrag) {
        if (!this.options.avecHtmlDetailsDraggableOver) {
          return '';
        }
        return (
          '<div class="draggable_details_Deplacer"></div><label>' +
          (this.options.dragNDropLigneInsertion
            ? ObjetTraduction_1.GTraductions.getValeur('liste.ChangerRang')
            : ObjetTraduction_1.GTraductions.getValeur('liste.EchangerRang')) +
          '</label>'
        );
      }
      avecLigneDroppable(aParams) {
        return this.options.avecLigneDroppable;
      }
      autoriserDeplacementElementSurLigne(
        aParamsLigneDestination,
        aParamsSource,
      ) {
        return (
          aParamsSource.instance &&
          aParamsLigneDestination.instance &&
          aParamsSource.instance.getNom() ===
            aParamsLigneDestination.instance.getNom() &&
          aParamsLigneDestination.article &&
          aParamsSource.article &&
          aParamsLigneDestination.ligne !== aParamsSource.ligne
        );
      }
      surDeplacementElementSurLigne(aParamsLigneDestination, aParamsSource) {
        return false;
      }
      getEtatSurEdition(aParams) {
        return Enumere_Etat_1.EGenreEtat.Modification;
      }
      editionConfirmation(aParams) {
        return false;
      }
      suppressionImpossible(D, aListeSelections) {
        return false;
      }
      suppressionConfirmation(D, aListeSelections) {
        return true;
      }
      getTri(aColonneDeTri, aGenreTri) {
        return null;
      }
      getVisible(aDonnee) {
        return true;
      }
      getValeur(aParams) {
        if (MethodesObjet_1.MethodesObjet.isFunction(this.options.getValeur)) {
          return this.options.getValeur(aParams);
        }
        return aParams.article ? aParams.article.getLibelle() : '';
      }
      getValeurParDefaut(aParams) {
        return '';
      }
      getWAIIdColonnePourDescription(aParams) {
        return '';
      }
      getWAIInputEdition(aParams) {
        return '';
      }
      getValeurPourTri(aColonne, aArticle) {
        return this.getValeur(
          this.paramsListe.getParams(aColonne, -1, {
            surTri: true,
            article: aArticle,
          }),
        );
      }
      getValeurPourAffichage(aParams) {
        return this.getValeur(aParams);
      }
      getHintHtmlForce(aParams) {
        return '';
      }
      getHintForce(aParams) {
        return '';
      }
      getTypeValeur(aParams) {
        return ObjetDonneesListe.ETypeCellule.Texte;
      }
      getTailleTexteMax(aParams) {
        return 0;
      }
      avecTrimSurEdition(aParams) {
        return this.options.avecTrimSurEdition;
      }
      autoriserChaineVideSurEdition(aParams) {
        return false;
      }
      getCouleurCellule(aParams, aCouleurCellule) {
        return undefined;
      }
      getClassCelluleConteneur(aParams) {
        return '';
      }
      getClass(aParams) {
        return '';
      }
      getStyle(aParams) {
        return '';
      }
      alignVCenter(aParams) {
        return this.options.alignVCenter;
      }
      getPadding(aParams) {
        return false;
      }
      getNiveauDeploiement(aParams) {
        return 1;
      }
      getColonneDeFusion(aParamsCellule) {
        return null;
      }
      fusionCelluleAvecColonnePrecedente(aParams) {
        return false;
      }
      fusionCelluleAvecLignePrecedente(aParamsCellule) {
        return false;
      }
      avecBordureDroite(aParams) {
        return true;
      }
      avecBordureBas(aParams) {
        return true;
      }
      avecBordureHaut(aParams) {
        return false;
      }
      initialiserObjetGraphique(aParams, aInstance) {
        return null;
      }
      setDonneesObjetGraphique(aParams, aInstance) {
        return null;
      }
      avecMultiSelection() {
        return this.options.avecMultiSelection;
      }
      avecMultiSelectionSurCtrl() {
        return this.options.avecMultiSelectionSurCtrl;
      }
      avecMultiSelectionSurShift() {
        return this.options.avecMultiSelectionSurShift;
      }
      estSelectionCibleMiroirDeSelectionSource(
        aParamsCelluleSource,
        aParamsCelluleCible,
      ) {
        return (
          !!aParamsCelluleSource.article.getNumero() &&
          aParamsCelluleSource.article.getNumero() ===
            aParamsCelluleCible.article.getNumero()
        );
      }
      getListeLignesTotal() {
        return null;
      }
      getContenuTotal(aParams) {
        return '';
      }
      getTypeCelluleTotal(aParams) {
        return ObjetDonneesListe.typeCelluleTotal.defaut;
      }
      getStyleTotal(aParams) {
        switch (aParams.typeCellule) {
          case ObjetDonneesListe.typeCelluleTotal.defaut:
            return (
              ObjetStyle_1.GStyle.composeCouleurFond(
                GCouleur.liste.total.fond,
              ) +
              ObjetStyle_1.GStyle.composeCouleurTexte(
                GCouleur.liste.total.texte,
              )
            );
          case ObjetDonneesListe.typeCelluleTotal.fond:
            return ObjetStyle_1.GStyle.composeCouleurTexte(
              GCouleur.liste.texte,
            );
          case ObjetDonneesListe.typeCelluleTotal.editable:
            return ObjetStyle_1.GStyle.composeCouleurFond(
              GCouleur.liste.editable.fond,
            );
          default:
        }
        return '';
      }
      getClassTotal(aParams) {
        return '';
      }
      avecBordureTotalVisible(aParams) {
        return aParams.typeCellule !== ObjetDonneesListe.typeCelluleTotal.fond;
      }
      getColonneDeFusionTotal(aParams) {
        return null;
      }
      avecEvenementSelectionClickTotal(aParams) {
        return false;
      }
      getMessageDoublon(aElement) {
        return aElement && aElement.getLibelle()
          ? ObjetTraduction_1.GTraductions.getValeur('liste.doublonNom', [
              aElement.getLibelle(),
            ])
          : ObjetTraduction_1.GTraductions.getValeur('liste.doublon');
      }
      getMessageCreationImpossible(aErreur) {
        return ObjetTraduction_1.GTraductions.getValeur(
          'liste.creationImpossible',
        );
      }
      getMessageEditionImpossible(aParams, aErreur) {
        return ObjetTraduction_1.GTraductions.getValeur(
          'liste.editionImpossible',
        );
      }
      getMessageEditionConfirmation(aParams) {
        return '';
      }
      getMessageSuppressionImpossible(aDonnee, aListeSelections) {
        return ObjetTraduction_1.GTraductions.getValeur(
          'liste.suppressionImpossible',
        );
      }
      getMessageSuppressionConfirmation(aDonnee, aListeSelections) {
        return ObjetTraduction_1.GTraductions.getValeur(
          'liste.suppressionSelection',
        );
      }
      getMessageTailleMaximaleSaisie() {
        return ObjetTraduction_1.GTraductions.getValeur(
          'liste.tailleMaxSaisie',
        );
      }
      editionRefusee(aParams) {
        const lMessageRefus = this.getMessageEditionRefusee(aParams);
        if (lMessageRefus) {
          const lEstString = typeof lMessageRefus === 'string';
          GApplication.getMessage().afficher({
            titre: lEstString ? '' : lMessageRefus.titre || '',
            message: lEstString ? lMessageRefus : lMessageRefus.message,
          });
          return true;
        }
        return false;
      }
      getMessageEditionRefusee(aParams) {
        return '';
      }
      remplirMenuContextuel(aParametres) {
        if (!aParametres.menuContextuel) {
          return false;
        }
        if (aParametres.surFondListe) {
          return false;
        }
        let lAvecCommandeActive = false;
        let lCommande;
        if (aParametres.avecCreation) {
          lCommande = aParametres.menuContextuel.addCommande(
            Enumere_CommandeMenu_1.EGenreCommandeMenu.Creation,
            ObjetTraduction_1.GTraductions.getValeur('liste.creer'),
            !aParametres.nonEditable,
          );
          if (lCommande.actif) {
            lAvecCommandeActive = true;
          }
        }
        lCommande = aParametres.menuContextuel.addCommande(
          Enumere_CommandeMenu_1.EGenreCommandeMenu.Edition,
          ObjetTraduction_1.GTraductions.getValeur('liste.modifier'),
          !aParametres.nonEditable &&
            (!aParametres.listeSelection ||
              aParametres.listeSelection.count() <= 1) &&
            this.avecEdition(aParametres),
        );
        if (lCommande.actif) {
          lAvecCommandeActive = true;
        }
        lCommande = aParametres.menuContextuel.addCommande(
          Enumere_CommandeMenu_1.EGenreCommandeMenu.Suppression,
          ObjetTraduction_1.GTraductions.getValeur('liste.supprimer'),
          !aParametres.nonEditable &&
            aParametres &&
            aParametres.avecSuppression &&
            this._avecSuppression(aParametres),
        );
        if (lCommande.actif) {
          lAvecCommandeActive = true;
        }
        return lAvecCommandeActive;
      }
      getListeSupprimables(aListeSelections, aParamsCellule) {
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        aListeSelections.parcourir((aElement) => {
          if (this.avecSuppression(aParamsCellule)) {
            lListe.addElement(aElement);
          }
        });
        return lListe;
      }
      initialisationObjetContextuel(aParametres) {
        if (!aParametres.menuContextuel) {
          return;
        }
        const lAvecCommandeActive = this.remplirMenuContextuel(aParametres);
        if (lAvecCommandeActive !== false) {
          aParametres.menuContextuel.setDonnees(aParametres.id);
        }
      }
      evenementMenuContextuel(aParametres) {
        return false;
      }
      enModification(aParams) {
        return true;
      }
      getControleCaracteresInput(aParams) {
        return null;
      }
      _avecSelection(aParams) {
        return this.avecSelection(aParams);
      }
      _avecDeselection(aParams) {
        return this.avecDeselection(aParams);
      }
      _avecSuppression(aParams) {
        if (aParams.listeSelection && aParams.listeSelection.count() > 0) {
          let lAvecSuppression = false;
          aParams.listeSelection.parcourir((aElement) => {
            if (this.avecSuppression(aParams)) {
              lAvecSuppression = true;
              return false;
            }
          });
          return lAvecSuppression;
        }
        return this.avecSuppression(aParams);
      }
      _getVisible(aDonnee, aParams) {
        return this.getVisible(aDonnee);
      }
      _surSelectionLigne(aLigne, aSelectionner) {
        return this.surSelectionLigne(
          aLigne,
          this.Donnees.get(aLigne),
          aSelectionner,
        );
      }
      _surSelection(aColonne, aLigne, aSelectionner) {
        return this.surSelection(
          aColonne,
          this.Donnees.get(aLigne),
          aColonne,
          aSelectionner,
        );
      }
      _getTailleTexteMax(aParams) {
        switch (this.getTypeValeur(aParams)) {
          case ObjetDonneesListe.ETypeCellule.Texte:
          case ObjetDonneesListe.ETypeCellule.ZoneTexte:
            return this.getTailleTexteMax(aParams);
          default:
            return 0;
        }
      }
      estUnDeploiement(aParams) {
        return aParams && aParams.article && aParams.article.estUnDeploiement;
      }
      estUnDeploiementValide(aParams) {
        return (
          this.estUnDeploiement(aParams) &&
          this.avecFilsVisibleDePere(aParams.article)
        );
      }
      _estDeploye(aLigne) {
        return this._articleDeploye(this.Donnees.get(aLigne));
      }
      _initialiserObjetGraphique(aParams, aInstance) {
        return this.initialiserObjetGraphique(aParams, aInstance);
      }
      _setDonneesObjetGraphique(aParams, aInstance) {
        return this.setDonneesObjetGraphique(aParams, aInstance);
      }
      getIndice(aDonnee) {
        for (let J = 0; J < this.getNbrLignes(); J++) {
          if (this.Donnees.get(J) === aDonnee) {
            return J;
          }
        }
        return -1;
      }
      getMessage() {
        return this.Message;
      }
      _getValeur(aParams) {
        const lValeur =
          aParams.ligne === null || aParams.ligne === undefined
            ? this.getValeurParDefaut(aParams)
            : this.getValeur(aParams);
        switch (this.getTypeValeur(aParams)) {
          case ObjetDonneesListe.ETypeCellule.Texte:
            return lValeur;
          case ObjetDonneesListe.ETypeCellule.ZoneTexte:
            return lValeur;
          case ObjetDonneesListe.ETypeCellule.Html:
            return lValeur;
          case ObjetDonneesListe.ETypeCellule.Date:
          case ObjetDonneesListe.ETypeCellule.DateCalendrier:
            return this.getChaineDeDate(lValeur, aParams);
          case ObjetDonneesListe.ETypeCellule.Coche:
            return lValeur;
          case ObjetDonneesListe.ETypeCellule.CocheDeploiement:
            return '';
          case ObjetDonneesListe.ETypeCellule.Icon:
          case ObjetDonneesListe.ETypeCellule.Image:
            return lValeur;
          case ObjetDonneesListe.ETypeCellule.HeureMinute:
            if (MethodesObjet_1.MethodesObjet.isDate(lValeur)) {
              return ObjetDate_1.GDate.formatDate(lValeur, '%hh%sh%mm');
            } else if (MethodesObjet_1.MethodesObjet.isNumber(lValeur)) {
              return UtilitaireDuree_1.TUtilitaireDuree.dureeEnHeuresMinutes(
                lValeur,
              ).toString('%hh%sh%mm');
            }
            return '';
          case ObjetDonneesListe.ETypeCellule.Note: {
            const lOptionsNote = this.getOptionsNote(aParams);
            if (!lValeur) {
              return aParams.surEdition
                ? null
                : lOptionsNote && lOptionsNote.texteSiVide
                  ? lOptionsNote.texteSiVide
                  : '';
            }
            if (lValeur instanceof TypeNote_1.TypeNote) {
              if (aParams.surEdition) {
                return lValeur;
              }
              let lLibelle =
                lOptionsNote && !lOptionsNote.afficherAvecVirgule
                  ? lValeur.getNoteSansDecimaleForcee()
                  : lValeur.getNote();
              if (lOptionsNote && lOptionsNote.avecParenthese) {
                lLibelle = '(' + lLibelle + ')';
              }
              if (lOptionsNote && !!lOptionsNote.suffixe) {
                lLibelle = lLibelle + lOptionsNote.suffixe;
              }
              if (lOptionsNote && lOptionsNote.avecTiret) {
                lLibelle = '-';
              }
              return lLibelle;
            }
          }
        }
        return lValeur;
      }
      _getContenuAffichage(aParams) {
        const lVal = this._getValeur(aParams);
        const lContenu = { valeur: '', title: '' };
        if (MethodesObjet_1.MethodesObjet.isString(lVal)) {
          lContenu.valeur = lVal;
        } else if (
          lVal &&
          MethodesObjet_1.MethodesObjet.isObject(lVal) &&
          'libelle' in lVal
        ) {
          const lValFD = lVal;
          lContenu.valeur = lValFD.libelle;
          lContenu.idsLabel = lValFD.idsLabel;
        } else {
          lContenu.valeur = lVal;
        }
        if (!this.enImpression) {
          let lHintForce = this.getHintHtmlForce(aParams);
          if (lHintForce) {
            lContenu.titleHtml = lHintForce;
          } else {
            lHintForce = this.getHintForce(aParams);
            if (lHintForce) {
              lContenu.title = lHintForce;
            }
          }
        }
        if (aParams.avecContenuTronque) {
          switch (aParams.typeValeur) {
            case ObjetDonneesListe.ETypeCellule.Texte:
            case ObjetDonneesListe.ETypeCellule.ZoneTexte: {
              const lChaineAffichage = this.getValeurPourAffichage(aParams);
              lContenu.valeur = lChaineAffichage;
              if (
                !this.enImpression &&
                !lContenu.titleHtml &&
                !lContenu.title
              ) {
                lContenu.attrOverflow = this.options.avecEllipsisContenuTronque
                  ? 'ie-ellipsis'
                  : 'ie-hintoverflow';
              }
            }
          }
        }
        lContenu.valeur = ObjetChaine_1.GChaine.avecEspaceSiVide(
          lContenu.valeur + '',
        );
        if (aParams.typeValeur !== ObjetDonneesListe.ETypeCellule.Html) {
          lContenu.valeur = lContenu.valeur
            .replace(/\r\n/g, '<br>')
            .replace(/\n/g, '<br>');
        }
        return lContenu;
      }
      getOptionsNote(aParams) {
        return { afficherAvecVirgule: true, hintSurErreur: false };
      }
      getValeurPourParsing(aParams) {
        return this._getValeur(aParams);
      }
      getChaineDeDate(aDate, aParams) {
        return MethodesObjet_1.MethodesObjet.isDate(aDate)
          ? ObjetDate_1.GDate.formatDate(aDate, '%JJ/%MM/%AA')
          : '';
      }
      setValeur(aParams) {
        switch (this.getTypeValeur(aParams)) {
          case ObjetDonneesListe.ETypeCellule.Texte:
          case ObjetDonneesListe.ETypeCellule.ZoneTexte:
          case ObjetDonneesListe.ETypeCellule.Html:
            return aParams.valeur;
          case ObjetDonneesListe.ETypeCellule.Date:
          case ObjetDonneesListe.ETypeCellule.DateCalendrier: {
            if (aParams.valeur === null || aParams.valeur === undefined) {
              return '';
            }
            const lValeur = aParams.valeur.split('/');
            if (lValeur[2].length === 2) {
              lValeur[2] = '20' + lValeur[2];
            }
            const lDate = new Date(
              parseInt(lValeur[2]),
              parseInt(lValeur[1]) - 1,
              parseInt(lValeur[0]),
            );
            if (!isNaN(lDate) && lValeur[0].charAt(0) === '0') {
              lValeur[0] = lValeur[0].charAt(1);
            }
            return isNaN(lDate) ||
              !(
                lDate.getFullYear() === parseInt(lValeur[2]) &&
                lDate.getMonth() === parseInt(lValeur[1]) - 1 &&
                lDate.getDate() === parseInt(lValeur[0])
              )
              ? null
              : lDate;
          }
          case ObjetDonneesListe.ETypeCellule.Coche: {
            const lValeur = this.getValeur(aParams);
            if (lValeur === ObjetDonneesListe.EGenreCoche.Verte) {
              return ObjetDonneesListe.EGenreCoche.Aucune;
            }
            if (lValeur === ObjetDonneesListe.EGenreCoche.Grise) {
              return ObjetDonneesListe.EGenreCoche.Verte;
            }
            if (
              lValeur === ObjetDonneesListe.EGenreCoche.Aucune ||
              lValeur === undefined
            ) {
              return ObjetDonneesListe.EGenreCoche.Verte;
            }
            return ObjetDonneesListe.EGenreCoche.Aucune;
          }
          case ObjetDonneesListe.ETypeCellule.HeureMinute: {
            const lHeureMinute = ObjetDate_1.GDate.parseHeureMinute(
              aParams.valeur,
            );
            return lHeureMinute && lHeureMinute.ok ? lHeureMinute : null;
          }
        }
        return aParams.valeur;
      }
      getMessageFormat(aParams) {
        switch (this.getTypeValeur(aParams)) {
          case ObjetDonneesListe.ETypeCellule.Date:
          case ObjetDonneesListe.ETypeCellule.DateCalendrier:
            return ObjetTraduction_1.GTraductions.getValeur('liste.erreurDate');
          case ObjetDonneesListe.ETypeCellule.HeureMinute: {
            const lBorneDebut =
                '0' +
                ObjetTraduction_1.GTraductions.getValeur(
                  'date.separateurHeure',
                ) +
                '00',
              lBorneFin =
                '24' +
                ObjetTraduction_1.GTraductions.getValeur(
                  'date.separateurHeure',
                ) +
                '00';
            return ObjetChaine_1.GChaine.format(
              ObjetTraduction_1.GTraductions.getValeur(
                'liste.erreurHeureMinute',
              ),
              [lBorneDebut, lBorneFin],
            );
          }
        }
        return null;
      }
      estUnDoublon(aDonnee) {
        if (this._indexsUnique && this._indexsUnique.existeIndex()) {
          const lNb = this.getNbrLignes();
          for (let J = 0; J < lNb; J++) {
            const lDonnee = this.Donnees.get(J);
            if (
              lDonnee !== aDonnee &&
              lDonnee.getEtat() !== Enumere_Etat_1.EGenreEtat.Suppression
            ) {
              if (this._indexsUnique.estDoublon(aDonnee, lDonnee)) {
                return true;
              }
            }
          }
        }
        return false;
      }
      _surCreation(aListeValeurs, aLigneCreation, aParams) {
        function _creerElement() {
          const lDonnee = new ObjetElement_1.ObjetElement();
          lDonnee.Numero = ObjetElement_1.ObjetElement.getNumeroCreation();
          return lDonnee;
        }
        function _ajouterElement(aElement, aLigne) {
          if (!this.estUnDoublon(aElement)) {
            aElement.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
            this.Donnees.addElement(aElement);
            this.trier();
            aLigne = this.getIndice(aElement);
          } else {
            this.Message = this.getMessageDoublon(aElement);
          }
          return aLigne;
        }
        this.Message = null;
        let lResult = -1;
        let lErreur_Format = -1;
        const lListeValeurs = [];
        let lParams;
        lListeValeurs[-1] = aListeValeurs[-1];
        lListeValeurs.data = aListeValeurs.data;
        for (let I = 0; I < aListeValeurs.length; I++) {
          if (aListeValeurs[I] !== null && aListeValeurs[I] !== undefined) {
            lParams = Object.assign(aParams, {
              colonne: I,
              ligne: -1,
              valeur: aListeValeurs[I],
            });
            lListeValeurs[I] = this.setValeur(lParams);
            if (lListeValeurs[I] === null || lListeValeurs[I] === undefined) {
              lErreur_Format = I;
            }
          }
        }
        if (lErreur_Format === -1) {
          const lAvecCreationDynamique = this.avecCreationElementsDynamique(
            lListeValeurs,
            aLigneCreation,
          );
          let lDonneeCreation;
          if (lAvecCreationDynamique) {
            lDonneeCreation = new ObjetListeElements_1.ObjetListeElements();
          } else {
            lDonneeCreation = _creerElement();
          }
          const lErreur = this.surCreation(
            lDonneeCreation,
            lListeValeurs,
            aLigneCreation,
          );
          if (lErreur === null || lErreur === undefined) {
            if (
              lAvecCreationDynamique &&
              lDonneeCreation instanceof ObjetListeElements_1.ObjetListeElements
            ) {
              if (lDonneeCreation.count() === 0) {
                this.Message = this.getMessageCreationImpossible(lErreur);
              } else {
                lDonneeCreation.parcourir((aElement) => {
                  lResult = _ajouterElement.call(this, aElement, lResult);
                });
              }
            } else {
              lResult = _ajouterElement.call(this, lDonneeCreation, lResult);
            }
          } else {
            this.Message = this.getMessageCreationImpossible(lErreur);
          }
        } else {
          lParams = this.paramsListe.getParams(lErreur_Format, lResult);
          this.Message = this.getMessageFormat(Object.assign(aParams, lParams));
        }
        return lResult;
      }
      _surEdition(aParams) {
        this.Message = null;
        const lValeur = this.setValeur(aParams);
        if (lValeur !== null && lValeur !== undefined) {
          const lValeurPrecedente = this.getValeur(aParams);
          const lErreur = this.surEdition(aParams, lValeur);
          const lSurEdition_after = (aParams, aError) => {
            if (aError === null || aError === undefined) {
              if (!this.estUnDoublon(aParams.article)) {
                if (this.enModification(aParams)) {
                  aParams.article.setEtat(this.getEtatSurEdition(aParams));
                }
                if (!aParams.sansTriDonnees) {
                  this.trier();
                }
                aParams.ligne = this.getIndice(aParams.article);
              } else {
                this.Message = this.getMessageDoublon(aParams.article);
                aParams.valeur = lValeurPrecedente;
                this.surEdition(aParams, lValeurPrecedente);
              }
            } else {
              this.Message = this.getMessageEditionImpossible(aParams, aError);
              aParams.valeur = lValeurPrecedente;
              this.surEdition(aParams, lValeurPrecedente);
            }
          };
          if (lErreur && lErreur instanceof Promise) {
            return lErreur.then((aError) => {
              if (aError && aError.annulerEdition) {
                aParams.valeur = lValeurPrecedente;
                return aError;
              }
              lSurEdition_after(aParams, aError);
            });
          } else {
            lSurEdition_after(aParams, lErreur);
          }
        } else {
          this.Message = this.getMessageFormat(aParams);
        }
      }
      _editionConfirmation(aParams) {
        this.Message = null;
        if (this.editionConfirmation(aParams)) {
          this.Message = this.getMessageEditionConfirmation(aParams);
          return true;
        }
      }
      _surSuppression(aLigne, aListeSuppressions) {
        if (aListeSuppressions && aListeSuppressions.parcourir) {
          aListeSuppressions.parcourir((aElement) => {
            this.surSuppression(aElement);
          });
        } else {
          const lDonnee = this.Donnees.get(aLigne);
          this.surSuppression(lDonnee);
        }
        this.trier();
        return -1;
      }
      _suppressionImpossible(aLigne, aListeSelections) {
        this.Message = null;
        const lDonnee = this.Donnees.get(aLigne);
        if (this.suppressionImpossible(lDonnee, aListeSelections)) {
          this.Message = this.getMessageSuppressionImpossible(
            lDonnee,
            aListeSelections,
          );
          return true;
        }
      }
      _suppressionConfirmation(aLigne, aListeSelections) {
        this.Message = null;
        const lDonnee = this.Donnees.get(aLigne);
        if (this.suppressionConfirmation(lDonnee, aListeSelections)) {
          this.Message = this.getMessageSuppressionConfirmation(
            lDonnee,
            aListeSelections,
          );
          return !!this.Message;
        }
      }
      estVisible(aLigne, aParams) {
        return this._estDonneesVisible(this.Donnees.get(aLigne), aParams);
      }
      trier() {
        if (this.avecTri() && this.Donnees) {
          const lColonne = this.triCourant
            ? this.triCourant.colonne.length === 1
              ? this.triCourant.colonne[0]
              : this.triCourant.colonne
            : null;
          const lGenre = this.triCourant
            ? this.triCourant.genre.length === 1
              ? this.triCourant.genre[0]
              : this.triCourant.genre
            : null;
          const lTri = this.getTri(lColonne, lGenre);
          if (lTri) {
            this.Donnees.setTri(lTri);
          }
          this.Donnees.trier();
        }
      }
      getNbrLignes() {
        return this.Donnees ? this.Donnees.count() : 0;
      }
      creerIndexUnique(aChamps) {
        if (!this._indexsUnique) {
          this._indexsUnique = new ObjetIndexsUnique_1.ObjetIndexsUnique();
        }
        this._indexsUnique.ajouterIndex(aChamps);
      }
      calculCacheListeFilsDirectsDePere() {
        this.mapPereFils = new Map();
        this.Donnees.parcourir((aArticle, aIndex) => {
          if (aArticle) {
            if (!this.mapPereFils.has(aArticle)) {
              this.mapPereFils.set(aArticle, []);
            }
            if (aArticle.pere) {
              if (!this.mapPereFils.has(aArticle.pere)) {
                this.mapPereFils.set(aArticle.pere, []);
              }
              let lParamsFils = this.mapPereFils.get(aArticle.pere);
              lParamsFils.push({ ligne: aIndex, article: aArticle });
            }
          }
        });
      }
      avecFilsVisibleDePere(aArticlePere) {
        return this._getArrayFilsVisiblesDePere(aArticlePere, true).length > 0;
      }
      getArrayFilsVisiblesDePere(aArticlePere) {
        return this._getArrayFilsVisiblesDePere(aArticlePere, false);
      }
      _getArrayFilsVisiblesDePere(aArticlePere, aArretSurPremierFils) {
        let lResult;
        if (aArticlePere) {
          if (!this.mapPereFils) {
            this.calculCacheListeFilsDirectsDePere();
          }
          const lResultTous = this.mapPereFils.get(aArticlePere);
          if (lResultTous) {
            lResult = [];
            lResultTous.every((aFils) => {
              if (this._getVisible(aFils.article)) {
                lResult.push(aFils);
                if (aArretSurPremierFils) {
                  return false;
                }
              }
              return true;
            });
            return lResult;
          }
        }
        lResult = [];
        this.Donnees.parcourir((aArticle, aIndex) => {
          if (
            ((!aArticlePere && !aArticle.pere) ||
              aArticle.pere === aArticlePere) &&
            this._getVisible(aArticle)
          ) {
            lResult.push({ article: this.Donnees.get(aIndex), ligne: aIndex });
            if (aArretSurPremierFils) {
              return false;
            }
          }
        });
        return lResult;
      }
      _getEtatCocheSimple(aParams) {
        return this._getValeur(aParams);
      }
      getEtatCocheSelonFils(
        aElementPere,
        aParams,
        aMethodeAvecEdition,
        aPourCocheTout,
      ) {
        if (
          aElementPere &&
          (!aElementPere.estUnDeploiement ||
            !this.estCocheSelonFilsSurLigneDeploiement(aElementPere))
        ) {
          return this._getEtatCocheSimple(aParams);
        }
        let lEtat = ObjetDonneesListe.EGenreCoche.Aucune,
          lInit = false;
        let lArrayParcours = [];
        if (aPourCocheTout) {
          this.Donnees.parcourir((aArticle, aIndex) => {
            if (this._getVisible(aArticle)) {
              lArrayParcours.push({ article: aArticle, ligne: aIndex });
            }
          });
        } else {
          lArrayParcours = this.getArrayFilsVisiblesDePere(aElementPere);
        }
        lArrayParcours.every((aElementParcours) => {
          const lParams = Object.assign({}, aParams, aElementParcours, {
            pourCocheTout: !!aPourCocheTout,
          });
          if (
            (aMethodeAvecEdition &&
              MethodesObjet_1.MethodesObjet.isFunction(aMethodeAvecEdition) &&
              aMethodeAvecEdition(lParams)) ||
            this.avecEdition(lParams)
          ) {
            if (this.estCocheSelonFilsSurLigneDeploiement(lParams.article)) {
              const lEtatFils = this.getEtatCocheSelonFils(
                lParams.article,
                lParams,
                aMethodeAvecEdition,
              );
              if (
                lEtatFils === ObjetDonneesListe.EGenreCoche.Verte &&
                lEtat === ObjetDonneesListe.EGenreCoche.Aucune
              ) {
                lEtat = lInit
                  ? ObjetDonneesListe.EGenreCoche.Grise
                  : ObjetDonneesListe.EGenreCoche.Verte;
              } else if (lEtatFils === ObjetDonneesListe.EGenreCoche.Grise) {
                lEtat = ObjetDonneesListe.EGenreCoche.Grise;
              } else if (
                lEtatFils === ObjetDonneesListe.EGenreCoche.Aucune &&
                lEtat === ObjetDonneesListe.EGenreCoche.Verte
              ) {
                lEtat = ObjetDonneesListe.EGenreCoche.Grise;
              }
            } else {
              const lValeur = this._getEtatCocheSimple(lParams);
              if (
                (!lValeur ||
                  lValeur === ObjetDonneesListe.EGenreCoche.Aucune) &&
                lEtat === ObjetDonneesListe.EGenreCoche.Verte
              ) {
                lEtat = ObjetDonneesListe.EGenreCoche.Grise;
              }
              if (
                (lValeur === true ||
                  lValeur === ObjetDonneesListe.EGenreCoche.Verte) &&
                lEtat === ObjetDonneesListe.EGenreCoche.Aucune
              ) {
                lEtat = lInit
                  ? ObjetDonneesListe.EGenreCoche.Grise
                  : ObjetDonneesListe.EGenreCoche.Verte;
              }
            }
            if (lEtat === ObjetDonneesListe.EGenreCoche.Grise) {
              return false;
            }
            lInit = true;
          }
          return true;
        });
        return lEtat;
      }
      estCocheSelonFilsSurLigneDeploiement(aArticle) {
        return true;
      }
      getTableauLignesModifieesCocheTitre(aColonne, aValeur) {
        const T = [];
        const lNb = this.Donnees.count();
        for (let i = 0; i < lNb; i++) {
          if (this._getVisible(this.Donnees.get(i))) {
            T.push(i);
          }
        }
        return T;
      }
      surEditionCocheTitre(aListeParamsCellule, aValeur) {
        if (!!aListeParamsCellule) {
          for (let i = 0; i < aListeParamsCellule.length; i++) {
            const lErreur = this.surEdition(aListeParamsCellule[i], aValeur);
            if (lErreur === null || lErreur === undefined) {
              if (this.enModification(aListeParamsCellule[i])) {
                aListeParamsCellule[i].article.setEtat(
                  this.getEtatSurEdition(aListeParamsCellule[i]),
                );
              }
            }
          }
        }
        return null;
      }
      rechercheTexteForcerLignePrecSuivVisible(
        aParamsLigneVisible,
        aParamsLignePrecSuivCachee,
      ) {
        return false;
      }
      getId(aNumeroColonne) {
        return this.paramsListe.getIdsColonnes()[aNumeroColonne];
      }
      getNumeroColonneDId(aId) {
        return this.paramsListe.getIdsColonnes().indexOf(aId);
      }
      avecSurvolCelluleVisible(aParams) {
        return this.options.avecSurvolCelluleVisible;
      }
      estConcerneParSurvolCelluleVisible(aParams, aParamsCelluleHover) {
        if (aParams.ligne < 0) {
          return false;
        }
        if (
          this.selectionParCellule(
            aParamsCelluleHover.colonne,
            aParamsCelluleHover.article,
          )
        ) {
          return (
            aParamsCelluleHover.ligne === aParams.ligne &&
            aParamsCelluleHover.colonne === aParams.colonne
          );
        }
        if (aParams.ligne >= 0 && aParams.ligne === aParamsCelluleHover.ligne) {
          return true;
        }
        if (
          this.options.avecMultiSelectionSurLigneFusion &&
          aParams.ligne >= 0 &&
          aParamsCelluleHover.ligne >= 0 &&
          aParams.ligne !== aParamsCelluleHover.ligne
        ) {
          const lFusionHover =
            this.lignesFusionParColonne[
              aParamsCelluleHover.colonne + '_' + aParamsCelluleHover.ligne
            ];
          if (
            lFusionHover &&
            lFusionHover.lignesCumuls &&
            lFusionHover.lignesCumuls[aParams.ligne]
          ) {
            return true;
          }
          const lFusionCourant =
            this.lignesFusionParColonne[aParams.colonne + '_' + aParams.ligne];
          if (
            lFusionCourant &&
            lFusionCourant.lignesCumuls &&
            lFusionCourant.lignesCumuls[aParamsCelluleHover.ligne]
          ) {
            return true;
          }
        }
        return false;
      }
      avecDessinHover(aParams) {
        return false;
      }
      estConcerneParDessinHover(aParams, aParamsCelluleHover) {
        return false;
      }
      construireHtmlHover(aParams) {
        if (!aParams.node) {
          return '';
        }
        const H = [];
        const lHeight = 22;
        const lWidthCorpsFleche = 10;
        const lWidthPointeFleche = 11;
        const lHeightCorpsFleche = 10;
        const lWidth = lWidthCorpsFleche + lWidthPointeFleche;
        const lCouleurBord = 'white';
        const lCouleur = GCouleur.selection.fond;
        let lStyle = '';
        switch (aParams.direction) {
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.droite:
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.gauche:
            lStyle +=
              'top:' +
              Math.round($(aParams.node).height() / 2 - lHeight / 2) +
              'px;';
            break;
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.haut:
            lStyle += 'top:0px;';
            break;
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.bas:
            lStyle += 'bottom:0px;';
            break;
        }
        switch (aParams.direction) {
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.droite:
            lStyle += 'left: -' + (lWidth + 1) + 'px;';
            break;
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.gauche:
            lStyle += 'right: -' + (lWidth + 1) + 'px;';
            break;
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.haut:
          case ObjetDonneesListe.TypeDirectionElementSurvolCellule.bas:
            lStyle +=
              'left:' +
              Math.round($(aParams.node).width() / 2 - lWidth / 2) +
              'px;';
            break;
        }
        H.push(
          '<div class="',
          aParams.classHover,
          ' dessinHoverListe_',
          aParams.direction,
          '" style="',
          lStyle,
          '">',
        );
        H.push(
          '<svg xmlns="http://www.w3.org/2000/svg" width="',
          lWidth + 1,
          '" height="',
          lHeight + 1,
          '">',
          ObjetChaine_1.GChaine.format(
            '<line x1="0" y1="%0:s" x2="%1:s" y2="%0:s" stroke="%3:s" stroke-width="%2:s" />',
            [lHeight / 2, lWidthCorpsFleche, lHeightCorpsFleche, lCouleurBord],
          ),
          ObjetChaine_1.GChaine.format(
            '<polygon points="%2:s 0, %3:s %1:s, %2:s %0:s" fill="%4:s" stroke-width="1" stroke="%5:s"/>',
            [
              lHeight,
              lHeight / 2,
              lWidthCorpsFleche,
              lWidth,
              lCouleur,
              lCouleurBord,
            ],
          ),
          ObjetChaine_1.GChaine.format(
            '<line x1="1" y1="%0:s" x2="%1:s" y2="%0:s" stroke="%3:s" stroke-width="%2:s" />',
            [
              lHeight / 2,
              lWidthCorpsFleche + 1,
              lHeightCorpsFleche - 2,
              lCouleur,
            ],
          ),
          '</svg>',
        );
        H.push('</div>');
        if (
          aParams.direction ===
            ObjetDonneesListe.TypeDirectionElementSurvolCellule.droite ||
          aParams.direction ===
            ObjetDonneesListe.TypeDirectionElementSurvolCellule.gauche
        ) {
          H.push(
            '<div class="' +
              aParams.classHover +
              ' dessinHoverListe_cadre"></div>',
          );
        }
        return H.join('');
      }
      estCelluleCopie(aParams) {
        return false;
      }
      surCopier(aParams) {
        return false;
      }
      surColler(aParams) {
        return false;
      }
      getHauteurMinCellule(aParams) {
        return this.options.hauteurMinCellule;
      }
      getHauteurMinContenuCellule(aParams) {
        return this.options.hauteurMinContenuCellule;
      }
      getParametresSelectionnerCelluleSuivanteFinEdition(aParams) {
        return {
          orientationVerticale: true,
          avecCelluleEditable: true,
          entrerEdition: true,
          avecSelection: true,
        };
      }
      setTriCourantDeListe(aTri) {
        this.triCourant = aTri;
      }
      _getClassCelluleConteneur(aParams) {
        return this.getClassCelluleConteneur(aParams);
      }
      _setParamsListe(aParams) {
        Object.assign(this.paramsListe, aParams);
        return this;
      }
      actualiserListe(aParamsActualiser) {
        this.paramsListe.actualiserListe(aParamsActualiser);
      }
      _estDonneesVisible(aDonnees, aParams) {
        if (!aDonnees) {
          return false;
        }
        if (
          aDonnees.pere &&
          this.avecDeploiement() &&
          (this._articleDeploye(aDonnees.pere) === false ||
            !this._estDonneesVisible(aDonnees.pere))
        ) {
          return false;
        }
        if (
          aDonnees.getEtat() === Enumere_Etat_1.EGenreEtat.Suppression ||
          !this._getVisible(aDonnees, aParams)
        ) {
          return false;
        }
        return true;
      }
      _articleDeploye(aArticle) {
        if (
          this.options.ignorerDeploiementSurRechercheTexte &&
          (this.enConstruction_cacheRechercheTexte ||
            this.paramsListe.avecRechercheTexteEnCours)
        ) {
          return true;
        }
        return !!(aArticle && aArticle.estDeploye !== false);
      }
    }
    exports.ObjetDonneesListe = ObjetDonneesListe;
    ObjetDonneesListe.hauteurMinCellule = 40;
    ObjetDonneesListe.EGenreCoche = { Verte: true, Grise: null, Aucune: false };
    (function (ObjetDonneesListe) {
      let ECouleurCellule;
      (function (ECouleurCellule) {
        ECouleurCellule[(ECouleurCellule['Blanc'] = 0)] = 'Blanc';
        ECouleurCellule[(ECouleurCellule['Gris'] = 1)] = 'Gris';
        ECouleurCellule[(ECouleurCellule['Deploiement'] = 2)] = 'Deploiement';
        ECouleurCellule[(ECouleurCellule['Fixe'] = 3)] = 'Fixe';
        ECouleurCellule[(ECouleurCellule['Total'] = 4)] = 'Total';
      })(
        (ECouleurCellule =
          ObjetDonneesListe.ECouleurCellule ||
          (ObjetDonneesListe.ECouleurCellule = {})),
      );
      let TypeDirectionElementSurvolCellule;
      (function (TypeDirectionElementSurvolCellule) {
        TypeDirectionElementSurvolCellule['haut'] = 'haut';
        TypeDirectionElementSurvolCellule['bas'] = 'bas';
        TypeDirectionElementSurvolCellule['gauche'] = 'gauche';
        TypeDirectionElementSurvolCellule['droite'] = 'droite';
      })(
        (TypeDirectionElementSurvolCellule =
          ObjetDonneesListe.TypeDirectionElementSurvolCellule ||
          (ObjetDonneesListe.TypeDirectionElementSurvolCellule = {})),
      );
      let ETypeCellule;
      (function (ETypeCellule) {
        ETypeCellule[(ETypeCellule['Texte'] = 0)] = 'Texte';
        ETypeCellule[(ETypeCellule['ZoneTexte'] = 1)] = 'ZoneTexte';
        ETypeCellule[(ETypeCellule['Html'] = 2)] = 'Html';
        ETypeCellule[(ETypeCellule['Date'] = 3)] = 'Date';
        ETypeCellule[(ETypeCellule['Note'] = 4)] = 'Note';
        ETypeCellule[(ETypeCellule['Coche'] = 5)] = 'Coche';
        ETypeCellule[(ETypeCellule['CocheDeploiement'] = 6)] =
          'CocheDeploiement';
        ETypeCellule[(ETypeCellule['Image'] = 7)] = 'Image';
        ETypeCellule[(ETypeCellule['Icon'] = 8)] = 'Icon';
        ETypeCellule[(ETypeCellule['DateCalendrier'] = 9)] = 'DateCalendrier';
        ETypeCellule[(ETypeCellule['HeureMinute'] = 10)] = 'HeureMinute';
      })(
        (ETypeCellule =
          ObjetDonneesListe.ETypeCellule ||
          (ObjetDonneesListe.ETypeCellule = {})),
      );
      let typeCelluleTotal;
      (function (typeCelluleTotal) {
        typeCelluleTotal['defaut'] = 'defaut';
        typeCelluleTotal['fond'] = 'fond';
        typeCelluleTotal['editable'] = 'editable';
      })(
        (typeCelluleTotal =
          ObjetDonneesListe.typeCelluleTotal ||
          (ObjetDonneesListe.typeCelluleTotal = {})),
      );
    })(
      ObjetDonneesListe || (exports.ObjetDonneesListe = ObjetDonneesListe = {}),
    );
  },
  fn: 'objetdonneesliste.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeFusionTitreListe = void 0;
    var TypeFusionTitreListe;
    (function (TypeFusionTitreListe) {
      TypeFusionTitreListe[(TypeFusionTitreListe['FusionGauche'] = 1)] =
        'FusionGauche';
      TypeFusionTitreListe[(TypeFusionTitreListe['FusionHaute'] = 2)] =
        'FusionHaute';
    })(
      TypeFusionTitreListe ||
        (exports.TypeFusionTitreListe = TypeFusionTitreListe = {}),
    );
  },
  fn: 'typefusiontitreliste.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilsInputNoteGetMinMax = UtilsInputNoteGetMinMax;
    exports.UtilsInputNoteInitOptions = UtilsInputNoteInitOptions;
    const ObjetTraduction_1 = require('ObjetTraduction');
    const MethodesObjet_1 = require('MethodesObjet');
    function UtilsInputNoteGetMinMax(aMinMax) {
      let lValeurMin;
      if (MethodesObjet_1.MethodesObjet.isFunction(aMinMax)) {
        lValeurMin = aMinMax();
      } else {
        lValeurMin = aMinMax;
      }
      return lValeurMin;
    }
    function UtilsInputNoteInitOptions() {
      return {
        avecVirgule: true,
        afficherAvecVirgule: true,
        avecAnnotation: true,
        listeAnnotations: null,
        sansNotePossible: true,
        min: 0,
        max: 100,
        selectionSurFocus: true,
        textAlign: 'right',
        hintSurErreur: false,
        titreMessageMinMax: '',
        messageMinMax:
          ObjetTraduction_1.GTraductions.getValeur('InputNote.MinMax'),
        maxLength: 15,
        avecSigneMoins: false,
        htmlContexte: '',
      };
    }
  },
  fn: 'utilsinputnote_espacemobile.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const IEHtml = require('IEHtml');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetHint_1 = require('ObjetHint');
    const TypeNote_1 = require('TypeNote');
    const UtilsInputNote_EspaceMobile_1 = require('UtilsInputNote_EspaceMobile');
    IEHtml.addBalise('ie-inputnote', (aContexteCourant, aOutils) => {
      let lJInput,
        lRacine,
        lContexteCourant,
        lEnFocus = false,
        lNomModele = aOutils.getModel(aContexteCourant),
        lOptions = (0,
        UtilsInputNote_EspaceMobile_1.UtilsInputNoteInitOptions)(),
        lValueInput = null;
      lJInput = $(
        IE.jsx.str('input', { type: 'text', 'ie-model': 'inputNote' }),
      );
      lRacine = lJInput.get(0);
      lJInput.ieData(aContexteCourant.data);
      aOutils.copyAttributs(aContexteCourant.node, lRacine, (aName) => {
        return aName !== 'type';
      });
      aOutils.replaceNode(aContexteCourant.node, lRacine);
      aOutils.addCommentaireDebug(lRacine, 'ie-inputnote');
      if (lNomModele) {
        aOutils.surNodeEtNodeAfter(aContexteCourant);
        aContexteCourant.node = lRacine;
        lContexteCourant = Object.assign({}, aContexteCourant);
        lContexteCourant.ignorerCommentaires = true;
        const lGetOptions = aOutils.getAccesParametresModel(
            'getOptionsNote',
            aContexteCourant,
          ),
          lGetNote = aOutils.getAccesParametresModel(
            'getNote',
            aContexteCourant,
          ),
          lSetNote = aOutils.getAccesParametresModel(
            'setNote',
            aContexteCourant,
          ),
          lGetDisabled = aOutils.getAccesParametresModel(
            'getDisabled',
            aContexteCourant,
          );
        if (lGetOptions.estFonction) {
          Object.assign(lOptions, lGetOptions.callback());
        }
        if (!lOptions.avecVirgule) {
          lOptions.afficherAvecVirgule = false;
        }
        if (lOptions.textAlign) {
          $(lRacine).css('text-align', lOptions.textAlign);
        }
        if (lGetNote.estFonction && lSetNote.estFonction) {
          let lDeclencherExitChange = false;
          lContexteCourant.controleur = Object.assign(
            {
              inputNote: {
                getValue: function () {
                  let lNote,
                    lValueTemp = lValueInput;
                  if (lValueTemp === null) {
                    lNote = lGetNote.callback();
                    if (lNote) {
                      const lValeurMin = (0,
                      UtilsInputNote_EspaceMobile_1.UtilsInputNoteGetMinMax)(
                        lOptions.min,
                      );
                      const lValeurMax = (0,
                      UtilsInputNote_EspaceMobile_1.UtilsInputNoteGetMinMax)(
                        lOptions.max,
                      );
                      if (
                        !lNote.estUneNoteValide ||
                        !lNote.estUneNoteValide(
                          new TypeNote_1.TypeNote(lValeurMin),
                          new TypeNote_1.TypeNote(lValeurMax),
                          true,
                          true,
                        )
                      ) {
                        lValueTemp = '';
                      } else {
                        lValueTemp = lNote.getNote();
                      }
                    }
                  }
                  if (
                    lValueTemp &&
                    (!lOptions.avecVirgule ||
                      (!lOptions.afficherAvecVirgule && !lEnFocus))
                  ) {
                    lNote = new TypeNote_1.TypeNote(lValueTemp);
                    return lNote.getNoteSansDecimaleForcee();
                  }
                  return lValueTemp === null ? '' : lValueTemp;
                },
                interrompreEvent: function (aEvent) {
                  if (aEvent.type === 'keypress') {
                    let lValeurMin = (0,
                    UtilsInputNote_EspaceMobile_1.UtilsInputNoteGetMinMax)(
                      lOptions.min,
                    );
                    const lAnnotations = lOptions.listeAnnotations
                      ? new TypeNote_1.TypeNote().getCaractereAnnotation(
                          lOptions.listeAnnotations,
                        )
                      : undefined;
                    if (
                      !TypeNote_1.TypeNote.estCaractereNote(
                        String.fromCharCode(aEvent.which),
                        lOptions.avecAnnotation,
                        lOptions.avecVirgule,
                        lValeurMin < 0,
                        lAnnotations,
                      )
                    ) {
                      return true;
                    }
                    if (lOptions.avecAnnotation) {
                      const lChaineAnnotation =
                        new TypeNote_1.TypeNote().getChaineAnnotationDeCaractere(
                          GNavigateur.CaractereTouche,
                        );
                      if (lChaineAnnotation) {
                        const lEstAutorisee =
                          TypeNote_1.TypeNote.estAnnotationPermise(
                            TypeNote_1.TypeNote.getGenreAnnotationDeRaccourci(
                              GNavigateur.CaractereTouche,
                            ),
                          );
                        if (lEstAutorisee) {
                          this.node.value = lChaineAnnotation;
                        }
                        return true;
                      }
                    }
                  }
                },
                setValue: function (aValue, aParametres) {
                  lDeclencherExitChange = true;
                  if (lOptions.maxLength > 0 && aValue && aValue.substring) {
                    aValue = aValue.substring(0, lOptions.maxLength - 1);
                  }
                  if (lOptions.avecAnnotation && aValue.length === 1) {
                    const lChaineAnnotation =
                      new TypeNote_1.TypeNote().getChaineAnnotationDeCaractere(
                        aValue[0],
                      );
                    if (lChaineAnnotation) {
                      lValueInput = lChaineAnnotation;
                      aParametres.selectionTexte = true;
                      return;
                    }
                  }
                  const lNote = TypeNote_1.TypeNote.formatStrToNote(
                    aValue,
                    lOptions,
                  );
                  if (lNote || aValue === '') {
                    lValueInput = aValue;
                    if (lNote && lNote.getGenre() > 0) {
                      aParametres.selectionTexte = true;
                    }
                  }
                },
                exitChange: function (aValue, aForceExit) {
                  if (!lDeclencherExitChange) {
                    return;
                  }
                  lDeclencherExitChange = false;
                  lValueInput = null;
                  const lResultValidation = TypeNote_1.TypeNote.validerNote(
                    aValue,
                    lOptions,
                  );
                  if (aForceExit) {
                    aForceExit.resultValidation = lResultValidation;
                  }
                  if (!lResultValidation.estValide) {
                    if (lOptions.hintSurErreur) {
                      ObjetHint_1.ObjetHint.start(lResultValidation.message, {
                        sansDelai: true,
                        position: {
                          x:
                            ObjetPosition_1.GPosition.getLeft(this.node) +
                            ObjetPosition_1.GPosition.getWidth(this.node) +
                            10,
                          y: ObjetPosition_1.GPosition.getTop(this.node),
                        },
                      });
                    } else {
                      lResultValidation.promiseMessageErreur = new Promise(
                        (aResolve) => {
                          setTimeout(() => {
                            GApplication.getMessage()
                              .afficher({
                                titre: lOptions.titreMessageMinMax,
                                message: lResultValidation.message,
                              })
                              .then(
                                ((aNode) => {
                                  if ($(document).find(aNode).length > 0) {
                                    ObjetHtml_1.GHtml.setFocus(aNode);
                                    aNode.select();
                                  }
                                  aResolve();
                                }).bind(this, this.node),
                              );
                          }, 200);
                        },
                      );
                    }
                  } else {
                    lSetNote.callback([lResultValidation.note]);
                  }
                  lContexteCourant.controleur.$refreshSelf();
                },
                node: function () {
                  $(this.node).on({
                    focus: function () {
                      lEnFocus = true;
                      lValueInput = null;
                      lContexteCourant.controleur.$refreshSelf(true);
                      if (lOptions.selectionSurFocus) {
                        this.select();
                      }
                    },
                    focusout: function () {
                      lEnFocus = false;
                      lValueInput = null;
                      if (!lOptions.afficherAvecVirgule) {
                        lContexteCourant.controleur.$refreshSelf();
                      }
                    },
                  });
                },
              },
            },
            aContexteCourant.controleur,
          );
          if (lGetDisabled.estFonction) {
            lContexteCourant.controleur.inputNote.getDisabled = function () {
              return lGetDisabled.callback();
            };
          }
        } else {
        }
        aOutils.gererInputText(lContexteCourant, 'text');
      } else {
      }
      return { node: aContexteCourant.node, ignorerInputText: true };
    });
  },
  fn: 'iehtml.inputnote_espace.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    if (IE.estMobile) {
      require('IEHtml.InputNote_Mobile.js');
    } else {
      require('IEHtml.InputNote_Espace.js');
    }
  },
  fn: 'iehtml.inputnote.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('IEHtml.TextareaMax.css');
    const ObjetStyle_1 = require('ObjetStyle');
    const IEHtml = require('IEHtml');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_2 = require('ObjetStyle');
    const ObjetSupport_1 = require('ObjetSupport');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetChaine_1 = require('ObjetChaine');
    const GUID_1 = require('GUID');
    IEHtml.addBalise('ie-textareamax', (aContexteCourant, aOutils) => {
      var _a;
      const lModele = aOutils.getModel(aContexteCourant);
      const lMap = aOutils.getMapDeNode(aContexteCourant.node);
      let llName;
      let lContexteCourant;
      let H;
      let lMaxLength = 0;
      let lAvecMaxLength = false;
      const lOptions = {
        heightCompteur: '1.4rem',
        pourcentageAvertissement: 0.9,
        couleurFond: GCouleur.nonEditable.fond,
        couleurBordure: GCouleur.bordure,
        couleurTexte: GCouleur.themeNeutre.sombre,
        couleurTexteAvertissement: 'red',
        borduresZoneMax: ObjetStyle_1.EGenreBordure.haut,
        longueurTexte: -1,
        libelleMax_dd: '%d/%d',
        getCompteur: null,
      };
      let lSpeechRecognizer = null;
      let lInRecognition = false;
      let lJSpeechReco = null;
      let lJTextArea = null;
      let lAvecRefreshSelonTaille = null;
      const lFLogSpeech = function (aMsg) {
        let lMsg = aMsg;
        switch (aMsg) {
          case 'no-speech':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.NoSpeech',
            );
            break;
          case 'aborted':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.Aborted',
            );
            break;
          case 'audio-capture':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.AudioCapture',
            );
            break;
          case 'network':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.Network',
            );
            break;
          case 'not-allowed':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.NotAllowed',
            );
            break;
          case 'service-not-allowed':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.ServiceNotAllowed',
            );
            break;
          case 'bad-grammar':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.BadGrammar',
            );
            break;
          case 'language-not-supported':
            lMsg = ObjetTraduction_1.GTraductions.getValeur(
              'SaisieVocale.LanguageNotSupported',
            );
            break;
          default:
            lMsg = aMsg;
        }
        if (!!lMsg) {
          lJSpeechReco
            .children('i')
            .attr('class', 'icon_microphone_off')
            .before(
              '<div style="position:absolute;top:-15px;right:0;">' +
                lMsg +
                '</div>',
            )
            .prev()
            .delay(3000)
            .queue(function () {
              $(this).remove();
            });
        }
        lInRecognition = false;
        aContexteCourant.controleur.$refreshSelf();
      };
      if (!lModele) {
      }
      if (lModele && aContexteCourant.data.$modeleParsed) {
        const lInfosGetOptions = aOutils.getAccesParametresModel(
          'getOptions',
          aContexteCourant,
        );
        if (lInfosGetOptions && lInfosGetOptions.estFonction) {
          Object.assign(lOptions, lInfosGetOptions.callback([lOptions]));
        }
      }
      let lIdMaxLength = '';
      let lHtmlWAIDescr = '';
      let lAvecCompteur = false;
      if (lMap['ie-compteur'] !== undefined) {
        lAvecCompteur = true;
        aOutils.addCommentaireDebug(aContexteCourant.node, 'ie-compteur');
        aContexteCourant.node.removeAttribute('ie-compteur');
        delete lMap['ie-compteur'];
      } else if (lMap.maxlength || lMap['ie-compteurmax']) {
        lAvecCompteur = true;
        lAvecMaxLength = true;
        lMaxLength = parseInt(lMap.maxlength || lMap['ie-compteurmax'], 10);
        if (lMaxLength > 0) {
          lIdMaxLength = GUID_1.GUID.getId();
          lHtmlWAIDescr = IE.jsx.str(
            'span',
            { id: lIdMaxLength, class: 'sr-only', 'aria-hidden': 'true' },
            ObjetTraduction_1.GTraductions.getValeur(
              'XCaracteresMax_D',
              lMaxLength,
            ),
          );
        }
        if (lMap['ie-compteurmax']) {
          aOutils.addCommentaireDebug(
            aContexteCourant.node,
            'ie-compteurmax:"' + lMap['ie-compteurmax'] + '"',
          );
          aContexteCourant.node.removeAttribute('ie-compteurmax');
          delete lMap['ie-compteurmax'];
        }
      }
      if (lAvecCompteur) {
        const lCouleur = aContexteCourant.node.style.borderColor;
        if (
          lCouleur !== 'initial' &&
          lCouleur !== '' &&
          lCouleur !== '-moz-use-text-color' &&
          lCouleur !== 'currentColor'
        ) {
          lOptions.couleurBordure = lCouleur;
        }
      }
      if (!!ObjetSupport_1.Support.speechRecognition && !IE.estMobile) {
        try {
          lSpeechRecognizer = new ObjetSupport_1.Support.speechRecognition();
          lSpeechRecognizer.interimResults = true;
          lSpeechRecognizer.lang =
            ((_a = global.GParametres) === null || _a === void 0
              ? void 0
              : _a.langue) || 'fr';
          lSpeechRecognizer.onresult = function (event) {
            for (let i = event.resultIndex; i < event.results.length; i++) {
              if (event.results[i].isFinal) {
                lJTextArea.get(0).value +=
                  (lJTextArea.get(0).value !== '' ? ' ' : '') +
                  event.results[i][0].transcript;
                lInRecognition = false;
                lJTextArea.trigger('change');
                aContexteCourant.controleur.$refreshSelf();
              }
            }
          };
          lSpeechRecognizer.onerror = function (event) {
            lFLogSpeech(event.error);
            aContexteCourant.controleur.$refreshSelf();
          };
        } catch (ex) {
          lFLogSpeech(ex.error);
          aContexteCourant.controleur.$refreshSelf();
        }
      }
      const lAvecWrapperCompteurMobile = lAvecCompteur && !!IE.estMobile;
      const lAvecWrapperCompteurEspace =
        !lAvecWrapperCompteurMobile && (lAvecCompteur || !!lSpeechRecognizer);
      const lEstAutoSize =
        lMap['ie-autoresize'] !== undefined ||
        (IE.estMobile &&
          !$(aContexteCourant.node).hasClass('ie-no-autoresize'));
      if (lAvecWrapperCompteurMobile) {
        H = [
          IE.jsx.str(
            'div',
            { tabindex: '-1', class: 'textareamax-wrapper' },
            IE.jsx.str('textarea', { class: 'textareamax' }),
            IE.jsx.str('span', { class: 'tam_counter character-counter' }),
            lHtmlWAIDescr,
          ),
        ];
      } else if (lAvecWrapperCompteurEspace) {
        H = [
          '<div tabindex="-1" class="textareamax-wrapper">',
          IE.jsx.str(
            'div',
            { class: 'textarea-style' },
            IE.jsx.str('textarea', { class: 'textareamax' }),
          ),
          lAvecCompteur
            ? '<div class="tam_counter' +
              (lSpeechRecognizer ? ' tam_withspeech' : '') +
              ' textarea-counter"' +
              ' style="display:none;' +
              (lEstAutoSize
                ? ''
                : ObjetStyle_2.GStyle.composeCouleurFond(lOptions.couleurFond) +
                  ObjetStyle_2.GStyle.composeCouleurBordure(
                    lOptions.couleurBordure,
                    1,
                    lOptions.borduresZoneMax,
                  )) +
              (lOptions.heightCompteur
                ? 'height:' + lOptions.heightCompteur + ';'
                : '') +
              '">' +
              '<span></span>' +
              '</div>'
            : '',
          lSpeechRecognizer
            ? IE.jsx.str(
                'div',
                { class: 'tam_speech textarea-counter' },
                IE.jsx.str('i', {
                  role: 'img',
                  class: 'small-icon icon_microphone',
                  'aria-label': ObjetTraduction_1.GTraductions.getValeur(
                    'SaisieVocale.CaptureAudio',
                  ),
                }),
              )
            : '',
          lHtmlWAIDescr,
          '</div>',
        ];
      } else {
        H = [IE.jsx.str('textarea', { class: 'textareamax' })];
      }
      const lDivConteneur = ObjetHtml_1.GHtml.htmlToDOM(H.join(''));
      const lJConteneur = $(lDivConteneur);
      let lJConteneurTextarea = null;
      let lJConteneurMax = null;
      let lJLibelleMax = null;
      if (lAvecWrapperCompteurMobile) {
        lJTextArea = lJConteneur.children().first();
        lJLibelleMax = lJConteneur.children().eq(1);
        lJConteneurMax = lJLibelleMax;
      } else if (lAvecWrapperCompteurEspace) {
        lJConteneurTextarea = lJConteneur.children().first();
        lJTextArea = lJConteneurTextarea.children().first();
        if (lAvecCompteur) {
          lJConteneurMax = lJConteneur.children().eq(1);
          lJLibelleMax = lJConteneurMax.children().first();
        }
        lJSpeechReco = lJConteneur.children().eq(lAvecCompteur ? 2 : 1);
      } else {
        lJTextArea = lJConteneur;
      }
      for (llName in lMap) {
        try {
          switch (llName) {
            case 'ie-autoresize':
              break;
            case 'required':
              lJTextArea.attr(llName, '');
              break;
            case 'id':
            case 'readonly':
            case 'disabled':
            case 'placeholder':
            case 'maxlength':
            case 'ie-trim':
            case 'ie-textbrut':
              lJTextArea.attr(llName, lMap[llName]);
              break;
            case 'ie-idcont':
              if (lAvecWrapperCompteurEspace || lAvecWrapperCompteurMobile) {
                lJConteneur.attr('id', lMap[llName]);
              }
              break;
            default:
              if (llName.startsWith('aria-')) {
                lJTextArea.attr(llName, lMap[llName]);
              } else {
                if (llName === 'class') {
                  lJConteneur.addClass(lMap[llName]);
                } else {
                  lJConteneur.attr(llName, lMap[llName]);
                }
              }
          }
        } catch (e) {}
      }
      if (lEstAutoSize) {
        lJConteneur.addClass('ie-autoresize');
        lJTextArea.attr('ie-autoresize', '');
      }
      if (lIdMaxLength && lHtmlWAIDescr) {
        const lAttrDesc = (
          (lJTextArea.attr('aria-describedby') || '') +
          ' ' +
          lIdMaxLength
        ).trim();
        lJTextArea.attr('aria-describedby', lAttrDesc);
      }
      if (lAvecWrapperCompteurEspace || lAvecWrapperCompteurMobile) {
        if (aContexteCourant.data.$modeleValue) {
          lContexteCourant = Object.assign({}, aContexteCourant);
          lContexteCourant.node = lJTextArea.get(0);
          aOutils.gererInputText(lContexteCourant, '');
        }
        if (lJLibelleMax && lJLibelleMax.length === 1) {
          aOutils.surInjectionHtml(aContexteCourant, () => {
            aContexteCourant.controleur.$refreshSelf();
          });
          aOutils.abonnerRefresh(
            () => {
              const lValue = lJTextArea.get(0).value || '';
              const lLongueur = lOptions.getCompteur
                ? lOptions.getCompteur(lValue)
                : lValue.length;
              if (lLongueur !== lOptions.longueurTexte) {
                lOptions.longueurTexte = lLongueur;
                if (lAvecMaxLength) {
                  lJLibelleMax.get(0).innerHTML = ObjetChaine_1.GChaine.format(
                    lOptions.libelleMax_dd,
                    [lLongueur, lMaxLength],
                  );
                  lJConteneurMax.css(
                    'color',
                    lLongueur > lMaxLength * lOptions.pourcentageAvertissement
                      ? lOptions.couleurTexteAvertissement
                      : lOptions.couleurTexte,
                  );
                } else {
                  lJLibelleMax.get(0).innerHTML = lLongueur + '';
                }
              }
            },
            lJLibelleMax.get(0),
            aContexteCourant,
          );
        }
      }
      const lFuncEstNonEditable = function () {
        return !!(lJTextArea.is(':disabled') || lJTextArea.prop('readonly'));
      };
      let lEstNonEditable = lFuncEstNonEditable();
      const lAppliquerDisabled = function () {
        if (lJConteneur.is('textarea')) {
          return;
        }
        if (lEstNonEditable) {
          lJConteneur.addClass('disabled');
        } else {
          lJConteneur.removeClass('disabled');
        }
      };
      lAppliquerDisabled();
      if (lAvecWrapperCompteurEspace) {
        lJConteneur.css({ position: 'relative' });
        let lTimeoutFocusOut;
        lJConteneur.on({
          focusin: function () {
            clearTimeout(lTimeoutFocusOut);
            if (lFuncEstNonEditable()) {
              return;
            }
            if (lJConteneurMax) {
              lJConteneurMax.show();
            }
            if (lOptions.heightCompteur) {
              lJConteneurTextarea.css('bottom', lOptions.heightCompteur);
            }
            aContexteCourant.controleur.$refreshSelf();
          },
          focusout: function () {
            if (lJConteneurMax) {
              lJConteneurMax.hide();
            }
            lJConteneurTextarea.css('bottom', '0');
            lTimeoutFocusOut = setTimeout(() => {
              lJTextArea.trigger('focusout_TextareaMax');
            }, 0);
          },
        });
      } else {
        (lAvecWrapperCompteurEspace || lAvecWrapperCompteurMobile
          ? lJConteneur
          : lJTextArea
        ).on('focusout', () => {
          lJTextArea.trigger('focusout_TextareaMax');
        });
      }
      aOutils.abonnerRefresh(
        () => {
          if (lEstNonEditable !== lFuncEstNonEditable()) {
            lEstNonEditable = !lEstNonEditable;
            lAppliquerDisabled();
          }
          if (lAvecRefreshSelonTaille) {
            lAvecRefreshSelonTaille();
          }
        },
        lDivConteneur,
        aContexteCourant,
      );
      if (lSpeechRecognizer && lJSpeechReco.length > 0) {
        (lEstAutoSize
          ? lJSpeechReco.children('i')
          : lJSpeechReco
        ).eventValidation(() => {
          if (!lFuncEstNonEditable()) {
            if (!lInRecognition) {
              try {
                lSpeechRecognizer.start();
                lInRecognition = true;
                lJSpeechReco.children('i').attr('class', 'icon_microphone');
              } catch (ex) {
                lFLogSpeech(ex.error);
              }
            } else {
              try {
                lSpeechRecognizer.stop();
                lInRecognition = false;
              } catch (ex) {
                lFLogSpeech(ex.error);
              }
            }
            lJSpeechReco
              .children('i')
              .css('color', lInRecognition ? 'red' : '');
            aContexteCourant.controleur.$refreshSelf();
          }
        });
      }
      aOutils.replaceNode(aContexteCourant.node, lDivConteneur);
      aContexteCourant.node = lDivConteneur;
      aOutils.addCommentaireDebug(lDivConteneur, 'ie-textareamax');
      return {
        node: aContexteCourant.node,
        avecCompileFils:
          lAvecWrapperCompteurMobile || lAvecWrapperCompteurEspace,
      };
    });
  },
  fn: 'iehtml.textareamax.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.RechercheTexte = void 0;
    const ComparateurChaines_1 = require('ComparateurChaines');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetPosition_1 = require('ObjetPosition');
    const tag_1 = require('tag');
    class RechercheTexte {
      static getTabRechercheTexteNormalize(aStrSearch) {
        let lRecherche =
          aStrSearch && aStrSearch.trim
            ? aStrSearch
                .trim()
                .replace(/\s\s/g, '')
                .replace(/[-[\]/{}()*+?.\\^$|']/g, '\\$&')
            : '';
        const lTabRecherches = [];
        ComparateurChaines_1.ComparateurChaines.normalize(lRecherche)
          .split(' ')
          .forEach((aVal) => {
            if (
              aVal &&
              aVal.trim &&
              aVal.trim() &&
              !lTabRecherches.includes(aVal)
            ) {
              lTabRecherches.push(aVal.trim());
            }
          });
        return lTabRecherches;
      }
      static trouverRechercheTabTexteNormalize(aParams) {
        const lParams = Object.assign(
          {
            str: '',
            str_avecEntites: true,
            tabSearch: null,
            strSearch: null,
            strSearch_avecEntites: true,
          },
          aParams,
        );
        if (!lParams.str || !lParams.str.trim) {
          return false;
        }
        if (lParams.str_avecEntites) {
          lParams.str = ObjetChaine_1.GChaine.enleverEntites(lParams.str);
        }
        if (!lParams.tabSearch && lParams.strSearch) {
          lParams.tabSearch = RechercheTexte.getTabRechercheTexteNormalize(
            lParams.strSearch,
          );
        }
        if (!lParams.tabSearch || !lParams.tabSearch.every) {
          return true;
        }
        return lParams.tabSearch.every((aSearch) => {
          const lSearch = lParams.strSearch_avecEntites
            ? ObjetChaine_1.GChaine.enleverEntites(aSearch)
            : aSearch;
          return new RegExp(lSearch, 'i').test(
            ComparateurChaines_1.ComparateurChaines.normalize(lParams.str),
          );
        });
      }
      static surlignage(aTabDOM, aStrSearch) {
        if (!aTabDOM || !aTabDOM.every) {
          return false;
        }
        try {
          const lTabRanges = [];
          const lTabRecherches =
            RechercheTexte.getTabRechercheTexteNormalize(aStrSearch);
          const lDOMSuppression = [];
          aTabDOM.forEach((aElementDOM) => {
            if (
              aElementDOM.classList.contains(
                RechercheTexte.cssSurlignageConteneur,
              )
            ) {
              lDOMSuppression.push(aElementDOM);
            }
            lTabRecherches.forEach((aStrSearch) => {
              const lRegEx = new RegExp(aStrSearch, 'ig');
              let lRange = null;
              const lRectConteneur =
                ObjetPosition_1.GPosition.getClientRect(aElementDOM);
              let lMatch = lRegEx.exec(
                ComparateurChaines_1.ComparateurChaines.normalize(
                  aElementDOM.textContent,
                ),
              );
              while (lMatch) {
                let lStrSearch = lMatch[0];
                let lCurrentIndex = 0;
                _iterateNodeText(aElementDOM, (aNodeText) => {
                  if (
                    lMatch.index >= lCurrentIndex &&
                    aNodeText.nodeValue &&
                    lMatch.index < lCurrentIndex + aNodeText.nodeValue.length
                  ) {
                    lRange = new Range();
                    lRange.setStart(aNodeText, lMatch.index - lCurrentIndex);
                  }
                  if (
                    lRange &&
                    lMatch.index + lStrSearch.length >= lCurrentIndex &&
                    lMatch.index + lStrSearch.length <=
                      lCurrentIndex + aNodeText.nodeValue.length
                  ) {
                    lRange.setEnd(
                      aNodeText,
                      lMatch.index + lStrSearch.length - lCurrentIndex,
                    );
                    lTabRanges.push({
                      node: aElementDOM,
                      rects: lRange.getClientRects(),
                      rectCellule: lRectConteneur,
                    });
                    lRange = null;
                  }
                  lCurrentIndex += aNodeText.nodeValue.length;
                });
                lMatch = lRegEx.exec(aElementDOM.textContent);
              }
            });
          });
          lDOMSuppression.forEach((aElementDOM) => {
            $(aElementDOM)
              .removeClass(RechercheTexte.cssSurlignageConteneur)
              .find(`.${RechercheTexte.cssSurlignage}`)
              .remove();
          });
          lTabRanges.forEach((aInfos) => {
            const lRectCellule = aInfos.rectCellule;
            for (let i = 0; i < aInfos.rects.length; i++) {
              const lRect = aInfos.rects[i];
              if (lRect.width > 0 && lRect.height > 0) {
                if (i > 0) {
                  const lRectPrec = aInfos.rects[i - 1];
                  if (
                    lRectPrec.x === lRect.x &&
                    lRectPrec.y === lRect.y &&
                    lRectPrec.width === lRect.width &&
                    lRectPrec.height === lRect.height
                  ) {
                    continue;
                  }
                }
                $(aInfos.node)
                  .addClass(RechercheTexte.cssSurlignageConteneur)
                  .append(
                    (0, tag_1.tag)('div', {
                      class: RechercheTexte.cssSurlignage,
                      style: `top:${lRect.y - lRectCellule.y}px; left:${lRect.x - lRectCellule.x}px; width:${lRect.width}px; height:${lRect.height}px;"`,
                    }),
                  );
              }
            }
          });
          return true;
        } catch (e) {
          return false;
        }
      }
      static removeSurlignage(aJElement) {
        if (aJElement.hasClass(RechercheTexte.cssSurlignageConteneur)) {
          aJElement
            .removeClass(RechercheTexte.cssSurlignageConteneur)
            .find(`.${RechercheTexte.cssSurlignage}`)
            .remove();
        } else {
          aJElement
            .find(`.${RechercheTexte.cssSurlignageConteneur}`)
            .removeClass(RechercheTexte.cssSurlignageConteneur)
            .find(`.${RechercheTexte.cssSurlignage}`)
            .remove();
        }
      }
    }
    exports.RechercheTexte = RechercheTexte;
    RechercheTexte.cssSurlignageConteneur = 'surlignage-conteneur';
    RechercheTexte.cssSurlignage = 'surlignage-recherche-texte';
    function _iterateNodeText(aNode, aFunc) {
      if (aNode && aNode.childNodes) {
        for (let i = 0; i < aNode.childNodes.length; i++) {
          const lNode = aNode.childNodes[i];
          if (lNode.nodeType === Node.TEXT_NODE) {
            aFunc(lNode);
          } else {
            _iterateNodeText(lNode, aFunc);
          }
        }
      }
    }
  },
  fn: 'recherchetexte.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetDonneesListeFlatDesign = void 0;
    const tslib_1 = require('tslib');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetDonneesListe_1 = require('ObjetDonneesListe');
    const tag_1 = require('tag');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const jsx_1 = require('jsx');
    require('ObjetDonneesListeFlatDesign.css');
    tslib_1.__exportStar(require('ObjetDonneesListe'), exports);
    class ObjetDonneesListeFlatDesign extends ObjetDonneesListe_1.ObjetDonneesListe {
      constructor(aDonnees) {
        super(aDonnees);
        this.setOptions({
          avecBoutonActionLigne: true,
          avecEdition: false,
          avecSuppression: false,
          avecEtatSaisie: false,
          avecEvnt_Creation: true,
          avecCB: false,
          avecEvnt_CB: true,
          avecCocheCBSurLigne: false,
          avecDeselectionSurNonSelectionnable: false,
          avecContenuTronque: false,
          avecDeploiement: true,
          avecEventDeploiementSurCellule: false,
          flatDesignMinimal: false,
          avecEllipsis: true,
          avecContextMenuSansSelection: true,
          avecIndentationSousInterTitre: false,
          avecFusionLignePereFils: false,
        });
        this.estFlatDesign = true;
      }
      getZoneGauche(aParams) {
        return '';
      }
      avecCB(aParams) {
        return this.options.avecCB;
      }
      getIconeGaucheContenuFormate(aParams) {
        return '';
      }
      getHintIconeGaucheContenuFormate(aParams) {
        return '';
      }
      getTitreZonePrincipale(aParams) {
        return aParams.article.getLibelle();
      }
      getInfosSuppZonePrincipale(aParams) {
        return '';
      }
      getZoneComplementaire(aParams) {
        return '';
      }
      getZoneMessage(aParams) {
        return '';
      }
      getZoneMessageLarge(aParams) {
        return '';
      }
      getAriaLabelZoneCellule(aParams, aZone) {
        return '';
      }
      getOrdreAriaLabelZoneCellule(aParams) {
        return [
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.lu,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.checkbox,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.zoneGauche,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign
            .iconeGaucheContenuFormate,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.titre,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign
            .infosSuppZonePrincipale,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.message,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.messageLarge,
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.zoneComplementaire,
        ];
      }
      estLigneOff(aParams) {
        if (this.avecCB(aParams)) {
          return this.getDisabledCB(aParams);
        }
        return false;
      }
      avecBoutonActionLigne(aParams) {
        return (
          this.options.avecBoutonActionLigne &&
          !this.estInterTitre(aParams.article)
        );
      }
      estInterTitre(aArticle) {
        return !!aArticle.estInterTitre;
      }
      avecSurvolCelluleVisible(aParams) {
        return (
          this.options.avecSurvolCelluleVisible && this._avecSelection(aParams)
        );
      }
      avecSeparateurLigneHautFlatdesign(aParamsCellule, aParamsCellulePrec) {
        return (
          aParamsCellule.article &&
          aParamsCellulePrec.article &&
          !this.estInterTitre(aParamsCellule.article) &&
          !this.estInterTitre(aParamsCellulePrec.article) &&
          !(
            this.options.avecFusionLignePereFils &&
            aParamsCellule.article.pere &&
            aParamsCellule.article.pere.estUnDeploiement
          )
        );
      }
      desactiverIndentationParente() {
        return false;
      }
      getValueCB(aParams) {
        return aParams.article ? aParams.article.estCoche : false;
      }
      setValueCB(aParams, aValue) {
        aParams.article.estCoche = aValue;
      }
      getDisabledCB(aParams) {
        return false;
      }
      getTotal(aEstHeader) {
        return null;
      }
      getLigneTotaleSelectionnable(aParamsCellule) {
        return null;
      }
      estLigneTotaleSelectionnable(aArticle) {
        return !!(aArticle && aArticle.estLigneTotale);
      }
      construireFiltres() {
        return '';
      }
      getControleurFiltres(aInstance, aInstanceListe) {
        return {};
      }
      reinitFiltres() {}
      estFiltresParDefaut() {
        return false;
      }
      getLibelleDraggable(aParams) {
        const lTitre = this.getTitreZonePrincipale(aParams);
        const lInfosSupp = this.getInfosSuppZonePrincipale(aParams);
        return IE.jsx.str(
          IE.jsx.fragment,
          null,
          lTitre,
          lInfosSupp ? IE.jsx.str('br', null) + lInfosSupp : '',
        );
      }
      _getValeur(aParams) {
        const lAvecEllipsis = this.options.avecEllipsis;
        if (this.estInterTitre(aParams.article)) {
          let lNiveau = aParams.article.estInterTitre;
          if (
            lNiveau !== ObjetDonneesListeFlatDesign.typeInterTitre.h4 &&
            lNiveau !== ObjetDonneesListeFlatDesign.typeInterTitre.h5
          ) {
            lNiveau = ObjetDonneesListeFlatDesign.typeInterTitre.h3;
          }
          return {
            libelle: IE.jsx.str(
              'div',
              {
                class: ['fd-style-intertitre', lNiveau],
                'ie-ellipsis': lAvecEllipsis,
              },
              aParams.article.getLibelle(),
            ),
          };
        }
        const lDonneesListe = this;
        const H = [];
        let lIdsLabelOrd = [];
        const lWAICellule = this.getOrdreAriaLabelZoneCellule(aParams);
        const lHashIdsWAI = {};
        if (Array.isArray(lWAICellule)) {
          for (const lVal of lWAICellule) {
            if (lVal !== ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.lu) {
              let lId = this.getIdZone(aParams, lVal);
              lHashIdsWAI[lId] = UtilisationZoneLabelWAI.declared;
              lIdsLabelOrd.push(lId);
            }
          }
        }
        const lFuncGetAttrWAI = (aZone) => {
          const lWAI = this.getAriaLabelZoneCellule(aParams, aZone);
          const lId = this.getIdZone(aParams, aZone);
          if (lHashIdsWAI[lId] && lWAI !== false) {
            lHashIdsWAI[lId] = UtilisationZoneLabelWAI.used;
          }
          return {
            id: lId,
            role: lWAI === false ? 'presentation' : false,
            'aria-label': !lWAI ? false : lWAI,
          };
        };
        const lEstUnDeploiement =
          !this.enConstruction_cacheRechercheTexte &&
          !aParams.enImpression &&
          this.estUnDeploiement(aParams);
        const lZoneGauche = this.getZoneGauche(aParams);
        const lNiveauParente = this.desactiverIndentationParente()
          ? 0
          : this._getNiveauParente(aParams);
        if (lEstUnDeploiement || lNiveauParente > 0) {
          H.push(
            IE.jsx.str(
              'div',
              {
                class: [
                  'zone-deploiement',
                  lNiveauParente > 0
                    ? `indentation-fils-${lNiveauParente}`
                    : '',
                ],
                'aria-hidden': 'true',
              },
              function () {
                if (lEstUnDeploiement) {
                  const lAvecFils = this.avecFilsVisibleDePere(aParams.article);
                  const lDeploye = this._estDeploye(aParams.ligne) && lAvecFils;
                  const lDeploiementDisable =
                    !lAvecFils ||
                    (this.options.ignorerDeploiementSurRechercheTexte &&
                      this.paramsListe.avecRechercheTexteEnCours);
                  return IE.jsx.str('ie-btnicon', {
                    class: [
                      'btn-deploiement',
                      lDeploye ? 'icon_fleche_num_bas' : 'icon_fleche_num',
                    ],
                    'ie-node':
                      this.enImpression || lDeploiementDisable
                        ? false
                        : (0, jsx_1.jsxFuncAttr)('liste.nodeDeploiementLigne', [
                            aParams.ligne,
                            aParams.colonne,
                          ]),
                    title: ObjetTraduction_1.GTraductions.getValeur(
                      'liste.HintBoutonDeploiement',
                    ),
                    disabled: !!lDeploiementDisable,
                    tabindex: '-1',
                  });
                }
                return '';
              }.bind(this)(),
            ),
          );
        }
        let lCheckBox = '';
        if (
          !this.enConstruction_cacheRechercheTexte &&
          !aParams.enImpression &&
          this.avecCB(aParams)
        ) {
          const lId = this.getIdZone(
            aParams,
            ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.checkbox,
          );
          if (!this.options.avecCocheCBSurLigne && lHashIdsWAI[lId]) {
            lHashIdsWAI[lId] = UtilisationZoneLabelWAI.used;
          }
          lCheckBox = IE.jsx.str('ie-checkbox', {
            'ie-model': (0, jsx_1.jsxFuncAttr)(
              'liste.cb_ligne_flatDesign',
              aParams.ligne,
            ),
            'ie-attr': this.options.avecCocheCBSurLigne
              ? false
              : (0, jsx_1.jsxFuncAttr)(
                  'liste.cb_ligne_flatDesign.getAttr',
                  aParams.ligne,
                ),
            id: lId,
            tabindex: this.options.avecCocheCBSurLigne ? '-1' : false,
            'aria-hidden': this.options.avecCocheCBSurLigne ? 'true' : false,
            'ie-textright': true,
          });
        }
        if (lZoneGauche || lCheckBox) {
          const lId = this.getIdZone(
            aParams,
            ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.zoneGauche,
          );
          if (lHashIdsWAI[lId]) {
            lHashIdsWAI[lId] = UtilisationZoneLabelWAI.used;
          }
          H.push(
            IE.jsx.str('div', { class: 'zone-gauche', id: lId }, (aTab) => {
              if (lCheckBox) {
                aTab.push(lCheckBox);
              }
              if (lZoneGauche) {
                aTab.push(lZoneGauche);
              }
            }),
          );
        }
        H.push(
          (0, tag_1.tag)('div', { class: 'zone-centrale' }, (aTabCentrale) => {
            const lTitre = lDonneesListe.getTitreZonePrincipale(aParams);
            const lInfosSupp =
              lDonneesListe.getInfosSuppZonePrincipale(aParams);
            const lCompl = lDonneesListe.getZoneComplementaire(aParams);
            const lIconeGauche =
              lDonneesListe.getIconeGaucheContenuFormate(aParams);
            if (lTitre || lInfosSupp || lCompl || lIconeGauche) {
              aTabCentrale.push(
                IE.jsx.str(
                  'div',
                  {
                    class: [
                      'zone-contenu-format',
                      lIconeGauche && lTitre && !lInfosSupp
                        ? 'align-center'
                        : '',
                    ],
                  },
                  (aTabContenuFormat) => {
                    if (lIconeGauche) {
                      const lHint =
                        lDonneesListe.getHintIconeGaucheContenuFormate(aParams);
                      const lTitle =
                        lHint && MethodesObjet_1.MethodesObjet.isString(lHint)
                          ? lHint
                          : false;
                      const lHintHtml = lHint;
                      const lId = this.getIdZone(
                        aParams,
                        ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign
                          .iconeGaucheContenuFormate,
                      );
                      if (lTitle && lHashIdsWAI[lId]) {
                        lHashIdsWAI[lId] = UtilisationZoneLabelWAI.used;
                      }
                      aTabContenuFormat.push(
                        IE.jsx.str(
                          'i',
                          {
                            class: [
                              'icon',
                              MethodesObjet_1.MethodesObjet.isString(
                                lIconeGauche,
                              )
                                ? lIconeGauche
                                : lIconeGauche.css,
                            ],
                            title: lTitle,
                            role: lTitle ? 'img' : 'presentation',
                            id: lId,
                            'aria-label': lTitle,
                            'ie-hint':
                              lHintHtml && lHintHtml.html
                                ? lHintHtml.html
                                : false,
                          },
                          !MethodesObjet_1.MethodesObjet.isString(lIconeGauche)
                            ? lIconeGauche.html || ''
                            : '',
                        ),
                      );
                    }
                    aTabContenuFormat.push(
                      IE.jsx.str('div', { class: 'zone-principale' }, () => {
                        const lTab = [];
                        if (lTitre) {
                          const lAttrWAI = lFuncGetAttrWAI(
                            ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign
                              .titre,
                          );
                          lTab.push(
                            IE.jsx.str(
                              'div',
                              Object.assign(
                                {
                                  class: 'titre-principal',
                                  'ie-ellipsis': lAvecEllipsis,
                                },
                                lAttrWAI,
                              ),
                              lTitre,
                            ),
                          );
                        }
                        if (lInfosSupp) {
                          const lAttrWAI = lFuncGetAttrWAI(
                            ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign
                              .infosSuppZonePrincipale,
                          );
                          lTab.push(
                            IE.jsx.str(
                              'div',
                              Object.assign(
                                {
                                  class: 'infos-supp',
                                  'ie-ellipsis': lAvecEllipsis,
                                },
                                lAttrWAI,
                              ),
                              lInfosSupp,
                            ),
                          );
                        }
                        return lTab.join('');
                      }),
                    );
                    if (lCompl) {
                      const lAttrWAI = lFuncGetAttrWAI(
                        ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign
                          .zoneComplementaire,
                      );
                      aTabContenuFormat.push(
                        IE.jsx.str(
                          'div',
                          Object.assign(
                            { class: 'zone-complementaire' },
                            lAttrWAI,
                          ),
                          lCompl,
                        ),
                      );
                    }
                  },
                ),
              );
            }
            const lMessage = lDonneesListe.getZoneMessage(aParams);
            if (lMessage) {
              const lAttrWAI = lFuncGetAttrWAI(
                ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.message,
              );
              aTabCentrale.push(
                IE.jsx.str(
                  'div',
                  Object.assign({ class: 'zone-message' }, lAttrWAI),
                  lMessage,
                ),
              );
            }
          }),
        );
        if (
          !this.enConstruction_cacheRechercheTexte &&
          !aParams.enImpression &&
          this.avecBoutonActionLigne(aParams)
        ) {
          const lId = this.getIdZone(
            aParams,
            ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.boutonAction,
          );
          if (lHashIdsWAI[lId]) {
            lHashIdsWAI[lId] = UtilisationZoneLabelWAI.used;
          }
          aParams._haspopup = true;
          H.push(
            IE.jsx.str(
              'div',
              {
                class:
                  'zone-droite' +
                  (this.paramsListe.versionMobile || GNavigateur.isTactile
                    ? ''
                    : ' btn-survol'),
                id: lId,
              },
              this._construireBtnAction(aParams),
            ),
          );
        }
        const lMessageLarge = this.getZoneMessageLarge(aParams);
        if (lMessageLarge) {
          const lAttrWAI = lFuncGetAttrWAI(
            ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.messageLarge,
          );
          H.push(
            IE.jsx.str(
              'div',
              Object.assign(
                {
                  class: [
                    'zone-message-large',
                    lNiveauParente > 0
                      ? `indentation-fils-${lNiveauParente}`
                      : '',
                  ],
                },
                lAttrWAI,
              ),
              lMessageLarge,
            ),
          );
        }
        const lIds = [];
        if (
          this.paramsListe.idWAILigneLue &&
          Array.isArray(lWAICellule) &&
          lWAICellule.includes(
            ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign.lu,
          ) &&
          this.estLigneOff(aParams)
        ) {
          lIds.push(this.paramsListe.idWAILigneLue);
        }
        lIdsLabelOrd.forEach((aId) => {
          if (lHashIdsWAI[aId] === UtilisationZoneLabelWAI.used) {
            lIds.push(aId);
          }
        });
        return { libelle: H.join(''), idsLabel: lIds.join(' ') };
      }
      _avecSelection(aParams) {
        return (
          !this.estInterTitre(aParams.article) && this.avecSelection(aParams)
        );
      }
      getTypeValeur(aParams) {
        return ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Html;
      }
      _getClassCelluleConteneur(aParams) {
        const lEstInterTitre = this.estInterTitre(aParams.article);
        const lClasses = [lEstInterTitre ? 'fd_intertitre' : 'fd_ligne'];
        if (this.options.flatDesignMinimal) {
          lClasses.push('fd-design-minimal');
        }
        if (this.estLigneOff(aParams)) {
          lClasses.push('off');
        }
        if (lEstInterTitre && this.options.avecIndentationSousInterTitre) {
          lClasses.push('fd-intertitre-indent');
        }
        if (!lEstInterTitre) {
          if (
            this.avecSelection(aParams) ||
            (this.options.avecCocheCBSurLigne && this.avecCB(aParams))
          ) {
            lClasses.push('with-select');
          }
        }
        if (
          this.options.avecFusionLignePereFils &&
          aParams.article.pere &&
          aParams.article.pere &&
          aParams.article.pere.estUnDeploiement
        ) {
          lClasses.push('fd-perefils-fusion');
        }
        const lClass = this.getClassCelluleConteneur(aParams);
        if (lClass) {
          lClasses.push(lClass);
        }
        return lClasses.join(' ');
      }
      _getEtatCocheSimple(aParams) {
        return !!this.getValueCB(aParams);
      }
      avecMenuContextuel(aParams) {
        return (
          super.avecMenuContextuel(aParams) &&
          this.avecBoutonActionLigne(aParams)
        );
      }
      _getVisible(aArticle, aParams) {
        if (this.estLigneTotaleSelectionnable(aArticle)) {
          return !!(aParams && aParams.contexteSelection);
        }
        if (!this.getVisible(aArticle)) {
          return false;
        }
        return true;
      }
      getHauteurMinCellule(aParams) {
        return this.options.flatDesignMinimal
          ? 28
          : this.options.hauteurMinCellule;
      }
      _getLigneTotaleSelectionnableFd(aLigne) {
        const lArticle = this.Donnees.get(aLigne);
        if (this.estLigneTotaleSelectionnable(lArticle)) {
          const lParams = this.paramsListe.getParams(0, aLigne);
          return Object.assign(
            {
              html: lArticle.getLibelle(),
              wai: '',
              header: false,
              avecSelection: true,
              avecEtiquette: true,
              estVisible: true,
            },
            lParams,
            this.getLigneTotaleSelectionnable(lParams),
          );
        }
        return null;
      }
      _construireFiltres() {
        const lHtml = this.construireFiltres();
        if (lHtml) {
          return (
            lHtml +
            (0, tag_1.tag)(
              'div',
              { class: 'filtre-footer' },
              (0, tag_1.tag)(
                'ie-bouton',
                { 'ie-model': 'btnReinitFiltres', class: 'small-bt' },
                ObjetTraduction_1.GTraductions.getValeur(
                  'liste.ReinitialiserFiltre',
                ),
              ),
            )
          );
        }
        return '';
      }
      _getControleurFiltres(aInstance, aInstanceListe) {
        return Object.assign(
          {
            btnReinitFiltres: {
              event() {
                aInstance.reinitFiltres();
              },
            },
          },
          this.getControleurFiltres(aInstance, aInstanceListe) || {},
        );
      }
      _construireBtnAction(aParams) {
        return (0, tag_1.tag)('ie-btnicon', {
          class: 'icon_ellipsis_vertical',
          tabindex: '-1',
          'ie-model': tag_1.tag.funcAttr('liste.btnEllipsisLigne', [
            aParams.ligne,
          ]),
          title: ObjetTraduction_1.GTraductions.getValeur('liste.BtnAction'),
        });
      }
      _getNiveauParente(aParams) {
        let lNiveau = 0;
        let lArticle = aParams ? aParams.article : null;
        while (lArticle && lArticle.pere) {
          lNiveau += 1;
          lArticle = lArticle.pere;
          if (lNiveau >= 10) {
            break;
          }
        }
        return lNiveau;
      }
      getIdZone(aParams, aZone) {
        return `${this.paramsListe.liste.getNom()}_${aParams.ligne}_${aParams.colonne}_fdz_${aZone}`;
      }
    }
    exports.ObjetDonneesListeFlatDesign = ObjetDonneesListeFlatDesign;
    var UtilisationZoneLabelWAI;
    (function (UtilisationZoneLabelWAI) {
      UtilisationZoneLabelWAI['declared'] = 'declared';
      UtilisationZoneLabelWAI['used'] = 'used';
    })(UtilisationZoneLabelWAI || (UtilisationZoneLabelWAI = {}));
    (function (ObjetDonneesListeFlatDesign) {
      let typeInterTitre;
      (function (typeInterTitre) {
        typeInterTitre['h3'] = 'h3';
        typeInterTitre['h4'] = 'h4';
        typeInterTitre['h5'] = 'h5';
      })(
        (typeInterTitre =
          ObjetDonneesListeFlatDesign.typeInterTitre ||
          (ObjetDonneesListeFlatDesign.typeInterTitre = {})),
      );
      let ZoneCelluleFlatDesign;
      (function (ZoneCelluleFlatDesign) {
        ZoneCelluleFlatDesign[(ZoneCelluleFlatDesign['lu'] = 0)] = 'lu';
        ZoneCelluleFlatDesign[(ZoneCelluleFlatDesign['checkbox'] = 1)] =
          'checkbox';
        ZoneCelluleFlatDesign[(ZoneCelluleFlatDesign['zoneGauche'] = 2)] =
          'zoneGauche';
        ZoneCelluleFlatDesign[
          (ZoneCelluleFlatDesign['iconeGaucheContenuFormate'] = 3)
        ] = 'iconeGaucheContenuFormate';
        ZoneCelluleFlatDesign[(ZoneCelluleFlatDesign['titre'] = 4)] = 'titre';
        ZoneCelluleFlatDesign[
          (ZoneCelluleFlatDesign['infosSuppZonePrincipale'] = 5)
        ] = 'infosSuppZonePrincipale';
        ZoneCelluleFlatDesign[
          (ZoneCelluleFlatDesign['zoneComplementaire'] = 6)
        ] = 'zoneComplementaire';
        ZoneCelluleFlatDesign[(ZoneCelluleFlatDesign['message'] = 7)] =
          'message';
        ZoneCelluleFlatDesign[(ZoneCelluleFlatDesign['messageLarge'] = 8)] =
          'messageLarge';
        ZoneCelluleFlatDesign[(ZoneCelluleFlatDesign['boutonAction'] = 9)] =
          'boutonAction';
      })(
        (ZoneCelluleFlatDesign =
          ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign ||
          (ObjetDonneesListeFlatDesign.ZoneCelluleFlatDesign = {})),
      );
    })(
      ObjetDonneesListeFlatDesign ||
        (exports.ObjetDonneesListeFlatDesign = ObjetDonneesListeFlatDesign =
          {}),
    );
  },
  fn: 'objetdonneeslisteflatdesign.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.NSListe = exports.ObjetListe = void 0;
    require('ObjetListeEspaceMobile.css');
    require('DeclarationJQuery.js');
    const TypeFusionTitreListe_1 = require('TypeFusionTitreListe');
    const IEHtml = require('IEHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const MethodesObjet_1 = require('MethodesObjet');
    const _ObjetCouleur_1 = require('_ObjetCouleur');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_1 = require('ObjetStyle');
    const Enumere_Action_1 = require('Enumere_Action');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const Enumere_EvenementListe_1 = require('Enumere_EvenementListe');
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    require('IEHtml.InputNote.js');
    require('IEHtml.SelecFile');
    require('IEHtml.TextareaMax.js');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetDonneesListe_1 = require('ObjetDonneesListe');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ToucheClavier_1 = require('ToucheClavier');
    const Invocateur_1 = require('Invocateur');
    const ComparateurChaines_1 = require('ComparateurChaines');
    const tag_1 = require('tag');
    const Enumere_CommandeMenu_1 = require('Enumere_CommandeMenu');
    const ObjetMenuContextuel_1 = require('ObjetMenuContextuel');
    const RechercheTexte_1 = require('RechercheTexte');
    const ObjetDonneesListeFlatDesign_1 = require('ObjetDonneesListeFlatDesign');
    const jsx_1 = require('jsx');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetWAI_1 = require('ObjetWAI');
    const _CONST_largeurMinColonne = 10;
    class ObjetListe extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.IdPremierElement = this.Nom + '_ObjetListe';
        this.IdEdition = this.Nom + '_Edition';
        this.idZone = this.Nom + '_Zone';
        this.IdZoneTexte = this.Nom + '_ZoneTexte';
        this.idTotaux = this.Nom + '_totaux';
        this.idPiedDeListe = this.Nom + '_piedDeListe';
        this.ids = {
          zoneFils: this.IdPremierElement,
          titre: this.Nom + '_titreTout',
          contenu: this.Nom + '_contenuListe_',
          colonneDeTri: this.Nom + '_triCol_',
          curseurTri: this.Nom + '_curseurTri_',
          curseurTriSurvol: this.Nom + '_curseurTriSurvol_',
          survolTitre: this.Nom + '_survolTitre_',
          cadreSelection: this.Nom + '_cadreSel_',
          rolloverTitre: this.Nom + '_rolloverTitre_',
          rolloverContenuLigne: this.Nom + '_rolloverContenuLigne_',
          rolloverContenuColonne: this.Nom + '_rolloverContenuColonne_',
          rolloverContenuCellule: this.Nom + '_rolloverContenuCellule_',
          dragInsertion: this.Nom + '_dragInsertion',
          surligneur_edition: this.Nom + '_surligneuredition',
          WAIDescribeTreeGrid: this.Nom + '_descrtreegrid',
          WAIDescribeTreeGridTotal: this.Nom + '_descrtreegrid_total',
          WAIDescribeTri: this.Nom + '_descr_tri',
          WAICelluleEditable: this.Nom + '_celEdit',
          btnCreation: `${this.Nom}_btnCreation`,
          WAIGrid: `${this.Nom}_waiGrid`,
          WAILigneLue: `${this.Nom}_waiLigneLue`,
        };
        this._init();
      }
      resetOptions() {
        this._options = {
          colonnes: null,
          gestionModificationColonnes: null,
          messageContenuVide: '',
          avecFiltresVisibles: false,
          listeTailles: [],
          listeTitres: null,
          hintTitres: null,
          colonnesCachees: null,
          colonnesCacheesImpression: null,
          zoneScrollH: null,
          avecLigneCreation: false,
          listeCreations: [],
          titreCreation:
            ObjetTraduction_1.GTraductions.getValeur('liste.nouveau'),
          iconeTitreCreation: false,
          avecCBToutCocher: false,
          avecToutSelectionner: true,
          nonEditable: false,
          nonEditableSurModeExclusif: false,
          AvecSuppression: true,
          parsingSurColonne: -1,
          scrollHorizontal: false,
          scrollHorizontalSurLargeurComplete: true,
          avecScrollEnTactileV: !GNavigateur.isLayoutTactile,
          avecScrollEnTactileH: !GNavigateur.isLayoutTactile,
          colonnesTriables: false,
          numeroColonneTriDefaut: undefined,
          evenementSurTri: null,
          avecModeAccessible: false,
          boutons: [],
          tailleBoutons: 17,
          positionBoutons: NSListe.positionBoutons.entete,
          avecCreationEnBoutonDesignClassique: false,
          skin: ObjetListe.skin.classique,
          avecListeNeutre: undefined,
          couleursListe: GCouleur.liste,
          avecReservationPlaceScrollHorizontal: false,
          hauteurAdapteContenu: false,
          getHauteurMaxAdapteListe: null,
          hauteurMaxAdapteContenu: null,
          avecLigneTotal: false,
          avecConstructionDynamiqueContenu: true,
          colonnesSansBordureDroit: [],
          avecCadreSelection: true,
          paddingCelluleLR: 8,
          paddingCelluleTB: 4,
          hauteurCelluleTitreStandard:
            ObjetDonneesListe_1.ObjetDonneesListe.hauteurMinCellule,
          widthTri: 14,
          heightTri: 8,
          avecRollover: true,
          hauteurZoneContenuListeMin:
            ObjetDonneesListe_1.ObjetDonneesListe.hauteurMinCellule,
          largeurZoneContenuListeMin: 20,
          largeurImage: 18,
          borduresContenu_couleur: null,
          borduresContenu_top: 1,
          borduresContenu_bottom: 1,
          borduresContenu_left: 1,
          borduresContenu_right: 1,
          paddingContenu_LR: 0,
          borduresCellule_couleur: null,
          borduresCellule_horizontal: 1,
          borduresCellule_vertical: 1,
          alternanceCouleurLigneContenu: false,
          avecCouleurAlternanceParDefaut: false,
          couleurAlternance0: new _ObjetCouleur_1.ObjectCouleurCellule(
            GCouleur.blanc,
            GCouleur.noir,
            null,
          ),
          couleurAlternance1: new _ObjetCouleur_1.ObjectCouleurCellule(
            GCouleur.fond,
            GCouleur.noir,
            null,
          ),
          avecTraitSeparationDeploiementAlternance: false,
          avecOmbreDroite: false,
          forcerOmbreScrollTop: false,
          forcerOmbreScrollBottom: false,
          avecSelectionLigneSurImpression: true,
          piedDeListe: null,
          maxLengthTextareaIgnore: 1000000,
          delaiSurEditionRecherche: 10,
          callbackResizeObserverContenu: null,
        };
        return this;
      }
      setOptionsListe(aOptions, aAvecActualisation) {
        return this._setOptionsListe(aOptions, aAvecActualisation);
      }
      getDonneesListe() {
        return this.Donnees;
      }
      setDonnees(ADonnees, aLigneSelectionne, aParams) {
        return this._setDonnees(ADonnees, aLigneSelectionne, aParams);
      }
      actualiser(aObjetOuConserverSelection, aSansTriDonnees) {
        const lParametres = {
          ignorerFocusListe: false,
          ignorerCalculTri: true,
        };
        if (
          MethodesObjet_1.MethodesObjet.isObject(aObjetOuConserverSelection)
        ) {
          Object.assign(lParametres, aObjetOuConserverSelection);
        } else {
          Object.assign(lParametres, {
            conserverSelection: !!aObjetOuConserverSelection,
            conserverFocusSelection: !!aObjetOuConserverSelection,
            sansTriDonnees: aSansTriDonnees,
          });
        }
        this._cache.calculsPreRenduAFaire = true;
        this._actualiser(lParametres);
      }
      effacer(aMessage) {
        this._donneesRecus = false;
        ObjetHtml_1.GHtml.setHtml(this.Nom, aMessage || '&nbsp;', {
          ignorerScroll: true,
        });
        return this;
      }
      surSelection(aNumeroColonne, aNumeroLigne, aParams) {
        return this._surSelection(aNumeroColonne, aNumeroLigne, aParams);
      }
      selectionnerLigne(aParametres) {
        this._cache.lignesSelectionnees_prec = [
          ...this._cache.lignesSelectionnees,
        ];
        this._selectionner(
          Object.assign(
            { colonne: -1, avecEvenementModificationSelection: true },
            aParametres,
          ),
        );
      }
      selectionnerCellule(aParametres) {
        this._cache.lignesSelectionnees_prec = [
          ...this._cache.lignesSelectionnees,
        ];
        this._selectionner(
          Object.assign(
            { avecEvenementModificationSelection: true },
            aParametres,
          ),
        );
      }
      getSelection() {
        if (this._getListeElementsSelection().count() === 0) {
          return -1;
        }
        return this._cache.selectionCellule.ligne;
      }
      getSelectionCellule() {
        return Object.assign({}, this._cache.selectionCellule);
      }
      getElementSelection() {
        const lListe = this._getListeElementsSelection();
        return lListe.count() > 0 ? lListe.get(0) : null;
      }
      getListeElementsSelection() {
        return this._getListeElementsSelection();
      }
      setListeElementsSelection(aListeElements, aParams) {
        return this._setListeElementsSelection(aListeElements, aParams);
      }
      getTableauCellulesSelection() {
        const lSelections = [];
        this._getCellulesSelection().forEach((aElement) => {
          aElement.colonnes.forEach((aNumeroColonne, aIndex) => {
            lSelections.push({
              article: aElement.article,
              ligne: aElement.ligne,
              colonne: aNumeroColonne,
              idColonne: aElement.idsColonnes[aIndex],
              declarationColonne:
                this._cache.declColonnesByIds[aElement.idsColonnes[aIndex]],
            });
          });
        });
        return lSelections;
      }
      setTableauCellulesSelection(aListe, aParams) {
        return this._setTableauCellulesSelection(aListe, aParams);
      }
      selectionnerCelluleSuivante(aParametres) {
        return this._selectionnerCelluleSuivante(aParametres);
      }
      scrollTo(aParams) {
        const lParams = Object.assign(
          { ligne: -1, avecScrollTopLigne: true, ecartForce: 0 },
          aParams,
        );
        this._scrollSurLigne({
          ligne: lParams.ligne,
          avecScrollTopLigne: lParams.avecScrollTopLigne,
          ecartForce: lParams.ecartForce,
        });
      }
      getArticleDeLigne(aLigne) {
        if (this.Donnees && this.Donnees.Donnees) {
          return this.Donnees.Donnees.get(aLigne);
        }
        return null;
      }
      getListeArticles() {
        if (this.Donnees && this.Donnees.Donnees) {
          return this.Donnees.Donnees;
        }
        return new ObjetListeElements_1.ObjetListeElements();
      }
      getListeArticlesCochees() {
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        const lDonnees =
          this.Donnees &&
          this.Donnees instanceof
            ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign
            ? this.Donnees
            : null;
        if (lDonnees) {
          this.getListeArticles().parcourir((aArticle, aIndex) => {
            const lParams = this._getParamsCellule(-1, aIndex);
            if (
              lDonnees._getVisible(aArticle) &&
              lDonnees.avecCB(lParams) &&
              lDonnees.getValueCB(lParams)
            ) {
              lListe.add(aArticle);
            }
          });
        }
        return lListe;
      }
      demarrerEditionSurCellule(aLigne, aColonne) {
        const lElement = ObjetHtml_1.GHtml.getElement(
          this.getIdCellule(aColonne, aLigne, true),
        );
        if (ObjetHtml_1.GHtml.elementExiste(lElement)) {
          ObjetHtml_1.GHtml.setFocus(lElement);
        } else if (this._estLigneDansRangeNonConstruitDyn(aLigne)) {
          this._scrollSurLigne({ ligne: aLigne, colonne: aColonne });
        }
        this.surEditionDeb(aColonne, aLigne);
        if (this._cache.timeout_ignorerScrollSortieEdition) {
          clearTimeout(this._cache.timeout_ignorerScrollSortieEdition);
          delete this._cache.timeout_ignorerScrollSortieEdition;
        }
        this._cache.timeout_ignorerScrollSortieEdition = setTimeout(() => {
          delete this._cache.timeout_ignorerScrollSortieEdition;
        }, 100);
        return this;
      }
      ajouterElementCreation(aLibelle, aValeurCreation) {
        return this._ajouterElementCreation(aLibelle, aValeurCreation);
      }
      annulerCreation() {
        this._annulerCreation();
      }
      setCreationLigne(aCreationLigneBis) {
        return this._setCreationLigne(aCreationLigneBis);
      }
      surSuppression() {
        return this._surSuppression();
      }
      getIdCellule(aColonne, aLigne, aPourFocus) {
        const lTab = [this.Nom, aColonne];
        if (aLigne !== null && aLigne !== undefined) {
          lTab.push(aLigne);
        }
        if (aPourFocus) {
          lTab.push('div');
        }
        return lTab.join('_');
      }
      getIdColonneDeNumeroColonne(aNumeroColonne) {
        return this._cache.colonnes.listeIds[aNumeroColonne] || '';
      }
      getNumeroColonneDIdColonne(aIdColonne) {
        const lNumero = this._cache.colonnes.listeIds.indexOf(aIdColonne);
        return lNumero >= 0 ? lNumero : -1;
      }
      getRechercheTexte() {
        return this._cache.rechercheTexte.saisie;
      }
      setRechercheTexte(aTexte, aSansTriDonnees) {
        this._setRechercheSaisie(aTexte);
        clearTimeout(this._cache.rechercheTexte.timerSaisie);
        let lParams;
        if (aSansTriDonnees) {
          lParams = { sansTriDonnees: true };
        }
        if (this._options.delaiSurEditionRecherche >= 0) {
          this._cache.rechercheTexte.timerSaisie = setTimeout(() => {
            this._filtreRechercheTexte(lParams);
          }, this._options.delaiSurEditionRecherche);
        } else {
          this._filtreRechercheTexte(lParams);
        }
        return this;
      }
      composeImpression(aProportion) {
        return '';
      }
      construireCopieCSV() {}
      getPositionScrollV() {
        const lBackupScroll = this._backupScroll({
          conserverPositionScroll: true,
        });
        return lBackupScroll.scrollTop;
      }
      setPositionScrollV(aPosition) {
        const lBackupScroll = this._backupScroll({
          conserverPositionScroll: true,
        });
        lBackupScroll.scrollTop = aPosition;
        this._setScroll(lBackupScroll);
      }
      getTriCourant() {
        return Object.assign(
          {
            id: this._triCourant.colonne.map((aColonne) =>
              this.getIdColonneDeNumeroColonne(aColonne),
            ),
          },
          this._triCourant,
        );
      }
      reset() {
        return this._setDonnees(null);
      }
      resize() {}
      surPreResize() {}
      surPostResize() {}
      async setColonneTri(aColonne, aGenre, aNumeroTri) {
        return this._setColonneTri(aColonne, aGenre, aNumeroTri);
      }
      focusSuivant(AId, AOrientation, ADirection) {
        return this._focusSuivant(AId, AOrientation, ADirection);
      }
      free() {
        super.free();
        clearTimeout(this._cache.rechercheTexte.timerSaisie);
        clearTimeout(this._cache.timerKeyPress);
        this._desabonnementResizeObserver();
      }
      _init() {
        this.resetOptions();
        this._cache = {
          taillesColonne: [],
          heightConteneur: 0,
          largeurPage: null,
          avecPourcentage: false,
          largeurTotalFixe: 0,
          largeurBlocFixe: 0,
          infosZonesColonnes: [],
          listeCorrespondancesColonnes: [],
          declColonnesByIds: {},
          colonnes: { listeIds: [], listeTailles: [] },
          tableauColonnesCachees: [],
          nbColonnesCachees: 0,
          reserverPlaceScrollHorizontal: false,
          calculsPreRenduAFaire: true,
          calculsTailleColonnesAFaire: true,
          calculTriAFaire: true,
          listeNonInitialisee: true,
          lignesFusionParColonne: {},
          declarationsColonnes: [],
          colonnesTri: null,
          colonnesSansBordureDroit: [],
          boutons: null,
          rolloverVisible: false,
          survoleTitreTriVisible: false,
          lignesVisibles: [],
          lignesVisiblesSansRechercheTexte: [],
          strResultRecherche: '',
          couleursAlternanceParLigne: [],
          selectionCellule: { ligne: -1, colonne: -1 },
          celluleClicNonShift: { ligne: -1, colonne: -1 },
          lignesSelectionnees: [],
          lignesSelectionnees_prec: [],
          editionEnCours: false,
          editionEnCoursEvenement: false,
          creationEnCours: false,
          creationEnCoursEvenement: false,
          positionCreation: 0,
          listeValeursCreation: [],
          numeroColonneCreationEnCours: null,
          numeroLigneCreationDynamique: null,
          ouvrirSelecteurFileParLigne: {},
          positionsCelluleCadreSelection: {},
          keysControleurTitre: {},
          keysControleurDonneesListe: {},
          rechercheTexte: {
            saisie: '',
            textesParLigne: null,
            lignesCachees: [],
            timerSaisie: null,
          },
          timerKeyPress: null,
          collectionFuncConstructCellule: {},
          refresh: {
            nbLignes: 10,
            observer: new IntersectionObserver(
              this._callbackObserverRefreshContenu.bind(this),
            ),
            init: () => {
              const lCacheRef = this._cache.refresh;
              lCacheRef.structure = [];
              lCacheRef.mapNodesObs = new WeakMap();
              lCacheRef.mapRangesExist = new Map();
              lCacheRef.mapRangesExist.min = Number.MAX_VALUE;
              lCacheRef.mapRangesExist.max = -1;
              (lCacheRef.node_gab_start = null),
                (lCacheRef.node_gab_end = null),
                (lCacheRef.hauteurMoyenneLigne = 20);
              lCacheRef.getHeightStructure = (aStructure) => {
                return aStructure.height < 0
                  ? lCacheRef.hauteurMoyenneLigne * aStructure.nbLignes
                  : aStructure.height;
              };
            },
          },
        };
        this._cache.refresh.init();
        this.optionsInterne = { versionMobile: false };
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.modeExclusif,
          () => {
            if (this._options.nonEditableSurModeExclusif) {
              this._actualiser({
                conserverSelection: true,
                sansTriDonnees: true,
              });
            }
          },
          this,
        );
      }
      getControleur(aInstance) {
        const lControleur = {
          getClassListe: function () {
            const lClasses = ['skin_' + aInstance._options.skin];
            if (!aInstance.Donnees || aInstance.Donnees.Donnees.count() === 0) {
              lClasses.push('vide');
            }
            if (aInstance._options.avecOmbreDroite) {
              lClasses.push('ombre-droite');
            }
            if (aInstance.optionsInterne.getClassListe) {
              lClasses.push(aInstance.optionsInterne.getClassListe(aInstance));
            }
            if (aInstance.Donnees && aInstance.Donnees.options.racineCss) {
              lClasses.push(aInstance.Donnees.options.racineCss);
            }
            if (!aInstance._options.avecCadreSelection) {
              lClasses.push('background-selec');
            }
            return lClasses.join(' ');
          },
          getAttrListe() {
            const lAttrs = {};
            let lLabelsWAIListe = [];
            if (aInstance._options.labelWAI) {
              lLabelsWAIListe.push(aInstance._options.labelWAI);
            } else {
              lLabelsWAIListe.push(
                `${ObjetTraduction_1.GTraductions.getValeur('liste.wai.Titre')}`,
              );
            }
            lAttrs['aria-label'] = lLabelsWAIListe.join(' - ');
            return lAttrs;
          },
          getNodePremierElement() {
            $(this.node).on({
              focusin() {
                $(`#${aInstance.Nom.escapeJQ()} .liste-focus-grid`).attr(
                  'tabindex',
                  '-1',
                );
              },
              focusout() {
                $(`#${aInstance.Nom.escapeJQ()} .liste-focus-grid`).attr(
                  'tabindex',
                  '0',
                );
              },
              focus(aEvent) {
                if (!aEvent.relatedTarget) {
                  return;
                }
                if (
                  aEvent.relatedTarget &&
                  aEvent.relatedTarget !== this &&
                  $(this).find(aEvent.relatedTarget).length > 0
                ) {
                  return;
                }
                aInstance.startNavigationContenu();
              },
            });
          },
          getNodeAferToolbar() {
            const lTabElements =
              ObjetHtml_1.GHtml.getElementsFocusablesDElement(this.node);
            lTabElements.forEach(function (aNode, aIndex) {
              $(aNode).attr('tabindex', aIndex === 0 ? 0 : -1);
              $(aNode).on({
                'keyup.listetoolbar'(aEvent) {
                  if (
                    ToucheClavier_1.ToucheClavierUtil.estToucheFleche(
                      aEvent.which,
                    ) ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.Debut ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.Fin
                  ) {
                    aEvent.stopImmediatePropagation();
                    let lNav;
                    switch (aEvent.which) {
                      case ToucheClavier_1.ToucheClavier.FlecheGauche:
                        lNav =
                          ObjetWAI_1.ObjetWAI.ModeRechercheNavigation.prevCycle;
                        break;
                      case ToucheClavier_1.ToucheClavier.FlecheDroite:
                        lNav =
                          ObjetWAI_1.ObjetWAI.ModeRechercheNavigation.nextCycle;
                        break;
                      case ToucheClavier_1.ToucheClavier.Debut:
                        lNav =
                          ObjetWAI_1.ObjetWAI.ModeRechercheNavigation.first;
                        break;
                      case ToucheClavier_1.ToucheClavier.Fin:
                        lNav = ObjetWAI_1.ObjetWAI.ModeRechercheNavigation.last;
                        break;
                      default:
                        return;
                    }
                    const lNextNode =
                      ObjetWAI_1.GObjetWAI.getNodeRechercheNavigation(
                        lTabElements,
                        this,
                        lNav,
                      );
                    this.setAttribute('tabindex', '-1');
                    if (lNextNode) {
                      lNextNode.setAttribute('tabindex', '0');
                      lNextNode.focus();
                    }
                  }
                },
                focusin(aEvent) {
                  if (lTabElements.includes(aEvent.target)) {
                    aEvent.target.setAttribute('tabindex', '0');
                  }
                },
              });
            });
          },
          nodeBtnEnteteLibre: function (aIndex) {
            const lElement = aInstance._cache.boutons[aIndex];
            if (lElement && lElement.html) {
              ObjetHtml_1.GHtml.setHtml(this.node, lElement.html, {
                controleur: lElement.controleur,
              });
            }
          },
          btnCreationEntete: {
            event: function (aEvent) {
              if (aInstance.Donnees.avecEvenementCreation()) {
                aInstance.surCreationEvenement(-1, {
                  nodeBouton: this.node,
                  event: aEvent,
                });
              } else if (
                aInstance.ListeCreations &&
                aInstance.ListeCreations.length === 1
              ) {
                aInstance.surCreationDeb(false, { creationEnFenetre: true });
              } else {
              }
            },
            getDisabled: function () {
              return aInstance._getNonEditable();
            },
          },
          boutonListe: {
            event(aIndex, aEvent) {
              const lBouton = aInstance._cache.boutons[aIndex];
              const lParams = {
                bouton: lBouton,
                event: aEvent,
                liste: aInstance,
                node: this.node,
              };
              lBouton.event(lParams);
            },
            getDisabled(aIndex) {
              const lBouton = aInstance._cache.boutons[aIndex];
              return lBouton.getDisabled
                ? lBouton.getDisabled({
                    bouton: lBouton,
                    node: this.node,
                    liste: aInstance,
                  })
                : false;
            },
            getSelection(aIndex) {
              const lBouton = aInstance._cache.boutons[aIndex];
              return lBouton.getSelection
                ? lBouton.getSelection({
                    bouton: lBouton,
                    node: this.node,
                    liste: aInstance,
                  })
                : false;
            },
            getVisible(aIndex) {
              const lBouton = aInstance._cache.boutons[aIndex];
              if (lBouton.getVisible) {
                return lBouton.getVisible({
                  bouton: lBouton,
                  node: this.node,
                  liste: aInstance,
                });
              }
              return true;
            },
            getClass(aIndex) {
              const lBouton = aInstance._cache.boutons[aIndex];
              if (lBouton.getClass) {
                return lBouton.getClass({
                  bouton: lBouton,
                  node: this.node,
                  liste: aInstance,
                });
              }
              return '';
            },
          },
          getNodeFiltres() {
            const lDonnees = aInstance.Donnees;
            const lHtml = lDonnees._construireFiltres();
            if (lHtml) {
              ObjetHtml_1.GHtml.setHtml(this.node, lHtml, {
                controleur: lDonnees._getControleurFiltres(lDonnees, aInstance),
              });
            }
          },
          btnReinitFiltres: {
            event() {
              aInstance.Donnees.reinitFiltres();
            },
          },
          rechercheTexte: {
            getValue: function () {
              return aInstance.getRechercheTexte();
            },
            setValue: function (aValue) {
              aInstance.setRechercheTexte(aValue);
            },
            node: function () {
              $(this.node).on({
                focusout: function () {
                  if (aInstance._estRechercheTexteVide()) {
                    aInstance._annulerRechercheTexte();
                  }
                },
                keyup: function (aEvent) {
                  if (aEvent.which === ToucheClavier_1.ToucheClavier.Echap) {
                    aInstance._annulerRechercheTexte();
                    aEvent.stopPropagation();
                    return;
                  }
                },
              });
            },
          },
          btnRechercheTexte: {
            event: function () {
              aInstance._annulerRechercheTexte();
            },
          },
          getHtmlResultRecherche() {
            return aInstance._cache.strResultRecherche;
          },
          saisieTexte: {
            getValue: function () {
              return aInstance._valeurEnEdition;
            },
            setValue: function (
              aLigne,
              aColonne,
              aEnCreation,
              aEstNote,
              aEstTextareaMax,
              aIgnorerEventsNode,
              aValue,
            ) {
              aInstance._setValueModel({
                ligne: aLigne,
                colonne: aColonne,
                surCreation: aEnCreation,
                node: this.node,
                value: aValue,
              });
            },
            getNote() {
              return aInstance._valeurEnEdition;
            },
            setNote: function (
              aLigne,
              aColonne,
              aEnCreation,
              aEstNote,
              aEstTextareaMax,
              aIgnorerEventsNode,
              aNote,
            ) {
              if (
                aInstance.optionsInterne.versionMobile &&
                aEstNote &&
                aNote === null &&
                aInstance._cache.finEditionCreation
              ) {
                aInstance._cache.finEditionCreation();
                return;
              }
              aInstance._setValueModel({
                ligne: aLigne,
                colonne: aColonne,
                surCreation: aEnCreation,
                node: this.node,
                value: aNote,
                estNote: aEstNote,
              });
              if (
                aInstance.optionsInterne.versionMobile &&
                aEstNote &&
                aInstance._cache.finEditionCreation
              ) {
                aInstance._cache.finEditionCreation();
              }
            },
            getOptionsNote: function (aLigne, aColonne, aEnCreation) {
              if (aInstance.Donnees) {
                return (
                  aInstance.Donnees.getOptionsNote(
                    aInstance._getParamsCellule(aColonne, aLigne, {
                      surLigneCreation: aEnCreation,
                    }),
                  ) || null
                );
              }
            },
            fromDisplay: function (
              aLigne,
              aColonne,
              aEnCreation,
              aEstNote,
              aEstTextareaMax,
              aIgnorerEventsNode,
              aValue,
            ) {
              if (aEstNote) {
                return aValue;
              }
              const lControle = aInstance.Donnees
                ? aInstance.Donnees.getControleCaracteresInput(
                    aInstance._getParamsCellule(aColonne, aLigne, {
                      surLigneCreation: aEnCreation,
                    }),
                  )
                : null;
              if (lControle && lControle.fromDisplay) {
                aValue = lControle.fromDisplay(aColonne, aLigne, aValue);
              }
              return aValue;
            },
            toDisplay: function (
              aLigne,
              aColonne,
              aEnCreation,
              aEstNote,
              aEstTextareaMax,
              aIgnorerEventsNode,
              aValue,
            ) {
              if (aEstNote) {
                return aValue;
              }
              const lControle = aInstance.Donnees
                ? aInstance.Donnees.getControleCaracteresInput(
                    aInstance._getParamsCellule(aColonne, aLigne, {
                      surLigneCreation: aEnCreation,
                    }),
                  )
                : null;
              if (lControle && lControle.toDisplay) {
                aValue = lControle.toDisplay(aColonne, aLigne, aValue);
              }
              return aValue;
            },
            node(
              aLigne,
              aColonne,
              aEnCreation,
              aEstNote,
              aEstTextareaMax,
              aIgnorerEventsNode,
            ) {
              aInstance._cache.avecModificationSaisie = false;
              const lForceSetNote =
                aEstNote && this.data.forceExitChange
                  ? () => {
                      const lParamsExit = {};
                      this.data.forceExitChange(lParamsExit);
                      if (
                        lParamsExit.resultValidation &&
                        !lParamsExit.resultValidation.estValide
                      ) {
                        if (aEnCreation) {
                          aInstance._annulerCreation();
                        } else {
                          aInstance._surEditionFin({
                            colonne: aInstance._cache.selectionCellule.colonne,
                            ligne: aInstance._cache.selectionCellule.ligne,
                          });
                          if (
                            lParamsExit.resultValidation.promiseMessageErreur
                          ) {
                            lParamsExit.resultValidation.promiseMessageErreur.then(
                              () => {
                                aInstance.demarrerEditionSurCellule(
                                  aInstance._cache.selectionCellule.ligne,
                                  aInstance._cache.selectionCellule.colonne,
                                );
                              },
                            );
                            return { avecMessagerErreur: true };
                          }
                        }
                      }
                    }
                  : null;
              aInstance._cache.finEditionCreation = function () {
                aInstance._cache.finEditionCreation = null;
                if (aEstNote && lForceSetNote) {
                  const lResultSetNote = lForceSetNote();
                  if (lResultSetNote) {
                    return lResultSetNote;
                  }
                }
                const lParams = aInstance._getParamsCellule(aColonne, aLigne, {
                  surEdition: true,
                });
                if (aEnCreation) {
                  aInstance._surCreation(aInstance._valeurEnEdition);
                } else {
                  aInstance._surEdition(
                    lParams,
                    aInstance._valeurEnEdition,
                    aInstance._cache.avecModificationSaisie,
                  );
                }
              };
              aInstance._cache.finEditionCreation.estCreation = aEnCreation;
              if (aIgnorerEventsNode) {
                return;
              }
              $(this.node).on({
                keydown: function (aEvent) {
                  delete aInstance._cache._keyDownSansNavigationFleche;
                  if (
                    aInstance._isToucheRetourChariot(aEvent) ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.Echap ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.Tab
                  ) {
                    if (
                      aEstNote &&
                      lForceSetNote &&
                      aEvent.which !== ToucheClavier_1.ToucheClavier.Echap
                    ) {
                      lForceSetNote();
                    }
                    aEvent.stopPropagation();
                    aEvent.preventDefault();
                    return false;
                  }
                  if (
                    aInstance.Donnees.options
                      .avecNavigationClavierFlechesEnEdition
                  ) {
                    const lNodeName = this.nodeName.toLowerCase();
                    if (
                      (lNodeName === 'input' || lNodeName === 'textarea') &&
                      ((aEvent.which ===
                        ToucheClavier_1.ToucheClavier.FlecheGauche &&
                        !aInstance._estCurseurEnBorneDeSelection(this, true)) ||
                        (aEvent.which ===
                          ToucheClavier_1.ToucheClavier.FlecheDroite &&
                          !aInstance._estCurseurEnBorneDeSelection(
                            this,
                            false,
                          )))
                    ) {
                      aInstance._cache._keyDownSansNavigationFleche = true;
                    }
                  }
                },
                keyup: function (aEvent) {
                  if (
                    aInstance._isToucheRetourChariot(aEvent) ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.Echap ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.Tab
                  ) {
                    if (aEvent.which === ToucheClavier_1.ToucheClavier.Echap) {
                      if (aEnCreation) {
                        aInstance._annulerCreation();
                      } else {
                        aInstance._surEditionFin({
                          colonne: aInstance._cache.selectionCellule.colonne,
                          ligne: aInstance._cache.selectionCellule.ligne,
                        });
                      }
                    } else {
                      if (aEstNote && lForceSetNote) {
                        if (lForceSetNote()) {
                          return;
                        }
                      }
                      const lParams = aInstance._getParamsCellule(
                        aColonne,
                        aLigne,
                        { surEdition: true },
                      );
                      let lParamSelecCelluleSuiv = null;
                      if (
                        aInstance.Donnees.options
                          .avecCelluleSuivanteSurFinEdition
                      ) {
                        lParamSelecCelluleSuiv =
                          aInstance.Donnees.getParametresSelectionnerCelluleSuivanteFinEdition(
                            lParams,
                          );
                        if (lParamSelecCelluleSuiv.entrerEdition) {
                          lParams.sansTriDonnees = true;
                        }
                      }
                      const lFuncSuite = () => {
                        if (
                          aInstance.Donnees.options
                            .avecCelluleSuivanteSurFinEdition
                        ) {
                          aInstance._selectionnerCelluleSuivante(
                            Object.assign(lParams, lParamSelecCelluleSuiv),
                          );
                          if (
                            lParams.sansTriDonnees &&
                            !aInstance._cache.editionEnCours &&
                            !aInstance._cache.editionEnCoursEvenement
                          ) {
                            aInstance._actualiser({
                              conserverSelection: true,
                              zonesActualisation: {
                                contenu: true,
                                total: true,
                              },
                              avecEvenementModificationSelection: false,
                            });
                          }
                        }
                      };
                      if (aEnCreation) {
                        aInstance._surCreation(aInstance._valeurEnEdition);
                        lFuncSuite();
                      } else {
                        const lResult = aInstance._surEdition(
                          lParams,
                          aInstance._valeurEnEdition,
                          aInstance._cache.avecModificationSaisie,
                          aInstance.Donnees.options
                            .avecEvnt_ApresEditionValidationSansModification,
                        );
                        if (lResult && lResult.then) {
                          lResult.then((aError) => {
                            if (aError && aError.annulerEdition) {
                            } else {
                              lFuncSuite();
                            }
                          });
                        } else {
                          lFuncSuite();
                        }
                      }
                    }
                    aEvent.stopPropagation();
                    return false;
                  }
                  if (aInstance._estToucheNavigationFlechesClavier(aEvent)) {
                    if (
                      aInstance.Donnees.options
                        .avecNavigationClavierFlechesEnEdition &&
                      !aInstance._cache._keyDownSansNavigationFleche
                    ) {
                      aInstance._navigationFlechesClavier(
                        aEvent,
                        aInstance._getParamsCellule(aColonne, aLigne, {
                          surEdition: true,
                          node: this,
                          event: aEvent,
                          avecCelluleEditable: true,
                          avecSelection: true,
                          entrerEdition: true,
                        }),
                      );
                    }
                    aEvent.stopPropagation();
                  }
                },
                'blur focusout': function () {
                  if (!aEstTextareaMax && aInstance._cache.finEditionCreation) {
                    aInstance._cache.finEditionCreation();
                  }
                },
                focusout_TextareaMax: function () {
                  if (aEstTextareaMax && aInstance._cache.finEditionCreation) {
                    aInstance._cache.finEditionCreation();
                  }
                },
              });
            },
          },
          getClassCellulePere(aLigne, aColonne) {
            const lParamsCellule = aInstance._getParamsCellule(
              aColonne,
              aLigne,
            );
            return (
              aInstance.Donnees._getClassCelluleConteneur(lParamsCellule) || ''
            );
          },
          attrCellule(aLigne, aColonne, aRoleGrid) {
            const lAttr = {};
            const lParams = aInstance._getParamsCellule(aColonne, aLigne);
            if (aInstance.Donnees.enConstruction_cacheRechercheTexte) {
              return lAttr;
            }
            if (aInstance.Donnees._avecSelection(lParams)) {
              lAttr['aria-selected'] = !!aInstance._etatSelectionCellule({
                ligne: aLigne,
                colonne: aColonne,
              });
            }
            if (
              !aRoleGrid &&
              aInstance.Donnees instanceof
                ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign &&
              aInstance.Donnees.options.avecCocheCBSurLigne &&
              aInstance.Donnees.avecCB(lParams)
            ) {
              const lVal = aInstance._getValueCBFlatDesign(aLigne);
              lAttr['aria-checked'] =
                lVal === ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Grise
                  ? 'mixed'
                  : aInstance._getValueCBFlatDesign(aLigne) === true;
              if (aInstance.Donnees.getDisabledCB(lParams)) {
                lAttr['aria-disabled'] = true;
              } else {
                lAttr['aria-disabled'] = null;
                aInstance._cache.avecWAICocheLigne = true;
              }
            }
            return lAttr;
          },
          modeleSelecFileCellule: {
            getOptionsSelecFile(aLigne, aColonne, aSurCreation, aGetSelecFile) {
              const lParams = aInstance._getParamsCellule(aColonne, aLigne, {
                surCreation: aSurCreation,
              });
              const lOptions = Object.assign(
                {
                  classDrag: 'selecfile_classDrag',
                  classDragHoverSelec: 'selecfile_classDrag_survol',
                },
                aInstance.Donnees.getOptionsSelecFile(lParams),
              );
              if (
                lOptions.eventClick !== false &&
                !aInstance.optionsInterne.versionMobile
              ) {
                aInstance._cache.ouvrirSelecteurFileParLigne[
                  aLigne + '_' + aColonne
                ] = aGetSelecFile();
              }
              return lOptions;
            },
            addFiles(aLigne, aColonne, aSurCreation, aParamsFiles) {
              const lParamsCellule = aInstance._getParamsCellule(
                aColonne,
                aLigne,
                { surCreation: aSurCreation },
              );
              if (aSurCreation && aInstance.ListeCreations.length === 1) {
                aParamsFiles.listeFichiers.parcourir((aFichier) => {
                  aInstance.ajouterElementCreation(aFichier.Libelle, aFichier);
                });
                return true;
              }
              return aInstance.Donnees.evenementSurSelecFile(
                lParamsCellule,
                aParamsFiles,
              );
            },
          },
          btnEllipsisLigne: {
            event: function (aNumeroLigne) {
              const lParams = aInstance._getParamsCellule(-1, aNumeroLigne);
              if (aInstance.Donnees.avecMenuContextuel(lParams)) {
                lParams.node = this.node;
                aInstance._ouvrirMenuContextuel(lParams);
              }
            },
          },
          nodeDeploiementLigne: function (aLigne, aColonne) {
            $(this.node).eventValidation((aEvent) => {
              aInstance.surDeploiement(aEvent, aColonne, aLigne, true);
            });
          },
          cb_ligne_flatDesign: {
            getValue: function (aLigne) {
              const lResult = aInstance._getValueCBFlatDesign(aLigne);
              return lResult === true;
            },
            getIndeterminate: function (aLigne) {
              return (
                aInstance._getValueCBFlatDesign(aLigne) ===
                ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Grise
              );
            },
            setValue: function (aLigne, aValue) {
              let lValue = aValue;
              if (
                aInstance._getValueCBFlatDesign(aLigne) ===
                ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Grise
              ) {
                lValue = !aInstance._getValueCBFlatDesign(aLigne, true);
              }
              aInstance.setValueCBFlatDesignEvent(
                aInstance._getParamsCellule(-1, aLigne),
                lValue,
              );
            },
            getDisabled: function (aLigne) {
              if (aInstance._getNonEditable()) {
                return true;
              }
              if (
                aLigne < 0 &&
                (!aInstance._cache.lignesVisibles ||
                  aInstance._cache.lignesVisibles.length === 0)
              ) {
                return true;
              }
              if (
                aLigne >= 0 &&
                aInstance.Donnees.getDisabledCB(
                  aInstance._getParamsCellule(-1, aLigne),
                )
              ) {
                return true;
              }
              return false;
            },
            getAttr(aLigne) {
              let lLabel = '';
              if (aLigne < 0) {
                if (
                  aInstance._options.avecCBToutCocher ===
                  ObjetListe.typeLibelleCocheCBEntete.vide
                ) {
                  lLabel = $(this.node).hasClass('is-checked')
                    ? ObjetTraduction_1.GTraductions.getValeur(
                        'liste.toutDecocher',
                      )
                    : ObjetTraduction_1.GTraductions.getValeur(
                        'liste.toutCocher',
                      );
                } else if (
                  aInstance._options.avecCBToutCocher ===
                    ObjetListe.typeLibelleCocheCBEntete.compteurSelec &&
                  aInstance.getListeArticlesCochees().count() === 0
                ) {
                  lLabel =
                    ObjetTraduction_1.GTraductions.getValeur(
                      'liste.toutCocher',
                    );
                }
              } else {
                lLabel =
                  aInstance._getValueCBFlatDesign(aLigne) ===
                  ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Verte
                    ? ObjetTraduction_1.GTraductions.getValeur(
                        'liste.wai.DecocherLigne',
                      )
                    : ObjetTraduction_1.GTraductions.getValeur(
                        'liste.wai.CocherLigne',
                      );
              }
              return { 'aria-label': lLabel };
            },
            getHtmlCBEntete() {
              if (
                !aInstance._options.avecCBToutCocher ||
                aInstance._options.avecCBToutCocher ===
                  ObjetListe.typeLibelleCocheCBEntete.vide
              ) {
                return '';
              }
              if (
                typeof aInstance._options.avecCBToutCocher === 'object' &&
                'libelle' in aInstance._options.avecCBToutCocher
              ) {
                return aInstance._options.avecCBToutCocher.libelle || '';
              }
              switch (aInstance._options.avecCBToutCocher) {
                case true:
                case ObjetListe.typeLibelleCocheCBEntete.toutCocher: {
                  return $(this.node).hasClass('is-checked')
                    ? ObjetTraduction_1.GTraductions.getValeur(
                        'liste.toutDecocher',
                      )
                    : ObjetTraduction_1.GTraductions.getValeur(
                        'liste.toutCocher',
                      );
                }
                case ObjetListe.typeLibelleCocheCBEntete.compteurSelec: {
                  const lNb = aInstance.getListeArticlesCochees().count();
                  if (lNb <= 0) {
                    return '';
                  }
                  if (lNb === 1) {
                    return ObjetTraduction_1.GTraductions.getValeur(
                      'liste.ElementSelectionne_D',
                      [lNb],
                    );
                  }
                  return ObjetTraduction_1.GTraductions.getValeur(
                    'liste.ElementsSelectionnes_D',
                    [lNb],
                  );
                }
              }
              if (
                typeof aInstance._options.avecCBToutCocher === 'object' &&
                'getLibelle' in aInstance._options.avecCBToutCocher
              ) {
                return aInstance._options.avecCBToutCocher.getLibelle() || '';
              }
            },
          },
          cocheTitreClassique: {
            getValue(aColonne) {
              if (aInstance.Donnees) {
                const lEtatCoche = aInstance.Donnees.getEtatCocheSelonFils(
                  null,
                  aInstance._getParamsCellule(aColonne),
                );
                if (
                  lEtatCoche ===
                  ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Verte
                ) {
                  return true;
                }
              }
              return false;
            },
            setValue(aColonne, aVal) {
              aInstance._clickSurCocheTitre(aColonne);
            },
            getAttr(aColonne) {
              let lTitle = '';
              lTitle =
                ObjetTraduction_1.GTraductions.getValeur('liste.toutCocher');
              if (aInstance.Donnees) {
                const lEtatCoche = aInstance.Donnees.getEtatCocheSelonFils(
                  null,
                  aInstance._getParamsCellule(aColonne),
                );
                switch (lEtatCoche) {
                  case ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Aucune:
                    lTitle =
                      ObjetTraduction_1.GTraductions.getValeur(
                        'liste.toutCocher',
                      );
                    break;
                  case ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Verte:
                    lTitle =
                      ObjetTraduction_1.GTraductions.getValeur(
                        'liste.toutDecocher',
                      );
                    break;
                }
              }
              return { title: lTitle, 'aria-label': lTitle };
            },
          },
          nodeGabaritRefresh(aStart, aIndiceInfosColonne) {
            const lCacheRef = aInstance._cache.refresh;
            const lNom = aStart ? 'node_gab_start' : 'node_gab_end';
            if (!lCacheRef[lNom]) {
              lCacheRef[lNom] = {};
            }
            lCacheRef[lNom][aIndiceInfosColonne] = this.node;
            lCacheRef.observer.observe(this.node);
            lCacheRef.mapNodesObs.set(this.node, { gabarit: true });
            $(this.node).on('mousedown', () => {
              aInstance._refreshContenuDynamique();
            });
          },
          nodeObsRange(aStart, aIndiceRange, aIndiceInfosColonnees) {
            const lCacheRef = aInstance._cache.refresh;
            lCacheRef.observer.observe(this.node);
            lCacheRef.mapNodesObs.set(this.node, { gabarit: false });
            let lRange = lCacheRef.mapRangesExist.get(aIndiceRange);
            if (!lRange) {
              lRange = {};
              lCacheRef.mapRangesExist.set(aIndiceRange, lRange);
              lCacheRef.mapRangesExist.min = Math.min(
                aIndiceRange,
                lCacheRef.mapRangesExist.min,
              );
              lCacheRef.mapRangesExist.max = Math.max(
                aIndiceRange,
                lCacheRef.mapRangesExist.max,
              );
            }
            if (aIndiceInfosColonnees === 0) {
              lRange[aStart ? 'node_start' : 'node_end'] = this.node;
            }
            $(this.node).on('destroyed', function () {
              lCacheRef.mapNodesObs.delete(this);
              if (aIndiceInfosColonnees === 0) {
                lCacheRef.mapRangesExist.delete(aIndiceRange);
                let lMin = Number.MAX_VALUE;
                let lMax = -1;
                for (const lKey of lCacheRef.mapRangesExist.keys()) {
                  lMin = Math.min(lKey, lMin);
                  lMax = Math.max(lKey, lMax);
                }
                lCacheRef.mapRangesExist.min = lMin;
                lCacheRef.mapRangesExist.max = lMax;
              }
            });
            if (lCacheRef.structure[aIndiceRange].height < 0) {
              aInstance._actualiserHeightRanges(aIndiceRange);
            }
          },
          nodeTotalFd(aNumeroLigne, aNumeroColonne) {
            $(this.node).on({
              mousedown(aEvent) {
                aInstance._surEventDownLigne({
                  event: aEvent,
                  ligne: aNumeroLigne,
                  colonne: aNumeroColonne,
                });
              },
              click() {
                const lParams = aInstance._getParamsCellule(
                  aNumeroColonne,
                  aNumeroLigne,
                );
                if (aInstance.evenementSelectionClick(lParams)) {
                  return;
                }
              },
              keyup(aEvent) {
                if (
                  ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent)
                ) {
                  aInstance._surSelection(aNumeroColonne, aNumeroLigne, {
                    surInteractionUtilisateur: true,
                  });
                  aInstance.surSelectionEvenement(
                    aNumeroColonne,
                    aNumeroLigne,
                    true,
                  );
                  aInstance._editionDebSurSelection(
                    aNumeroColonne,
                    aNumeroLigne,
                    aEvent,
                  );
                }
              },
            });
          },
          attrTotalFd(aNumeroLigne, aNumeroColonne, aAvecSelection) {
            const lAttrs = {};
            if (aAvecSelection) {
              lAttrs['aria-pressed'] = !!aInstance._etatSelectionCellule({
                ligne: aNumeroLigne,
                colonne: aNumeroColonne,
              });
            }
            return lAttrs;
          },
          getHtmlDescribeTreeGrid() {
            const T = [];
            if (aInstance._cache.avecWAICocheLigne) {
              T.push(
                IE.jsx.str(
                  'span',
                  null,
                  ObjetTraduction_1.GTraductions.getValeur(
                    'liste.wai.ModifierCoche',
                  ),
                ),
              );
            }
            return T.join('');
          },
        };
        return $.extend(true, super.getControleur(aInstance), {
          liste: lControleur,
        });
      }
      recupererDonnees() {
        this._cache.listeNonInitialisee = true;
      }
      _ouvrirFenetreParametrageColonnes() {}
      _preparerBoutons(aParams) {
        this._cache.boutons = [];
        if (this._options.boutons && this._options.boutons.forEach) {
          this._options.boutons.forEach((aBouton) => {
            if (!aBouton) {
              return;
            }
            if (aBouton.html) {
              this._cache.boutons.push(aBouton);
              return;
            }
            const lBouton = {
              event: null,
              getDisabled: null,
              getSelection: null,
              estBoutonPiedFlottant_mobile: false,
              class: '',
              title: '',
              id: this.Nom + '_btnliste_' + this._cache.boutons.length,
            };
            switch (aBouton.genre) {
              case ObjetListe.typeBouton.monter:
                lBouton.class = 'icon_chevron_up';
                lBouton.title = ObjetTraduction_1.GTraductions.getValeur(
                  'liste.HintBoutonMonter',
                );
                lBouton.getDisabled = () => {
                  if (
                    !this.Donnees ||
                    this.getListeElementsSelection().count() !== 1 ||
                    this._getNonEditable()
                  ) {
                    return true;
                  }
                  const lParamsCelluleSource = this._getParamsCellule(
                    -1,
                    this.getSelection(),
                  );
                  const lParamsCelluleDest =
                    this._rechercheDeplacementPrecedenteSuivant(
                      lParamsCelluleSource,
                      false,
                    );
                  return !lParamsCelluleDest || !lParamsCelluleDest.article;
                };
                lBouton.event = () => {
                  const lParamsCelluleSource = this._getParamsCellule(
                    -1,
                    this.getSelection(),
                  );
                  const lParamsCelluleDest =
                    this._rechercheDeplacementPrecedenteSuivant(
                      lParamsCelluleSource,
                      false,
                    );
                  if (lParamsCelluleDest) {
                    this._surDeplacementLigneSurAutreLigne(
                      lParamsCelluleDest,
                      lParamsCelluleSource,
                    );
                  }
                };
                break;
              case ObjetListe.typeBouton.descendre:
                lBouton.class = 'icon_chevron_down';
                lBouton.title = ObjetTraduction_1.GTraductions.getValeur(
                  'liste.HintBoutonDescendre',
                );
                lBouton.getDisabled = () => {
                  if (
                    !this.Donnees ||
                    this.getListeElementsSelection().count() !== 1 ||
                    this._getNonEditable()
                  ) {
                    return true;
                  }
                  const lParamsCelluleSource = this._getParamsCellule(
                    -1,
                    this.getSelection(),
                  );
                  const lParamsCelluleDest =
                    this._rechercheDeplacementPrecedenteSuivant(
                      lParamsCelluleSource,
                      true,
                    );
                  return !lParamsCelluleDest || !lParamsCelluleDest.article;
                };
                lBouton.event = () => {
                  const lParamsCelluleSource = this._getParamsCellule(
                    -1,
                    this.getSelection(),
                  );
                  const lParamsCelluleDest =
                    this._rechercheDeplacementPrecedenteSuivant(
                      lParamsCelluleSource,
                      true,
                    );
                  if (lParamsCelluleDest) {
                    this._surDeplacementLigneSurAutreLigne(
                      lParamsCelluleDest,
                      lParamsCelluleSource,
                    );
                  }
                };
                break;
              case ObjetListe.typeBouton.deployer:
                if (
                  aBouton.cacherSansDeploiement === true &&
                  !this._existeDeploiementDansListe()
                ) {
                  return false;
                }
                lBouton.deploye = null;
                lBouton.class = 'btn-deploiement-entete defaut';
                lBouton.title = ObjetTraduction_1.GTraductions.getValeur(
                  'liste.HintBoutonDeploiement',
                );
                lBouton.getDisabled = () => {
                  return (
                    this._avecDeploiementDesactive() ||
                    !this._existeDeploiementDansListe()
                  );
                };
                lBouton.getClass = (aParam) => {
                  let lEstDeploye = false;
                  if (
                    aParam.bouton.deploye === false ||
                    aParam.bouton.deploye === true
                  ) {
                    lEstDeploye = aParam.bouton.deploye;
                  } else {
                    lEstDeploye = this._getBoutonDeploye();
                  }
                  return lEstDeploye
                    ? 'icon_fleche_num_bas'
                    : 'icon_fleche_num';
                };
                lBouton.event = (aParam) => {
                  if (
                    aParam.bouton.deploye === false ||
                    aParam.bouton.deploye === true
                  ) {
                    aParam.bouton.deploye = !aParam.bouton.deploye;
                  } else {
                    aParam.bouton.deploye = !this._getBoutonDeploye();
                  }
                  if (this.Donnees && this.Donnees.Donnees) {
                    let lAvecModif = false;
                    this.Donnees.Donnees.parcourir((aElement, aLigne) => {
                      const lParams = this._getParamsCellule(-1, aLigne);
                      if (
                        this.Donnees.estUnDeploiement(lParams) &&
                        this._estLigneVisible(aLigne)
                      ) {
                        if (
                          this.Donnees._estDeploye(aLigne) ===
                          aParam.bouton.deploye
                        ) {
                          return;
                        }
                        lAvecModif = true;
                        this.Donnees.surDeploiement(-1, aLigne, aElement);
                        if (this.Donnees.avecEvenementDeploiement(lParams)) {
                          this.callback.appel(
                            this._getParamsCallback(
                              Enumere_EvenementListe_1.EGenreEvenementListe
                                .Deploiement,
                              -1,
                              aLigne,
                            ),
                            Enumere_EvenementListe_1.EGenreEvenementListe
                              .Deploiement,
                            -1,
                            aLigne,
                          );
                          this._refreshSelf();
                        }
                      }
                    });
                    if (lAvecModif) {
                      this._actualiser({
                        conserverSelection: true,
                        sansTriDonnees: true,
                        zonesActualisation: { contenu: true },
                      });
                      if (aParam.bouton.deploye === this._getBoutonDeploye()) {
                        aParam.bouton.deploye = null;
                      } else {
                      }
                    }
                  }
                };
                break;
              case ObjetListe.typeBouton.supprimer:
                lBouton.class = 'icon_trash';
                lBouton.title =
                  ObjetTraduction_1.GTraductions.getValeur('liste.supprimer');
                lBouton.getDisabled = (aParam) => {
                  return !this._avecSuppressionSelectionCourante(
                    this._cache.selectionCellule.ligne,
                    this._cache.selectionCellule.colonne,
                  );
                };
                lBouton.event = (aParam) => {
                  this._surSuppression();
                };
                break;
              case ObjetListe.typeBouton.editer:
                lBouton.class = 'icon_pencil';
                lBouton.title =
                  ObjetTraduction_1.GTraductions.getValeur('liste.modifier');
                lBouton.getDisabled = () => {
                  if (
                    this._getNonEditable() ||
                    this._cache.editionEnCours ||
                    !this.Donnees
                  ) {
                    return true;
                  }
                  const lParams = this._getParamsCellule(
                    this._cache.selectionCellule.colonne,
                    this._cache.selectionCellule.ligne,
                    { surEdition: true },
                  );
                  return !this.Donnees.avecEdition(lParams);
                };
                lBouton.event = (aParam) => {
                  this.demarrerEditionSurCellule(
                    this._cache.selectionCellule.ligne,
                    this._cache.selectionCellule.colonne,
                  );
                };
                break;
              case ObjetListe.typeBouton.filtrer: {
                Object.assign(lBouton, {
                  class: 'icon_filtre',
                  title:
                    ObjetTraduction_1.GTraductions.getValeur('liste.Filtrer'),
                  event: async (aParams) => {
                    this._options.avecFiltresVisibles =
                      !this._options.avecFiltresVisibles;
                    this._actualiser({
                      conserverSelection: true,
                      sansTriDonnees: true,
                      conserverPositionScroll: false,
                    });
                    ObjetHtml_1.GHtml.setFocus(aParams.node.id, true);
                  },
                  getVisible: () => {
                    return true;
                  },
                  getSelection: () => {
                    return !!this._options.avecFiltresVisibles;
                  },
                  getDisabled: () => {
                    return !(this.Donnees && this.Donnees.construireFiltres);
                  },
                  getClass: () => {
                    if (
                      this.Donnees &&
                      this.Donnees.estFiltresParDefaut &&
                      !this.Donnees.estFiltresParDefaut()
                    ) {
                      return 'mix-icon_rond i-orange';
                    }
                    return '';
                  },
                });
                break;
              }
              case ObjetListe.typeBouton.parametrer:
                lBouton.class = 'icon_wrench';
                lBouton.title = ObjetTraduction_1.GTraductions.getValeur(
                  'liste.HintBoutonParametre',
                );
                lBouton.event = (aParam) => {
                  this._ouvrirFenetreParametrageColonnes();
                };
                lBouton.getDisabled = function () {
                  return false;
                };
                break;
              case ObjetListe.typeBouton.exportCSV:
                if (aParams && aParams.createExportCSV) {
                  aParams.createExportCSV(lBouton);
                } else {
                  return;
                }
                break;
              case ObjetListe.typeBouton.rechercher:
                lBouton.class = 'icon_search';
                lBouton.title =
                  ObjetTraduction_1.GTraductions.getValeur('liste.Rechercher');
                lBouton.widthInput = 0;
                lBouton.getDisabled = () => {
                  return this._cache.lignesVisibles.length === 0;
                };
                lBouton.event = () => {
                  this._creerZoneRechercheTexte(true);
                };
                break;
            }
            Object.assign(lBouton, aBouton);
            if (!lBouton.class && !lBouton.getClass) {
              return;
            }
            if (!lBouton.event) {
              return;
            }
            this._cache.boutons.push(lBouton);
          });
        }
      }
      _getInfosZonesColonnes(aCache) {}
      _construireAffichage() {
        return '';
      }
      construireAffichage(aParamsActualiser) {
        this._cache.survoleTitreTriVisible = false;
        this._cache.ouvrirSelecteurFileParLigne = {};
        this._cache.avecWAICocheLigne = false;
        this._cache.gridTotalAccess = { nav: null, ordres: [] };
        if (!ObjetHtml_1.GHtml.elementExiste(this.Nom)) {
          return '';
        }
        if (!this._cache.largeurPage && this._cache.avecPourcentage) {
          return '';
        }
        if (!this.ListeTailles || this.ListeTailles.length === 0) {
          return '';
        }
        if (this._options.avecListeNeutre === undefined) {
          this._options.avecListeNeutre =
            $('#' + this.Nom.escapeJQ()).parents(
              '#' + IEZoneFenetre_1.ZoneFenetre.idZoneFenetre.escapeJQ(),
            ).length > 0;
          this._options.couleursListe = this._options.avecListeNeutre
            ? GCouleur.listeNeutre
            : GCouleur.liste;
        }
        this._initCacheLignes(aParamsActualiser);
        return this._construireAffichage();
      }
      composeWAICommun() {
        return IE.jsx.str(
          'span',
          { class: 'sr-only', 'aria-hidden': 'true' },
          IE.jsx.str(
            'span',
            { class: 'sr-only', id: this.ids.WAICelluleEditable },
            ObjetWAI_1.GObjetWAI.getInfo(ObjetWAI_1.EGenreObjet.AvecEdition),
          ),
          IE.jsx.str('span', {
            class: 'sr-only',
            id: this.ids.WAIDescribeTreeGrid,
            'ie-html': 'liste.getHtmlDescribeTreeGrid',
          }),
          IE.jsx.str(
            'span',
            { class: 'sr-only', id: this.ids.WAIDescribeTri },
            ObjetTraduction_1.GTraductions.getValeur(
              'liste.wai.DescriptionTri',
            ),
          ),
          IE.jsx.str(
            'span',
            { class: 'sr-only', id: this.ids.WAIDescribeTreeGridTotal },
            ObjetTraduction_1.GTraductions.getValeur('liste.total'),
          ),
          IE.jsx.str(
            'span',
            { class: 'sr-only', id: this.ids.WAILigneLue },
            ObjetTraduction_1.GTraductions.getValeur('liste.wai.Lu'),
          ),
        );
      }
      _composeImpression(aProportion) {
        return '';
      }
      _gererModificationsColonnes() {
        this._cache.listeCorrespondancesColonnes = [];
      }
      _backupScroll(aParams) {
        return null;
      }
      _setScroll(aBackupScroll, aSurResizeHeightContenu) {}
      _construireContenuRange(aInfosColonnes, aIndiceRange) {}
      _controleHeightLigne() {}
      _setStyleCellule(aId, aColonne, aLigne, aSelectionne, aCreation) {
        if (aId) {
          const lJCellule = ObjetHtml_1.GHtml.estElement(aId)
            ? $(aId)
            : $('#' + aId.escapeJQ());
          if (aSelectionne) {
            lJCellule.addClass('selected');
          } else {
            lJCellule.removeClass('selected');
          }
        }
      }
      _ouvrirMenuContextuel(aParams) {
        let lId;
        let lRect;
        if (aParams.surLigneCreation) {
          let lIdLigneCreation = '';
          if (this._options.avecCreationEnBoutonDesignClassique) {
            lIdLigneCreation = this.ids.btnCreation;
          } else {
            lIdLigneCreation = this._getIdCreation(
              this._cache.infosZonesColonnes[0]
                ? this._cache.infosZonesColonnes[0].colonnesVisibles[0]
                : 0,
              aParams.ligne,
            );
            if (!ObjetHtml_1.GHtml.getElement(lIdLigneCreation)) {
              lIdLigneCreation = this._getIdCreation(
                this.ListeCreations[0],
                aParams.ligne,
              );
            }
          }
          lRect = ObjetPosition_1.GPosition.getClientRect(lIdLigneCreation);
          lId = {
            x: lRect.x,
            y: this._options.avecCreationEnBoutonDesignClassique
              ? lRect.bottom + 5
              : lRect.y,
          };
        }
        if (aParams.node) {
          lRect = ObjetPosition_1.GPosition.getClientRect(aParams.node);
          lId = { x: lRect.x, y: lRect.bottom + 5 };
        } else if (aParams.event && aParams.event.type === 'contextmenu') {
          lId = { x: aParams.event.pageX + 5, y: aParams.event.pageY + 5 };
        }
        const lParametres = Object.assign(
          {
            id: lId,
            avecCreation: this._options.avecLigneCreation,
            nonEditable: this._getNonEditable(),
            avecSuppression: this._options.AvecSuppression,
            listeSelection: this._getListeElementsSelection(),
            tableauSelection: this.getTableauCellulesSelection(),
            copier: this.optionsInterne.copierCellule,
            coller: this.optionsInterne.collerCellule,
            liste: this,
          },
          aParams,
        );
        ObjetMenuContextuel_1.ObjetMenuContextuel.afficher({
          pere: this,
          evenement: this._evenementMenuContextuel.bind(this, lParametres),
          initCommandes: function (aInstance) {
            this.Donnees.initialisationObjetContextuel(
              Object.assign({ menuContextuel: aInstance }, lParametres),
            );
          },
          affichageSurInitCommandes: true,
          surKeyPress: (aEvent) => {
            if (
              this.Pere &&
              this.Evenement &&
              this.Donnees &&
              this.Donnees.options &&
              this.Donnees.options.avecEvnt_KeyPressListe
            ) {
              const lResult = this.callback.appel({
                instance: this,
                event: aEvent,
                genreEvenement:
                  Enumere_EvenementListe_1.EGenreEvenementListe.KeyPressListe,
              });
              this._refreshSelf();
              return lResult;
            }
            return false;
          },
          surKeyUp: (aEvent) => {
            if (
              this.Pere &&
              this.Evenement &&
              this.Donnees &&
              this.Donnees.options &&
              this.Donnees.options.avecEvnt_KeyUpListe
            ) {
              const lResult = this.callback.appel({
                instance: this,
                event: aEvent,
                genreEvenement:
                  Enumere_EvenementListe_1.EGenreEvenementListe.KeyUpListe,
              });
              this._refreshSelf();
              return lResult;
            }
            return false;
          },
          options: { preventScrollSurRestaurationFocus: true },
        });
      }
      _entrerDateCalendrier(aParams) {}
      _testUnitaireGetIdCreation(I, J) {
        return this._getIdCreation(I, J);
      }
      getIdCelluleTotal(aColonne, aLigne, aPourCell) {
        return `${this.Nom}_CelluleTotal_${aColonne}_${aLigne}${aPourCell ? '_cell' : ''}`;
      }
      static initColonne(aPourcentage, aMinPx, aMaxPx) {
        return { valeur: aPourcentage, min: aMinPx, max: aMaxPx };
      }
      static getTitreCreation(aTitre) {
        const T = [];
        T.push(
          `<i class="icon_plus_cercle liste-creation" role="presentation"></i>`,
        );
        T.push(
          '<div class="EspaceGauche InlineBlock AlignementMilieuVertical" style="',
          ObjetStyle_1.GStyle.composeCouleurTexte(GCouleur.texteListeCreation),
          '">',
          aTitre,
          '</div>',
        );
        return T.join('');
      }
      _setRechercheSaisie(aVal) {
        this._cache.rechercheTexte.saisie = aVal || '';
      }
      _setOptionsListe(aOptions, aAvecActualisation) {
        if (aOptions && aOptions.skin) {
          this._affecterOptionsSkin(aOptions);
        }
        if (aOptions.colonnesCachees) {
          this._options.colonnesCachees = [];
        }
        $.extend(this._options, aOptions);
        if (aOptions && aOptions.colonnes) {
          this._cache.declarationsColonnes = [].concat(aOptions.colonnes);
          this._cache.colonnes.listeIds = [];
          this._cache.colonnes.listeTailles = [];
          this._cache.declColonnesByIds = {};
          const lControleIds = {};
          let lIndex = 0;
          for (const aIndex in aOptions.colonnes) {
            const D = aOptions.colonnes[aIndex];
            if (!D) {
              continue;
            }
            if (D.id === undefined) {
              D.id = aIndex.toString();
            }
            lControleIds[D.id] = true;
            this._cache.colonnes.listeIds[lIndex] = D.id;
            this._cache.colonnes.listeTailles[lIndex] = D.taille || 0;
            this._cache.declColonnesByIds[D.id] = D;
            lIndex += 1;
          }
        }
        this._options.couleursListe = this._options.avecListeNeutre
          ? GCouleur.listeNeutre
          : GCouleur.liste;
        this._cache.calculsPreRenduAFaire = true;
        this._cache.calculsTailleColonnesAFaire = true;
        if (aAvecActualisation === true) {
          this._actualiser({ conserverSelection: true, sansTriDonnees: true });
        }
        return this;
      }
      _affecterOptionsSkin(aOptions) {
        switch (aOptions.skin) {
          case ObjetListe.skin.classique:
            break;
          case ObjetListe.skin.alternance:
            Object.assign(this._options, {
              alternanceCouleurLigneContenu: true,
              avecCouleurAlternanceParDefaut: true,
              avecTraitSeparationDeploiementAlternance: true,
              avecCadreSelection: false,
              ignorerCouleurInlineCellule: false,
              hauteurAdapteContenu: true,
              nonEditable: true,
            });
            break;
          case ObjetListe.skin.flatDesign:
            if (!aOptions.colonnes) {
              aOptions.colonnes = [{ taille: '100%' }];
            }
            Object.assign(this._options, {
              nonEditable: false,
              AvecSuppression: false,
              positionBoutons: NSListe.positionBoutons.entete,
              avecCadreSelection: false,
              paddingCelluleLR: 1,
              paddingCelluleTB: 1,
              borduresCellule_horizontal: 0,
              borduresCellule_vertical: 0,
              borduresContenu_top: 0,
              borduresContenu_bottom: 0,
              borduresContenu_left: 0,
              borduresContenu_right: 0,
              paddingContenu_LR: this.optionsInterne.versionMobile ? 0 : 3,
              ignorerCouleurInlineCellule: true,
            });
            break;
          default:
        }
      }
      _getValueCBFlatDesign(aLigne, aIgnorerCBDisabled) {
        if (!this.Donnees) {
          return false;
        }
        const lParams = this._getParamsCellule(-1, aLigne);
        const LDonneesListe = this.Donnees;
        return LDonneesListe.getEtatCocheSelonFils(
          lParams.article,
          lParams,
          (aParamsCellule) => {
            return (
              !this._cache.rechercheTexte.lignesCachees[aParamsCellule.ligne] &&
              LDonneesListe.avecCB(aParamsCellule) &&
              (!aIgnorerCBDisabled ||
                !LDonneesListe.getDisabledCB(aParamsCellule))
            );
          },
          aLigne === -1,
        );
      }
      _setValueCBFlatDesign(aParams, aValue, aParentCocheTout) {
        const LDonneesListe = this.Donnees;
        if (!aParams.article && aParams.ligne >= 0) {
          return false;
        }
        if (aParams.ligne >= 0 && LDonneesListe.getDisabledCB(aParams)) {
          return false;
        }
        let lLigneCacheeRecherche = !!(
          aParams.article &&
          this._cache.rechercheTexte.lignesCachees[aParams.ligne]
        );
        if (
          aParams.article &&
          (!aParams.article.estUnDeploiement ||
            !LDonneesListe.estCocheSelonFilsSurLigneDeploiement(
              aParams.article,
            )) &&
          LDonneesListe.avecCB(aParams) &&
          !lLigneCacheeRecherche
        ) {
          LDonneesListe.setValueCB(aParams, aValue);
        }
        if (
          !aParams.article ||
          aParentCocheTout ||
          LDonneesListe.estCocheSelonFilsSurLigneDeploiement(aParams.article)
        ) {
          LDonneesListe.getArrayFilsVisiblesDePere(aParams.article).forEach(
            (aElementParcours) => {
              const lParams = Object.assign({}, aParams, aElementParcours);
              this._setValueCBFlatDesign(lParams, aValue, !aParams.article);
            },
          );
        }
      }
      setValueCBFlatDesignEvent(aParams, aValue) {
        const lResult = this._setValueCBFlatDesign(aParams, aValue);
        if (
          this.Donnees.options.avecEvnt_CB &&
          this.Evenement &&
          lResult !== false
        ) {
          this.callback.appel(
            this._getParamsCallback(
              Enumere_EvenementListe_1.EGenreEvenementListe.ModificationCBLigne,
              -1,
              aParams.ligne,
              { listeCochees: this.getListeArticlesCochees() },
            ),
            Enumere_EvenementListe_1.EGenreEvenementListe.ModificationCBLigne,
            -1,
            aParams.ligne,
          );
          this._refreshSelf();
        }
      }
      _modifierCBLigneFlatDesign(aParams) {
        this.setValueCBFlatDesignEvent(
          aParams,
          !this._getValueCBFlatDesign(aParams.ligne, true),
        );
        this._refreshSelf();
      }
      async _clickSurCocheTitre(aColonne) {
        const lDonneesListe = this.Donnees;
        if (!lDonneesListe) {
          return;
        }
        if (this._getNonEditable() || this._cache.editionEnCours) {
          return;
        }
        const lEtatCoche = lDonneesListe.getEtatCocheSelonFils(
            null,
            this._getParamsCellule(aColonne),
          ),
          lValeur =
            lEtatCoche !==
            ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Verte,
          lLignes = lDonneesListe.getTableauLignesModifieesCocheTitre(
            aColonne,
            lValeur,
          );
        let lParams;
        const lListeParamsCellules = [];
        for (let i = 0; i < lLignes.length; i++) {
          lParams = this._getParamsCellule(aColonne, lLignes[i]);
          if (
            lParams.article &&
            lDonneesListe.avecEdition(lParams) &&
            !lDonneesListe.editionRefusee(lParams)
          ) {
            lListeParamsCellules.push(lParams);
          }
        }
        await lDonneesListe.surEditionCocheTitre(lListeParamsCellules, lValeur);
        this._actualiser({
          conserverSelection: true,
          zonesActualisation: { contenu: true, total: true },
        });
        this.surApresEditionEvenement(
          this._getParamsCellule(aColonne, -1, { avecModification: true }),
        );
        this._refreshSelf();
      }
      _getNonEditable() {
        return (
          !this.Donnees ||
          this._options.nonEditable ||
          (this._options.nonEditableSurModeExclusif &&
            GApplication.getModeExclusif())
        );
      }
      _isToucheRetourChariot(aEvent) {
        return (
          aEvent &&
          aEvent.which === ToucheClavier_1.ToucheClavier.RetourChariot &&
          !aEvent.shiftKey &&
          !aEvent.altKey &&
          !aEvent.ctrlKey
        );
      }
      _estCurseurEnBorneDeSelection(aElement, aDebut) {
        if (aElement) {
          if (document.selection) {
            const LCurseurCourant = document.selection.createRange();
            const LCurseurElement = aElement.createTextRange();
            LCurseurElement.collapse(true);
            return (
              LCurseurCourant.boundingWidth === 0 &&
              LCurseurCourant.boundingLeft === LCurseurElement.boundingLeft
            );
          }
          if (
            aElement.selectionStart !== null &&
            aElement.selectionStart !== undefined &&
            aElement.selectionStart === aElement.selectionEnd
          ) {
            return aDebut
              ? aElement.selectionStart === 0
              : aElement.selectionStart === aElement.value.length;
          }
        }
        return false;
      }
      _navigationFlechesClavier(aEvent, aParams) {
        if (!this._estToucheNavigationFlechesClavier(aEvent)) {
          return;
        }
        if (
          aEvent.target &&
          aEvent.target.closest(`#${this.Nom.escapeJQ()} .ObjetSaisie`)
        ) {
          return;
        }
        if (
          aEvent.target &&
          aEvent.target.matches &&
          aEvent.target.matches('input[type="radio"]') &&
          ToucheClavier_1.ToucheClavierUtil.estToucheFleche(aEvent.which)
        ) {
          return;
        }
        const lParam = Object.assign(
          {
            ligne: this._cache.selectionCellule.ligne,
            colonne: this._cache.selectionCellule.colonne,
            orientationVerticale: false,
            sensInverse: false,
            avecSelection:
              this.Donnees.options.avecSelectionSurNavigationClavier,
            entrerEdition: false,
          },
          aParams,
        );
        switch (aEvent.which) {
          case ToucheClavier_1.ToucheClavier.FlecheHaut: {
            lParam.sensInverse = true;
            lParam.orientationVerticale = true;
            break;
          }
          case ToucheClavier_1.ToucheClavier.FlecheBas: {
            lParam.orientationVerticale = true;
            break;
          }
          case ToucheClavier_1.ToucheClavier.Debut: {
            if (aEvent.ctrlKey || this.ListeTailles.length === 1) {
              lParam.ligne = -1;
              lParam.sensInverse = false;
              lParam.orientationVerticale = true;
            } else {
              lParam.colonne = -1;
              lParam.sensInverse = false;
              lParam.orientationVerticale = false;
            }
            break;
          }
          case ToucheClavier_1.ToucheClavier.Fin: {
            if (aEvent.ctrlKey || this.ListeTailles.length === 1) {
              lParam.ligne = this.Donnees.Donnees.count();
              lParam.sensInverse = true;
              lParam.orientationVerticale = true;
            } else {
              lParam.colonne = this.ListeTailles.length;
              lParam.sensInverse = true;
              lParam.orientationVerticale = false;
            }
            break;
          }
          case ToucheClavier_1.ToucheClavier.PageBas: {
            const lIndexLigneVisible = this._cache.lignesVisibles.indexOf(
              lParam.ligne,
            );
            let lLigne = this.Donnees.Donnees.count();
            if (
              lIndexLigneVisible >= 0 &&
              lIndexLigneVisible + 11 < this._cache.lignesVisibles.length
            ) {
              lLigne = this._cache.lignesVisibles[lIndexLigneVisible + 11];
            }
            Object.assign(lParam, {
              orientationVerticale: true,
              sensInverse: true,
              ligneEtColonneFixe: true,
              ligne: lLigne,
            });
            break;
          }
          case ToucheClavier_1.ToucheClavier.PageHaut: {
            const lIndexLigneVisible = this._cache.lignesVisibles.indexOf(
              lParam.ligne,
            );
            let lLigne = -1;
            if (lIndexLigneVisible >= 0 && lIndexLigneVisible - 11 >= 0) {
              lLigne = this._cache.lignesVisibles[lIndexLigneVisible - 11];
            }
            Object.assign(lParam, {
              orientationVerticale: true,
              sensInverse: false,
              ligneEtColonneFixe: true,
              ligne: lLigne,
            });
            break;
          }
          case ToucheClavier_1.ToucheClavier.FlecheGauche: {
            lParam.sensInverse = true;
            if (!this._estRoleTreeGrid()) {
              if (lParam.entrerEdition) {
                return;
              }
              const lParamsCellule = this._getParamsCellule(-1, lParam.ligne);
              if (
                this.Donnees.estUnDeploiement(lParamsCellule) &&
                this.Donnees._estDeploye(lParam.ligne)
              ) {
                this.surDeploiement(aEvent, lParam.colonne, lParam.ligne, true);
                return;
              }
              if (lParamsCellule.article && lParamsCellule.article.pere) {
                const lStruct =
                  this._cache.structArborescenceLignes[
                    this._cache.lignesVisibles.indexOf(lParamsCellule.ligne)
                  ];
                if (lStruct && lStruct.paramLigneParent) {
                  Object.assign(lParam, {
                    ligne: lStruct.paramLigneParent.ligne,
                    sansRecherche: true,
                  });
                }
              } else {
                return;
              }
            }
            break;
          }
          case ToucheClavier_1.ToucheClavier.FlecheDroite: {
            if (!this._estRoleTreeGrid()) {
              if (lParam.entrerEdition) {
                return;
              }
              const lParamsCellule = this._getParamsCellule(-1, lParam.ligne);
              if (
                this.Donnees.estUnDeploiement(lParamsCellule) &&
                !this.Donnees._estDeploye(lParam.ligne)
              ) {
                this.surDeploiement(aEvent, lParam.colonne, lParam.ligne, true);
                return;
              }
              const lNumeroLigne =
                this._cache.lignesVisibles[
                  this._cache.lignesVisibles.indexOf(lParamsCellule.ligne) + 1
                ];
              const lParamsCelluleFils = this._getParamsCellule(
                -1,
                lNumeroLigne,
              );
              if (
                lParamsCelluleFils.article &&
                lParamsCelluleFils.article.pere === lParamsCellule.article
              ) {
                Object.assign(lParam, {
                  ligne: lParamsCelluleFils.ligne,
                  sansRecherche: true,
                });
              } else {
                return;
              }
            }
            break;
          }
        }
        if (lParam.entrerEdition) {
          this._selectionnerCelluleSuivante(lParam);
        } else {
          this._navigationCelluleSuivante(lParam);
        }
      }
      _estToucheNavigationFlechesClavier(aEvent) {
        return (
          !!aEvent &&
          (ToucheClavier_1.ToucheClavierUtil.estToucheFleche(aEvent.which) ||
            aEvent.which === ToucheClavier_1.ToucheClavier.Fin ||
            aEvent.which === ToucheClavier_1.ToucheClavier.Debut ||
            aEvent.which === ToucheClavier_1.ToucheClavier.PageBas ||
            aEvent.which === ToucheClavier_1.ToucheClavier.PageHaut)
        );
      }
      _getLeftCurseurTri(aPositionColonne, aDerniereColonneDeBloc) {
        return (
          aPositionColonne.left +
          Math.round(aPositionColonne.width / 2 - this._options.widthTri / 2) +
          (aDerniereColonneDeBloc ? 0 : 1)
        );
      }
      _positionnerCurseurTri(aInfosZonesColonnes, aNode, aNumeroTri) {
        const lNumeroColonne = this._triCourant.colonne[aNumeroTri],
          lPosition = aInfosZonesColonnes.gabaritColonnesTitre[lNumeroColonne],
          lDerniereColonne =
            lNumeroColonne ===
            aInfosZonesColonnes.colonnesVisibles[
              aInfosZonesColonnes.colonnesVisibles.length - 1
            ];
        if (!lPosition) {
          $(aNode)
            .attr('tabindex', '-1')
            .addClass('sr-only')
            .parent()
            .attr('aria-hidden', 'true');
        } else {
          $(aNode)
            .attr('tabindex', '0')
            .removeClass('sr-only')
            .css(
              'left',
              this._getLeftCurseurTri(lPosition, lDerniereColonne) + 'px',
            )
            .parent()
            .attr('aria-hidden', null);
        }
      }
      _avecBoutonsListeHautScroll() {
        return (
          this._cache.boutons &&
          this._cache.boutons.length > 0 &&
          this._options.positionBoutons === NSListe.positionBoutons.hautScroll
        );
      }
      _getTabBoutonsEnteteOuPiedFD(aPourEntete) {
        const lTab = [];
        if (
          this._cache.boutons &&
          this._cache.boutons.length > 0 &&
          this._options.positionBoutons === NSListe.positionBoutons.entete
        ) {
          this._cache.boutons.forEach((aBouton, aIndex) => {
            if (aBouton) {
              const lPiedMobile =
                this.optionsInterne.versionMobile &&
                aBouton.estBoutonPiedFlottant_mobile;
              if (
                (!aPourEntete && lPiedMobile) ||
                (aPourEntete && !lPiedMobile)
              ) {
                lTab.push({ bouton: aBouton, index: aIndex });
              }
            }
          });
        }
        return lTab;
      }
      _initCacheLignes(aParamsActualiser) {
        const lParamsActualiser = Object.assign(
          { initCacheDyn: true },
          aParamsActualiser,
        );
        const lCache = this._cache;
        lCache.lignesFusionParColonne = {};
        if (this.Donnees) {
          this.Donnees.lignesFusionParColonne = lCache.lignesFusionParColonne;
        }
        if (!lParamsActualiser || !lParamsActualiser.estFiltreRechercheTexte) {
          lCache.rechercheTexte.textesParLigne = null;
          lCache.rechercheTexte.lignesCachees = [];
        }
        lCache.lignesVisibles = [];
        lCache.lignesVisiblesSansRechercheTexte = [];
        lCache.strResultRecherche = '';
        lCache.structArborescenceLignes = [];
        if (this.ListeTailles && this.Donnees) {
          for (let J = 0, lNb = this.Donnees.getNbrLignes(); J < lNb; J++) {
            if (this.Donnees.estVisible(J)) {
              lCache.lignesVisiblesSansRechercheTexte.push(J);
              lCache.lignesVisibles.push(J);
            }
          }
          if (lParamsActualiser && lParamsActualiser.estFiltreRechercheTexte) {
            lCache.lignesVisibles = [];
            lCache.lignesVisiblesSansRechercheTexte.forEach((aLigne) => {
              if (!lCache.rechercheTexte.lignesCachees[aLigne]) {
                lCache.lignesVisibles.push(aLigne);
              }
            });
          }
          const lTabProfondeur = [{ level: 0, count: 0 }];
          lCache.lignesVisibles.forEach((aLigneDonnees) => {
            const lParamCelluleLigne = this._getParamsCellule(
              -1,
              aLigneDonnees,
            );
            const lStructPrec =
              lCache.structArborescenceLignes.length > 0
                ? lCache.structArborescenceLignes[
                    lCache.structArborescenceLignes.length - 1
                  ]
                : null;
            let lProfondeur = 1;
            let lArticleRechercheProfondeur = lParamCelluleLigne.article;
            while (
              lArticleRechercheProfondeur &&
              lArticleRechercheProfondeur.pere
            ) {
              lProfondeur += 1;
              lArticleRechercheProfondeur = lArticleRechercheProfondeur.pere;
            }
            let lInfosProfondeurParent = lTabProfondeur[lProfondeur - 1];
            if (
              !lInfosProfondeurParent ||
              (lProfondeur > 1 &&
                lStructPrec &&
                lProfondeur > lStructPrec.level)
            ) {
              lInfosProfondeurParent = {
                count: 0,
                paramsLigne: lStructPrec ? lStructPrec.paramsLigne : null,
              };
              if (lStructPrec) {
                lStructPrec.avecFilsVisible = true;
              }
              lTabProfondeur[lProfondeur - 1] = lInfosProfondeurParent;
            }
            lInfosProfondeurParent.count += 1;
            lCache.structArborescenceLignes.push({
              paramsLigne: lParamCelluleLigne,
              paramLigneParent: lInfosProfondeurParent.paramsLigne,
              level: lProfondeur,
              index: lInfosProfondeurParent.count,
              _count() {
                return lInfosProfondeurParent.count;
              },
            });
          });
          lCache.structArborescenceLignes.forEach((aStruct) => {
            aStruct.count = aStruct._count();
            delete aStruct._count;
          });
        }
        const lCacheRef = lCache.refresh;
        if (lParamsActualiser.initCacheDyn) {
          lCacheRef.init();
        }
        lCacheRef.avecConstructionDynamiqueContenu =
          this._options.avecConstructionDynamiqueContenu &&
          lCache.lignesVisibles.length > lCacheRef.nbLignes * 5;
        lCacheRef.structure = [];
        this.optionsInterne.initStructureDynamique();
      }
      _estLigneVisible(aNumeroLigne, aParams) {
        return (
          !this._cache.rechercheTexte.lignesCachees[aNumeroLigne] &&
          this.Donnees.estVisible(aNumeroLigne, aParams)
        );
      }
      _estSelectionParCellule(aLigne, aColonne) {
        if (aColonne < 0) {
          return false;
        }
        return (
          !!this.Donnees &&
          this.Donnees.selectionParCellule(
            aColonne,
            this.Donnees.Donnees.get(aLigne),
          )
        );
      }
      _calculerTitres() {
        const _completerCelluleVide = (aLigne, aColonne) => {
          return this.ListeTitres[aLigne - 1] &&
            this.ListeTitres[aLigne - 1][aColonne] ===
              TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche
            ? TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche
            : TypeFusionTitreListe_1.TypeFusionTitreListe.FusionHaute;
        };
        let lNbLignes, iLigne, iColonne, lNumeroColonne;
        const lHintTitres = [];
        if (
          this._options.colonnes &&
          this._cache.declarationsColonnes &&
          this._cache.declarationsColonnes.length > 0
        ) {
          this.ListeTitres = null;
          lNbLignes = 0;
          for (
            iColonne = 0;
            iColonne < this._cache.declarationsColonnes.length;
            iColonne++
          ) {
            if (this._cache.declarationsColonnes[iColonne]) {
              const lDecl = this._cache.declarationsColonnes[iColonne];
              if (Array.isArray(lDecl.titre)) {
                lNbLignes = Math.max(lNbLignes, lDecl.titre.length);
              } else if (lDecl.titre) {
                lNbLignes = Math.max(lNbLignes, 1);
              }
              if (
                this._cache.declarationsColonnes[iColonne].sansBordureDroite
              ) {
                if (!this._options.colonnesSansBordureDroit) {
                  this._options.colonnesSansBordureDroit = [];
                }
                this._options.colonnesSansBordureDroit.push(
                  this._cache.declarationsColonnes[iColonne].id,
                );
              }
            }
          }
          if (lNbLignes > 0) {
            this.ListeTitres = [];
            lNumeroColonne = 0;
            for (
              iColonne = 0;
              iColonne < this._cache.declarationsColonnes.length;
              iColonne++
            ) {
              if (this._cache.declarationsColonnes[iColonne]) {
                for (iLigne = 0; iLigne < lNbLignes; iLigne++) {
                  if (!this.ListeTitres[iLigne]) {
                    this.ListeTitres[iLigne] = [];
                  }
                  if (!lHintTitres[iLigne]) {
                    lHintTitres[iLigne] = [];
                  }
                  const lValeur =
                    this._cache.declarationsColonnes[iColonne].titre;
                  if (MethodesObjet_1.MethodesObjet.isArray(lValeur)) {
                    const lValeurTitre = lValeur[iLigne];
                    if (lValeurTitre !== undefined && lValeurTitre !== null) {
                      this.ListeTitres[iLigne][lNumeroColonne] = lValeurTitre;
                    } else {
                      this.ListeTitres[iLigne][lNumeroColonne] =
                        iLigne === 0
                          ? lNumeroColonne === 0
                            ? ''
                            : TypeFusionTitreListe_1.TypeFusionTitreListe
                                .FusionGauche
                          : _completerCelluleVide.call(
                              this,
                              iLigne,
                              lNumeroColonne,
                            );
                    }
                  } else {
                    this.ListeTitres[iLigne][lNumeroColonne] =
                      iLigne === 0
                        ? lValeur !== undefined && lValeur !== null
                          ? lValeur
                          : lNumeroColonne === 0
                            ? ''
                            : TypeFusionTitreListe_1.TypeFusionTitreListe
                                .FusionGauche
                        : _completerCelluleVide.call(
                            this,
                            iLigne,
                            lNumeroColonne,
                          );
                  }
                  if (
                    MethodesObjet_1.MethodesObjet.isArray(
                      this._cache.declarationsColonnes[iColonne].hint,
                    )
                  ) {
                    if (
                      this._cache.declarationsColonnes[iColonne].hint[iLigne]
                    ) {
                      lHintTitres[iLigne][lNumeroColonne] =
                        this._cache.declarationsColonnes[iColonne].hint[iLigne];
                    }
                  } else if (this._cache.declarationsColonnes[iColonne].hint) {
                    lHintTitres[iLigne][lNumeroColonne] =
                      this._cache.declarationsColonnes[iColonne].hint;
                  }
                }
                lNumeroColonne += 1;
              }
            }
          }
        }
        const lDescripteurSkin = {
          getCouleurFond: null,
          getCouleurTexte: null,
          estCoche: false,
          largeurClasseCssImage: null,
        };
        for (iLigne in this.ListeTitres) {
          for (iColonne in this.ListeTitres[iLigne]) {
            const lDescripteur = this.ListeTitres[iLigne][iColonne],
              lDescripteurModele = Object.assign({}, lDescripteurSkin);
            if (!lDescripteur) {
              lDescripteurModele.libelle = '';
            } else if (MethodesObjet_1.MethodesObjet.isObject(lDescripteur)) {
              Object.assign(lDescripteurModele, lDescripteur);
              if (
                MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
                  TypeFusionTitreListe_1.TypeFusionTitreListe,
                  lDescripteur.libelle,
                ) !== ''
              ) {
                lDescripteurModele.fusion = lDescripteur.libelle;
              }
              if (lDescripteurModele.couleurFond) {
                lDescripteurModele.getCouleurFond = function () {
                  return this.couleurFond;
                };
              }
              if (lDescripteurModele.couleurTexte) {
                lDescripteurModele.getCouleurTexte = function () {
                  return this.couleurTexte;
                };
              }
              if (
                lDescripteurModele.controleur &&
                MethodesObjet_1.MethodesObjet.isObject(
                  lDescripteurModele.controleur,
                )
              ) {
                Object.keys(lDescripteurModele.controleur).forEach((aKey) => {
                  if (!this._cache.keysControleurTitre[aKey]) {
                    if (
                      this.controleur[aKey] ||
                      this._cache.keysControleurDonneesListe[aKey]
                    ) {
                      return;
                    }
                    this._cache.keysControleurTitre[aKey] = true;
                  }
                });
                $.extend(true, this.controleur, lDescripteurModele.controleur);
              }
            } else if (
              MethodesObjet_1.MethodesObjet.nomProprieteDeValeur(
                TypeFusionTitreListe_1.TypeFusionTitreListe,
                lDescripteur,
              ) !== ''
            ) {
              lDescripteurModele.fusion = lDescripteur;
            } else if (MethodesObjet_1.MethodesObjet.isString(lDescripteur)) {
              const lStrDescripteur = lDescripteur;
              if (
                lStrDescripteur.charAt(0) === '[' &&
                lStrDescripteur.charAt(lStrDescripteur.length - 1) === ']'
              ) {
                lDescripteurModele.classeCssImage = lStrDescripteur.substring(
                  1,
                  1 + lStrDescripteur.length - 2,
                );
              } else if (
                lStrDescripteur.charAt(0) === '{' &&
                lStrDescripteur.charAt(lStrDescripteur.length - 1) === '}'
              ) {
                lDescripteurModele.libelleHtml = lStrDescripteur.substring(
                  1,
                  1 + lStrDescripteur.length - 2,
                );
              } else {
                lDescripteurModele.libelle = lStrDescripteur;
              }
            } else {
              lDescripteurModele.libelle = '';
              IE.log.addLog(
                '_ObjetListe.setOptionsListe : pas de descripteur de colonnes',
                null,
                IE.log.genre.Avertissement,
              );
            }
            if (
              !lDescripteurModele.title &&
              lHintTitres &&
              lHintTitres[iLigne] &&
              lHintTitres[iLigne][iColonne]
            ) {
              lDescripteurModele.title = lHintTitres[iLigne][iColonne];
            }
            this.ListeTitres[iLigne][iColonne] = lDescripteurModele;
          }
        }
      }
      _estRechercheTexteVide() {
        return this._cache.rechercheTexte.saisie.trim() === '';
      }
      _filtreRechercheTexte(aParamsActualiser) {
        const lCache = this._cache;
        const lOldCache = lCache.rechercheTexte.lignesCachees;
        lCache.rechercheTexte.lignesCachees = [];
        const lRechercheVide = this._estRechercheTexteVide();
        let lAvecContructionCache = false;
        if (!lRechercheVide && !lCache.rechercheTexte.textesParLigne) {
          this.Donnees.enConstruction_cacheRechercheTexte = true;
          try {
            lAvecContructionCache = true;
            this._initCacheLignes({ initCacheDyn: false });
            lCache.rechercheTexte.textesParLigne = [];
            this.construireCacheRechercheTextes();
          } finally {
            this.Donnees.enConstruction_cacheRechercheTexte = false;
          }
        }
        if (!lRechercheVide) {
          const lTabRecherches =
            RechercheTexte_1.RechercheTexte.getTabRechercheTexteNormalize(
              this._cache.rechercheTexte.saisie,
            );
          const lIndexsLignesVisibles = [];
          const lFuncRendrePereArticleVisible = (aLigne) => {
            const lArticleFils = this.getArticleDeLigne(aLigne);
            if (lArticleFils && lArticleFils.pere) {
              for (
                let lIndiceLigne = aLigne - 1;
                lIndiceLigne >= 0;
                lIndiceLigne--
              ) {
                const lArticleRechereche = this.getArticleDeLigne(lIndiceLigne);
                if (lArticleRechereche === lArticleFils.pere) {
                  lCache.rechercheTexte.lignesCachees[lIndiceLigne] = false;
                  lFuncRendrePereArticleVisible(lIndiceLigne);
                  return;
                }
              }
            }
          };
          lCache.rechercheTexte.textesParLigne.forEach((aInfosLigne) => {
            const lLigneVisible =
              RechercheTexte_1.RechercheTexte.trouverRechercheTabTexteNormalize(
                {
                  tabSearch: lTabRecherches,
                  str: aInfosLigne.texte,
                  str_avecEntites: false,
                  strSearch_avecEntites: false,
                },
              );
            if (!lLigneVisible) {
              lCache.rechercheTexte.lignesCachees[aInfosLigne.ligne] = true;
            }
            if (
              lLigneVisible &&
              this.Donnees.options.avecPereVisibleSurRechercheTexte &&
              this.Donnees.Donnees
            ) {
              lFuncRendrePereArticleVisible(aInfosLigne.ligne);
            }
          });
          lCache.rechercheTexte.textesParLigne.forEach(
            (aInfosLigne, aIndex) => {
              if (!lCache.rechercheTexte.lignesCachees[aInfosLigne.ligne]) {
                lIndexsLignesVisibles.push(aIndex);
              }
            },
          );
          lCache.rechercheTexte.lignesCachees.forEach((aCachee, aLigne) => {
            if (!aCachee) {
              return;
            }
            const lIndice =
              lCache.lignesVisiblesSansRechercheTexte.indexOf(aLigne);
            if (lIndice <= 0) {
              return;
            }
            const lLignePrec =
              lCache.lignesVisiblesSansRechercheTexte[lIndice - 1];
            lCache.infosZonesColonnes.forEach((aBloc) => {
              if (lCache.rechercheTexte.lignesCachees[aLigne]) {
                aBloc.colonnesVisibles.forEach((aNumeroColonne) => {
                  if (
                    lCache.rechercheTexte.lignesCachees[aLigne] &&
                    !lCache.rechercheTexte.lignesCachees[lLignePrec] &&
                    this.Donnees.fusionCelluleAvecLignePrecedente(
                      this._getParamsCellule(aNumeroColonne, aLigne, {
                        celluleLignePrecedente: this._getParamsCellule(
                          aNumeroColonne,
                          lLignePrec,
                        ),
                      }),
                    )
                  ) {
                    lCache.rechercheTexte.lignesCachees[aLigne] = undefined;
                  }
                });
              }
            });
          });
          lIndexsLignesVisibles.forEach((aIndex) => {
            const lInfosLigneInitiale =
              lCache.rechercheTexte.textesParLigne[aIndex];
            if (!lInfosLigneInitiale) {
              return;
            }
            const lFuncBoucle = function (aInc) {
              let lLigneVisible = lInfosLigneInitiale.ligne;
              let lIndex = aIndex + (aInc ? 1 : -1);
              while (
                lIndex >= 0 &&
                lIndex < lCache.rechercheTexte.textesParLigne.length
              ) {
                const lInfosLigne =
                  lCache.rechercheTexte.textesParLigne[lIndex];
                if (
                  !lInfosLigne ||
                  !lCache.rechercheTexte.lignesCachees[lInfosLigne.ligne]
                ) {
                  break;
                }
                if (
                  this.Donnees.rechercheTexteForcerLignePrecSuivVisible(
                    this._getParamsCellule(-1, lLigneVisible),
                    this._getParamsCellule(-1, lInfosLigne.ligne),
                  )
                ) {
                  lCache.rechercheTexte.lignesCachees[lInfosLigne.ligne] =
                    undefined;
                  lLigneVisible = lInfosLigne.ligne;
                } else {
                  break;
                }
                lIndex += aInc ? 1 : -1;
              }
            };
            lFuncBoucle.call(this, false);
            lFuncBoucle.call(this, true);
          });
        }
        if (
          lAvecContructionCache ||
          !MethodesObjet_1.MethodesObjet.objetsIdentiques(
            lCache.rechercheTexte.lignesCachees,
            lOldCache,
          )
        ) {
          const lParams = Object.assign(aParamsActualiser || {}, {
            conserverSelection: true,
            selections: null,
            zonesActualisation: { contenu: true },
            estFiltreRechercheTexte: true,
            conserverPositionScroll: false,
          });
          this._actualiser(lParams);
          const lInput = this._getJConteneurInputRecherche()
            .find('.liste_rechercheTexte input')
            .get(0);
          if (lInput) {
            ObjetHtml_1.GHtml.setFocusEdit(lInput);
          }
        } else {
          this._surlignageRechercheTexte();
        }
        if (lRechercheVide) {
          lCache.strResultRecherche = ObjetTraduction_1.GTraductions.getValeur(
            'liste.wai.MsgRechercheNonTrouve',
          );
        } else {
          this._getJConteneurInputRecherche()
            .find('.liste_rechercheTexte_alerte.hide')
            .removeClass('hide');
          const lNbLignesResult = lCache.lignesVisibles.length;
          const lStrRecherche = this.getRechercheTexte();
          if (lNbLignesResult === 0) {
            lCache.strResultRecherche =
              ObjetTraduction_1.GTraductions.getValeur(
                'liste.wai.MsgRechercheNonTrouvePour_S',
                [lStrRecherche],
              );
          } else if (lNbLignesResult === 1) {
            lCache.strResultRecherche =
              ObjetTraduction_1.GTraductions.getValeur(
                'liste.wai.MsgRechercheXTrouveePour_DDS',
                [
                  lNbLignesResult,
                  lCache.lignesVisiblesSansRechercheTexte.length,
                  lStrRecherche,
                ],
              );
          } else {
            lCache.strResultRecherche =
              ObjetTraduction_1.GTraductions.getValeur(
                'liste.wai.MsgRechercheXTrouveesPour_DDS',
                [
                  lNbLignesResult,
                  lCache.lignesVisiblesSansRechercheTexte.length,
                  lStrRecherche,
                ],
              );
          }
        }
        this.$refreshSelf();
      }
      construireCacheRechercheTextes() {
        const lCache = this._cache;
        const lCacheRef = lCache.refresh;
        let lStructure = [];
        if (!lCache.refresh.avecConstructionDynamiqueContenu) {
          lStructure.push({ deb: 0, fin: lCache.lignesVisibles.length - 1 });
        } else {
          lStructure = lCacheRef.structure;
        }
        lStructure.forEach((aStructure, aIndiceRange) => {
          let lIndiceLigne;
          let lInfos;
          let lFragment = IEHtml.outils.createSafeFragment();
          let lJFragment;
          try {
            lCache.infosZonesColonnes.forEach((aInfosZoneColonnes, aIndex) => {
              let lDiv = document.createElement('div');
              lFragment.appendChild(lDiv);
              lDiv.id = `frag${aIndex}`;
              const lHtml = this._construireContenuRange(
                aInfosZoneColonnes,
                aIndiceRange,
              );
              $(lDiv).ieHtmlAppend('<div>' + lHtml + '</div>', {
                controleur: this.controleur,
              });
              lDiv = null;
            });
            lJFragment = $(lFragment);
            for (
              lIndiceLigne = aStructure.deb;
              lIndiceLigne <= aStructure.fin;
              lIndiceLigne++
            ) {
              lInfos = {
                ligne: lCache.lignesVisibles[lIndiceLigne],
                texte: '',
              };
              lCache.rechercheTexte.textesParLigne.push(lInfos);
              lCache.infosZonesColonnes.forEach(
                (aInfosZoneColonnes, aIndex) => {
                  const lTab = [];
                  lFragment
                    .querySelectorAll(
                      `#frag${aIndex} .liste_celluleGrid_${lIndiceLigne + 1} :not(.sr-only)`,
                    )
                    .forEach((aNode) => {
                      if (aNode.childNodes && aNode.childNodes.length > 0) {
                        aNode.childNodes.forEach((aChildNode) => {
                          if (aChildNode.nodeType === Node.TEXT_NODE) {
                            const lValue = aChildNode.nodeValue || '';
                            if (lValue) {
                              lTab.push(lValue);
                            }
                          }
                        });
                      }
                    });
                  lInfos.texte +=
                    ' ' +
                    ComparateurChaines_1.ComparateurChaines.normalize(
                      lTab.join(' '),
                    );
                },
              );
            }
          } finally {
            lJFragment.children().remove();
            lJFragment.remove();
            lJFragment = null;
            lFragment = null;
          }
        });
      }
      _calculerTailles() {
        this.ListeTailles = this._cache.colonnes.listeTailles || [];
        let lElement, i, lValeur;
        for (i = 0; i < this.ListeTailles.length; i++) {
          lElement = this.ListeTailles[i];
          if (
            lElement &&
            typeof lElement === 'string' &&
            lElement.search &&
            lElement.search(/%/) >= 0
          ) {
            this.ListeTailles[i] = ObjetListe.initColonne(
              parseInt(lElement, 10),
            );
          } else if (
            lElement &&
            typeof lElement === 'string' &&
            lElement.toLowerCase().endsWith('rem')
          ) {
            let lTailleRem = parseFloat(
              lElement.toLowerCase().replace('rem', ''),
            );
            lTailleRem = isNaN(lTailleRem) ? 0 : lTailleRem;
            this.ListeTailles[i] = {
              estREM: true,
              valeurRem: lElement,
              valeurPx: Math.max(
                0,
                ObjetPosition_1.GPosition.remToPixels(lTailleRem),
              ),
            };
          } else if (
            lElement &&
            !MethodesObjet_1.MethodesObjet.isObject(lElement)
          ) {
            lValeur = parseInt(lElement, 10);
            this.ListeTailles[i] = Math.max(0, isNaN(lValeur) ? 0 : lValeur);
          }
        }
      }
      _trierDonnees() {
        this.Donnees.setTriCourantDeListe(this._triCourant);
        this.Donnees.trier();
      }
      _setDonnees(ADonnees, aLigneSelectionne, aParams) {
        this._donneesRecus = true;
        this.Donnees = ADonnees;
        const lControleurDonnees = this.Donnees
          ? this.Donnees.getControleur(this.Donnees, this)
          : null;
        if (lControleurDonnees) {
          Object.keys(lControleurDonnees).forEach((aKey) => {
            if (!this._cache.keysControleurDonneesListe[aKey]) {
              if (
                this.controleur[aKey] ||
                this._cache.keysControleurTitre[aKey]
              ) {
                return;
              }
              this._cache.keysControleurDonneesListe[aKey] = true;
            }
          });
          $.extend(true, this.controleur, lControleurDonnees);
        }
        if (this.Donnees) {
          if (this._options.skin === ObjetListe.skin.flatDesign) {
          } else {
          }
        }
        this._cache.listeNonInitialisee = false;
        this._setRechercheSaisie('');
        clearTimeout(this._cache.timerKeyPress);
        this._cache.selectionCellule = { ligne: -1, colonne: -1 };
        this._cache.celluleClicNonShift = { ligne: -1, colonne: -1 };
        if (this.Donnees) {
          this._cache.lignesSelectionnees = new Array(
            this.Donnees.getNbrLignes(),
          );
          this._cache.lignesSelectionnees_prec = [];
        }
        this._calculsPreRendu();
        if (this.Donnees) {
          this.Donnees._setParamsListe({
            liste: this,
            idWAILigneLue: this.ids.WAILigneLue,
            versionMobile: this.optionsInterne.versionMobile,
            getIdsColonnes: () => {
              return this._cache.colonnes.listeIds;
            },
            getParams: this._getParamsCellule.bind(this),
            actualiserListe: (aParams) => {
              this._actualiser(
                Object.assign(
                  {
                    conserverSelection: true,
                    zonesActualisation: { contenu: true },
                    ignorerFocusListe: true,
                  },
                  aParams,
                ),
              );
            },
          });
        }
        let lSelections = null;
        if (
          this.Donnees &&
          this.Donnees.Donnees &&
          aLigneSelectionne >= 0 &&
          MethodesObjet_1.MethodesObjet.isNumber(aLigneSelectionne)
        ) {
          this._cache.selectionCellule.ligne = aLigneSelectionne;
          this._trierDonnees();
          lSelections = [
            {
              article: this.Donnees.Donnees.get(
                this._cache.selectionCellule.ligne,
              ),
            },
          ];
        } else if (
          this.Donnees &&
          this.Donnees.Donnees &&
          aParams &&
          aParams.listeElementsSelection &&
          aParams.listeElementsSelection.count &&
          aParams.listeElementsSelection.count() > 0
        ) {
          lSelections = [];
          aParams.listeElementsSelection.parcourir((aElement) => {
            lSelections = [{ article: aElement }];
          });
          aParams.listeElementsSelection = null;
          aParams.instancesIdentiquesSelections = false;
          this._trierDonnees();
        }
        this._actualiser(
          Object.assign(
            {
              selections: lSelections,
              sansTriDonnees: !!lSelections,
              avecEvenementSelection: !!lSelections && lSelections.length > 0,
              avecScrollSelection: !!lSelections && lSelections.length > 0,
              conserverPositionScroll: false,
            },
            aParams,
          ),
        );
        return this;
      }
      _getLargeurPage() {
        const lJElement = $('#' + this.Nom.escapeJQ());
        if (lJElement.html() === '') {
          lJElement.html('&nbsp;');
        }
        return Math.floor(lJElement.width());
      }
      _calculerColonnes() {
        this._cache.largeurPage = this._getLargeurPage();
        this._cache.colonnesSansBordureDroit = [];
        if (this._options.colonnesSansBordureDroit) {
          this._options.colonnesSansBordureDroit.forEach((aElement, aIndex) => {
            if (aElement === true || aElement === false) {
              this._cache.colonnesSansBordureDroit[aIndex] = aElement;
            } else if (MethodesObjet_1.MethodesObjet.isString(aElement)) {
              this._cache.colonnesSansBordureDroit[
                this._getNumeroColonneSelonNumeroOuId(aElement)
              ] = true;
            }
          }, this);
        }
        this._cache.taillesColonne = this._calculerTaillesColonnes(this._cache);
        this._cache.calculsTailleColonnesAFaire = !this._cache.largeurPage;
      }
      _getNumeroColonneSelonNumeroOuId(aColonne, aAccepteErreur) {
        let lNumeroColonne = aColonne;
        if (
          MethodesObjet_1.MethodesObjet.isString(aColonne) &&
          this._cache.colonnes.listeIds
        ) {
          lNumeroColonne = this._cache.colonnes.listeIds.indexOf(aColonne);
          if (lNumeroColonne < 0) {
            lNumeroColonne = null;
          }
        }
        return lNumeroColonne;
      }
      _calculerTri() {
        let lNombreTri = 0,
          lNumerosColonnesTriDefaut = [],
          lGenreTriColonneTriDefaut = [],
          lGenreColonne,
          lNumeroColonne,
          lErreurTriCorrigee = false,
          i;
        function _chercherColonneTriValide(
          aNumeroColonne,
          aNumerosColonnesTriDefaut,
        ) {
          let lNumeroColonne = aNumeroColonne;
          if (!MethodesObjet_1.MethodesObjet.isNumber(lNumeroColonne)) {
            lNumeroColonne = 0;
            lErreurTriCorrigee = true;
          }
          while (
            lNumeroColonne >= 0 &&
            (!this._estColonneVisible(lNumeroColonne) ||
              this._cache.colonnesTri[lNumeroColonne] !== true ||
              aNumerosColonnesTriDefaut.includes(lNumeroColonne))
          ) {
            lNumeroColonne += -1;
            lErreurTriCorrigee = true;
          }
          if (lNumeroColonne < 0) {
            let lTrouve = false;
            this._cache.infosZonesColonnes.forEach((aBloc) => {
              aBloc.colonnesVisibles.forEach((aNumeroColonne) => {
                if (
                  !lTrouve &&
                  this._cache.colonnesTri[aNumeroColonne] === true &&
                  !aNumerosColonnesTriDefaut.includes(aNumeroColonne)
                ) {
                  lTrouve = true;
                  lNumeroColonne = aNumeroColonne;
                  lErreurTriCorrigee = true;
                }
              });
            });
          }
          return lNumeroColonne;
        }
        if (this._options.colonnesTriables === true) {
          this._cache.colonnesTri = [];
          for (i = 0; i < this.ListeTailles.length; i++) {
            this._cache.colonnesTri[i] = true;
          }
        } else {
          this._cache.colonnesTri = [];
          if (
            this._options.colonnesTriables &&
            Array.isArray(this._options.colonnesTriables)
          ) {
            const lCols = this._options.colonnesTriables;
            this._cache.listeCorrespondancesColonnes.forEach(
              (aNumeroColonneReelle, aNumeroColonneInitiale) => {
                if (
                  lCols[aNumeroColonneInitiale] === true ||
                  lCols[aNumeroColonneInitiale] === false
                ) {
                  if (aNumeroColonneReelle >= 0) {
                    this._cache.colonnesTri[aNumeroColonneReelle] =
                      lCols[aNumeroColonneInitiale];
                  }
                } else if (
                  MethodesObjet_1.MethodesObjet.isString(
                    lCols[aNumeroColonneInitiale],
                  )
                ) {
                  lNumeroColonne = this._getNumeroColonneSelonNumeroOuId(
                    lCols[aNumeroColonneInitiale],
                    true,
                  );
                  if (lNumeroColonne !== null) {
                    this._cache.colonnesTri[lNumeroColonne] = true;
                  }
                }
              },
            );
          }
          if (this._cache.colonnesTri.length === 0) {
            this._cache.colonnesTri = null;
          }
        }
        let lOptionsTriParDefaut = this._options.numeroColonneTriDefaut;
        if (MethodesObjet_1.MethodesObjet.isFunction(lOptionsTriParDefaut)) {
          lOptionsTriParDefaut = lOptionsTriParDefaut();
        }
        if (this._cache.colonnesTri && this._cache.colonnesTri.length > 0) {
          if (MethodesObjet_1.MethodesObjet.isArray(lOptionsTriParDefaut)) {
            lNumerosColonnesTriDefaut = [];
            for (i = 0; i < lOptionsTriParDefaut.length; i++) {
              lNumeroColonne = null;
              const lOptTri = lOptionsTriParDefaut[i];
              if (MethodesObjet_1.MethodesObjet.isObject(lOptTri)) {
                if (lOptTri.id) {
                  lNumeroColonne = this._getNumeroColonneSelonNumeroOuId(
                    lOptTri.id,
                    true,
                  );
                }
                if (lNumeroColonne === null) {
                  lNumeroColonne = lOptTri.numero || 0;
                  lErreurTriCorrigee = true;
                }
                lNumeroColonne = lOptTri.numero || 0;
                lGenreColonne =
                  lOptTri.genre ||
                  Enumere_TriElement_1.EGenreTriElement.Croissant;
              } else {
                lNumeroColonne =
                  this._getNumeroColonneSelonNumeroOuId(lOptTri, true) || 0;
                lGenreColonne = Enumere_TriElement_1.EGenreTriElement.Croissant;
              }
              lNumeroColonne = _chercherColonneTriValide.call(
                this,
                lNumeroColonne,
                lNumerosColonnesTriDefaut,
              );
              if (lNumeroColonne >= 0) {
                lNumerosColonnesTriDefaut.push(lNumeroColonne);
                lGenreTriColonneTriDefaut.push(lGenreColonne);
              }
            }
            lNombreTri = lNumerosColonnesTriDefaut.length;
          } else {
            lNombreTri = 1;
            lNumeroColonne = null;
            if (MethodesObjet_1.MethodesObjet.isObject(lOptionsTriParDefaut)) {
              if (lOptionsTriParDefaut.id) {
                lNumeroColonne =
                  this._getNumeroColonneSelonNumeroOuId(
                    lOptionsTriParDefaut.id,
                    true,
                  ) || 0;
              }
              if (lNumeroColonne === null) {
                lNumeroColonne = lOptionsTriParDefaut.numero || 0;
                lErreurTriCorrigee = true;
              }
              lGenreColonne =
                lOptionsTriParDefaut.genre ||
                Enumere_TriElement_1.EGenreTriElement.Croissant;
            } else {
              lNumeroColonne =
                this._getNumeroColonneSelonNumeroOuId(
                  lOptionsTriParDefaut,
                  true,
                ) || 0;
              lGenreColonne = Enumere_TriElement_1.EGenreTriElement.Croissant;
            }
            lNumeroColonne = _chercherColonneTriValide.call(
              this,
              parseInt(lNumeroColonne || 0, 10),
              lNumerosColonnesTriDefaut,
            );
            lNumerosColonnesTriDefaut = [lNumeroColonne];
            lGenreTriColonneTriDefaut = [lGenreColonne];
          }
        }
        this._triCourant = { colonne: [], genre: [], nombreTri: lNombreTri };
        for (i = 0; i < lNombreTri; i++) {
          this._triCourant.colonne[i] = lNumerosColonnesTriDefaut[i];
          this._triCourant.genre[i] = lGenreTriColonneTriDefaut[i];
        }
        if (lErreurTriCorrigee) {
          this._setOptionEvenementSurTri();
        }
      }
      _calculerParametresCreation() {
        function _ajouterColonne(aColonne) {
          const lNumeroColonne =
            this._getNumeroColonneSelonNumeroOuId(aColonne);
          if (MethodesObjet_1.MethodesObjet.isNumber(lNumeroColonne)) {
            if (
              this._cache.colonnes.listeTailles &&
              (lNumeroColonne < 0 ||
                lNumeroColonne >= this._cache.colonnes.listeTailles.length)
            ) {
              IE.log.addLog(
                'options.listeCreations [_calculerParametresCreation], la colonne numero ' +
                  aColonne +
                  " n'existe pas !",
              );
            }
            this.ListeCreations.push(lNumeroColonne);
          }
        }
        this.ListeCreations = [];
        if (Array.isArray(this._options.listeCreations)) {
          this._options.listeCreations.forEach(_ajouterColonne, this);
        } else {
          _ajouterColonne.call(this, this._options.listeCreations);
        }
      }
      _avecLigneCreationTitre() {
        let lAvecLigneCreation =
          !this._getNonEditable() &&
          this._options.avecLigneCreation &&
          !!this.Donnees;
        if (lAvecLigneCreation && this._cache.infosZonesColonnes.length > 1) {
          lAvecLigneCreation = false;
        }
        return lAvecLigneCreation;
      }
      _getLargeurPartieScrollV() {
        return Math.max(
          this._getLargeurScrollV(),
          this._avecBoutonsListeHautScroll()
            ? this._options.tailleBoutons + 1
            : 0,
        );
      }
      _getLargeurScrollV() {
        return 0;
      }
      _calculerTaillesColonnes(aCache, aPourImpression) {
        const lTaillesColonne = [];
        if (!this.ListeTailles) {
          return lTaillesColonne;
        }
        this.ListeTailles.forEach(() => {
          lTaillesColonne.push({ px: 0 });
        });
        let i,
          lTailleRestante,
          lTaille,
          lTotalValeurs = 0,
          lElement,
          lNumeroColonne;
        const lColonnesPourcent = [];
        aCache.avecPourcentage = false;
        aCache.largeurTotalFixe = 0;
        aCache.largeurTotalCalcule = 0;
        for (i = 0; i < this.ListeTailles.length; i++) {
          if (this._estColonneVisible(i)) {
            const lTailleCol = this.ListeTailles[i];
            const lTailleREM = this.ListeTailles[i];
            const lTaillePx = this.ListeTailles[i];
            if (lTailleCol && lTailleCol.valeur && !lTailleREM.estREM) {
              aCache.avecPourcentage = true;
              lTotalValeurs += lTailleCol.valeur;
              lElement = {
                indice: i,
                valeur: lTailleCol.valeur,
                min: Math.max(
                  _CONST_largeurMinColonne,
                  lTailleCol.min ? parseInt(lTailleCol.min + '', 10) : 0,
                ),
                max: lTailleCol.max ? parseInt(lTailleCol.max + '', 10) : 0,
              };
              lColonnesPourcent.push(lElement);
              Object.assign(lTaillesColonne[i], lElement, {
                estPourcent: true,
              });
              aCache.largeurTotalFixe +=
                lElement.min + 2 * this._options.paddingCelluleLR + 1;
            } else if (lTailleREM && lTailleREM.estREM) {
              lTaillesColonne[i].px = lTailleREM.valeurPx;
              Object.assign(lTaillesColonne[i], lTailleREM);
              aCache.largeurTotalFixe +=
                lTailleREM.valeurPx + 2 * this._options.paddingCelluleLR + 1;
            } else {
              lTaillesColonne[i].px = lTaillePx;
              aCache.largeurTotalFixe +=
                lTaillePx + 2 * this._options.paddingCelluleLR + 1;
            }
          }
        }
        let lTotal = 0;
        lTaillesColonne.forEach((aCol) => {
          if (aCol.estPourcent) {
            aCol.pourcent = Math.floor((aCol.valeur * 100) / lTotalValeurs);
            lTotal += aCol.pourcent;
          }
        });
        if (lTotal < 100) {
          lTaillesColonne.forEach((aCol) => {
            if (aCol.estPourcent) {
              aCol.pourcent += 100 - lTotal;
              return false;
            }
            return true;
          });
        }
        aCache.largeurTotalFixe = Math.max(0, aCache.largeurTotalFixe - 1);
        aCache.largeurTotalCalcule = aCache.largeurTotalFixe;
        if (!aCache.largeurPage) {
          return lTaillesColonne;
        }
        if (aCache.avecPourcentage) {
          lTailleRestante =
            aCache.largeurPage -
            aCache.largeurTotalFixe -
            this._getDiffLargeurContenu(aPourImpression);
          lTailleRestante = Math.max(0, lTailleRestante);
          let lAvecMax = true;
          while (lAvecMax) {
            lAvecMax = false;
            for (i in lColonnesPourcent) {
              lElement = lColonnesPourcent[i];
              if (!lElement) {
                continue;
              }
              lTaille =
                lElement.min +
                Math.max(
                  0,
                  Math.round(
                    (lTailleRestante * lElement.valeur) / lTotalValeurs,
                  ),
                );
              if (lElement.max && lTaille > lElement.max) {
                lTaillesColonne[lElement.indice].px = lTaille = lElement.max;
                lTailleRestante -= lTaille - lElement.min;
                lTotalValeurs -= lElement.valeur;
                aCache.largeurTotalCalcule += lTaille - lElement.min;
                lAvecMax = true;
                delete lColonnesPourcent[i];
                break;
              }
            }
          }
          for (i in lColonnesPourcent) {
            lElement = lColonnesPourcent[i];
            if (!lElement) {
              continue;
            }
            lNumeroColonne = lElement.indice;
            lTaillesColonne[lNumeroColonne].px =
              lElement.min +
              Math.max(
                0,
                Math.round((lTailleRestante * lElement.valeur) / lTotalValeurs),
              );
            lTailleRestante -=
              lTaillesColonne[lNumeroColonne].px - lElement.min;
            lTotalValeurs -= lElement.valeur;
            aCache.largeurTotalCalcule +=
              lTaillesColonne[lNumeroColonne].px - lElement.min;
          }
        }
        aCache.largeurBlocFixe = 0;
        aCache.infosZonesColonnes.forEach((aInfos) => {
          aInfos.largeurBloc = 0;
          aInfos.colonnesVisibles.forEach((aNumeroCol) => {
            const lTaille =
              lTaillesColonne[aNumeroCol].px +
              2 * this._options.paddingCelluleLR +
              1;
            aInfos.largeurBloc += lTaille;
            if (aInfos.estBlocFixe) {
              aCache.largeurBlocFixe += lTaille;
            }
          });
        });
        return lTaillesColonne;
      }
      _getDiffLargeurContenu(aPourImpression) {
        return (
          (aPourImpression ? 0 : this._getLargeurPartieScrollV()) +
          this._options.borduresContenu_left +
          this._options.borduresContenu_right +
          this._options.paddingContenu_LR * 2
        );
      }
      _calculsPreRendu(aIgnorerCalculTri) {
        const lAvecCalculPreRendu = this._cache.calculsPreRenduAFaire;
        if (lAvecCalculPreRendu) {
          this._cache.calculsPreRenduAFaire = false;
          this._gererModificationsColonnes();
          this._preparerBoutons();
          this._calculerTailles();
          this._calculColonnesCachees(this._cache);
          this._getInfosZonesColonnes(this._cache);
          this._calculerTitres();
          this._calculerParametresCreation();
          if (aIgnorerCalculTri !== true || this._cache.calculTriAFaire) {
            this._cache.calculTriAFaire = false;
            this._calculerTri();
          }
        }
        if (this._cache.calculsTailleColonnesAFaire || lAvecCalculPreRendu) {
          this._calculerColonnes();
        }
      }
      _actualiser(aParams) {
        const lParams = Object.assign(
          {
            conserverSelection: false,
            conserverFocusSelection: false,
            ignorerFocusListe: true,
            sansTriDonnees: false,
            ignorerCalculTri: false,
            selections: null,
            instancesIdentiquesSelections: true,
            avecEvenementSelection: false,
            avecScrollSelection: false,
            avecSelectionSurLigneInvisible: false,
            conserverPositionScroll: true,
            avecEvenementModificationSelection: true,
            conserverPositionElement: null,
          },
          aParams,
        );
        let lZonesActualisation = lParams.zonesActualisation;
        if (this._cache.creationEnCours) {
          lZonesActualisation = false;
        }
        this._cache.creationEnCours = false;
        this._cache.editionEnCours = false;
        this._cache.editionEnCoursEvenement = false;
        this._cache.positionCreation = 0;
        this._cache.listeValeursCreation = [];
        this._cache.finEditionCreation = null;
        clearTimeout(this._cache.rechercheTexte.timerSaisie);
        this._cache.collectionFuncConstructCellule = {};
        this._nettoyerElementsEditionEnCours();
        if (!ObjetHtml_1.GHtml.elementExiste(this.Nom)) {
          return;
        }
        let lSelections = null,
          lIdFocusARestaurer = '',
          lFocusSurListe;
        if (
          !lParams.ignorerFocusListe &&
          ObjetHtml_1.GHtml.focusEstDansElement &&
          ObjetHtml_1.GHtml.focusEstDansElement(this.Nom)
        ) {
          lFocusSurListe = true;
          lIdFocusARestaurer = this.IdPremierElement;
        }
        let lSelectionsPrecedente = null;
        if (this.Donnees) {
          this.Donnees.setOptions({ nonEditable: this._getNonEditable() });
          this.Donnees._setParamsListe({
            avecRechercheTexteEnCours: !this._estRechercheTexteVide(),
          });
          if (lParams.selections) {
            lSelections = lParams.selections;
          } else if (lParams.conserverSelection) {
            lSelections = this._getCellulesSelection();
          } else {
            if (lParams.avecEvenementModificationSelection) {
              lSelectionsPrecedente = this._getCellulesSelection(true);
            }
            this._cache.selectionCellule.ligne = -1;
            this._cache.selectionCellule.colonne = -1;
            this._cache.lignesSelectionnees = new Array(
              this.Donnees.getNbrLignes(),
            );
            this._cache.lignesSelectionnees_prec = [];
          }
          if (lParams.sansTriDonnees !== true) {
            this._trierDonnees();
          }
          if (
            lFocusSurListe &&
            lParams.conserverFocusSelection &&
            this._cache.selectionCellule.ligne >= 0 &&
            this._cache.selectionCellule.colonne >= 0
          ) {
            lIdFocusARestaurer = this.getIdCellule(
              this._cache.selectionCellule.colonne,
              this._cache.selectionCellule.ligne,
              true,
            );
          }
        }
        const lBackupScroll = this._backupScroll(lParams);
        this._desabonnementResizeObserver();
        if (!lZonesActualisation) {
          ObjetHtml_1.GHtml.setHtml(this.Nom, '', { ignorerScroll: true });
          this._cache.heightConteneur = Math.floor(
            ObjetPosition_1.GPosition.getClientRect(this.Nom).contentHeight,
          );
          const lForcerNouveauTri =
            this.Donnees &&
            this._cache.calculsPreRenduAFaire &&
            lParams.ignorerCalculTri !== true &&
            lParams.sansTriDonnees !== true;
          this._calculsPreRendu(lParams.ignorerCalculTri);
          if (lForcerNouveauTri) {
            this._trierDonnees();
          }
        }
        let lAvecFiltreRecherche = !lParams.estFiltreRechercheTexte;
        if (lZonesActualisation) {
          this._actualiserZones(lZonesActualisation, lParams);
          if (lZonesActualisation.total) {
            const lJTotalHeader = $(
              `#${this.Nom.escapeJQ()} .liste-totale-fd.liste-header`,
            );
            if (lJTotalHeader.length === 1) {
              ObjetHtml_1.GHtml.setHtml(
                lJTotalHeader.get(0),
                this.construireTotalInterneFD(true),
                { controleur: this.controleur, ignorerScroll: true },
              );
            }
            const lJTotalFooter = $(
              `#${this.Nom.escapeJQ()} .liste-totale-fd.liste-footer`,
            );
            if (lJTotalFooter.length === 1) {
              ObjetHtml_1.GHtml.setHtml(
                lJTotalHeader.get(0),
                this.construireTotalInterneFD(false),
                { controleur: this.controleur, ignorerScroll: true },
              );
            }
          }
          lAvecFiltreRecherche =
            lAvecFiltreRecherche && lZonesActualisation.contenu;
        } else {
          let lCommentaireDebug = '';
          ObjetHtml_1.GHtml.setHtml(
            this.Nom,
            this.construireAffichage(lParams),
            {
              controleur: this.controleur,
              ignorerScroll: true,
              commentaireHtmlDebug: lCommentaireDebug,
            },
          );
          this._controleHeightLigne();
        }
        this._refreshContenuDynamique({ surInitialisation: true });
        if (
          this._options.piedDeListe &&
          this._options.piedDeListe.getContenu &&
          !lZonesActualisation
        ) {
          ObjetHtml_1.GHtml.setHtml(
            this.idPiedDeListe,
            IE.jsx.str(
              'div',
              {
                class: 'pied-liste',
                tabindex: '0',
                style:
                  ObjetStyle_1.GStyle.composeHeight(
                    this._options.piedDeListe.height,
                  ) +
                  (this.optionsInterne.versionMobile
                    ? ''
                    : ObjetStyle_1.GStyle.composeWidth(
                        this._cache.largeurTotalCalcule + 1,
                      )),
              },
              this._options.piedDeListe.getContenu(),
            ),
            {
              controleur:
                this._options.piedDeListe.controleur || this.controleur,
              ignorerScroll: true,
            },
          );
        }
        this._setScroll(lBackupScroll);
        this._refreshContenuDynamique({
          avecBackupScroll: true,
          refreshRecursif: true,
          conserverPositionElement: lParams.conserverPositionElement,
        });
        this._abonnementResizeObserver();
        if (lIdFocusARestaurer) {
          if (!ObjetHtml_1.GHtml.elementExiste(lIdFocusARestaurer)) {
            lIdFocusARestaurer = this.IdPremierElement;
          }
          ObjetHtml_1.GHtml.setFocus(lIdFocusARestaurer);
        }
        if (Array.isArray(lSelections)) {
          this._setCellulesSelection(lSelections, {
            instancesIdentiques: lParams.instancesIdentiquesSelections,
            avecEvenement: lParams.avecEvenementSelection,
            avecScroll: lParams.avecScrollSelection,
            avecSelectionSurLigneInvisible:
              lParams.avecSelectionSurLigneInvisible,
            avecEvenementModificationSelection:
              lParams.avecEvenementModificationSelection,
          });
        } else if (
          lParams.avecEvenementModificationSelection &&
          lSelectionsPrecedente &&
          lSelectionsPrecedente.length > 0
        ) {
          this._surModificationSelectionEvenement(lSelectionsPrecedente);
        }
        if (
          !this._estRechercheTexteVide() ||
          (lParams.estFiltreRechercheTexte &&
            !lParams.annulerRechercheTexte &&
            !lZonesActualisation)
        ) {
          this._creerZoneRechercheTexte(!lZonesActualisation);
        } else if (
          !lParams.estFiltreRechercheTexte ||
          lParams.annulerRechercheTexte
        ) {
          this._supprimerZoneRechercheTexte();
        }
        if (lAvecFiltreRecherche) {
          this._filtreRechercheTexte(lParams);
        }
        this._surlignageRechercheTexte();
        this.$refreshSelf();
      }
      _abonnementResizeObserver() {
        this._desabonnementResizeObserver();
        const lListeIdsResizeObs = [];
        this._getTabElementsPourRsizeObserver().forEach((aElement) => {
          if (aElement) {
            lListeIdsResizeObs.push({
              element: aElement,
              height: ObjetPosition_1.GPosition.getClientRect(aElement).height,
            });
          }
        });
        if (lListeIdsResizeObs.length > 0) {
          this._cache.resizeObserverContenu = new ResizeObserver(
            (aObservers) => {
              if (aObservers) {
                const lAvecActualisation = !lListeIdsResizeObs.every(
                  (aElement, aIndex) => {
                    const lHeight =
                      aObservers[aIndex] && aObservers[aIndex].contentRect
                        ? aObservers[aIndex].contentRect.height || 0
                        : 0;
                    if (
                      lHeight > 0 &&
                      Math.abs(lHeight - aElement.height) > 1
                    ) {
                      return false;
                    }
                    return true;
                  },
                );
                if (lAvecActualisation || this.optionsInterne.versionMobile) {
                  this._cache.positionsCelluleCadreSelection = {};
                  this._actualiserCadreSelection();
                }
                if (lAvecActualisation) {
                  this._controleHeightLigne();
                  this._setScroll(
                    this._backupScroll({ conserverPositionScroll: true }),
                    true,
                  );
                  if (this._options.callbackResizeObserverContenu) {
                    this._options.callbackResizeObserverContenu(this);
                  }
                }
              }
            },
          );
          lListeIdsResizeObs.forEach((aElement) => {
            this._cache.resizeObserverContenu.observe(aElement.element);
          });
        }
      }
      _desabonnementResizeObserver() {
        if (this._cache.resizeObserverContenu) {
          this._cache.resizeObserverContenu.disconnect();
          this._cache.resizeObserverContenu = null;
        }
      }
      _getHeightCellule(aParamsCellule) {
        return (
          this.Donnees.getHauteurMinCellule(aParamsCellule) ||
          ObjetDonneesListe_1.ObjetDonneesListe.hauteurMinCellule
        );
      }
      async _afficherMessage(aParamsCellule) {
        const LMessage = this.Donnees.getMessage();
        if (LMessage) {
          await GApplication.getMessage().afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
            message: LMessage,
          });
        } else if (this.Donnees.avecEtatSaisie(aParamsCellule)) {
          this.setEtatSaisie(true);
        }
      }
      surCreationEvenement(I, aParamsSupp) {
        if (this.Donnees) {
          if (this.Donnees.avecEvenementCreation()) {
            if (this.Pere && this.Evenement) {
              const lResult = this.callback.appel(
                this._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe.Creation,
                  I,
                  null,
                  Object.assign(
                    { listeValeursCreation: this._cache.listeValeursCreation },
                    aParamsSupp,
                  ),
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe.Creation,
                I,
                null,
              );
              this._refreshSelf();
              return lResult;
            }
          }
        }
      }
      _setOptionEvenementSurTri() {
        if (
          this._options.evenementSurTri &&
          this._triCourant &&
          this._triCourant.colonne &&
          this._cache.colonnes.listeIds
        ) {
          const lTabTri = [];
          for (let i = 0; i < this._triCourant.colonne.length; i++) {
            lTabTri.push({
              numero: this._triCourant.colonne[i],
              id: this._cache.colonnes.listeIds[this._triCourant.colonne[i]],
              genre: this._triCourant.genre[i],
            });
          }
          this._options.evenementSurTri(lTabTri);
        }
      }
      _construireTriActif(aInfosZoneColonnes, aIndiceTri) {
        return '';
      }
      async _setColonneTri(aColonne, aGenre, aNumeroTri) {
        const lNumeroTri = aNumeroTri || 0,
          lNumeroColonne = MethodesObjet_1.MethodesObjet.isString(aColonne)
            ? this.getNumeroColonneDIdColonne(aColonne)
            : aColonne,
          lNumeroAncienTri = this._triCourant.colonne.indexOf(lNumeroColonne);
        if (lNumeroAncienTri >= 0 && lNumeroAncienTri !== lNumeroTri) {
          this._triCourant.colonne[lNumeroAncienTri] =
            this._triCourant.colonne[lNumeroTri];
        }
        this._triCourant.genre[lNumeroTri] =
          aGenre !== null && aGenre !== undefined
            ? aGenre
            : Enumere_TriElement_1.EGenreTriElement.Croissant;
        this._triCourant.colonne[lNumeroTri] = lNumeroColonne;
        this._setOptionEvenementSurTri();
        this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
          $(
            '#' +
              this.ids.curseurTriSurvol.escapeJQ() +
              aInfosZoneColonnes.indiceBloc,
          ).hide();
          const lJParent = $(
            `#${this.ids.curseurTri.escapeJQ() + aInfosZoneColonnes.indiceBloc + '_row'}`,
          );
          lJParent.empty();
          for (let lITri = 0; lITri < this._triCourant.nombreTri; lITri++) {
            if (lJParent.length === 1) {
              const lNode = IEHtml.injectHTMLParams({
                element: lJParent.get(0),
                html: this._construireTriActif(aInfosZoneColonnes, lITri),
                controleur: this.controleur,
              });
              const lNumeroColonne = this._triCourant.colonne[lITri];
              if (
                lNode &&
                lNumeroTri === lITri &&
                aInfosZoneColonnes.gabaritColonnesTitre[lNumeroColonne]
              ) {
                lNode.focus();
              }
            }
          }
        });
        await new Promise((aResolve) => {
          setTimeout(aResolve, 0);
        });
        this._actualiser({
          conserverSelection: true,
          sansTriDonnees: false,
          ignorerCalculTri: true,
          zonesActualisation: { contenu: true },
        });
      }
      _extraireInfosId(aId) {
        if (!aId) {
          return false;
        }
        const lInfos = {};
        const lIds = aId.split('_');
        if (lIds[lIds.length - 1] === 'div') {
          lInfos.ligne = parseInt(lIds[lIds.length - 2], 10);
          lInfos.colonne = parseInt(lIds[lIds.length - 3], 10);
        } else {
          lInfos.ligne = parseInt(lIds[lIds.length - 1], 10);
          lInfos.colonne = parseInt(lIds[lIds.length - 2], 10);
        }
        return lInfos;
      }
      _focusSuivant(AId, AOrientation, ADirection) {
        const LIdSuivant = this.getIdNavigationSuivant(
          AId,
          AOrientation,
          ADirection,
        );
        if (LIdSuivant) {
          ObjetHtml_1.GHtml.setFocus(LIdSuivant);
          if (this.Donnees.options.avecSelectionSurNavigationClavier) {
            const lInfos = this._extraireInfosId(LIdSuivant);
            if (lInfos) {
              this.selectionnerCellule({
                ligne: lInfos.ligne,
                colonne: lInfos.colonne,
                deselectionnerTout: true,
                selectionner: true,
                avecEvenement: true,
              });
            }
          }
        }
      }
      _evenementMenuContextuel(aParametres, aLigne) {
        const lParametres = Object.assign(
          {
            ligneMenu: aLigne,
            numeroMenu: aLigne ? aLigne.getNumero() : -1,
            avecActualisation: true,
          },
          aParametres,
        );
        if (aLigne) {
          switch (aLigne.getNumero()) {
            case Enumere_CommandeMenu_1.EGenreCommandeMenu.Creation:
              if (this._avecLigneCreationUnique) {
                const LId = this._getIdCreation(-1, -1);
                ObjetHtml_1.GHtml.setDisplay(LId + '_Creation', false);
                ObjetHtml_1.GHtml.setDisplay(LId + '_Creation_Edit', true);
              }
              this._cache.positionCreation = 0;
              this.surCreationDeb(false, { origine: 'menucontextuel' });
              if (aLigne.data) {
                if (this._cache.listeValeursCreation) {
                  this._cache.listeValeursCreation.data = aLigne.data;
                }
              }
              break;
            case Enumere_CommandeMenu_1.EGenreCommandeMenu.Edition:
              this.surEditionDeb(lParametres.colonne, lParametres.ligne);
              break;
            case Enumere_CommandeMenu_1.EGenreCommandeMenu.Suppression:
              this._surSuppression();
              break;
            default: {
              this.Donnees.evenementMenuContextuel(lParametres);
              if (lParametres.avecActualisation) {
                this._actualiser({
                  conserverSelection: true,
                  zonesActualisation: { contenu: true, total: true },
                });
              }
            }
          }
        }
      }
      surSelectionEvenement(I, J, aSurClavier, aSurInteractionUtilisateur) {
        const lParams = this._getParamsCellule(I, J);
        if (this.Donnees && J > -1) {
          if (this.Donnees.avecEvenementSelection(lParams)) {
            if (this.Pere && this.Evenement) {
              this.callback.appel(
                this._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe.Selection,
                  I,
                  J,
                  {
                    surClavier: aSurClavier,
                    surInteractionUtilisateur:
                      aSurInteractionUtilisateur !== false,
                  },
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe.Selection,
                I,
                J,
              );
            }
          }
        }
        this._refreshSelf();
        return true;
      }
      _surModificationSelectionEvenement(
        aSelectionsAncienne,
        aSurInteractionUtilisateur,
      ) {
        if (
          !this.Donnees ||
          !this.Donnees.options.avecEvnt_ModificationSelection
        ) {
          return false;
        }
        const lSelectionCourante = this._getCellulesSelection();
        if (
          aSelectionsAncienne &&
          lSelectionCourante &&
          aSelectionsAncienne.length === lSelectionCourante.length
        ) {
          const lIdentique = lSelectionCourante.every((aSelection, aIndex) => {
            const lSelection = aSelectionsAncienne[aIndex];
            return (
              aSelection.ligne === lSelection.ligne &&
              aSelection.article === lSelection.article &&
              MethodesObjet_1.MethodesObjet.objetsIdentiques(
                aSelection.colonnes,
                lSelection.colonnes,
              )
            );
          });
          if (lIdentique) {
            return false;
          }
        }
        if (this.Pere && this.Evenement) {
          this.callback.appel(
            this._getParamsCallback(
              Enumere_EvenementListe_1.EGenreEvenementListe
                .ModificationSelection,
              -1,
              -1,
              {
                cellulesSelection: lSelectionCourante,
                surInteractionUtilisateur: !!aSurInteractionUtilisateur,
              },
            ),
            Enumere_EvenementListe_1.EGenreEvenementListe.ModificationSelection,
            -1,
            -1,
          );
          this._refreshSelf();
          return true;
        }
        return false;
      }
      _refreshSelf() {
        if (
          this.Pere &&
          this.Pere instanceof ObjetIdentite_1.Identite &&
          this.Pere.$refresh
        ) {
          this.Pere.$refresh();
        } else {
          this.$refreshSelf();
        }
      }
      surSuppressionEvenement(aParams) {
        let lResult = false;
        if (
          this.Donnees &&
          (aParams.ligne > -1 ||
            (aParams.listeSuppressions &&
              aParams.listeSuppressions.count() > 0))
        ) {
          if (this.Donnees.avecEvenementSuppression(aParams)) {
            if (this.Pere && this.Evenement) {
              lResult = true;
              this.callback.appel(
                this._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe.Suppression,
                  aParams.colonne,
                  aParams.ligne,
                  aParams,
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe.Suppression,
                aParams.colonne,
                aParams.ligne,
              );
            }
          }
        }
        this._refreshSelf();
        return lResult;
      }
      surApresCreationEvenement(aLigne) {
        if (!this.Donnees) {
          return;
        }
        const lParams = this._getParamsCallback(
          Enumere_EvenementListe_1.EGenreEvenementListe.ApresCreation,
          null,
          aLigne,
        );
        if (this.Donnees.avecEvenementApresCreation()) {
          if (this.Pere && this.Evenement) {
            const lResult = this.callback.appel(
              lParams,
              Enumere_EvenementListe_1.EGenreEvenementListe.ApresCreation,
              null,
              null,
            );
            this._refreshSelf();
            return lResult;
          }
        }
      }
      surApresErreurCreationEvenement() {
        if (this.Donnees) {
          if (this.Donnees.avecEvenementApresErreurCreation()) {
            if (this.Pere && this.Evenement) {
              const lResult = this.callback.appel(
                this._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe
                    .ApresErreurCreation,
                  null,
                  null,
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe
                  .ApresErreurCreation,
                null,
                null,
              );
              this._refreshSelf();
              return lResult;
            }
          }
        }
      }
      surApresEditionEvenement(aParams) {
        if (this.Donnees) {
          if (this.Donnees.avecEvenementApresEdition(aParams)) {
            if (this.Pere && this.Evenement) {
              this.callback.appel(
                this._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition,
                  aParams.colonne,
                  aParams.ligne,
                  { avecModification: !!aParams.avecModification },
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition,
                aParams.colonne,
                aParams.ligne,
              );
            }
          }
        }
        this._refreshSelf();
        return true;
      }
      surApresSuppressionEvenement(aParams) {
        if (this.Donnees) {
          if (this.Donnees.avecEvenementApresSuppression()) {
            if (this.Pere && this.Evenement) {
              this.callback.appel(
                this._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe
                    .ApresSuppression,
                  aParams.colonne,
                  aParams.ligne,
                  aParams,
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe.ApresSuppression,
                aParams.colonne,
                aParams.ligne,
              );
            }
          }
        }
        this._refreshSelf();
      }
      entrerEdition() {
        this._nettoyerElementsEditionEnCours();
        this._setStyleCellule(this.IdCellule, null, null, false, true);
      }
      _getMapHTMLControleTexte(aParams) {
        const lControle = this.Donnees.getControleCaracteresInput(aParams);
        let lResult = {};
        if (lControle && lControle.mask) {
          lResult['ie-mask'] = '/[^' + lControle.mask + ']/i';
        }
        if (
          lControle &&
          lControle.tailleMax > 0 &&
          lControle.tailleMax < this._options.maxLengthTextareaIgnore
        ) {
          lResult.maxlength = lControle.tailleMax;
        }
        if (
          !lResult.maxlength &&
          IEHtml.MAX_LENGTH_Default > 0 &&
          this.Donnees._getTailleTexteMax(aParams) > IEHtml.MAX_LENGTH_Default
        ) {
          lResult.maxlength = 0;
        }
        return lResult;
      }
      _toString(aValeur) {
        return aValeur + '';
      }
      _setValueModel(aParams) {
        const lParams = Object.assign(
          {
            node: null,
            ligne: -1,
            colonne: -1,
            surCreation: false,
            value: '',
            estNote: false,
          },
          aParams,
        );
        this._cache.avecModificationSaisie = true;
        if (this._fenetreInformationAffichee) {
          return;
        }
        if (lParams.surCreation) {
          if (this._messageEnCoursSurCreation) {
            return;
          }
          if (!this._cache.creationEnCours) {
            return;
          }
          lParams.colonne = this._cache.numeroColonneCreationEnCours;
          lParams.ligne = -1;
        } else {
          if (!this._cache.editionEnCours) {
            return;
          }
        }
        if (lParams.estNote) {
          this._valeurEnEdition = lParams.value;
          return;
        }
        this._valeurEnEdition = this._toString(lParams.value);
        const lParamsCellule = this._getParamsCellule(
          lParams.colonne,
          lParams.ligne,
          {
            surEdition: true,
            surLigneCreation: lParams.surCreation,
            surInputSaisie: true,
          },
        );
        const lControle = ObjetChaine_1.GChaine.controleTailleTexte({
          chaine: this._valeurEnEdition,
          tailleTexteMax: this.Donnees._getTailleTexteMax(lParamsCellule),
        });
        if (!lControle.controleOK) {
          this._valeurEnEdition = lControle.chaine;
          this._fenetreInformationAffichee = true;
          GApplication.getMessage().afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
            message: this.Donnees.getMessageTailleMaximaleSaisie(),
            callback: () => {
              this._fenetreInformationAffichee = false;
              ObjetHtml_1.GHtml.setFocus(lParams.node);
            },
          });
        }
      }
      getIndiceColonneVisibleDeColonne(aColonne) {
        let lNumeroColonneVisible = 0;
        for (const lInfo of this._cache.infosZonesColonnes) {
          for (const lNumeroColonne of lInfo.colonnesVisibles) {
            lNumeroColonneVisible += 1;
            if (lNumeroColonne === aColonne) {
              return lNumeroColonneVisible;
            }
          }
        }
        return lNumeroColonneVisible || 1;
      }
      entrerTexte(
        aColonne,
        aLigne,
        aSurLigneCreation,
        aTypeCellule,
        aIgnorerEventsNode,
        aForcerEnFenetre,
      ) {
        const lParamsCellule = this._getParamsCellule(aColonne, aLigne, {
          surEdition: true,
          surLigneCreation: aSurLigneCreation,
          surInputSaisie: true,
        });
        let LValeur = this.Donnees._getValeur(lParamsCellule),
          lClass = '';
        const lEstNote =
          aTypeCellule ===
          ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Note;
        if (!lEstNote) {
          LValeur = this._toString(LValeur);
        }
        this._valeurEnEdition = LValeur;
        try {
          lClass = this.Donnees.getClass(lParamsCellule);
        } catch (e) {
          lClass = '';
        }
        const lEditionEnFenetre =
          aForcerEnFenetre ||
          (this.optionsInterne.versionMobile && aSurLigneCreation);
        const lIgnorerEventsNode = lEditionEnFenetre
          ? true
          : aIgnorerEventsNode;
        const H = [];
        const lIndexLigne = this._cache.lignesVisibles.indexOf(aLigne);
        let lAriaLabel = this.Donnees.getWAIInputEdition(lParamsCellule);
        if (lAriaLabel.trim() !== '') {
          lAriaLabel += ' ';
        }
        if (!aSurLigneCreation) {
          lAriaLabel += `${ObjetTraduction_1.GTraductions.getValeur('WAI.ligne')} ${lIndexLigne >= 0 ? lIndexLigne + 1 : aLigne} ${ObjetTraduction_1.GTraductions.getValeur('WAI.colonne')} ${this.getIndiceColonneVisibleDeColonne(aColonne)}`;
        }
        const lMapAttr = Object.assign(
          {
            id: this.IdEdition,
            class: [
              'Texte10 Liste_Input_Texte',
              lClass || '',
              lEditionEnFenetre ? 'round-style full-width' : '',
            ],
            style: lEditionEnFenetre ? false : 'border: 0px;',
            'ie-model': (0, jsx_1.jsxFuncAttr)('liste.saisieTexte', [
              aLigne,
              aColonne,
              !!aSurLigneCreation,
              lEstNote,
              false,
              lIgnorerEventsNode,
            ]),
            'aria-label': lAriaLabel,
            autocomplete: lEstNote ? 'off' : false,
            autocorrect: lEstNote ? 'off' : false,
            autocapitalize: lEstNote ? 'off' : false,
            spellcheck: lEstNote ? 'false' : false,
            size: aSurLigneCreation ? '1' : false,
          },
          this._getMapHTMLControleTexte(lParamsCellule),
        );
        const lHtmlInput = lEstNote
          ? IE.jsx.str('ie-inputnote', Object.assign({}, lMapAttr))
          : IE.jsx.str('input', Object.assign({}, lMapAttr));
        if (lEditionEnFenetre) {
          this.surEditionTextFenetreAsync({
            html: lHtmlInput,
            surCreation: aSurLigneCreation,
            surInputText: true,
            colonne: aColonne,
          });
          return;
        }
        const lHeightCellule = $('#' + this.IdCellule.escapeJQ()).height();
        const lHeight =
          this._getHeightCellule(lParamsCellule) -
          2 * this._options.paddingCelluleTB;
        if (this.optionsInterne.versionMobile) {
          H.push(
            IE.jsx.str(
              'div',
              {
                style: lHeightCellule
                  ? 'height:' +
                    lHeightCellule +
                    'px; line-height:' +
                    lHeightCellule +
                    'px;'
                  : '',
              },
              lHtmlInput,
            ),
          );
        } else {
          H.push(
            IE.jsx.str(
              'div',
              {
                style: `width: 100%; height:${lHeightCellule}px; line-height:${Math.min(lHeight, lHeightCellule)}px;`,
              },
              lHtmlInput,
            ),
          );
        }
        ObjetHtml_1.GHtml.setHtml(this.IdCellule, H.join(''), {
          instance: this,
        });
      }
      getIdAriaTitreDeColonne(aColonne) {
        if (this.ListeTitres && this.ListeTitres.length > 0) {
          return `${this.Nom}_titreAriaCelCol_${aColonne}`;
        }
        return '';
      }
      _getInfosZoneColonneDeNumeroColonne(aNumeroColonne) {
        let lInfosZone = null;
        this._cache.infosZonesColonnes.every((aZone) => {
          if (
            aNumeroColonne >= aZone.indiceColonneDebut &&
            aNumeroColonne <= aZone.indiceColonneFin
          ) {
            lInfosZone = aZone;
            return false;
          }
          return true;
        });
        return (
          lInfosZone ||
          this._cache.infosZonesColonnes[
            this._cache.infosZonesColonnes.length - 1
          ]
        );
      }
      afficherMarqueurEditionSurCellule(aColonne, aLigne) {
        if (this._options.skin === ObjetListe.skin.flatDesign) {
          return;
        }
        const lJConteneur = $('#' + this.ids.zoneFils.escapeJQ());
        $('#' + this.ids.surligneur_edition.escapeJQ()).remove();
        const lFunc = () => {
          const lRectCellule = ObjetPosition_1.GPosition.getClientRect(
            this.getIdCellule(aColonne, aLigne),
          );
          const lRectContenur = ObjetPosition_1.GPosition.getClientRect(
            this.ids.zoneFils,
          );
          const lInfosZone = this._getInfosZoneColonneDeNumeroColonne(aColonne);
          const lPremiereColonneBlocFixeDroite =
            lInfosZone.estBlocFixeDroite &&
            aColonne === lInfosZone.indiceColonneDebut;
          const lPos = {
            top: lRectCellule.top - lRectContenur.top - 2,
            left:
              lRectCellule.left +
              (lPremiereColonneBlocFixeDroite ? 1 : 0) -
              lRectContenur.left -
              2,
            height: lRectCellule.height + 3,
            width: lRectCellule.width + 3,
          };
          if (lPos.left + lPos.width > lRectContenur.width) {
            lPos.width = Math.max(
              1,
              lPos.width - (lPos.left + lPos.width - lRectContenur.width + 2),
            );
          }
          return lPos;
        };
        const lPos = lFunc();
        lJConteneur.ieHtmlAppend(
          [
            '<div id="',
            this.ids.surligneur_edition,
            '" class="liste_surligneur_edition" style="',
            ObjetStyle_1.GStyle.composeWidth(lPos.width),
            ObjetStyle_1.GStyle.composeHeight(lPos.height),
            'top:' + lPos.top + 'px;',
            'left:' + lPos.left + 'px;',
            '">',
            '</div>',
          ].join(''),
        );
        $('#' + this.ids.surligneur_edition.escapeJQ()).data('positionnement', {
          func: () => {
            const lPos = lFunc();
            $('#' + this.ids.surligneur_edition.escapeJQ()).css({
              left: lPos.left,
              top: lPos.top,
            });
          },
        });
      }
      entrerZoneTexte(
        aColonne,
        aLigne,
        aSurLigneCreation,
        aNumeroLigneCreation,
        aIgnorerEventsNode,
        aForcerEnFenetre,
      ) {
        const lParamsCellule = this._getParamsCellule(aColonne, aLigne, {
          surEdition: true,
          surLigneCreation: aSurLigneCreation,
          surInputSaisie: true,
          numeroLigneCreation: aNumeroLigneCreation,
        });
        this._valeurEnEdition = this._toString(
          this.Donnees._getValeur(lParamsCellule),
        );
        let lTailleMax = 0;
        const lControle =
          this.Donnees.getControleCaracteresInput(lParamsCellule);
        if (lControle) {
          lTailleMax = lControle.tailleMax || 0;
        }
        if (
          lTailleMax === 0 ||
          !MethodesObjet_1.MethodesObjet.isNumber(lControle.tailleMax)
        ) {
          lTailleMax = this.Donnees._getTailleTexteMax(lParamsCellule) || 0;
        }
        if (
          lTailleMax >= this._options.maxLengthTextareaIgnore ||
          !MethodesObjet_1.MethodesObjet.isNumber(lTailleMax)
        ) {
          lTailleMax = 0;
        }
        const lEditionEnFenetre =
          aForcerEnFenetre || this.optionsInterne.versionMobile;
        const lIgnorerEventsNode =
          this.optionsInterne.versionMobile || lEditionEnFenetre
            ? true
            : aIgnorerEventsNode;
        const T = [];
        T.push(
          IE.jsx.str(
            'ie-textareamax',
            Object.assign(
              {
                id: this.IdEdition,
                'ie-autoresize': lEditionEnFenetre,
                class: 'liste_textarea',
                'ie-model': (0, jsx_1.jsxFuncAttr)('liste.saisieTexte', [
                  aLigne,
                  aColonne,
                  !!aSurLigneCreation,
                  false,
                  true,
                  lIgnorerEventsNode,
                ]),
              },
              this._getMapHTMLControleTexte(lParamsCellule),
              { 'ie-compteurmax': lTailleMax > 0 ? lTailleMax : false },
            ),
          ),
        );
        const lInfosZone = this._getInfosZoneColonneDeNumeroColonne(aColonne),
          lPremiereColonneBlocFixeDroite =
            lInfosZone.estBlocFixeDroite &&
            aColonne === lInfosZone.indiceColonneDebut,
          lEstLigneCreationTitre =
            aSurLigneCreation && !(aNumeroLigneCreation >= 0);
        if (lEditionEnFenetre) {
          this.surEditionTextFenetreAsync({
            html: T.join(''),
            surCreation: aSurLigneCreation,
            colonne: aColonne,
          });
          return;
        }
        const lOffset = $('#' + this.IdCellule.escapeJQ()).offset();
        const lJConteneur = $('#' + this.ids.zoneFils.escapeJQ());
        const lOffsetConteneur = lJConteneur.offset();
        const lHeightConteneur = lJConteneur.height();
        const lPositionnement = {
          width:
            ObjetPosition_1.GPosition.getWidth(this.IdCellule) +
            (lInfosZone.dernierBloc && aColonne === lInfosZone.indiceColonneFin
              ? 1
              : 0) +
            (lPremiereColonneBlocFixeDroite ? -1 : 0),
          height: Math.max(
            Math.min(100, lHeightConteneur),
            ObjetPosition_1.GPosition.getHeight(this.IdCellule) + 1,
          ),
          left:
            lOffset.left -
            1 +
            (lPremiereColonneBlocFixeDroite ? 1 : 0) -
            lOffsetConteneur.left,
          top:
            lOffset.top +
            (lEstLigneCreationTitre ? 0 : -1) -
            lOffsetConteneur.top,
        };
        if (
          lOffset.top - lOffsetConteneur.top + lPositionnement.height >=
          lHeightConteneur
        ) {
          lPositionnement.top = Math.max(
            0,
            lPositionnement.top -
              (lOffset.top -
                lOffsetConteneur.top +
                lPositionnement.height -
                lHeightConteneur),
          );
        }
        lJConteneur.ieHtmlAppend(
          [
            '<div id="' +
              this.IdZoneTexte +
              '" class="liste_saisie_textarea" style="',
            ObjetStyle_1.GStyle.composeWidth(lPositionnement.width),
            ObjetStyle_1.GStyle.composeHeight(lPositionnement.height),
            'top:' + lPositionnement.top + 'px;',
            'left:' + lPositionnement.left + 'px;',
            '">' + T.join('') + '</div>',
          ].join(''),
          { controleur: this.controleur },
        );
      }
      _nettoyerElementsEditionEnCours() {
        $('#' + this.IdZoneTexte.escapeJQ()).remove();
        $('#' + this.ids.surligneur_edition.escapeJQ()).remove();
      }
      _surSelection(aNumeroColonne, aNumeroLigne, aParams) {
        if (this._cache.creationEnCours || this._cache.editionEnCours) {
          return false;
        }
        if (!this.Donnees) {
          return false;
        }
        const lParams = Object.assign(
          {
            avecFocus: true,
            forcerMonoSelection: false,
            ctrlKey: false,
            shiftKey: false,
            avecEvenementModificationSelection: true,
            surInteractionUtilisateur: false,
          },
          aParams,
        );
        this._cache.lignesSelectionnees_prec = [
          ...this._cache.lignesSelectionnees,
        ];
        const lSelections = lParams.avecEvenementModificationSelection
          ? this._getCellulesSelection(true)
          : null;
        let iLigne, iColonne;
        const lAvecMultiSelection =
            this.Donnees.avecMultiSelection() && !lParams.forcerMonoSelection,
          lEstSelectionParCellule = this._estSelectionParCellule(
            aNumeroLigne,
            aNumeroColonne,
          ),
          lMultiSelectionCtrl =
            lAvecMultiSelection &&
            (!this.Donnees.avecMultiSelectionSurCtrl() || lParams.ctrlKey),
          lMultiSelectionShift =
            lAvecMultiSelection &&
            (!this.Donnees.avecMultiSelectionSurShift() || lParams.shiftKey);
        if (!lMultiSelectionCtrl && !lMultiSelectionShift) {
          const lParamsCellule = this._getParamsCellule(
            aNumeroColonne,
            aNumeroLigne,
          );
          if (
            this._etatSelectionCellule({
              ligne: aNumeroLigne,
              colonne: aNumeroColonne,
              cacheSelection: this._cache.lignesSelectionnees_prec,
            }) &&
            this.Donnees._avecDeselection(lParamsCellule) &&
            !lAvecMultiSelection &&
            (lParams.ctrlKey ||
              this.Donnees.options.avecDeselectionMonoSelectionClick)
          ) {
            this._selectionner({
              deselectionnerTout: true,
              selectionner: false,
              avecEvenementModificationSelection: true,
            });
            this._cache.selectionCellule.ligne = -1;
            this._cache.selectionCellule.colonne = -1;
            this.Donnees._surSelection(aNumeroLigne, aNumeroColonne, false);
            return;
          }
          if (
            aNumeroColonne === this._cache.selectionCellule.colonne &&
            aNumeroLigne === this._cache.selectionCellule.ligne &&
            !lAvecMultiSelection &&
            this._etatSelectionCellule({
              ligne: aNumeroLigne,
              colonne: aNumeroColonne,
            })
          ) {
            return;
          }
          this._cache.selectionCellule.ligne = aNumeroLigne;
          this._cache.selectionCellule.colonne = aNumeroColonne;
          this._selectionner({
            ligne: aNumeroLigne,
            colonne: aNumeroColonne,
            deselectionnerTout: true,
            selectionner: true,
            _avecVisuCadreSelection: false,
          });
        } else if (lMultiSelectionShift) {
          if (
            !this._cache.celluleClicNonShift ||
            this._cache.celluleClicNonShift.ligne < 0 ||
            this._cache.celluleClicNonShift.colonne < 0
          ) {
            return;
          }
          const lMinLigne = Math.min(
              aNumeroLigne,
              this._cache.celluleClicNonShift.ligne,
            ),
            lMaxLigne = Math.max(
              aNumeroLigne,
              this._cache.celluleClicNonShift.ligne,
            );
          if (lEstSelectionParCellule) {
            const lMinColonne = Math.min(
                aNumeroColonne,
                this._cache.celluleClicNonShift.colonne,
              ),
              lMaxColonne = Math.max(
                aNumeroColonne,
                this._cache.celluleClicNonShift.colonne,
              );
            for (
              iLigne = 0;
              iLigne < this._cache.lignesSelectionnees.length;
              iLigne++
            ) {
              for (
                iColonne = 0;
                iColonne < this.ListeTailles.length;
                iColonne++
              ) {
                const lParamsCellule = this._getParamsCellule(iColonne, iLigne);
                if (
                  iColonne >= lMinColonne &&
                  iColonne <= lMaxColonne &&
                  iLigne >= lMinLigne &&
                  iLigne <= lMaxLigne &&
                  this._estLigneVisible(iLigne, { contexteSelection: true })
                ) {
                  if (
                    !this._etatSelectionCellule({
                      ligne: iLigne,
                      colonne: iColonne,
                    })
                  ) {
                    this._selectionner({
                      ligne: iLigne,
                      colonne: iColonne,
                      selectionner: true,
                      _avecVisuCadreSelection: false,
                    });
                  }
                } else if (
                  this._etatSelectionCellule({
                    ligne: iLigne,
                    colonne: iColonne,
                  }) &&
                  this.Donnees._avecDeselection(lParamsCellule)
                ) {
                  this._selectionner({
                    ligne: iLigne,
                    colonne: iColonne,
                    selectionner: false,
                    _avecVisuCadreSelection: false,
                  });
                }
              }
            }
          } else {
            for (
              iLigne = 0;
              iLigne < this._cache.lignesSelectionnees.length;
              iLigne++
            ) {
              const lParamsCellule = this._getParamsCellule(
                aNumeroColonne,
                iLigne,
              );
              if (
                iLigne >= lMinLigne &&
                iLigne <= lMaxLigne &&
                this._estLigneVisible(iLigne, { contexteSelection: true })
              ) {
                this._selectionner({
                  ligne: iLigne,
                  selectionner: true,
                  _avecVisuCadreSelection: false,
                });
              } else if (
                this._etatSelectionCellule({ ligne: iLigne }) &&
                this.Donnees._avecDeselection(lParamsCellule)
              ) {
                this._selectionner({
                  ligne: iLigne,
                  selectionner: false,
                  _avecVisuCadreSelection: false,
                });
              }
            }
          }
        } else if (lMultiSelectionCtrl) {
          const lNumeroColonneTraite = lEstSelectionParCellule
            ? aNumeroColonne
            : -1;
          if (
            this._etatSelectionCellule({
              ligne: aNumeroLigne,
              colonne: lNumeroColonneTraite,
            })
          ) {
            this._selectionner({
              ligne: aNumeroLigne,
              colonne: aNumeroColonne,
              selectionner: false,
              _avecVisuCadreSelection: false,
            });
            this._cache.selectionCellule.ligne = -1;
            this._cache.selectionCellule.colonne = -1;
          } else {
            this._selectionner({
              ligne: aNumeroLigne,
              colonne: aNumeroColonne,
              selectionner: true,
              _avecVisuCadreSelection: false,
            });
            this._cache.selectionCellule.ligne = aNumeroLigne;
            this._cache.selectionCellule.colonne = aNumeroColonne;
          }
        }
        this._actualiserCadreSelection();
        if (lParams.avecFocus) {
          const lNumeroColonne = aNumeroColonne > -1 ? aNumeroColonne : 0;
          if (this._estLigneDansRangeNonConstruitDyn(aNumeroLigne)) {
            this._scrollSurLigne({
              ligne: aNumeroLigne,
              colonne: lNumeroColonne,
            });
          }
          ObjetHtml_1.GHtml.setFocus(
            this.getIdCellule(lNumeroColonne, aNumeroLigne, true),
          );
        }
        this.Donnees._surSelection(
          this._cache.selectionCellule.colonne,
          this._cache.selectionCellule.ligne,
          true,
        );
        if (lParams.avecEvenementModificationSelection) {
          this._surModificationSelectionEvenement(
            lSelections,
            lParams.surInteractionUtilisateur,
          );
        }
        return true;
      }
      _celluleAvecBordureDroite(aEstDerniereColonne) {
        return (
          !aEstDerniereColonne && this._options.borduresCellule_horizontal > 0
        );
      }
      _getFusionColonnesCellule(aParametres) {
        const lFusion = {},
          lHash = {};
        let lNumeroColonneFusionEnCoursPrec = null,
          lParamsCellule,
          lDerniereColonne,
          lNumeroColonneFusion,
          lNumeroColonneReferenceFusion = aParametres.colonnesVisibles[0];
        const lTailles = aParametres.tailles || this._cache.taillesColonne;
        aParametres.colonnesVisibles.forEach((aNumeroColonne) => {
          if (aParametres.total) {
            lParamsCellule = aParametres.getParamsCellule(aNumeroColonne);
          } else {
            lParamsCellule = this._getParamsCellule(
              aNumeroColonne,
              aParametres.ligne,
              { colonnesVisibles: aParametres.colonnesVisibles },
            );
          }
          if (aParametres.total) {
            lNumeroColonneFusion =
              this.Donnees.getColonneDeFusionTotal(lParamsCellule);
          } else {
            lNumeroColonneFusion =
              this.Donnees.getColonneDeFusion(lParamsCellule);
          }
          if (
            lNumeroColonneFusion === undefined ||
            lNumeroColonneFusion === null
          ) {
            lNumeroColonneFusion = aNumeroColonne;
          } else if (
            MethodesObjet_1.MethodesObjet.isString(lNumeroColonneFusion)
          ) {
            lNumeroColonneFusion =
              this.getNumeroColonneDIdColonne(lNumeroColonneFusion);
          } else if (
            !MethodesObjet_1.MethodesObjet.isNumber(lNumeroColonneFusion)
          ) {
            lNumeroColonneFusion = aNumeroColonne;
          }
          if (
            lNumeroColonneFusion !== aNumeroColonne &&
            !this._estColonneVisible(lNumeroColonneFusion)
          ) {
            IE.log.addLog(
              '[_getFusionColonnesCellule] la colonne de fusion est invisible',
            );
            lNumeroColonneFusion = aNumeroColonne;
          }
          if (
            lNumeroColonneFusion !== aNumeroColonne &&
            (lNumeroColonneFusion > aParametres.indiceColonneFin ||
              lNumeroColonneFusion < aParametres.indiceColonneDebut)
          ) {
            IE.log.addLog(
              '[_getFusionColonnesCellule] la colonne de fusion est hors du bloc',
            );
            lNumeroColonneFusion =
              lNumeroColonneFusion > aParametres.indiceColonneFin
                ? aParametres.indiceColonneFin
                : aParametres.indiceColonneDebut;
          }
          if (
            lNumeroColonneFusionEnCoursPrec !== null &&
            lNumeroColonneFusion < lNumeroColonneFusionEnCoursPrec
          ) {
            IE.log.addLog(
              '[_getFusionColonnesCellule] erreur getColonneDeFusion sur colonne ' +
                aNumeroColonne,
            );
            Object.keys(lHash).forEach((aCle) => {
              if (lHash[aCle] === lNumeroColonneFusionEnCoursPrec) {
                lHash[aCle] = parseInt(aCle, 10);
              }
            });
          }
          if (
            lNumeroColonneFusion === aNumeroColonne &&
            aNumeroColonne > 0 &&
            !aParametres.total &&
            this.Donnees.fusionCelluleAvecColonnePrecedente(lParamsCellule)
          ) {
            lNumeroColonneFusion = lNumeroColonneReferenceFusion;
          } else {
            lNumeroColonneReferenceFusion = aNumeroColonne;
          }
          lHash[aNumeroColonne] = lNumeroColonneFusion;
          lNumeroColonneFusionEnCoursPrec = lNumeroColonneFusion;
        });
        aParametres.colonnesVisibles.forEach((aNumeroColonne) => {
          const lColPrimaire = lHash[aNumeroColonne];
          if (!lFusion[lColPrimaire]) {
            lFusion[lColPrimaire] = {
              nbCol: 0,
              taille: parseInt(lTailles[lColPrimaire].px + '', 10),
              debut: lColPrimaire,
              fin: lColPrimaire,
            };
          }
          lFusion[lColPrimaire].nbCol += 1;
          if (lColPrimaire !== aNumeroColonne) {
            lDerniereColonne =
              aParametres.indiceColonneFin === aNumeroColonne &&
              aParametres.dernierBloc;
            lFusion[lColPrimaire].taille +=
              parseInt(lTailles[aNumeroColonne].px + '', 10) +
              2 * this._options.paddingCelluleLR +
              (this._celluleAvecBordureDroite(lDerniereColonne) ? 1 : 0);
            lFusion[lColPrimaire].debut = Math.min(
              aNumeroColonne,
              lFusion[lColPrimaire].debut,
            );
            lFusion[lColPrimaire].fin = Math.max(
              aNumeroColonne,
              lFusion[lColPrimaire].fin,
            );
          }
        });
        return lFusion;
      }
      setCadreSelectionInterne(aParams, aArrayTraitements) {
        if (
          !aParams.selection &&
          (!aParams.posCellulePrec || !aParams.posCellulePrec.selection)
        ) {
          return;
        }
        const lElement = ObjetHtml_1.GHtml.getElement(aParams.idCellule);
        if (lElement) {
          this._setStyleCellule(
            lElement,
            aParams.colonne,
            aParams.ligne,
            aParams.selection,
          );
        }
        let lNumeroColonne;
        const lIdSelecCellule =
          this.ids.cadreSelection +
          '_sel_' +
          aParams.ligne +
          '_' +
          aParams.colonne;
        let lPositionCache = this._cache.positionsCelluleCadreSelection[
          aParams.ligne
        ]
          ? this._cache.positionsCelluleCadreSelection[aParams.ligne][
              aParams.colonne
            ]
          : null;
        if (aParams.selection) {
          if (!this._cache.positionsCelluleCadreSelection[aParams.ligne]) {
            this._cache.positionsCelluleCadreSelection[aParams.ligne] = {};
          }
          if (
            !this._cache.positionsCelluleCadreSelection[aParams.ligne][
              aParams.colonne
            ]
          ) {
            let lParamsCellule;
            try {
              const lIndexLigne = this._cache.lignesVisibles.indexOf(
                aParams.ligne,
              );
              lParamsCellule = this._getParamsCellule(
                aParams.colonne,
                aParams.ligne,
                {
                  celluleLignePrecedente:
                    lIndexLigne > 0
                      ? this._getParamsCellule(
                          aParams.colonne,
                          this._cache.lignesVisibles[lIndexLigne - 1],
                        )
                      : null,
                  celluleLigneSuivante:
                    lIndexLigne >= 0 &&
                    lIndexLigne + 1 < this._cache.lignesVisibles.length
                      ? this._getParamsCellule(
                          aParams.colonne,
                          this._cache.lignesVisibles[lIndexLigne + 1],
                        )
                      : null,
                },
              );
            } catch (e) {
              lParamsCellule = null;
            }
            let lModifHeight = 0;
            const lNode = ObjetHtml_1.GHtml.getElement(aParams.idCellule);
            if (!lNode) {
              $('#' + lIdSelecCellule.escapeJQ()).remove();
              return;
            }
            if (!this.optionsInterne.versionMobile) {
              if (
                this.Donnees &&
                this._options.borduresCellule_vertical > 0 &&
                lParamsCellule &&
                !this.Donnees.avecBordureBas(lParamsCellule)
              ) {
                lModifHeight += this._options.borduresCellule_vertical;
              } else {
                lModifHeight = ObjetStyle_1.GStyle.getFloatComputedValue(
                  lNode,
                  'border-bottom-width',
                );
              }
            }
            const lRect = ObjetPosition_1.GPosition.getRect(lNode, true);
            let lRectScroll = { top: 0, left: 0 };
            const lConteneurSel = ObjetHtml_1.GHtml.getElement(
              this.ids.cadreSelection + aParams.bloc.indiceBloc,
            );
            if (lConteneurSel) {
              lRectScroll = ObjetPosition_1.GPosition.getRect(
                lConteneurSel,
                true,
              );
            }
            this._cache.positionsCelluleCadreSelection[aParams.ligne][
              aParams.colonne
            ] = {
              top: lRect.top - lRectScroll.top,
              left: lRect.left - lRectScroll.left,
              height: lRect.height - lModifHeight,
              width: lRect.width,
            };
            lPositionCache =
              this._cache.positionsCelluleCadreSelection[aParams.ligne][
                aParams.colonne
              ];
          }
        }
        if (lPositionCache) {
          lPositionCache.selection = !!aParams.selection;
        }
        if (aParams.selection) {
          let lBloc;
          const lFusionLigneIdentique = function (aColonne) {
            if (
              !this._cache.lignesFusionParColonne[
                aColonne + '_' + aParams.ligne
              ] &&
              !this._cache.lignesFusionParColonne[
                aParams.colonne + '_' + aParams.ligne
              ]
            ) {
              return true;
            }
            if (
              this._cache.lignesFusionParColonne[
                lNumeroColonne + '_' + aParams.ligne
              ] &&
              this._cache.lignesFusionParColonne[
                aParams.colonne + '_' + aParams.ligne
              ] &&
              this._cache.lignesFusionParColonne[
                aParams.colonne + '_' + aParams.ligne
              ].ligneOrigine ===
                this._cache.lignesFusionParColonne[
                  aParams.colonne + '_' + aParams.ligne
                ].ligneOrigine
            ) {
              return true;
            }
            return false;
          };
          const lFusions = this._getFusionColonnesCellule({
            colonnesVisibles: aParams.bloc.colonnesVisibles,
            ligne: aParams.ligne,
            indiceColonneDebut: aParams.bloc.indiceColonneDebut,
            indiceColonneFin: aParams.bloc.indiceColonneFin,
            dernierBloc:
              aParams.bloc.dernierBloc ||
              (!aParams.bloc.dernierBloc && !aParams.bloc.estBlocFixe),
          });
          let lIndiceCol = aParams.bloc.colonnesVisibles.indexOf(
            lFusions[aParams.colonne].debut,
          );
          lNumeroColonne = aParams.bloc.colonnesVisibles[lIndiceCol - 1];
          if (lIndiceCol === 0) {
            lBloc = this._cache.infosZonesColonnes[aParams.bloc.indiceBloc - 1];
            if (lBloc) {
              lNumeroColonne =
                lBloc.colonnesVisibles[lBloc.colonnesVisibles.length - 1];
            }
          }
          const lParamsCellulePrec = this._getParamsCellule(
            lNumeroColonne,
            aParams.ligne,
          );
          lPositionCache.selColPrec =
            (aParams.bloc.indiceBloc > 0 ||
              aParams.colonne > aParams.bloc.colonnesVisibles[0]) &&
            lFusionLigneIdentique.call(this, lNumeroColonne) &&
            this._etatSelectionCellule({
              ligne: aParams.ligne,
              colonne: lNumeroColonne,
            }) &&
            this.Donnees._avecSelection(lParamsCellulePrec);
          lIndiceCol = aParams.bloc.colonnesVisibles.indexOf(
            lFusions[aParams.colonne].fin,
          );
          lNumeroColonne = aParams.bloc.colonnesVisibles[lIndiceCol + 1];
          if (lIndiceCol >= aParams.bloc.colonnesVisibles.length - 1) {
            lBloc = this._cache.infosZonesColonnes[aParams.bloc.indiceBloc + 1];
            if (lBloc) {
              lNumeroColonne = lBloc.colonnesVisibles[0];
            }
          }
          const lParamsCelluleSuiv = this._getParamsCellule(
            lNumeroColonne,
            aParams.ligne,
          );
          lPositionCache.selColSuivante =
            (!aParams.bloc.dernierBloc ||
              aParams.colonne <
                aParams.bloc.colonnesVisibles[
                  aParams.bloc.colonnesVisibles.length - 1
                ]) &&
            lFusionLigneIdentique.call(this, lNumeroColonne) &&
            this._etatSelectionCellule({
              ligne: aParams.ligne,
              colonne: lNumeroColonne,
            }) &&
            this.Donnees._avecSelection(lParamsCelluleSuiv);
          if (
            aParams.posCellulePrec &&
            aParams.posCellulePrec.selection &&
            aParams.posCellulePrec.selColPrec === lPositionCache.selColPrec &&
            aParams.posCellulePrec.selColSuivante ===
              lPositionCache.selColSuivante
          ) {
            return;
          }
          const lStyle =
            ObjetStyle_1.GStyle.composeWidth(
              lPositionCache.width +
                (lPositionCache.selColPrec ? 1 : 0) +
                (lPositionCache.selColSuivante ? 1 : 0),
            ) +
            'left:' +
            (lPositionCache.selColPrec ? -1 : 0) +
            'px;';
          const lId = this.ids.cadreSelection + aParams.bloc.indiceBloc;
          $('#' + lIdSelecCellule.escapeJQ()).remove();
          aArrayTraitements.cacheHTML[lId] =
            (aArrayTraitements.cacheHTML[lId] || '') +
            (0, tag_1.tag)(
              'div',
              {
                class: 'liste_ligneSelection',
                id: lIdSelecCellule,
                style:
                  'top:' +
                  lPositionCache.top +
                  'px;' +
                  'left:' +
                  lPositionCache.left +
                  'px;',
              },
              !lPositionCache.selColPrec
                ? (0, tag_1.tag)('div', {
                    class: 'liste_ligneSelection_g',
                    style: ObjetStyle_1.GStyle.composeHeight(
                      lPositionCache.height,
                    ),
                  })
                : '',
              (0, tag_1.tag)('div', {
                class: 'liste_ligneSelection_h',
                style: lStyle,
              }),
              !lPositionCache.selColSuivante
                ? (0, tag_1.tag)('div', {
                    class: 'liste_ligneSelection_d',
                    style:
                      'left:' +
                      (lPositionCache.width - 2) +
                      'px;' +
                      ObjetStyle_1.GStyle.composeHeight(lPositionCache.height),
                  })
                : '',
              (0, tag_1.tag)('div', {
                class: 'liste_ligneSelection_b',
                style: 'top:' + (lPositionCache.height - 2) + 'px;' + lStyle,
              }),
            );
        } else {
          if (aParams.posCellulePrec && aParams.posCellulePrec.selection) {
            $('#' + lIdSelecCellule.escapeJQ()).remove();
          }
        }
      }
      _actualiserCadreSelection() {
        if (this._options.avecCadreSelection) {
          this._getTraitementsAffichageSelection().forEach(
            (aTraitement, aIndex, aArray) => {
              this._setCadreSelection(aTraitement, aIndex, aArray);
            },
          );
        }
      }
      _setCadreSelection(aParams, aIndexTraitement, aArrayTraitements) {
        if (aIndexTraitement === 0) {
          aArrayTraitements.cacheHTML = {};
        }
        this.setCadreSelectionInterne(aParams, aArrayTraitements);
        if (aIndexTraitement >= aArrayTraitements.length - 1) {
          for (const lKey in aArrayTraitements.cacheHTML) {
            const lElementBloc = ObjetHtml_1.GHtml.getElement(lKey);
            if (lElementBloc) {
              lElementBloc.innerHTML += aArrayTraitements.cacheHTML[lKey];
            }
          }
        }
      }
      _etatSelectionCellule(aParametres, aSelectionne) {
        const lParametres = Object.assign(
          {
            ligne: -1,
            colonne: -1,
            cacheSelection: this._cache.lignesSelectionnees,
          },
          aParametres,
        );
        if (arguments.length > 1) {
          if (aSelectionne) {
            const lParamsCellule = this._getParamsCellule(
              lParametres.colonne,
              lParametres.ligne,
            );
            if (
              lParametres.colonne >= 0 &&
              !this.Donnees._avecSelection(lParamsCellule)
            ) {
              return;
            }
            if (!lParametres.cacheSelection[lParametres.ligne]) {
              lParametres.cacheSelection[lParametres.ligne] = [];
            }
            if (lParametres.colonne < 0) {
              for (let i = 0; i < this.ListeTailles.length; i++) {
                lParametres.cacheSelection[lParametres.ligne][i] = true;
              }
            } else {
              lParametres.cacheSelection[lParametres.ligne][
                lParametres.colonne
              ] = aSelectionne;
            }
          } else {
            if (!lParametres.cacheSelection[lParametres.ligne]) {
              return;
            }
            if (lParametres.colonne < 0) {
              delete lParametres.cacheSelection[lParametres.ligne];
              return;
            }
            lParametres.cacheSelection[lParametres.ligne][lParametres.colonne] =
              false;
            if (
              lParametres.cacheSelection[lParametres.ligne].every(
                (aColonne) => {
                  return aColonne !== true;
                },
              )
            ) {
              delete lParametres.cacheSelection[lParametres.ligne];
            }
          }
        } else {
          if (!lParametres.cacheSelection[lParametres.ligne]) {
            return false;
          }
          if (lParametres.colonne < 0) {
            return !!lParametres.cacheSelection[lParametres.ligne];
          }
          return !!lParametres.cacheSelection[lParametres.ligne][
            lParametres.colonne
          ];
        }
      }
      _getTraitementsAffichageSelection() {
        const lTraitements = [];
        if (!this.Donnees) {
          return lTraitements;
        }
        this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
          this.Donnees.Donnees.parcourir((aArticle, aLigne) => {
            if (this._estLigneVisible(aLigne, { contexteSelection: true })) {
              aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
                const lPosCellule =
                  this._cache.positionsCelluleCadreSelection[aLigne] &&
                  this._cache.positionsCelluleCadreSelection[aLigne][
                    aNumeroColonne
                  ]
                    ? this._cache.positionsCelluleCadreSelection[aLigne][
                        aNumeroColonne
                      ]
                    : null;
                const lParamsCellule = this._getParamsCellule(
                  aNumeroColonne,
                  aLigne,
                );
                const lTraitement = {
                  bloc: aInfosZoneColonnes,
                  ligne: aLigne,
                  colonne: aNumeroColonne,
                  idCellule: this.getIdCellule(aNumeroColonne, aLigne),
                  selection:
                    !!this._etatSelectionCellule({
                      ligne: aLigne,
                      colonne: aNumeroColonne,
                    }) && !!this.Donnees._avecSelection(lParamsCellule),
                  posCellulePrec: Object.assign({}, lPosCellule),
                };
                lTraitements.push(lTraitement);
              });
            }
          });
        });
        return lTraitements;
      }
      _selectionner(aParametres) {
        if (!this.Donnees) {
          return;
        }
        const lParametres = Object.assign(
          {
            ligne: -1,
            colonne: -1,
            selectionner: true,
            avecScroll: false,
            avecEvenement: false,
            deselectionnerTout: false,
            avecFocusCellule: false,
            _avecVisuCadreSelection: true,
            avecEvenementModificationSelection: false,
          },
          aParametres,
        );
        let lNumeroColonne = lParametres.colonne;
        let lTrouverLignePourScroll = false;
        const lEstSelectionParCellule = this._estSelectionParCellule(
          lParametres.ligne,
          lNumeroColonne,
        );
        const lAvecMultiSelection = this.Donnees.avecMultiSelection();
        const lParamsCellule = this._getParamsCellule(
          lParametres.colonne,
          lParametres.ligne,
        );
        const lCelluleAvecSelection =
          lParametres.ligne >= 0
            ? this.Donnees._avecSelection(lParamsCellule)
            : true;
        if (
          lParametres.selectionner &&
          lEstSelectionParCellule &&
          !lCelluleAvecSelection
        ) {
          return;
        }
        if (!lEstSelectionParCellule) {
          lNumeroColonne = -1;
        }
        if (
          lParametres.selectionner &&
          lParametres.ligne > -1 &&
          !lAvecMultiSelection &&
          !lParametres._surMultiSelectionMiroir
        ) {
          if (lParametres.deselectionnerTout === false) {
            lParametres.deselectionnerTout = true;
          } else if (
            lParametres.deselectionnerTout &&
            !lCelluleAvecSelection &&
            lParametres.ligne >= 0 &&
            !this.Donnees.options.avecDeselectionSurNonSelectionnable
          ) {
            lParametres.deselectionnerTout = false;
          }
        }
        const lSelectionsPrecedente =
          lParametres.avecEvenementModificationSelection
            ? this._getCellulesSelection(true)
            : null;
        if (lParametres.deselectionnerTout) {
          let lAvecDeselectionCellule = false;
          for (
            let lLigne = 0;
            lLigne < this._cache.lignesSelectionnees.length;
            lLigne++
          ) {
            if (lEstSelectionParCellule) {
              for (
                let lColonne = 0;
                lColonne < this.ListeTailles.length;
                lColonne++
              ) {
                if (
                  this._etatSelectionCellule({
                    ligne: lLigne,
                    colonne: lColonne,
                  })
                ) {
                  if (
                    lLigne !== lParametres.ligne ||
                    lColonne !== lNumeroColonne
                  ) {
                    lAvecDeselectionCellule = true;
                  }
                  this._selectionner({
                    ligne: lLigne,
                    colonne: lColonne,
                    selectionner: false,
                    _avecVisuCadreSelection: false,
                  });
                }
              }
            } else {
              if (this._etatSelectionCellule({ ligne: lLigne })) {
                if (lLigne !== lParametres.ligne) {
                  lAvecDeselectionCellule = true;
                }
                this._selectionner({
                  ligne: lLigne,
                  selectionner: false,
                  _avecVisuCadreSelection: false,
                });
              }
            }
          }
          if (lAvecDeselectionCellule && lAvecMultiSelection) {
            this._cache.lignesSelectionnees_prec = [];
          }
        }
        let lOldlignesSelection = null;
        if (lParametres.ligne > -1) {
          lOldlignesSelection = [...this._cache.lignesSelectionnees];
          if (!lParametres.selectionner && lNumeroColonne === -1) {
            this._etatSelectionCellule(
              { ligne: lParametres.ligne, colonne: lNumeroColonne },
              lParametres.selectionner,
            );
          }
          this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
            this.Donnees.Donnees.parcourir((aElementLigne, aLigne) => {
              if (aElementLigne) {
                const lEstLigneVisible = this._estLigneVisible(aLigne, {
                  contexteSelection: true,
                });
                aInfosZoneColonnes.colonnesVisibles.forEach(
                  (aNumeroColonne) => {
                    const lParamsCelluleDeColonne = this._getParamsCellule(
                      aNumeroColonne,
                      aLigne,
                    );
                    if (
                      !this._estColonneVisible(aNumeroColonne) ||
                      !this.Donnees._avecSelection(lParamsCelluleDeColonne)
                    ) {
                      return;
                    }
                    if (
                      lParametres.selectionner &&
                      lParametres.ligne === aLigne &&
                      !lEstLigneVisible
                    ) {
                      IE.log.addLog(
                        'MMh ? selection de ligne invisible ? voir fv',
                      );
                      return;
                    }
                    if (
                      lParametres.ligne === aLigne &&
                      (lNumeroColonne === -1 ||
                        lNumeroColonne === aNumeroColonne)
                    ) {
                      this._etatSelectionCellule(
                        { ligne: lParametres.ligne, colonne: aNumeroColonne },
                        lParametres.selectionner,
                      );
                    } else if (
                      !lEstSelectionParCellule &&
                      this.Donnees.options.avecMultiSelectionSurLigneFusion &&
                      lParametres.ligne !== aLigne &&
                      lParametres.colonne >= 0
                    ) {
                      let lAvecModif = false;
                      let lFusionCellule;
                      lFusionCellule =
                        this._cache.lignesFusionParColonne[
                          lParametres.colonne + '_' + lParametres.ligne
                        ];
                      if (
                        lFusionCellule &&
                        lFusionCellule.lignesCumuls &&
                        lFusionCellule.lignesCumuls[aLigne]
                      ) {
                        lAvecModif = true;
                      }
                      if (!lAvecModif) {
                        lFusionCellule =
                          this._cache.lignesFusionParColonne[
                            aNumeroColonne + '_' + aLigne
                          ];
                        if (
                          lFusionCellule &&
                          lFusionCellule.lignesCumuls &&
                          lFusionCellule.lignesCumuls[lParametres.ligne]
                        ) {
                          lAvecModif = true;
                        }
                      }
                      if (lAvecModif) {
                        this._etatSelectionCellule(
                          { ligne: aLigne, colonne: aNumeroColonne },
                          lParametres.selectionner,
                        );
                      }
                    }
                  },
                );
              }
            });
          });
          if (
            lParametres.selectionner &&
            !lParametres._surMultiSelectionMiroir
          ) {
            this._cache.selectionCellule.ligne = lParametres.ligne;
            this._cache.selectionCellule.colonne = lParametres.colonne;
          }
          if (lNumeroColonne < 0 && !lParametres._surMultiSelectionMiroir) {
            this.Donnees._surSelectionLigne(
              lParametres.ligne,
              lParametres.selectionner,
            );
          }
        }
        if (
          !lEstSelectionParCellule &&
          lParametres.ligne >= 0 &&
          !lParametres._surMultiSelectionMiroir &&
          this.Donnees.options.avecRechercheSelectionMiroir
        ) {
          const lParamsCellule = this._getParamsCellule(
            lParametres.colonne,
            lParametres.ligne,
            { selectionner: lParametres.selectionner },
          );
          if (lParamsCellule.article) {
            this.Donnees.Donnees.parcourir((aElement, aLigne) => {
              if (aLigne !== lParametres.ligne && aElement) {
                const lParamsCelluleCible = this._getParamsCellule(
                  lParametres.colonne,
                  aLigne,
                  {
                    estLigneVisible: this._estLigneVisible(aLigne, {
                      contexteSelection: true,
                    }),
                  },
                );
                if (
                  this.Donnees.estSelectionCibleMiroirDeSelectionSource(
                    lParamsCellule,
                    lParamsCelluleCible,
                  )
                ) {
                  this._selectionner({
                    ligne: aLigne,
                    colonne: -1,
                    selectionner: lParametres.selectionner,
                    _avecVisuCadreSelection:
                      lParametres._avecVisuCadreSelection,
                    _surMultiSelectionMiroir: true,
                  });
                }
              }
            });
          }
        }
        let lTraitements = null;
        if (
          this._options.avecCadreSelection &&
          lParametres._avecVisuCadreSelection
        ) {
          lTraitements = this._getTraitementsAffichageSelection();
          lTraitements.forEach((aTraitement, aIndex, aArray) => {
            this._setCadreSelection(aTraitement, aIndex, aArray);
          });
        }
        if (lParametres.ligne > -1) {
          let lLignePourScroll = Number.MAX_VALUE;
          let lColonnePourScroll = 0;
          if (
            !lTraitements &&
            lOldlignesSelection &&
            (!this._options.avecCadreSelection ||
              (lParametres.selectionner && lParametres.avecScroll))
          ) {
            lTraitements = this._getTraitementsAffichageSelection();
          }
          if (lTraitements) {
            lTraitements.forEach((aTraitement) => {
              const lOldSelec = lOldlignesSelection[aTraitement.ligne]
                ? !!lOldlignesSelection[aTraitement.ligne][aTraitement.colonne]
                : false;
              if (!this._options.avecCadreSelection) {
                const lElement = ObjetHtml_1.GHtml.getElement(
                  aTraitement.idCellule,
                );
                if (lElement) {
                  this._setStyleCellule(
                    lElement,
                    aTraitement.colonne,
                    aTraitement.ligne,
                    aTraitement.selection,
                  );
                }
              }
              if (lOldSelec !== aTraitement.selection) {
                if (
                  lParametres.selectionner &&
                  lParametres.avecScroll &&
                  aTraitement.ligne < lLignePourScroll
                ) {
                  lLignePourScroll = aTraitement.ligne;
                  lColonnePourScroll = aTraitement.colonne;
                  lTrouverLignePourScroll = true;
                }
              }
            });
          }
          if (lParametres.avecFocusCellule && lParametres.colonne >= 0) {
            const lIdCellule = this.getIdCellule(
              lParametres.colonne,
              lParametres.ligne,
              true,
            );
            const lElementFocus = ObjetHtml_1.GHtml.getElement(lIdCellule);
            if (ObjetHtml_1.GHtml.estElement(lElementFocus)) {
              ObjetHtml_1.GHtml.setFocus(lElementFocus, true, 0);
            } else if (
              this._estLigneDansRangeNonConstruitDyn(lParametres.ligne)
            ) {
              this._scrollSurLigne({
                ligne: lParametres.ligne,
                colonne: lParametres.colonne,
              });
              ObjetHtml_1.GHtml.setFocus(lIdCellule, true, 0);
            }
          }
          if (
            lParametres.selectionner &&
            lParametres.avecScroll &&
            lTrouverLignePourScroll
          ) {
            this._scrollSurLigne({
              ligne: lLignePourScroll,
              colonne: lColonnePourScroll,
            });
          }
        }
        if (lParametres.avecEvenementModificationSelection) {
          this._surModificationSelectionEvenement(lSelectionsPrecedente);
        }
        if (lParametres.avecEvenement && lParametres.selectionner) {
          this.surSelectionEvenement(-1, lParametres.ligne, false, false);
        }
        this._refreshSelf();
      }
      _estCellulePrecedemmentSelectionnee(aColonne, aLigne) {
        if (!this._cache.lignesSelectionnees_prec) {
          return false;
        }
        if (
          this._etatSelectionCellule({
            ligne: aLigne,
            colonne: aColonne,
            cacheSelection: this._cache.lignesSelectionnees_prec,
          })
        ) {
          return true;
        }
        const lInfosFusion =
          this._cache.lignesFusionParColonne[aColonne + '_' + aLigne];
        if (lInfosFusion && lInfosFusion.lignesCumuls) {
          for (const lLigne in lInfosFusion.lignesCumuls) {
            if (
              this._etatSelectionCellule({
                ligne: parseInt(lLigne, 10),
                colonne: aColonne,
                cacheSelection: this._cache.lignesSelectionnees_prec,
              })
            ) {
              return true;
            }
          }
        }
        return false;
      }
      _avecEditionApresSelection(aParamsCellule) {
        let lParamsCellule = aParamsCellule;
        let lNumeroColonne = lParamsCellule.colonne;
        if (
          lNumeroColonne &&
          MethodesObjet_1.MethodesObjet.isString(lNumeroColonne)
        ) {
          lNumeroColonne = this.getNumeroColonneDIdColonne(lNumeroColonne);
        }
        if (
          lNumeroColonne < 0 ||
          !MethodesObjet_1.MethodesObjet.isNumber(lNumeroColonne)
        ) {
          lParamsCellule = this._getParamsCellule(
            lNumeroColonne,
            lParamsCellule.ligne,
            { surEdition: true },
          );
        }
        lParamsCellule.typeValeur = this.Donnees.getTypeValeur(lParamsCellule);
        return this.Donnees.avecEditionApresSelection(lParamsCellule);
      }
      _editionDebSurSelection(aColonne, aLigne, aEvent) {
        if (this._cache.creationEnCours || this._cache.editionEnCours) {
          return;
        }
        const lParams = this._getParamsCellule(aColonne, aLigne, {
          surEdition: true,
        });
        if (this.evenementSelectionClick(lParams)) {
          return;
        }
        if (
          aEvent &&
          (aEvent.type === 'click' || aEvent.type === 'mouseup') &&
          (aEvent.ctrlKey === true || aEvent.shiftKey === true)
        ) {
          return;
        }
        if (
          !this._avecEditionApresSelection(lParams) ||
          !this.Donnees._avecSelection(lParams) ||
          this._estCellulePrecedemmentSelectionnee(
            lParams.colonne,
            lParams.ligne,
          ) ||
          this.Donnees.avecSelecFile(lParams)
        ) {
          this.surEditionDeb(aColonne, aLigne);
        }
      }
      evenementSelectionClick(aParamsCellule) {
        let lResult = false;
        if (this.Donnees && aParamsCellule.ligne > -1) {
          if (this.Donnees.avecEvenementSelectionClick(aParamsCellule)) {
            if (this.Pere && this.Evenement) {
              lResult = this.callback.appel(
                this._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe.SelectionClick,
                  aParamsCellule.colonne,
                  aParamsCellule.ligne,
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe.SelectionClick,
                aParamsCellule.colonne,
                aParamsCellule.ligne,
              );
              this._refreshSelf();
            }
          }
        }
        return lResult;
      }
      _ajouterElementCreation(aLibelle, aValeurCreation) {
        if (aLibelle) {
          if (this._getNonEditable()) {
            return;
          }
          if (!this._cache.creationEnCours) {
            this._cache.creationEnCours = true;
            this._cache.creationEnCoursEvenement = false;
          }
          this._cache.listeValeursCreation[-1] = aValeurCreation;
          if (this._cache.positionCreation === 0) {
            this._cache.numeroColonneCreationEnCours =
              this.ListeCreations[this._cache.positionCreation++];
          }
          this._surCreation(aLibelle);
        } else {
          this._annulerCreation();
        }
        return this;
      }
      _surLigneCreationUnique(aSurClick, aLigne, aSurToucheEdition) {
        const lParams = this._getParamsCellule(-1, aLigne, {
            surCreation: true,
          }),
          lAvecInputFile = this.Donnees && this.Donnees.avecSelecFile(lParams);
        if (
          lAvecInputFile &&
          this._cache.ouvrirSelecteurFileParLigne[aLigne + '_-1']
        ) {
          this._cache.ouvrirSelecteurFileParLigne[aLigne + '_-1']();
          return;
        }
        if (!aSurClick && !aSurToucheEdition) {
          return;
        }
        const LId = this._getIdCreation(-1, aLigne);
        ObjetHtml_1.GHtml.setDisplay(LId + '_Creation', false);
        ObjetHtml_1.GHtml.setDisplay(LId + '_Creation_Edit', true);
        this.surCreationDeb(false, { numeroLigneCreation: aLigne });
      }
      surCreationDeb(ASuivant, aParams) {
        const lParamsCreation = Object.assign(
          {
            origine: null,
            numeroLigneCreation: -1,
            idCellule: null,
            ignorerEventsNode: false,
            creationEnFenetre: false,
          },
          aParams,
        );
        if (this._getNonEditable() || !this.Donnees) {
          return;
        }
        if (this._cache.positionCreation === 0) {
          this._cache.listeValeursCreation = [];
        }
        let lInterrompreCreation = false;
        if (!this._cache.creationEnCours || ASuivant) {
          this._cache.numeroColonneCreationEnCours =
            this.ListeCreations[this._cache.positionCreation++];
          const lParams = this._getParamsCellule(
            this._cache.numeroColonneCreationEnCours,
            -1,
            { surLigneCreation: true, surEdition: true },
          );
          this._cache.creationEnCoursEvenement = this.surCreationEvenement(
            lParams.colonne,
          );
          if (
            this._cache.creationEnCoursEvenement ===
            Enumere_EvenementListe_1.EGenreEvenementListe.Creation
          ) {
            lInterrompreCreation = true;
          } else if (
            lParamsCreation.origine !== 'menucontextuel' &&
            this._cache.positionCreation === 1 &&
            this.Donnees.avecMenuContextuel(lParams)
          ) {
            this._cache.positionCreation = 0;
            this._ouvrirMenuContextuel(lParams);
            lInterrompreCreation = true;
          }
          if (lInterrompreCreation) {
            const LId = this._getIdCreation(-1, lParams.ligne);
            ObjetHtml_1.GHtml.setDisplay(LId + '_Creation_Edit', false);
            ObjetHtml_1.GHtml.setDisplay(LId + '_Creation', true);
            return;
          }
          this._surSelection(-1, -1, { avecFocus: false });
          this._cache.creationEnCours = true;
          this.IdCellule =
            lParamsCreation.idCellule ||
            this._getIdCreation(
              this._colonneCreationUniqueEnErreur()
                ? 0
                : this._cache.numeroColonneCreationEnCours,
              this._cache.numeroLigneCreationDynamique === null ||
                this._cache.numeroLigneCreationDynamique === undefined
                ? -1
                : this._cache.numeroLigneCreationDynamique,
            );
          this.entrerEdition();
          const lType = this.Donnees.getTypeValeur(lParams);
          switch (lType) {
            case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.ZoneTexte:
              this.entrerZoneTexte(
                lParams.colonne,
                undefined,
                true,
                lParamsCreation.numeroLigneCreation,
                lParamsCreation.ignorerEventsNode,
                lParamsCreation.creationEnFenetre,
              );
              break;
            default:
              this.entrerTexte(
                lParams.colonne,
                undefined,
                true,
                lType,
                lParamsCreation.ignorerEventsNode,
                lParamsCreation.creationEnFenetre,
              );
              break;
          }
          if (!this._cache.creationEnCoursEvenement) {
            ObjetHtml_1.GHtml.setFocusEdit(this.IdEdition);
            ObjetHtml_1.GHtml.setSelectionEdit(this.IdEdition);
          }
        }
      }
      _annulerCreation() {
        this.surCreationFin(-1, true);
      }
      surCreationFin(ASelectionLigne, aAnnuler) {
        if (this._cache.creationEnCours) {
          this._refreshSelf();
          this._cache.creationEnCours = false;
          this._cache.creationEnCoursEvenement = false;
          this._cache.finEditionCreation = null;
          this._cache.positionCreation = 0;
          this._cache.listeValeursCreation = [];
          this._cache.numeroColonneCreationEnCours = null;
          this._cache.numeroLigneCreationDynamique = null;
          this._setRechercheSaisie('');
          this._actualiser();
          this._surSelection(-1, ASelectionLigne, { avecFocus: false });
          this.surSelectionEvenement(-1, ASelectionLigne);
          if (aAnnuler && ASelectionLigne === -1) {
            ObjetHtml_1.GHtml.setFocus(this.IdPremierElement);
          } else {
            ObjetHtml_1.GHtml.setFocus(
              this.getIdCellule(0, ASelectionLigne, true),
            );
          }
          if (ASelectionLigne >= 0) {
            this.surApresCreationEvenement(ASelectionLigne);
          } else {
            this.surApresErreurCreationEvenement();
          }
          this._refreshSelf();
        }
      }
      _surCreation(aValeur) {
        if (this._fenetreInformationAffichee) {
          return;
        }
        if (this._messageEnCoursSurCreation) {
          return;
        }
        if (!this._cache.creationEnCours) {
          return;
        }
        delete this._valeurEnEdition;
        const lColonne = this._cache.numeroColonneCreationEnCours;
        let lLigne = -1,
          lValeur = aValeur;
        let lParams = this._getParamsCellule(lColonne, lLigne, {
          surEdition: true,
          surCreation: true,
        });
        if (
          MethodesObjet_1.MethodesObjet.isString(lValeur) &&
          this.Donnees.avecTrimSurEdition(lParams)
        ) {
          lValeur = lValeur.trim();
        }
        if (
          lValeur !== null &&
          lValeur !== undefined &&
          (lValeur !== '' ||
            this.Donnees.autoriserChaineVideSurEdition(lParams))
        ) {
          this._cache.listeValeursCreation[lColonne] = lValeur;
          if (
            this.ListeCreations[this._cache.positionCreation] === null ||
            this.ListeCreations[this._cache.positionCreation] === undefined
          ) {
            lParams = this._getParamsCellule(-1, -1, {
              surEdition: true,
              surCreation: true,
            });
            lLigne = this.Donnees._surCreation(
              this._cache.listeValeursCreation,
              this._cache.numeroLigneCreationDynamique === null ||
                this._cache.numeroLigneCreationDynamique === undefined
                ? -1
                : this._cache.numeroLigneCreationDynamique,
              lParams,
            );
            this._messageEnCoursSurCreation = true;
            try {
              this._afficherMessage(lParams);
            } finally {
              delete this._messageEnCoursSurCreation;
            }
          } else {
            this._cache.creationEnCours = false;
            this._setStyleCellule(
              this.IdCellule,
              lColonne,
              lLigne,
              false,
              true,
            );
            if (MethodesObjet_1.MethodesObjet.isString(lValeur)) {
              ObjetHtml_1.GHtml.setHtml(this.IdCellule, lValeur);
            }
            this.surCreationDeb(true);
            return;
          }
        }
        this.surCreationFin(lLigne);
      }
      _setCreationLigne(aCreationLigneBis) {
        if (
          aCreationLigneBis < 0 ||
          !MethodesObjet_1.MethodesObjet.isNumber(aCreationLigneBis)
        ) {
          return;
        }
        this._cache.numeroLigneCreationDynamique = aCreationLigneBis;
        this._actualiser();
        this._surLigneCreationUnique(
          true,
          this._cache.numeroLigneCreationDynamique,
        );
        this.surCreationDeb();
      }
      _getParamsCellule(aNumeroColonne, aNumeroLigne, aParamsSupp) {
        const lParams = {
          ligne: aNumeroLigne,
          colonne: aNumeroColonne,
          article: null,
          idColonne: null,
          declarationColonne: {},
          instance: this,
        };
        if (
          lParams.ligne >= 0 &&
          this.Donnees &&
          MethodesObjet_1.MethodesObjet.isNumber(lParams.ligne)
        ) {
          lParams.article = this.getArticleDeLigne(lParams.ligne);
        }
        if (
          lParams.colonne >= 0 &&
          this.Donnees &&
          MethodesObjet_1.MethodesObjet.isNumber(lParams.colonne)
        ) {
          lParams.idColonne = this.Donnees.getId(lParams.colonne);
          lParams.declarationColonne =
            this._cache.declColonnesByIds[lParams.idColonne];
        }
        if (aParamsSupp) {
          Object.assign(lParams, aParamsSupp);
        }
        return lParams;
      }
      _getParamsCallback(aGenre, I, J, aParamsSupp) {
        return Object.assign(
          { genreEvenement: aGenre, surClavier: false },
          this._getParamsCellule(I, J, aParamsSupp),
        );
      }
      _surEditionDebutApresConfirmation(aParams) {
        const lIdCellule = this.getIdCellule(aParams.colonne, aParams.ligne);
        if (
          this._cache.ouvrirSelecteurFileParLigne[
            aParams.ligne + '_' + aParams.colonne
          ] &&
          this.Donnees.avecSelecFile(aParams)
        ) {
          this._cache.ouvrirSelecteurFileParLigne[
            aParams.ligne + '_' + aParams.colonne
          ]();
        } else if (this.Donnees.avecEvenementEdition(aParams)) {
          this._cache.editionEnCoursEvenement = true;
          this.afficherMarqueurEditionSurCellule(
            aParams.colonne,
            aParams.ligne,
          );
          const lIdCelluleFocus = this.getIdCellule(
            aParams.colonne,
            aParams.ligne,
            true,
          );
          ObjetHtml_1.GHtml.setFocus(lIdCelluleFocus, true);
          const lthis = this;
          $('#' + lIdCelluleFocus.escapeJQ()).one('focusout', () => {
            $('#' + lIdCelluleFocus.escapeJQ()).one('focusin', () => {
              if (lthis._cache.editionEnCoursEvenement) {
                lthis._cache.editionEnCoursEvenement = false;
                lthis._nettoyerElementsEditionEnCours();
              }
            });
          });
          const lParamsCallback = this._getParamsCallback(
            Enumere_EvenementListe_1.EGenreEvenementListe.Edition,
            aParams.colonne,
            aParams.ligne,
          );
          lParamsCallback.actualisationApresEdition = (
            aIgnorerActualisation,
          ) => {
            if (this.isDestroyed()) {
              return;
            }
            this._finaliserEdition({
              ligne: aParams.ligne,
              colonne: aParams.colonne,
              ignorerActualisation: aIgnorerActualisation,
            });
          };
          lParamsCallback.ouvrirMenuContextuel = (aParamsPerso) => {
            this._ouvrirMenuContextuel(
              Object.assign(
                { id: this.getIdCellule(aParams.colonne, aParams.ligne) },
                aParams,
                aParamsPerso,
              ),
            );
          };
          this.callback.appel(
            lParamsCallback,
            Enumere_EvenementListe_1.EGenreEvenementListe.Edition,
            aParams.colonne,
            aParams.ligne,
          );
          this._refreshSelf();
        } else {
          this._cache.editionEnCours = true;
          for (
            let iLigne = 0;
            iLigne < this._cache.lignesSelectionnees.length;
            iLigne++
          ) {
            if (
              iLigne !== aParams.ligne &&
              this._cache.lignesSelectionnees[iLigne]
            ) {
              this.selectionnerLigne({
                ligne: iLigne,
                selectionner: false,
                avecEvenementModificationSelection: false,
              });
            }
          }
          this.IdCellule = lIdCellule;
          this.entrerEdition();
          this.afficherMarqueurEditionSurCellule(
            aParams.colonne,
            aParams.ligne,
          );
          const lTypeValeur = this.Donnees.getTypeValeur(aParams);
          switch (lTypeValeur) {
            case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.ZoneTexte:
              this.entrerZoneTexte(aParams.colonne, aParams.ligne, false);
              break;
            case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Image:
            case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Icon:
            case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche:
              this._surEdition(aParams, 'coche', true);
              break;
            case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule
              .DateCalendrier:
              this._entrerDateCalendrier(aParams);
              break;
            default:
              this.entrerTexte(
                aParams.colonne,
                aParams.ligne,
                false,
                lTypeValeur,
              );
              break;
          }
          if (
            ![
              ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche,
              ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Image,
              ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Icon,
              ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.DateCalendrier,
            ].includes(lTypeValeur)
          ) {
            const lElement = ObjetHtml_1.GHtml.getElement(this.IdEdition);
            if (lElement) {
              ObjetHtml_1.GHtml.setFocus(lElement);
              if (lElement.select) {
                lElement.select();
              }
            }
            if (
              this.optionsInterne.versionMobile &&
              lTypeValeur ===
                ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Note
            ) {
              if (lElement && lElement.click) {
                lElement.click();
              } else {
                this._finaliserEdition({
                  ligne: aParams.ligne,
                  colonne: aParams.colonne,
                });
              }
            }
          }
        }
      }
      surEditionDeb(aColonne, aLigne) {
        if (this._getNonEditable()) {
          return;
        }
        this._cache.selectionCellule.ligne = aLigne;
        this._cache.selectionCellule.colonne = aColonne;
        let lParams = this._getParamsCellule(aColonne, aLigne, {
          surEdition: true,
        });
        let lNumeroColonne = this.Donnees.getColonneTransfertEdition(lParams);
        if (
          lNumeroColonne &&
          MethodesObjet_1.MethodesObjet.isString(lNumeroColonne)
        ) {
          lNumeroColonne = this.getNumeroColonneDIdColonne(lNumeroColonne);
        }
        if (
          MethodesObjet_1.MethodesObjet.isNumber(lNumeroColonne) &&
          lNumeroColonne >= 0
        ) {
          lParams = this._getParamsCellule(lNumeroColonne, aLigne, {
            surEdition: true,
          });
        }
        if (
          lParams.article &&
          !this._cache.editionEnCours &&
          (this.Donnees.avecEdition(lParams) ||
            this.Donnees.avecEvenementEdition(lParams) ||
            this.Donnees.avecSelecFile(lParams))
        ) {
          this._nettoyerElementsEditionEnCours();
          if (this.Donnees.editionRefusee(lParams)) {
            return;
          }
          if (this.Donnees._editionConfirmation(lParams)) {
            GApplication.getMessage().afficher({
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
              message: this.Donnees.getMessage(),
              callback: (AAccepte) => {
                if (AAccepte === Enumere_Action_1.EGenreAction.Valider) {
                  this._surEditionDebutApresConfirmation(lParams);
                }
              },
            });
          } else {
            this._surEditionDebutApresConfirmation(lParams);
          }
        }
      }
      _surEdition(aParams, aValeur, aAvecModification, aForcerEvenement) {
        if (this._fenetreInformationAffichee) {
          return;
        }
        if (this._cache.editionEnCours || this._cache.editionEnCoursEvenement) {
          delete this._valeurEnEdition;
          delete this._cache.avecModificationSaisie;
          if (!aAvecModification) {
            this._surEditionFin({
              ligne: aParams.ligne,
              colonne: aParams.colonne,
              avecEvenement: aForcerEvenement,
              sansTriDonnees: aParams.sansTriDonnees,
            });
            return;
          }
          let lValeur = aValeur;
          if (
            MethodesObjet_1.MethodesObjet.isString(lValeur) &&
            this.Donnees.avecTrimSurEdition(aParams)
          ) {
            lValeur = lValeur.trim();
          }
          const lParamsFinEdition = {
            ligne: aParams.ligne,
            colonne: aParams.colonne,
            avecEvenement: true,
            avecModification: true,
            sansTriDonnees: aParams.sansTriDonnees,
          };
          if (
            ((lValeur !== null && lValeur !== undefined) ||
              this.Donnees.getTypeValeur(aParams) ===
                ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule
                  .DateCalendrier) &&
            (lValeur !== '' ||
              this.Donnees.autoriserChaineVideSurEdition(aParams))
          ) {
            aParams.valeur = lValeur;
            const lFuncAfficherMessage = (aParams) => {
              if (!this._messageEnCoursDAffichage) {
                this._messageEnCoursDAffichage = true;
                this._afficherMessage(aParams);
                delete this._messageEnCoursDAffichage;
              }
            };
            let lResult;
            const lFinEditionCreation = this._cache.finEditionCreation;
            this._cache.finEditionCreation = null;
            try {
              lResult = this.Donnees._surEdition(aParams);
            } finally {
              this._cache.finEditionCreation = lFinEditionCreation;
            }
            if (lResult && lResult.then) {
              return lResult.then((aError) => {
                lFuncAfficherMessage(aParams);
                this._surEditionFin(lParamsFinEdition);
                if (
                  aError &&
                  aError.annulerEdition &&
                  aError.enEditionSurCelllule
                ) {
                  this.demarrerEditionSurCellule(
                    aParams.ligne,
                    aParams.colonne,
                  );
                }
                return aError;
              });
            }
            lFuncAfficherMessage(aParams);
          }
          this._surEditionFin(lParamsFinEdition);
        }
      }
      _finaliserEdition(aParametres) {
        const lParametres = Object.assign(
          {
            ligne: -1,
            colonne: -1,
            avecEvenement: false,
            avecModification: false,
            ignorerActualisation: false,
            sansTriDonnees: false,
          },
          aParametres,
        );
        this._cache.editionEnCours = false;
        this._cache.editionEnCoursEvenement = false;
        this._cache.finEditionCreation = null;
        if (this._cache.timeout_ignorerScrollSortieEdition) {
          clearTimeout(this._cache.timeout_ignorerScrollSortieEdition);
          delete this._cache.timeout_ignorerScrollSortieEdition;
        }
        this._nettoyerElementsEditionEnCours();
        if (lParametres.ignorerActualisation !== true) {
          let lEstColonneTriCourant = false;
          if (this._triCourant.colonne) {
            this._triCourant.colonne.forEach((aNumeroColonne) => {
              if (lParametres.colonne === aNumeroColonne) {
                lEstColonneTriCourant = true;
              }
            });
          }
          const lElementCellule = ObjetHtml_1.GHtml.getElement(
            this.getIdCellule(lParametres.colonne, lParametres.ligne),
          );
          const lFuncConstructCellule =
            this._cache.collectionFuncConstructCellule[
              lParametres.ligne + '_' + lParametres.colonne
            ];
          if (
            lEstColonneTriCourant ||
            !lFuncConstructCellule ||
            !lElementCellule ||
            this.Donnees.forcerActualisationListeSurEdition(lParametres)
          ) {
            this._actualiser({
              conserverSelection: false,
              zonesActualisation: { contenu: true, total: true },
              avecEvenementModificationSelection: false,
              conserverPositionElement: lElementCellule
                ? {
                    rectCellule:
                      ObjetPosition_1.GPosition.getClientRect(lElementCellule),
                    ligne: lParametres.ligne,
                    colonne: lParametres.colonne,
                  }
                : null,
              sansTriDonnees: lParametres.sansTriDonnees,
            });
          } else {
            ObjetHtml_1.GHtml.setHtml(
              lElementCellule,
              lFuncConstructCellule(),
              { controleur: this.controleur },
            );
            this._selectionner({ deselectionnerTout: true });
          }
          this._surSelection(lParametres.colonne, lParametres.ligne, {
            avecFocus: false,
          });
          if (lParametres.ligne >= 0 && lParametres.colonne >= 0) {
            const lElement = ObjetHtml_1.GHtml.getElement(
              this.getIdCellule(lParametres.colonne, lParametres.ligne, true),
            );
            if (ObjetHtml_1.GHtml.elementExiste(lElement) && lElement.focus) {
              try {
                lElement.focus({ preventScroll: true });
              } catch (e) {}
            }
          } else {
            ObjetHtml_1.GHtml.setFocus(this.IdPremierElement, true);
          }
        }
        this._refreshSelf();
        if (lParametres.colonne >= 0 && lParametres.avecEvenement) {
          this.surApresEditionEvenement(
            this._getParamsCellule(lParametres.colonne, lParametres.ligne, {
              avecModification: !!lParametres.avecModification,
            }),
          );
        }
      }
      _surEditionFin(aParams) {
        this._finaliserEdition(
          Object.assign(aParams, {
            ignorerActualisation:
              !this._cache.editionEnCours &&
              !this._cache.editionEnCoursEvenement,
          }),
        );
      }
      _surSuppression() {
        const lListeSelections = this._getListeElementsSelection();
        if (
          this._options.AvecSuppression &&
          !this._getNonEditable() &&
          (this._cache.selectionCellule.ligne > -1 ||
            (lListeSelections && lListeSelections.count() > 0))
        ) {
          const lParamsCellule = this._getParamsCellule(
            this._cache.selectionCellule.colonne,
            this._cache.selectionCellule.ligne,
            { surSuppression: true },
          );
          if (
            this.Donnees._suppressionImpossible(
              this._cache.selectionCellule.ligne,
              lListeSelections,
            )
          ) {
            this._afficherMessage(lParamsCellule);
          } else if (
            this.Donnees._suppressionConfirmation(
              this._cache.selectionCellule.ligne,
              lListeSelections,
            )
          ) {
            GApplication.getMessage()
              .afficher({
                type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
                message: this.Donnees.getMessage(),
              })
              .then((aGenreAction) => {
                this.surSuppressionApresConfirmation(
                  lListeSelections,
                  lParamsCellule,
                  aGenreAction,
                );
              });
          } else {
            this.surSuppressionApresConfirmation(
              lListeSelections,
              lParamsCellule,
              Enumere_Action_1.EGenreAction.Valider,
            );
          }
        }
      }
      surSuppressionApresConfirmation(
        aListeSelections,
        aParamsCellule,
        AAccepte,
      ) {
        if (AAccepte === Enumere_Action_1.EGenreAction.Valider) {
          Object.assign(aParamsCellule, {
            listeSelections: aListeSelections,
            listeSuppressions: new ObjetListeElements_1.ObjetListeElements(),
          });
          if (aListeSelections) {
            aParamsCellule.listeSuppressions =
              this.Donnees.getListeSupprimables(
                aListeSelections,
                aParamsCellule,
              );
          }
          const lAvecEvenement = this.surSuppressionEvenement(aParamsCellule);
          if (lAvecEvenement && this.Donnees.avecInterruptionSuppression()) {
            this._cache.selectionCellule.ligne = -1;
          } else {
            this._cache.selectionCellule.ligne = this.Donnees._surSuppression(
              aParamsCellule.ligne,
              aParamsCellule.listeSuppressions,
            );
            this._actualiser();
            if (this.Donnees.avecEtatSaisie(aParamsCellule)) {
              this.setEtatSaisie(true);
            }
          }
          this.surApresSuppressionEvenement(aParamsCellule);
        }
        ObjetHtml_1.GHtml.setFocus(this.IdPremierElement, true, 0);
      }
      _getIdCreation(I, J) {
        return (
          this.Nom +
          '_Creation_' +
          I +
          (J === null || J === undefined ? '' : '_' + J)
        );
      }
      _getListeElementsSelection() {
        const lSelections = new ObjetListeElements_1.ObjetListeElements();
        if (this._cache.lignesSelectionnees) {
          for (let i = 0; i < this._cache.lignesSelectionnees.length; i++) {
            if (this._cache.lignesSelectionnees[i]) {
              const lElement = this.getArticleDeLigne(i);
              if (lElement) {
                lSelections.addElement(lElement);
              }
            }
          }
        }
        return lSelections;
      }
      _getCellulesSelection(aAvecLignesInvisible) {
        const lSelections = [];
        if (this._cache.lignesSelectionnees && this.Donnees) {
          this._cache.lignesSelectionnees.forEach((aSelectionLigne, aLigne) => {
            if (
              !aAvecLignesInvisible &&
              !this._estLigneVisible(aLigne, { contexteSelection: true })
            ) {
              return;
            }
            let lLigne = null,
              lAvecSelectionParCelluleSurLigne = false;
            if (aSelectionLigne && aSelectionLigne.forEach) {
              aSelectionLigne.forEach((aSelectionne, aColonne) => {
                if (aSelectionne && this._estColonneVisible(aColonne)) {
                  const lParamsCellule = this._getParamsCellule(
                    aColonne,
                    aLigne,
                  );
                  if (this.Donnees._avecSelection(lParamsCellule)) {
                    if (!lLigne) {
                      lLigne = {
                        ligne: aLigne,
                        article: this.getArticleDeLigne(aLigne),
                        hashColonnesSelecParCellule: {},
                        colonnes: [],
                        idsColonnes: [],
                      };
                    }
                    lLigne.hashColonnesSelecParCellule[aColonne] = true;
                    lLigne.colonnes.push(aColonne);
                    lLigne.idsColonnes.push(
                      this.getIdColonneDeNumeroColonne(aColonne),
                    );
                    if (
                      !lAvecSelectionParCelluleSurLigne &&
                      this._estSelectionParCellule(aLigne, aColonne)
                    ) {
                      lAvecSelectionParCelluleSurLigne = true;
                    }
                  }
                }
              });
            } else if (aSelectionLigne) {
            }
            if (lLigne) {
              if (!lAvecSelectionParCelluleSurLigne) {
                delete lLigne.hashColonnesSelecParCellule;
              }
              lSelections.push(lLigne);
            }
          });
        }
        return lSelections;
      }
      _setCellulesSelection(aListe, aParams) {
        let iColonne, lElement, lElementTrouve, lHashColonnesSelectionnees;
        const lParams = Object.assign(
          {
            instancesIdentiques: false,
            avecScroll: false,
            avecEvenement: false,
            avecEvenementModificationSelection: true,
            ajoutSelection: false,
            funcRecherche: null,
            avecSelectionSurLigneInvisible: false,
          },
          aParams,
        );
        const lFuncRecherche =
          lParams.funcRecherche &&
          MethodesObjet_1.MethodesObjet.isFunction(lParams.funcRecherche)
            ? lParams.funcRecherche
            : null;
        const _gererSelection = (
          aParams,
          aElementTrouve,
          aNumeroLigne,
          aNumeroColonne,
          aEtatSelec,
        ) => {
          if (!aElementTrouve && aEtatSelec) {
            if (!aParams.ajoutSelection) {
              this._selectionner({
                ligne: aNumeroLigne,
                colonne: aNumeroColonne,
                selectionner: false,
                avecEvenement: aParams.avecEvenement,
                _avecVisuCadreSelection: false,
              });
            }
          } else if (aElementTrouve) {
            const lEstSelection = aEtatSelec;
            if (!lEstSelection) {
              this._selectionner({
                ligne: aNumeroLigne,
                colonne: aNumeroColonne,
                selectionner: true,
                avecScroll: aParams.avecScroll,
                deselectionnerTout:
                  aParams.ignorerControleMultiSelection === true ? null : false,
                avecEvenement: aParams.avecEvenement && !lEstSelection,
                _avecVisuCadreSelection: false,
              });
            }
          }
        };
        function _trouveIdentique(aElement) {
          if (aElement && aElement.article && aElement.article === lElement) {
            lElementTrouve = true;
            lHashColonnesSelectionnees = aElement.hashColonnesSelecParCellule;
            return false;
          }
          return true;
        }
        function _trouveNumeroGenre(aElement) {
          if (
            aElement &&
            aElement.article &&
            aElement.article.egalParNumeroEtGenre(
              lElement.getNumero(),
              lElement.getGenre(),
            )
          ) {
            lElementTrouve = aElement;
            lHashColonnesSelectionnees = aElement.hashColonnesSelecParCellule;
            return false;
          }
          return true;
        }
        function _trouverAvecRecherche(aElement) {
          if (lFuncRecherche(lElement, aElement.article) === true) {
            lElementTrouve = true;
            lHashColonnesSelectionnees = aElement.hashColonnesSelecParCellule;
            return false;
          }
          return true;
        }
        if (!aListe || !Array.isArray(aListe)) {
          aListe = [];
        }
        const lSelectionsPrecedente = lParams.avecEvenementModificationSelection
          ? this._getCellulesSelection(true)
          : null;
        const lFuncs = [];
        for (
          let lNumeroLigne = this.Donnees.getNbrLignes() - 1;
          lNumeroLigne >= 0;
          lNumeroLigne--
        ) {
          lElement = this.getArticleDeLigne(lNumeroLigne);
          lElementTrouve = false;
          lHashColonnesSelectionnees = null;
          if (
            lElement &&
            aListe.length > 0 &&
            (lParams.avecSelectionSurLigneInvisible ||
              this._estLigneVisible(lNumeroLigne, { contexteSelection: true }))
          ) {
            if (lFuncRecherche) {
              aListe.every(_trouverAvecRecherche);
            } else if (lParams.instancesIdentiques) {
              aListe.every(_trouveIdentique);
            } else {
              aListe.every(_trouveNumeroGenre);
            }
          }
          let lEtatSelec;
          const lColonnes = [];
          if (lHashColonnesSelectionnees) {
            lEtatSelec = [];
            for (
              iColonne = 0;
              iColonne < this.ListeTailles.length;
              iColonne++
            ) {
              if (this._estColonneVisible(iColonne)) {
                lColonnes.push(iColonne);
                lEtatSelec.push(
                  this._etatSelectionCellule({
                    ligne: lNumeroLigne,
                    colonne: iColonne,
                  }),
                );
              }
            }
          } else {
            lEtatSelec = this._etatSelectionCellule({
              ligne: lNumeroLigne,
              colonne: -1,
            });
          }
          lFuncs.push({
            hashColonnesSelectionnees: lHashColonnesSelectionnees,
            elementTrouve: lElementTrouve,
            numeroLigne: lNumeroLigne,
            colonnes: lColonnes,
            etatSelec: lEtatSelec,
          });
        }
        lFuncs.forEach((aParam) => {
          if (aParam.hashColonnesSelectionnees) {
            aParam.colonnes.forEach((aColonne) => {
              _gererSelection(
                lParams,
                aParam.elementTrouve &&
                  aParam.hashColonnesSelectionnees[aColonne],
                aParam.numeroLigne,
                aColonne,
                aParam.etatSelec[aColonne],
              );
            });
          } else {
            _gererSelection(
              lParams,
              aParam.elementTrouve,
              aParam.numeroLigne,
              -1,
              aParam.etatSelec,
            );
          }
        });
        this._actualiserCadreSelection();
        if (lParams.avecEvenementModificationSelection) {
          this._surModificationSelectionEvenement(lSelectionsPrecedente);
        }
        return this;
      }
      _setTableauCellulesSelection(aListe, aParams) {
        let lIndexTrouve = -1;
        if (!aListe || !Array.isArray(aListe)) {
          aListe = [];
        }
        this._cache.lignesSelectionnees_prec = [
          ...this._cache.lignesSelectionnees,
        ];
        function _trouveIdentique(aCherche, aElement, aIndex) {
          if (
            aElement &&
            aCherche &&
            aElement.article &&
            aElement.article === aCherche
          ) {
            lIndexTrouve = aIndex;
            return false;
          }
          return true;
        }
        const lListe = [];
        if (aListe && Array.isArray(aListe)) {
          aListe.forEach((aElement) => {
            let lLigne = null;
            if (!aElement.article) {
              return;
            }
            lIndexTrouve = -1;
            if (
              !lListe.every(_trouveIdentique.bind(this, aElement.article)) &&
              lIndexTrouve >= 0
            ) {
              lLigne = lListe[lIndexTrouve];
            }
            if (!lLigne) {
              lLigne = { article: aElement.article };
            }
            let lNumeroColonne = -1;
            if (aElement.idColonne) {
              lNumeroColonne = this.getNumeroColonneDIdColonne(
                aElement.idColonne,
              );
            }
            if (lNumeroColonne < 0 && aElement.colonne >= 0) {
              lNumeroColonne = aElement.colonne;
            }
            if (lNumeroColonne >= 0) {
              if (!lLigne.hashColonnesSelecParCellule) {
                lLigne.hashColonnesSelecParCellule = {};
              }
              lLigne.hashColonnesSelecParCellule[lNumeroColonne] = true;
            }
            lListe.push(lLigne);
          });
        }
        return this._setCellulesSelection(lListe, aParams);
      }
      _setListeElementsSelection(aListeElements, aParams) {
        this._cache.lignesSelectionnees_prec = [
          ...this._cache.lignesSelectionnees,
        ];
        if (!aListeElements || !aListeElements.getElementParElement) {
          aListeElements = new ObjetListeElements_1.ObjetListeElements();
        }
        const lListe = [];
        aListeElements.parcourir((D) => {
          lListe.push({ article: D });
        });
        return this._setCellulesSelection(lListe, aParams);
      }
      _navigationCelluleSuivante(aParametres) {
        if (!this.Donnees) {
          return false;
        }
        if (this._cache.finEditionCreation) {
          const lResultFinEdition = this._cache.finEditionCreation();
          if (
            lResultFinEdition &&
            typeof lResultFinEdition === 'object' &&
            'avecMessagerErreur' in lResultFinEdition &&
            lResultFinEdition.avecMessagerErreur
          ) {
            return;
          }
        }
        const lParametres = Object.assign(
          {
            ligne: this._cache.selectionCellule.ligne,
            colonne: this._cache.selectionCellule.colonne,
            orientationVerticale: false,
            sensInverse: false,
            ligneEtColonneFixe: false,
            avecSelection: false,
            avecCelluleEditable: false,
            avecFocusCellule: true,
            forcerNavigationFocus: false,
            sansRecherche: false,
          },
          aParametres,
        );
        let lLigne = lParametres.ligne,
          lColonne = lParametres.colonne,
          lElement = null;
        let lAvecSelectionOuEdition = false;
        const lNbLignes = this.Donnees.Donnees.count(),
          lNbColonnes = this.ListeTailles.length;
        let lParamsCellule;
        if (lLigne < 0 || lColonne < 0) {
          if (lParametres.orientationVerticale) {
            lLigne = Math.max(lLigne, -1);
            lColonne = Math.max(lColonne, 0);
          } else {
            lLigne = Math.max(lLigne, 0);
            lColonne = Math.max(lColonne, -1);
          }
          lParametres.sensInverse = false;
        }
        while (!lElement) {
          if (!lParametres.sansRecherche) {
            if (lParametres.orientationVerticale) {
              lLigne += lParametres.sensInverse ? -1 : 1;
              if (lParametres.ligneEtColonneFixe) {
              } else if (lLigne >= lNbLignes || lLigne < 0) {
                lLigne = lParametres.sensInverse ? lNbLignes - 1 : 0;
                lColonne += lParametres.sensInverse ? -1 : 1;
              }
            } else {
              lColonne += lParametres.sensInverse ? -1 : 1;
              if (lParametres.ligneEtColonneFixe) {
              } else if (lColonne >= lNbColonnes || lColonne < 0) {
                lColonne = lParametres.sensInverse ? lNbColonnes - 1 : 0;
                lLigne += lParametres.sensInverse ? -1 : 1;
              }
            }
          }
          if (
            lLigne >= lNbLignes ||
            lColonne >= lNbColonnes ||
            lLigne < 0 ||
            lColonne < 0 ||
            isNaN(lLigne) ||
            isNaN(lColonne)
          ) {
            break;
          }
          lParamsCellule = this._getParamsCellule(lColonne, lLigne);
          if (
            this._estColonneVisible(lColonne) &&
            this._estLigneVisible(lLigne)
          ) {
            lAvecSelectionOuEdition =
              (lParametres.avecCelluleEditable ||
                !lParametres.avecSelection ||
                this.Donnees._avecSelection(lParamsCellule)) &&
              (!lParametres.avecCelluleEditable ||
                (!this._getNonEditable() &&
                  (this.Donnees.avecEdition(lParamsCellule) ||
                    this.Donnees.avecEvenementEdition(lParamsCellule))));
            if (lParametres.forcerNavigationFocus || lAvecSelectionOuEdition) {
              const lIdCellule = this.getIdCellule(lColonne, lLigne, true);
              lElement = ObjetHtml_1.GHtml.getElement(lIdCellule);
              if (!lElement && this._estLigneDansRangeNonConstruitDyn(lLigne)) {
                this._scrollSurLigne({ ligne: lLigne, colonne: lColonne });
                lElement = ObjetHtml_1.GHtml.getElement(lIdCellule);
              }
            }
          }
          if (lParametres.sansRecherche) {
            break;
          }
        }
        if (lElement) {
          if (lParametres.avecSelection && lAvecSelectionOuEdition) {
            const lAvecFocusCellule =
              lParametres.avecFocusCellule &&
              [
                ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.ZoneTexte,
              ].indexOf(this.Donnees.getTypeValeur(lParamsCellule)) < 0;
            this.selectionnerCellule({
              ligne: lLigne,
              colonne: lColonne,
              deselectionnerTout: true,
              avecFocusCellule: lAvecFocusCellule,
              avecEvenement: true,
            });
          } else {
            ObjetHtml_1.GHtml.setFocus(lElement);
          }
          this._cache.selectionCellule = { ligne: lLigne, colonne: lColonne };
          return true;
        }
        return false;
      }
      _selectionnerCelluleSuivante(aParametres) {
        const lParametres = Object.assign(
          {
            ligne: this._cache.selectionCellule.ligne,
            colonne: this._cache.selectionCellule.colonne,
            orientationVerticale: false,
            sensInverse: false,
            avecSelection: true,
            avecCelluleEditable: false,
            entrerEdition: false,
          },
          aParametres,
        );
        if (lParametres.ligne < 0 || lParametres.colonne < 0 || !this.Donnees) {
          return this;
        }
        if (lParametres.entrerEdition) {
          lParametres.avecCelluleEditable = true;
        }
        if (
          this._navigationCelluleSuivante(lParametres) &&
          lParametres.entrerEdition &&
          (lParametres.entrerEdition === true ||
            (MethodesObjet_1.MethodesObjet.isFunction(
              lParametres.entrerEdition,
            ) &&
              lParametres.entrerEdition(
                this._getParamsCellule(
                  this._cache.selectionCellule.colonne,
                  this._cache.selectionCellule.ligne,
                ),
              )))
        ) {
          this.demarrerEditionSurCellule(
            this._cache.selectionCellule.ligne,
            this._cache.selectionCellule.colonne,
          );
        }
        return this;
      }
      estColonneVisibleDIdColonne(aIdColonne) {
        return this._estColonneVisible(
          this.getNumeroColonneDIdColonne(aIdColonne),
          this._cache,
        );
      }
      _estColonneVisible(aNumeroColonne, aCache) {
        return (
          aNumeroColonne >= 0 &&
          this.ListeTailles &&
          aNumeroColonne < this.ListeTailles.length &&
          (aCache || this._cache).tableauColonnesCachees[aNumeroColonne] !==
            true
        );
      }
      _calculColonnesCachees(aCache) {
        let lColonnesCachees = [],
          lTabColonnes = this._options.colonnesCachees;
        if (
          this.Donnees &&
          this.Donnees.enImpression &&
          this._options.colonnesCacheesImpression
        ) {
          lTabColonnes = this._options.colonnesCacheesImpression;
        }
        if (
          !MethodesObjet_1.MethodesObjet.isArray(lTabColonnes) &&
          isFinite(lTabColonnes)
        ) {
          lColonnesCachees.push(lTabColonnes);
        } else if (MethodesObjet_1.MethodesObjet.isArray(lTabColonnes)) {
          lColonnesCachees = lColonnesCachees.concat(lTabColonnes);
        }
        lColonnesCachees.sort();
        aCache.nbColonnesCachees = 0;
        aCache.tableauColonnesCachees = [];
        aCache.tableauColonnesCacheesOriginal = [];
        if (this.ListeTailles && this.ListeTailles.forEach) {
          this.ListeTailles.forEach((aTaille, aIndex) => {
            let lIdCol;
            let lNonTrouve = lColonnesCachees.indexOf(aIndex) === -1;
            if (lNonTrouve && this._cache.colonnes.listeIds) {
              lIdCol = this._cache.colonnes.listeIds[aIndex];
              if (lIdCol) {
                lNonTrouve = lColonnesCachees.indexOf(lIdCol) === -1;
              }
            }
            let lIndexOriginal = aIndex;
            if (aCache.listeCorrespondancesColonnes && lIdCol) {
              lIndexOriginal =
                aCache.listeCorrespondancesColonnes.indexOf(aIndex);
            }
            if (lNonTrouve) {
              aCache.tableauColonnesCachees[aIndex] = false;
              aCache.tableauColonnesCacheesOriginal[lIndexOriginal] = false;
            } else {
              aCache.tableauColonnesCachees[aIndex] = true;
              aCache.tableauColonnesCacheesOriginal[lIndexOriginal] = true;
              aCache.nbColonnesCachees++;
            }
          });
        }
      }
      _colonneCreationUniqueEnErreur() {
        return (
          this.ListeCreations.length === 1 &&
          (this.ListeCreations[0] < 0 ||
            this.ListeCreations[0] >= this.ListeTailles.length)
        );
      }
      _deploiementSurCellule(aParams) {
        const lTypeValeur = this.Donnees.getTypeValeur(aParams);
        return (
          this.Donnees.avecDeploiement() &&
          this.Donnees.avecDeploiementSurColonne(aParams) &&
          this.Donnees.estUnDeploiement(aParams) &&
          lTypeValeur !==
            ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche
        );
      }
      surDeploiement(aEvent, aColonne, aLigne, aDeploiementSurImage) {
        if (this._cache.creationEnCours || this._cache.editionEnCours) {
          return;
        }
        if (this._avecDeploiementDesactive()) {
          return;
        }
        if (aEvent.type !== 'keyup' && aEvent.which === 2) {
          return;
        }
        const lParams = this._getParamsCellule(aColonne, aLigne, {
          surDeploiement: true,
        });
        if (
          !aDeploiementSurImage &&
          !this.Donnees.avecEventDeploiementSurCellule(lParams)
        ) {
          return;
        }
        if (this._deploiementSurCellule(lParams)) {
          this.Donnees.surDeploiement(aColonne, aLigne, lParams.article);
          this._actualiser({
            sansTriDonnees: true,
            conserverSelection: true,
            conserverFocusSelection: true,
            ignorerFocusListe: false,
          });
          if (this.Donnees.avecEvenementDeploiement(lParams)) {
            this.callback.appel(
              this._getParamsCallback(
                Enumere_EvenementListe_1.EGenreEvenementListe.Deploiement,
                aColonne,
                aLigne,
              ),
              Enumere_EvenementListe_1.EGenreEvenementListe.Deploiement,
              aColonne,
              aLigne,
            );
            this._refreshSelf();
          }
          return true;
        }
      }
      _avecSuppressionSelectionCourante(aNumeroLigne, aNumeroColonne) {
        const lListe = this._getListeElementsSelection(),
          lParams = this._getParamsCellule(aNumeroColonne, aNumeroLigne, {
            listeSelection: lListe,
            surSuppression: true,
          });
        return (
          this._options.AvecSuppression &&
          !this._getNonEditable() &&
          !this._cache.editionEnCours &&
          lListe.count() > 0 &&
          this.Donnees._avecSuppression(lParams)
        );
      }
      _surClickCelluleTotal(event) {
        const lInstance = event.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        if (!lInfos) {
          return;
        }
        const lListeLignesTotal = lInstance.Donnees
          ? lInstance.Donnees.getListeLignesTotal()
          : null;
        const lParams = lInstance._getParamsCellule(lInfos.colonne, -1, {
          surTotal: true,
        });
        lParams.ligne = lInfos.ligne;
        if (!!lListeLignesTotal) {
          lParams.article = lListeLignesTotal.get(lInfos.ligne);
        }
        if (
          lInstance.Donnees &&
          lInstance.Donnees.avecEvenementSelectionClickTotal(lParams)
        ) {
          if (lInstance.Pere && lInstance.Evenement) {
            const lParamsCallback = lInstance._getParamsCallback(
              Enumere_EvenementListe_1.EGenreEvenementListe.SelectionClickTotal,
              lParams.colonne,
              lParams.ligne,
            );
            lInstance.callback.appel(
              lParamsCallback,
              Enumere_EvenementListe_1.EGenreEvenementListe.SelectionClickTotal,
              lParams.colonne,
              lParams.ligne,
            );
          }
        }
      }
      _rechercheDeplacementPrecedenteSuivant(aParamsCelluleSource, aSuivant) {
        let lInc = aSuivant ? 1 : -1;
        const lIndiceLigne = this._cache.lignesVisibles.indexOf(
          aParamsCelluleSource.ligne,
        );
        if (lIndiceLigne < 0) {
          return null;
        }
        let lParamsCelluleDest = this._getParamsCellule(
          -1,
          this._cache.lignesVisibles[lIndiceLigne + lInc],
        );
        while (lParamsCelluleDest && lParamsCelluleDest.article) {
          if (
            this.Donnees.autoriserDeplacementElementSurLigne(
              lParamsCelluleDest,
              aParamsCelluleSource,
            )
          ) {
            return lParamsCelluleDest;
          }
          lInc += aSuivant ? 1 : -1;
          lParamsCelluleDest = this._getParamsCellule(
            -1,
            this._cache.lignesVisibles[lIndiceLigne + lInc],
          );
        }
        return null;
      }
      _surDeplacementLigneSurAutreLigne(aParamsDroppable, aParamsDraggable) {
        if (
          aParamsDraggable &&
          this.Donnees.surDeplacementElementSurLigne(
            aParamsDroppable,
            aParamsDraggable,
          ) !== false
        ) {
          this._actualiser({
            conserverSelection: false,
            zonesActualisation: { contenu: true },
            avecEvenementModificationSelection: false,
          });
          this.selectionnerLigne({
            ligne: aParamsDroppable.ligne,
            avecScroll: true,
            avecEvenement: true,
          });
        }
      }
      _existeDeploiementDansListe() {
        if (!this.Donnees || !this.Donnees.Donnees) {
          return false;
        }
        let lAvecDeploiement = false;
        this.Donnees.Donnees.parcourir((aElement, aLigne) => {
          const lParams = this._getParamsCellule(-1, aLigne);
          if (
            this.Donnees.estUnDeploiement(lParams) &&
            this._estLigneVisible(aLigne) &&
            this.Donnees.estUnDeploiementValide(lParams)
          ) {
            lAvecDeploiement = true;
            return false;
          }
        });
        return lAvecDeploiement;
      }
      _getBoutonDeploye() {
        if (
          !this.Donnees ||
          !this.Donnees.avecDeploiement() ||
          !this.Donnees.Donnees
        ) {
          return false;
        }
        let lEstDeploye = false;
        this.Donnees.Donnees.parcourir((aElement, aLigne) => {
          const lParams = this._getParamsCellule(-1, aLigne);
          if (
            this.Donnees.estUnDeploiement(lParams) &&
            this.Donnees._estDeploye(aLigne) &&
            this._estLigneVisible(aLigne) &&
            this.Donnees.estUnDeploiementValide(lParams)
          ) {
            lEstDeploye = true;
            return false;
          }
        });
        return lEstDeploye;
      }
      avecBoutonCreationDansEntete() {
        return (
          this._options.avecCreationEnBoutonDesignClassique ||
          this._options.skin === ObjetListe.skin.flatDesign
        );
      }
      _construireBoutonsEntete(aCssWidth) {
        const lAvecBoutonsListeEntete =
          this._getTabBoutonsEnteteOuPiedFD(true).length > 0;
        const lAvecCBToutCocher = this._options.avecCBToutCocher;
        const lAvecBtnCreation =
          this.avecBoutonCreationDansEntete() &&
          (!this._options.estBoutonCreationPiedFlottant_mobile ||
            !this.optionsInterne.versionMobile) &&
          this._avecLigneCreationTitre();
        const lHtmlLigneTotale = this._construireTotalFD(true);
        const H = [];
        if (
          lAvecBoutonsListeEntete ||
          this._options.avecCBToutCocher ||
          lAvecBtnCreation
        ) {
          const _construireBouton = (aBouton, aIndex) => {
            return IE.jsx.str('ie-btnicon', {
              'ie-model': (0, jsx_1.jsxFuncAttr)('liste.boutonListe', aIndex),
              'ie-if': (0, jsx_1.jsxFuncAttr)(
                'liste.boutonListe.getVisible',
                aIndex,
              ),
              'ie-class': aBouton.getClass
                ? (0, jsx_1.jsxFuncAttr)('liste.boutonListe.getClass', aIndex)
                : false,
              title: aBouton.title ? aBouton.title : '',
              id: aBouton.id,
              class: [
                aBouton.class,
                aBouton.genre === ObjetListe.typeBouton.deployer
                  ? 'bt-activable'
                  : 'bt-activable bt-large',
              ],
            });
          };
          H.push(
            IE.jsx.str(
              'div',
              {
                class: 'liste_btnentete',
                'ie-nodeafter': 'liste.getNodeAferToolbar',
                style: aCssWidth ? `width:${aCssWidth}` : false,
                role: 'toolbar',
                'aria-label':
                  ObjetTraduction_1.GTraductions.getValeur(
                    'liste.wai.EnteteDeListe',
                  ) +
                  ' ' +
                  ObjetTraduction_1.GTraductions.getValeur(
                    'Navigation.NavigationHorizontal',
                  ),
              },
              (aTab) => {
                const lIndexBtnDeployer = this._cache.boutons.findIndex(
                  (aBouton) => aBouton.genre === ObjetListe.typeBouton.deployer,
                );
                if (lIndexBtnDeployer >= 0) {
                  const lBoutonDeployer =
                    this._cache.boutons[lIndexBtnDeployer];
                  aTab.push(
                    _construireBouton(lBoutonDeployer, lIndexBtnDeployer),
                  );
                }
                if (lAvecCBToutCocher) {
                  aTab.push(
                    IE.jsx.str('ie-checkbox', {
                      'ie-model': (0, jsx_1.jsxFuncAttr)(
                        'liste.cb_ligne_flatDesign',
                        -1,
                      ),
                      'ie-html': (0, jsx_1.jsxFuncAttr)(
                        'liste.cb_ligne_flatDesign.getHtmlCBEntete',
                      ),
                      'ie-attr': (0, jsx_1.jsxFuncAttr)(
                        'liste.cb_ligne_flatDesign.getAttr',
                        -1,
                      ),
                      'ie-textright': true,
                      style: this._options.paddingContenu_LR
                        ? 'padding-left:' +
                          this._options.paddingContenu_LR +
                          'px;'
                        : false,
                    }),
                  );
                }
                if (lAvecBtnCreation) {
                  aTab.push(
                    IE.jsx.str(
                      'ie-bouton',
                      {
                        id: this.ids.btnCreation,
                        'ie-model': 'liste.btnCreationEntete',
                        class: 'themeBoutonPrimaire',
                        'ie-icon': this._options.iconeTitreCreation,
                      },
                      this._options.titreCreation,
                    ),
                  );
                }
                if (lAvecBoutonsListeEntete) {
                  aTab.push(
                    (0, tag_1.tag)(
                      'div',
                      { class: 'liste_btnentete_droite', role: 'presentation' },
                      (aTabBtn) => {
                        this._cache.boutons.forEach((aBouton, aIndex) => {
                          if (
                            aBouton.genre === ObjetListe.typeBouton.deployer
                          ) {
                            return;
                          }
                          if (
                            this.optionsInterne.versionMobile &&
                            aBouton.estBoutonPiedFlottant_mobile
                          ) {
                            return;
                          }
                          if (aBouton.html) {
                            aTabBtn.push(
                              IE.jsx.str('div', {
                                'ie-node': (0, jsx_1.jsxFuncAttr)(
                                  'liste.nodeBtnEnteteLibre',
                                  aIndex,
                                ),
                                role: 'presentation',
                              }),
                            );
                            return;
                          }
                          let H = _construireBouton(aBouton, aIndex);
                          if (
                            aBouton.genre === ObjetListe.typeBouton.rechercher
                          ) {
                            H = IE.jsx.str(
                              'div',
                              {
                                class: 'liste_contbtnRechercheEntete',
                                role: 'presentation',
                              },
                              H,
                            );
                          }
                          aTabBtn.push(H);
                        });
                      },
                    ),
                  );
                }
              },
            ),
          );
        }
        if (lHtmlLigneTotale) {
          H.push(lHtmlLigneTotale);
        }
        return H.join('');
      }
      _construireTotalFD(aPourHeader) {
        const lHtml = this.construireTotalInterneFD(aPourHeader);
        if (lHtml) {
          return IE.jsx.str(
            'div',
            {
              class: [
                'liste-totale-fd',
                aPourHeader ? 'liste-header' : 'liste-footer',
              ],
            },
            lHtml,
          );
        }
        return '';
      }
      construireTotalInterneFD(aPourHeader) {
        if (
          this._options.skin === ObjetListe.skin.flatDesign &&
          this.Donnees &&
          this.Donnees instanceof
            ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign &&
          this.Donnees.getTotal &&
          this.Donnees._getLigneTotaleSelectionnableFd
        ) {
          let lLigneTotale = this.Donnees.getTotal(aPourHeader);
          if (!lLigneTotale) {
            this.getListeArticles().parcourir((aArticle, aIndex) => {
              const lLigne =
                this.Donnees._getLigneTotaleSelectionnableFd(aIndex);
              if (
                lLigne &&
                !!lLigne.header === !!aPourHeader &&
                lLigne.estVisible
              ) {
                lLigneTotale = lLigne;
                return false;
              }
            });
          }
          if (lLigneTotale) {
            const lAvecSelection =
              lLigneTotale.avecSelection && !!lLigneTotale.article;
            let lEstSelectionne = false;
            if (
              !this.Donnees.enConstruction_cacheRechercheTexte &&
              lAvecSelection
            ) {
              lEstSelectionne = this._etatSelectionCellule({
                ligne: lLigneTotale.ligne,
                colonne: lLigneTotale.colonne,
              });
            }
            const lEnRecherche =
              this.Donnees.enConstruction_cacheRechercheTexte;
            let lMargin = '';
            if (!IE.estMobile) {
              lMargin = `0 ${this._options.paddingContenu_LR + this._getLargeurScrollV()}px 0 ${this._options.paddingContenu_LR}px`;
            }
            return (0, tag_1.tag)(
              'div',
              {
                class: [
                  lAvecSelection ? 'selectable' : '',
                  lEstSelectionne ? 'selected' : '',
                  lAvecSelection &&
                  IE.estMobile &&
                  !this.Donnees.enConstruction_cacheRechercheTexte
                    ? 'ie-ripple'
                    : '',
                ],
                style: tag_1.tag.styleToStr('margin', lMargin),
                id: lAvecSelection
                  ? this.getIdCellule(lLigneTotale.colonne, lLigneTotale.ligne)
                  : false,
                'ie-node':
                  lAvecSelection && !lEnRecherche
                    ? (0, jsx_1.jsxFuncAttr)('liste.nodeTotalFd', [
                        lLigneTotale.ligne,
                        lLigneTotale.colonne,
                      ])
                    : false,
                'ie-attr': !lEnRecherche
                  ? (0, jsx_1.jsxFuncAttr)('liste.attrTotalFd', [
                      lLigneTotale.ligne,
                      lLigneTotale.colonne,
                      lAvecSelection,
                    ])
                  : false,
                tabindex: '0',
                role: lAvecSelection ? 'button' : false,
              },
              (aHtml) => {
                aHtml.push(
                  (0, tag_1.tag)(
                    'span',
                    {
                      class: [
                        lLigneTotale.avecEtiquette ? 'total-etiqu' : 'sr-only',
                      ],
                    },
                    ObjetTraduction_1.GTraductions.getValeur('liste.total'),
                  ),
                );
                if (lLigneTotale.avecEtiquette) {
                  aHtml.push(IE.jsx.str('div', { class: 'total-etiqu-sep' }));
                }
                aHtml.push(
                  (0, tag_1.tag)(
                    'div',
                    {
                      class: 'total-content',
                      'aria-label': lLigneTotale.wai || false,
                    },
                    lLigneTotale.html || '',
                  ),
                );
              },
            );
          }
        }
        return '';
      }
      _getJConteneurInputRecherche() {
        return this._options.positionBoutons === NSListe.positionBoutons.entete
          ? $('#' + this.Nom.escapeJQ() + ' .liste_contbtnRechercheEntete')
          : $('#' + this.Nom.escapeJQ() + ' .liste_cont_btnscroll');
      }
      _creerZoneRechercheTexte(aAvecFocus) {
        const lJContenur = this._getJConteneurInputRecherche();
        if (lJContenur.find('.liste_rechercheTexte').length === 0) {
          let lAvecRecherche = false;
          if (this._cache.boutons) {
            lAvecRecherche = !!this._cache.boutons.find(
              (aBouton) => aBouton.genre === ObjetListe.typeBouton.rechercher,
            );
          }
          if (!lAvecRecherche) {
            return;
          }
          const H = IE.jsx.str(
            'div',
            { class: 'liste_rechercheTexte like-input' },
            IE.jsx.str('input', {
              type: 'text',
              'ie-textbrut': true,
              'ie-model': 'liste.rechercheTexte',
              placeholder:
                ObjetTraduction_1.GTraductions.getValeur('liste.Rechercher'),
              title:
                ObjetTraduction_1.GTraductions.getValeur('liste.Rechercher'),
              'aria-label':
                ObjetTraduction_1.GTraductions.getValeur('liste.Rechercher'),
              autocorrect: 'off',
              autocapitalize: 'off',
              spellcheck: 'off',
              class: 'browser-default',
            }),
            IE.jsx.str('ie-btnicon', {
              class: 'icon_fermeture_widget',
              'ie-model': 'liste.btnRechercheTexte',
              title:
                ObjetTraduction_1.GTraductions.getValeur('liste.supprimer'),
            }),
            IE.jsx.str('div', {
              role: 'alert',
              class: 'liste_rechercheTexte_alerte sr-only hide',
              'ie-html': 'liste.getHtmlResultRecherche',
              'aria-atomic': 'true',
            }),
          );
          lJContenur.ieHtmlAppend(H, { controleur: this.controleur });
        }
        if (aAvecFocus) {
          setTimeout(() => {
            const lElement = lJContenur
              .find('.liste_rechercheTexte input')
              .get(0);
            ObjetHtml_1.GHtml.setFocusEdit(lElement);
          }, 0);
        }
      }
      _supprimerZoneRechercheTexte() {
        this._getJConteneurInputRecherche()
          .find('.liste_rechercheTexte')
          .remove();
      }
      _annulerRechercheTexte() {
        this._setRechercheSaisie('');
        this._supprimerZoneRechercheTexte();
        const lCacheBouton = this._cache.boutons.find(
          (aBouton) => aBouton.genre === ObjetListe.typeBouton.rechercher,
        );
        ObjetHtml_1.GHtml.setFocus(
          lCacheBouton && lCacheBouton.id
            ? lCacheBouton.id
            : this.IdPremierElement,
        );
        this._filtreRechercheTexte({ annulerRechercheTexte: true });
      }
      _estLigneDansRangeNonConstruitDyn(aNumeroLigne) {
        const lCacheRef = this._cache.refresh;
        if (!lCacheRef.avecConstructionDynamiqueContenu) {
          return false;
        }
        const lIndexLigneVisible =
          this._cache.lignesVisibles.indexOf(aNumeroLigne);
        if (lIndexLigneVisible < 0) {
          return false;
        }
        const lStructureMin = lCacheRef.structure[lCacheRef.mapRangesExist.min];
        const lStructureMax = lCacheRef.structure[lCacheRef.mapRangesExist.max];
        if (lStructureMin && lStructureMax) {
          return (
            lIndexLigneVisible < lStructureMin.deb ||
            lIndexLigneVisible > lStructureMax.fin
          );
        }
        return false;
      }
      _getPositionTopLigneDynamiqueEvaluee(aNumeroLigne) {
        const lCacheRef = this._cache.refresh;
        if (!lCacheRef.avecConstructionDynamiqueContenu) {
          return null;
        }
        const lIndexLigne = this._cache.lignesVisibles.indexOf(aNumeroLigne);
        if (lIndexLigne < 0) {
          return null;
        }
        let lPosTop_Cellule = ObjetPosition_1.GPosition.getClientRect(
          lCacheRef.node_gab_start[0],
        ).top;
        for (const lStructure of lCacheRef.structure) {
          const lHeightStruct = lCacheRef.getHeightStructure(lStructure);
          if (lIndexLigne > lStructure.fin) {
            lPosTop_Cellule += lHeightStruct;
          } else {
            lPosTop_Cellule +=
              (lHeightStruct / (lStructure.fin - lStructure.deb + 1)) *
              (lIndexLigne - lStructure.deb);
            break;
          }
        }
        return lPosTop_Cellule;
      }
      _actualiserHeightRanges(aIndiceRange) {
        const lCacheRef = this._cache.refresh;
        let lAvecActualisation = false;
        const lTabIndices = [];
        if (aIndiceRange >= 0) {
          lTabIndices.push(aIndiceRange);
        } else {
          for (
            let lIndice = lCacheRef.mapRangesExist.min;
            lIndice <= lCacheRef.mapRangesExist.max;
            lIndice++
          ) {
            lTabIndices.push(lIndice);
          }
        }
        for (const lIndice of lTabIndices) {
          const lRangeConstruit = lCacheRef.mapRangesExist.get(lIndice);
          const lStructure = lCacheRef.structure[lIndice];
          if (!lRangeConstruit || !lStructure) {
            continue;
          }
          if (lRangeConstruit.node_start && lRangeConstruit.node_end) {
            lStructure.height =
              ObjetPosition_1.GPosition.getClientRect(lRangeConstruit.node_end)
                .top -
              ObjetPosition_1.GPosition.getClientRect(
                lRangeConstruit.node_start,
              ).bottom;
            lAvecActualisation = true;
          }
        }
        if (lAvecActualisation) {
          let lHeightTotal = 0;
          let lNbLignesTotal = 0;
          lCacheRef.structure.forEach((aStructure) => {
            if (aStructure.height > 0) {
              lHeightTotal += aStructure.height;
              lNbLignesTotal += aStructure.nbLignes;
            }
          });
          if (lNbLignesTotal > 0) {
            lCacheRef.hauteurMoyenneLigne = lHeightTotal / lNbLignesTotal;
          }
        }
      }
      _callbackObserverRefreshContenu(aObservables) {
        let lAvecRefresh = false;
        aObservables.forEach((aObservable) => {
          const lVisible =
            aObservable.intersectionRatio > 0 || aObservable.isIntersecting;
          const lData = this._cache.refresh.mapNodesObs.get(aObservable.target);
          if (lData) {
            if (lVisible) {
              lAvecRefresh = true;
            } else {
              if (!lData.gabarit) {
                lAvecRefresh = true;
              }
            }
          }
        });
        if (lAvecRefresh) {
          this._refreshContenuDynamique({
            avecBackupScroll: this.optionsInterne.versionMobile,
          });
          this._cache.refresh.surRefreshContenu = true;
          setTimeout(() => {
            this._cache.refresh.surRefreshContenu = false;
          }, 100);
        }
      }
      addContenuSurRefreshDyn(aParams) {
        const lParams = Object.assign({ start: false, indices: [] }, aParams);
        const lCache = this._cache;
        const lCacheRef = lCache.refresh;
        lCache.infosZonesColonnes.forEach((aInfosZoneColonnes, aIndex) => {
          const H = [];
          for (const lIndice of lParams.indices) {
            H.push(this._construireContenuRange(aInfosZoneColonnes, lIndice));
          }
          if (H) {
            let lNode = lCacheRef.node_gab_end[aIndex];
            if (lParams.start) {
              lNode = lCacheRef.node_gab_start[aIndex].nextSibling;
            }
            if (!lNode || !lNode.parentNode) {
              return;
            }
            IEHtml.injectHTMLParams({
              html: H.join(''),
              element: lNode.parentNode,
              insererAvantLeNode: lNode,
              controleur: this.controleur,
              ignorerScroll: true,
            });
          }
        });
      }
      _getClassRange(aIndiceRange) {
        return `_range_${aIndiceRange}`;
      }
      _refreshContenuDynamique(aParams) {
        const lCache = this._cache;
        const lCacheRef = lCache.refresh;
        if (!lCacheRef.avecConstructionDynamiqueContenu) {
          return;
        }
        const lParams = Object.assign(
          {
            surInitialisation: false,
            avecBackupScroll: false,
            refreshRecursif: false,
            conserverPositionElement: null,
          },
          aParams,
        );
        let lIndiceRangeDebut = lCacheRef.mapRangesExist.min;
        let lIndiceRangeFin = lCacheRef.mapRangesExist.max;
        if (
          !lCacheRef.mapRangesExist.has(lIndiceRangeDebut) ||
          !lCacheRef.mapRangesExist.has(lIndiceRangeFin)
        ) {
          return;
        }
        let lRectListe = ObjetPosition_1.GPosition.getClientRect(
          ObjetHtml_1.GHtml.getElement(this.Nom),
        );
        let lRectListe2 = ObjetPosition_1.GPosition.getClientRect(
          $(`#${this.Nom.escapeJQ()}>.ObjetListe`).get(0),
        );
        if (lRectListe2.height > lRectListe.height) {
          IE.log.addLog(
            `_ObjetListe : _refreshContenuDynamique avec overflow visible du contenu (demander à fv) ?`,
          );
          lRectListe = lRectListe2;
        }
        if (lRectListe.width === 0 || lRectListe.height === 0) {
          return;
        }
        let lAvecModif = false;
        let lBackupScroll = null;
        if (!lParams.surInitialisation) {
          if (lParams.avecBackupScroll) {
            lBackupScroll = this._backupScroll({
              conserverPositionScroll: true,
            });
          }
          const lBorneListeBottom = Math.min(
            GNavigateur.ecranH,
            lRectListe.bottom,
          );
          const lBorneListeTop = Math.max(0, lRectListe.top);
          const lRectStart = ObjetPosition_1.GPosition.getClientRect(
            lCacheRef.node_gab_start[0],
          );
          const lMapIndexVisibles = new Map();
          let lPos = lRectStart.top;
          for (let lIndex = 0; lIndex < lCacheRef.structure.length; lIndex++) {
            const lStructure = lCacheRef.structure[lIndex];
            const lHeight = lCacheRef.getHeightStructure(lStructure);
            if (lPos + lHeight > lBorneListeTop && lPos < lBorneListeBottom) {
              lMapIndexVisibles.set(lIndex, true);
              if (lIndex > 0) {
                lMapIndexVisibles.set(lIndex - 1, true);
              }
              if (lIndex < lCacheRef.structure.length - 1) {
                lMapIndexVisibles.set(lIndex + 1, true);
              }
            } else if (lPos + lHeight > lBorneListeBottom) {
              break;
            }
            lPos += lHeight;
          }
          if (lMapIndexVisibles.size === 0) {
            lMapIndexVisibles.set(0, true);
          }
          const lIndices_suppr = [];
          for (
            let lIndiceRange = lIndiceRangeDebut;
            lIndiceRange <= lIndiceRangeFin;
            lIndiceRange++
          ) {
            if (
              lCacheRef.mapRangesExist.has(lIndiceRange) &&
              !lMapIndexVisibles.has(lIndiceRange)
            ) {
              lIndices_suppr.push(lIndiceRange);
            }
          }
          if (lIndices_suppr.length > 0) {
            let lElementFocus = null;
            if (
              ObjetHtml_1.GHtml.focusEstDansElement &&
              ObjetHtml_1.GHtml.focusEstDansElement(this.Nom)
            ) {
              lElementFocus = ObjetHtml_1.GHtml.getElementEnFocus();
            }
            lAvecModif = true;
            const lFindExpr = [];
            lIndices_suppr.forEach((aIndex) => {
              lFindExpr.push(`.${this._getClassRange(aIndex)}`);
            });
            for (const lIndex in lCache.infosZonesColonnes) {
              $(lCacheRef.node_gab_end[lIndex])
                .parent()
                .find(lFindExpr.join(','))
                .remove();
            }
            if (lElementFocus && !$.contains(document.body, lElementFocus)) {
              ObjetHtml_1.GHtml.setFocus(this.IdPremierElement);
            }
          }
          const lIndices_ajout_after = [];
          const lIndices_ajout_before = [];
          for (const lIndice of lMapIndexVisibles.keys()) {
            if (lIndice > lIndiceRangeFin) {
              lIndices_ajout_after.push(lIndice);
            }
            if (lIndice < lIndiceRangeDebut) {
              lIndices_ajout_before.push(lIndice);
            }
          }
          const lFuncSortNumber = (a, b) => a - b;
          if (lIndices_ajout_after.length > 0) {
            lAvecModif = true;
            this.addContenuSurRefreshDyn({
              indices: lIndices_ajout_after.sort(lFuncSortNumber),
              start: false,
            });
          }
          if (lIndices_ajout_before.length > 0) {
            lAvecModif = true;
            this.addContenuSurRefreshDyn({
              indices: lIndices_ajout_before.sort(lFuncSortNumber),
              start: true,
            });
          }
          if (lAvecModif) {
            this._controleHeightLigne();
            this._surlignageRechercheTexte();
          }
        }
        if (lAvecModif || lParams.surInitialisation) {
          lIndiceRangeFin = lCacheRef.mapRangesExist.max;
          lIndiceRangeDebut = lCacheRef.mapRangesExist.min;
          let lheight_start = 0;
          let lHeight_end = 0;
          lCacheRef.structure.forEach((aStructure, aIndice) => {
            const lHeight = lCacheRef.getHeightStructure(aStructure);
            if (aIndice < lIndiceRangeDebut) {
              lheight_start += lHeight;
            } else if (aIndice > lIndiceRangeFin) {
              lHeight_end += lHeight;
            }
          });
          for (const lIndex in lCache.infosZonesColonnes) {
            lCacheRef.observer.unobserve(lCacheRef.node_gab_start[lIndex]);
            lCacheRef.observer.unobserve(lCacheRef.node_gab_end[lIndex]);
            lheight_start = Math.max(0, lheight_start);
            $(lCacheRef.node_gab_start[lIndex]).height(lheight_start);
            lCacheRef.observer.observe(lCacheRef.node_gab_start[lIndex]);
            lHeight_end = Math.max(0, lHeight_end);
            $(lCacheRef.node_gab_end[lIndex]).height(lHeight_end);
            lCacheRef.observer.observe(lCacheRef.node_gab_end[lIndex]);
          }
          if (lBackupScroll) {
            this._setScroll(lBackupScroll);
          }
          this._cache.positionsCelluleCadreSelection = {};
          this._actualiserCadreSelection();
        }
        let lConserverPositionElement = lParams.conserverPositionElement;
        if (lParams.conserverPositionElement) {
          const lElementCellule = ObjetHtml_1.GHtml.getElement(
            this.getIdCellule(
              lParams.conserverPositionElement.colonne,
              lParams.conserverPositionElement.ligne,
            ),
          );
          const lBackupScrollElement = this._backupScroll({
            conserverPositionScroll: true,
          });
          if (lBackupScrollElement) {
            let lPos = 0;
            if (lElementCellule) {
              lPos =
                ObjetPosition_1.GPosition.getClientRect(lElementCellule).top;
              lConserverPositionElement = null;
            } else if (!lBackupScroll) {
              lPos = this._getPositionTopLigneDynamiqueEvaluee(
                lParams.conserverPositionElement.ligne,
              );
            }
            const lDiffY =
              lPos - lParams.conserverPositionElement.rectCellule.top;
            if (lDiffY !== 0 && lPos !== null) {
              lBackupScrollElement.scrollTop += lDiffY;
              this._setScroll(lBackupScrollElement);
            }
          }
        }
        if (lAvecModif && lParams.refreshRecursif) {
          if (lParams.indiceRecursif > 10) {
            return;
          }
          this._refreshContenuDynamique({
            refreshRecursif: true,
            indiceRecursif:
              lParams.indiceRecursif > 0 ? lParams.indiceRecursif + 1 : 1,
            conserverPositionElement: lConserverPositionElement,
          });
        }
      }
      _scrollSurLigne(aParams) {
        if (this._enResize) {
          return;
        }
        if (this._cache.lignesVisibles.indexOf(aParams.ligne) < 0) {
          return;
        }
        const lBackupScroll = this._backupScroll({
          conserverPositionScroll: true,
        });
        if (!lBackupScroll) {
          return;
        }
        if (!lBackupScroll.elementScrollV) {
          return;
        }
        const lLigneAConstruire = this._estLigneDansRangeNonConstruitDyn(
          aParams.ligne,
        );
        let lTopCelluleDansContenu = 0;
        let lHeightCellule = 0;
        const lRectContenuScroll = ObjetPosition_1.GPosition.getClientRect(
          lBackupScroll.elementScrollV,
        );
        if (lLigneAConstruire) {
          const lCacheRef = this._cache.refresh;
          if (!lCacheRef.avecConstructionDynamiqueContenu) {
            return;
          }
          lHeightCellule = lCacheRef.hauteurMoyenneLigne;
          lTopCelluleDansContenu = this._getPositionTopLigneDynamiqueEvaluee(
            aParams.ligne,
          );
        } else {
          let lJCellule =
            aParams.colonne >= 0
              ? $(
                  '#' +
                    this.getIdCellule(
                      aParams.colonne,
                      aParams.ligne,
                    ).escapeJQ(),
                )
              : null;
          if (!lJCellule || lJCellule.length === 0) {
            this._cache.infosZonesColonnes.every((aBloc) => {
              return aBloc.colonnesVisibles.every((aNumeroColonne) => {
                lJCellule = $(
                  '#' +
                    this.getIdCellule(aNumeroColonne, aParams.ligne).escapeJQ(),
                );
                return lJCellule.length === 0;
              });
            });
            if (lJCellule.length === 0) {
              return;
            }
          }
          const lRectCellule = ObjetPosition_1.GPosition.getClientRect(
            lJCellule.get(0),
          );
          lHeightCellule =
            lRectCellule.outerHeight + (aParams.ecartForce * 2 || 0);
          lTopCelluleDansContenu =
            lRectCellule.top -
            lRectContenuScroll.top -
            (aParams.ecartForce || 0);
        }
        let lDecalageScroll = 0;
        if (lTopCelluleDansContenu < 0) {
          lDecalageScroll = lTopCelluleDansContenu;
        } else if (
          lTopCelluleDansContenu > 0 &&
          (aParams.avecScrollTopLigne || lRectContenuScroll.height === 0)
        ) {
          lDecalageScroll = lTopCelluleDansContenu;
        } else {
          const lZoneHeight = lRectContenuScroll.contentHeight;
          if (
            lTopCelluleDansContenu + lHeightCellule > lZoneHeight &&
            lTopCelluleDansContenu > 0
          ) {
            lDecalageScroll =
              lTopCelluleDansContenu + lHeightCellule - lZoneHeight;
          }
        }
        if (lDecalageScroll !== 0) {
          lBackupScroll.scrollTop = lBackupScroll.scrollTop + lDecalageScroll;
          this._setScroll(lBackupScroll);
          this._refreshContenuDynamique({
            avecBackupScroll: true,
            refreshRecursif: true,
          });
        }
        if (lLigneAConstruire) {
          if (!aParams._appelRecursif) {
            this._scrollSurLigne(
              Object.assign({}, aParams, { _appelRecursif: true }),
            );
            return;
          }
        }
      }
      _construireFiltres() {
        if (
          this._options.avecFiltresVisibles &&
          this.Donnees &&
          this.Donnees instanceof
            ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign &&
          this.Donnees._construireFiltres &&
          this.Donnees._getControleurFiltres &&
          this._cache.boutons &&
          this._cache.boutons.length > 0
        ) {
          const lAvecFiltre = !this._cache.boutons.every(
            (aBouton) => aBouton.genre !== ObjetListe.typeBouton.filtrer,
          );
          if (lAvecFiltre) {
            const lRoleGrid = this._estRoleTreeGrid();
            return IE.jsx.str(
              'div',
              {
                class: 'zone-filtres',
                role: lRoleGrid ? 'row' : 'group',
                'aria-label':
                  ObjetTraduction_1.GTraductions.getValeur('liste.Filtrer'),
              },
              IE.jsx.str('div', {
                'ie-node': 'liste.getNodeFiltres',
                role: lRoleGrid ? 'treegrid' : 'treeitem',
              }),
            );
          }
        }
        return '';
      }
      _surEventDownLigne(aParams) {
        if (
          aParams &&
          aParams.event &&
          aParams.event.target &&
          aParams.event.target.id === this.IdEdition
        ) {
          return;
        }
        delete this._cache.infosMouseDownCellule_apresFinEdition;
        if (this._cache.finEditionCreation) {
          const lResultFinEdition = this._cache.finEditionCreation();
          if (
            !this.Donnees.options.editionSurSelectionApresFinEdition ||
            (lResultFinEdition &&
              typeof lResultFinEdition === 'object' &&
              'avecMessagerErreur' in lResultFinEdition &&
              lResultFinEdition.avecMessagerErreur)
          ) {
            return;
          }
          this._cache.infosMouseDownCellule_apresFinEdition = {
            ligne: aParams.ligne,
            colonne: aParams.colonne,
          };
          return;
        }
        if (this._cache.editionEnCoursEvenement) {
          this._cache.editionEnCoursEvenement = false;
          this._nettoyerElementsEditionEnCours();
        }
        if (this._estEventSansSelect(aParams.event)) {
          return;
        }
        if (aParams.gestionShift && !aParams.event.shiftKey) {
          this._cache.celluleClicNonShift = {
            ligne: aParams.ligne,
            colonne: aParams.colonne,
          };
        }
        const lAvecMultiSelection = this.Donnees.avecMultiSelection();
        let lSansSelection = false;
        if (aParams.gestionMultiSelection) {
          lSansSelection =
            aParams.event.button === 2 &&
            this._etatSelectionCellule({
              ligne: aParams.ligne,
              colonne: aParams.colonne,
            }) &&
            lAvecMultiSelection &&
            (this._getListeElementsSelection().count() > 1 ||
              (this._estSelectionParCellule(aParams.ligne, aParams.colonne) &&
                this.getTableauCellulesSelection().length > 0));
        }
        if (!lSansSelection) {
          lSansSelection = !this._surSelection(aParams.colonne, aParams.ligne, {
            ctrlKey: aParams.event.ctrlKey,
            shiftKey: aParams.event.shiftKey,
            surInteractionUtilisateur: true,
          });
        }
        if (
          !aParams.gestionMultiSelection ||
          !lAvecMultiSelection ||
          (!aParams.event.ctrlKey && !aParams.event.shiftKey)
        ) {
          if (
            this.surDeploiement(aParams.event, aParams.colonne, aParams.ligne)
          ) {
            aParams.event.preventDefault();
          }
        }
        if (!lSansSelection) {
          this.surSelectionEvenement(aParams.colonne, aParams.ligne);
        }
      }
      _estEventSansSelect(aEvent) {
        if (aEvent && aEvent.target) {
          const lNode = ObjetHtml_1.GHtml.getClosestFocusable(aEvent.target);
          if (
            lNode &&
            !lNode.classList.contains('liste-cellule-focusable') &&
            !!lNode.closest('.liste-cellule-focusable')
          ) {
            return true;
          }
        }
        return false;
      }
      _estRoleTreeGrid() {
        return this._options.skin !== ObjetListe.skin.flatDesign;
      }
      _avecDeploiementDesactive() {
        if (!this.Donnees) {
          return true;
        }
        if (this.Donnees.options.ignorerDeploiementSurRechercheTexte) {
          return !this._estRechercheTexteVide();
        }
        return false;
      }
      _surlignageRechercheTexte() {
        if (this._estRechercheTexteVide()) {
          RechercheTexte_1.RechercheTexte.removeSurlignage(
            $(`#${this.Nom.escapeJQ()}`),
          );
          return;
        }
        const lRangeLignes = {
          debut: 0,
          fin: this._cache.lignesVisibles.length,
        };
        if (this._cache.refresh.avecConstructionDynamiqueContenu) {
          const lCacheRef = this._cache.refresh;
          lRangeLignes.debut =
            lCacheRef.structure[lCacheRef.mapRangesExist.min].deb;
          lRangeLignes.fin =
            lCacheRef.structure[lCacheRef.mapRangesExist.max].fin + 1;
        }
        let lTabDOM = [];
        for (
          let iIndice = lRangeLignes.debut;
          iIndice < lRangeLignes.fin;
          iIndice++
        ) {
          const lNumeroLigne = this._cache.lignesVisibles[iIndice];
          this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
            aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
              const lElement = ObjetHtml_1.GHtml.getElement(
                this.getIdCellule(
                  aInfosZoneColonnes.colonnesVisibles[aNumeroColonne],
                  lNumeroLigne,
                ),
              );
              if (lElement) {
                lTabDOM.push(lElement);
              }
            });
          });
        }
        if (
          !RechercheTexte_1.RechercheTexte.surlignage(
            lTabDOM,
            this._cache.rechercheTexte.saisie,
          )
        ) {
          RechercheTexte_1.RechercheTexte.removeSurlignage(
            $(`#${this.Nom.escapeJQ()}`),
          );
        }
      }
      _getTabElementsPourRsizeObserver() {
        return [];
      }
      _actualiserZones(aZonesActualisation, aParams) {}
      composeIconEtImage(aParamsCellule, aEstIcon) {
        const lValeur = this.Donnees._getValeur(aParamsCellule);
        const lHintHtml = this.Donnees.getHintHtmlForce(aParamsCellule);
        const lHint = this.Donnees.getHintForce(aParamsCellule),
          lStyle = this.Donnees.getStyle(aParamsCellule),
          lClass = this.Donnees.getClass(aParamsCellule);
        const lAttrs = {
          'ie-hint': lHintHtml ? `'${lHintHtml}'` : false,
          title: lHint && !lHintHtml ? lHint : false,
        };
        const lClasses = [
          'liste_contenu_ligne',
          lValeur,
          lClass ? ' ' + lClass : '',
        ];
        if (aEstIcon) {
          lClasses.push('AlignementMilieu');
          return IE.jsx.str(
            'i',
            Object.assign({ class: lClasses, style: lStyle || false }, lAttrs),
          );
        }
        const lLargeurImage =
          this._options.largeurImage > 0
            ? `width:${this._options.largeurImage}px;`
            : '';
        return IE.jsx.str(
          'div',
          Object.assign(
            { style: 'width: 100%', class: 'AlignementMilieu' },
            lAttrs,
          ),
          IE.jsx.str(
            'div',
            {
              class: lClasses,
              style: lLargeurImage + (lStyle ? ' ' + lStyle : ''),
            },
            '\u00A0',
          ),
        );
      }
      async surEditionTextFenetreAsync(aParams) {
        const lParams = Object.assign(
          { html: '', surCreation: false, surInputText: false, colonne: -1 },
          aParams,
        );
        let lStrTitre =
          lParams.surCreation && this._options.titreCreation
            ? this._options.titreCreation
            : '';
        if (this.ListeTitres && this.ListeTitres[0]) {
          const lDescripteurTitre = this.ListeTitres[0][lParams.colonne];
          let lStr = '';
          if (lDescripteurTitre) {
            lStr = lDescripteurTitre.libelleHtml
              ? lDescripteurTitre.libelleHtml
              : lDescripteurTitre.estCoche
                ? ''
                : lDescripteurTitre.libelle || '';
          }
          if (lStr) {
            if (lParams.surCreation && this._options.titreCreation) {
              lStrTitre = lStrTitre + ' - ' + lStr;
            }
            if (!lParams.surCreation) {
              lStrTitre =
                ObjetTraduction_1.GTraductions.getValeur('liste.modifier') +
                ' - ' +
                lStr;
            }
          }
        }
        class ObjetFenetreEditionText extends ObjetFenetre_1.ObjetFenetre {
          constructor(...aParams) {
            super(...aParams);
            this.setOptionsFenetre({
              listeBoutons: [
                ObjetTraduction_1.GTraductions.getValeur('Fermer'),
                {
                  estValider: true,
                  libelle: ObjetTraduction_1.GTraductions.getValeur('Valider'),
                },
              ],
              largeur: 400,
              titre: lStrTitre,
              avecCroixFermeture: true,
              fermerFenetreSurClicHorsFenetre: IE.estMobile,
              empilerFenetre: false,
              bloquerFocus: IE.estMobile,
            });
          }
          getControleur(aInstance) {
            return $.extend(true, super.getControleur(aInstance), {
              getNode() {
                ObjetHtml_1.GHtml.setHtml(
                  this.node,
                  IE.jsx.str(
                    IE.jsx.fragment,
                    null,
                    IE.jsx.str(
                      'label',
                      { for: aInstance.IdEdition, class: 'sr-only' },
                      lStrTitre,
                    ),
                    lParams.html,
                  ),
                  { instance: aInstance.Pere },
                );
                if (lParams.surInputText) {
                  $(this.node).on('keyup', (aEvent) => {
                    if (
                      ToucheClavier_1.ToucheClavierUtil.estEventRetourChariot(
                        aEvent,
                      )
                    ) {
                      aInstance.surValidation(1);
                    }
                  });
                }
              },
            });
          }
          composeContenu() {
            return IE.jsx.str('div', { 'ie-node': 'getNode' });
          }
          surAfficher() {
            if (lParams.surCreation) {
              ObjetHtml_1.GHtml.setFocusEdit(this.IdEdition);
              ObjetHtml_1.GHtml.setSelectionEdit(this.IdEdition);
            }
          }
        }
        const lResult = await ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetreEditionText,
          {
            pere: this,
            initialiser: function (aInstanceFenetre) {
              aInstanceFenetre.IdEdition = this.IdEdition;
            },
          },
        ).afficher();
        if (lResult && lResult.bouton && lResult.bouton.estValider) {
          if (this._cache.finEditionCreation) {
            this._cache.finEditionCreation();
          }
        } else {
          if (lParams.surCreation) {
            this._annulerCreation();
            $(`#${this.ids.btnCreation.escapeJQ()}`).trigger('focus');
          } else {
            this._surEditionFin({
              colonne: this._cache.selectionCellule.colonne,
              ligne: this._cache.selectionCellule.ligne,
            });
          }
        }
      }
      startNavigationContenu() {
        let lResult = false;
        if (this._cache.selectionCellule.ligne >= 0) {
          lResult = this._navigationCelluleSuivante({
            sansRecherche: true,
            forcerNavigationFocus: true,
          });
        }
        if (!lResult) {
          lResult = this._navigationCelluleSuivante({
            ligne: -1,
            colonne: -1,
            forcerNavigationFocus: true,
          });
        }
      }
    }
    exports.ObjetListe = ObjetListe;
    ObjetListe.typeInterTitre =
      ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign.typeInterTitre;
    ObjetListe.parsingSurColonneTri = Number.MAX_VALUE;
    var NSListe;
    (function (NSListe) {
      let positionBoutons;
      (function (positionBoutons) {
        positionBoutons[(positionBoutons['entete'] = 0)] = 'entete';
        positionBoutons[(positionBoutons['hautScroll'] = 1)] = 'hautScroll';
      })(
        (positionBoutons =
          NSListe.positionBoutons || (NSListe.positionBoutons = {})),
      );
      let FlecheTri;
      (function (FlecheTri) {
        FlecheTri['principal'] = 'principal';
        FlecheTri['secondaire'] = 'secondaire';
        FlecheTri['survol'] = 'survol';
      })((FlecheTri = NSListe.FlecheTri || (NSListe.FlecheTri = {})));
    })(NSListe || (exports.NSListe = NSListe = {}));
    (function (ObjetListe) {
      let typeLibelleCocheCBEntete;
      (function (typeLibelleCocheCBEntete) {
        typeLibelleCocheCBEntete['toutCocher'] = 'toutCocher';
        typeLibelleCocheCBEntete['compteurSelec'] = 'compteurSelec';
        typeLibelleCocheCBEntete['vide'] = 'vide';
      })(
        (typeLibelleCocheCBEntete =
          ObjetListe.typeLibelleCocheCBEntete ||
          (ObjetListe.typeLibelleCocheCBEntete = {})),
      );
      let skin;
      (function (skin) {
        skin['classique'] = 'classique';
        skin['alternance'] = 'alternance';
        skin['flatDesign'] = 'flatDesign';
      })((skin = ObjetListe.skin || (ObjetListe.skin = {})));
      let typeBouton;
      (function (typeBouton) {
        typeBouton['monter'] = 'monter';
        typeBouton['descendre'] = 'descendre';
        typeBouton['deployer'] = 'deployer';
        typeBouton['supprimer'] = 'supprimer';
        typeBouton['editer'] = 'editer';
        typeBouton['exportCSV'] = 'exportCSV';
        typeBouton['parametrer'] = 'parametrer';
        typeBouton['rechercher'] = 'rechercher';
        typeBouton['filtrer'] = 'filtrer';
      })((typeBouton = ObjetListe.typeBouton || (ObjetListe.typeBouton = {})));
    })(ObjetListe || (exports.ObjetListe = ObjetListe = {}));
  },
  fn: '_objetliste.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetScroll =
      exports.EGenreScrollEvenement =
      exports.EGenreScroll =
        void 0;
    require('ObjetScroll.css');
    const Callback_1 = require('Callback');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetStyle_1 = require('ObjetStyle');
    var EGenreScroll;
    (function (EGenreScroll) {
      EGenreScroll[(EGenreScroll['Vertical'] = 0)] = 'Vertical';
      EGenreScroll[(EGenreScroll['Horizontal'] = 1)] = 'Horizontal';
    })(EGenreScroll || (exports.EGenreScroll = EGenreScroll = {}));
    var EGenreScrollEvenement;
    (function (EGenreScrollEvenement) {
      EGenreScrollEvenement[(EGenreScrollEvenement['Deplacement'] = 0)] =
        'Deplacement';
      EGenreScrollEvenement[(EGenreScrollEvenement['TailleZone'] = 1)] =
        'TailleZone';
      EGenreScrollEvenement[(EGenreScrollEvenement['TailleContenu'] = 2)] =
        'TailleContenu';
      EGenreScrollEvenement[(EGenreScrollEvenement['TailleScroll'] = 3)] =
        'TailleScroll';
    })(
      EGenreScrollEvenement ||
        (exports.EGenreScrollEvenement = EGenreScrollEvenement = {}),
    );
    class ObjetScroll extends ObjetIdentite_1.Identite {
      constructor(aNom, aIdent, aPere, aEvenement, aGenre, aEvenementDecalage) {
        super(aNom, aIdent, aPere, aEvenement);
        if (typeof aNom === 'string') {
          this.Genre = aGenre;
        } else {
          this.Genre = aNom.genre;
        }
        this.Largeur = GNavigateur.getLargeurBarreDeScroll();
        this.tailleScrollPersonnalisee = false;
        this.tailleMin = 22;
        this.avecScrollEnTactile = false;
        this.Position = 0;
        this.nbLigneScroll = 2;
        this.pas = 0;
        this.callBackDecalage = new Callback_1.Callback(
          aPere,
          aEvenementDecalage,
        );
        this.zonesSansScrollTouch = [];
        this.styleSheetDisabled = ObjetStyle_1.GStyle.styleSheetDisabled();
      }
      getLargeur() {
        return this.Largeur;
      }
      setDonnees(...aParams) {
        let lElement;
        this.Position = 0;
        this.Zones = [];
        for (let I = 0; I < aParams.length; I++) {
          if (ObjetHtml_1.GHtml.elementExiste(this.getIdZone(aParams[I]))) {
            this.Zones.push(aParams[I]);
          }
        }
        if (this.Zones.length === 0) {
          if (aParams.length > 0) {
            return;
          } else {
            this.Zones.push(0);
          }
        }
        this.TailleZone = this.callback.appel(EGenreScrollEvenement.TailleZone);
        this.TailleContenu = this._getTailleContenu();
        if (
          !this.TailleZone ||
          this.styleSheetDisabled ||
          (global.GNavigateur &&
            GNavigateur.isLayoutTactile &&
            !this.avecScrollEnTactile &&
            (this.TailleContenu < this.TailleZone ||
              this.TailleContenu > this.TailleZone))
        ) {
          this.TailleZone = this.TailleContenu;
        }
        this.TailleZone = Math.min(this.TailleZone, this.TailleContenu);
        this.TailleZone = Math.max(this.TailleZone, 0);
        this.TailleContenu = Math.max(this.TailleContenu, 0);
        this.tailleScroll = this.TailleZone;
        if (this.tailleScrollPersonnalisee) {
          this.tailleScroll = Math.max(
            0,
            this.callback.appel(
              EGenreScrollEvenement.TailleScroll,
              this.TailleZone,
            ) || this.TailleZone,
          );
        }
        for (let I = 0; I < this.Zones.length; I++) {
          this.setTaille(this.getIdZone(this.Zones[I]), this.TailleZone);
        }
        this.Zones.forEach((aVal) => {
          $('#' + this.getIdZone(aVal).escapeJQ()).off(
            this.Genre === EGenreScroll.Vertical
              ? 'scroll.ObjetScrollV wheel.ObjetScrollV touchmove.ObjetScrollV pointermove.ObjetScrollV pointerdown.ObjetScrollV pointermove.ObjetScrollV'
              : 'scroll.ObjetScrollH wheel.ObjetScrollH touchmove.ObjetScrollH pointermove.ObjetScrollH pointerdown.ObjetScrollH pointermove.ObjetScrollH',
          );
        });
        if (this.TailleContenu > this.TailleZone) {
          if (this.pas === 0) {
            while (
              this.callback.appel(
                EGenreScrollEvenement.Deplacement,
                ++this.pas,
              ) === 0 &&
              this.pas < this.TailleContenu
            ) {
              continue;
            }
          }
          if (this.pas < 3) {
            this.pas = this.callback.appel(
              EGenreScrollEvenement.Deplacement,
              this.pas,
            );
          }
          ObjetHtml_1.GHtml.setHtml(this.getIdScroll(), this.compose(), {
            instance: this,
          });
          this._avecScrollConstruit = true;
          if (this.Genre === EGenreScroll.Vertical) {
            for (let I = 0; I < this.Zones.length; I++) {
              $('#' + this.getIdZone(this.Zones[I]).escapeJQ())
                .on(
                  'scroll.ObjetScrollV',
                  { instance: this, genre: this.Zones[I] },
                  (aEvent) => {
                    aEvent.data.instance.actualiser(aEvent.data.genre);
                  },
                )
                .on(
                  'wheel.ObjetScrollV',
                  { aObjet: this },
                  this.surMouseWheelV,
                );
              if (
                this._estTactile() &&
                this.zonesSansScrollTouch.indexOf(this.Zones[I]) === -1
              ) {
                $('#' + this.getIdZone(this.Zones[I]).escapeJQ()).on(
                  {
                    'pointerdown.ObjetScrollV': this.surPointerDownV,
                    'pointermove.ObjetScrollV': this.surPointerMoveV,
                    'touchmove.ObjetScrollV': this.surTouchMoveV,
                  },
                  { aObjet: this },
                );
              }
            }
          } else {
            for (let I = 0; I < this.Zones.length; I++) {
              $('#' + this.getIdZone(this.Zones[I]).escapeJQ())
                .on(
                  'scroll.ObjetScrollH',
                  { instance: this, genre: this.Zones[I] },
                  (aEvent) => {
                    aEvent.data.instance.actualiser(aEvent.data.genre);
                  },
                )
                .on(
                  'wheel.ObjetScrollH',
                  { aObjet: this },
                  this.surMouseWheelH,
                );
              if (
                this._estTactile() &&
                this.zonesSansScrollTouch.indexOf(this.Zones[I]) === -1
              ) {
                $('#' + this.getIdZone(this.Zones[I]).escapeJQ()).on(
                  {
                    'pointerdown.ObjetScrollH': this.surPointerDownH,
                    'pointermove.ObjetScrollH': this.surPointerMoveH,
                    'touchmove.ObjetScrollH': this.surTouchMoveH,
                  },
                  { aObjet: this },
                );
              }
            }
          }
        } else {
          if (this._avecScrollConstruit) {
            this._avecScrollConstruit = false;
            ObjetHtml_1.GHtml.setHtml(this.getIdScroll(), '');
          }
        }
        for (let I = 0; I < this.Zones.length; I++) {
          lElement = ObjetHtml_1.GHtml.getElement(
            this.getIdZone(this.Zones[I]),
          );
          if (lElement && lElement.style) {
            lElement.style.position = 'relative';
            lElement.style.boxSizing = 'content-box';
          }
        }
      }
      avecScrollVisible() {
        return this._avecScrollConstruit;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getNodeScroll: function () {
            $(this.node).on('scroll', function () {
              const _getPosition = () => {
                return Math.round(
                  aInstance.Genre === EGenreScroll.Horizontal
                    ? this.scrollLeft
                    : this.scrollTop,
                );
              };
              if (!aInstance._tickingScroll) {
                if (window.requestAnimationFrame) {
                  window.requestAnimationFrame(() => {
                    aInstance.evenementSurScroll(_getPosition());
                    delete aInstance._tickingScroll;
                  });
                } else {
                  aInstance.evenementSurScroll(_getPosition());
                }
              }
              aInstance._tickingScroll = true;
            });
          },
        });
      }
      compose() {
        let LStyleScroll, LStyleContenu;
        const lTailleZone = this.tailleScroll,
          lTailleContenu = this._getTailleScrollDeTailleContenu(
            this.TailleContenu,
          );
        if (this.Genre === EGenreScroll.Horizontal) {
          LStyleScroll =
            'width:' +
            lTailleZone +
            'px; height:' +
            this.Largeur +
            'px; min-width:' +
            this.tailleMin +
            'px;';
          LStyleContenu =
            'width:' + lTailleContenu + 'px; height:' + this.Largeur + 'px;';
        } else {
          LStyleScroll =
            'height:' +
            lTailleZone +
            'px; width:' +
            this.Largeur +
            'px; min-height:' +
            this.tailleMin +
            'px;';
          LStyleContenu =
            'height:' + lTailleContenu + 'px; width:' + this.Largeur + 'px;';
        }
        return IE.jsx.str(
          'div',
          { class: 'ObjetScroll', style: LStyleScroll, role: 'presentation' },
          IE.jsx.str(
            'div',
            {
              id: this.Nom,
              'ie-node': 'getNodeScroll',
              class: [
                this.Genre === EGenreScroll.Horizontal
                  ? 'horizontal'
                  : 'vertical',
              ],
              style: LStyleScroll,
              tabindex: '-1',
              role: 'presentation',
            },
            IE.jsx.str('div', {
              class: 'real-scroll',
              style: LStyleContenu,
              role: 'presentation',
            }),
          ),
        );
      }
      vider() {
        ObjetHtml_1.GHtml.setDisplay(this.getIdScroll(), false);
      }
      evenementSurScroll(APosition) {
        if (MethodesObjet_1.MethodesObjet.isNumber(APosition)) {
          APosition = Math.round(APosition);
        }
        const LPosition = this.callback.appel(
          EGenreScrollEvenement.Deplacement,
          APosition === null || APosition === undefined
            ? this.getPosition()
            : this._getTailleContenuDeTailleScroll(APosition),
        );
        for (let I = 0; I < this.Zones.length; I++) {
          const lIdZone = this.getIdZone(this.Zones[I]);
          if (LPosition !== this.getPosition(lIdZone)) {
            this.setPosition(lIdZone, LPosition);
          }
        }
        this.callBackDecalage.appel(this.Position - LPosition);
        if (this.Position !== LPosition) {
          this.setPosition(this.Nom, LPosition);
        }
      }
      actualiser(I) {
        this.setPosition(this.Nom, this.getPosition(this.getIdZone(I)));
      }
      surModificationHeightContenu() {
        if (
          this.Genre === EGenreScroll.Horizontal ||
          !this.avecScrollVisible()
        ) {
          return false;
        }
        const lOldTailleContenu = this.TailleContenu;
        const lNewTailleContenu = this._getTailleContenu();
        if (lOldTailleContenu === lNewTailleContenu) {
          return true;
        }
        if (lNewTailleContenu <= this.TailleZone) {
          return false;
        }
        this.TailleContenu = lNewTailleContenu;
        const lTailleContenu = this._getTailleScrollDeTailleContenu(
          this.TailleContenu,
        );
        const lJScroll = $(`#${this.Nom.escapeJQ()}`);
        lJScroll.find('>.real-scroll').css('height', `${lTailleContenu}px`);
        return true;
      }
      _getTailleContenu() {
        let lResult = this.callback.appel(EGenreScrollEvenement.TailleContenu);
        if (!lResult || !MethodesObjet_1.MethodesObjet.isNumber(lResult)) {
          lResult = this.getTaille(this.getIdContenu(this.Zones[0]));
        }
        return lResult;
      }
      getPosition(aId) {
        const lNom = aId || this.Nom;
        const lElement = ObjetHtml_1.GHtml.getElement(lNom);
        let lPosition = 0;
        if (lElement) {
          lPosition =
            this.Genre === EGenreScroll.Horizontal
              ? lElement.scrollLeft
              : lElement.scrollTop;
          if (lNom === this.Nom) {
            lPosition = this._getTailleContenuDeTailleScroll(lPosition);
          }
        }
        return lPosition;
      }
      setPosition(ANom, APosition) {
        if (!MethodesObjet_1.MethodesObjet.isNumeric(APosition)) {
          return false;
        }
        this.Position = APosition;
        const lElement = ObjetHtml_1.GHtml.getElement(ANom);
        if (!lElement) {
          return;
        }
        if (ANom === this.Nom) {
          const lPositionScroll =
            this._getTailleScrollDeTailleContenu(APosition);
          if (this.Genre === EGenreScroll.Horizontal) {
            lElement.scrollLeft = lPositionScroll;
          } else {
            lElement.scrollTop = lPositionScroll;
          }
        } else {
          if (this.Genre === EGenreScroll.Horizontal) {
            lElement.scrollLeft = APosition;
          } else {
            lElement.scrollTop = APosition;
          }
        }
      }
      getTaille(ANom) {
        return this.Genre === EGenreScroll.Horizontal
          ? ObjetPosition_1.GPosition.getWidth(ANom)
          : ObjetPosition_1.GPosition.getHeight(ANom);
      }
      setTaille(ANom, ATaille) {
        return this.Genre === EGenreScroll.Horizontal
          ? ObjetPosition_1.GPosition.setWidth(ANom, ATaille)
          : ObjetPosition_1.GPosition.setHeight(ANom, ATaille);
      }
      getIdScroll() {
        return this.Nom + '_Scroll';
      }
      getIdZone(I) {
        let lNomPere = '';
        if (this.Pere && 'getNom' in this.Pere) {
          lNomPere = this.Pere.getNom();
        } else if (this.Pere) {
          lNomPere = this.Pere.Nom;
        }
        return lNomPere + '_Zone_' + (I === null || I === undefined ? 0 : I);
      }
      getIdContenu(I) {
        let lNomPere = '';
        if (this.Pere && 'getNom' in this.Pere) {
          lNomPere = this.Pere.getNom();
        } else if (this.Pere) {
          lNomPere = this.Pere.Nom;
        }
        return lNomPere + '_Contenu_' + (I === null || I === undefined ? 0 : I);
      }
      scrollTo(aScroll) {
        const lElement = ObjetHtml_1.GHtml.getElement(this.Nom);
        if (lElement) {
          const lPositionScroll = this._getTailleScrollDeTailleContenu(aScroll);
          this.evenementSurScroll(lPositionScroll);
          if (this.Genre === EGenreScroll.Vertical) {
            lElement.scrollTop = lPositionScroll;
          } else {
            lElement.scrollLeft = lPositionScroll;
          }
        }
      }
      estScrollSurBorne(aSurBorneDebut) {
        const lElement = ObjetHtml_1.GHtml.getElement(this.Nom);
        if (lElement) {
          const lVert = this.Genre === EGenreScroll.Vertical;
          if (aSurBorneDebut) {
            return lVert ? lElement.scrollTop === 0 : lElement.scrollLeft === 0;
          }
          return lVert
            ? lElement.offsetHeight + lElement.scrollTop >=
                lElement.scrollHeight
            : lElement.offsetWidth + lElement.scrollLeft >=
                lElement.scrollWidth;
        }
        return true;
      }
      callbackAppel(...aParams) {
        return this.callback.appel(...aParams);
      }
      scrollToElement(aElement) {
        if (this.TailleContenu <= this.TailleZone) {
          return;
        }
        let lJElement,
          e,
          eleHeight,
          eleWidth,
          eleTop = 0,
          eleLeft = 0,
          lMaxVisible,
          lPositionDestination;
        try {
          lJElement = e = $(aElement);
        } catch (err) {
          return;
        }
        if (e.length === 0) {
          return;
        }
        const lTabId = [];
        for (let I = 0; I < this.Zones.length; I++) {
          lTabId.push(this.getIdZone(this.Zones[I]));
        }
        while (!lTabId.includes(e.get(0).id)) {
          let lPosElement = e.position();
          eleTop += lPosElement.top;
          eleLeft += lPosElement.left;
          e = e.offsetParent();
          if (/^body|html$/i.test(e[0].nodeName)) {
            return;
          }
        }
        eleTop += e.get(0).scrollTop;
        eleLeft += e.get(0).scrollLeft;
        const lPosition = this.getPosition();
        lMaxVisible = lPosition + this.TailleZone;
        if (this.Genre === EGenreScroll.Vertical) {
          eleHeight = lJElement.outerHeight();
          if (eleTop < lPosition) {
            lPositionDestination = eleTop - this.Largeur;
          } else if (eleTop + eleHeight > lMaxVisible) {
            lPositionDestination =
              eleTop - this.TailleZone + eleHeight + this.Largeur;
          }
        } else {
          eleWidth = lJElement.outerWidth();
          if (eleLeft < lPosition) {
            lPositionDestination = eleLeft - this.Largeur;
          } else if (eleLeft + eleWidth > lMaxVisible) {
            lPositionDestination =
              eleLeft - this.TailleZone + eleWidth + this.Largeur;
          }
        }
        if (MethodesObjet_1.MethodesObjet.isNumber(lPositionDestination)) {
          this.scrollTo(
            this._getTailleScrollDeTailleContenu(
              Math.max(0, lPositionDestination),
            ),
          );
        }
        return true;
      }
      _affectationScroll(aElement, aScroll, aVertical, aSurTouch) {
        const lTaille = this._getTailleScrollDeTailleContenu(
          this.callback.appel(
            EGenreScrollEvenement.Deplacement,
            this._getTailleContenuDeTailleScroll(aScroll),
          ),
        );
        const lGetter = aVertical ? 'scrollTop' : 'scrollLeft';
        const lResult = aElement[lGetter] !== lTaille;
        aElement[lGetter] = lTaille;
        if (!$.contains(document, aElement)) {
          return true;
        }
        if (aSurTouch || aElement[lGetter] !== lTaille) {
          this.evenementSurScroll(aElement[lGetter]);
        }
        return lResult;
      }
      _blockScrollWheel(aEvent) {
        if (aEvent.ctrlKey || aEvent.shiftKey) {
          return true;
        }
        if (aEvent.originalEvent.__wheelSurCombo__) {
          return true;
        }
        return false;
      }
      surMouseWheelV(aEvent) {
        const lInstance = aEvent.data.aObjet;
        if (
          lInstance.styleSheetDisabled ||
          lInstance._blockScrollWheel(aEvent)
        ) {
          return;
        }
        if (!lInstance.avecScrollVisible()) {
          return;
        }
        let lDeltaY = aEvent.originalEvent.deltaY;
        if (isNaN(lDeltaY)) {
          lDeltaY = 0;
        }
        lDeltaY = lDeltaY > 0 ? Math.min(1, lDeltaY) : Math.max(-1, lDeltaY);
        const lElement = ObjetHtml_1.GHtml.getElement(lInstance.Nom);
        if (lElement && lDeltaY !== 0) {
          const lScroll =
            lElement.scrollTop +
            lInstance.nbLigneScroll * lInstance.pas * Math.round(lDeltaY);
          lInstance._affectationScroll(lElement, lScroll, true);
          return false;
        }
        return true;
      }
      surPointerDownV(aEvent) {
        aEvent.data.aObjet.scrollStartPosY =
          aEvent.pointerType === 'touch' && aEvent.originalEvent.isPrimary
            ? aEvent.originalEvent.pageY
            : null;
      }
      surPointerMoveV(aEvent) {
        if (
          aEvent.data.aObjet.scrollStartPosY === null ||
          aEvent.pointerType !== 'touch' ||
          !aEvent.originalEvent.isPrimary
        ) {
          return;
        }
        if (aEvent.target && aEvent.target.closest('.ie-draggable-handle')) {
          return;
        }
        const lInstance = aEvent.data.aObjet;
        const lElement = ObjetHtml_1.GHtml.getElement(lInstance.Nom);
        if (lElement) {
          const lPageY = aEvent.originalEvent.pageY;
          const lDecalage = lInstance.scrollStartPosY - lPageY;
          if (Math.abs(lDecalage) >= 1) {
            const lScroll = lElement.scrollTop + lDecalage;
            if (lInstance._affectationScroll(lElement, lScroll, true, true)) {
              lInstance.scrollStartPosY = lPageY;
            }
          }
        }
      }
      surTouchMoveV(aEvent) {
        if (aEvent.data.aObjet.scrollStartPosY === null) {
          return;
        }
        aEvent.originalEvent.preventDefault();
        return false;
      }
      surMouseWheelH(aEvent) {
        const lInstance = aEvent.data.aObjet;
        if (
          lInstance.styleSheetDisabled ||
          lInstance._blockScrollWheel(aEvent)
        ) {
          return;
        }
        if (!lInstance.avecScrollVisible()) {
          return;
        }
        let lDeltaX = aEvent.originalEvent.deltaX;
        if (isNaN(lDeltaX)) {
          lDeltaX = 0;
        }
        lDeltaX = lDeltaX > 0 ? Math.min(1, lDeltaX) : Math.max(-1, lDeltaX);
        const lElement = ObjetHtml_1.GHtml.getElement(lInstance.Nom);
        if (lElement && lDeltaX !== 0) {
          const lScroll =
            lElement.scrollLeft +
            lInstance.nbLigneScroll * lInstance.pas * Math.floor(lDeltaX);
          lInstance._affectationScroll(lElement, lScroll, false);
          return false;
        }
        return true;
      }
      surPointerDownH(aEvent) {
        const lInstance = aEvent.data.aObjet;
        lInstance.scrollStartPosX =
          aEvent.pointerType === 'touch' && aEvent.originalEvent.isPrimary
            ? aEvent.originalEvent.pageX
            : null;
      }
      surPointerMoveH(aEvent) {
        const lInstance = aEvent.data.aObjet;
        if (
          lInstance.scrollStartPosX === null ||
          aEvent.pointerType !== 'touch' ||
          !aEvent.originalEvent.isPrimary
        ) {
          return;
        }
        if (aEvent.target && aEvent.target.closest('.ie-draggable-handle')) {
          return;
        }
        const lElement = ObjetHtml_1.GHtml.getElement(lInstance.Nom);
        if (lElement) {
          const lPageX = aEvent.originalEvent.pageX;
          const lDecalage = lInstance.scrollStartPosX - lPageX;
          if (Math.abs(lDecalage) >= 1) {
            const lScroll = lElement.scrollLeft + lDecalage;
            if (lInstance._affectationScroll(lElement, lScroll, false, true)) {
              lInstance.scrollStartPosX = lPageX;
            }
          }
        }
      }
      surTouchMoveH(aEvent) {
        if (aEvent.data.aObjet.scrollStartPosX === null) {
          return;
        }
        aEvent.originalEvent.preventDefault();
        return false;
      }
      _estTactile() {
        return window.GNavigateur && window.GNavigateur.isTactile;
      }
      _getTailleScrollDeTailleContenu(aValeur) {
        if (
          !this.tailleScrollPersonnalisee ||
          this.tailleScroll === this.TailleZone ||
          this.tailleScroll <= 0
        ) {
          return aValeur;
        }
        return Math.round((aValeur * this.tailleScroll) / this.TailleZone);
      }
      _getTailleContenuDeTailleScroll(aValeur) {
        if (
          !this.tailleScrollPersonnalisee ||
          this.tailleScroll === this.TailleZone ||
          this.tailleScroll <= 0
        ) {
          return aValeur;
        }
        return Math.round((aValeur * this.TailleZone) / this.tailleScroll);
      }
    }
    exports.ObjetScroll = ObjetScroll;
  },
  fn: 'objetscroll.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ExportBlob = void 0;
    exports.ExportBlob = {
      create(aContenu, aNomFichier, aTypeMime) {
        let lFile = null;
        let lExt = null;
        let lReussite = false;
        if (aTypeMime === 'text/csv') {
          lFile = ['\ufeff', aContenu];
          lExt = '.csv';
        } else if (aTypeMime === 'text/xml') {
          lFile = [aContenu];
          lExt = '.xml';
        }
        if (lFile) {
          let lBlob;
          try {
            lBlob = new Blob(lFile, { type: aTypeMime });
          } catch (e1) {
            try {
              const BlobBuilder =
                window.MozBlobBuilder ||
                window.WebKitBlobBuilder ||
                window.BlobBuilder;
              if (e1.name === 'TypeError' && window.BlobBuilder) {
                const bb = new BlobBuilder();
                bb.append(lFile);
                lBlob = bb.getBlob(aTypeMime);
              } else if (e1.name === 'InvalidStateError') {
                lBlob = new Blob(lFile, { type: aTypeMime });
              }
            } catch (e2) {
              IE.log.addLog('echec BlobBuilder');
              return false;
            }
          }
          let lAhref = null;
          try {
            lAhref = $(
              '<a href="' +
                (window.webkitURL || window.URL).createObjectURL(lBlob) +
                '" download="' +
                aNomFichier +
                lExt +
                '" style="display:none;"></a>',
            );
          } catch (e) {
            IE.log.addLog('echec createObjectURL');
            return false;
          }
          $('body').append(lAhref);
          try {
            if (window.navigator && window.navigator.msSaveBlob) {
              window.navigator.msSaveBlob(lBlob, aNomFichier + lExt);
              lReussite = true;
            }
          } catch (e2) {
            IE.log.addLog('echec msSaveBlob');
          }
          if (!lReussite) {
            try {
              lAhref.get(0).click();
              lReussite = true;
            } catch (e) {}
          }
          lAhref.remove();
        } else {
        }
        return lReussite;
      },
    };
  },
  fn: 'exportblob.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_ParametrageColonnesListe = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetElement_1 = require('ObjetElement');
    const TypeFusionTitreListe_1 = require('TypeFusionTitreListe');
    const ObjetDonneesListe_1 = require('ObjetDonneesListe');
    const _ObjetListe_1 = require('_ObjetListe');
    class ObjetFenetre_ParametrageColonnesListe extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          avecTailleSelonContenu: true,
          listeBoutons: [
            ObjetTraduction_1.GTraductions.getValeur('Annuler'),
            {
              valider: true,
              libelle: ObjetTraduction_1.GTraductions.getValeur('Valider'),
            },
          ],
          addParametresValidation: (aParams) => {
            const lParametrage = [];
            if (aParams.bouton.valider) {
              this.listeColonnes.parcourir((aElement) => {
                if (aElement.visible) {
                  lParametrage.push({ id: aElement.declaration.id });
                } else {
                  lParametrage.push({
                    id: aElement.declaration.id,
                    visible: false,
                  });
                }
              });
            }
            return { parametrage: lParametrage };
          },
        });
      }
      construireInstances() {
        const ConstructorObjetListe = this.optionsFenetre.classObjetListe;
        this.identListe = this.add(ConstructorObjetListe, null, (aInstance) => {
          aInstance.setOptionsListe({
            colonnes: [
              { id: colonnes.coche, taille: 20 },
              { id: colonnes.libelle, taille: 200 },
            ],
            hauteurAdapteContenu: true,
            hauteurMaxAdapteContenu: 400,
            boutons: [
              { genre: _ObjetListe_1.ObjetListe.typeBouton.monter },
              { genre: _ObjetListe_1.ObjetListe.typeBouton.descendre },
            ],
          });
        });
      }
      composeContenu() {
        return [
          '<div id="' +
            this.getNomInstance(this.identListe) +
            '" style="height:100%"></div>',
        ].join('');
      }
      setDonnees(aParams) {
        this.afficher();
        this.listeColonnes = new ObjetListeElements_1.ObjetListeElements();
        const lListeNonTrouve = new ObjetListeElements_1.ObjetListeElements();
        const lTitreFusionGauche = [];
        aParams.declarationColonnes.forEach((aDeclaration, aIndex) => {
          const lIndex = _chercherIdColonne(
              aParams.parametrageColonnes,
              aDeclaration.id,
            ),
            lElement = new ObjetElement_1.ObjetElement();
          lElement.declaration = aDeclaration;
          lElement.indexDeclaration = aIndex;
          lElement.visible = true;
          if (
            aParams.tableauColonnesCachees &&
            aParams.tableauColonnesCachees[aIndex] === true
          ) {
            lElement.estCachee = true;
          }
          let lTitre = aDeclaration.titre;
          if (!Array.isArray(lTitre)) {
            lTitre = [lTitre];
          }
          lElement.Libelle = '';
          lTitre.forEach((aTitre, aIndex) => {
            let lLibelle = aTitre;
            if (MethodesObjet_1.MethodesObjet.isObject(aTitre)) {
              lLibelle = '';
              if (aTitre.libelleParametrageColonne) {
                lLibelle = aTitre.libelleParametrageColonne;
              } else if (aTitre.libelle) {
                lLibelle = aTitre.libelle;
              }
            }
            if (
              lLibelle ===
              TypeFusionTitreListe_1.TypeFusionTitreListe.FusionHaute
            ) {
              return;
            }
            if (
              lLibelle ===
                TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche &&
              lTitreFusionGauche[aIndex]
            ) {
              lLibelle = lTitreFusionGauche[aIndex];
            }
            if (MethodesObjet_1.MethodesObjet.isString(lLibelle)) {
              lTitreFusionGauche[aIndex] = lLibelle;
              lElement.Libelle += (aIndex > 0 ? ' > ' : '') + lLibelle;
            }
          });
          if (lIndex >= 0) {
            lElement.visible =
              aParams.parametrageColonnes[lIndex].visible !== false;
            this.listeColonnes.addElement(lElement, lIndex);
          } else {
            lListeNonTrouve.addElement(lElement);
          }
        });
        this.listeColonnes.add(lListeNonTrouve);
        this.getInstance(this.identListe).setDonnees(
          new DonneesListe_ParametrageColonnesListe(this.listeColonnes),
        );
      }
    }
    exports.ObjetFenetre_ParametrageColonnesListe =
      ObjetFenetre_ParametrageColonnesListe;
    function _chercherIdColonne(aParametrage, aId) {
      let lIndex = -1;
      if (Array.isArray(aParametrage)) {
        aParametrage.every((aElement, aIndex) => {
          if (aElement && aElement.id === aId) {
            lIndex = aIndex;
            return false;
          }
          return true;
        });
      }
      return lIndex;
    }
    class DonneesListe_ParametrageColonnesListe extends ObjetDonneesListe_1.ObjetDonneesListe {
      constructor(aListe) {
        super(aListe);
        this.setOptions({
          avecSuppression: false,
          avecEtatSaisie: false,
          avecTri: false,
          avecLigneDroppable: true,
          avecLigneDraggable: true,
        });
      }
      getValeur(aParams) {
        switch (aParams.idColonne) {
          case colonnes.coche:
            return aParams.article.visible;
          case colonnes.libelle:
            return aParams.article.getLibelle();
        }
      }
      getTypeValeur(aParams) {
        return aParams.idColonne === colonnes.coche
          ? ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche
          : ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Texte;
      }
      getVisible(D) {
        return !!D && !D.estCachee;
      }
      avecEdition(aParams) {
        if (aParams.article && aParams.article.declaration.nonSupprimable) {
          return false;
        }
        if (
          aParams.article &&
          aParams.article.visible &&
          aParams.idColonne === colonnes.coche
        ) {
          let lNbVisibles = 0;
          this.Donnees.parcourir((aArticle) => {
            if (aArticle.visible) {
              lNbVisibles += 1;
            }
          });
          if (lNbVisibles < 2) {
            return false;
          }
        }
        return aParams.idColonne === colonnes.coche;
      }
      surEdition(aParams, V) {
        aParams.article.visible = V;
      }
      getCouleurCellule(aParams, aCouleurCellule) {
        if (aParams.idColonne === colonnes.libelle) {
          if (aParams.article.declaration.nonSupprimable) {
            aCouleurCellule.texte = 'red';
          } else if (aParams.article.declaration.nonDeplacable) {
            aCouleurCellule.texte = 'gray';
          }
        }
        return aCouleurCellule;
      }
      getClass(aParams) {
        if (
          aParams.idColonne === colonnes.libelle &&
          aParams.article.declaration.nonDeplacable
        ) {
          return 'Italique';
        }
      }
      autoriserDeplacementElementSurLigne(
        aParamsLigneDestination,
        aParamsSource,
      ) {
        const lAutoriserParent = super.autoriserDeplacementElementSurLigne(
          aParamsLigneDestination,
          aParamsSource,
        );
        return (
          lAutoriserParent &&
          !aParamsLigneDestination.article.declaration.nonDeplacable &&
          !aParamsSource.article.declaration.nonDeplacable
        );
      }
      surDeplacementElementSurLigne(aParamsLigneDestination, aParamsSource) {
        this.Donnees.remove(aParamsSource.ligne).insererElement(
          aParamsSource.article,
          aParamsLigneDestination.ligne,
        );
      }
    }
    var colonnes;
    (function (colonnes) {
      colonnes['coche'] = 'coche';
      colonnes['libelle'] = 'libelle';
    })(colonnes || (colonnes = {}));
  },
  fn: 'objetfenetre_parametragecolonnesliste.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    require('ObjetListeEspaceMobile.css');
    require('ObjetListe.css');
    const MethodesObjet_1 = require('MethodesObjet');
    const _ObjetListe_1 = require('_ObjetListe');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetStyle_1 = require('ObjetStyle');
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    const TypeFusionTitreListe_1 = require('TypeFusionTitreListe');
    const ObjetStyle_2 = require('ObjetStyle');
    const ObjetSupport_1 = require('ObjetSupport');
    const ObjetWAI_1 = require('ObjetWAI');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Enumere_Event_1 = require('Enumere_Event');
    const Invocateur_1 = require('Invocateur');
    const ObjetScroll_1 = require('ObjetScroll');
    const ObjetScroll_2 = require('ObjetScroll');
    const ObjetScroll_3 = require('ObjetScroll');
    const ObjetPosition_1 = require('ObjetPosition');
    const Enumere_EvenementListe_1 = require('Enumere_EvenementListe');
    const ObjetDonneesListe_1 = require('ObjetDonneesListe');
    const ObjetMenuContextuel_1 = require('ObjetMenuContextuel');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetFenetre_Date_1 = require('ObjetFenetre_Date');
    const ExportBlob_1 = require('ExportBlob');
    const _ObjetCouleur_1 = require('_ObjetCouleur');
    const ToucheClavier_1 = require('ToucheClavier');
    const ComparateurChaines_1 = require('ComparateurChaines');
    const tag_1 = require('tag');
    const UtilitaireMenuContextuelNatif_1 = require('UtilitaireMenuContextuelNatif');
    const ObjetFenetre_ParametrageColonnesListe_1 = require('ObjetFenetre_ParametrageColonnesListe');
    const ObjetDonneesListeFlatDesign_1 = require('ObjetDonneesListeFlatDesign');
    const jsx_1 = require('jsx');
    const IEHtml_1 = require('IEHtml');
    const _CONST_hauteurImageTri = 4;
    var EGenreZoneScroll;
    (function (EGenreZoneScroll) {
      EGenreZoneScroll[(EGenreZoneScroll['contenu'] = 1)] = 'contenu';
      EGenreZoneScroll[(EGenreZoneScroll['titre'] = 2)] = 'titre';
      EGenreZoneScroll[(EGenreZoneScroll['tri'] = 3)] = 'tri';
      EGenreZoneScroll[(EGenreZoneScroll['total'] = 4)] = 'total';
      EGenreZoneScroll[(EGenreZoneScroll['contenuFixe'] = 5)] = 'contenuFixe';
      EGenreZoneScroll[(EGenreZoneScroll['titreFixe'] = 6)] = 'titreFixe';
      EGenreZoneScroll[(EGenreZoneScroll['triFixe'] = 7)] = 'triFixe';
      EGenreZoneScroll[(EGenreZoneScroll['totalFixe'] = 8)] = 'totalFixe';
      EGenreZoneScroll[(EGenreZoneScroll['contenuFixeFin'] = 9)] =
        'contenuFixeFin';
      EGenreZoneScroll[(EGenreZoneScroll['titreFixeFin'] = 10)] =
        'titreFixeFin';
      EGenreZoneScroll[(EGenreZoneScroll['triFixeFin'] = 11)] = 'triFixeFin';
      EGenreZoneScroll[(EGenreZoneScroll['totalFixeFin'] = 12)] =
        'totalFixeFin';
    })(EGenreZoneScroll || (EGenreZoneScroll = {}));
    let uParseur = '',
      uTimerParseur = null;
    class ObjetListeEspace extends _ObjetListe_1.ObjetListe {
      constructor(...aParams) {
        super(...aParams);
        Object.assign(this.optionsInterne, {
          avecModeImpression: true,
          copierCellule: this._copierCellule.bind(this),
          collerCellule: this._collerCellule.bind(this),
          getClassListe: () => {
            return this._options.hauteurAdapteContenu ? 'hauteur-auto' : '';
          },
          initStructureDynamique: this._initStructureDynamique.bind(this),
        });
        this.IdPremierElement = this.getIdGridFocus(0);
      }
      composeImpression(aProportion) {
        return this._composeImpression(aProportion);
      }
      construireCopieCSV() {
        ExportBlob_1.ExportBlob.create(
          this._construireCopieCSV(),
          'Export CSV',
          'text/csv',
        );
      }
      resize() {
        this._surPreResize();
        this._surPostResize();
      }
      surPreResize() {
        this._surPreResize();
      }
      surPostResize() {
        this._surPostResize();
      }
      _init() {
        super._init();
        if (this.Nom) {
          if (this.avecEventResizeNavigateur()) {
            this.ajouterEvenementGlobal(
              Enumere_Event_1.EEvent.SurPreResize,
              this._surPreResize,
            );
            this.ajouterEvenementGlobal(
              Enumere_Event_1.EEvent.SurPostResize,
              this._surPostResize,
            );
          }
          Invocateur_1.Invocateur.abonner(
            GNavigateur.getEventInvocateur('keydown'),
            this._eventKeyDownApplication,
            this,
          );
          Invocateur_1.Invocateur.abonner(
            GNavigateur.getEventInvocateur('keyup') +
              ' ' +
              GNavigateur.getEventInvocateur('mousemove'),
            (event) => {
              if (this._cache.rolloverVisible && !event.ctrlKey) {
                this._gererRollover(false);
              }
            },
            this,
          );
          this.ScrollV = new ObjetScroll_1.ObjetScroll(
            this.Nom + '.ScrollV',
            null,
            this,
            this._evenementScrollV,
            ObjetScroll_2.EGenreScroll.Vertical,
          );
          this.ScrollV.pas = 50;
          this.ScrollH = new ObjetScroll_1.ObjetScroll(
            this.Nom + '.ScrollH',
            null,
            this,
            this._evenementScrollH.bind(this),
            ObjetScroll_2.EGenreScroll.Horizontal,
          );
          this.ScrollH.pas = 20;
        }
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          liste: {
            getNodeListe() {
              $(this.node).on({
                keydown: function (aEvent) {
                  if (
                    aEvent.ctrlKey &&
                    String.fromCharCode(aEvent.which).toLowerCase() === 'a' &&
                    aInstance._options.avecToutSelectionner &&
                    !aEvent.target.closest('input') &&
                    !aInstance._cache.editionEnCours &&
                    !aInstance._cache.creationEnCours &&
                    aInstance.Donnees &&
                    aInstance.Donnees.avecMultiSelection()
                  ) {
                    for (
                      let iLigne = 0;
                      iLigne < aInstance._cache.lignesSelectionnees.length;
                      iLigne++
                    ) {
                      if (!aInstance._etatSelectionCellule({ ligne: iLigne })) {
                        aInstance.selectionnerLigne({
                          ligne: iLigne,
                          selectionner: true,
                          _avecVisuCadreSelection: false,
                        });
                      }
                    }
                    aInstance._actualiserCadreSelection();
                    aEvent.preventDefault();
                  }
                },
                keypress(aEvent) {
                  if (
                    aEvent.target.closest('input, textarea') ||
                    aEvent.target.closest('.flecheTri')
                  ) {
                    return;
                  }
                  aInstance.gererParsingSurEventKey(aEvent);
                  if (
                    aInstance.Pere &&
                    aInstance.Evenement &&
                    aInstance.Donnees &&
                    aInstance.Donnees.options &&
                    aInstance.Donnees.options.avecEvnt_KeyPressListe
                  ) {
                    const lCallback = function () {
                      aInstance.Evenement.call(aInstance.Pere, {
                        instance: aInstance,
                        event: aEvent,
                        genreEvenement:
                          Enumere_EvenementListe_1.EGenreEvenementListe
                            .KeyPressListe,
                      });
                      aInstance._refreshSelf();
                    };
                    if (
                      aInstance.Donnees.options.avecTimeoutEvent_KeyPressListe
                    ) {
                      clearTimeout(aInstance._cache.timerKeyPress);
                      aInstance._cache.timerKeyPress = setTimeout(() => {
                        if (!aInstance.isDestroyed()) {
                          lCallback();
                        }
                      }, 0);
                    } else {
                      lCallback();
                    }
                  }
                },
                keyup: function (aEvent) {
                  if (aEvent.target.closest('input, textarea')) {
                    return;
                  }
                  if (
                    ToucheClavier_1.ToucheClavierUtil.estEventSupprimer(
                      aEvent,
                    ) &&
                    aInstance._avecSuppressionSelectionCourante(
                      aInstance._cache.selectionCellule.ligne,
                      aInstance._cache.selectionCellule.colonne,
                    )
                  ) {
                    aInstance._surSuppression();
                  } else if (
                    aInstance.Pere &&
                    aInstance.Evenement &&
                    aInstance.Donnees &&
                    aInstance.Donnees.options &&
                    aInstance.Donnees.options.avecEvnt_KeyUpListe
                  ) {
                    aInstance.Evenement.call(aInstance.Pere, {
                      instance: aInstance,
                      event: aEvent,
                      genreEvenement:
                        Enumere_EvenementListe_1.EGenreEvenementListe
                          .KeyUpListe,
                    });
                    aInstance._refreshSelf();
                  }
                  if (aInstance._estToucheNavigationFlechesClavier(aEvent)) {
                    aInstance._navigationFlechesClavier(aEvent, {
                      ligneEtColonneFixe: true,
                      forcerNavigationFocus: true,
                    });
                    GNavigateur.stopperEvenement(aEvent.originalEvent);
                  }
                },
                mousenter: function () {
                  aInstance._cache.mouseOUTListe = false;
                },
                mouseleave: function () {
                  aInstance._cache.mouseOUTListe = true;
                },
              });
            },
            getNodeAfterListe() {
              const lAvecBoutons = aInstance._avecBoutonsListeHautScroll();
              if (aInstance._options.borduresContenu_top || !lAvecBoutons) {
                let lTop =
                  (aInstance._zoneContenuAvecTraitHaut()
                    ? aInstance._options.borduresContenu_top
                    : 0) || 0;
                if (!lAvecBoutons) {
                  let lMax = 0;
                  aInstance._cache.infosZonesColonnes.forEach(
                    (aInfosZoneColonnes) => {
                      lMax = Math.max(
                        lMax,
                        ObjetPosition_1.GPosition.getHeight(
                          aInstance.ids.titre + aInfosZoneColonnes.indiceBloc,
                        ),
                      );
                    },
                  );
                  lTop += lMax;
                }
                $('#' + aInstance.ScrollV.getIdScroll().escapeJQ()).css(
                  'padding-top',
                  lTop + 'px',
                );
              }
            },
            getNodeScrollContenuParent() {
              $(this.node).on({
                contextmenu: function (event) {
                  if (
                    event.originalEvent &&
                    '__contextMenuSurContenu__' in event.originalEvent &&
                    event.originalEvent.__contextMenuSurContenu__
                  ) {
                    return;
                  }
                  const lParams = aInstance._getParamsCellule(null, -2, {
                    surFondListe: true,
                  });
                  if (
                    aInstance.Donnees.avecMenuContextuel(lParams) &&
                    !UtilitaireMenuContextuelNatif_1.UtilitaireMenuContextuelNatif.accepter(
                      event,
                    )
                  ) {
                    aInstance._ouvrirMenuContextuel(lParams);
                  }
                },
              });
            },
            getNodeScrollContenu() {
              const lEsTreeGrid = aInstance._estRoleTreeGrid();
              const lEventMapCelluleTd = {
                mousedown: aInstance._surMouseDownCellule,
                mouseup: aInstance._surMouseUpCellule,
                click: aInstance._surClickCellule,
                dblclick: aInstance._surDblClickCellule,
                keyup: aInstance._surKeyUpCellule,
                keydown: aInstance._surKeyDownCellule,
                contextmenu: aInstance._surContextMenuCellule,
                mouseenter: aInstance._surMouseEnterOverCellule,
                mouseover: aInstance._surMouseEnterOverCellule,
                focus() {
                  if (lEsTreeGrid) {
                    this.removeAttribute('aria-hidden');
                    aInstance.liaisonWAITitreColonne(
                      true,
                      true,
                      parseInt(this.dataset.colonne),
                    );
                    const lTreeGrid = ObjetHtml_1.GHtml.getElement(
                      aInstance.ids.WAIGrid + '_rowcell',
                    );
                    if (lTreeGrid) {
                      lTreeGrid.setAttribute('aria-owns', this.id);
                    }
                  }
                  ObjetHtml_1.GHtml.getElementsFocusablesDElement(this).forEach(
                    (aNode) => {
                      aNode.setAttribute('tabindex', '0');
                    },
                  );
                  const lTreeGridTri = ObjetHtml_1.GHtml.getElement(
                    aInstance.ids.WAIGrid + '_rowtri',
                  );
                  lTreeGridTri === null || lTreeGridTri === void 0
                    ? void 0
                    : lTreeGridTri.removeAttribute('aria-owns');
                },
                blur() {
                  if (lEsTreeGrid) {
                    aInstance.liaisonWAITitreColonne(
                      false,
                      true,
                      parseInt(this.dataset.colonne),
                    );
                    const lTreeGrid = ObjetHtml_1.GHtml.getElement(
                      aInstance.ids.WAIGrid + '_rowcell',
                    );
                    if (lTreeGrid) {
                      lTreeGrid.removeAttribute('aria-owns');
                    }
                  }
                  ObjetHtml_1.GHtml.getElementsFocusablesDElement(this).forEach(
                    (aNode) => {
                      aNode.setAttribute('tabindex', '-1');
                    },
                  );
                  if (lEsTreeGrid) {
                    this.setAttribute('aria-hidden', 'true');
                  }
                },
              };
              const lData = { instance: aInstance };
              $(this.node)
                .on(
                  lEventMapCelluleTd,
                  'div.liste_celluleGrid:not(:has(.Liste_Input_Texte))',
                  lData,
                )
                .on('mouseleave', () => {
                  aInstance._gererRollover(false);
                });
            },
            getNodeGridTotal() {
              $(this.node).on({
                focus(aEvent) {
                  var _a, _b, _c;
                  if (
                    !aEvent.relatedTarget ||
                    aEvent.relatedTarget.closest('.liste_cellule_total')
                  ) {
                    return;
                  }
                  if (
                    (_a = aInstance._cache.gridTotalAccess) === null ||
                    _a === void 0
                      ? void 0
                      : _a.nav
                  ) {
                    (_b = ObjetHtml_1.GHtml.getElement(
                      aInstance.getIdCelluleTotal(
                        aInstance._cache.gridTotalAccess.nav.colonne,
                        aInstance._cache.gridTotalAccess.nav.ligne,
                        true,
                      ),
                    )) === null || _b === void 0
                      ? void 0
                      : _b.focus();
                  } else {
                    const lCols = aInstance._cache.gridTotalAccess.ordres[0];
                    if (lCols && lCols.length > 0) {
                      (_c = ObjetHtml_1.GHtml.getElement(
                        aInstance.getIdCelluleTotal(
                          lCols[0],
                          aInstance._cache.gridTotalAccess.sansArticle ? -1 : 0,
                          true,
                        ),
                      )) === null || _c === void 0
                        ? void 0
                        : _c.focus();
                    }
                  }
                },
              });
            },
            getNodeCelluleTotalCell() {
              $(this.node).on({
                keyup(aEvent) {
                  aInstance.navigationClavierGridTotal(aEvent);
                },
              });
            },
            getNodeCelluleTotal() {
              const lData = { instance: aInstance };
              $(this.node).on(
                {
                  click: aInstance._surClickCelluleTotal,
                  focusin() {
                    var _a, _b;
                    aInstance._cache.gridTotalAccess.nav = {
                      ligne: parseInt(this.dataset.row),
                      colonne: parseInt(this.dataset.col),
                    };
                    this.removeAttribute('aria-hidden');
                    aInstance.liaisonWAITitreColonne(
                      true,
                      false,
                      aInstance._cache.gridTotalAccess.nav.colonne,
                    );
                    (_a = ObjetHtml_1.GHtml.getElement(
                      aInstance.ids.WAIGrid + 'total_rowcell',
                    )) === null || _a === void 0
                      ? void 0
                      : _a.setAttribute('aria-owns', this.id);
                    (_b = ObjetHtml_1.GHtml.getElement(
                      aInstance.ids.WAIGrid + '_gridTotal',
                    )) === null || _b === void 0
                      ? void 0
                      : _b.setAttribute('tabindex', '-1');
                  },
                  focusout() {
                    var _a, _b;
                    aInstance.liaisonWAITitreColonne(
                      false,
                      false,
                      aInstance._cache.gridTotalAccess.nav.colonne,
                    );
                    (_a = ObjetHtml_1.GHtml.getElement(
                      aInstance.ids.WAIGrid + 'total_rowcell',
                    )) === null || _a === void 0
                      ? void 0
                      : _a.removeAttribute('aria-owns');
                    this.setAttribute('aria-hidden', 'true');
                    (_b = ObjetHtml_1.GHtml.getElement(
                      aInstance.ids.WAIGrid + '_gridTotal',
                    )) === null || _b === void 0
                      ? void 0
                      : _b.setAttribute('tabindex', '0');
                  },
                },
                lData,
              );
            },
            getNodeTableTitre(aIndiceBloc) {
              if (aInstance._cache.infosZonesColonnes.length > 1) {
                $(this.node)
                  .find('.liste_titreGabLigne')
                  .each(function (aIndexLigne) {
                    if (!aInstance._cache.heightLigneTitre) {
                      aInstance._cache.heightLigneTitre = {};
                    }
                    if (!aInstance._cache.heightLigneTitre[aIndexLigne]) {
                      aInstance._cache.heightLigneTitre[aIndexLigne] = {
                        min: Number.MAX_VALUE,
                        max: -1,
                      };
                    }
                    const lInfosLigne =
                      aInstance._cache.heightLigneTitre[aIndexLigne];
                    const lHeight = $(this).height();
                    lInfosLigne[aIndiceBloc] = lHeight;
                    lInfosLigne.min = Math.min(lHeight, lInfosLigne.min);
                    lInfosLigne.max = Math.max(lHeight, lInfosLigne.max);
                  });
              }
            },
            getNodeAfterTableTitre(aIndiceBloc) {
              if (aInstance._cache.heightLigneTitre) {
                $(this.node)
                  .find('.liste_titreGabLigne')
                  .each(function (aIndexLigne) {
                    const lInfosLigne =
                      aInstance._cache.heightLigneTitre[aIndexLigne];
                    if (
                      lInfosLigne &&
                      lInfosLigne[aIndiceBloc] < lInfosLigne.max
                    ) {
                      $(this).height(lInfosLigne.max);
                    }
                  });
              }
              const lInfos = aInstance._cache.infosZonesColonnes[aIndiceBloc];
              if (aInstance._cache.colonnesTri) {
                aInstance._nodeTableTitrePourTri(this.node, lInfos);
              }
            },
            getOptionsEllipsisTitre(aAvecHint, aNbLignesMax) {
              return {
                nbLignesMax: aNbLignesMax,
                getJNodeHint: function (aNode) {
                  return $(aNode).parent();
                },
                avecHint: !!aAvecHint,
              };
            },
            getNodeAfterCurseurTri(aNumeroTri, aIndiceBloc) {
              const lInfos = aInstance._cache.infosZonesColonnes[aIndiceBloc];
              aInstance._positionnerCurseurTri(lInfos, this.node, aNumeroTri);
              $(this.node)
                .on({
                  contextmenu: function () {
                    aInstance.afficherMenuContextuelTri(
                      aInstance._triCourant.colonne[aNumeroTri],
                    );
                  },
                  keyup(aEvent) {
                    if (
                      aEvent.which ===
                        ToucheClavier_1.ToucheClavier.FlecheGauche ||
                      aEvent.which ===
                        ToucheClavier_1.ToucheClavier.FlecheDroite
                    ) {
                      const lNumeroColonne =
                        aInstance._triCourant.colonne[aNumeroTri];
                      const lInc =
                        aEvent.which ===
                        ToucheClavier_1.ToucheClavier.FlecheGauche
                          ? -1
                          : 1;
                      let lNumeroColonneTriRecherche = lNumeroColonne + lInc;
                      while (
                        lNumeroColonneTriRecherche <
                          aInstance._cache.listeCorrespondancesColonnes
                            .length &&
                        lNumeroColonneTriRecherche > 0 &&
                        (!aInstance._cache.colonnesTri[
                          lNumeroColonneTriRecherche
                        ] ||
                          !aInstance._estColonneVisible(
                            lNumeroColonneTriRecherche,
                          ) ||
                          !ObjetHtml_1.GHtml.getElement(
                            aInstance.getIdAriaTitreDeColonne(
                              lNumeroColonneTriRecherche,
                            ),
                          ))
                      ) {
                        lNumeroColonneTriRecherche += lInc;
                      }
                      if (
                        aInstance._cache.colonnesTri[
                          lNumeroColonneTriRecherche
                        ] &&
                        aInstance._estColonneVisible(
                          lNumeroColonneTriRecherche,
                        ) &&
                        ObjetHtml_1.GHtml.getElement(
                          aInstance.getIdAriaTitreDeColonne(
                            lNumeroColonneTriRecherche,
                          ),
                        )
                      ) {
                        aInstance._setColonneTri(
                          lNumeroColonneTriRecherche,
                          aInstance._triCourant.genre[aNumeroTri],
                          aNumeroTri,
                        );
                      }
                      aEvent.stopImmediatePropagation();
                    }
                  },
                  focus() {
                    const lTreeGrid = ObjetHtml_1.GHtml.getElement(
                      aInstance.ids.WAIGrid + '_rowtri',
                    );
                    lTreeGrid === null || lTreeGrid === void 0
                      ? void 0
                      : lTreeGrid.setAttribute(
                          'aria-owns',
                          aInstance.ids.curseurTri + aIndiceBloc + '_row',
                        );
                  },
                })
                .eventValidation(function () {
                  if ($(this).data('dragEnCours')) {
                    return;
                  }
                  const lGenreTri =
                    aInstance._triCourant.genre[aNumeroTri] ===
                    Enumere_TriElement_1.EGenreTriElement.Croissant
                      ? Enumere_TriElement_1.EGenreTriElement.Decroissant
                      : Enumere_TriElement_1.EGenreTriElement.Croissant;
                  aInstance._setColonneTri(
                    aInstance._triCourant.colonne[aNumeroTri],
                    lGenreTri,
                    aNumeroTri,
                  );
                });
            },
            dragCurseurTriDraggable(aNumeroTri, aIndiceBloc) {
              const lIdCurseurTriSurvol =
                aInstance.ids.curseurTriSurvol.escapeJQ() + aIndiceBloc;
              return {
                start(aParamsDrag) {
                  $(aParamsDrag.node).data('dragEnCours', true);
                  $('#' + lIdCurseurTriSurvol).data('dragEnCours', true);
                },
                drag(aParamsDrag) {
                  const lNumeroColonne = aInstance._getColonneDePositionLeft(
                    aParamsDrag.pos.x,
                    ObjetHtml_1.GHtml.getElement(
                      aInstance.ScrollH.getIdContenu(EGenreZoneScroll.tri),
                    ),
                    aInstance._cache.infosZonesColonnes[aIndiceBloc],
                  );
                  aParamsDrag.numeroColonneTri = lNumeroColonne;
                  const lRectContainer =
                    ObjetPosition_1.GPosition.getClientRect(
                      ObjetHtml_1.GHtml.getElement(
                        aInstance.ScrollH.getIdZone(EGenreZoneScroll.tri),
                      ),
                    );
                  let lLeft =
                    aParamsDrag.pos.x -
                    lRectContainer.left -
                    aParamsDrag.rect.width / 2;
                  lLeft = Math.max(lLeft, 0);
                  lLeft = Math.min(
                    lLeft,
                    lRectContainer.width - aParamsDrag.rect.width,
                  );
                  $(aParamsDrag.node).css({ left: lLeft });
                },
                stop(aParamsDrag) {
                  $(aParamsDrag.node).data('dragEnCours', null);
                  $('#' + lIdCurseurTriSurvol).data('dragEnCours', null);
                  if (
                    aParamsDrag.numeroColonneTri < 0 ||
                    !aInstance._cache.colonnesTri[aParamsDrag.numeroColonneTri]
                  ) {
                    return;
                  }
                  aInstance._setColonneTri(
                    aParamsDrag.numeroColonneTri,
                    aInstance._triCourant.genre[aNumeroTri],
                    aNumeroTri,
                  );
                },
              };
            },
            getClassTriGridTitre(aNumeroColonne) {
              return aInstance._triCourant.colonne.includes(aNumeroColonne)
                ? 'liste_gridTitre_cel-tri'
                : '';
            },
            getHintHtmlTitre: function (aLigne, aColonne) {
              if (
                aInstance.ListeTitres &&
                aInstance.ListeTitres[aLigne] &&
                aInstance.ListeTitres[aLigne][aColonne] &&
                aInstance.ListeTitres[aLigne][aColonne].titleHtml
              ) {
                const lTitle =
                  aInstance.ListeTitres[aLigne][aColonne].titleHtml;
                if (MethodesObjet_1.MethodesObjet.isFunction(lTitle)) {
                  return lTitle();
                }
                return lTitle;
              }
              return '';
            },
            nodeSurLigneCreationUnique(aLigne) {
              $(this.node).on({
                click: function () {
                  aInstance._surLigneCreationUnique(true, aLigne);
                },
                keyup: function (aEvent) {
                  aInstance._surLigneCreationUnique(
                    false,
                    aLigne,
                    ToucheClavier_1.ToucheClavierUtil.estEventRetourChariot(
                      aEvent,
                    ) ||
                      ToucheClavier_1.ToucheClavierUtil.estEventEdition(aEvent),
                  );
                },
              });
            },
            eventSurLigneCreation: function (aEvent) {
              switch (aEvent.type) {
                case 'click':
                  aInstance.surCreationDeb(false);
                  break;
                case 'keyup':
                  if (
                    ToucheClavier_1.ToucheClavierUtil.estEventRetourChariot(
                      aEvent,
                    ) ||
                    ToucheClavier_1.ToucheClavierUtil.estEventEdition(aEvent)
                  ) {
                    aInstance.surCreationDeb(false);
                  }
                  break;
              }
            },
            nodeAfterCellule() {
              ObjetHtml_1.GHtml.getElementsFocusablesDElement(this.node, {
                ignoreAriaHidden: false,
              }).forEach((aNode) => {
                aNode.setAttribute('tabindex', '-1');
              });
            },
            dragFantomeCellule(aLigne, aColonne) {
              return {
                getIdZone() {
                  return aInstance.idZone;
                },
                start(aParamsDrag) {
                  if (aInstance._cache.finEditionCreation) {
                    aInstance._cache.finEditionCreation();
                    return false;
                  }
                  const lParamsCellule = aInstance._getParamsCellule(
                    aColonne,
                    aLigne,
                    { draggable: true },
                  );
                  Object.assign(
                    aParamsDrag.data,
                    {
                      estObjetListe: true,
                      instance: aInstance,
                      avecSuppression:
                        aInstance._avecSuppressionSelectionCourante(
                          lParamsCellule.ligne,
                          lParamsCellule.colonne,
                        ),
                      libelle: aInstance._getLibelleDraggable(lParamsCellule),
                    },
                    lParamsCellule,
                  );
                },
                drag: function (aParamsDrag) {
                  const lData = aParamsDrag.data;
                  lData.horsZoneSuppression = false;
                  if (
                    !lData.droppableCourant &&
                    lData.avecSuppression &&
                    aParamsDrag.horsZone
                  ) {
                    lData.horsZoneSuppression = true;
                  }
                },
                stop: function (aParamsDrag) {
                  const lData = aParamsDrag.data;
                  if (lData) {
                    if (lData.horsZoneSuppression) {
                      aInstance._surSuppression();
                    } else {
                      ObjetHtml_1.GHtml.setFocus(
                        aInstance.getIdCellule(
                          lData.colonne,
                          lData.ligne,
                          true,
                        ),
                      );
                    }
                  }
                },
              };
            },
            dropCelluleDroppable(aLigne, aColonne) {
              const lParamsCellule = aInstance._getParamsCellule(-1, aLigne);
              return {
                accept(aParamsDrop) {
                  const lData = aParamsDrop.drag.data;
                  const lElement = $(aParamsDrop.drag.node);
                  return (
                    lData &&
                    aInstance.Donnees.autoriserDeplacementElementSurLigne(
                      lParamsCellule,
                      Object.assign({ jDraggable: lElement }, lData),
                    )
                  );
                },
                over(aParamsDrop) {
                  const lData = aParamsDrop.drag.data;
                  lData.getHtmlDetailsDraggable = function () {
                    return aInstance.Donnees.getHtmlDetailsDraggableOver(
                      lParamsCellule,
                      lData,
                    );
                  };
                  lData.celluleDroppableHover = {
                    ligne: aLigne,
                    colonne: aColonne,
                  };
                  lData.droppableCourant = aParamsDrop.drop.node;
                  lData.controleurDraggable.$refreshSelf();
                  aInstance._parcourirCellulesVoileBleu(
                    lParamsCellule,
                    (aNode) => {
                      $(aNode).addClass('voileDropCellule');
                    },
                  );
                  const lEstPremiereLigne =
                    lParamsCellule.ligne === aInstance._cache.lignesVisibles[0];
                  const lEstDerniereLigne =
                    lParamsCellule.ligne ===
                    aInstance._cache.lignesVisibles[
                      aInstance._cache.lignesVisibles.length - 1
                    ];
                  if (aInstance.Donnees.options.dragNDropLigneInsertion) {
                    const lJConteneur = $(
                      '#' + aInstance.ids.zoneFils.escapeJQ(),
                    );
                    const lRect = ObjetPosition_1.GPosition.getClientRect(
                      aParamsDrop.drop.node,
                    );
                    let lTop =
                      lRect.top +
                      (lParamsCellule.ligne < lData.ligne ? -1 : lRect.height) -
                      ObjetPosition_1.GPosition.getClientRect(
                        lJConteneur.get(0),
                      ).top -
                      1;
                    if (lEstPremiereLigne) {
                      lTop += 2;
                    } else if (lEstDerniereLigne) {
                      lTop += -2;
                    }
                    lJConteneur.ieHtmlAppend(
                      [
                        IE.jsx.str(
                          'div',
                          {
                            id:
                              aInstance.ids.dragInsertion +
                              lParamsCellule.ligne,
                            class: 'liste_dragInsertion',
                            style: { top: lTop },
                          },
                          IE.jsx.str('div', {
                            class: 'liste_dragInsertion_fg',
                          }),
                          IE.jsx.str('div', {
                            class: 'liste_dragInsertion_fd',
                          }),
                        ),
                      ].join(''),
                    );
                  }
                  const lIgnorerScroll =
                    (lEstPremiereLigne &&
                      aInstance.ScrollV.estScrollSurBorne(true)) ||
                    (lEstDerniereLigne &&
                      aInstance.ScrollV.estScrollSurBorne(false));
                  if (!lIgnorerScroll) {
                    setTimeout(() => {
                      aInstance.scrollTo({
                        ligne: lParamsCellule.ligne,
                        avecScrollTopLigne: false,
                        ecartForce: 10,
                      });
                    }, 50);
                  }
                },
                out(aParamsDrop) {
                  const lData = aParamsDrop.drag.data;
                  let lLigneDroppableChange = true;
                  if (
                    lData.celluleDroppableHover &&
                    lData.celluleDroppableHover.ligne === aLigne
                  ) {
                    if (lData.celluleDroppableHover.colonne === aColonne) {
                      lData.celluleDroppableHover = null;
                    } else {
                      lLigneDroppableChange = false;
                    }
                  }
                  if (lLigneDroppableChange) {
                    aInstance._parcourirCellulesVoileBleu(
                      lParamsCellule,
                      (aNode) => {
                        $(aNode).removeClass('voileDropCellule');
                      },
                    );
                    if (aInstance.Donnees.options.dragNDropLigneInsertion) {
                      $(
                        '#' +
                          (
                            aInstance.ids.dragInsertion + lParamsCellule.ligne
                          ).escapeJQ(),
                      ).remove();
                    }
                    if (lData.droppableCourant === aParamsDrop.drop.node) {
                      lData.droppableCourant = null;
                      lData.getHtmlDetailsDraggable = null;
                    }
                    lData.controleurDraggable.$refreshSelf();
                  }
                },
                drop(aParamsDrop) {
                  const lData = aParamsDrop.drag.data;
                  aInstance._parcourirCellulesVoileBleu(
                    lParamsCellule,
                    (aNode) => {
                      $(aNode).removeClass('voileDropCellule');
                    },
                  );
                  if (lData) {
                    if (aInstance.Donnees.options.dragNDropLigneInsertion) {
                      $(
                        '#' +
                          (
                            aInstance.ids.dragInsertion + lParamsCellule.ligne
                          ).escapeJQ(),
                      ).remove();
                    }
                    const lElement = $(aParamsDrop.drag.node);
                    aInstance._surDeplacementLigneSurAutreLigne(
                      lParamsCellule,
                      Object.assign({ jDraggable: lElement }, lData),
                    );
                  }
                },
              };
            },
          },
        });
      }
      _ouvrirFenetreParametrageColonnes() {
        ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_ParametrageColonnesListe_1.ObjetFenetre_ParametrageColonnesListe,
          {
            pere: this,
            evenement(aNumeroBouton, aParams) {
              if (aParams.bouton.valider) {
                this._cache.parametrageColonnes = aParams.parametrage;
                this._options.gestionModificationColonnes.setColonnes(
                  aParams.parametrage,
                );
                this._cache.calculsPreRenduAFaire = true;
                this._cache.calculsTailleColonnesAFaire = true;
                this._actualiser({
                  conserverSelection: true,
                  sansTriDonnees: true,
                });
              }
            },
          },
          {
            titre: ObjetTraduction_1.GTraductions.getValeur(
              'liste.PersonnaliserListe',
            ),
            classObjetListe: ObjetListeEspace,
          },
        ).setDonnees({
          declarationColonnes: this._options.colonnes,
          parametrageColonnes: this._cache.parametrageColonnes,
          tableauColonnesCachees: this._cache.tableauColonnesCacheesOriginal,
        });
      }
      _gererModificationsColonnes() {
        this._cache.listeCorrespondancesColonnes = [];
        if (!this._options.gestionModificationColonnes) {
          this._cache.colonnes.listeTailles.forEach((a, aIndex) => {
            this._cache.listeCorrespondancesColonnes[aIndex] = aIndex;
          });
          return;
        }
        if (
          !MethodesObjet_1.MethodesObjet.isFunction(
            this._options.gestionModificationColonnes.getColonnes,
          ) ||
          !Array.isArray(this._options.colonnes)
        ) {
          return;
        }
        this._cache.parametrageColonnes =
          this._options.gestionModificationColonnes.getColonnes();
        if (
          !this._cache.parametrageColonnes ||
          !this._cache.parametrageColonnes.length
        ) {
          this._cache.parametrageColonnes = [];
          this._cache.colonnes.listeIds.forEach((aId) => {
            this._cache.parametrageColonnes.push({ id: aId });
          });
        }
        const lOriginalIds = [];
        this._options.colonnes.forEach((aCol, aIndex) => {
          this._cache.listeCorrespondancesColonnes[aIndex] = -1;
          lOriginalIds.push(aCol.id);
        });
        this._cache.colonnes.listeIds = [];
        this._cache.colonnes.listeTailles = [];
        this._cache.declarationsColonnes = [];
        this._cache.parametrageColonnes.forEach((aColonne) => {
          if (!aColonne) {
            return;
          }
          const lId = aColonne.id;
          const lDecl = this._cache.declColonnesByIds[lId];
          if (!lDecl) {
            return;
          }
          if (aColonne.visible === false) {
            return;
          }
          this._cache.declarationsColonnes.push(lDecl);
          const lNumeroColonne = this._cache.declarationsColonnes.length - 1;
          this._cache.colonnes.listeIds[lNumeroColonne] = lDecl.id;
          this._cache.colonnes.listeTailles[lNumeroColonne] = lDecl.taille || 0;
          this._cache.listeCorrespondancesColonnes[
            lOriginalIds.indexOf(lDecl.id)
          ] = lNumeroColonne;
        });
        if (
          this._cache.declarationsColonnes.length === 0 &&
          this._options.colonnes &&
          this._options.colonnes.length > 0
        ) {
          IE.log.addLog('Aucune colonne visible dans le parametrage');
          const lDecl =
            this._cache.declColonnesByIds[this._options.colonnes[0]];
          this._cache.declarationsColonnes.push(lDecl);
          this._cache.colonnes.listeIds[0] = lDecl.id;
          this._cache.colonnes.listeTailles[0] = lDecl.taille || 0;
          this._cache.listeCorrespondancesColonnes[0] = 0;
        }
      }
      _preparerBoutons() {
        super._preparerBoutons({
          createExportCSV: (aBouton) => {
            if (!ObjetSupport_1.Support.supportBlob) {
              IE.log.addLog(
                '_ObjetListe : bouton exportCSV sans support javascript du Blob => bouton ignoré',
              );
              return;
            }
            aBouton.class = 'icon_copier_liste';
            aBouton.title =
              ObjetTraduction_1.GTraductions.getValeur('liste.HintCopier');
            if (
              !MethodesObjet_1.MethodesObjet.isFunction(aBouton.getNomFichier)
            ) {
              aBouton.getNomFichier = function () {
                return ObjetTraduction_1.GTraductions.getValeur(
                  'liste.TitreExportCSV',
                );
              };
            }
            aBouton.getDisabled = function () {
              return false;
            };
            aBouton.event = (aParam) => {
              ExportBlob_1.ExportBlob.create(
                this._construireCopieCSV(),
                aParam.bouton.getNomFichier(),
                'text/csv',
              );
            };
          },
        });
        this.ScrollV.tailleScrollPersonnalisee =
          this._avecBoutonsListeHautScroll();
      }
      _backupScroll(aParams) {
        if (!aParams.conserverPositionScroll) {
          return { scrollTop: 0, scrollLeft: 0 };
        }
        let lScrollTop = 0;
        let lScrollLeft = 0;
        if (this._cache.avecScrollHorizontal) {
          lScrollLeft = $(
            '#' + this.ScrollH.getIdZone(EGenreZoneScroll.contenu).escapeJQ(),
          ).scrollLeft();
        }
        if (this.ScrollV.avecScrollVisible()) {
          lScrollTop = ObjetPosition_1.GPosition.getScrollTop(
            this.ScrollV.getIdZone(EGenreZoneScroll.contenu),
          );
        } else {
          const lElementScroll = ObjetHtml_1.GHtml.getParentScrollable(
            this.Nom,
          );
          if (lElementScroll) {
            return {
              elementScrollV: lElementScroll,
              scrollTop: lElementScroll.scrollTop,
              scrollLeft: lScrollLeft,
            };
          }
        }
        return {
          elementScrollV: ObjetHtml_1.GHtml.getElement(
            this.ScrollV.getIdZone(EGenreZoneScroll.contenu),
          ),
          estObjetScroll: true,
          scrollTop: lScrollTop,
          scrollLeft: lScrollLeft,
        };
      }
      _setScroll(aBackupScroll, aSurResizeHeightContenu) {
        let lUniquementActualisationHeightContenu = false;
        if (aSurResizeHeightContenu) {
          lUniquementActualisationHeightContenu =
            this.ScrollV.surModificationHeightContenu();
        }
        if (!lUniquementActualisationHeightContenu) {
          this.ScrollV.avecScrollEnTactile = this._options.avecScrollEnTactileV;
          this.ScrollV.setDonnees(
            EGenreZoneScroll.contenu,
            EGenreZoneScroll.contenuFixe,
            EGenreZoneScroll.contenuFixeFin,
          );
          if (this._cache.avecScrollHorizontal) {
            this.ScrollH.avecScrollEnTactile =
              this._options.avecScrollEnTactileH;
            this.ScrollH.setDonnees(
              EGenreZoneScroll.contenu,
              EGenreZoneScroll.titre,
              EGenreZoneScroll.tri,
              EGenreZoneScroll.total,
            );
          } else {
            this.ScrollH.setDonnees(null);
          }
          if (aBackupScroll) {
            if (aBackupScroll.elementScrollV && !aBackupScroll.estObjetScroll) {
              aBackupScroll.elementScrollV.scrollTop = aBackupScroll.scrollTop;
            } else {
              this.ScrollV.scrollTo(aBackupScroll.scrollTop);
            }
            if (this._cache.avecScrollHorizontal) {
              this.ScrollH.scrollTo(aBackupScroll.scrollLeft);
            }
          }
        }
        if (this._options.skin === _ObjetListe_1.ObjetListe.skin.flatDesign) {
          const lClassesOmbre = [];
          if (!this._cache.ombreTopForce) {
            lClassesOmbre.push('ombre-top');
          }
          if (!this._options.forcerOmbreScrollBottom) {
            lClassesOmbre.push('ombre-bottom');
          }
          if (lClassesOmbre.length > 0) {
            if (this.ScrollV.avecScrollVisible()) {
              $(`#${this.idZone.escapeJQ()}`).addClass(lClassesOmbre.join(' '));
            } else {
              $(`#${this.idZone.escapeJQ()}`).removeClass(
                lClassesOmbre.join(' '),
              );
            }
          }
        }
        this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
          const lJContenu = $(
            `#${this.ScrollV.getIdContenu(aInfosZoneColonnes.idScrollContenu).escapeJQ()}`,
          );
          const lJOmbres = $(
            `#${(this.ids.contenu + aInfosZoneColonnes.indiceBloc).escapeJQ()} > div.conteneur-ombre-zone > div.ombre`,
          );
          if (lJOmbres.length > 0 && lJContenu.length === 1) {
            lJOmbres.height(lJContenu.height()).css({ bottom: 'auto' });
          }
        });
      }
      _construireContenuRange(aInfosColonnes, aIndiceRange) {
        return this.construireContenuListeInterneLignes(
          aInfosColonnes,
          aIndiceRange,
        );
      }
      _getTabElementsPourRsizeObserver() {
        return [
          EGenreZoneScroll.contenu,
          EGenreZoneScroll.contenuFixe,
          EGenreZoneScroll.contenuFixeFin,
        ].map((aGenre) => {
          return ObjetHtml_1.GHtml.getElement(
            this.ScrollV.getIdContenu(aGenre),
          );
        });
      }
      _getInfosZonesColonnes(aCache) {
        function _addZone(aInfos) {
          const lInfos = Object.assign(
            {
              dernierBloc: true,
              indiceColonneDebut: 0,
              indiceColonneFin: 0,
              indiceBloc: aCache.infosZonesColonnes.length,
              idScrollTri: EGenreZoneScroll.tri,
              idScrollTitre: EGenreZoneScroll.titre,
              idScrollContenu: EGenreZoneScroll.contenu,
              idScrollTotal: EGenreZoneScroll.total,
              estBlocFixe: false,
              gabaritColonnesTitre: [],
              colonnesVisibles: [],
              largeurBloc: 0,
              indiceColVisibleDebut: 0,
            },
            aInfos,
          );
          for (
            let lColonne = lInfos.indiceColonneDebut;
            lColonne <= lInfos.indiceColonneFin;
            lColonne++
          ) {
            if (!aCache.tableauColonnesCachees[lColonne]) {
              lInfos.colonnesVisibles.push(lColonne);
            }
          }
          if (lInfos.colonnesVisibles.length > 0) {
            lInfos.indiceColonneDebut = lInfos.colonnesVisibles[0];
            lInfos.indiceColonneFin =
              lInfos.colonnesVisibles[lInfos.colonnesVisibles.length - 1];
            if (aCache.infosZonesColonnes.length > 0) {
              const lBlocPrec =
                aCache.infosZonesColonnes[aCache.infosZonesColonnes.length - 1];
              if (lBlocPrec) {
                lBlocPrec.dernierBloc = false;
                lInfos.indiceColVisibleDebut =
                  lBlocPrec.indiceColVisibleDebut +
                  lBlocPrec.colonnesVisibles.length;
              }
            }
            aCache.infosZonesColonnes.push(lInfos);
            return lInfos;
          }
          return null;
        }
        function _rechercheColonneVisible(aNumeroColonne, aRechercheAvant) {
          let lNumeroColonne = aNumeroColonne;
          while (
            lNumeroColonne >= 0 &&
            lNumeroColonne < aCache.tableauColonnesCachees.length
          ) {
            if (!aCache.tableauColonnesCachees[lNumeroColonne]) {
              return lNumeroColonne;
            }
            lNumeroColonne += aRechercheAvant ? -1 : 1;
          }
          return -1;
        }
        aCache.infosZonesColonnes = [];
        aCache.avecScrollHorizontal =
          this._options.scrollHorizontal !== false &&
          (!GNavigateur.isLayoutTactile || this._options.avecScrollEnTactileH);
        aCache.avecScrollHMultiZonePrevu =
          (!GNavigateur.isLayoutTactile ||
            this._options.avecScrollEnTactileH) &&
          this._options.scrollHorizontal &&
          this._options.scrollHorizontal !== true;
        if (!this.ListeTailles) {
          return;
        }
        let lDerniereColonneFixe = -1;
        let lColonneDebutFixeFin = this.ListeTailles.length - 1;
        let lAvecBlocFixeFin = false;
        let lColScrollDebut = null;
        let lColScrollFin = null;
        if (aCache.avecScrollHorizontal) {
          let lNumeroColonneAvecScroll = 0;
          let lNumeroColonneFinScroll = this.ListeTailles.length - 1;
          lColScrollDebut = this._options.scrollHorizontal;
          if (typeof this._options.scrollHorizontal === 'object') {
            if (this._options.scrollHorizontal.debut !== undefined) {
              lColScrollDebut = this._options.scrollHorizontal.debut;
            }
            if (this._options.scrollHorizontal.fin !== undefined) {
              lColScrollFin = this._options.scrollHorizontal.fin;
            }
          }
          if (MethodesObjet_1.MethodesObjet.isString(lColScrollDebut)) {
            lNumeroColonneAvecScroll =
              this.getNumeroColonneDIdColonne(lColScrollDebut);
          } else if (
            MethodesObjet_1.MethodesObjet.isNumber(lColScrollDebut) &&
            lColScrollDebut > 0
          ) {
            lNumeroColonneAvecScroll = lColScrollDebut;
          }
          if (lNumeroColonneAvecScroll > 0) {
            lNumeroColonneAvecScroll = _rechercheColonneVisible(
              lNumeroColonneAvecScroll,
              false,
            );
          }
          if (MethodesObjet_1.MethodesObjet.isString(lColScrollFin)) {
            lNumeroColonneFinScroll =
              this.getNumeroColonneDIdColonne(lColScrollFin);
          } else if (
            MethodesObjet_1.MethodesObjet.isNumber(lColScrollFin) &&
            lColScrollFin > 0
          ) {
            lNumeroColonneFinScroll = lColScrollFin;
          }
          if (lNumeroColonneFinScroll > 0) {
            lNumeroColonneFinScroll = _rechercheColonneVisible(
              lNumeroColonneFinScroll,
              true,
            );
          }
          if (lNumeroColonneAvecScroll > 0) {
            lDerniereColonneFixe = lNumeroColonneAvecScroll - 1;
          }
          if (
            lNumeroColonneFinScroll > 1 &&
            lNumeroColonneFinScroll < this.ListeTailles.length - 1 &&
            lNumeroColonneFinScroll > lNumeroColonneAvecScroll
          ) {
            lColonneDebutFixeFin = lNumeroColonneFinScroll;
          }
        }
        if (
          lColonneDebutFixeFin - lDerniereColonneFixe < 2 ||
          lDerniereColonneFixe >= this.ListeTailles.length - 1
        ) {
          aCache.avecScrollHorizontal = false;
        }
        lAvecBlocFixeFin = lColonneDebutFixeFin < this.ListeTailles.length - 1;
        if (
          !aCache.avecScrollHorizontal ||
          (lDerniereColonneFixe < 0 && !lAvecBlocFixeFin)
        ) {
          _addZone({
            indiceColonneDebut: 0,
            indiceColonneFin: this.ListeTailles.length - 1,
          });
          return;
        }
        if (lDerniereColonneFixe >= 0) {
          _addZone({
            estBlocFixe: true,
            indiceColonneDebut: 0,
            indiceColonneFin: lDerniereColonneFixe,
            idScrollTri: EGenreZoneScroll.triFixe,
            idScrollTitre: EGenreZoneScroll.titreFixe,
            idScrollContenu: EGenreZoneScroll.contenuFixe,
            idScrollTotal: EGenreZoneScroll.totalFixe,
          });
        }
        _addZone({
          indiceColonneDebut: lDerniereColonneFixe + 1,
          indiceColonneFin: lColonneDebutFixeFin,
        });
        if (lAvecBlocFixeFin) {
          _addZone({
            estBlocFixe: true,
            estBlocFixeDroite: true,
            indiceColonneDebut: lColonneDebutFixeFin + 1,
            indiceColonneFin: this.ListeTailles.length - 1,
            idScrollTri: EGenreZoneScroll.triFixeFin,
            idScrollTitre: EGenreZoneScroll.titreFixeFin,
            idScrollContenu: EGenreZoneScroll.contenuFixeFin,
            idScrollTotal: EGenreZoneScroll.totalFixeFin,
          });
        }
      }
      _construireAffichage() {
        let lLargeurTable;
        if (!this._cache.largeurTotalCalcule) {
          lLargeurTable = '100%';
        } else {
          lLargeurTable = this._getLargeurConteneur() + 'px';
        }
        const lEstTreeGrid = this._estRoleTreeGrid();
        return IE.jsx.str(
          'div',
          {
            'ie-node': 'liste.getNodeListe',
            'ie-nodeafter': 'liste.getNodeAfterListe',
            class: 'ObjetListe',
            role: 'group',
            'ie-class': 'liste.getClassListe',
            'ie-attr': 'liste.getAttrListe',
            style: this._cache.listeNonInitialisee
              ? ' visibility:hidden'
              : false,
          },
          (T) => {
            const lHtmlEntete = this._construireBoutonsEntete(lLargeurTable);
            if (lHtmlEntete) {
              T.push(IE.jsx.str('div', { role: 'presentation' }, lHtmlEntete));
            }
            if (lEstTreeGrid) {
              T.push(
                IE.jsx.str(
                  'span',
                  { class: 'sr-only' },
                  ObjetTraduction_1.GTraductions.getValeur(
                    'liste.wai.DemarrerNavigation',
                  ),
                ),
              );
            }
            this._cache.ombreTopForce =
              this._options.skin === _ObjetListe_1.ObjetListe.skin.flatDesign &&
              !!(lHtmlEntete || this._options.forcerOmbreScrollTop);
            const lHtmlPiedDeListe = this._options.piedDeListe
              ? IE.jsx.str('div', {
                  id: this.idPiedDeListe,
                  class: 'liste-pied',
                })
              : '';
            T.push(
              IE.jsx.str(
                'div',
                {
                  id: this.idZone,
                  class: [
                    'liste_zone conteneur-ombre-zone ',
                    this._cache.ombreTopForce ? ' ombre-top' : '',
                    this._options.forcerOmbreScrollBottom
                      ? ' ombre-bottom'
                      : '',
                  ],
                  style: `width:${lLargeurTable}`,
                },
                () => {
                  let lResultZone = IE.jsx.str(
                    'div',
                    {
                      id: this.ids.zoneFils,
                      class: 'liste_zoneFils NoWrap',
                      role: lEstTreeGrid ? 'presentation' : 'tree',
                    },
                    (aTabGrid) => {
                      const lAvecTri = this.avecTriColonne();
                      const lAvecGridTotal = this._avecLigneTotal();
                      if (lEstTreeGrid) {
                        aTabGrid.push(
                          IE.jsx.str(
                            'div',
                            {
                              class: 'sr-only',
                              role: lEstTreeGrid ? 'treegrid' : 'tree',
                              'aria-rowcount': lEstTreeGrid
                                ? this._cache.lignesVisibles.length
                                : false,
                              'aria-describedby': this.ids.WAIDescribeTreeGrid,
                            },
                            this.ListeTitres
                              ? IE.jsx.str('div', {
                                  role: 'rowgroup',
                                  id: this.ids.WAIGrid + '_rowtitre',
                                })
                              : '',
                            lAvecTri
                              ? IE.jsx.str('div', {
                                  role: 'rowgroup',
                                  id: this.ids.WAIGrid + '_rowtri',
                                  'aria-describedby': this.ids.WAIDescribeTri,
                                })
                              : '',
                            IE.jsx.str('div', {
                              role: lEstTreeGrid ? 'rowgroup' : 'presentation',
                              id: this.ids.WAIGrid + '_rowcell',
                            }),
                          ),
                        );
                      }
                      const lTabTitre = [];
                      this._cache.infosZonesColonnes.forEach(
                        (aInfosZoneColonnes) => {
                          const lConstructionTitre = this._construireTitre(
                            aInfosZoneColonnes,
                            lAvecTri,
                          );
                          if (lConstructionTitre.html) {
                            lTabTitre.push(lConstructionTitre.html);
                          }
                        },
                      );
                      if (lTabTitre.length > 0) {
                        aTabGrid.push(
                          IE.jsx.str(
                            'div',
                            {
                              class: 'liste-heriar',
                              role: 'treegrid',
                              'aria-rowcount': '1',
                            },
                            lTabTitre.join(''),
                          ),
                        );
                      }
                      aTabGrid.push(
                        IE.jsx.str(
                          'div',
                          { class: 'liste-heriar', role: 'presentation' },
                          (aTab) => {
                            this._cache.infosZonesColonnes.forEach(
                              (aInfosZoneColonnes) => {
                                aTab.push(
                                  this._construireContenuListe(
                                    aInfosZoneColonnes,
                                  ),
                                );
                              },
                            );
                          },
                        ),
                      );
                      if (lAvecGridTotal) {
                        aTabGrid.push(
                          IE.jsx.str(
                            'div',
                            {
                              id: this.ids.WAIGrid + '_gridTotal',
                              class: 'sr-only',
                              role: 'treegrid',
                              'aria-rowcount':
                                this._getListeLignesTotal().count() +
                                (this.ListeTitres ? 1 : 0),
                              tabindex: '0',
                              'ie-node': 'liste.getNodeGridTotal',
                              'aria-describedby':
                                this.ids.WAIDescribeTreeGridTotal,
                            },
                            this.ListeTitres
                              ? IE.jsx.str('div', {
                                  role: 'rowgroup',
                                  id: this.ids.WAIGrid + 'total_rowtitre',
                                })
                              : '',
                            IE.jsx.str('div', {
                              role: 'rowgroup',
                              id: this.ids.WAIGrid + 'total_rowcell',
                            }),
                          ),
                        );
                        aTabGrid.push(
                          IE.jsx.str(
                            'div',
                            { class: 'liste-heriar', role: 'presentation' },
                            (aTab) => {
                              this._cache.infosZonesColonnes.forEach(
                                (aInfosZoneColonnes) => {
                                  aTab.push(
                                    this._construireLigneTotal(
                                      aInfosZoneColonnes,
                                    ),
                                  );
                                },
                              );
                            },
                          ),
                        );
                      }
                      let lAvecScrollH = false;
                      this._cache.infosZonesColonnes.forEach(
                        (aInfosZoneColonnes) => {
                          if (
                            !aInfosZoneColonnes.estBlocFixe &&
                            this._cache.avecScrollHorizontal &&
                            this._cache.reserverPlaceScrollHorizontal
                          ) {
                            lAvecScrollH = true;
                          }
                        },
                      );
                      if (lAvecScrollH) {
                        aTabGrid.push(
                          IE.jsx.str(
                            'div',
                            { class: 'liste-heriar', role: 'presentation' },
                            (aTab) => {
                              this._cache.infosZonesColonnes.forEach(
                                (aInfosZoneColonnes) => {
                                  if (aInfosZoneColonnes.estBlocFixe) {
                                    aTab.push(
                                      IE.jsx.str('div', {
                                        style: {
                                          width: aInfosZoneColonnes.largeurBloc,
                                        },
                                      }),
                                    );
                                  } else {
                                    aTab.push(
                                      IE.jsx.str('div', {
                                        id: this.ScrollH.getIdScroll(),
                                        role: 'presentation',
                                        style:
                                          ObjetStyle_1.GStyle.composeHeight(
                                            this.ScrollH.Largeur,
                                          ) +
                                          (this._options.borduresContenu_left >
                                            0 &&
                                          aInfosZoneColonnes.indiceBloc === 0
                                            ? 'padding-left:' +
                                              this._options
                                                .borduresContenu_left +
                                              'px;'
                                            : ''),
                                      }),
                                    );
                                  }
                                },
                              );
                            },
                          ),
                        );
                      }
                      if (
                        this._options.skin !==
                          _ObjetListe_1.ObjetListe.skin.flatDesign &&
                        lHtmlPiedDeListe
                      ) {
                        aTabGrid.push(lHtmlPiedDeListe);
                      }
                    },
                  );
                  lResultZone += IE.jsx.str(
                    'div',
                    {
                      class:
                        'liste_cont_btnscroll AlignementGauche InlineBlock AlignementHaut',
                    },
                    () => {
                      let lResult = '';
                      const lAvecBoutons = this._avecBoutonsListeHautScroll();
                      if (lAvecBoutons) {
                        lResult += IE.jsx.str(
                          'div',
                          { class: 'liste_btnsDroite' },
                          (aTab) => {
                            this._cache.boutons.forEach((aBouton, aIndex) => {
                              aTab.push(
                                IE.jsx.str(
                                  'div',
                                  {
                                    style:
                                      ObjetStyle_1.GStyle.composeWidth(
                                        this._options.tailleBoutons + 1,
                                      ) +
                                      ObjetStyle_1.GStyle.composeHeight(
                                        this._options.tailleBoutons + 1,
                                      ),
                                  },
                                  IE.jsx.str('ie-btnimage', {
                                    'ie-model': (0, jsx_1.jsxFuncAttr)(
                                      'liste.boutonListe',
                                      aIndex,
                                    ),
                                    title: aBouton.title || false,
                                    id: aBouton.id,
                                    class: ['btnImageIcon', aBouton.class],
                                  }),
                                ),
                              );
                            });
                          },
                        );
                      }
                      lResult += IE.jsx.str(
                        'div',
                        {
                          id: this.ScrollV.getIdScroll(),
                          class: 'AlignementBas',
                          style:
                            ObjetStyle_1.GStyle.composeWidth(
                              this.ScrollV.Largeur,
                            ) +
                            'min-height:' +
                            this.ScrollV.tailleMin +
                            'px;',
                        },
                        '\u00A0',
                      );
                      return lResult;
                    },
                  );
                  return lResultZone;
                },
              ),
            );
            T.push(this._construireTotalFD(false));
            if (
              this._options.skin === _ObjetListe_1.ObjetListe.skin.flatDesign &&
              lHtmlPiedDeListe
            ) {
              T.push(lHtmlPiedDeListe);
            }
            T.push(this.composeWAICommun());
          },
        );
      }
      avecTriColonne() {
        return this.Donnees && this.ListeTitres && !!this._cache.colonnesTri;
      }
      _getDessinCurseurTri(aParams) {
        const lParams = Object.assign(
          {
            triCroissant: true,
            tri: _ObjetListe_1.NSListe.FlecheTri.principal,
            width: this._options.widthTri,
            height: this._options.heightTri,
            top: 0,
            left: 0,
          },
          aParams,
        );
        if (lParams.tri === _ObjetListe_1.NSListe.FlecheTri.secondaire) {
          lParams.width += -2;
          lParams.height += -1;
        }
        const lWidth = lParams.width + lParams.left;
        const lHeight = lParams.height + lParams.top;
        return IE.jsx.str(
          'svg',
          {
            class: ['svg-tri', lParams.tri],
            width: lWidth + 'px',
            height: lHeight + 'px',
            xmlns: 'http://www.w3.org/2000/svg',
            role: 'presentation',
          },
          IE.jsx.str('polygon', {
            points: ObjetChaine_1.GChaine.format(
              !lParams.triCroissant
                ? '%4:s,%3:s %1:s,%3:s %2:s,%0:s'
                : '%4:s,%0:s %1:s,%0:s %2:s,%3:s',
              [
                lParams.height - 2 + lParams.top + 1 + 0.5,
                lParams.width - 2 + lParams.left + 1 + 0.5,
                (lParams.width - 2) / 2 + lParams.left + 1 + 0.5,
                lParams.top + 1 + 0.5,
                lParams.left + 1 + 0.5,
              ],
            ),
          }),
        );
      }
      _setStyleCellule(aId, aColonne, aLigne, aSelectionne, aCreation) {
        if (!aId) {
          return;
        }
        super._setStyleCellule(aId, aColonne, aLigne, aSelectionne, aCreation);
        if (
          this._options.avecCadreSelection ||
          this._options.ignorerCouleurInlineCellule
        ) {
          return;
        }
        let lJeuxCouleurs;
        if (aCreation && !aSelectionne) {
          lJeuxCouleurs = this._options.couleursListe.editable;
        } else {
          lJeuxCouleurs = this._getJeuxCouleur(
            this._getParamsCellule(aColonne, aLigne),
            aSelectionne,
          );
        }
        ObjetStyle_1.GStyle.setCouleur(
          aId,
          lJeuxCouleurs.getFond(false),
          lJeuxCouleurs.getTexte(false),
        );
      }
      _actualiserZones(aZonesActualisation, aParamsActualiser) {
        if (aZonesActualisation.contenu) {
          this._initCacheLignes(aParamsActualiser);
        }
        const lFunc = (aCallbackContenu, aCallbackTotal) => {
          this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
            if (aZonesActualisation.contenu) {
              $(
                ObjetHtml_1.GHtml.getElement(
                  this.getIdGridFocus(aInfosZoneColonnes.indiceBloc),
                ),
              ).remove();
              IEHtml_1.default.injectHTMLParams({
                element: ObjetHtml_1.GHtml.getElement(
                  this.ScrollV.getIdContenu(aInfosZoneColonnes.idScrollContenu),
                ),
                html: aCallbackContenu
                  ? aCallbackContenu(aInfosZoneColonnes)
                  : '',
                controleur: this.controleur,
                ignorerScroll: true,
              });
            }
            if (aZonesActualisation.total && this._avecLigneTotal()) {
              ObjetHtml_1.GHtml.setHtml(
                this.ScrollH.getIdZone(aInfosZoneColonnes.idScrollTotal),
                aCallbackTotal ? aCallbackTotal(aInfosZoneColonnes) : '',
                { controleur: this.controleur, ignorerScroll: true },
              );
            }
          });
        };
        lFunc();
        lFunc(
          (aInfosZoneColonnes) => {
            $(
              `#${this.ids.cadreSelection.escapeJQ() + aInfosZoneColonnes.indiceBloc}`,
            ).empty();
            return this.construireContenuListeInterne(aInfosZoneColonnes);
          },
          (aInfosZoneColonnes) =>
            this._construireContenuTotal(aInfosZoneColonnes).html,
        );
        this._controleHeightLigne();
      }
      _controleHeightLigne() {
        if (this._cache.infosZonesColonnes.length < 2) {
          return;
        }
        if (!this.Donnees || !this.ListeTailles) {
          return;
        }
        const lTabModif = [];
        const lRangeLignes = {
          debut: 0,
          fin: this._cache.lignesVisibles.length,
        };
        if (this._cache.refresh.avecConstructionDynamiqueContenu) {
          const lCacheRef = this._cache.refresh;
          lRangeLignes.debut =
            lCacheRef.structure[lCacheRef.mapRangesExist.min].deb;
          lRangeLignes.fin =
            lCacheRef.structure[lCacheRef.mapRangesExist.max].fin + 1;
        }
        let iIndice,
          lNumeroLigne,
          lHeightMinLigne,
          lHeightMaxLigne,
          lHeightIds,
          lId;
        for (
          iIndice = lRangeLignes.debut;
          iIndice < lRangeLignes.fin;
          iIndice++
        ) {
          lNumeroLigne = this._cache.lignesVisibles[iIndice];
          lHeightMinLigne = Number.MAX_VALUE;
          lHeightMaxLigne = -1;
          lHeightIds = {};
          this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
            lId = this.getIdCellule(
              aInfosZoneColonnes.colonnesVisibles[0],
              lNumeroLigne,
            );
            lHeightIds[lId] = $(
              ObjetHtml_1.GHtml.getElement(
                this.getIdCellule(
                  aInfosZoneColonnes.colonnesVisibles[0],
                  lNumeroLigne,
                ),
              ),
            ).height();
            lHeightMinLigne = Math.min(lHeightIds[lId], lHeightMinLigne);
            lHeightMaxLigne = Math.max(lHeightIds[lId], lHeightMaxLigne);
          });
          if (lHeightMinLigne < lHeightMaxLigne) {
            for (lId in lHeightIds) {
              if (lHeightIds[lId] < lHeightMaxLigne) {
                lTabModif.push({ id: lId + '_div', height: lHeightMaxLigne });
              }
            }
          }
          lHeightIds = null;
        }
        lTabModif.forEach((aElement) => {
          ObjetPosition_1.GPosition.setHeight(aElement.id, aElement.height);
        });
      }
      _entrerDateCalendrier(aParams) {
        this.fenetreDate = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_Date_1.ObjetFenetre_Date,
          {
            pere: this,
            evenement: this._evenementFenetreDate.bind(this, aParams),
          },
        );
        this.fenetreDate.setOptionsFenetre({
          callbackApresFermer: () => {
            delete this.fenetreDate;
          },
        });
        this.Donnees._initialiserObjetGraphique(aParams, this.fenetreDate);
        this.Donnees._setDonneesObjetGraphique(aParams, this.fenetreDate);
        this.fenetreDate.positionnerSousId(this.IdCellule);
      }
      _initStructureDynamique() {
        const lCacheRef = this._cache.refresh;
        if (!lCacheRef.avecConstructionDynamiqueContenu) {
          return;
        }
        let lNbLignesRestantes = this._cache.lignesVisibles.length;
        const lRangeLignes = {
          debut: 0,
          fin: this._cache.lignesVisibles.length,
        };
        let lLigneDebut = 0;
        while (lNbLignesRestantes > 0) {
          let lNbLignes =
            lNbLignesRestantes < lCacheRef.nbLignes
              ? lNbLignesRestantes
              : lCacheRef.nbLignes;
          let iIndiceLigne = lLigneDebut;
          while (
            iIndiceLigne <= lLigneDebut + lNbLignes - 1 &&
            iIndiceLigne < this._cache.lignesVisibles.length
          ) {
            const lNumeroLigne = this._cache.lignesVisibles[iIndiceLigne];
            this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
              const lFusions = this._getFusionColonnesCelluleDeZone(
                lNumeroLigne,
                aInfosZoneColonnes,
              );
              aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
                const lParamsCellule = this._getParamsCellule(
                  aNumeroColonne,
                  lNumeroLigne,
                  {
                    celluleLignePrecedente:
                      lNumeroLigne > 0
                        ? this._getParamsCellule(
                            aNumeroColonne,
                            this._cache.lignesVisibles[iIndiceLigne - 1],
                          )
                        : null,
                    celluleLigneSuivante:
                      iIndiceLigne + 1 < lRangeLignes.fin
                        ? this._getParamsCellule(
                            aNumeroColonne,
                            this._cache.lignesVisibles[iIndiceLigne + 1],
                          )
                        : null,
                  },
                );
                const lNombreLignesEnFusion =
                  this._chercherLignesFusionVertical(
                    lParamsCellule,
                    iIndiceLigne,
                    lRangeLignes,
                    lFusions,
                    aInfosZoneColonnes,
                  );
                if (lNombreLignesEnFusion > 1) {
                  lNbLignes = Math.min(
                    Math.max(
                      lNbLignes,
                      iIndiceLigne + lNombreLignesEnFusion - lLigneDebut,
                    ),
                    lNbLignesRestantes,
                  );
                }
              });
            });
            iIndiceLigne += 1;
          }
          lCacheRef.structure.push({
            deb: lLigneDebut,
            fin: lLigneDebut + lNbLignes - 1,
            nbLignes: lNbLignes,
            height: -1,
          });
          lLigneDebut += lNbLignes;
          lNbLignesRestantes = Math.max(0, lNbLignesRestantes - lNbLignes);
        }
      }
      _getLibelleDraggable(aParamsCellule) {
        let lLibelle = this.Donnees.getLibelleDraggable(aParamsCellule);
        if (!lLibelle) {
          const lEstColonneAutorisee = (aParams) => {
            const lType = this.Donnees.getTypeValeur(aParams);
            return (
              [
                ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche,
                ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule
                  .CocheDeploiement,
              ].indexOf(lType) < 0
            );
          };
          let lColonne = 0;
          if (
            this.Donnees.selectionParCellule(
              aParamsCellule.colonne,
              aParamsCellule.article,
            )
          ) {
            lColonne = aParamsCellule.colonne;
          } else if (this.ListeCreations && this.ListeCreations.length > 0) {
            lColonne = this.ListeCreations[0];
          }
          const lParams = this._getParamsCellule(
            lColonne,
            aParamsCellule.ligne,
            { surSuppression: true },
          );
          if (lEstColonneAutorisee(lParams)) {
            lLibelle = this.Donnees._getValeur(lParams);
          }
          if (!lLibelle) {
            this._cache.infosZonesColonnes.every((aInfosZoneColonnes) => {
              return aInfosZoneColonnes.colonnesVisibles.every(
                (aNumeroColonne) => {
                  const lParams = this._getParamsCellule(
                    aNumeroColonne,
                    aParamsCellule.ligne,
                    { surSuppression: true },
                  );
                  if (lEstColonneAutorisee(lParams)) {
                    lLibelle = this.Donnees._getValeur(lParams);
                  }
                  return !lLibelle;
                },
              );
            });
          }
        }
        if (!lLibelle) {
          lLibelle = '&nbsp;';
        }
        return lLibelle;
      }
      _eventKeyDownApplication(aEvent) {
        if (this._cache.rolloverVisible && !aEvent.ctrlKey) {
          this._gererRollover(false);
        } else if (
          !this._cache.rolloverVisible &&
          aEvent.ctrlKey &&
          !this._cache.mouseOUTListe &&
          this._avecRollover() &&
          MethodesObjet_1.MethodesObjet.isNumber(GNavigateur.pointerX) &&
          MethodesObjet_1.MethodesObjet.isNumber(GNavigateur.pointerY)
        ) {
          let lElement = document.elementFromPoint(
            GNavigateur.pointerX,
            GNavigateur.pointerY,
          );
          if (!lElement) {
            return;
          }
          let lJElement = $(lElement);
          let lInfos = null;
          while (
            lJElement &&
            lJElement.length > 0 &&
            lJElement.parents(
              '#' +
                this.ScrollV.getIdContenu(EGenreZoneScroll.contenu).escapeJQ(),
            ).length > 0
          ) {
            lElement = lJElement.get(0);
            if (
              lElement &&
              lElement.nodeName &&
              lElement.nodeName.toLowerCase() === 'td'
            ) {
              lInfos = this._extraireInfosId(lElement.id);
              if (lInfos) {
                break;
              }
            }
            lJElement = lJElement.parent();
          }
          if (lInfos) {
            this._gererRollover(true, lElement, lInfos);
          }
        }
      }
      _getColonneDePositionEvent(aEvent, aNode, aInfosZonesColonnes) {
        return this._getColonneDePositionLeft(
          ObjetPosition_1.GPosition.getPositionEventJQuery(aEvent).x,
          aNode,
          aInfosZonesColonnes,
        );
      }
      _getColonneDePositionLeft(aPosleft, aNode, aInfosZonesColonnes) {
        if (!MethodesObjet_1.MethodesObjet.isNumber(aPosleft)) {
          return -1;
        }
        let lNumeroColonne = -1;
        const lLeftBorne = Math.max(0, aPosleft - $(aNode).offset().left);
        aInfosZonesColonnes.gabaritColonnesTitre.every((aPos, aIndex) => {
          if (aPos && aPos.left >= 0) {
            if (aPos.left <= lLeftBorne) {
              lNumeroColonne = aIndex;
              return aPos.left + aPos.width <= lLeftBorne;
            }
          }
        });
        return lNumeroColonne;
      }
      _nodeTableTitrePourTri(aNode, aInfosZonesColonnes) {
        this._cache.survoleTitreTriVisible = false;
        const lHeightNode = ObjetPosition_1.GPosition.getHeight(aNode);
        $(
          '#' +
            (
              this.ScrollH.getIdZone(aInfosZonesColonnes.idScrollTri) +
              '_conteneur'
            ).escapeJQ(),
        ).css(
          'top',
          lHeightNode - Math.round(this._options.heightTri) + 1 + 'px',
        );
        const lIdSurvol =
            this.ids.survolTitre.escapeJQ() + aInfosZonesColonnes.indiceBloc,
          lIdCurseurTriSurvol =
            this.ids.curseurTriSurvol.escapeJQ() +
            aInfosZonesColonnes.indiceBloc;
        $('#' + lIdSurvol).height(lHeightNode);
        $(aNode).on(
          {
            'click contextmenu': function (aEvent) {
              aEvent.stopPropagation();
            },
            mousemove: function (aEvent) {
              if (lThis._cache.survoleTitreTriVisible) {
                $('#' + lIdSurvol).hide();
                $('#' + lIdCurseurTriSurvol).hide();
              }
              aEvent.stopPropagation();
            },
          },
          '.TitreListeSansTri',
        );
        const lThis = this;
        $(aNode).on({
          click: function (aEvent) {
            const lNumeroColonne = lThis._getColonneDePositionEvent(
              aEvent,
              this,
              aInfosZonesColonnes,
            );
            if (
              lNumeroColonne < 0 ||
              !lThis._cache.colonnesTri[lNumeroColonne]
            ) {
              if (lNumeroColonne < 0) {
                IE.log.addLog('_nodeTableTitrePourTri => colonne non trouvée');
              }
              return;
            }
            let lGenreTri = Enumere_TriElement_1.EGenreTriElement.Croissant;
            let lNumeroTri = lThis._triCourant.colonne.indexOf(lNumeroColonne);
            if (lNumeroTri === -1) {
              lNumeroTri = 0;
            }
            if (lThis._triCourant.colonne[lNumeroTri] === lNumeroColonne) {
              lGenreTri =
                lThis._triCourant.genre[lNumeroTri] ===
                Enumere_TriElement_1.EGenreTriElement.Croissant
                  ? Enumere_TriElement_1.EGenreTriElement.Decroissant
                  : Enumere_TriElement_1.EGenreTriElement.Croissant;
            }
            lThis.setColonneTri(lNumeroColonne, lGenreTri, lNumeroTri);
          },
          contextmenu: function (aEvent) {
            const lNumeroColonne = lThis._getColonneDePositionEvent(
              aEvent,
              this,
              aInfosZonesColonnes,
            );
            if (lNumeroColonne < 0) {
              IE.log.addLog('_nodeTableTitrePourTri => colonne non trouvée');
              return;
            }
            if (lThis._cache.colonnesTri[lNumeroColonne]) {
              lThis.afficherMenuContextuelTri(lNumeroColonne);
            }
          },
          mouseleave: function () {
            if (lThis._cache.survoleTitreTriVisible) {
              $('#' + lIdSurvol).hide();
              $('#' + lIdCurseurTriSurvol).hide();
            }
            lThis._cache.survoleTitreTriVisible = false;
          },
          mousemove: function (aEvent) {
            const lNumeroColonne = lThis._getColonneDePositionEvent(
              aEvent,
              this,
              aInfosZonesColonnes,
            );
            if (
              lNumeroColonne < 0 ||
              !lThis._cache.colonnesTri[lNumeroColonne]
            ) {
              if (lThis._cache.survoleTitreTriVisible) {
                $('#' + lIdSurvol).hide();
                $('#' + lIdCurseurTriSurvol).hide();
              }
              return;
            }
            const lPosition =
              aInfosZonesColonnes.gabaritColonnesTitre[lNumeroColonne];
            if (lPosition) {
              lThis._cache.survoleTitreTriVisible = true;
              $('#' + lIdSurvol)
                .show()
                .css({
                  left: lPosition.left + 'px',
                  width: lPosition.width + 'px',
                });
              let lSurColonneAvecTri = false;
              if (lThis._triCourant.colonne) {
                lThis._triCourant.colonne.forEach((aNumeroColonne) => {
                  if (aNumeroColonne === lNumeroColonne) {
                    lSurColonneAvecTri = true;
                  }
                });
              }
              if (
                lSurColonneAvecTri ||
                $('#' + lIdCurseurTriSurvol).data('dragEnCours')
              ) {
                $('#' + lIdCurseurTriSurvol).hide();
              } else {
                $('#' + lIdCurseurTriSurvol)
                  .show()
                  .css(
                    'left',
                    lThis._getLeftCurseurTri(
                      lPosition,
                      lNumeroColonne ===
                        aInfosZonesColonnes.colonnesVisibles[
                          aInfosZonesColonnes.colonnesVisibles.length - 1
                        ],
                    ) + 'px',
                  );
              }
            }
          },
        });
      }
      _getLigneElementParParseur(aParseur, aColonne) {
        let lLigne = -1;
        let lValeur;
        this._cache.lignesVisibles.every((aLigne) => {
          const lParams = this._getParamsCellule(aColonne, aLigne);
          lValeur = this.Donnees.getValeurPourParsing(lParams);
          if (lValeur && lValeur.toString) {
            lValeur = lValeur.toString();
          }
          lLigne = aLigne;
          if (
            lValeur &&
            ComparateurChaines_1.ComparateurChaines.compare(
              lValeur,
              aParseur,
            ) >= 0
          ) {
            return false;
          }
          return true;
        });
        return lLigne;
      }
      gererParsingSurEventKey(event) {
        let lColonne = this._options.parsingSurColonne;
        if (lColonne === ObjetListeEspace.parsingSurColonneTri) {
          if (this._triCourant.nombreTri > 0) {
            lColonne = this._triCourant.colonne[0];
          } else {
            return;
          }
        } else if (MethodesObjet_1.MethodesObjet.isString(lColonne)) {
          lColonne = this.getNumeroColonneDIdColonne(lColonne);
        }
        if (lColonne === -1) {
          return;
        }
        if (!this.Donnees) {
          return;
        }
        const lCar = ComparateurChaines_1.ComparateurChaines.normalize(
          String.fromCharCode(event.which),
        );
        if (
          !event.altKey &&
          !event.ctrlKey &&
          event.which !== 0 &&
          lCar.search(/[a-z0-9 ]/gi) >= 0
        ) {
          uParseur += lCar;
          clearTimeout(uTimerParseur);
          uTimerParseur = setTimeout(this._initParseur, 500);
          if (!this._estColonneVisible(lColonne)) {
            return;
          }
          const lLigne = this._getLigneElementParParseur(uParseur, lColonne);
          if (lLigne < 0) {
            this._initParseur();
            return;
          }
          if (this.Donnees.avecMultiSelection()) {
            for (
              let iLigne = 0;
              iLigne < this._cache.lignesSelectionnees.length;
              iLigne++
            ) {
              if (this._etatSelectionCellule({ ligne: iLigne })) {
                this.selectionnerLigne({ ligne: iLigne, selectionner: false });
              }
            }
          }
          this._surSelection(lColonne, lLigne, {
            forcerMonoSelection: true,
            surInteractionUtilisateur: true,
          });
          this.surSelectionEvenement(lColonne, lLigne, false);
        } else {
          this._initParseur();
        }
      }
      _construireCopieCSV() {
        let i,
          lNumeroLigne,
          lNumeroColonne,
          lType,
          lContenuLigne,
          lTitresLigne,
          lLibelle,
          lContenuValeurs,
          lValeur;
        const lResult = [];
        let lParamsCellule;
        const lEstColonneExportee = (aNumeroColonne) => {
          return (
            this._estColonneVisible(aNumeroColonne) &&
            (!this._cache.declarationsColonnes[aNumeroColonne] ||
              !this._cache.declarationsColonnes[aNumeroColonne]
                .ignorerExportCSV)
          );
        };
        const lGetValCSV = function (aValue) {
          if (typeof aValue === 'number') {
            return aValue;
          }
          return '"' + aValue + '"';
        };
        if (this.ListeTitres) {
          for (
            lNumeroLigne = 0;
            lNumeroLigne < this.ListeTitres.length;
            lNumeroLigne++
          ) {
            lContenuLigne = [];
            lTitresLigne = this.ListeTitres[lNumeroLigne];
            for (
              lNumeroColonne = 0;
              lNumeroColonne < this.ListeTailles.length;
              lNumeroColonne++
            ) {
              if (lEstColonneExportee(lNumeroColonne)) {
                lLibelle = '';
                if (lTitresLigne && lTitresLigne[lNumeroColonne]) {
                  lLibelle =
                    lTitresLigne[lNumeroColonne].libelleCSV ||
                    lTitresLigne[lNumeroColonne].libelle ||
                    '';
                }
                lContenuLigne.push(lLibelle);
              }
            }
            lResult.push(lContenuLigne.join(';'));
          }
        }
        if (this.Donnees) {
          for (i = 0; i < this._cache.lignesVisibles.length; i++) {
            lNumeroLigne = this._cache.lignesVisibles[i];
            lContenuLigne = [];
            for (
              lNumeroColonne = 0;
              lNumeroColonne < this.ListeTailles.length;
              lNumeroColonne++
            ) {
              if (lEstColonneExportee(lNumeroColonne)) {
                lParamsCellule = this._getParamsCellule(
                  lNumeroColonne,
                  lNumeroLigne,
                  {
                    surEdition: false,
                    surProportion: false,
                    surExportCSV: true,
                  },
                );
                lType = this.Donnees.getTypeValeur(lParamsCellule);
                lContenuValeurs = [];
                switch (lType) {
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule
                    .CocheDeploiement:
                    break;
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche:
                    lValeur = this.Donnees._getValeur(lParamsCellule);
                    if (
                      lValeur === true ||
                      lValeur ===
                        ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Verte
                    ) {
                      lContenuValeurs.push('X');
                    } else if (
                      lValeur ===
                      ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Grise
                    ) {
                      lContenuValeurs.push('P');
                    } else {
                      lContenuValeurs.push('');
                    }
                    break;
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Note:
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Texte:
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule
                    .ZoneTexte:
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Image:
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Icon:
                  case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Html:
                    lValeur =
                      this.Donnees.getValeurPourAffichage(lParamsCellule);
                    lContenuValeurs.push(lGetValCSV(lValeur));
                    break;
                  default:
                    lContenuValeurs.push(
                      this.Donnees._getValeur(lParamsCellule),
                    );
                    break;
                }
                lContenuLigne.push(lContenuValeurs.join(' - '));
              }
            }
            lResult.push(lContenuLigne.join(';'));
          }
        }
        if (this.Donnees && this._avecLigneTotal()) {
          this._getListeLignesTotal().parcourir((aArticle, aIndexLigne) => {
            lContenuLigne = [];
            for (
              lNumeroColonne = 0;
              lNumeroColonne < this.ListeTailles.length;
              lNumeroColonne++
            ) {
              if (lEstColonneExportee(lNumeroColonne)) {
                const lParams = this._getParamsCellule(lNumeroColonne, -1, {
                  surTotal: true,
                  surExportCSV: true,
                });
                if (aArticle) {
                  lParams.ligne = aIndexLigne;
                  lParams.article = aArticle;
                }
                const lContenuTotal = this.Donnees.getContenuTotal(lParams);
                lContenuLigne.push(lGetValCSV(lContenuTotal));
              }
            }
            lResult.push(lContenuLigne.join(';'));
          });
        }
        return ObjetChaine_1.GChaine.enleverEntites(
          lResult.join('\r\n').replace(/&nbsp;/gi, ''),
        );
      }
      _colonneEnFusionAvecColonnePrecedente(aTitresLigne, aNumeroColonne) {
        let lNumeroColVisiblePrec = aNumeroColonne - 1;
        while (
          lNumeroColVisiblePrec > 0 &&
          !this._estColonneVisible(lNumeroColVisiblePrec)
        ) {
          lNumeroColVisiblePrec += -1;
        }
        if (
          !aTitresLigne ||
          !aTitresLigne[aNumeroColonne] ||
          !aTitresLigne[lNumeroColVisiblePrec]
        ) {
          return false;
        }
        if (
          aTitresLigne[aNumeroColonne].fusion ===
          TypeFusionTitreListe_1.TypeFusionTitreListe.FusionGauche
        ) {
          return true;
        }
        if (
          aTitresLigne[aNumeroColonne].avecFusionColonne &&
          (((aTitresLigne[aNumeroColonne].libelle ||
            aTitresLigne[aNumeroColonne].libelle === '') &&
            aTitresLigne[aNumeroColonne].libelle ===
              aTitresLigne[lNumeroColVisiblePrec].libelle) ||
            (aTitresLigne[aNumeroColonne].libelleHtml &&
              aTitresLigne[aNumeroColonne].libelleHtml ===
                aTitresLigne[lNumeroColVisiblePrec].libelleHtml) ||
            (aTitresLigne[aNumeroColonne].classeCssImage &&
              aTitresLigne[aNumeroColonne].classeCssImage ===
                aTitresLigne[lNumeroColVisiblePrec].classeCssImage))
        ) {
          return true;
        }
        return false;
      }
      _construireTaillesGrid(aInfosZoneColonnes) {
        const lDecalageBordureHDuContenu =
          this._options.borduresCellule_horizontal - 1;
        const lResult = {
          width: 0,
          tabWidth: [],
          styleGrid: '',
          gabaritColonne: [],
        };
        const lTabStyleTemplate = [];
        aInfosZoneColonnes.colonnesVisibles.forEach(
          (aNumeroColonne, aIndex) => {
            let lWidthCol =
              this._cache.taillesColonne[aNumeroColonne].px +
              lDecalageBordureHDuContenu +
              2 * this._options.paddingCelluleLR;
            if (
              aIndex < aInfosZoneColonnes.colonnesVisibles.length - 1 ||
              (aInfosZoneColonnes.estBlocFixe &&
                !aInfosZoneColonnes.dernierBloc)
            ) {
              lWidthCol += 1;
            }
            if (
              aInfosZoneColonnes.estBlocFixeDroite &&
              aNumeroColonne === aInfosZoneColonnes.indiceColonneDebut
            ) {
              lWidthCol += 1;
            }
            lResult.gabaritColonne[aNumeroColonne] = {
              width: lWidthCol,
              left:
                lResult.width + (aInfosZoneColonnes.estBlocFixeDroite ? 1 : 0),
            };
            lResult.tabWidth.push({
              width: lWidthCol,
              colonne: aNumeroColonne,
            });
            lTabStyleTemplate.push(lWidthCol + 'px');
            lResult.width += lWidthCol;
          },
        );
        lResult.styleGrid =
          lTabStyleTemplate.length > 0
            ? 'grid-template-columns:' + lTabStyleTemplate.join(' ') + ';'
            : '';
        return lResult;
      }
      _construireTriActif(aInfosZoneColonnes, aIndiceTri) {
        const lNumeroCol = this._triCourant.colonne[aIndiceTri];
        const lTriCroissant =
          this._triCourant.genre[aIndiceTri] ===
          Enumere_TriElement_1.EGenreTriElement.Croissant;
        const lAvecDragTri = this._cache.infosZonesColonnes.length < 2;
        return IE.jsx.str(
          'div',
          {
            id:
              this.ids.curseurTri +
              aInfosZoneColonnes.indiceBloc +
              '_' +
              aIndiceTri,
            tabindex: '-1',
            'ie-nodeafter': (0, jsx_1.jsxFuncAttr)(
              'liste.getNodeAfterCurseurTri',
              [aIndiceTri, aInfosZoneColonnes.indiceBloc],
            ),
            'ie-draggable': lAvecDragTri
              ? (0, jsx_1.jsxFuncAttr)('liste.dragCurseurTriDraggable', [
                  aIndiceTri,
                  aInfosZoneColonnes.indiceBloc,
                ])
              : false,
            class: 'flecheTri flecheTriNonSurvol AvecMain',
            style: { height: this._options.heightTri },
            role: 'columnheader',
            'aria-colindex': this.getIndiceColonneVisibleDeColonne(lNumeroCol),
            'aria-sort': lTriCroissant ? 'ascending' : 'descending',
            'aria-haspopup': this._triCourant.nombreTri > 1 ? 'true' : false,
            'aria-describedby': this.getIdAriaTitreDeColonne(lNumeroCol),
          },
          IE.jsx.str(
            'span',
            { class: 'sr-only' },
            ObjetTraduction_1.GTraductions.getValeur(
              'liste.wai.WAI_Tri_D',
              aIndiceTri + 1,
            ),
          ),
          this._getDessinCurseurTri({
            triCroissant: lTriCroissant,
            tri:
              aIndiceTri === 0
                ? _ObjetListe_1.NSListe.FlecheTri.principal
                : _ObjetListe_1.NSListe.FlecheTri.secondaire,
          }),
        );
      }
      _construireTitre(aInfosZoneColonnes, aAvecTri) {
        const T = [];
        let I;
        let lITri;
        const lHtmlTri = [];
        const lIdsArias = [];
        let iLigne, lTitresLigne, lNumeroDerniereColonneVisible;
        const lTaillesGrid = this._construireTaillesGrid(aInfosZoneColonnes);
        aInfosZoneColonnes.gabaritColonnesTitre = lTaillesGrid.gabaritColonne;
        if (aAvecTri) {
          lHtmlTri.push(
            '<div id="',
            this.ScrollH.getIdZone(aInfosZoneColonnes.idScrollTri) +
              '_conteneur" class="conteneurTri_scroll" role="presentation">',
          );
          lHtmlTri.push(
            '<div id="',
            this.ScrollH.getIdZone(aInfosZoneColonnes.idScrollTri),
            '" role="presentation">',
            '<div id="',
            this.ScrollH.getIdContenu(aInfosZoneColonnes.idScrollTri),
            '" class="tri_scroll_contenu" role="presentation" style="height:',
            this._options.heightTri,
            'px;',
            lTaillesGrid.width > 0
              ? ObjetStyle_1.GStyle.composeWidth(lTaillesGrid.width)
              : '',
            '">',
          );
          lHtmlTri.push(
            IE.jsx.str(
              'div',
              {
                role: 'row',
                'aria-rowindex': '2',
                id:
                  this.ids.curseurTri + aInfosZoneColonnes.indiceBloc + '_row',
              },
              ' ',
              (H) => {
                for (lITri = 0; lITri < this._triCourant.nombreTri; lITri++) {
                  H.push(this._construireTriActif(aInfosZoneColonnes, lITri));
                }
              },
            ),
          );
          lHtmlTri.push(
            IE.jsx.str(
              'div',
              {
                id: this.ids.curseurTriSurvol + aInfosZoneColonnes.indiceBloc,
                class: 'flecheTri',
                style: 'display:none;',
              },
              this._getDessinCurseurTri({
                tri: _ObjetListe_1.NSListe.FlecheTri.survol,
              }),
            ),
          );
        }
        this._cache.heightLigneTitre = null;
        const lAvecLigneCreation = this._avecLigneCreationTitreEnLigne();
        const lCssTitreZone = ['liste-titre-zone'];
        if (!this.ListeTitres && !lAvecLigneCreation) {
          lCssTitreZone.push('hide');
        }
        if (this._cache.avecScrollHorizontal) {
          lCssTitreZone.push('scroll-h');
        }
        if (aInfosZoneColonnes.dernierBloc) {
          lCssTitreZone.push('b-right');
        }
        if (aInfosZoneColonnes.indiceBloc === 0) {
          lCssTitreZone.push('b-left');
        }
        if (this.ListeTitres || lAvecLigneCreation) {
          T.push(
            '<div id="',
            this.ScrollH.getIdZone(aInfosZoneColonnes.idScrollTitre),
            '" class="' + lCssTitreZone.join(' ') + '" role="presentation">',
            '<div class="liste-titre-contenu" id="',
            this.ScrollH.getIdContenu(aInfosZoneColonnes.idScrollTitre),
            '" role="presentation">',
          );
          T.push(
            '<div class="liste_gridTitre" role="presentation"',
            this._cache.infosZonesColonnes.length > 1
              ? ObjetHtml_1.GHtml.composeAttr(
                  'ie-node',
                  'liste.getNodeTableTitre',
                  [aInfosZoneColonnes.indiceBloc],
                )
              : '',
            ObjetHtml_1.GHtml.composeAttr(
              'ie-nodeafter',
              'liste.getNodeAfterTableTitre',
              [aInfosZoneColonnes.indiceBloc],
            ),
            ' style="',
            lTaillesGrid.styleGrid,
            lTaillesGrid.width > 0
              ? ObjetStyle_1.GStyle.composeWidth(lTaillesGrid.width)
              : '',
            '">',
          );
        }
        let iColonne;
        const lColonnesGabaritCalculFusion = {};
        if (this.ListeTitres) {
          for (iLigne = 0; iLigne < this.ListeTitres.length; iLigne++) {
            lTitresLigne = this.ListeTitres[iLigne];
            const lMaxIndiceCol = Math.min(
              lTitresLigne.length,
              aInfosZoneColonnes.indiceColonneFin + 1,
            );
            lNumeroDerniereColonneVisible = -1;
            if (
              aInfosZoneColonnes.dernierBloc ||
              (!aInfosZoneColonnes.dernierBloc &&
                !aInfosZoneColonnes.estBlocFixe)
            ) {
              for (
                I = aInfosZoneColonnes.indiceColonneDebut;
                lTitresLigne && I < lMaxIndiceCol;
                I++
              ) {
                if (
                  !this._colonneEnFusionAvecColonnePrecedente(
                    lTitresLigne,
                    I,
                  ) &&
                  (this._estColonneVisible(I) ||
                    this._colonneEnFusionAvecColonnePrecedente(
                      lTitresLigne,
                      I + 1,
                    ))
                ) {
                  lNumeroDerniereColonneVisible = I;
                }
              }
            }
            let lIndiceBasCol = -1;
            for (
              let I = aInfosZoneColonnes.indiceColonneDebut;
              lTitresLigne && I < lMaxIndiceCol;
              I++
            ) {
              const lDescripteurTitre = lTitresLigne[I];
              const lEstColonneVisible = this._estColonneVisible(I);
              if (lEstColonneVisible) {
                lIndiceBasCol += 1;
              }
              if (
                ((!lDescripteurTitre.fusion &&
                  !this._colonneEnFusionAvecColonnePrecedente(
                    lTitresLigne,
                    I,
                  )) ||
                  (I === aInfosZoneColonnes.indiceColonneDebut &&
                    lDescripteurTitre.fusion ===
                      TypeFusionTitreListe_1.TypeFusionTitreListe
                        .FusionGauche)) &&
                (lEstColonneVisible ||
                  this._colonneEnFusionAvecColonnePrecedente(
                    lTitresLigne,
                    I + 1,
                  ))
              ) {
                let lNbCol = lEstColonneVisible ? 1 : 0;
                let lNbLigne = 1;
                for (let j = iLigne + 1; j < this.ListeTitres.length; j++) {
                  if (
                    this.ListeTitres[j][I].fusion !==
                    TypeFusionTitreListe_1.TypeFusionTitreListe.FusionHaute
                  ) {
                    break;
                  } else {
                    lNbLigne++;
                  }
                }
                const lIdAria = this.getIdAriaTitreDeColonne(I);
                const lEstLigneAvecIdAria =
                  iLigne + lNbLigne >= this.ListeTitres.length && !!lIdAria;
                let lAriaLabelTitre = '';
                if (this._cache.declarationsColonnes[I]) {
                  lAriaLabelTitre =
                    this._cache.declarationsColonnes[I].libelleWai || '';
                }
                if (!lAriaLabelTitre) {
                  if (lDescripteurTitre.title) {
                    lAriaLabelTitre = lDescripteurTitre.title;
                  }
                }
                for (
                  let iColonne = I + 1;
                  iColonne < lMaxIndiceCol;
                  iColonne++
                ) {
                  const lEstColonneEnFusionPrec =
                    this._colonneEnFusionAvecColonnePrecedente(
                      lTitresLigne,
                      iColonne,
                    );
                  const lEstColVisibleBoucle =
                    this._estColonneVisible(iColonne);
                  if (lEstColonneEnFusionPrec) {
                    if (lEstColVisibleBoucle) {
                      lNbCol++;
                    }
                  } else {
                    break;
                  }
                }
                if (lNbCol === 0) {
                  continue;
                }
                const lChaineTitre = lDescripteurTitre.libelle;
                const lClassImage = lDescripteurTitre.classeCssImage;
                const lChaineHtml = lDescripteurTitre.libelleHtml;
                let lNbLignesTexte = 0;
                if (lChaineTitre && !lClassImage && !lChaineHtml) {
                  lNbLignesTexte =
                    lDescripteurTitre.nbLignes === 0
                      ? 0
                      : lDescripteurTitre.nbLignes > 0 &&
                          MethodesObjet_1.MethodesObjet.isNumber(
                            lDescripteurTitre.nbLignes,
                          )
                        ? lDescripteurTitre.nbLignes
                        : 1;
                }
                const lCouleurFond = lDescripteurTitre.getCouleurFond
                  ? lDescripteurTitre.getCouleurFond(this._options)
                  : null;
                const lCouleurTexte = lDescripteurTitre.getCouleurTexte
                  ? lDescripteurTitre.getCouleurTexte(this._options)
                  : null;
                const lCss = ['Titre liste_gridTitre_cel'];
                if (iLigne > 0) {
                  lCss.push('b-top');
                }
                if (I !== lNumeroDerniereColonneVisible) {
                  lCss.push('b-right');
                }
                if (
                  aInfosZoneColonnes.estBlocFixeDroite &&
                  I === aInfosZoneColonnes.indiceColonneDebut
                ) {
                  lCss.push('b-left');
                }
                const lIndiceGridCol = lIndiceBasCol + 1;
                let lGridColumn = lIndiceGridCol + '';
                if (lNbCol > 1) {
                  lGridColumn += ' / ' + (lIndiceGridCol + lNbCol);
                }
                let lGridRow = iLigne + 1;
                let lGridRowStr = iLigne + 1 + '';
                if (lNbLigne > 1) {
                  lGridRowStr += ' / ' + (lGridRow + lNbLigne);
                }
                const lAriaLabelBy = `${lIdAria}_by`;
                T.push(
                  IE.jsx.str(
                    'div',
                    {
                      id: lEstLigneAvecIdAria ? lIdAria : false,
                      role: 'row',
                      'aria-rowindex': '1',
                      class: lCss,
                      'ie-class': aAvecTri
                        ? (0, jsx_1.jsxFuncAttr)('liste.getClassTriGridTitre', [
                            I,
                          ])
                        : false,
                      style:
                        this._composePaddingCellule() +
                        'grid-column:' +
                        lGridColumn +
                        ';' +
                        'grid-row:' +
                        lGridRowStr +
                        ';' +
                        'min-height:' +
                        this._options.hauteurCelluleTitreStandard +
                        'px;' +
                        (lCouleurFond
                          ? ObjetStyle_1.GStyle.composeCouleurFond(lCouleurFond)
                          : '') +
                        (lCouleurTexte
                          ? ObjetStyle_1.GStyle.composeCouleurTexte(
                              lCouleurTexte,
                            )
                          : ''),
                      title: lDescripteurTitre.title || false,
                      'ie-hint':
                        !lDescripteurTitre.title && lDescripteurTitre.titleHtml
                          ? (0, jsx_1.jsxFuncAttr)('liste.getHintHtmlTitre', [
                              iLigne,
                              I,
                            ])
                          : false,
                    },
                    () => {
                      let lStrFuncAttrEllipsis = (0, jsx_1.jsxFuncAttr)(
                        'liste.getOptionsEllipsisTitre',
                        [
                          !(
                            lDescripteurTitre.title ||
                            lDescripteurTitre.titleHtml
                          ),
                          lNbLignesTexte,
                        ],
                      );
                      return IE.jsx.str(
                        IE.jsx.fragment,
                        null,
                        IE.jsx.str(
                          'div',
                          {
                            style:
                              (lChaineHtml &&
                                lDescripteurTitre.ignorerOverflowHidden) ||
                              lDescripteurTitre.estCoche
                                ? false
                                : 'overflow:hidden;',
                            role: 'columnheader',
                            'aria-colindex':
                              this.getIndiceColonneVisibleDeColonne(I),
                            'aria-labelledby':
                              lEstLigneAvecIdAria && lAriaLabelTitre
                                ? lAriaLabelBy
                                : false,
                            'ie-ellipsis':
                              lNbLignesTexte === 1
                                ? lStrFuncAttrEllipsis
                                : false,
                            'ie-ellipsis-multiline':
                              lNbLignesTexte > 1 ? lStrFuncAttrEllipsis : false,
                          },
                          (lChaineHtml ? lChaineHtml : '') +
                            (lClassImage
                              ? IE.jsx.str(
                                  'div',
                                  {
                                    class: lClassImage,
                                    style:
                                      (lDescripteurTitre.largeurClasseCssImage
                                        ? 'width:' +
                                          lDescripteurTitre.largeurClasseCssImage +
                                          'px;'
                                        : '') +
                                      'margin-left:auto;margin-right:auto;',
                                  },
                                  '\u00A0',
                                )
                              : lChaineHtml
                                ? ''
                                : lDescripteurTitre.estCoche
                                  ? IE.jsx.str('ie-checkbox', {
                                      'ie-model': (0, jsx_1.jsxFuncAttr)(
                                        'liste.cocheTitreClassique',
                                        I,
                                      ),
                                      'ie-attr': (0, jsx_1.jsxFuncAttr)(
                                        'liste.cocheTitreClassique.getAttr',
                                        I,
                                      ),
                                    })
                                  : lNbLignesTexte > 1
                                    ? lChaineTitre
                                    : IE.jsx.str('span', null, lChaineTitre)),
                        ),
                        lEstLigneAvecIdAria && lAriaLabelTitre
                          ? IE.jsx.str(
                              'div',
                              { id: lAriaLabelBy, class: 'sr-only' },
                              lAriaLabelTitre,
                            )
                          : '',
                      );
                    },
                  ),
                );
                if (lEstLigneAvecIdAria) {
                  lIdsArias.push(lIdAria);
                }
                if (
                  !lColonnesGabaritCalculFusion[I] &&
                  lNbCol > 1 &&
                  iLigne === this.ListeTitres.length - 1 &&
                  aInfosZoneColonnes.gabaritColonnesTitre[I]
                ) {
                  const lLeft = aInfosZoneColonnes.gabaritColonnesTitre[I].left;
                  let lWidth = 0;
                  for (let iColonne = I; iColonne < I + lNbCol; iColonne++) {
                    lColonnesGabaritCalculFusion[iColonne] = true;
                    if (aInfosZoneColonnes.gabaritColonnesTitre[iColonne]) {
                      lWidth +=
                        aInfosZoneColonnes.gabaritColonnesTitre[iColonne].width;
                    }
                  }
                  for (iColonne = I; iColonne < I + lNbCol; iColonne++) {
                    if (aInfosZoneColonnes.gabaritColonnesTitre[iColonne]) {
                      aInfosZoneColonnes.gabaritColonnesTitre[iColonne] = {
                        width: lWidth,
                        left: lLeft,
                      };
                    }
                  }
                }
              }
            }
          }
          if (this._cache.infosZonesColonnes.length > 1) {
            for (iLigne = 0; iLigne < this.ListeTitres.length; iLigne++) {
              T.push(
                '<div class="liste_titreGabLigne" style="grid-column:1; grid-row:',
                iLigne + 1,
                '"></div>',
              );
            }
          }
        }
        if (this.ListeTitres || lAvecLigneCreation) {
          T.push('</div>');
          if (lAvecLigneCreation) {
            T.push(this.composeCreation(-1, lTaillesGrid, !!this.ListeTitres));
          }
          if (this._avecRollover()) {
            T.push(
              '<div id="',
              this.ids.rolloverTitre + aInfosZoneColonnes.indiceBloc,
              '" class="liste_conteneur_rollover titre">',
              (0, tag_1.tag)('div'),
              '</div>',
            );
          }
          if (aAvecTri && ObjetSupport_1.Support.supportPointerEventsNone) {
            T.push(
              '<div id="',
              this.ids.survolTitre + aInfosZoneColonnes.indiceBloc,
              '" class="voileBleuTitre">',
              '</div>',
            );
          }
          if (aAvecTri) {
            lHtmlTri.push('</div>', '</div>', '</div>');
          }
          T.push('</div>', '</div>');
        }
        const lResult = [];
        const lPaddingLeft =
            aInfosZoneColonnes.indiceBloc === 0
              ? this._options.borduresContenu_left - 1
              : 0,
          lPaddingRight = aInfosZoneColonnes.dernierBloc
            ? this._options.borduresContenu_right - 1
            : 0;
        const lHtml = this.ListeTitres || lAvecLigneCreation ? T.join('') : '';
        if (lHtml) {
          lResult.push(
            IE.jsx.str(
              'div',
              {
                id: this.ids.titre + aInfosZoneColonnes.indiceBloc,
                style:
                  'position:relative; ' +
                  (lPaddingLeft > 0
                    ? 'padding-left:' + lPaddingLeft + 'px;'
                    : '') +
                  (lPaddingRight > 0
                    ? 'padding-right:' + lPaddingRight + 'px;'
                    : ''),
                role: 'presentation',
              },
              lHtml,
              lHtmlTri.join(''),
            ),
          );
        }
        return { html: lResult.join(''), idsAria: lIdsArias.join(' ') };
      }
      _getJeuxCouleurNonSelection(aParamsCellule) {
        let lCouleurs = null;
        if (
          this._options.alternanceCouleurLigneContenu &&
          this._options.avecCouleurAlternanceParDefaut
        ) {
          lCouleurs =
            this._cache.couleursAlternanceParLigne[aParamsCellule.ligne] ===
            true
              ? this._options.couleurAlternance0
              : this._options.couleurAlternance1;
        } else if (
          this.Donnees.avecEdition(aParamsCellule) &&
          !this._getNonEditable()
        ) {
          lCouleurs = this._options.alternanceCouleurLigneContenu
            ? this._cache.couleursAlternanceParLigne[aParamsCellule.ligne] ===
              true
              ? this._options.couleursListe.editableAlternee1
              : this._options.couleursListe.editableAlternee2
            : this._options.couleursListe.editable;
        } else {
          lCouleurs = this._options.alternanceCouleurLigneContenu
            ? this._cache.couleursAlternanceParLigne[aParamsCellule.ligne] ===
              true
              ? this._options.couleursListe.nonEditableAlternee1
              : this._options.couleursListe.nonEditableAlternee2
            : this._options.couleursListe.nonEditable;
        }
        const LCouleurCellule = this.Donnees.getCouleurCellule(
          aParamsCellule,
          new _ObjetCouleur_1.ObjectCouleurCellule(
            lCouleurs.fond,
            lCouleurs.texte,
            lCouleurs.bordure,
          ),
        );
        if (LCouleurCellule !== null && LCouleurCellule !== undefined) {
          switch (LCouleurCellule) {
            case ObjetDonneesListe_1.ObjetDonneesListe.ECouleurCellule.Blanc:
              return this._options.couleursListe.editable;
            case ObjetDonneesListe_1.ObjetDonneesListe.ECouleurCellule.Gris:
              return this._options.couleursListe.nonEditable;
            case ObjetDonneesListe_1.ObjetDonneesListe.ECouleurCellule
              .Deploiement:
              return this._options.couleursListe.cumul[
                this.Donnees.getNiveauDeploiement(aParamsCellule)
              ];
            case ObjetDonneesListe_1.ObjetDonneesListe.ECouleurCellule.Fixe:
              return this._options.couleursListe.colonneFixe;
            case ObjetDonneesListe_1.ObjetDonneesListe.ECouleurCellule.Total:
              return this._options.couleursListe.total;
            default:
              return LCouleurCellule;
          }
        } else {
          return lCouleurs;
        }
      }
      _getJeuxCouleur(aParamsCellule, aEstSelectionne) {
        const lJeuxCouleur = this._getJeuxCouleurNonSelection(aParamsCellule);
        if (aEstSelectionne) {
          return new _ObjetCouleur_1.ObjectCouleurCellule(
            '',
            '',
            lJeuxCouleur.bordure,
          );
        }
        return lJeuxCouleur;
      }
      _composePaddingCellule() {
        return ObjetChaine_1.GChaine.format('padding: %spx %spx;', [
          this._options.paddingCelluleTB,
          this._options.paddingCelluleLR,
        ]);
      }
      _getFusionColonnesCelluleDeZone(aLigne, aInfosZoneColonnes) {
        return this._getFusionColonnesCellule({
          colonnesVisibles: aInfosZoneColonnes.colonnesVisibles,
          ligne: aLigne,
          indiceColonneDebut: aInfosZoneColonnes.indiceColonneDebut,
          indiceColonneFin: aInfosZoneColonnes.indiceColonneFin,
          dernierBloc:
            aInfosZoneColonnes.dernierBloc ||
            (!aInfosZoneColonnes.dernierBloc &&
              !aInfosZoneColonnes.estBlocFixe),
        });
      }
      _fusionCelluleAvecLignePrecedente(
        aParamsCellule,
        aFusionColonnes,
        aInfosZoneColonnes,
      ) {
        const lAvecFusionLigne =
          this.Donnees.fusionCelluleAvecLignePrecedente(aParamsCellule);
        if (lAvecFusionLigne && aParamsCellule.celluleLignePrecedente) {
          const lFusionsLignePrec = this._getFusionColonnesCelluleDeZone(
            aParamsCellule.celluleLignePrecedente.ligne,
            aInfosZoneColonnes,
          );
          if (!lFusionsLignePrec) {
            return true;
          }
          if (
            !aFusionColonnes[aParamsCellule.colonne] &&
            !lFusionsLignePrec[aParamsCellule.colonne]
          ) {
            return true;
          }
          if (
            aFusionColonnes[aParamsCellule.colonne] &&
            lFusionsLignePrec[aParamsCellule.colonne] &&
            aFusionColonnes[aParamsCellule.colonne].debut ===
              lFusionsLignePrec[aParamsCellule.colonne].debut &&
            aFusionColonnes[aParamsCellule.colonne].fin ===
              lFusionsLignePrec[aParamsCellule.colonne].fin
          ) {
            return true;
          }
          return false;
        }
        return lAvecFusionLigne;
      }
      _chercherLignesFusionVertical(
        aParamsCellule,
        aIndiceLigne,
        aRangeLignes,
        aFusionColonnes,
        aInfosZoneColonnes,
      ) {
        let lNombreLignesEnFusion = 1;
        let lLigneSuivante;
        let lLignePrecedente;
        let lIndiceFusionLigne;
        if (
          aIndiceLigne > aRangeLignes.debut &&
          this._fusionCelluleAvecLignePrecedente(
            aParamsCellule,
            aFusionColonnes,
            aInfosZoneColonnes,
          )
        ) {
          if (
            aParamsCellule.celluleLignePrecedente &&
            this._estLigneVisible(aParamsCellule.celluleLignePrecedente.ligne)
          ) {
            return 0;
          }
          return 1;
        }
        for (
          lIndiceFusionLigne = aIndiceLigne + 1;
          lIndiceFusionLigne < aRangeLignes.fin;
          lIndiceFusionLigne++
        ) {
          lLigneSuivante = this._cache.lignesVisibles[lIndiceFusionLigne];
          lLignePrecedente = this._cache.lignesVisibles[lIndiceFusionLigne - 1];
          if (
            this._estLigneVisible(lLignePrecedente) &&
            this._fusionCelluleAvecLignePrecedente(
              this._getParamsCellule(aParamsCellule.colonne, lLigneSuivante, {
                celluleLignePrecedente: this._getParamsCellule(
                  aParamsCellule.colonne,
                  lLignePrecedente,
                ),
              }),
              this._getFusionColonnesCelluleDeZone(
                lLigneSuivante,
                aInfosZoneColonnes,
              ),
              aInfosZoneColonnes,
            )
          ) {
            this._cache.lignesFusionParColonne[
              aParamsCellule.colonne + '_' + lLigneSuivante
            ] = { ligneOrigine: aParamsCellule.ligne };
            const lCle = aParamsCellule.colonne + '_' + aParamsCellule.ligne;
            if (!this._cache.lignesFusionParColonne[lCle]) {
              this._cache.lignesFusionParColonne[lCle] = {
                ligneOrigine: aParamsCellule.ligne,
                lignesCumuls: {},
              };
            }
            this._cache.lignesFusionParColonne[lCle].lignesCumuls[
              lLigneSuivante
            ] = true;
            lNombreLignesEnFusion += 1;
          } else {
            return lNombreLignesEnFusion;
          }
        }
        return lNombreLignesEnFusion;
      }
      _hauteurAdapteAuContenu() {
        return (
          !!this._options.hauteurAdapteContenu &&
          (this._cache.lignesVisibles.length > 0 ||
            !!this._options.messageContenuVide)
        );
      }
      _construireCopySVG() {
        return IE.jsx.str(
          'div',
          { class: 'copySVG', 'aria-hidden': 'true' },
          IE.jsx.str(
            'svg',
            {
              xmlns: 'http://www.w3.org/2000/svg',
              width: '100%',
              height: '100%',
            },
            IE.jsx.str('rect', {
              x: '0',
              y: '0',
              width: '100%',
              height: '100%',
            }),
          ),
        );
      }
      _construireCellule(aParamsCellule, aParams) {
        const T = [];
        const lInfosContenu = this._composeContenuCellule(
          aParamsCellule,
          aParams.taille - aParams.indentation,
        );
        const lEstAlignVCenter = this.Donnees.alignVCenter(aParamsCellule);
        const lRoleGrid = this._estRoleTreeGrid();
        const lAvecSelecFile =
          !this._getNonEditable() && this.Donnees.avecSelecFile(aParamsCellule);
        const lAttrs = {
          id: aParams.id + '_div',
          class: [
            'liste_contenu_cellule',
            lEstAlignVCenter ? ' liste_cellule_alignVCenter' : '',
            'liste-cellule-focusable',
          ],
          style:
            aParams.indentation > 0
              ? `padding-left:${aParams.indentation}px;`
              : false,
        };
        if (!this.Donnees.enConstruction_cacheRechercheTexte) {
          let lAriaDescribedByTab = [];
          if (lRoleGrid) {
            const lIDColDescr =
              this.Donnees.getWAIIdColonnePourDescription(aParamsCellule);
            if (lIDColDescr) {
              const lNumCol = this.getNumeroColonneDIdColonne(lIDColDescr);
              if (lNumCol >= 0) {
                lAriaDescribedByTab.push(
                  `${this.getIdCellule(lNumCol, aParamsCellule.ligne)}_div`,
                );
              }
            }
            if (
              !this._getNonEditable() &&
              (this.Donnees.avecEdition(aParamsCellule) ||
                this.Donnees.avecEvenementEdition(aParamsCellule))
            ) {
              lAriaDescribedByTab.push(this.ids.WAICelluleEditable);
            }
          }
          Object.assign(
            lAttrs,
            'attrTitleCellule' in lInfosContenu
              ? lInfosContenu.attrTitleCellule
              : {},
            {
              'ie-model': lAvecSelecFile
                ? (0, jsx_1.jsxFuncAttr)('liste.modeleSelecFileCellule', [
                    aParamsCellule.ligne,
                    aParamsCellule.colonne,
                    false,
                  ])
                : false,
              'ie-selecfile': lAvecSelecFile,
              'ie-attr': (0, jsx_1.jsxFuncAttr)('liste.attrCellule', [
                aParamsCellule.ligne,
                aParamsCellule.colonne,
                lRoleGrid,
              ]),
              tabindex: '-1',
              'aria-haspopup': aParamsCellule._haspopup ? 'true' : false,
              'aria-expanded': aParamsCellule._estDeploiement
                ? !!aParamsCellule._estDeploiement.expanded + ''
                : false,
              'aria-describedby':
                lAriaDescribedByTab.length > 0
                  ? lAriaDescribedByTab.join(' ')
                  : false,
            },
          );
          if (lRoleGrid) {
            Object.assign(lAttrs, {
              role: 'gridcell',
              'aria-colindex': aParams.indiceColonneVisible,
              'aria-colspan':
                aParams.nombreColonnesFusion > 1
                  ? aParams.nombreColonnesFusion
                  : false,
              'aria-rowspan':
                aParams.nombreLignesEnFusion > 1
                  ? aParams.nombreLignesEnFusion
                  : false,
            });
          } else {
            let lStruct =
              this._cache.structArborescenceLignes[
                this._cache.lignesVisibles.indexOf(aParamsCellule.ligne)
              ];
            const lEstUnDeploiement =
              this.Donnees.estUnDeploiement(aParamsCellule);
            if (!lStruct) {
              lStruct = { level: 1, index: 1, count: 1 };
            }
            Object.assign(lAttrs, {
              role: 'treeitem',
              'aria-level': lStruct.level,
              'aria-posinset': lStruct.index,
              'aria-setsize': lStruct.count,
              'aria-expanded':
                !aParamsCellule._estDeploiement &&
                (lStruct.avecFilsVisible || lEstUnDeploiement)
                  ? !!(
                      (!lEstUnDeploiement && lStruct.avecFilsVisible) ||
                      this.Donnees._estDeploye(aParamsCellule.ligne)
                    ) + ''
                  : false,
            });
          }
        }
        T.push(
          IE.jsx.str(
            'div',
            Object.assign({}, lAttrs, {
              'ie-nodeafter': !this.Donnees.enConstruction_cacheRechercheTexte
                ? (0, jsx_1.jsxFuncAttr)('liste.nodeAfterCellule')
                : '',
            }),
            lInfosContenu.html,
          ),
          this.Donnees.estCelluleCopie(aParamsCellule)
            ? this._construireCopySVG()
            : '',
        );
        return T.join('');
      }
      construireContenuListeInterne(aInfosZoneColonnes) {
        const lCacheRef = this._cache.refresh;
        this._cache.couleursAlternanceParLigne = [];
        this._cache.positionsCelluleCadreSelection = {};
        const lStyleGabarit = tag_1.tag.styleToStr(
          'grid-column',
          `1/${aInfosZoneColonnes.colonnesVisibles.length + 1}`,
        );
        const lTaillesGrid = this._construireTaillesGrid(aInfosZoneColonnes);
        const lPremierBloc = aInfosZoneColonnes.indiceBloc === 0;
        return IE.jsx.str(
          'div',
          {
            id: this.getIdGridFocus(aInfosZoneColonnes.indiceBloc),
            class: ['SansMain liste_fixed', 'liste-focus-grid'],
            style:
              lTaillesGrid.styleGrid +
              (lTaillesGrid.width > 0
                ? ObjetStyle_1.GStyle.composeWidth(lTaillesGrid.width)
                : ''),
            role: this._estRoleTreeGrid() ? false : 'group',
            tabindex: lPremierBloc ? '0' : '-1',
            'ie-node': 'liste.getNodePremierElement',
          },
          (T) => {
            if (lCacheRef.avecConstructionDynamiqueContenu) {
              T.push(
                IE.jsx.str('div', {
                  'ie-node': (0, jsx_1.jsxFuncAttr)(
                    'liste.nodeGabaritRefresh',
                    [true, aInfosZoneColonnes.indiceBloc],
                  ),
                  class: 'gabarit-refresh',
                  style: lStyleGabarit,
                  role: 'presentation',
                }),
              );
            }
            T.push(
              this.construireContenuListeInterneLignes(aInfosZoneColonnes, 0),
            );
            if (lCacheRef.avecConstructionDynamiqueContenu) {
              T.push(
                IE.jsx.str('div', {
                  'ie-node': (0, jsx_1.jsxFuncAttr)(
                    'liste.nodeGabaritRefresh',
                    [false, aInfosZoneColonnes.indiceBloc],
                  ),
                  class: 'gabarit-refresh',
                  style: lStyleGabarit,
                  role: 'presentation',
                }),
              );
            }
          },
        );
      }
      construireContenuListeInterneLignes(aInfosZoneColonnes, aIndiceRange) {
        const T = [];
        let lJeuxCouleurs,
          lDerniereLigne,
          lStyleBordures,
          lCouleurBorduresCellules,
          lNumeroPremiereColonneFusion,
          lNumeroDerniereColonneFusion,
          lDerniereColonne,
          lNombreColonnesFusion,
          lPremiereColonne,
          lNombreLignesEnFusion,
          lClassLigne,
          lFusions,
          lCouleurAlternance = false,
          lAvecSeparateurDeploiement = false;
        let lErreurFusionLigne = false;
        const lNbColonnesVisibles = aInfosZoneColonnes.colonnesVisibles.length;
        const lNbLignesVisibles = this._cache.lignesVisibles.length;
        const lRoleGrid = this._estRoleTreeGrid();
        if (lNbLignesVisibles === 0 && this._options.messageContenuVide) {
          T.push(
            IE.jsx.str(
              'div',
              {
                class: 'liste_messageVide',
                style:
                  'grid-column: 1 / ' +
                  (aInfosZoneColonnes.colonnesVisibles.length + 1),
                role: lRoleGrid ? 'gridcell' : 'treeitem',
              },
              this._options.messageContenuVide,
            ),
          );
        }
        if (!this.Donnees || !this.ListeTailles) {
          return T.join('');
        }
        const lClasseRange = this._cache.refresh
          .avecConstructionDynamiqueContenu
          ? this._getClassRange(aIndiceRange)
          : '';
        const lRangeLignes = { debut: 0, fin: lNbLignesVisibles };
        if (this._cache.refresh.avecConstructionDynamiqueContenu) {
          const lStructure = this._cache.refresh.structure[aIndiceRange];
          lRangeLignes.debut = lStructure.deb;
          lRangeLignes.fin = lStructure.fin + 1;
        }
        const lAvecObserver =
          this._cache.refresh.avecConstructionDynamiqueContenu &&
          !this.Donnees.enConstruction_cacheRechercheTexte &&
          lRangeLignes.fin > lRangeLignes.debut;
        if (lAvecObserver) {
          T.push(
            (0, tag_1.tag)('div', {
              class: lClasseRange,
              style:
                'height:0; grid-column:1/' + (lNbColonnesVisibles + 1) + ';',
              'ie-nodeafter': (0, jsx_1.jsxFuncAttr)('liste.nodeObsRange', [
                true,
                aIndiceRange,
                aInfosZoneColonnes.indiceBloc,
              ]),
              role: 'presentation',
            }),
          );
        }
        let lParamCelluleLigne = null;
        for (
          let iIndice = lRangeLignes.debut;
          iIndice < lRangeLignes.fin;
          iIndice++
        ) {
          const J = this._cache.lignesVisibles[iIndice];
          lPremiereColonne = true;
          lAvecSeparateurDeploiement = false;
          lParamCelluleLigne = this._getParamsCellule(-1, J);
          if (
            (iIndice > 0 || aIndiceRange > 0) &&
            lNbColonnesVisibles === 1 &&
            !this.Donnees.enConstruction_cacheRechercheTexte &&
            this.Donnees instanceof
              ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign &&
            this.Donnees.avecSeparateurLigneHautFlatdesign &&
            this.Donnees.avecSeparateurLigneHautFlatdesign(
              lParamCelluleLigne,
              this._getParamsCellule(
                -1,
                this._cache.lignesVisibles[iIndice - 1],
              ),
            )
          ) {
            T.push(
              (0, tag_1.tag)('hr', {
                class: ['liste_sepligne', lClasseRange],
                role: 'presentation',
              }),
            );
          }
          let lAvecLigneDraggable =
            !this.Donnees.enConstruction_cacheRechercheTexte &&
            this.Donnees.avecLigneDraggable(lParamCelluleLigne);
          if (
            !lAvecLigneDraggable &&
            this._options.AvecSuppression &&
            !this._getNonEditable() &&
            this.Donnees
          ) {
            if (!GNavigateur.isTactile) {
              this._cache.infosZonesColonnes.every((aInfosZoneColonnes) => {
                return aInfosZoneColonnes.colonnesVisibles.every(
                  (aNumeroColonne) => {
                    const lParamsCellule = this._getParamsCellule(
                      aNumeroColonne,
                      J,
                      { surSuppression: true },
                    );
                    lAvecLigneDraggable =
                      this.Donnees._avecSuppression(lParamsCellule);
                    return !lAvecLigneDraggable;
                  },
                );
              });
            }
          }
          lFusions = this._getFusionColonnesCelluleDeZone(
            J,
            aInfosZoneColonnes,
          );
          let lIndiceColonneVisible = 1;
          aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
            if (!lFusions[aNumeroColonne] || !lFusions[aNumeroColonne].nbCol) {
              return;
            }
            const lParamsCellule = this._getParamsCellule(aNumeroColonne, J, {
              celluleLignePrecedente:
                J > 0
                  ? this._getParamsCellule(
                      aNumeroColonne,
                      this._cache.lignesVisibles[iIndice - 1],
                    )
                  : null,
              celluleLigneSuivante:
                iIndice + 1 < lNbLignesVisibles
                  ? this._getParamsCellule(
                      aNumeroColonne,
                      this._cache.lignesVisibles[iIndice + 1],
                    )
                  : null,
            });
            if (
              lPremiereColonne &&
              this._options.alternanceCouleurLigneContenu
            ) {
              const lResultAlternance =
                this.Donnees.avecAlternanceCouleurLigne(lParamsCellule);
              if (lResultAlternance === true || lResultAlternance === false) {
                lCouleurAlternance = lResultAlternance
                  ? !lCouleurAlternance
                  : lCouleurAlternance;
              } else if (
                MethodesObjet_1.MethodesObjet.isNumber(lResultAlternance)
              ) {
                lCouleurAlternance = lResultAlternance % 2 === 0;
              } else {
              }
              if (this.Donnees.estUnDeploiement(lParamsCellule)) {
                this._cache.couleursAlternanceParLigne[J] = lCouleurAlternance;
                lAvecSeparateurDeploiement =
                  this._options.avecTraitSeparationDeploiementAlternance &&
                  this._options.couleurAlternance0 &&
                  !!this._options.couleurAlternance0.fond;
              } else {
                this._cache.couleursAlternanceParLigne[J] = lCouleurAlternance;
              }
            }
            lNumeroPremiereColonneFusion = lFusions[aNumeroColonne].debut;
            lNumeroDerniereColonneFusion = lFusions[aNumeroColonne].fin;
            lDerniereColonne =
              aInfosZoneColonnes.indiceColonneFin ===
                lNumeroDerniereColonneFusion &&
              (aInfosZoneColonnes.dernierBloc ||
                (!aInfosZoneColonnes.dernierBloc &&
                  !aInfosZoneColonnes.estBlocFixe));
            let lTaille = lFusions[aNumeroColonne].taille;
            lNombreColonnesFusion = lFusions[aNumeroColonne].nbCol;
            if (
              this._cache.colonnesSansBordureDroit[
                lNumeroDerniereColonneFusion
              ] &&
              this._celluleAvecBordureDroite(lDerniereColonne)
            ) {
              lTaille += 1;
            }
            lNombreLignesEnFusion = this._chercherLignesFusionVertical(
              lParamsCellule,
              iIndice,
              lRangeLignes,
              lFusions,
              aInfosZoneColonnes,
            );
            lDerniereLigne =
              iIndice + lNombreLignesEnFusion >= lNbLignesVisibles;
            if (
              lNombreLignesEnFusion !== 1 &&
              this._cache.infosZonesColonnes.length > 1
            ) {
              lErreurFusionLigne = true;
            }
            if (lNombreLignesEnFusion <= 0) {
              lIndiceColonneVisible += lNombreColonnesFusion;
              return;
            }
            const lIndiceGridCol = lIndiceColonneVisible;
            let lGridColumn = lIndiceColonneVisible + '';
            if (lNombreColonnesFusion > 1) {
              lGridColumn += ' / ' + (lIndiceGridCol + lNombreColonnesFusion);
            }
            const lAriaColIndex = lIndiceColonneVisible + 1;
            lIndiceColonneVisible += lNombreColonnesFusion;
            let lGridRowEnd = '';
            if (lNombreLignesEnFusion > 1) {
              lGridRowEnd = `span ${lNombreLignesEnFusion}`;
            }
            let lCelluleSelectionnee = false;
            if (
              !this.Donnees.enConstruction_cacheRechercheTexte &&
              this.Donnees._avecSelection(lParamsCellule)
            ) {
              lCelluleSelectionnee = this._etatSelectionCellule({
                ligne: J,
                colonne: aNumeroColonne,
              });
            }
            lJeuxCouleurs = this._getJeuxCouleur(
              lParamsCellule,
              this._options.avecCadreSelection ? false : lCelluleSelectionnee,
            );
            lCouleurBorduresCellules =
              this._options.borduresCellule_couleur ||
              lJeuxCouleurs.getBordure(false);
            if (this.Donnees.enConstruction_cacheRechercheTexte) {
              lStyleBordures = '';
            } else {
              lStyleBordures =
                ((lDerniereLigne && this._hauteurAdapteAuContenu()) ||
                this._options.borduresCellule_vertical <= 0 ||
                !this.Donnees.avecBordureBas(lParamsCellule)
                  ? ''
                  : ObjetStyle_1.GStyle.composeCouleurBordure(
                      lCouleurBorduresCellules,
                      this._options.borduresCellule_vertical,
                      ObjetStyle_2.EGenreBordure.bas,
                    )) +
                (this._options.borduresCellule_vertical > 0 &&
                this.Donnees.avecBordureHaut(lParamsCellule)
                  ? ObjetStyle_1.GStyle.composeCouleurBordure(
                      lCouleurBorduresCellules,
                      this._options.borduresCellule_vertical,
                      ObjetStyle_2.EGenreBordure.haut,
                    )
                  : '') +
                (!this._celluleAvecBordureDroite(lDerniereColonne) ||
                this._cache.colonnesSansBordureDroit[
                  lNumeroDerniereColonneFusion
                ] ||
                (aInfosZoneColonnes.indiceColonneFin !==
                  lNumeroDerniereColonneFusion &&
                  !this.Donnees.avecBordureDroite(lParamsCellule))
                  ? ''
                  : ObjetStyle_1.GStyle.composeCouleurBordure(
                      lCouleurBorduresCellules,
                      this._options.borduresCellule_horizontal,
                      ObjetStyle_2.EGenreBordure.droite,
                    )) +
                (aInfosZoneColonnes.estBlocFixeDroite &&
                lNumeroPremiereColonneFusion ===
                  aInfosZoneColonnes.indiceColonneDebut &&
                this._options.borduresCellule_horizontal > 0
                  ? ObjetStyle_1.GStyle.composeCouleurBordure(
                      lCouleurBorduresCellules,
                      this._options.borduresCellule_horizontal,
                      ObjetStyle_2.EGenreBordure.gauche,
                    )
                  : '');
            }
            const lIndentation = Math.min(
              this.Donnees.getIndentationCellule(lParamsCellule) || 0,
              lTaille,
            );
            let lPadding = this.Donnees.getPadding(lParamsCellule);
            let lPaddingTB = this._options.paddingCelluleTB;
            let lPaddingLR = this._options.paddingCelluleLR;
            if (typeof lPadding === 'number' && lPadding >= 0) {
              lTaille += 2 * (this._options.paddingCelluleLR - lPadding);
              lPaddingTB = lPadding;
              lPaddingLR = lPadding;
            } else {
              lPadding = null;
            }
            const lHeightCellule = this._getHeightCellule(lParamsCellule);
            let lAvecMain =
              !this._getNonEditable() &&
              this.Donnees.avecEvenementEdition(lParamsCellule);
            if (!lAvecMain && !this._getNonEditable()) {
              const lTypeCellule = this.Donnees.getTypeValeur(lParamsCellule);
              lAvecMain =
                lTypeCellule ===
                  ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche &&
                this.Donnees.avecEdition(lParamsCellule);
            }
            lClassLigne = lAvecMain ? 'AvecMain ' : '';
            const LId = this.getIdCellule(aNumeroColonne, J);
            delete this._cache.ouvrirSelecteurFileParLigne[
              lParamsCellule.ligne + '_' + lParamsCellule.colonne
            ];
            this._cache.collectionFuncConstructCellule[
              lParamsCellule.ligne + '_' + lParamsCellule.colonne
            ] = this._construireCellule.bind(this, lParamsCellule, {
              id: LId,
              taille: lTaille,
              indentation: lIndentation,
              indiceColonneVisible:
                lAriaColIndex -
                1 +
                (aInfosZoneColonnes.indiceColVisibleDebut || 0),
              indiceLigneVisible: iIndice + 1,
              nombreColonnesFusion: lNombreColonnesFusion,
              nombreLignesEnFusion: lNombreLignesEnFusion,
            });
            let lAttrIEDrop = false;
            if (
              !this.Donnees.enConstruction_cacheRechercheTexte &&
              !GNavigateur.isTactile &&
              this.Donnees &&
              this.Donnees.avecLigneDroppable(lParamCelluleLigne)
            ) {
              lAttrIEDrop = (0, jsx_1.jsxFuncAttr)(
                'liste.dropCelluleDroppable',
                [lParamsCellule.ligne, lParamsCellule.colonne],
              );
            }
            const lRoleGrid = this._estRoleTreeGrid();
            T.push(
              IE.jsx.str(
                'div',
                {
                  id: LId,
                  role: !lRoleGrid ? 'presentation' : 'row',
                  'aria-hidden': lRoleGrid ? 'true' : false,
                  'data-colonne': lParamsCellule.colonne,
                  'aria-rowindex': lRoleGrid
                    ? iIndice + 1 + (this.ListeTitres ? 1 : 0)
                    : false,
                  class: [
                    'liste_celluleGrid',
                    `liste_celluleGrid_${iIndice + 1}`,
                    lCelluleSelectionnee ? 'selected' : '',
                    lClassLigne,
                    lClasseRange,
                  ],
                  'ie-class': (0, jsx_1.jsxFuncAttr)(
                    'liste.getClassCellulePere',
                    [lParamsCellule.ligne, lParamsCellule.colonne],
                  ),
                  style: [
                    tag_1.tag.styleToStr('grid-column', lGridColumn),
                    lGridRowEnd
                      ? tag_1.tag.styleToStr('grid-row-end', lGridRowEnd)
                      : '',
                    tag_1.tag.styleToStr('min-height', lHeightCellule + 'px'),
                    this._options.ignorerCouleurInlineCellule
                      ? ''
                      : ObjetStyle_1.GStyle.composeCouleurFond(
                          lJeuxCouleurs.getFond(false),
                        ),
                    this._options.ignorerCouleurInlineCellule
                      ? ''
                      : ObjetStyle_1.GStyle.composeCouleurTexte(
                          lJeuxCouleurs.getTexte(false),
                        ),
                    lStyleBordures,
                    tag_1.tag.styleToStr(
                      'padding',
                      lPaddingTB + 'px ' + lPaddingLR + 'px',
                    ),
                  ].join(''),
                  'ie-droppable': !this.Donnees
                    .enConstruction_cacheRechercheTexte
                    ? lAttrIEDrop
                    : '',
                  'ie-draggable-fantome': lAvecLigneDraggable
                    ? (0, jsx_1.jsxFuncAttr)('liste.dragFantomeCellule', [
                        lParamsCellule.ligne,
                        lParamsCellule.colonne,
                      ])
                    : false,
                },
                this._cache.collectionFuncConstructCellule[
                  lParamsCellule.ligne + '_' + lParamsCellule.colonne
                ](),
              ),
            );
            lPremiereColonne = false;
          });
          if (
            lAvecSeparateurDeploiement &&
            !this.Donnees.enConstruction_cacheRechercheTexte
          ) {
            T.push(
              IE.jsx.str('div', {
                class: ['liste_traitSepDeploiement', lClasseRange],
                style: {
                  'grid-column':
                    '1 / ' + (aInfosZoneColonnes.colonnesVisibles.length + 1),
                  margin: '1px ' + this._options.paddingCelluleLR + 'px',
                  'background-color': this._options.couleurAlternance0.fond,
                },
              }),
            );
          }
          if (
            this._cache.numeroLigneCreationDynamique === J &&
            !this.Donnees.enConstruction_cacheRechercheTexte
          ) {
            T.push(
              '<div class="liste_celluleGrid ' + lClasseRange + '" style="',
              'grid-column:',
              '1 / ',
              aInfosZoneColonnes.colonnesVisibles.length + 1,
              ';',
              '">',
              this.composeCreation(
                J,
                this._construireTaillesGrid(aInfosZoneColonnes),
              ),
              '</div>',
            );
          }
        }
        if (lAvecObserver) {
          T.push(
            (0, tag_1.tag)('div', {
              class: lClasseRange,
              style: 'height:0; grid-column:1/' + (lNbColonnesVisibles + 1),
              'ie-nodeafter': (0, jsx_1.jsxFuncAttr)('liste.nodeObsRange', [
                false,
                aIndiceRange,
                aInfosZoneColonnes.indiceBloc,
              ]),
              role: 'presentation',
            }),
          );
        }
        return T.join('');
      }
      _construireContenuListe(aInfosZoneColonnes) {
        const T = [];
        const lCouleurBorduresContenu =
          this._options.borduresContenu_couleur ||
          this._options.couleursListe.editable.getBordure(false);
        const lAvecOmbre =
          this._options.skin !== _ObjetListe_1.ObjetListe.skin.flatDesign;
        const lCss = ['conteneur-scroll-bloc conteneur-ombre-zone'];
        if (lAvecOmbre) {
          lCss.push('ombre-top');
          if (!aInfosZoneColonnes.dernierBloc) {
            lCss.push('ombre-top-droite');
          }
          if (aInfosZoneColonnes.indiceBloc > 0) {
            lCss.push('ombre-top-gauche');
          }
        }
        T.push(
          '<div id="',
          this.ids.contenu + aInfosZoneColonnes.indiceBloc,
          '" role="presentation">',
          '<div role="presentation"',
          ' class="' + lCss.join(' ') + '"',
          ' style="',
          this._options.borduresContenu_top > 0
            ? ObjetStyle_1.GStyle.composeCouleurBordure(
                lCouleurBorduresContenu,
                this._options.borduresContenu_top,
                ObjetStyle_2.EGenreBordure.haut,
              )
            : '',
          this._options.borduresContenu_right > 0 &&
            aInfosZoneColonnes.dernierBloc
            ? ObjetStyle_1.GStyle.composeCouleurBordure(
                lCouleurBorduresContenu,
                this._options.borduresContenu_right,
                ObjetStyle_2.EGenreBordure.droite,
              )
            : '',
          this._options.borduresContenu_bottom > 0 &&
            (this._cache.lignesVisibles.length > 0 ||
              !this._hauteurAdapteAuContenu())
            ? ObjetStyle_1.GStyle.composeCouleurBordure(
                lCouleurBorduresContenu,
                this._options.borduresContenu_bottom,
                ObjetStyle_2.EGenreBordure.bas,
              )
            : '',
          this._options.borduresContenu_left > 0 &&
            aInfosZoneColonnes.indiceBloc === 0
            ? ObjetStyle_1.GStyle.composeCouleurBordure(
                lCouleurBorduresContenu,
                this._options.borduresContenu_left,
                ObjetStyle_2.EGenreBordure.gauche,
              )
            : '',
          this._options.paddingContenu_LR
            ? 'padding:0 ' + this._options.paddingContenu_LR + 'px;'
            : '',
          '">',
        );
        if (lAvecOmbre) {
          T.push(this.construireOmbreZoneScroll(aInfosZoneColonnes));
        }
        if (this.ListeTailles) {
          T.push(
            (0, tag_1.tag)(
              'div',
              {
                id: this.ScrollV.getIdZone(aInfosZoneColonnes.idScrollContenu),
                style: 'overflow:hidden;position:relative;',
                'ie-node': (0, jsx_1.jsxFuncAttr)(
                  'liste.getNodeScrollContenuParent',
                  aInfosZoneColonnes.idScrollContenu,
                ),
                role: 'presentation',
              },
              (aHtmlZone) => {
                const lTaillesGrid =
                  this._construireTaillesGrid(aInfosZoneColonnes);
                aHtmlZone.push(
                  IE.jsx.str(
                    IE.jsx.fragment,
                    null,
                    IE.jsx.str('div', {
                      id:
                        this.ids.cadreSelection + aInfosZoneColonnes.indiceBloc,
                      class: 'liste_conteneurCadreSelection',
                      role: 'presentation',
                    }),
                    IE.jsx.str(
                      'div',
                      {
                        id: this.ScrollV.getIdContenu(
                          aInfosZoneColonnes.idScrollContenu,
                        ),
                        role: 'presentation',
                        'ie-node': (0, jsx_1.jsxFuncAttr)(
                          'liste.getNodeScrollContenu',
                        ),
                        style:
                          lTaillesGrid.width > 0
                            ? ObjetStyle_1.GStyle.composeWidth(
                                lTaillesGrid.width,
                              )
                            : false,
                      },
                      () => {
                        return (
                          (aInfosZoneColonnes.indiceBloc === 0
                            ? this._construireFiltres()
                            : '') +
                          this.construireContenuListeInterne(aInfosZoneColonnes)
                        );
                      },
                    ),
                  ),
                );
                if (this._avecRollover()) {
                  aHtmlZone.push(
                    IE.jsx.str(
                      'div',
                      {
                        id:
                          this.ids.rolloverContenuLigne +
                          aInfosZoneColonnes.indiceBloc,
                        class: 'liste_conteneur_rollover left',
                        style:
                          'left:' +
                          (aInfosZoneColonnes.indiceBloc === 0 ? 0 : -1) +
                          'px;',
                      },
                      IE.jsx.str('div', null),
                    ),
                  );
                  aHtmlZone.push(
                    IE.jsx.str(
                      'div',
                      {
                        id:
                          this.ids.rolloverContenuColonne +
                          aInfosZoneColonnes.indiceBloc,
                        class: 'liste_conteneur_rollover top',
                      },
                      IE.jsx.str('div', null),
                    ),
                  );
                  aHtmlZone.push(
                    IE.jsx.str(
                      'div',
                      {
                        id:
                          this.ids.rolloverContenuCellule +
                          aInfosZoneColonnes.indiceBloc,
                        class: 'liste_conteneur_rollover center',
                      },
                      IE.jsx.str('div', null),
                    ),
                  );
                }
              },
            ),
          );
        } else {
          T.push(
            IE.jsx.str('div', {
              id: this.IdPremierElement,
              tabindex: '-1',
              style: 'width:100%; height:100%; overflow:auto',
            }),
          );
        }
        T.push('</div></div>');
        return T.join('');
      }
      _composeImpression(aProportion) {
        if (this.Donnees) {
          this.Donnees.enImpression = true;
        }
        try {
          const lObjetLargeur = {};
          Invocateur_1.Invocateur.evenement(
            'LargeurZoneImpression',
            lObjetLargeur,
          );
          const lCache = {
            largeurPage: lObjetLargeur.width,
            avecScrollHorizontal: false,
          };
          this._calculColonnesCachees(lCache);
          this._getInfosZonesColonnes(lCache);
          const lTaillesColonnes = this._calculerTaillesColonnes(lCache, true);
          const lRatio = (aProportion || 100) / 100;
          const T = [];
          let lTaille, lNombreColonnesFusion;
          const lColonnesVisibles = [];
          if (this.ListeTailles) {
            for (let I = 0; I < this.ListeTailles.length; I++) {
              if (this._estColonneVisible(I, lCache)) {
                lColonnesVisibles.push(I);
              }
            }
          }
          const lLigneFixeTailleColonne = function (aTab) {
            aTab.push('<tr>');
            lColonnesVisibles.forEach((aNumeroColonne) => {
              aTab.push(
                IE.jsx.str(
                  'td',
                  {
                    style:
                      'height:0px;line-height:0px;padding-top: 0px; padding-bottom: 0px;',
                  },
                  IE.jsx.str(
                    'div',
                    {
                      style:
                        lTaillesColonnes[aNumeroColonne].px > 0
                          ? ObjetStyle_1.GStyle.composeWidth(
                              lTaillesColonnes[aNumeroColonne].px * lRatio + 1,
                            )
                          : '',
                    },
                    '\u00A0',
                  ),
                ),
              );
            });
            aTab.push('</tr>');
          };
          T.push('<table class="ObjetListe_Impression tableConteneur">');
          if (!this.ListeTitres && this.ListeTailles) {
            T.push('<tr style="font-size:0px;">');
            lColonnesVisibles.forEach((aNumeroColonne) => {
              T.push(
                IE.jsx.str('td', {
                  style:
                    'padding-left:2px; padding-right:3px; height: 0px;' +
                    (lTaillesColonnes[aNumeroColonne].px > 0
                      ? 'width:' + lTaillesColonnes[aNumeroColonne].px + 'px;'
                      : ''),
                }),
              );
            });
            T.push('</tr>');
          } else if (this.ListeTitres) {
            for (let iLigne = 0; iLigne < this.ListeTitres.length; iLigne++) {
              T.push('<tr class="AlignementMilieu trTitre">');
              const lTitresLigne = this.ListeTitres[iLigne];
              for (let I = 0; lTitresLigne && I < lTitresLigne.length; I++) {
                if (
                  !lTitresLigne[I].fusion &&
                  (this._estColonneVisible(I, lCache) ||
                    (lTitresLigne[I + 1] &&
                      lTitresLigne[I + 1].fusion ===
                        TypeFusionTitreListe_1.TypeFusionTitreListe
                          .FusionGauche))
                ) {
                  let lNbCol = this._estColonneVisible(I, lCache) ? 1 : 0;
                  let lNbLigne = 1;
                  let lTailleColonneCourante =
                    lNbCol > 0 ? lTaillesColonnes[I].px * lRatio - 1 : 0;
                  for (
                    let iColonne = I + 1;
                    iColonne < lTitresLigne.length;
                    iColonne++
                  ) {
                    if (
                      lTitresLigne[iColonne].fusion ===
                        TypeFusionTitreListe_1.TypeFusionTitreListe
                          .FusionGauche &&
                      this._estColonneVisible(iColonne, lCache)
                    ) {
                      lNbCol++;
                      lTailleColonneCourante +=
                        lTaillesColonnes[iColonne].px * lRatio - 1;
                    } else if (
                      lTitresLigne[iColonne].fusion ===
                        TypeFusionTitreListe_1.TypeFusionTitreListe
                          .FusionGauche &&
                      !this._estColonneVisible(iColonne, lCache)
                    ) {
                      continue;
                    } else {
                      break;
                    }
                  }
                  if (lNbCol === 0) {
                    break;
                  }
                  for (let j = iLigne + 1; j < this.ListeTitres.length; j++) {
                    if (
                      this.ListeTitres[j][I] &&
                      this.ListeTitres[j][I].fusion ===
                        TypeFusionTitreListe_1.TypeFusionTitreListe.FusionHaute
                    ) {
                      lNbLigne += 1;
                    } else {
                      break;
                    }
                  }
                  const lColSpan =
                    lNbCol === 1 ? '' : ' colspan="' + lNbCol + '"';
                  const lRowSpan =
                    lNbLigne === 1 ? '' : ' rowspan="' + lNbLigne + '"';
                  const lChaineTitre = lTitresLigne[I].libelle;
                  const lChaineHtml = lTitresLigne[I].libelleHtml;
                  const lAvecTri = this.Donnees && !!this._cache.colonnesTri;
                  const lEstTriColonne =
                    lAvecTri &&
                    this._cache.colonnesTri[I] &&
                    lNbCol === 1 &&
                    (iLigne === this.ListeTitres.length - 1 ||
                      lNbLigne + iLigne === this.ListeTitres.length);
                  T.push(
                    '<th style="font-size:',
                    1.1 * lRatio,
                    'rem;',
                    I === 0 ? 'border-left:#000 1px solid;' : '',
                    '"' + lRowSpan + lColSpan,
                    '>',
                  );
                  if (lEstTriColonne) {
                    const lNumeroTri = this._triCourant.colonne.indexOf(I);
                    const lCarTri =
                      lNumeroTri >= 0 &&
                      this._triCourant.colonne[lNumeroTri] === I
                        ? this._triCourant.genre[lNumeroTri] ===
                          Enumere_TriElement_1.EGenreTriElement.Croissant
                          ? '&#x25BC;'
                          : '&#x25B2;'
                        : '';
                    const lLeft = lTailleColonneCourante / 2 - 9 / 2;
                    T.push(
                      '<div style="position:relative; top:0px; height:' +
                        lRatio * _CONST_hauteurImageTri +
                        'px;">',
                      '<div style="position:absolute; z-index:1; top:-1px; left:',
                      lLeft,
                      'px; font-size:',
                      0.9 * lRatio,
                      'rem;line-height:',
                      0.9 * lRatio,
                      'rem;">',
                      lCarTri,
                      '</div>',
                      '&nbsp;</div>',
                    );
                  }
                  T.push(
                    IE.jsx.str(
                      'div',
                      {
                        style:
                          lTailleColonneCourante > 0
                            ? 'width:' + lTailleColonneCourante + 'px;'
                            : '',
                        class: !lChaineHtml ? 'ie-ellipsis' : false,
                      },
                      lChaineHtml
                        ? lChaineHtml
                        : IE.jsx.str('span', null, lChaineTitre),
                    ),
                    '</th>',
                  );
                }
              }
              T.push('</tr>');
            }
          }
          if (this.ListeTailles && this.Donnees) {
            const lLignesVisibles = [];
            for (let J = 0, lNb = this.Donnees.getNbrLignes(); J < lNb; J++) {
              if (this._estLigneVisible(J)) {
                lLignesVisibles.push(J);
              }
            }
            for (let iIndice = 0; iIndice < lLignesVisibles.length; iIndice++) {
              const J = lLignesVisibles[iIndice];
              const lFusions = this._getFusionColonnesCellule({
                colonnesVisibles: lColonnesVisibles,
                ligne: J,
                indiceColonneDebut: lColonnesVisibles[0],
                indiceColonneFin:
                  lColonnesVisibles[lColonnesVisibles.length - 1],
                dernierBloc: true,
                tailles: lTaillesColonnes,
              });
              T.push('<tr valign="top" class="trContenu">');
              let lPremiereColonne = true;
              lColonnesVisibles.forEach((aNumeroColonne) => {
                if (
                  !lFusions[aNumeroColonne] ||
                  !lFusions[aNumeroColonne].nbCol
                ) {
                  return;
                }
                const lParamsCellule = this._getParamsCellule(
                  aNumeroColonne,
                  J,
                );
                lTaille = lFusions[aNumeroColonne].taille * lRatio;
                lNombreColonnesFusion = lFusions[aNumeroColonne].nbCol;
                let lIndentation =
                  this.Donnees.getIndentationCellule(lParamsCellule) || 0;
                let lSelection = false;
                if (
                  this._options.avecSelectionLigneSurImpression &&
                  lPremiereColonne &&
                  this._etatSelectionCellule({ ligne: J, colonne: -1 })
                ) {
                  lSelection = true;
                  lIndentation += 8;
                }
                const lInfosContenu = this._composeContenu(
                  Object.assign(lParamsCellule, {
                    taille: lTaille - lIndentation,
                    enImpression: true,
                    surProportion: aProportion,
                    avecContenuTronque:
                      this.Donnees.avecContenuTronque(lParamsCellule),
                  }),
                  this.Donnees.getTypeValeur(lParamsCellule),
                );
                T.push(
                  IE.jsx.str(
                    'td',
                    {
                      class: lSelection ? 'ligneSelectionImp' : '',
                      style:
                        'font-size:' +
                        1.1 * lRatio +
                        'rem;' +
                        (lPremiereColonne ? 'border-left:#000 1px solid;' : ''),
                      colspan:
                        lNombreColonnesFusion > 1
                          ? lNombreColonnesFusion
                          : false,
                    },
                    IE.jsx.str(
                      'div',
                      {
                        style:
                          (lTaille > 0
                            ? 'width:' + (lTaille - lIndentation) + 'px;'
                            : '') +
                          (lIndentation > 0
                            ? 'padding-left:' + lIndentation + 'px;'
                            : ''),
                      },
                      lInfosContenu.html,
                    ),
                  ),
                );
                lPremiereColonne = false;
              });
              T.push('</tr>');
            }
            lLigneFixeTailleColonne(T);
          }
          T.push('</table>');
          if (this._avecLigneTotal() && this.ListeTailles) {
            T.push(
              IE.jsx.str(
                'table',
                {
                  class: 'ObjetListe_Impression tableConteneur',
                  style: 'margin-top:1em;',
                },
                (aTab) => {
                  const lLignes =
                    (this.Donnees
                      ? this.Donnees.getListeLignesTotal()
                      : null) ||
                    new ObjetListeElements_1.ObjetListeElements().addElement(
                      null,
                    );
                  lLignes.parcourir((aArticle, aIndex) => {
                    aTab.push(
                      IE.jsx.str('tr', { class: 'trTotal' }, (aTab) => {
                        lColonnesVisibles.forEach((aNumeroColonne) => {
                          const lParams = this._getParamsCellule(
                            aNumeroColonne,
                            -1,
                            { surTotal: true },
                          );
                          if (aArticle) {
                            lParams.ligne = aIndex;
                            lParams.article = aArticle;
                          }
                          const lSansBordureDroite =
                            this._cache.colonnesSansBordureDroit[
                              aNumeroColonne
                            ];
                          const lClassTotal = this.Donnees
                            ? this.Donnees.getClassTotal(lParams)
                            : '';
                          const lAvecBorduresTotal =
                            this.Donnees &&
                            this.Donnees.avecBordureTotalVisible(lParams);
                          let lStyleTotal = '';
                          if (lAvecBorduresTotal) {
                            lStyleTotal =
                              ObjetStyle_1.GStyle.composeCouleurBordure(
                                '#000',
                                1,
                                (lSansBordureDroite
                                  ? 0
                                  : ObjetStyle_2.EGenreBordure.droite) +
                                  ObjetStyle_2.EGenreBordure.bas +
                                  ObjetStyle_2.EGenreBordure.gauche,
                              );
                          }
                          const lContenuTotal = this.Donnees
                            ? this.Donnees.getContenuTotal(lParams)
                            : '';
                          aTab.push(
                            IE.jsx.str(
                              'td',
                              {
                                style:
                                  'font-size:' +
                                  1.1 * lRatio +
                                  'rem;' +
                                  lStyleTotal,
                                class: lClassTotal,
                              },
                              IE.jsx.str(
                                'div',
                                {
                                  style: ObjetStyle_1.GStyle.composeWidth(
                                    lTaillesColonnes[aNumeroColonne].px *
                                      lRatio,
                                  ),
                                },
                                lContenuTotal ? lContenuTotal : '&nbsp;',
                              ),
                            ),
                          );
                        });
                      }),
                    );
                  });
                  lLigneFixeTailleColonne(aTab);
                },
              ),
            );
          }
          return T.join('');
        } finally {
          if (this.Donnees) {
            this.Donnees.enImpression = false;
          }
        }
      }
      _avecLigneTotal() {
        const lListeTotal = this.Donnees
          ? this.Donnees.getListeLignesTotal()
          : null;
        return (
          this._options.avecLigneTotal ||
          (lListeTotal && lListeTotal.count() > 0)
        );
      }
      _getListeLignesTotal() {
        return (
          (this.Donnees ? this.Donnees.getListeLignesTotal() : null) ||
          new ObjetListeElements_1.ObjetListeElements().addElement(null)
        );
      }
      _construireContenuTotal(aInfosZoneColonnes) {
        const T = [];
        const lTaillesGrid = this._construireTaillesGrid(aInfosZoneColonnes);
        let lSansBordureDroite = false;
        let lClassTotal = '';
        let lContenuTotal = '';
        let lDerniereColonne = false;
        let lAvecBordureTotalVisible = false;
        let lAvecPremiereBordureGauche = false;
        const lLignes = this._getListeLignesTotal();
        const lNbLignes = lLignes.count();
        lLignes.parcourir((aArticle, aIndexLigne) => {
          if (!this._cache.gridTotalAccess.ordres[aIndexLigne]) {
            this._cache.gridTotalAccess.ordres[aIndexLigne] = [];
          }
          const lTabAcessLigne =
            this._cache.gridTotalAccess.ordres[aIndexLigne];
          this._cache.gridTotalAccess.sansArticle = true;
          let lFusions = null;
          if (this.Donnees) {
            lFusions = this._getFusionColonnesCellule({
              total: true,
              getParamsCellule: (aNumeroColonne) => {
                return this._getParamsCellule(aNumeroColonne, -1, {
                  surTotal: true,
                  ligne: aIndexLigne,
                  article: aArticle,
                });
              },
              colonnesVisibles: aInfosZoneColonnes.colonnesVisibles,
              indiceColonneDebut: aInfosZoneColonnes.indiceColonneDebut,
              indiceColonneFin: aInfosZoneColonnes.indiceColonneFin,
              dernierBloc:
                aInfosZoneColonnes.dernierBloc ||
                (!aInfosZoneColonnes.dernierBloc &&
                  !aInfosZoneColonnes.estBlocFixe),
            });
          }
          let lIndexColonne = 0;
          aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
            if (
              lFusions &&
              (!lFusions[aNumeroColonne] || !lFusions[aNumeroColonne].nbCol)
            ) {
              if (lTabAcessLigne.length > 0) {
                lTabAcessLigne.push(lTabAcessLigne[lTabAcessLigne.length - 1]);
              }
              return;
            }
            lTabAcessLigne.push(aNumeroColonne);
            lIndexColonne += 1;
            const lParams = this._getParamsCellule(aNumeroColonne, -1, {
              surTotal: true,
            });
            if (aArticle) {
              lParams.ligne = aIndexLigne;
              lParams.article = aArticle;
              this._cache.gridTotalAccess.sansArticle = false;
            }
            let lStyleTotal = '';
            let lBordures = 0;
            if (this.Donnees) {
              lParams.typeCellule = this.Donnees.getTypeCelluleTotal(lParams);
              lSansBordureDroite =
                this._cache.colonnesSansBordureDroit[
                  lFusions[aNumeroColonne].fin
                ];
              lDerniereColonne =
                aInfosZoneColonnes.dernierBloc &&
                aInfosZoneColonnes.indiceColonneFin ===
                  lFusions[aNumeroColonne].fin;
              lClassTotal = this.Donnees.getClassTotal(lParams);
              lAvecBordureTotalVisible =
                this.Donnees.avecBordureTotalVisible(lParams);
              if (
                lAvecBordureTotalVisible &&
                !lSansBordureDroite &&
                !lDerniereColonne
              ) {
                lBordures += ObjetStyle_2.EGenreBordure.droite;
                lClassTotal += ' b-right';
              }
              if (
                !lAvecBordureTotalVisible &&
                !lDerniereColonne &&
                !this._cache.colonnesSansBordureDroit[
                  lFusions[aNumeroColonne].fin + 1
                ]
              ) {
                const lParamsColSuivante = this._getParamsCellule(
                  lFusions[aNumeroColonne].fin + 1,
                  -1,
                  { surTotal: true, ligne: aIndexLigne, article: aArticle },
                );
                lParamsColSuivante.typeCellule =
                  this.Donnees.getTypeCelluleTotal(lParamsColSuivante);
                if (this.Donnees.avecBordureTotalVisible(lParamsColSuivante)) {
                  lBordures += ObjetStyle_2.EGenreBordure.droite;
                  lClassTotal += ' b-right';
                }
              }
              if (lAvecBordureTotalVisible) {
                lBordures += ObjetStyle_2.EGenreBordure.bas;
                lClassTotal += ' b-bottom';
              }
              if (!lAvecBordureTotalVisible && aIndexLigne < lNbLignes - 1) {
                const lParamsLigneSuiv = Object.assign({}, lParams, {
                  ligne: aIndexLigne + 1,
                  article: lLignes.get(aIndexLigne + 1),
                });
                lParamsLigneSuiv.typeCellule =
                  this.Donnees.getTypeCelluleTotal(lParamsLigneSuiv);
                if (this.Donnees.avecBordureTotalVisible(lParamsLigneSuiv)) {
                  lBordures += ObjetStyle_2.EGenreBordure.bas;
                  lClassTotal += ' b-bottom';
                }
              }
              if (
                aInfosZoneColonnes.indiceBloc === 0 &&
                lFusions[aNumeroColonne].debut === 0 &&
                aIndexLigne === 0
              ) {
                lAvecPremiereBordureGauche = lAvecBordureTotalVisible;
              }
              const lNbColonnes = lFusions[aNumeroColonne].nbCol;
              lStyleTotal =
                this._composePaddingCellule() +
                `min-height:${this._getHeightCellule(lParams)}px;` +
                this.Donnees.getStyleTotal(lParams) +
                'grid-column:' +
                lIndexColonne +
                (lNbColonnes > 1 ? ' / ' + (lIndexColonne + lNbColonnes) : '') +
                ';' +
                'grid-row:' +
                (aIndexLigne + 1) +
                ';';
              lContenuTotal = this.Donnees.getContenuTotal(lParams);
              if (lNbColonnes > 1) {
                lIndexColonne += lNbColonnes - 1;
              }
            }
            const lTaille =
              (lFusions
                ? lFusions[aNumeroColonne].taille
                : this._cache.taillesColonne[aNumeroColonne].px) +
              (lDerniereColonne ||
              ObjetStyle_2.EGenreBordure.avecBordure(
                lBordures,
                ObjetStyle_2.EGenreBordure.droite,
              )
                ? 0
                : 1) +
              (ObjetStyle_2.EGenreBordure.avecBordure(
                lBordures,
                ObjetStyle_2.EGenreBordure.gauche,
              )
                ? -1
                : 0);
            T.push(
              IE.jsx.str(
                'div',
                {
                  id: this.getIdCelluleTotal(
                    lParams.colonne,
                    lParams.ligne,
                    false,
                  ),
                  role: 'row',
                  'aria-rowindex': aIndexLigne + 1 + (this.ListeTitres ? 1 : 0),
                  'aria-hidden': 'true',
                  'data-row': lParams.ligne,
                  'data-col': lParams.colonne,
                  'ie-node': 'liste.getNodeCelluleTotal',
                  class: ['liste_cellule_total', lClassTotal],
                  style: lStyleTotal,
                },
                IE.jsx.str(
                  'div',
                  {
                    id: this.getIdCelluleTotal(
                      lParams.colonne,
                      lParams.ligne,
                      true,
                    ),
                    style: ObjetStyle_1.GStyle.composeWidth(lTaille),
                    role: 'gridcell',
                    tabindex: '-1',
                    'data-row': lParams.ligne,
                    'data-col': lParams.colonne,
                    'ie-node': 'liste.getNodeCelluleTotalCell',
                    'aria-colindex': this.getIndiceColonneVisibleDeColonne(
                      lParams.colonne,
                    ),
                  },
                  lContenuTotal ? lContenuTotal : '&nbsp;',
                ),
              ),
            );
          });
        });
        const lHtml = IE.jsx.str(
          'div',
          {
            id: this.ScrollH.getIdContenu(aInfosZoneColonnes.idScrollTotal),
            role: 'presentation',
            class: 'liste_scroll_total',
            style:
              lTaillesGrid.styleGrid +
              (lTaillesGrid.width > 0
                ? ObjetStyle_1.GStyle.composeWidth(lTaillesGrid.width)
                : ''),
          },
          T.join(''),
        );
        return {
          html: lHtml,
          avecPremiereBordureGauche: lAvecPremiereBordureGauche,
          avecDerniereBordureDroite:
            aInfosZoneColonnes.dernierBloc && lAvecBordureTotalVisible,
        };
      }
      _construireLigneTotal(aInfosZoneColonnes) {
        if (!this.ListeTailles) {
          return '';
        }
        const lTotal = this._construireContenuTotal(aInfosZoneColonnes);
        return IE.jsx.str(
          'div',
          {
            class: this.Donnees ? false : 'hide',
            style:
              aInfosZoneColonnes.indiceBloc === 0
                ? ObjetStyle_1.GStyle.composeCouleurBordure(
                    lTotal.avecPremiereBordureGauche
                      ? this._options.couleursListe.editable.getBordure(false)
                      : 'transparent',
                    1,
                    ObjetStyle_2.EGenreBordure.gauche,
                  )
                : '' + aInfosZoneColonnes.dernierBloc
                  ? ObjetStyle_1.GStyle.composeCouleurBordure(
                      lTotal.avecDerniereBordureDroite
                        ? this._options.couleursListe.editable.getBordure(false)
                        : 'transparent',
                      1,
                      ObjetStyle_2.EGenreBordure.droite,
                    )
                  : '',
          },
          IE.jsx.str(
            'div',
            {
              id: this.idTotaux + aInfosZoneColonnes.indiceBloc,
              class: 'conteneur-ombre-zone',
            },
            this.construireOmbreZoneScroll(aInfosZoneColonnes),
            IE.jsx.str(
              'div',
              {
                id: this.ScrollH.getIdZone(aInfosZoneColonnes.idScrollTotal),
                style: 'overflow:hidden;position:relative;',
              },
              lTotal.html,
            ),
          ),
        );
      }
      construireOmbreZoneScroll(aInfosZoneColonnes) {
        const T = [];
        if (!aInfosZoneColonnes.estBlocFixe) {
          if (aInfosZoneColonnes.indiceBloc > 0) {
            T.push(IE.jsx.str('div', { class: 'ombre gauche' }));
          }
          if (!aInfosZoneColonnes.dernierBloc) {
            T.push(IE.jsx.str('div', { class: 'ombre droite' }));
          }
        }
        return T.join('');
      }
      composeCreation(J, aTaillesGrid, aAvecTraitHaut) {
        const T = [];
        const LOnKeyUpNav =
          this.Nom +
          '.navigationClavier (id); if (GNavigateur.isToucheFleche ()) GNavigateur.stopperEvenement (event);';
        const lUneSeuleColonneCreation = this.ListeCreations.length === 1;
        let LId;
        const lNbColonnesVisible = lUneSeuleColonneCreation
          ? 1
          : aTaillesGrid.tabWidth.length;
        this._avecLigneCreationUnique = false;
        if (aTaillesGrid.tabWidth.length > 0) {
          this._avecLigneCreationUnique = true;
          LId = this._getIdCreation(-1, J);
          const lParams = this._getParamsCellule(-1, J, { surCreation: true });
          const lAvecInputFile =
            this.Donnees && this.Donnees.avecSelecFile(lParams);
          T.push(
            '<div id="',
            LId +
              '_Creation" role="row" tabindex="0" ie-node="liste.nodeSurLigneCreationUnique(',
            J,
            ')" class="ligne-creation-modele" style="',
            aTaillesGrid.width > 0
              ? ObjetStyle_1.GStyle.composeWidth(aTaillesGrid.width)
              : '',
            '">',
          );
          delete this._cache.ouvrirSelecteurFileParLigne[J + '_-1'];
          T.push(
            IE.jsx.str(
              'div',
              {
                id: LId,
                class: this.getClassCreation(),
                role: 'gridcell',
                style:
                  J === -1
                    ? aAvecTraitHaut
                      ? ObjetStyle_1.GStyle.composeCouleurBordure(
                          this._options.couleursListe.editable.getBordure(
                            false,
                          ),
                          1,
                          ObjetStyle_2.EGenreBordure.haut,
                        )
                      : ''
                    : ObjetStyle_1.GStyle.composeCouleurBordure(
                        this._options.couleursListe.editable.getBordure(false),
                        1,
                        ObjetStyle_2.EGenreBordure.bas,
                      ),
              },
              IE.jsx.str(
                'div',
                {
                  id: LId + '_div',
                  tabindex: '-1',
                  class: 'liste_celluleGrid divLigneCreation',
                  onkeyup: LOnKeyUpNav,
                  'aria-label':
                    ObjetWAI_1.GObjetWAI.getInfo(
                      ObjetWAI_1.EGenreObjet.NouvelElement,
                    ) +
                    ' ' +
                    ObjetWAI_1.GObjetWAI.getInfo(
                      ObjetWAI_1.EGenreObjet.AvecEdition,
                    ),
                  'ie-model': lAvecInputFile
                    ? (0, jsx_1.jsxFuncAttr)('liste.modeleSelecFileCellule', [
                        J,
                        -1,
                        true,
                      ])
                    : false,
                  'ie-selecfile': !!lAvecInputFile,
                  style: this._composePaddingCellule(),
                },
                IE.jsx.str(
                  'div',
                  {
                    style: `height:${this._getHeightCellule(lParams) - 2 * this._options.paddingCelluleTB}px;`,
                  },
                  IE.jsx.str(
                    'div',
                    null,
                    _ObjetListe_1.ObjetListe.getTitreCreation(
                      this._options.titreCreation,
                    ),
                  ),
                ),
              ),
            ),
          );
          T.push('</div>');
        }
        T.push(
          '<div id="',
          LId +
            '_Creation_Edit" tabindex="-1" ie-event="click-keyup->liste.eventSurLigneCreation"',
          ' class="liste-creation-edition"',
          ' style="',
          this._avecLigneCreationUnique ? 'display:none;' : '',
          !lUneSeuleColonneCreation ? aTaillesGrid.styleGrid : '',
          aTaillesGrid.width > 0
            ? ObjetStyle_1.GStyle.composeWidth(aTaillesGrid.width)
            : '',
          '">',
        );
        let lTaille;
        aTaillesGrid.tabWidth.every((aInfosCol, aIndex) => {
          if (
            !lUneSeuleColonneCreation ||
            this.ListeCreations[0] === aInfosCol.colonne ||
            this._colonneCreationUniqueEnErreur()
          ) {
            lTaille =
              lNbColonnesVisible === 1 ? aTaillesGrid.width : aInfosCol.width;
            const lEstDerniereColonne =
              lNbColonnesVisible === 1 ||
              aIndex === aTaillesGrid.tabWidth.length - 1;
            const lParams = this._getParamsCellule(aInfosCol.colonne, J, {
                surCreation: true,
              }),
              LId = this._getIdCreation(aInfosCol.colonne, J);
            const lListeBordures =
              J === -1
                ? (aAvecTraitHaut ? ObjetStyle_2.EGenreBordure.haut : 0) +
                  (!lEstDerniereColonne ? ObjetStyle_2.EGenreBordure.droite : 0)
                : ObjetStyle_2.EGenreBordure.bas +
                  (!lEstDerniereColonne
                    ? ObjetStyle_2.EGenreBordure.droite
                    : 0);
            T.push(
              IE.jsx.str(
                'div',
                {
                  id: LId,
                  class: this.getClassCreation() + ' Maigre',
                  role: 'presentation',
                  style:
                    this._composePaddingCellule() +
                    (lTaille > 0
                      ? ObjetStyle_1.GStyle.composeWidth(lTaille)
                      : '') +
                    (lListeBordures > 0
                      ? ObjetStyle_1.GStyle.composeCouleurBordure(
                          this._options.couleursListe.editable.getBordure(
                            false,
                          ),
                          1,
                          lListeBordures,
                        )
                      : ''),
                },
                IE.jsx.str(
                  'div',
                  {
                    id: LId + '_div',
                    tabindex: '-1',
                    role: 'presentation',
                    onkeyup: LOnKeyUpNav,
                    style: `height:${this._getHeightCellule(lParams) - 2 * this._options.paddingCelluleTB}px;`,
                    'arial-label': !this._avecLigneCreationUnique
                      ? ObjetWAI_1.GObjetWAI.getInfo(
                          ObjetWAI_1.EGenreObjet.NouvelElement,
                        ) +
                        ' ' +
                        ObjetWAI_1.GObjetWAI.getInfo(
                          ObjetWAI_1.EGenreObjet.AvecEdition,
                        )
                      : false,
                  },
                  lNbColonnesVisible === 1
                    ? _ObjetListe_1.ObjetListe.getTitreCreation(
                        this._options.titreCreation,
                      )
                    : '',
                ),
              ),
            );
            if (lUneSeuleColonneCreation) {
              return false;
            }
          }
          return true;
        });
        T.push('</div>');
        return T.join('');
      }
      _composeCoche(aParams) {
        const lValeur = this.Donnees._getValeur(aParams);
        const lHintHtml = this.Donnees.getHintHtmlForce(aParams);
        const lHint = this.Donnees.getHintForce(aParams);
        const lAttr = {
          'ie-hint': lHintHtml ? `'${lHintHtml}'` : false,
          title: !lHintHtml && lHint ? lHint : false,
        };
        if (typeof lValeur === 'string' && lValeur !== '') {
          return IE.jsx.str(
            'div',
            Object.assign(
              {
                role: 'checkbox',
                'aria-checked': 'true',
                'aria-label':
                  ObjetTraduction_1.GTraductions.getValeur('WAI.Coche'),
                class: lValeur,
                style: 'width:18px; margin:0 auto;',
              },
              lAttr,
            ),
            '\u00A0',
          );
        }
        if (
          lValeur === true ||
          lValeur === ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Verte
        ) {
          return IE.jsx.str(
            'i',
            Object.assign(
              {
                role: 'checkbox',
                'aria-checked': 'true',
                'aria-label':
                  ObjetTraduction_1.GTraductions.getValeur('WAI.Coche'),
                class: 'Image_CocheVerte as-icon m-y-none m-x-top i-large',
              },
              lAttr,
            ),
          );
        }
        if (
          lValeur === ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Grise
        ) {
          return IE.jsx.str(
            'i',
            Object.assign(
              {
                role: 'checkbox',
                'aria-checked': 'mixed',
                'aria-label':
                  ObjetTraduction_1.GTraductions.getValeur('WAI.CochePartiel'),
                class: 'IconCocheGrise  m-y-none m-x-top i-large',
              },
              lAttr,
            ),
            '\u00A0',
          );
        }
        if (
          !lValeur ||
          lValeur === ObjetDonneesListe_1.ObjetDonneesListe.EGenreCoche.Aucune
        ) {
          return IE.jsx.str(
            'div',
            Object.assign(
              { style: 'width: 18px; height:16px; margin:0 auto;' },
              lAttr,
              {
                role: 'checkbox',
                'aria-checked': 'false',
                'aria-label':
                  ObjetTraduction_1.GTraductions.getValeur('WAI.Decoche'),
              },
            ),
          );
        }
        return '';
      }
      _composeContenu(aParamsCellule, aTypeValeur) {
        switch (aTypeValeur) {
          case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Image:
          case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Icon:
            return {
              html: this.composeIconEtImage(
                aParamsCellule,
                aTypeValeur ===
                  ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Icon,
              ),
            };
          case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche:
            return {
              html:
                '<div class="AlignementMilieu" style="width: 100%;">' +
                this._composeCoche(aParamsCellule) +
                '</div>',
            };
          case ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule
            .CocheDeploiement: {
            const lEstDeploiement =
              this.Donnees.estUnDeploiement(aParamsCellule);
            let lDeploye = false;
            if (lEstDeploiement) {
              lDeploye = this.Donnees._estDeploye(aParamsCellule.ligne);
              aParamsCellule._estDeploiement = { expanded: !!lDeploye };
            }
            return {
              html: lEstDeploiement
                ? '<div class="' +
                  (lDeploye
                    ? 'Image_DeploiementListe_Deploye'
                    : 'Image_DeploiementListe_NonDeploye') +
                  '">&nbsp;</div>'
                : '<div style="height:13px;"></div>',
            };
          }
        }
        const lInfosContenu = { html: '', attrTitleCellule: '' };
        const H = [];
        const lParams = Object.assign(aParamsCellule, {
          surEdition: false,
          typeValeur: aTypeValeur,
        });
        const lContenuAffichage = this.Donnees._getContenuAffichage(lParams);
        const lClassLigne =
          (this.Donnees.getClass(lParams) || '') +
          (lParams.avecContenuTronque ? ' Insecable' : '');
        let lStyle = this.Donnees.getStyle(lParams) || '';
        if (lStyle && lStyle.trim && lStyle.endsWith) {
          lStyle = lStyle.trim();
          if (!lStyle.endsWith(';')) {
            lStyle += ';';
          }
        }
        let lAttrTitle = {};
        if (!this.Donnees.enConstruction_cacheRechercheTexte) {
          if (lContenuAffichage.titleHtml) {
            if (lContenuAffichage.titleHtml.startsWith) {
              let lTitle = lContenuAffichage.titleHtml;
              if (!lTitle.startsWith("'") && !lTitle.endsWith("'")) {
                lTitle = `'${lTitle}'`;
              }
              lAttrTitle['ie-hint'] = lTitle;
            }
          } else {
            lAttrTitle.title = lContenuAffichage.title || false;
          }
        }
        if (!aParamsCellule.avecDeploiementDansCellule) {
          lInfosContenu.attrTitleCellule = lAttrTitle;
          lAttrTitle = {};
        }
        H.push(
          IE.jsx.str(
            'div',
            {
              style:
                lStyle +
                (lParams.taille > 0
                  ? ' width:' + lParams.taille + 'px;overflow:hidden;'
                  : '') +
                '',
              class: ['liste_contenu_ligne', lClassLigne ? lClassLigne : ''],
              title: lAttrTitle.title || false,
              'ie-title': lAttrTitle['ie-hint'] || false,
              'ie-ellipsis':
                lContenuAffichage.attrOverflow === 'ie-ellipsis' || false,
              'ie-hintoverflow':
                lContenuAffichage.attrOverflow === 'ie-hintoverflow' || false,
              'aria-labelledby': lContenuAffichage.idsLabel || false,
            },
            lContenuAffichage.valeur,
          ),
        );
        lInfosContenu.html = ObjetChaine_1.GChaine.avecEspaceSiVide(H.join(''));
        return lInfosContenu;
      }
      _composeContenuCellule(aParamsCellule, aLargeur) {
        const H = [];
        let lTaille = aLargeur;
        const lType = this.Donnees.getTypeValeur(aParamsCellule);
        let lHeightContenu =
          this.Donnees.getHauteurMinContenuCellule(aParamsCellule);
        if (!lHeightContenu) {
          lHeightContenu =
            this._getHeightCellule(aParamsCellule) -
            2 * this._options.paddingCelluleTB -
            1;
        }
        const lStyle = `min-height:${lHeightContenu}px;`;
        let lAvecDeploiement = false;
        if (
          this._deploiementSurCellule(aParamsCellule) &&
          lType !==
            ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule
              .CocheDeploiement &&
          this.Donnees.avecImageSurColonneDeploiement(aParamsCellule)
        ) {
          const lAvecEvent =
            !this.Donnees.avecEventDeploiementSurCellule(aParamsCellule);
          H.push(
            IE.jsx.str(
              'div',
              {
                class: [
                  'liste_contenu_cellule_deploiement',
                  lAvecEvent ? ' AvecMain' : '',
                ],
                style: lStyle,
                'ie-node': lAvecEvent
                  ? (0, jsx_1.jsxFuncAttr)('liste.nodeDeploiementLigne', [
                      aParamsCellule.ligne,
                      aParamsCellule.colonne,
                    ])
                  : '',
              },
              IE.jsx.str('div', {
                class: this.Donnees._estDeploye(aParamsCellule.ligne)
                  ? 'Image_DeploiementListe_Deploye'
                  : 'Image_DeploiementListe_NonDeploye',
              }),
            ),
          );
          lTaille = lTaille - 8 - 2;
          lAvecDeploiement = true;
        }
        const lInfosContenu = this._composeContenu(
          Object.assign(aParamsCellule, {
            taille: lTaille,
            avecContenuTronque: this.Donnees.avecContenuTronque(aParamsCellule),
            avecDeploiementDansCellule: lAvecDeploiement,
          }),
          lType,
        );
        H.push(
          IE.jsx.str(
            'div',
            {
              class: 'liste_contenu_cellule_contenu',
              style: ObjetStyle_1.GStyle.composeWidth(lTaille) + lStyle,
            },
            lInfosContenu.html,
          ),
        );
        lInfosContenu.html = H.join('');
        return lInfosContenu;
      }
      _surPreResize() {
        this._cache.calculsTailleColonnesAFaire = true;
        if (!this._donneesRecus) {
          return;
        }
        this.ScrollV.vider();
        if (this._cache.avecScrollHorizontal) {
          this.ScrollH.vider();
        }
        this._enResize = ObjetHtml_1.GHtml.getDisplay(this.Nom);
        if (!this._enResize) {
          return;
        }
        this._annulerCreation();
        this._finaliserEdition({ ignorerActualisation: true });
        this._nettoyerElementsEditionEnCours();
        clearTimeout(this._cache.rechercheTexte.timerSaisie);
        ObjetHtml_1.GHtml.setHtml(this.Nom, '&nbsp;', { ignorerScroll: true });
      }
      _surPostResize() {
        if (!this._donneesRecus) {
          return;
        }
        if (this._enResize && this.Actif) {
          this._actualiser({ conserverSelection: true, sansTriDonnees: true });
        }
        delete this._enResize;
      }
      afficherMenuContextuelTri(aColonne) {
        const lGetTri = (aNumeroTri) => {
          let lGenreTri = this._triCourant.genre[aNumeroTri];
          if (this._triCourant.colonne[aNumeroTri] === aColonne) {
            lGenreTri =
              this._triCourant.genre[aNumeroTri] ===
              Enumere_TriElement_1.EGenreTriElement.Croissant
                ? Enumere_TriElement_1.EGenreTriElement.Decroissant
                : Enumere_TriElement_1.EGenreTriElement.Croissant;
          }
          return lGenreTri;
        };
        if (this._triCourant.nombreTri > 1) {
          ObjetMenuContextuel_1.ObjetMenuContextuel.afficher({
            pere: this,
            initCommandes: (aInstance) => {
              for (let i = 0; i < this._triCourant.nombreTri; i++) {
                aInstance.add(
                  ObjetTraduction_1.GTraductions.getValeur('liste.tri') +
                    ' ' +
                    (i + 1),
                  true,
                  function (aNumeroTri) {
                    this.setColonneTri(
                      aColonne,
                      lGetTri(aNumeroTri),
                      aNumeroTri,
                    );
                  }.bind(this, i),
                  {
                    imageFormate: true,
                    image: IE.jsx.str(
                      'div',
                      {
                        style:
                          'margin-left:auto; margin-right:auto; height:9px;',
                        class: 'AlignementMilieu',
                      },
                      this._getDessinCurseurTri({
                        tri:
                          i === 0
                            ? _ObjetListe_1.NSListe.FlecheTri.principal
                            : _ObjetListe_1.NSListe.FlecheTri.secondaire,
                        triCroissant:
                          lGetTri(i) ===
                          Enumere_TriElement_1.EGenreTriElement.Croissant,
                        top: 1,
                        left: 1,
                      }),
                    ),
                  },
                );
              }
            },
          });
        }
      }
      _surDblClickCellule(aEvent) {
        const lInstance = aEvent.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        if (!lInfos) {
          return;
        }
        const lParams = lInstance._getParamsCellule(
          lInfos.colonne,
          lInfos.ligne,
        );
        if (lInstance.Donnees && lParams.ligne > -1) {
          if (lInstance.Donnees.avecEvenementSelectionDblClick(lParams)) {
            if (lInstance.Pere && lInstance.Evenement) {
              lInstance.callback.appel(
                lInstance._getParamsCallback(
                  Enumere_EvenementListe_1.EGenreEvenementListe
                    .SelectionDblClick,
                  lParams.colonne,
                  lParams.ligne,
                ),
                Enumere_EvenementListe_1.EGenreEvenementListe.SelectionDblClick,
                lParams.colonne,
                lParams.ligne,
              );
            }
          }
        }
      }
      _getHeightListeHorsContenu() {
        let lResult =
          ObjetPosition_1.GPosition.getHeight(this.ids.titre + '0') +
          (this._zoneContenuAvecTraitHaut()
            ? this._options.borduresContenu_top
            : 0) +
          this._options.borduresContenu_bottom;
        lResult +=
          this._options.borduresContenu_top +
          this._options.borduresContenu_bottom;
        if (
          this._cache.avecScrollHorizontal &&
          this._cache.reserverPlaceScrollHorizontal
        ) {
          lResult += this.ScrollH.Largeur;
        }
        if (this._options.piedDeListe && this._options.piedDeListe.height > 0) {
          lResult += this._options.piedDeListe.height + 5;
        }
        if (this._avecLigneTotal()) {
          lResult += $(
            ObjetHtml_1.GHtml.getElement(this.idTotaux + '0'),
          ).outerHeight(true);
        }
        $(
          `#${this.Nom.escapeJQ()} .liste_btnentete, #${this.Nom.escapeJQ()} .liste-totale-fd.liste-footer, #${this.Nom.escapeJQ()} .liste-totale-fd.liste-header`,
        ).each(function () {
          const lRect = ObjetPosition_1.GPosition.getClientRect(this);
          lResult += Math.ceil(lRect.outerHeight);
        });
        return lResult;
      }
      _surMouseDownCellule(aEvent) {
        const lInstance = aEvent.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        delete lInstance._cache.infosMouseDownCellule_apresFinEdition;
        if (!lInfos) {
          return;
        }
        lInstance._surEventDownLigne({
          event: aEvent,
          ligne: lInfos.ligne,
          colonne: lInfos.colonne,
          gestionShift: true,
          gestionMultiSelection: true,
        });
      }
      _surMouseUpCellule(aEvent) {
        const lInstance = aEvent.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        const lInfosMouseDown_afe =
          lInstance._cache.infosMouseDownCellule_apresFinEdition;
        delete lInstance._cache.infosMouseDownCellule_apresFinEdition;
        if (lInstance._estEventSansSelect(aEvent)) {
          return;
        }
        $(this).find('>article').focus();
        if (!lInfos) {
          return;
        }
        if (
          lInfos &&
          lInfosMouseDown_afe &&
          lInfosMouseDown_afe.ligne === lInfos.ligne &&
          lInfosMouseDown_afe.colonne === lInfos.colonne
        ) {
          lInstance._editionDebSurSelection(
            lInfos.colonne,
            lInfos.ligne,
            aEvent,
          );
        }
      }
      _surContextMenuCellule(aEvent) {
        const lInstance = aEvent.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        if (aEvent.originalEvent) {
          aEvent.originalEvent.__contextMenuSurContenu__ = true;
        }
        if (!lInfos || !lInstance.Donnees) {
          return;
        }
        const lParams = lInstance._getParamsCellule(
          lInfos.colonne,
          lInfos.ligne,
          { event: aEvent },
        );
        if (
          lInstance.Donnees.avecMenuContextuel(lParams) &&
          (lInstance.Donnees.options.avecContextMenuSansSelection ||
            lInstance._etatSelectionCellule({
              ligne: lParams.ligne,
              colonne: lParams.colonne,
            })) &&
          !UtilitaireMenuContextuelNatif_1.UtilitaireMenuContextuelNatif.accepter(
            aEvent,
          )
        ) {
          lInstance._ouvrirMenuContextuel(lParams);
        }
      }
      _getBlocDeNumeroColonne(aNumeroColonne) {
        let lInfosBloc = null;
        for (
          let lIndiceBloc = 0;
          lIndiceBloc < this._cache.infosZonesColonnes.length;
          lIndiceBloc++
        ) {
          lInfosBloc = this._cache.infosZonesColonnes[lIndiceBloc];
          if (
            aNumeroColonne >= lInfosBloc.indiceColonneDebut &&
            aNumeroColonne <= lInfosBloc.indiceColonneFin
          ) {
            break;
          }
        }
        return lInfosBloc;
      }
      _afficherRollover(aElement, aLigneColonne) {
        let lPosGabaritColonne = null;
        let lNumeroColonne = aLigneColonne.colonne;
        const lInfosBloc = this._getBlocDeNumeroColonne(aLigneColonne.colonne);
        if (!lInfosBloc) {
          return;
        }
        while (
          !lPosGabaritColonne &&
          lNumeroColonne >= lInfosBloc.indiceColonneDebut
        ) {
          lPosGabaritColonne = lInfosBloc.gabaritColonnesTitre[lNumeroColonne];
          if (!lPosGabaritColonne) {
            lNumeroColonne += -1;
          }
        }
        if (!lPosGabaritColonne) {
          return;
        }
        const lPosition = ObjetPosition_1.GPosition.getRect(aElement);
        let lWidth = lPosGabaritColonne.width + 1;
        let lWidthBloc;
        const lHeight = lPosition.height;
        let lLeftBloc;
        const lTop = lPosition.top + this.ScrollV.Position;
        const lEstPremiereLigne =
          aLigneColonne.ligne === this._cache.lignesVisibles[0];
        const lEstPremiereColonne =
          lInfosBloc.indiceBloc === 0 &&
          lInfosBloc.colonnesVisibles[0] === lNumeroColonne;
        const lEcartColonne = lEstPremiereColonne ? 1 : 0;
        const lEcartLigne = 0;
        let lForcerAffichageBlocPrec;
        let lEstBlocCourant;
        if (
          lInfosBloc.dernierBloc &&
          lInfosBloc.indiceColonneFin === lNumeroColonne &&
          this._cache.infosZonesColonnes.length > 1
        ) {
          lWidth += 1;
        }
        for (let lIBloc = 0; lIBloc <= lInfosBloc.indiceBloc; lIBloc++) {
          lForcerAffichageBlocPrec =
            lInfosBloc.indiceBloc > 0 &&
            lNumeroColonne === lInfosBloc.indiceColonneDebut &&
            lIBloc === lInfosBloc.indiceBloc - 1;
          lEstBlocCourant = lIBloc === lInfosBloc.indiceBloc;
          lLeftBloc = lEstBlocCourant
            ? lPosGabaritColonne.left - 1 + lEcartColonne
            : this._cache.infosZonesColonnes[lIBloc].largeurBloc - 1;
          lWidthBloc = lEstBlocCourant ? lWidth - lEcartColonne : 1;
          if (lEstBlocCourant || lForcerAffichageBlocPrec) {
            $('#' + this.ids.rolloverTitre.escapeJQ() + lIBloc)
              .show()
              .css({ left: lLeftBloc, width: lWidthBloc });
          } else {
            $('#' + this.ids.rolloverTitre.escapeJQ() + lIBloc).hide();
          }
          if (lEstPremiereColonne) {
            $('#' + this.ids.rolloverContenuLigne.escapeJQ() + lIBloc).hide();
          } else {
            $('#' + this.ids.rolloverContenuLigne.escapeJQ() + lIBloc)
              .show()
              .css({
                top: lTop - 1 + lEcartLigne,
                height: lHeight + 1 - lEcartLigne,
                width:
                  (lIBloc === 0 && lInfosBloc.indiceBloc > 0
                    ? this._cache.infosZonesColonnes[lIBloc].largeurBloc + 2
                    : lLeftBloc) + (lInfosBloc.indiceBloc > 0 ? 1 : 0),
              });
          }
          if (
            !lEstPremiereLigne &&
            (lEstBlocCourant || lForcerAffichageBlocPrec)
          ) {
            $('#' + this.ids.rolloverContenuColonne.escapeJQ() + lIBloc)
              .show()
              .css({ left: lLeftBloc, height: lTop, width: lWidthBloc });
          } else {
            $('#' + this.ids.rolloverContenuColonne.escapeJQ() + lIBloc).hide();
          }
          if (lEstBlocCourant || lForcerAffichageBlocPrec) {
            $('#' + this.ids.rolloverContenuCellule.escapeJQ() + lIBloc)
              .show()
              .css({
                left: lLeftBloc,
                top: lTop - 1 + lEcartLigne,
                height: lHeight + 1 - lEcartLigne,
                width: lWidthBloc,
              });
          } else {
            $('#' + this.ids.rolloverContenuCellule.escapeJQ() + lIBloc).hide();
          }
        }
        if (
          !lInfosBloc.dernierBloc &&
          !lInfosBloc.estBlocFixe &&
          lNumeroColonne === lInfosBloc.indiceColonneFin
        ) {
          const lIndiceBloc = lInfosBloc.indiceBloc + 1;
          $('#' + this.ids.rolloverTitre.escapeJQ() + lIndiceBloc)
            .show()
            .css({ left: -1, width: 0 });
          $('#' + this.ids.rolloverContenuColonne.escapeJQ() + lIndiceBloc)
            .show()
            .css({ left: -1, height: lTop, width: 0 });
          $('#' + this.ids.rolloverContenuCellule.escapeJQ() + lIndiceBloc)
            .show()
            .css({
              left: -1,
              top: lTop - 1 + lEcartLigne,
              height: lHeight + 1 - lEcartLigne,
              width: 0,
            });
        }
        return true;
      }
      _gererRollover(aAfficher, aElement, aLigneColonne) {
        if (
          aAfficher &&
          this._avecRollover() &&
          aElement &&
          aLigneColonne &&
          this._afficherRollover(aElement, aLigneColonne)
        ) {
          this._cache.rolloverVisible = true;
        } else if (this._cache.rolloverVisible) {
          this._cache.rolloverVisible = false;
          this._cache.infosZonesColonnes.forEach((aBloc) => {
            $(
              '#' + this.ids.rolloverTitre.escapeJQ() + aBloc.indiceBloc,
            ).hide();
            $(
              '#' + this.ids.rolloverContenuLigne.escapeJQ() + aBloc.indiceBloc,
            ).hide();
            $(
              '#' +
                this.ids.rolloverContenuColonne.escapeJQ() +
                aBloc.indiceBloc,
            ).hide();
            $(
              '#' +
                this.ids.rolloverContenuCellule.escapeJQ() +
                aBloc.indiceBloc,
            ).hide();
          });
        }
      }
      _parcourirCellulesVoileBleu(aParamsCellule, aFunc) {
        this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
          this._cache.lignesVisibles.forEach((aLigne) => {
            aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
              const lParamsCelluleCible = this._getParamsCellule(
                aNumeroColonne,
                aLigne,
              );
              if (
                this.Donnees.estConcerneParSurvolCelluleVisible(
                  lParamsCelluleCible,
                  aParamsCellule,
                )
              ) {
                const lNode = ObjetHtml_1.GHtml.getElement(
                  this.getIdCellule(aNumeroColonne, aLigne),
                );
                if (lNode) {
                  aFunc(lNode);
                }
              }
            });
          });
        });
      }
      _gererHoverSurCellule(aNode, aInfos, aEvent) {
        if (GNavigateur.isTactile) {
          return;
        }
        const lJNodeOrigine = $(aNode);
        const lParamsCellule = this._getParamsCellule(
          aInfos.colonne,
          aInfos.ligne,
        );
        if (
          !(aEvent.ctrlKey && this._avecRollover()) &&
          this.Donnees &&
          this.Donnees.avecSurvolCelluleVisible(lParamsCellule)
        ) {
          this._parcourirCellulesVoileBleu(lParamsCellule, (aNode) => {
            $(aNode).addClass('voileBleuCellule');
            lJNodeOrigine.one('mouseleave', () => {
              $(aNode).removeClass('voileBleuCellule');
            });
          });
        }
        if (this.Donnees && this.Donnees.avecDessinHover(lParamsCellule)) {
          let lAvecElementHaut = false;
          let lAvecElementBas = false;
          let lAvecDessinHover = false;
          const lClassDessinHover = 'dessinHoverListe';
          this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
            const lNodeZone = ObjetHtml_1.GHtml.getElement(
              ObjetHtml_1.GHtml.getElement(
                this.ids.contenu + aInfosZoneColonnes.indiceBloc,
              ),
            );
            const lViewHeight = $(lNodeZone).height();
            this._cache.lignesVisibles.forEach((aLigne) => {
              aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
                const lParamsCelluleCible = this._getParamsCellule(
                  aNumeroColonne,
                  aLigne,
                );
                if (
                  this.Donnees.estConcerneParDessinHover(
                    lParamsCelluleCible,
                    lParamsCellule,
                  )
                ) {
                  let lDirection;
                  const lNode = ObjetHtml_1.GHtml.getElement(
                    this.getIdCellule(aNumeroColonne, aLigne),
                  );
                  if (lNode) {
                    lDirection =
                      ObjetDonneesListe_1.ObjetDonneesListe
                        .TypeDirectionElementSurvolCellule.droite;
                    if (lParamsCelluleCible.colonne < lParamsCellule.colonne) {
                      lDirection =
                        ObjetDonneesListe_1.ObjetDonneesListe
                          .TypeDirectionElementSurvolCellule.gauche;
                    }
                    const lJNode = $(lNode);
                    const lPosition = lJNode.position();
                    const lHeightCellule = lJNode.height();
                    if (lPosition.top + lHeightCellule / 2 < 0) {
                      lDirection =
                        ObjetDonneesListe_1.ObjetDonneesListe
                          .TypeDirectionElementSurvolCellule.haut;
                    } else if (
                      lPosition.top + lHeightCellule / 2 >
                      lViewHeight
                    ) {
                      lDirection =
                        ObjetDonneesListe_1.ObjetDonneesListe
                          .TypeDirectionElementSurvolCellule.bas;
                    }
                  } else {
                    if (aLigne < aInfos.ligne) {
                      lDirection =
                        ObjetDonneesListe_1.ObjetDonneesListe
                          .TypeDirectionElementSurvolCellule.haut;
                    } else if (aLigne > aInfos.ligne) {
                      lDirection =
                        ObjetDonneesListe_1.ObjetDonneesListe
                          .TypeDirectionElementSurvolCellule.bas;
                    } else {
                      return;
                    }
                  }
                  let lConteneur = null;
                  switch (lDirection) {
                    case ObjetDonneesListe_1.ObjetDonneesListe
                      .TypeDirectionElementSurvolCellule.haut:
                      if (!lAvecElementHaut) {
                        lConteneur = lNodeZone;
                        lAvecElementHaut = true;
                      }
                      break;
                    case ObjetDonneesListe_1.ObjetDonneesListe
                      .TypeDirectionElementSurvolCellule.bas:
                      if (!lAvecElementBas) {
                        lConteneur = lNodeZone;
                        lAvecElementBas = true;
                      }
                      break;
                    default:
                      lConteneur = lNode;
                  }
                  if (lConteneur !== null) {
                    lParamsCelluleCible.node = lConteneur;
                    lParamsCelluleCible.direction = lDirection;
                    lParamsCelluleCible.classHover = lClassDessinHover;
                    ObjetHtml_1.GHtml.addHtml(
                      lConteneur,
                      this.Donnees.construireHtmlHover(lParamsCelluleCible),
                    );
                    lAvecDessinHover = true;
                  }
                }
              });
            });
          });
          if (lAvecDessinHover) {
            const lNom = this.Nom.escapeJQ();
            lJNodeOrigine.one('mouseleave', () => {
              $('#' + lNom + ' .' + lClassDessinHover).remove();
            });
          }
        }
      }
      _surMouseEnterOverCellule(aEvent) {
        const lInstance = aEvent.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        if (!lInfos || !lInstance.Donnees) {
          return;
        }
        if (aEvent.type === 'mouseenter') {
          lInstance._gererHoverSurCellule(this, lInfos, aEvent);
        }
        lInstance._gererRollover(
          aEvent.ctrlKey && aEvent.type === 'mouseover',
          this,
          lInfos,
        );
      }
      _surClickCellule(aEvent) {
        const lInstance = aEvent.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        if (!lInfos) {
          return;
        }
        if (lInstance._estEventSansSelect(aEvent)) {
          return;
        }
        lInstance._editionDebSurSelection(lInfos.colonne, lInfos.ligne, aEvent);
        if (
          lInstance.Donnees &&
          lInstance.Donnees.options.avecCocheCBSurLigne
        ) {
          lInstance._modifierCBLigneFlatDesign(
            lInstance._getParamsCellule(lInfos.colonne, lInfos.ligne),
          );
        }
      }
      _surKeyUpCellule(aEvent) {
        const lInstance = aEvent.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        if (!lInfos) {
          return;
        }
        if (
          lInstance._cache.creationEnCours ||
          lInstance._cache.editionEnCours
        ) {
          return;
        }
        const lParamsCellule = lInstance._getParamsCellule(
          lInfos.colonne,
          lInfos.ligne,
        );
        if (
          (ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent) ||
            ToucheClavier_1.ToucheClavierUtil.estEventEdition(aEvent)) &&
          lInstance._estEventSansSelect(aEvent)
        ) {
          return;
        }
        let lBoquerSelection = false;
        if (
          lInstance.Donnees &&
          lInstance._options.skin ===
            _ObjetListe_1.ObjetListe.skin.flatDesign &&
          lInstance.Donnees instanceof
            ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign &&
          lInstance.Donnees.avecCB &&
          lInstance.Donnees.avecCB(lParamsCellule) &&
          (ToucheClavier_1.ToucheClavierUtil.estEventEspace(aEvent) ||
            (ToucheClavier_1.ToucheClavierUtil.estEventRetourChariot(aEvent) &&
              !lInstance.Donnees._avecSelection(lParamsCellule)))
        ) {
          lInstance._modifierCBLigneFlatDesign(lParamsCellule);
          lBoquerSelection = true;
        }
        if (
          !lBoquerSelection &&
          (ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent) ||
            ToucheClavier_1.ToucheClavierUtil.estEventEdition(aEvent))
        ) {
          lInstance._surSelection(lInfos.colonne, lInfos.ligne, {
            surInteractionUtilisateur: true,
          });
          lInstance.surSelectionEvenement(lInfos.colonne, lInfos.ligne, true);
        }
        if (ToucheClavier_1.ToucheClavierUtil.estEventSelection(aEvent)) {
          if (lInstance.surDeploiement(aEvent, lInfos.colonne, lInfos.ligne)) {
            return;
          }
          lInstance._editionDebSurSelection(
            lInfos.colonne,
            lInfos.ligne,
            aEvent,
          );
        }
        if (ToucheClavier_1.ToucheClavierUtil.estEventEdition(aEvent)) {
          lInstance.surEditionDeb(lInfos.colonne, lInfos.ligne);
        } else if (lInstance._estToucheNavigationFlechesClavier(aEvent)) {
          lInstance._navigationFlechesClavier(
            aEvent,
            Object.assign(lInfos, {
              ligneEtColonneFixe: true,
              forcerNavigationFocus: true,
            }),
          );
          aEvent.stopPropagation();
        }
      }
      _surKeyDownCellule(event) {
        const lInstance = event.data.instance;
        const lInfos = lInstance._extraireInfosId(this.id);
        if (!lInfos) {
          return;
        }
        if (
          !lInstance._cache.creationEnCours &&
          !lInstance._cache.editionEnCours &&
          event.ctrlKey &&
          !event.shiftKey
        ) {
          const lCar = String.fromCharCode(event.which).toLowerCase();
          if (lCar === 'c') {
            lInstance._copierCellule(
              lInstance._getParamsCellule(lInfos.colonne, lInfos.ligne),
            );
          } else if (lCar === 'v') {
            lInstance._collerCellule(
              lInstance._getParamsCellule(lInfos.colonne, lInfos.ligne),
            );
          }
        }
      }
      _copierCellule(aParamsCellule) {
        if (
          this.Donnees &&
          aParamsCellule &&
          this.Donnees.surCopier(aParamsCellule)
        ) {
          this._cache.infosZonesColonnes.forEach((aInfosZoneColonnes) => {
            this._cache.lignesVisibles.forEach((aLigne) => {
              aInfosZoneColonnes.colonnesVisibles.forEach((aNumeroColonne) => {
                const lParamsCelluleCible = this._getParamsCellule(
                  aNumeroColonne,
                  aLigne,
                );
                const lNode = ObjetHtml_1.GHtml.getElement(
                  this.getIdCellule(aNumeroColonne, aLigne),
                );
                if (lNode) {
                  const lJNodeSVG = $(lNode).find('.copySVG');
                  if (this.Donnees.estCelluleCopie(lParamsCelluleCible)) {
                    if (lJNodeSVG.length === 0) {
                      ObjetHtml_1.GHtml.addHtml(
                        lNode,
                        this._construireCopySVG(),
                      );
                    }
                  } else if (lJNodeSVG.length > 0) {
                    lJNodeSVG.remove();
                  }
                }
              });
            });
          });
        }
      }
      _collerCellule(aParamsCellule) {
        if (this.Donnees && aParamsCellule) {
          this.Donnees.surColler(aParamsCellule);
        }
      }
      _getLargeurConteneur() {
        this._cache.reserverPlaceScrollHorizontal = false;
        let lLargeur =
          this._cache.largeurTotalCalcule + this._getDiffLargeurContenu();
        if (this._cache.avecScrollHorizontal) {
          this._cache.reserverPlaceScrollHorizontal =
            this._options.avecReservationPlaceScrollHorizontal ||
            lLargeur > this._cache.largeurPage;
          lLargeur = Math.max(
            this._cache.largeurBlocFixe,
            Math.min(lLargeur, this._cache.largeurPage),
          );
        }
        return lLargeur;
      }
      getClassCreation() {
        return 'FondBlanc';
      }
      _avecLigneCreationTitreEnLigne() {
        return (
          !this.avecBoutonCreationDansEntete() && this._avecLigneCreationTitre()
        );
      }
      _zoneContenuAvecTraitHaut() {
        return !(this.ListeTitres && !this._avecLigneCreationTitreEnLigne());
      }
      _surDeplacementScroll() {
        if (!this._cache.timeout_ignorerScrollSortieEdition) {
          if (this._cache.finEditionCreation) {
            if (!this._cache.finEditionCreation.estCreation) {
              this._cache.finEditionCreation();
            }
          } else {
            this._nettoyerElementsEditionEnCours();
          }
        } else {
          const lJSurligneur = $('#' + this.ids.surligneur_edition.escapeJQ());
          if (lJSurligneur.length > 0) {
            const lData = lJSurligneur.data('positionnement');
            if (lData && lData.func) {
              lData.func();
            }
          }
        }
        $(`#${this.Nom.escapeJQ()} .liste_dragInsertion`).remove();
      }
      _evenementScrollV(aGenre, aScrollTop) {
        switch (aGenre) {
          case ObjetScroll_3.EGenreScrollEvenement.Deplacement:
            this._surDeplacementScroll();
            return aScrollTop;
          case ObjetScroll_3.EGenreScrollEvenement.TailleZone: {
            const lHeightListeHorsContenu = this._getHeightListeHorsContenu();
            if (this._hauteurAdapteAuContenu()) {
              aScrollTop = $(
                ObjetHtml_1.GHtml.getElement(
                  this.ScrollV.getIdContenu(EGenreZoneScroll.contenu),
                ),
              ).outerHeight();
              let lHeightMaxListe = null;
              if (
                MethodesObjet_1.MethodesObjet.isFunction(
                  this._options.getHauteurMaxAdapteListe,
                )
              ) {
                lHeightMaxListe = this._options.getHauteurMaxAdapteListe(
                  this.Nom,
                );
              }
              if (MethodesObjet_1.MethodesObjet.isNumber(lHeightMaxListe)) {
                aScrollTop = Math.min(
                  aScrollTop,
                  lHeightMaxListe - lHeightListeHorsContenu,
                );
              } else if (
                this._options.hauteurMaxAdapteContenu > 0 &&
                MethodesObjet_1.MethodesObjet.isNumber(
                  this._options.hauteurMaxAdapteContenu,
                )
              ) {
                aScrollTop = Math.min(
                  aScrollTop,
                  this._options.hauteurMaxAdapteContenu,
                );
              } else if (
                this._options.hauteurAdapteContenu !== Infinity &&
                this._cache.heightConteneur > 0 &&
                !this._options.hauteurMaxAdapteContenu
              ) {
                aScrollTop = Math.min(
                  aScrollTop,
                  this._cache.heightConteneur - lHeightListeHorsContenu,
                );
              }
            } else {
              aScrollTop =
                this._cache.heightConteneur - lHeightListeHorsContenu;
            }
            if (this._options.hauteurZoneContenuListeMin === -1) {
              if (this._cache.lignesVisibles.length > 0) {
                aScrollTop = Math.max(
                  aScrollTop,
                  $('#' + this.getIdCellule(0, 0).escapeJQ()).outerHeight(),
                );
              }
            } else {
              aScrollTop = Math.max(
                aScrollTop,
                this._options.hauteurZoneContenuListeMin,
              );
            }
            return Math.ceil(aScrollTop);
          }
          case ObjetScroll_3.EGenreScrollEvenement.TailleContenu:
            if (!this._hauteurAdapteAuContenu()) {
              const lHauteurContenu = ObjetPosition_1.GPosition.getHeight(
                this.ScrollV.getIdContenu(EGenreZoneScroll.contenu),
              );
              if (this.ScrollV.TailleZone > lHauteurContenu) {
                aScrollTop = this.ScrollV.TailleZone;
              } else {
                aScrollTop = lHauteurContenu - 1;
              }
            }
            return Math.ceil(aScrollTop);
          case ObjetScroll_3.EGenreScrollEvenement.TailleScroll:
            return Math.ceil(
              Math.max(
                this.ScrollV.tailleMin,
                this.ScrollV.TailleZone +
                  ObjetPosition_1.GPosition.getHeight(
                    this.ScrollV.getIdZone(EGenreZoneScroll.titre),
                  ) +
                  1 -
                  (this._avecBoutonsListeHautScroll()
                    ? (this._options.tailleBoutons + 1) *
                      this._cache.boutons.length
                    : 0) -
                  this._options.borduresContenu_bottom,
              ),
            );
        }
      }
      _getLargeurMaxZone() {
        return this._cache.largeurPage - this._getDiffLargeurContenu();
      }
      _evenementScrollH(aGenre, aScrollLeft) {
        switch (aGenre) {
          case ObjetScroll_3.EGenreScrollEvenement.Deplacement:
            this._surDeplacementScroll();
            return aScrollLeft;
          case ObjetScroll_3.EGenreScrollEvenement.TailleContenu:
            return aScrollLeft;
          case ObjetScroll_3.EGenreScrollEvenement.TailleZone: {
            let lTaille = this._cache.largeurTotalCalcule;
            const lTailleMax = this._getLargeurMaxZone();
            let lInc;
            if (lTaille > lTailleMax) {
              if (this._options.scrollHorizontalSurLargeurComplete) {
                lTaille = lTailleMax - this._cache.largeurBlocFixe;
              } else {
                lTaille = 0;
                this._cache.infosZonesColonnes.forEach((aInfos) => {
                  if (aInfos.estBlocFixe) {
                    return;
                  }
                  aInfos.colonnesVisibles.every((aNumeroColonne) => {
                    lInc =
                      this._cache.taillesColonne[aNumeroColonne].px +
                      2 * this._options.paddingCelluleLR +
                      1;
                    if (
                      lTaille + lInc >
                      lTailleMax - this._cache.largeurBlocFixe
                    ) {
                      return false;
                    }
                    lTaille += lInc;
                    return true;
                  });
                });
                if (lTaille === 0) {
                  lTaille = lTailleMax - this._cache.largeurBlocFixe;
                } else {
                  lTaille -= 1;
                }
              }
            }
            return Math.max(lTaille, this._options.largeurZoneContenuListeMin);
          }
        }
      }
      _avecRollover() {
        return !!(
          this._options.avecRollover &&
          ObjetSupport_1.Support.supportPointerEventsNone &&
          this.ListeTitres
        );
      }
      _initParseur() {
        uParseur = '';
        clearTimeout(uTimerParseur);
      }
      _evenementFenetreDate(aParams, aGenreBouton, aDate) {
        if (aGenreBouton === -1) {
          if (aParams.ligne === null || aParams.ligne === undefined) {
            this.surCreationFin(-1);
          } else {
            this._surEditionFin({
              colonne: aParams.colonne,
              ligne: aParams.ligne,
            });
          }
        } else {
          const lValeur =
            aGenreBouton === 1
              ? this.Donnees.getChaineDeDate(aDate, aParams)
              : null;
          if (aParams.ligne === null || aParams.ligne === undefined) {
            this._surCreation(lValeur);
          } else {
            this._surEdition(aParams, lValeur, true);
          }
        }
      }
      getIdGridFocus(aIndiceBloc) {
        return `${this.Nom}_grid_${aIndiceBloc}`;
      }
      _nettoyerElementsEditionEnCours() {
        super._nettoyerElementsEditionEnCours();
        if (this.fenetreDate) {
          this.fenetreDate.fermer();
          delete this.fenetreDate;
        }
      }
      _getLargeurScrollV() {
        return this.ScrollV ? this.ScrollV.Largeur : 0;
      }
      navigationClavierGridTotal(aEvent) {
        var _a, _b, _c, _d, _e, _f;
        if (this._estToucheNavigationFlechesClavier(aEvent)) {
          aEvent.stopPropagation();
          const lNav = this._cache.gridTotalAccess.nav;
          const lNavLigneCorrige = Math.max(0, lNav.ligne);
          const lOrdres = this._cache.gridTotalAccess.ordres;
          switch (aEvent.which) {
            case ToucheClavier_1.ToucheClavier.FlecheGauche: {
              const lCols = lOrdres[lNavLigneCorrige];
              if (lCols) {
                const lIndice = lCols.indexOf(lNav.colonne);
                if (lIndice > 0) {
                  (_a = ObjetHtml_1.GHtml.getElement(
                    this.getIdCelluleTotal(
                      lCols[lIndice - 1],
                      lNav.ligne,
                      true,
                    ),
                  )) === null || _a === void 0
                    ? void 0
                    : _a.focus();
                }
              }
              break;
            }
            case ToucheClavier_1.ToucheClavier.FlecheDroite: {
              const lCols = lOrdres[lNavLigneCorrige];
              if (lCols) {
                let lIndice = lCols.indexOf(lNav.colonne);
                let lTrouve = false;
                while (lIndice >= 0 && lIndice < lCols.length - 1 && !lTrouve) {
                  lIndice += 1;
                  if (lCols[lIndice] > lNav.colonne) {
                    (_b = ObjetHtml_1.GHtml.getElement(
                      this.getIdCelluleTotal(lCols[lIndice], lNav.ligne, true),
                    )) === null || _b === void 0
                      ? void 0
                      : _b.focus();
                    lTrouve = true;
                  }
                }
              }
              break;
            }
            case ToucheClavier_1.ToucheClavier.FlecheBas: {
              const lCols = lOrdres[lNavLigneCorrige];
              if (lNavLigneCorrige < lOrdres.length - 1) {
                let lIndiceCol = lCols.indexOf(lNav.colonne);
                const lColsSuiv = lOrdres[lNavLigneCorrige + 1];
                lIndiceCol = Math.min(lIndiceCol, lColsSuiv.length - 1);
                (_c = ObjetHtml_1.GHtml.getElement(
                  this.getIdCelluleTotal(
                    lColsSuiv[lIndiceCol],
                    lNavLigneCorrige + 1,
                    true,
                  ),
                )) === null || _c === void 0
                  ? void 0
                  : _c.focus();
              }
              break;
            }
            case ToucheClavier_1.ToucheClavier.FlecheHaut: {
              const lCols = lOrdres[lNavLigneCorrige];
              if (lNavLigneCorrige > 0) {
                let lIndiceCol = lCols.indexOf(lNav.colonne);
                const lColsPrec = lOrdres[lNavLigneCorrige - 1];
                lIndiceCol = Math.min(lIndiceCol, lColsPrec.length - 1);
                (_d = ObjetHtml_1.GHtml.getElement(
                  this.getIdCelluleTotal(
                    lColsPrec[lIndiceCol],
                    lNavLigneCorrige - 1,
                    true,
                  ),
                )) === null || _d === void 0
                  ? void 0
                  : _d.focus();
              }
              break;
            }
            case ToucheClavier_1.ToucheClavier.Debut: {
              const lCols = lOrdres[lNavLigneCorrige];
              if (lCols) {
                let lIndiceCol = lCols.indexOf(lNav.colonne);
                let lLigne = lNav.ligne;
                if (aEvent.ctrlKey) {
                  const lColsDebut = lOrdres[0];
                  lLigne = 0;
                  lIndiceCol = Math.min(lIndiceCol, lColsDebut.length - 1);
                } else {
                  lIndiceCol = 0;
                }
                if (lIndiceCol >= 0) {
                  (_e = ObjetHtml_1.GHtml.getElement(
                    this.getIdCelluleTotal(lCols[lIndiceCol], lLigne, true),
                  )) === null || _e === void 0
                    ? void 0
                    : _e.focus();
                  aEvent.preventDefault();
                }
              }
              break;
            }
            case ToucheClavier_1.ToucheClavier.Fin: {
              const lCols = lOrdres[lNavLigneCorrige];
              if (lCols) {
                let lIndiceCol = lCols.indexOf(lNav.colonne);
                let lLigne = lNav.ligne;
                if (aEvent.ctrlKey) {
                  lLigne = lOrdres.length - 1;
                  const lColsFin = lOrdres[lLigne];
                  lIndiceCol = Math.min(lIndiceCol, lColsFin.length - 1);
                } else {
                  lIndiceCol = lCols.length - 1;
                }
                if (lIndiceCol < lCols.length) {
                  (_f = ObjetHtml_1.GHtml.getElement(
                    this.getIdCelluleTotal(lCols[lIndiceCol], lLigne, true),
                  )) === null || _f === void 0
                    ? void 0
                    : _f.focus();
                  aEvent.preventDefault();
                }
              }
              break;
            }
          }
        }
      }
      liaisonWAITitreColonne(aActiver, aPourContenu, aNumeroColonne) {
        let lIdsConteneurTitre = aPourContenu
          ? this.ids.WAIGrid + '_rowtitre'
          : this.ids.WAIGrid + 'total_rowtitre';
        if (aActiver) {
          let lNumeroColTitre = aNumeroColonne;
          let lElementTitre = null;
          let lIdTitre = '';
          while (!lElementTitre && lNumeroColTitre >= 0) {
            lIdTitre = this.getIdAriaTitreDeColonne(lNumeroColTitre);
            lElementTitre = ObjetHtml_1.GHtml.getElement(lIdTitre);
            lNumeroColTitre += -1;
          }
          const lTreeGridTitre =
            ObjetHtml_1.GHtml.getElement(lIdsConteneurTitre);
          if (lTreeGridTitre) {
            lTreeGridTitre.setAttribute(
              'aria-owns',
              lElementTitre ? lIdTitre : '',
            );
          }
        } else {
          const lTreeGridTitre =
            ObjetHtml_1.GHtml.getElement(lIdsConteneurTitre);
          if (lTreeGridTitre) {
            lTreeGridTitre.removeAttribute('aria-owns');
          }
        }
      }
    }
    module.exports = ObjetListeEspace;
  },
  fn: 'objetliste_espace.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetListe = void 0;
    const _ObjetListe_1 = require('_ObjetListe');
    class _ObjetListe extends _ObjetListe_1.ObjetListe {}
    exports.ObjetListe = _ObjetListe;
    if (IE.estMobile) {
      exports.ObjetListe = _ObjetListe = require('ObjetListe_Mobile.js');
    } else {
      exports.ObjetListe = _ObjetListe = require('ObjetListe_Espace.js');
    }
  },
  fn: 'objetliste.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_EditionUrl = void 0;
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const tag_1 = require('tag');
    require('ObjetFenetre_EditionUrl.css');
    class ObjetFenetre_EditionUrl extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          modale: true,
          titre: ObjetTraduction_1.GTraductions.getValeur(
            'fenetreEditionUrl.titre',
          ),
          listeBoutons: [
            {
              libelle: ObjetTraduction_1.GTraductions.getValeur('Annuler'),
              theme: Type_ThemeBouton_1.TypeThemeBouton.secondaire,
            },
            {
              libelle: ObjetTraduction_1.GTraductions.getValeur('Valider'),
              valider: true,
              theme: Type_ThemeBouton_1.TypeThemeBouton.primaire,
            },
          ],
          avecTailleSelonContenu: true,
        });
        this.optionsFenetreEditionUrl = {
          avecLibelle: true,
          avecCommentaire: true,
        };
      }
      setOptionsFenetreEditionUrl(aOptions) {
        Object.assign(this.optionsFenetreEditionUrl, aOptions);
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          avecAffichageLibelle() {
            return aInstance.optionsFenetreEditionUrl.avecLibelle;
          },
          avecAffichageCommentaire() {
            return aInstance.optionsFenetreEditionUrl.avecCommentaire;
          },
          inputLien: {
            getValue: function () {
              return !!aInstance.donnee && !!aInstance.donnee.url
                ? aInstance.donnee.url
                : '';
            },
            setValue: function (aValue) {
              aInstance.donnee.url = aValue;
            },
            exitChange: function (aValue) {
              const lChaine = ObjetChaine_1.GChaine.supprimerEspaces(aValue);
              const lUrl = ObjetChaine_1.GChaine.encoderUrl(
                ObjetChaine_1.GChaine.verifierURLHttp(lChaine),
              );
              aInstance.donnee.url = lUrl;
            },
          },
          inputLibelle: {
            getValue: function () {
              return !!aInstance.donnee && !!aInstance.donnee.libelle
                ? aInstance.donnee.libelle
                : '';
            },
            setValue: function (aValue) {
              aInstance.donnee.libelle = aValue;
            },
          },
          inputCommentaire: {
            getValue: function () {
              return !!aInstance.donnee && !!aInstance.donnee.commentaire
                ? aInstance.donnee.commentaire
                : '';
            },
            setValue: function (aValue) {
              aInstance.donnee.commentaire = aValue;
            },
          },
          fenetreBtn: {
            getDisabled: function (aBoutonRepeat) {
              if (aInstance.donnee && aBoutonRepeat.element.valider === true) {
                return aInstance.donnee.url === '';
              }
              return (
                aInstance.optionsFenetre.listeBoutonsInactifs &&
                aInstance.optionsFenetre.listeBoutonsInactifs[
                  aBoutonRepeat.element.index
                ] === true
              );
            },
          },
        });
      }
      setDonnees(aDonnee) {
        this.donnee = aDonnee;
        this.afficher();
      }
      composeContenu() {
        const lHtml = [];
        lHtml.push('<div class="fen_edition_url">');
        lHtml.push(
          (0, tag_1.tag)(
            'div',
            { class: ['feu_libelle'] },
            ObjetTraduction_1.GTraductions.getValeur('fenetreEditionUrl.lien') +
              ' *',
          ),
        );
        lHtml.push(
          (0, tag_1.tag)('input', {
            class: ['feu_input', 'as-input'],
            'ie-model': 'inputLien',
          }),
        );
        lHtml.push('<div ie-if="avecAffichageLibelle">');
        lHtml.push(
          (0, tag_1.tag)(
            'div',
            { class: ['feu_libelle avecMarge'] },
            ObjetTraduction_1.GTraductions.getValeur(
              'fenetreEditionUrl.libelle',
            ),
          ),
        );
        lHtml.push(
          (0, tag_1.tag)('input', {
            class: ['feu_input', 'as-input'],
            'ie-model': 'inputLibelle',
          }),
        );
        lHtml.push('</div>');
        lHtml.push('<div ie-if="avecAffichageCommentaire">');
        lHtml.push(
          (0, tag_1.tag)(
            'div',
            { class: ['feu_libelle avecMarge'] },
            ObjetTraduction_1.GTraductions.getValeur(
              'fenetreEditionUrl.commentaire',
            ),
          ),
        );
        lHtml.push(
          (0, tag_1.tag)('ie-textareamax', {
            class: ['feu_commentaire'],
            'ie-model': 'inputCommentaire',
            maxlength: 255,
          }),
        );
        lHtml.push('</div>');
        lHtml.push('</div>');
        return lHtml.join('');
      }
      composeBas() {
        const lHTML = [];
        lHTML.push(
          (0, tag_1.tag)(
            'div',
            { class: ['feu_obligatoire'] },
            '* ' +
              ObjetTraduction_1.GTraductions.getValeur(
                'fenetreEditionUrl.obligatoire',
              ),
          ),
        );
        return lHTML.join('');
      }
      getParametresValidation(aNumeroBouton) {
        const lParametres = super.getParametresValidation(aNumeroBouton);
        $.extend(lParametres, { donnee: this.donnee });
        return lParametres;
      }
      static creerInstanceFenetreEditionUrl(aParams) {
        const lFenetre = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_EditionUrl,
          { pere: aParams.pere, evenement: aParams.evenement },
          { largeur: 540 },
        );
        return lFenetre;
      }
    }
    exports.ObjetFenetre_EditionUrl = ObjetFenetre_EditionUrl;
  },
  fn: 'objetfenetre_editionurl.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_PieceJointeCP = exports.DonneesListe_PieceJointeCP =
      void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetPosition_1 = require('ObjetPosition');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const Enumere_EvenementListe_1 = require('Enumere_EvenementListe');
    require('IEHtml.SelecFile.js');
    const ObjetDonneesListe_1 = require('ObjetDonneesListe');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetListe_1 = require('ObjetListe');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const ObjetElement_1 = require('ObjetElement');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetFenetre_EditionUrl_1 = require('ObjetFenetre_EditionUrl');
    const Enumere_Action_1 = require('Enumere_Action');
    class DonneesListe_PieceJointeCP extends ObjetDonneesListe_1.ObjetDonneesListe {
      constructor(
        aDonnees,
        aGenre,
        aGenreRessourceDocJoint,
        aAvecInActifVisible,
        aMultiSelection,
        aAvecGestionLibelleSurLiens,
      ) {
        super(aDonnees);
        this.Genre = aGenre;
        this.genreRessourceDocJoint = aGenreRessourceDocJoint;
        this.avecInActifVisible = aAvecInActifVisible;
        this.avecGestionLibelleSurLiens = aAvecGestionLibelleSurLiens;
        this.creerIndexUnique(['Libelle', 'Genre']);
        this.setOptions({ avecMultiSelection: aMultiSelection !== false });
      }
      getTri() {
        return [ObjetTri_1.ObjetTri.init('Libelle')];
      }
      getVisible(D) {
        let lEstDuGenre = true;
        if (D.estDuGenre !== undefined) {
          lEstDuGenre = D.estDuGenre;
        }
        return (
          D.getGenre() === this.Genre &&
          lEstDuGenre &&
          (D.Actif || this.avecInActifVisible) &&
          D.existeNumero()
        );
      }
      getCouleurCellule() {
        return ObjetDonneesListe_1.ObjetDonneesListe.ECouleurCellule.Blanc;
      }
      initArticle(D, V) {
        if (this.avecGestionLibelleSurLiens) {
          D.Libelle = V[2];
          D.url = ObjetChaine_1.GChaine.verifierURLHttp(V[1]);
          D.Genre = this.Genre;
          D.descriptif = '';
          D.Fichier = V[-1];
        } else {
          D.Libelle = V[1];
          D.Genre = this.Genre;
          D.descriptif = '';
          D.Fichier = V[-1];
        }
      }
      surCreation(D, V) {
        this.initArticle(D, V);
        if (D.Fichier) {
          D.Fichier.Libelle = V[1];
          D.Fichier.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
          this.options.listeFichiers.addElement(D.Fichier);
        }
        D.Actif = true;
        D.nbRelations = 1;
        D.Editable = true;
        D.Date = this.DateCours;
      }
      avecSelecFile(aParams) {
        return (
          aParams.surCreation &&
          this.Genre === Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier
        );
      }
      getOptionsSelecFile() {
        return Object.assign({ multiple: true }, this.options.optionsSelecFile);
      }
      getValeurParDefaut(aParams) {
        return aParams.colonne === 1 &&
          this.Genre === Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
          ? 'http://'
          : '';
      }
      surEdition(aParams, V) {
        if (this.avecGestionLibelleSurLiens) {
          switch (aParams.colonne) {
            case 0: {
              aParams.article.Actif = V;
              break;
            }
            case 1: {
              aParams.article.url = V;
              break;
            }
            case 2: {
              aParams.article.Libelle = V;
              break;
            }
          }
        } else {
          switch (aParams.colonne) {
            case 0: {
              aParams.article.Actif = V;
              break;
            }
            case 1: {
              if (
                this.Genre ===
                Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier
              ) {
                const lExtension =
                  ObjetChaine_1.GChaine.extraireExtensionFichier(
                    aParams.article.Libelle,
                  );
                V = V + '.' + lExtension;
              }
              aParams.article.Libelle = V;
              if (aParams.article.Fichier) {
                aParams.article.Fichier.Libelle = V;
              }
              break;
            }
            case 2: {
              if (
                this.Genre === Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
              ) {
                aParams.article.descriptif = V;
              }
            }
          }
        }
      }
      autoriserChaineVideSurEdition(aParams) {
        return this.avecGestionLibelleSurLiens && aParams.colonne === 2;
      }
      avecEvenementApresEdition() {
        return true;
      }
      avecEvenementApresCreation() {
        return true;
      }
      avecEdition(aParams) {
        return (
          (aParams.colonne < 2 ||
            this.Genre === Enumere_DocumentJoint_1.EGenreDocumentJoint.Url) &&
          aParams.colonne !== 3
        );
      }
      enModification(aParams) {
        return aParams.colonne > 0;
      }
      getValeur(aParams) {
        if (this.avecGestionLibelleSurLiens) {
          switch (aParams.colonne) {
            case 0:
              return aParams.article.Actif;
            case 1:
              return aParams.article.url;
            case 2:
              return aParams.article.Libelle ? aParams.article.Libelle : '';
            case 3:
              return aParams.article.ListeThemes &&
                aParams.article.ListeThemes.count()
                ? aParams.article.ListeThemes.getTableauLibelles().join(', ')
                : '';
            default:
              return '';
          }
        } else {
          switch (aParams.colonne) {
            case 0:
              return aParams.article.Actif;
            case 1:
              return aParams.surEdition &&
                this.Genre ===
                  Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier
                ? ObjetChaine_1.GChaine.extraireNomFichier(
                    aParams.article.Libelle,
                  )
                : aParams.article.Libelle;
            case 2: {
              const lValeur = [];
              if (
                this.Genre ===
                Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier
              ) {
                if (
                  aParams.article.getEtat() !==
                  Enumere_Etat_1.EGenreEtat.Creation
                ) {
                  const lURL = ObjetChaine_1.GChaine.creerUrlBruteLienExterne(
                    aParams.article,
                    { genreRessource: this.genreRessourceDocJoint },
                  );
                  lValeur.push('<a href="', lURL, '" target="_blank">');
                  lValeur.push(
                    '<i class="icon_download_alt" style="',
                    IE.estMobile ? 'font-size:1.6rem' : 'font-size:1.8rem',
                    '"></i>',
                  );
                  lValeur.push('</a>');
                }
              } else {
                if (!!aParams.article.descriptif) {
                  lValeur.push(aParams.article.descriptif);
                }
              }
              return lValeur.join('');
            }
            case 3:
              return aParams.article.ListeThemes &&
                aParams.article.ListeThemes.count()
                ? aParams.article.ListeThemes.getTableauLibelles().join(', ')
                : '';
          }
        }
        return '';
      }
      getTypeValeur(aParams) {
        switch (aParams.colonne) {
          case 0:
            return ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche;
          case 1:
            return ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Texte;
          case 2:
            return this.Genre ===
              Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier
              ? ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Html
              : ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.ZoneTexte;
          case 3:
            return ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Texte;
        }
        return;
      }
      initialisationObjetContextuel(aParametres) {
        aParametres.avecCreation = false;
        super.initialisationObjetContextuel(aParametres);
      }
    }
    exports.DonneesListe_PieceJointeCP = DonneesListe_PieceJointeCP;
    class ObjetFenetre_PieceJointeCP extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.ListeFichiers = new ObjetListeElements_1.ObjetListeElements();
        this.parametres = {};
        this.listeBoutons = [
          ObjetTraduction_1.GTraductions.getValeur('Fermer'),
        ];
        this.listeBoutonsModeLien = [
          ObjetTraduction_1.GTraductions.getValeur('Valider'),
        ];
        this.setOptionsFenetre({
          hauteur: 500,
          largeur: 450,
          listeBoutons: this.listeBoutons,
          avecBoutonActualiser: true,
          avecColonneInfoBulle: true,
          avecBoutonSupprimer: true,
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getDisplayMAJ: function () {
            if (aInstance.estModeFlat()) {
              return false;
            } else {
              return (
                aInstance.Genre ===
                  Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier &&
                aInstance.optionsFenetre.avecBoutonActualiser
              );
            }
          },
          btnMaj: {
            event: function () {
              if (aInstance.estModeFlat()) {
                return;
              }
              aInstance._ouvrirSelecteur();
            },
            getDisabled: function () {
              if (aInstance.estModeFlat()) {
                return true;
              }
              const lListe = aInstance.getListeEltsSelect();
              return lListe.count() !== 1;
            },
            getOptionsSelecFile(aGetSelecFile) {
              if (aInstance.estModeFlat()) {
                return;
              }
              aInstance._ouvrirSelecteur = aGetSelecFile();
              if (
                !!aInstance.optionsFenetre.avecFiltreExtensionSurRemplacer &&
                aInstance.getListeEltsSelect().count() === 1
              ) {
                let lExt;
                const lElm = aInstance.getListeEltsSelect().getPremierElement();
                if (lElm) {
                  lExt = ObjetChaine_1.GChaine.extraireExtensionFichier(
                    lElm.getLibelle(),
                  );
                }
                if (!!lExt) {
                  Object.assign(aInstance.parametres.optionsSelecFile, {
                    accept: '.' + lExt,
                    extensions: [lExt],
                  });
                }
              }
              return aInstance.parametres.optionsSelecFile;
            },
            addFiles: function (aParams) {
              if (aInstance.estModeFlat()) {
                return;
              }
              if (aParams.eltFichier) {
                aInstance._selecFile(aParams.eltFichier);
              }
            },
          },
          getDisplayBtnSuppr: function () {
            return !aInstance.estModeFlat();
          },
          btnSupp: {
            event: function () {
              if (aInstance.estModeFlat()) {
                return;
              }
              aInstance.getInstanceListe().surSuppression();
            },
            getDisabled: function () {
              if (aInstance.estModeFlat()) {
                return true;
              }
              return aInstance.getListeEltsSelect().count() === 0;
            },
          },
        });
      }
      construireInstances() {
        this.IdentListe = this.add(
          ObjetListe_1.ObjetListe,
          this.evenementSurListe,
          this.initialiserListe,
        );
        this.identListeFlat = this.add(
          ObjetListe_1.ObjetListe,
          this.evntSurListeFlat,
          this.initListeFlat,
        );
      }
      avecGestionLibelleSurLiens() {
        return false;
      }
      initialiserListe(AInstance) {
        const lColonnes = [];
        let lColonnesCachees = [];
        let lListeCreations = 1;
        if (this.avecGestionLibelleSurLiens()) {
          lColonnes.push(
            {
              taille: 20,
              titre: { classeCssImage: 'Image_CocheVerte as-icon' },
            },
            {
              taille: '100%',
              titre: {
                libelle: ObjetTraduction_1.GTraductions.getValeur(
                  'selecteurPJ.siteInternet',
                ),
              },
            },
            {
              taille: 160,
              titre: {
                libelle: ObjetTraduction_1.GTraductions.getValeur(
                  'selecteurPJ.nomDocument',
                ),
              },
            },
          );
          if (this.parametres.avecThemes) {
            lColonnes.push({
              taille: 80,
              titre: {
                libelle: ObjetTraduction_1.GTraductions.getValeur('Themes'),
              },
            });
          }
        } else {
          lColonnes.push({ taille: 20 }, { taille: '100%' });
          if (
            this.Genre === Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier
          ) {
            lColonnes.push({ taille: 20 });
          } else if (
            this.optionsFenetre.avecColonneInfoBulle ||
            this.avecGestionLibelleSurLiens()
          ) {
            lColonnes.push({ taille: 200 });
          }
          if (this.parametres.avecThemes) {
            lColonnes.push({ taille: 80 });
          }
        }
        if (this.avecGestionLibelleSurLiens()) {
          lListeCreations = [1];
        }
        if (this.parametres.modeLien === true) {
          lListeCreations = [1];
          lColonnesCachees = [0];
        }
        AInstance.setOptionsListe(
          {
            nonEditable: false,
            avecCelluleEditableTriangle: false,
            colonnes: lColonnes,
            listeCreations: lListeCreations,
            avecLigneCreation: true,
            boutons: this.optionsFenetre.avecBoutonSupprimer
              ? [{ genre: ObjetListe_1.ObjetListe.typeBouton.supprimer }]
              : [],
            colonnesCachees: lColonnesCachees,
          },
          true,
        );
      }
      initListeFlat(aInstance) {
        aInstance.setOptionsListe(
          {
            skin: ObjetListe_1.ObjetListe.skin.flatDesign,
            nonEditableSurModeExclusif: true,
            nonEditable: false,
            avecCelluleEditableTriangle: false,
            avecLigneCreation: true,
            boutons: [],
          },
          true,
        );
      }
      getEltLien() {
        const lListeElement = this.getInstance(
          this.IdentListe,
        ).getListeElementsSelection();
        if (lListeElement.count() === 1) {
          return lListeElement.get(0);
        }
      }
      getLien() {
        let lEltLien = this.getEltLien();
        let lLien = '';
        if (lEltLien !== null && lEltLien !== undefined) {
          lLien = ObjetChaine_1.GChaine.creerUrlBruteLienExterne(lEltLien);
        }
        return lLien;
      }
      _setDocumentsJointsActifs(aListePJTotal, aListePJContexte) {
        if (aListePJTotal && aListePJContexte) {
          aListePJTotal.parcourir((aPJDeListeTotale) => {
            let lExisteDansContexte = false;
            if (aListePJContexte) {
              lExisteDansContexte = !!aListePJContexte.getElementParNumero(
                aPJDeListeTotale.getNumero(),
              );
            }
            aPJDeListeTotale.setActif(lExisteDansContexte);
          });
        }
      }
      afficherFenetrePJ(aParam) {
        this.listePJContexte = aParam.listePJContexte;
        this._setDocumentsJointsActifs(
          aParam.listePJTot,
          aParam.listePJContexte,
        );
        this.setGenre(aParam.genreFenetrePJ);
        this.setDonnees({
          listePiecesJointes: aParam.listePJTot,
          genre: aParam.genrePJ,
          genreRessourceDocJoint: aParam.genreRessourcePJ,
          avecInActifVisible: aParam.avecInActifVisible,
          avecEtatSaisie: aParam.avecEtatSaisie,
          optionsSelecFile: Object.assign(aParam.optionsSelecFile, {
            avecTransformationFlux_versCloud: false,
          }),
          modeLien: aParam.modeLien,
          surValiderAvantFermer: aParam.surValiderAvantFermer,
          validationAuto: aParam.validationAuto,
          contenuCourant: aParam.contenuCourant,
          tafCourant: aParam.tafCourant,
          avecThemes: aParam.avecThemes,
          modeFlat: aParam.modeFlat || false,
        });
      }
      ajouterPiecesJointesAvecAppelCallback(
        aListeNouveauxFichiers,
        aGenreDocJoint,
        aListePJTotale,
        aListePJContexte,
        aAvecCallback = true,
      ) {
        if (aListeNouveauxFichiers) {
          let lControleAjoutDoc;
          if (
            aGenreDocJoint === Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
          ) {
            lControleAjoutDoc = { succes: true };
          } else {
            lControleAjoutDoc = this.controlerFichiersSelectionnes(
              aListeNouveauxFichiers,
              aListePJTotale,
            );
          }
          if (lControleAjoutDoc.succes) {
            this._setDocumentsJointsActifs(aListePJTotale, aListePJContexte);
            aListeNouveauxFichiers.parcourir((aNouveauFichier) => {
              this._ajouterPieceJointeAvecAppelCallback(
                aNouveauFichier,
                aGenreDocJoint,
                aListePJTotale,
              );
            });
            if (aAvecCallback) {
              this.callback.appel();
            }
          } else {
            GApplication.getMessage().afficher({
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
              message: lControleAjoutDoc.msg,
            });
          }
        }
      }
      _ajouterPieceJointeAvecAppelCallback(
        aEltFichier,
        aGenreDocJoint,
        aListePJTotale,
      ) {
        this.ListeFichiers.addElement(aEltFichier);
        aEltFichier.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
        const lNouveauDocJoint = new ObjetElement_1.ObjetElement(
          aEltFichier.getLibelle(),
        );
        lNouveauDocJoint.Genre = aGenreDocJoint;
        lNouveauDocJoint.url = aEltFichier.url || lNouveauDocJoint.getLibelle();
        lNouveauDocJoint.Fichier = aEltFichier;
        lNouveauDocJoint.idFichier = aEltFichier.idFichier;
        lNouveauDocJoint.nomOriginal = aEltFichier.nomOriginal;
        lNouveauDocJoint.file = aEltFichier.file;
        lNouveauDocJoint.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
        aListePJTotale.addElement(lNouveauDocJoint);
      }
      controlerFichiersSelectionnes(aListeFichiersAControler, aListePJTotale) {
        const lResultControle = { succes: true, msg: '' };
        if (aListeFichiersAControler && aListeFichiersAControler.count() > 0) {
          aListeFichiersAControler.parcourir((aFichierAControler) => {
            if (
              this._isLibelleFichierExiste(
                aListePJTotale,
                aFichierAControler.getLibelle(),
              )
            ) {
              lResultControle.succes = false;
              lResultControle.msg = ObjetTraduction_1.GTraductions.getValeur(
                'inputFile.msgEchecLibelleFichierAvecInfo',
              );
            }
            if (!lResultControle.succes) {
              return false;
            }
          });
        }
        return lResultControle;
      }
      _isLibelleFichierExiste(aListeFichiers, aNomFichier) {
        let lExisteFichier = false;
        if (aListeFichiers && aListeFichiers.count() > 0 && aNomFichier) {
          aListeFichiers.parcourir((aFichier) => {
            if (aFichier.existe()) {
              const lLibelleFichier = aFichier.getLibelle();
              if (
                lLibelleFichier &&
                lLibelleFichier.toLowerCase &&
                aNomFichier.toLowerCase
              ) {
                if (
                  lLibelleFichier.trim().toLowerCase() ===
                  aNomFichier.trim().toLowerCase()
                ) {
                  lExisteFichier = true;
                  return false;
                }
              }
            }
          });
        }
        return lExisteFichier;
      }
      setDonnees(aParametres) {
        this.parametres = {
          listePiecesJointes: new ObjetListeElements_1.ObjetListeElements(),
          genre: Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
          genreRessourceDocJoint: null,
          avecInActifVisible: false,
          avecEtatSaisie: true,
          optionsSelecFile: null,
          modeLien: false,
          validationAuto: null,
          contenuCourant: null,
          tafCourant: null,
          avecThemes: false,
          modeFlat: false,
        };
        $.extend(this.parametres, aParametres);
        const lEstModeFlat = this.estModeFlat();
        if (lEstModeFlat) {
          $.extend(this.parametres, {
            callbacks: {
              editerSiteWeb: this._ouvrirFenetreEditionSiteWeb.bind(this),
              supprimerSiteWeb: this._supprimerSiteWeb.bind(this),
            },
          });
        }
        this.ListePiecesJointes = this.parametres.listePiecesJointes;
        this.Genre = this.parametres.genre;
        this.avecEtatSaisie = this.parametres.avecEtatSaisie;
        if (this.avecGestionLibelleSurLiens()) {
          ObjetPosition_1.GPosition.setWidth(this.IdContenu, 560);
        } else {
          ObjetPosition_1.GPosition.setWidth(
            this.IdContenu,
            this.optionsFenetre.largeur,
          );
        }
        const lOptionsFenetre = {
          listeBoutons: this.parametres.modeLien
            ? this.listeBoutonsModeLien
            : this.listeBoutons,
          surValiderAvantFermer: this.parametres.surValiderAvantFermer,
          titre: this.optionsFenetre.avecTitre
            ? this.Genre === Enumere_DocumentJoint_1.EGenreDocumentJoint.Url
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'selecteurPJ.siteInternet',
                )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'selecteurPJ.nomDocument',
                )
            : '',
        };
        this.setOptionsFenetre(lOptionsFenetre);
        this.afficher();
        this.surFixerTaille();
        ObjetHtml_1.GHtml.setDisplay(this.getNomInstanceListe(), !lEstModeFlat);
        ObjetHtml_1.GHtml.setDisplay(
          this.getNomInstanceListeFlat(),
          lEstModeFlat,
        );
        if (lEstModeFlat) {
          this.initListeFlat(this.getInstanceListeFlat());
        } else {
          this.getInstanceListe().effacer();
          this.initialiserListe(this.getInstanceListe());
        }
        this.objPJListe = this.getDonneesListeSelonModeFlat();
        this.setDonneesListe();
        this.$refreshSelf();
      }
      getListeEltsSelect() {
        return this.getInstance(this.IdentListe).getListeElementsSelection();
      }
      getInstanceListe() {
        return this.getInstance(this.IdentListe);
      }
      getNomInstanceListe() {
        return this.getNomInstance(this.IdentListe);
      }
      getInstanceListeFlat() {
        return this.getInstance(this.identListeFlat);
      }
      getNomInstanceListeFlat() {
        return this.getNomInstance(this.identListeFlat);
      }
      getInstanceListeSelonModeFlat() {
        return this.estModeFlat()
          ? this.getInstanceListeFlat()
          : this.getInstanceListe();
      }
      getDonneesListeSelonModeFlat() {
        return this.estModeFlat()
          ? this._getDonneesListeFlat()
          : this._getDonneesListe();
      }
      estModeFlat() {
        return this.parametres.modeFlat === true;
      }
      _getDonneesListe() {
        return new DonneesListe_PieceJointeCP(
          this.ListePiecesJointes,
          this.Genre,
          this.parametres.genreRessourceDocJoint,
          this.parametres.avecInActifVisible,
          this.parametres.modeLien,
        ).setOptions({
          avecEtatSaisie: this.parametres.avecEtatSaisie,
          optionsSelecFile: this.parametres.optionsSelecFile,
          listeFichiers: this.ListeFichiers,
          avecMultiSelection: this.parametres.modeLien,
        });
      }
      _getDonneesListeFlat() {
        return null;
      }
      reset() {
        this.ListeFichiers = new ObjetListeElements_1.ObjetListeElements();
      }
      composeContenu() {
        const T = [];
        T.push(
          '<div id="' +
            this.getNomInstanceListe() +
            '" class="full-height"></div>',
        );
        T.push(
          '<div id="' +
            this.getNomInstanceListeFlat() +
            '" class="full-height" style="display:none;"></div>',
        );
        return T.join('');
      }
      composeBas() {
        const T = [];
        T.push(
          `<div class="compose-bas flex-contain flex-center justify-end">`,
        );
        T.push(`<div ie-display="getDisplayMAJ" class="m-right-l">`);
        T.push(
          IE.estMobile
            ? `<ie-btnicon ie-model="btnMaj" class="icon_refresh avecFond i-medium" ie-selecfile title="${ObjetTraduction_1.GTraductions.getValeur('selecteurPJ.majPJ')}"></ie-btnicon>`
            : `<ie-bouton ie-model="btnMaj" ie-selecfile>${ObjetTraduction_1.GTraductions.getValeur('selecteurPJ.majPJ')}</ie-bouton>`,
        );
        T.push(`</div>`);
        T.push(
          IE.estMobile
            ? `<ie-btnicon ie-display="getDisplayBtnSuppr" ie-model="btnSupp" class="icon_trash avecFond i-medium" title="${ObjetTraduction_1.GTraductions.getValeur('selecteurPJ.supprimerPJ')}"></ie-btnicon>`
            : `<ie-bouton ie-display="getDisplayBtnSuppr" ie-model="btnSupp">${ObjetTraduction_1.GTraductions.getValeur('selecteurPJ.supprimerPJ')}</ie-bouton>`,
        );
        T.push(`</div>`);
        return T.join('');
      }
      actualiserDonneesListe(aParam) {
        this.ListePiecesJointes = this.parametres.listePiecesJointes =
          aParam.listePiecesJointes;
        this.objPJListe = this.getDonneesListeSelonModeFlat();
        let lInstanceListe = this.getInstanceListeSelonModeFlat();
        if (this.objPJListe) {
          lInstanceListe.setDonnees(this.objPJListe);
        }
      }
      setDonneesListe() {
        let lInstanceListe = this.getInstanceListeSelonModeFlat();
        if (this.objPJListe) {
          lInstanceListe.setDonnees(this.objPJListe);
        }
      }
      evenementSurListe(aParametres, AGenreEvenementListe, I) {
        if (
          AGenreEvenementListe ===
          Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition
        ) {
          if (I === 1 && this.listePJContexte && aParametres.article) {
            const lPJ = this.listePJContexte.getElementParNumero(
              aParametres.article.getNumero(),
            );
            if (lPJ) {
              lPJ.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
            }
          }
        }
        if (
          AGenreEvenementListe ===
            Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition ||
          AGenreEvenementListe ===
            Enumere_EvenementListe_1.EGenreEvenementListe.ApresCreation
        ) {
          if (
            !!this.parametres.validationAuto &&
            this.ListePiecesJointes.existeElementPourValidation()
          ) {
            this.parametres.validationAuto();
          }
        }
      }
      evntSurListeFlat(aParametres, AGenreEvenementListe) {
        switch (AGenreEvenementListe) {
          case Enumere_EvenementListe_1.EGenreEvenementListe.Creation:
            this._ouvrirFenetreEditionSiteWeb({
              estCreation: true,
              donneesListe: aParametres.instance.getDonneesListe(),
            });
            break;
        }
      }
      _supprimerSiteWeb(aParam) {
        GApplication.getMessage()
          .afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
            message: ObjetTraduction_1.GTraductions.getValeur(
              'liste.suppressionSelection',
            ),
          })
          .then((aGenreAction) => {
            if (aGenreAction === Enumere_Action_1.EGenreAction.Valider) {
              aParam.data.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
              this.actualiserDonneesListe({
                listePiecesJointes: this.ListePiecesJointes,
              });
            }
          });
      }
      _ouvrirFenetreEditionSiteWeb(aParam) {
        const lFenetreEditionSiteWeb =
          ObjetFenetre_EditionUrl_1.ObjetFenetre_EditionUrl.creerInstanceFenetreEditionUrl(
            {
              pere: this,
              evenement: (aValider, aParams) => {
                if (
                  !!aParams &&
                  !!aParams.bouton &&
                  aParams.bouton.valider &&
                  !!aParams.donnee
                ) {
                  const lDataOut = aParams.donnee;
                  const lUrl = lDataOut.url;
                  let lUrlConforme = true;
                  if (this.avecGestionLibelleSurLiens) {
                    if (
                      lUrl.toLowerCase() === 'http://' ||
                      lUrl.toLowerCase() === 'https://'
                    ) {
                      lUrlConforme = false;
                    }
                  }
                  if (lUrlConforme) {
                    if (!aParam.donneesListe) {
                      return;
                    }
                    let lEstUnDoublon = false;
                    let lMsg = '';
                    const lLibelle = lDataOut.libelle || '';
                    if (aParam.estCreation) {
                      let lNouvelleUrl = ObjetElement_1.ObjetElement.create({
                        Libelle: lLibelle,
                        Numero: ObjetElement_1.ObjetElement.getNumeroCreation(),
                        Genre: Enumere_DocumentJoint_1.EGenreDocumentJoint.Url,
                        url: lUrl,
                        libelle: lLibelle,
                        commentaire: lDataOut.commentaire || '',
                        Date: this.DateCours,
                        PourMemeMatiere: true,
                        PourMemeClasseEtGroupe: true,
                      });
                      lEstUnDoublon =
                        aParam.donneesListe.estUnDoublon(lNouvelleUrl);
                      if (!lEstUnDoublon) {
                        lNouvelleUrl.setEtat(
                          Enumere_Etat_1.EGenreEtat.Creation,
                        );
                        this.ListePiecesJointes.addElement(lNouvelleUrl);
                      } else {
                        lMsg =
                          aParam.donneesListe.getMessageDoublon(lNouvelleUrl);
                      }
                    } else {
                      let lEltEnEdition = aParam.data;
                      let lEltTempPourControle =
                        new ObjetElement_1.ObjetElement(
                          lDataOut.libelle,
                          lEltEnEdition.getNumero(),
                          lEltEnEdition.getGenre(),
                        );
                      $.extend(lEltTempPourControle, lDataOut);
                      lEstUnDoublon =
                        aParam.donneesListe.estUnDoublon(lEltTempPourControle);
                      if (!lEstUnDoublon) {
                        lEltEnEdition.setLibelle(lDataOut.libelle);
                        $.extend(lEltEnEdition, lDataOut);
                        lEltEnEdition.setEtat(
                          Enumere_Etat_1.EGenreEtat.Modification,
                        );
                      } else {
                        lMsg =
                          aParam.donneesListe.getMessageDoublon(
                            lEltTempPourControle,
                          );
                      }
                    }
                    if (lEstUnDoublon && lMsg !== '') {
                      GApplication.getMessage().afficher({
                        type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                          .Information,
                        message: lMsg,
                      });
                    }
                    this.actualiserDonneesListe({
                      listePiecesJointes: this.ListePiecesJointes,
                    });
                  } else {
                    GApplication.getMessage().afficher({
                      type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                        .Information,
                      message:
                        ObjetTraduction_1.GTraductions.getValeur(
                          'URLIncorrecte',
                        ),
                    });
                  }
                }
              },
            },
          );
        lFenetreEditionSiteWeb.setOptionsFenetreEditionUrl({
          avecCommentaire: false,
        });
        let lData = aParam.estCreation
          ? { libelle: '', url: 'http://' }
          : {
              url: aParam.data.url,
              libelle: aParam.data.getLibelle(),
              commentaire: aParam.data.commentaire,
            };
        lFenetreEditionSiteWeb.setDonnees(lData);
      }
      _selecFile(aFichier) {
        this.ListeFichiers.addElement(aFichier);
        const lPJSelectionne = this.getListeEltsSelect().get(0);
        if (!lPJSelectionne) {
          return;
        }
        aFichier.setNumero(lPJSelectionne.getNumero());
        aFichier.setLibelle(lPJSelectionne.getLibelle());
        aFichier.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
        lPJSelectionne.Fichier = aFichier;
        lPJSelectionne.idFichier = aFichier.idFichier;
        lPJSelectionne.Libelle = aFichier.Libelle;
        lPJSelectionne.nomOriginal = aFichier.nomOriginal;
        lPJSelectionne.file = aFichier.file;
        lPJSelectionne.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
        if (this.avecEtatSaisie) {
          this.setEtatSaisie(true);
        }
      }
    }
    exports.ObjetFenetre_PieceJointeCP = ObjetFenetre_PieceJointeCP;
  },
  fn: 'objetfenetre_piecejointecp.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { ObjetTri } = require('ObjetTri.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    const { ObjetDonneesListe } = require('ObjetDonneesListe.js');
    const {
      DonneesListe_PieceJointeCP,
    } = require('ObjetFenetre_PieceJointeCP.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { GChaine } = require('ObjetChaine.js');
    const { UtilitaireSelecFile } = require('UtilitaireSelecFile.js');
    class DonneesListe_PieceJointe extends DonneesListe_PieceJointeCP {
      constructor(
        aDonnees,
        aAvecEtatSaisie,
        aGenre,
        aGenreRessourceDocJoint,
        aMultiSelection,
        aAvecGestionLibelleSurLiens,
      ) {
        super(
          aDonnees,
          aGenre,
          aGenreRessourceDocJoint,
          false,
          aMultiSelection,
          aAvecGestionLibelleSurLiens,
        );
        this.setOptions({ avecEtatSaisie: aAvecEtatSaisie });
        this.PourMemeMatiere = false;
        this.PourMemeClasseEtGroupe = false;
        this.erreurURL = 'erreur_URLInexistante';
      }
      setDonnees(
        aAvecFiltre,
        aPourMemeMatiere,
        aPourMemeClasseEtGroupe,
        aDateDeb,
        aDateFin,
        aDateCours,
      ) {
        this.avecFiltre = aAvecFiltre;
        this.PourMemeMatiere = aPourMemeMatiere;
        this.PourMemeClasseEtGroupe = aPourMemeClasseEtGroupe;
        this.DateDeb = aDateDeb;
        this.DateFin = aDateFin;
        this.DateCours = aDateCours;
      }
      getTri() {
        return [ObjetTri.init('Libelle')];
      }
      getVisible(D) {
        const lEstDansDate =
          !D.Date || (D.Date >= this.DateDeb && D.Date <= this.DateFin);
        let lEstDuGenre = true;
        if (D.estDuGenre !== undefined) {
          lEstDuGenre = D.estDuGenre;
        }
        return (
          D.getGenre() === this.Genre &&
          lEstDuGenre &&
          (D.Actif ||
            ((!this.avecFiltre || !this.PourMemeMatiere || D.PourMemeMatiere) &&
              (!this.PourMemeClasseEtGroupe || D.PourMemeClasseEtGroupe) &&
              lEstDansDate)) &&
          D.existeNumero()
        );
      }
      getCouleurCellule(aParams) {
        return this.genreRessourceDocJoint !==
          EGenreRessource.DocJointEtablissement && aParams.colonne === 3
          ? ObjetDonneesListe.ECouleurCellule.Fixe
          : ObjetDonneesListe.ECouleurCellule.Blanc;
      }
      surCreation(D, V) {
        const lFile = V[-1];
        if (UtilitaireSelecFile.estFichierCloudPartage(lFile)) {
          return { estFichierCloud: true };
        }
        if (this.avecGestionLibelleSurLiens) {
          if (
            V[1].toLowerCase() === 'http://' ||
            V[1].toLowerCase() === 'https://'
          ) {
            return this.erreurURL;
          }
        }
        super.surCreation(D, V);
        D.PourMemeMatiere = true;
        D.PourMemeClasseEtGroupe = true;
      }
      getMessageCreationImpossible(aErreur) {
        if (aErreur && aErreur.estFichierCloud) {
          return '';
        }
        if (aErreur === this.erreurURL) {
          return GTraductions.getValeur('URLIncorrecte');
        } else {
          return super.getMessageCreationImpossible(aErreur);
        }
      }
      avecEdition(aParams) {
        if (
          this.genreRessourceDocJoint !== EGenreRessource.DocJointEtablissement
        ) {
          return (
            (aParams.colonne < 2 || this.avecGestionLibelleSurLiens) &&
            aParams.colonne !== 3
          );
        } else {
          return (
            aParams.colonne === 0 ||
            (aParams.colonne === 1 &&
              DonneesListe_PieceJointe.suppressionAutoriseePJ(
                aParams.article,
                this.genreRessourceDocJoint,
              ))
          );
        }
      }
      surEdition(aParams, V) {
        if (this.avecGestionLibelleSurLiens && aParams.colonne === 1) {
          V = GChaine.verifierURLHttp(V);
          if (V.toLowerCase() === 'http://' || V.toLowerCase() === 'https://') {
            return this.erreurURL;
          }
        }
        return super.surEdition(aParams, V);
      }
      getMessageEditionImpossible(aParams, aErreur) {
        if (aErreur === this.erreurURL) {
          return GTraductions.getValeur('URLIncorrecte');
        } else {
          return super.getMessageEditionImpossible(aParams, aErreur);
        }
      }
      avecSuppression(aParams) {
        return DonneesListe_PieceJointe.suppressionAutoriseePJ(
          aParams.article,
          this.genreRessourceDocJoint,
        );
      }
      avecBordureDroite() {
        return this.options.avecBordure;
      }
      static suppressionAutoriseePJ(aPJ, aGenreRessource) {
        if (!aPJ) {
          return false;
        }
        if (aGenreRessource !== EGenreRessource.DocJointEtablissement) {
          return true;
        } else {
          return aPJ.modifiable !== false;
        }
      }
    }
    module.exports = { DonneesListe_PieceJointe };
  },
  fn: 'donneesliste_piecejointe.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { ObjetTri } = require('ObjetTri.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const {
      ObjetDonneesListeFlatDesign,
    } = require('ObjetDonneesListeFlatDesign.js');
    const { EGenreEtat } = require('Enumere_Etat.js');
    class DonneesListe_PieceJointeFlat extends ObjetDonneesListeFlatDesign {
      constructor(
        aDonnees,
        aAvecEtatSaisie,
        aGenre,
        aGenreRessourceDocJoint,
        aMultiSelection,
        aAvecGestionLibelleSurLiens,
        aCallbacks,
      ) {
        super(aDonnees);
        this.Genre = aGenre;
        this.genreRessourceDocJoint = aGenreRessourceDocJoint;
        this.avecGestionLibelleSurLiens = aAvecGestionLibelleSurLiens;
        this.callbacks = aCallbacks;
        this.PourMemeMatiere = false;
        this.PourMemeClasseEtGroupe = false;
        if (this.avecGestionLibelleSurLiens) {
          this.creerIndexUnique(['url', 'Libelle', 'Genre']);
        } else {
          this.creerIndexUnique(['Libelle', 'Genre']);
        }
        this.setOptions({
          avecCB: true,
          avecCocheCBSurLigne: true,
          avecEvnt_Creation: true,
          avecSelection: false,
          avecEdition: false,
          avecSuppression: false,
          avecBoutonActionLigne: true,
        });
      }
      getValueCB(aParams) {
        return aParams.article ? aParams.article.Actif : false;
      }
      setValueCB(aParams, aValue) {
        aParams.article.setEtat(EGenreEtat.Modification);
        aParams.article.Actif = aValue;
      }
      getTitreZonePrincipale(aParams) {
        const H = [];
        if (this.avecGestionLibelleSurLiens) {
          const lDonnee = aParams.article;
          H.push(lDonnee.Libelle);
        }
        return H.join('');
      }
      getInfosSuppZonePrincipale(aParams) {
        const H = [];
        if (this.avecGestionLibelleSurLiens) {
          const lDonnee = aParams.article;
          H.push(lDonnee.url);
        }
        return H.join('');
      }
      setDonnees(
        aAvecFiltre,
        aPourMemeMatiere,
        aPourMemeClasseEtGroupe,
        aDateDeb,
        aDateFin,
        aDateCours,
      ) {
        this.avecFiltre = aAvecFiltre;
        this.PourMemeMatiere = aPourMemeMatiere;
        this.PourMemeClasseEtGroupe = aPourMemeClasseEtGroupe;
        this.DateDeb = aDateDeb;
        this.DateFin = aDateFin;
        this.DateCours = aDateCours;
      }
      getTri() {
        return [ObjetTri.init('Libelle')];
      }
      getVisible(D) {
        const lEstDansDate =
          !D.Date || (D.Date >= this.DateDeb && D.Date <= this.DateFin);
        let lEstDuGenre = true;
        if (D.estDuGenre !== undefined) {
          lEstDuGenre = D.estDuGenre;
        }
        return (
          D.getGenre() === this.Genre &&
          lEstDuGenre &&
          (D.Actif ||
            ((!this.avecFiltre || !this.PourMemeMatiere || D.PourMemeMatiere) &&
              (!this.PourMemeClasseEtGroupe || D.PourMemeClasseEtGroupe) &&
              lEstDansDate)) &&
          (D.getEtat() === EGenreEtat.Creation || D.existeNumero())
        );
      }
      editionAutorisee(aParams) {
        return (
          this.genreRessourceDocJoint !==
            EGenreRessource.DocJointEtablissement ||
          this.suppressionAutoriseePJ(
            aParams.article,
            this.genreRessourceDocJoint,
          )
        );
      }
      suppressionAutoriseePJ(aPJ, aGenreRessource) {
        if (!aPJ) {
          return false;
        }
        if (aGenreRessource !== EGenreRessource.DocJointEtablissement) {
          return true;
        } else {
          return aPJ.modifiable !== false;
        }
      }
      remplirMenuContextuel(aParams) {
        const lMenu = aParams.menuContextuel;
        const lArticle = aParams.article;
        lMenu.add(
          GTraductions.getValeur('Modifier'),
          this.editionAutorisee(aParams),
          () => {
            this.callbacks.editerSiteWeb({
              estCreation: false,
              data: lArticle,
              donneesListe: this,
            });
          },
          { icon: 'icon_pencil' },
        );
        lMenu.add(
          GTraductions.getValeur('Supprimer'),
          this.suppressionAutoriseePJ(lArticle, this.genreRessourceDocJoint),
          () => {
            this.callbacks.supprimerSiteWeb({ data: lArticle });
          },
          { icon: 'icon_trash' },
        );
      }
    }
    module.exports = { DonneesListe_PieceJointeFlat };
  },
  fn: 'donneesliste_piecejointeflat.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetSaisiePN = void 0;
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetSaisie_1 = require('ObjetSaisie');
    class ObjetSaisiePN extends ObjetSaisie_1.ObjetSaisie {
      constructor(...aParams) {
        super(...aParams);
        this.ListeElements = new ObjetListeElements_1.ObjetListeElements();
      }
      initialiserOptionsObjetSaisie() {
        super.initialiserOptionsObjetSaisie();
        $.extend(this._options, {
          avecEventSurFermetureListe: true,
          forcerBoutonDeploiement: false,
        });
      }
      setDonnees(AListeElements, ASelection, aSansSelection) {
        if (this.listeDeroulee) {
          this.fermerListe(false);
        }
        this.ListeElements = AListeElements
          ? AListeElements
          : new ObjetListeElements_1.ObjetListeElements();
        if (this._options.avecTriListeElements) {
          this.ListeElements.trier();
        }
        this.listeDeroulee = false;
        this.cache.heightScroll = 0;
        this._remplirListe();
        let LLibelle = '&nbsp;';
        if (
          this._options.initAutoSelectionAvecUnElement &&
          !this._options.multiSelection
        ) {
          if (this.ListeElements && this.ListeElements.count() === 1) {
            const lElement = this.ListeElements.get(0);
            if (
              lElement.existe() &&
              lElement.getLibelle() &&
              lElement.getLibelle().length
            ) {
              ASelection = this.Selection = 0;
              LLibelle = this.ListeElements.getLibelle(this.Selection);
            } else {
              this.Selection = -1;
            }
          }
          if (this._options.celluleAvecTexteHtml) {
            this.bouton.setLibelleHtml(LLibelle);
          } else {
            this.bouton.setLibelle(LLibelle);
          }
        }
        if (!aSansSelection) {
          this._surSetDonnnes = true;
          this.setSelection(ASelection);
        }
        const lNbElements = this.ListeElements
          ? this.ListeElements.getNbrElementsExistes()
          : 0;
        if (lNbElements > 1 || this._options.forcerBoutonDeploiement) {
          this.bouton.setAvecBouton(true);
          this.bouton.setActif(true);
        } else {
          this.bouton.setAvecBouton(false);
          this.bouton.setActif(false);
        }
      }
    }
    exports.ObjetSaisiePN = ObjetSaisiePN;
  },
  fn: 'objetsaisiepn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { DonneesListe_PieceJointe } = require('DonneesListe_PieceJointe.js');
    const {
      DonneesListe_PieceJointeFlat,
    } = require('DonneesListe_PieceJointeFlat.js');
    const {
      ObjetFenetre_PieceJointeCP,
    } = require('ObjetFenetre_PieceJointeCP.js');
    const { GChaine } = require('ObjetChaine.js');
    const { GStyle } = require('ObjetStyle.js');
    const { EGenreDocumentJoint } = require('Enumere_DocumentJoint.js');
    const {
      EGenreEvenementObjetSaisie,
    } = require('Enumere_EvenementObjetSaisie.js');
    const { GDate } = require('ObjetDate.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    const { ObjetSaisiePN } = require('ObjetSaisiePN.js');
    const { GUID } = require('GUID.js');
    class ObjetFenetre_PieceJointe extends ObjetFenetre_PieceJointeCP {
      constructor(...aParams) {
        super(...aParams);
        this.ids = {
          deploiementFiltres: GUID.getId(),
          zoneFiltres: GUID.getId(),
        };
        this.PourMemeMatiere = false;
        this.PourMemeClasseEtGroupe = false;
        this.DateDeb = GParametres.PremiereDate;
        this.DateFin = GParametres.DerniereDate;
        this.genrePeriodeFiltre = {
          jourCourant: 0,
          demiMois: 1,
          unMois: 2,
          troisMois: 3,
          sixMois: 4,
          unAn: 5,
        };
        this.setOptionsFenetre({
          avecColonneInfoBulle: false,
          avecBoutonSupprimer: !IE.estMobile,
          avecComposeBasInFooter: IE.estMobile,
          avecDeploiementFiltres: IE.estMobile,
          avecTitre: !IE.estMobile,
          avecCroixFermeture: !IE.estMobile,
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(this), {
          btnMaj: {
            getDisabled: function () {
              if (aInstance.estModeFlat()) {
                return true;
              }
              const lListe = aInstance.getListeEltsSelect();
              return (
                lListe.count() !== 1 ||
                !DonneesListe_PieceJointe.suppressionAutoriseePJ(
                  lListe.get(0),
                  aInstance.parametres.genreRessourceDocJoint,
                )
              );
            },
          },
          btnSupp: {
            getDisabled: function () {
              if (aInstance.estModeFlat()) {
                return true;
              }
              const lListe = aInstance.getListeEltsSelect();
              if (lListe.count() === 0) {
                return true;
              }
              let lAvecSuppression = true;
              lListe.parcourir((D) => {
                if (
                  !DonneesListe_PieceJointe.suppressionAutoriseePJ(
                    D,
                    aInstance.parametres.genreRessourceDocJoint,
                  )
                ) {
                  lAvecSuppression = false;
                  return false;
                }
              });
              return !lAvecSuppression;
            },
          },
          nodeDeploiementFiltres: function () {
            const lMap = {
              click: function () {
                const lEstDeploye =
                  $('#' + this.ids.zoneFiltres.escapeJQ()).css('display') !==
                  'none';
                if (lEstDeploye) {
                  $('#' + this.ids.zoneFiltres.escapeJQ()).css(
                    'display',
                    'none',
                  );
                  $('#' + this.ids.deploiementFiltres.escapeJQ())
                    .children()
                    .first()
                    .removeClass('icon_chevron_up')
                    .addClass('icon_chevron_down');
                } else {
                  $('#' + this.ids.zoneFiltres.escapeJQ()).css('display', '');
                  $('#' + this.ids.deploiementFiltres.escapeJQ())
                    .children()
                    .first()
                    .removeClass('icon_chevron_down')
                    .addClass('icon_chevron_up');
                }
              }.bind(aInstance),
            };
            $(this.node).on(lMap);
          },
          checkFiltreMemeMatiere: {
            getValue: function () {
              return !!aInstance.PourMemeMatiere;
            },
            setValue: function (aValeur) {
              aInstance.PourMemeMatiere = aValeur;
              aInstance.setDonneesListe();
            },
          },
          checkFiltreMemeClasseGroupe: {
            getValue: function () {
              return !!aInstance.PourMemeClasseEtGroupe;
            },
            setValue: function (aValeur) {
              aInstance.PourMemeClasseEtGroupe = aValeur;
              aInstance.setDonneesListe();
            },
          },
        });
      }
      avecGestionLibelleSurLiens() {
        return this.Genre === EGenreDocumentJoint.Url;
      }
      construireInstances(...aParams) {
        super.construireInstances(...aParams);
        this.IdentCombo = this.add(
          ObjetSaisiePN,
          _EvenementSurCombo,
          _InitialiserCombo,
        );
      }
      setOptions(aOptions) {
        this.setOptionsFenetre(aOptions);
      }
      afficherFenetrePJ(aParam) {
        this._setDocumentsJointsActifs(
          aParam.listePJTot,
          aParam.listePJContexte,
        );
        this.setGenre(aParam.genreFenetrePJ);
        this.setDonnees({
          listePiecesJointes: aParam.listePJTot,
          genre: aParam.genrePJ,
          genreRessourceDocJoint: aParam.genreRessourcePJ,
          avecFiltre: aParam.avecFiltre,
          listePeriodes: aParam.listePeriodes
            ? aParam.listePeriodes
            : _getListePeriodesParDefaut.call(this),
          dateCours: aParam.dateCours,
          avecEtatSaisie: aParam.avecEtatSaisie,
          optionsSelecFile: aParam.optionsSelecFile,
          modeLien: aParam.modeLien,
          surValiderAvantFermer: aParam.surValiderAvantFermer,
          validationAuto: aParam.validationAuto,
          contenuCourant: aParam.contenuCourant,
          tafCourant: aParam.tafCourant,
          avecThemes: aParam.avecThemes,
          modeFlat: aParam.modeFlat || false,
        });
      }
      setDonnees(aParametres) {
        super.setDonnees(
          $.extend(
            {
              genre: EGenreDocumentJoint.Fichier,
              avecFiltre: { date: false, classeMatiere: false },
              listePeriodes: null,
              dateCours: null,
              genreRessourceDocJoint: EGenreRessource.DocumentJoint,
            },
            aParametres,
          ),
        );
        const lAvecDate =
          this.parametres.avecFiltre &&
          this.parametres.avecFiltre.date &&
          this.parametres.genreRessourceDocJoint !==
            EGenreRessource.DocJointEtablissement;
        this.getInstance(this.IdentCombo).setVisible(lAvecDate);
        this.DateCours = this.parametres.dateCours
          ? GDate.getJour(this.parametres.dateCours)
          : this.parametres.dateCours;
        const lAvecFiltres =
          lAvecDate ||
          (this.parametres.avecFiltre &&
            this.parametres.avecFiltre.classeMatiere);
        GStyle.setDisplay(this.ids.deploiementFiltres, lAvecFiltres);
        GStyle.setDisplay(this.Nom + '_Filtre_1', lAvecFiltres && lAvecDate);
        GStyle.setDisplay(
          this.Nom + '_Filtre_2',
          lAvecFiltres && this.parametres.avecFiltre.classeMatiere,
        );
        this.surFixerTaille();
        if (this.parametres.listePeriodes && this.parametres.dateCours) {
          this.parametres.listePeriodes.setLibelle(
            0,
            GDate.formatDate(
              this.parametres.dateCours,
              GChaine.format(GTraductions.getValeur('fenetrePJ.le'), [
                '%JJ %MMMM',
              ]),
            ),
          );
        }
        const lInstance = this.getInstance(this.IdentCombo);
        lInstance.setLabel(
          this.Genre === EGenreDocumentJoint.Url
            ? GTraductions.getValeur(
                'fenetrePJ.filtre.uniquementLiensUtilisees',
              )
            : GTraductions.getValeur('fenetrePJ.filtre.uniquementPJUtilisees'),
        );
        lInstance.setDonnees(
          this.parametres.listePeriodes,
          this.parametres.genreRessourceDocJoint !==
            EGenreRessource.DocJointEtablissement
            ? 1
            : undefined,
        );
      }
      _getDonneesListe() {
        let lDonneesListe = new DonneesListe_PieceJointe(
          this.ListePiecesJointes,
          this.parametres.avecEtatSaisie,
          this.Genre,
          this.parametres.genreRessourceDocJoint,
          this.parametres.modeLien,
          this.avecGestionLibelleSurLiens(),
        );
        return lDonneesListe.setOptions({
          avecEtatSaisie: this.parametres.avecEtatSaisie,
          optionsSelecFile: this.parametres.optionsSelecFile,
          listeFichiers: this.ListeFichiers,
          avecMultiSelection: this.parametres.modeLien,
          avecBordure: !IE.estMobile,
        });
      }
      _getDonneesListeFlat() {
        let lDonneesListe = new DonneesListe_PieceJointeFlat(
          this.ListePiecesJointes,
          this.parametres.avecEtatSaisie,
          this.Genre,
          this.parametres.genreRessourceDocJoint,
          this.parametres.modeLien,
          this.avecGestionLibelleSurLiens(),
          this.parametres.callbacks,
        );
        return lDonneesListe.setOptions({
          avecEtatSaisie: this.parametres.avecEtatSaisie,
          optionsSelecFile: this.parametres.optionsSelecFile,
          listeFichiers: this.ListeFichiers,
          avecMultiSelection: this.parametres.modeLien,
          avecBordure: !IE.estMobile,
        });
      }
      composeContenu() {
        const T = [];
        T.push(
          `<div id="${this.Nom}_parent" class="flex-contain cols full-height">`,
        );
        if (this.optionsFenetre.avecDeploiementFiltres) {
          T.push(
            '  <div ie-node="nodeDeploiementFiltres" id="',
            this.ids.deploiementFiltres,
            '" class="filtres-header">',
          );
          T.push('    <i class="icon_chevron_down"></i>');
          T.push(
            '    <h3>',
            this.Genre === EGenreDocumentJoint.Url
              ? GTraductions.getValeur('fenetrePJ.filtre.titreRechercheSites')
              : GTraductions.getValeur('fenetrePJ.filtre.titreRecherchePJ'),
            '</h3>',
          );
          T.push('  </div>');
        }
        T.push(
          `    <div class="filtres-content" id="${this.ids.zoneFiltres}" ${this.optionsFenetre.avecDeploiementFiltres ? ` style="display:none;"` : ``}>`,
        );
        T.push(
          `      <div class="field-contain" id="${this.Nom}_Filtre_1" ${this.parametres.avecFiltre && this.parametres.avecFiltre.date ? `` : `style="display:none"`}>\n                    <div id="${this.getNomInstance(this.IdentCombo)}"></div>\n                  </div>`,
        );
        T.push(
          `      <div class="field-contain" id="${this.Nom}_Filtre_2" ${this.parametres.avecFiltre && this.parametres.avecFiltre.classeMatiere ? `` : `style="display:none"`}>\n                    <ie-checkbox class="m-right-l" ie-model="checkFiltreMemeMatiere">${GTraductions.getValeur('fenetrePJ.filtre.memeMatiere')}</ie-checkbox>\n                    <ie-checkbox ie-model="checkFiltreMemeClasseGroupe">${GTraductions.getValeur('fenetrePJ.filtre.memeClasseGpe')}</ie-checkbox>\n                  </div>`,
        );
        T.push(`    </div>`);
        T.push(
          `    <div class="listeFenetrePJ fluid-bloc" id="${this.getNomInstanceListe()}"></div>`,
        );
        T.push(
          `    <div class="listeFenetrePJ fluid-bloc" id="${this.getNomInstanceListeFlat()}" style="display:none;"></div>`,
        );
        T.push(`</div>`);
        return T.join('');
      }
      setDonneesListe() {
        if (this.objPJListe) {
          this.objPJListe.setDonnees(
            this.parametres.avecFiltre,
            this.PourMemeMatiere,
            this.PourMemeClasseEtGroupe,
            this.DateDeb,
            this.DateFin,
            this.DateCours,
          );
          super.setDonneesListe();
        }
      }
    }
    function _InitialiserCombo(aInstance) {
      const lStr =
        this.Genre === EGenreDocumentJoint.Url
          ? GTraductions.getValeur('fenetrePJ.filtre.uniquementLiensUtilisees')
          : GTraductions.getValeur('fenetrePJ.filtre.uniquementPJUtilisees');
      const lParam = { labelWAICellule: lStr };
      const lLabel = lStr;
      $.extend(
        lParam,
        IE.estMobile
          ? { libelleHaut: lLabel, longueur: 200 }
          : { texteEdit: lLabel, longueur: 150 },
      );
      aInstance.setOptionsObjetSaisie(lParam);
    }
    function _getListePeriodesParDefaut() {
      const lListePeriodesParDefaut = new ObjetListeElements();
      lListePeriodesParDefaut.addElement(
        new ObjetElement(
          GTraductions.getValeur('fenetrePJ.filtre.today'),
          this.genrePeriodeFiltre.jourCourant,
          this.genrePeriodeFiltre.jourCourant,
        ),
      );
      lListePeriodesParDefaut.addElement(
        new ObjetElement(
          GTraductions.getValeur('fenetrePJ.filtre.15jours'),
          this.genrePeriodeFiltre.demiMois,
          this.genrePeriodeFiltre.demiMois,
        ),
      );
      lListePeriodesParDefaut.addElement(
        new ObjetElement(
          GTraductions.getValeur('fenetrePJ.filtre.1mois'),
          this.genrePeriodeFiltre.unMois,
          this.genrePeriodeFiltre.unMois,
        ),
      );
      lListePeriodesParDefaut.addElement(
        new ObjetElement(
          GTraductions.getValeur('fenetrePJ.filtre.3mois'),
          this.genrePeriodeFiltre.troisMois,
          this.genrePeriodeFiltre.troisMois,
        ),
      );
      lListePeriodesParDefaut.addElement(
        new ObjetElement(
          GTraductions.getValeur('fenetrePJ.filtre.6mois'),
          this.genrePeriodeFiltre.sixMois,
          this.genrePeriodeFiltre.sixMois,
        ),
      );
      lListePeriodesParDefaut.addElement(
        new ObjetElement(
          GTraductions.getValeur('fenetrePJ.filtre.12mois'),
          this.genrePeriodeFiltre.unAn,
          this.genrePeriodeFiltre.unAn,
        ),
      );
      return lListePeriodesParDefaut;
    }
    function _EvenementSurCombo(aParams) {
      if (aParams.genreEvenement === EGenreEvenementObjetSaisie.selection) {
        const LNbrMois = [0, 0.5, 1, 3, 6];
        if (aParams.indice === this.genrePeriodeFiltre.unAn) {
          this.DateDeb = GParametres.PremiereDate;
          this.DateFin = GParametres.DerniereDate;
        } else {
          const lDate = this.DateCours ? this.DateCours : new Date();
          this.DateDeb = new Date(
            lDate - 30 * (1000 * 60 * 60 * 24) * LNbrMois[aParams.indice],
          );
          this.DateFin = lDate;
        }
        this.setDonneesListe();
      }
    }
    module.exports = ObjetFenetre_PieceJointe;
  },
  fn: 'objetfenetre_piecejointe.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireOAuth2 = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const Invocateur_1 = require('Invocateur');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const UtilitaireOAuth2 = {
      revocation(aIdOAuth2, aCallback) {
        new ObjetRequeteOAuth2Attente()
          .lancerRequete({ idOAuth2: aIdOAuth2, revocation: true })
          .then((aJSON) => {
            if (!!aJSON) {
              GEtatUtilisateur.listeCloud.parcourir((aCloud) => {
                if (!!aCloud.idOAuth2 && aCloud.idOAuth2 === aIdOAuth2) {
                  delete aCloud.idOAuth2;
                }
              });
              GEtatUtilisateur.listeCloudDepotServeur.parcourir((aCloud) => {
                if (!!aCloud.idOAuth2 && aCloud.idOAuth2 === aIdOAuth2) {
                  delete aCloud.idOAuth2;
                }
              });
              aCallback.call(this);
            }
          });
      },
      authentificationPromise(aIdOAuth2) {
        const lIdentAbonnement =
          ObjetRequeteJSON_1.utils.getIdentNotification('tokenOAuth2');
        return new ObjetRequeteOAuth2Attente({})
          .lancerRequete({ idOAuth2: aIdOAuth2 })
          .then((aJSON) => {
            if (aJSON.urlAuthorize) {
              window.open(aJSON.urlAuthorize);
              let lAvecInterruption = true;
              const lPromiseMessage = GApplication.getMessage()
                .afficher({
                  message: ObjetTraduction_1.GTraductions.getValeur(
                    'UtilitaireOAuth2.message',
                    [
                      IE.jsx.str(
                        'a',
                        { href: aJSON.urlAuthorize, target: "_blank'" },
                        ObjetTraduction_1.GTraductions.getValeur(
                          'UtilitaireOAuth2.lien',
                        ),
                      ),
                    ],
                  ).replaceRCToHTML(),
                })
                .then(() => {
                  if (lAvecInterruption) {
                    return new ObjetRequeteOAuth2Attente({}).lancerRequete({
                      interruption: true,
                    });
                  }
                })
                .then(() => {
                  return Promise.reject({ sansMessage: true });
                });
              const lPromiseNotif = new Promise((aResolve, aReject) => {
                Invocateur_1.Invocateur.abonnerUnique(
                  lIdentAbonnement,
                  (aNotif) => {
                    lAvecInterruption = false;
                    if (aNotif && aNotif.ok) {
                      aResolve();
                    } else {
                      aReject(aNotif.message);
                    }
                  },
                );
              });
              return Promise.race([lPromiseMessage, lPromiseNotif]).finally(
                () => {
                  GApplication.getMessage().fermer();
                  Invocateur_1.Invocateur.desabonner(lIdentAbonnement);
                },
              );
            }
            if (!aJSON.ok) {
              return Promise.reject(aJSON.message);
            }
          })
          .catch((aError) => {
            if (aError && aError.sansMessage) {
              return Promise.reject();
            }
            return GApplication.getMessage()
              .afficher({
                message:
                  aError ||
                  ObjetTraduction_1.GTraductions.getValeur(
                    'UtilitaireOAuth2.echec',
                  ),
              })
              .then(() => {
                return Promise.reject();
              });
          });
      },
    };
    exports.UtilitaireOAuth2 = UtilitaireOAuth2;
    class ObjetRequeteOAuth2Attente extends ObjetRequeteJSON_1.ObjetRequeteConsultation {}
    CollectionRequetes_1.Requetes.inscrire(
      'OAuth2Attente',
      ObjetRequeteOAuth2Attente,
    );
  },
  fn: 'utilitaireoauth2.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeClientRest = void 0;
    var TypeClientRest;
    (function (TypeClientRest) {
      TypeClientRest[(TypeClientRest['crSupprime01'] = 0)] = 'crSupprime01';
      TypeClientRest[(TypeClientRest['crDropBox'] = 1)] = 'crDropBox';
      TypeClientRest[(TypeClientRest['crGoogleDrive'] = 2)] = 'crGoogleDrive';
      TypeClientRest[(TypeClientRest['crOneDrive'] = 3)] = 'crOneDrive';
      TypeClientRest[(TypeClientRest['crSupprime02'] = 4)] = 'crSupprime02';
      TypeClientRest[(TypeClientRest['crDigiposte'] = 5)] = 'crDigiposte';
      TypeClientRest[(TypeClientRest['crOneNote'] = 6)] = 'crOneNote';
      TypeClientRest[(TypeClientRest['crPentila'] = 7)] = 'crPentila';
      TypeClientRest[(TypeClientRest['crCloudIndex'] = 8)] = 'crCloudIndex';
      TypeClientRest[(TypeClientRest['crDigiposteCertifie'] = 9)] =
        'crDigiposteCertifie';
      TypeClientRest[(TypeClientRest['crClientNextCloud'] = 10)] =
        'crClientNextCloud';
      TypeClientRest[(TypeClientRest['crENEJ'] = 11)] = 'crENEJ';
    })(TypeClientRest || (exports.TypeClientRest = TypeClientRest = {}));
  },
  fn: 'typeclientrest.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_SelectionClouds = void 0;
    const Enumere_EvenementListe_1 = require('Enumere_EvenementListe');
    const ObjetDonneesListeFlatDesign_1 = require('ObjetDonneesListeFlatDesign');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetListe_1 = require('ObjetListe');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const UtilitaireOAuth2_1 = require('UtilitaireOAuth2');
    const GUID_1 = require('GUID');
    const ObjetHtml_1 = require('ObjetHtml');
    const jsx_1 = require('jsx');
    const TypeClientRest_1 = require('TypeClientRest');
    class ObjetFenetre_SelectionClouds extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.avecChoixFiltrageEnseignees = false;
        this.avecPDF = true;
        this.avecClouds = true;
        this.filtreEnseignees = false;
        this.autoriserEventCloud = 0;
        this.idConteneurBouton = GUID_1.GUID.getId();
        this.idTexteExplicatif = GUID_1.GUID.getId();
        this.idConteneurBoutonBas = GUID_1.GUID.getId();
        this.idBtnParams = GUID_1.GUID.getId();
        this.idConteneurMessage = GUID_1.GUID.getId();
        this.idBtnTelecharger = GUID_1.GUID.getId();
        this.idConteneurBoutonPDF = GUID_1.GUID.getId();
        this.avecActionEffectuee = false;
        this.message = null;
        this.optionsFenetreSelectionClouds = {
          avecMessage: false,
          iconMessage: 'icon_post_it_rempli',
          avecBtnTelecharger: false,
        };
      }
      construireInstances() {
        this.identListe = this.add(
          ObjetListe_1.ObjetListe,
          this.evenementSurListe,
          this._initialiserListe,
        );
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          genererPDF: {
            event() {
              aInstance.fermer();
              aInstance.callback.appel();
              if (aInstance.callbackFermeture) {
                aInstance.callbackFermeture(aInstance.avecActionEffectuee);
              }
            },
          },
          surParametrage: {
            event() {
              aInstance.callbackParametrage();
            },
          },
          ctnMessage: {
            afficher() {
              return (
                !!aInstance.optionsFenetreSelectionClouds.avecMessage &&
                aInstance.message &&
                aInstance.message !== ''
              );
            },
          },
          voirLeDocument: {
            event() {
              if (aInstance.callbackTelechargement) {
                aInstance.callbackTelechargement();
                aInstance.avecActionEffectuee = true;
              }
            },
          },
        });
      }
      setMessage(aMessage) {
        this.message = aMessage;
      }
      setOptionsFenetreSelectionClouds(aOptions) {
        Object.assign(this.optionsFenetreSelectionClouds, aOptions);
      }
      composeContenu() {
        const T = [];
        T.push('<div class="flex-contain cols full-size">');
        T.push('<div id="', this.idConteneurBouton, '" style="display:none">');
        T.push('<div  class="Espace flex-contain cols">');
        T.push(
          IE.jsx.str(
            'div',
            {
              class: ['flex-contain', 'm-bottom-xl'],
              'ie-if': 'ctnMessage.afficher',
              id: this.idConteneurMessage,
              style: 'overflow: auto; max-height: 30rem;',
            },
            IE.jsx.str('i', {
              class: [
                this.optionsFenetreSelectionClouds.iconMessage,
                'i-small',
                'm-right',
              ],
              title: ObjetTraduction_1.GTraductions.getValeur(
                'ListeClouds.hintMessage',
              ),
            }),
            IE.jsx.str('div', null, this.message),
          ),
        );
        T.push(
          IE.jsx.str(
            'ie-bouton',
            {
              class: [Type_ThemeBouton_1.TypeThemeBouton.primaire, 'm-y-l'],
              id: this.idBtnTelecharger,
              'ie-model': 'voirLeDocument',
            },
            ObjetTraduction_1.GTraductions.getValeur(
              'ListeClouds.voirDocument',
            ),
          ),
        );
        T.push(
          '<div data-usedAs="conteneurBoutonPDF" id="' +
            this.idConteneurBoutonPDF +
            '" class="flex-contain justify-between flex-gap-l">',
        );
        T.push(
          '<ie-bouton  ie-model="genererPDF" class="themeBoutonPrimaire fluid-bloc">' +
            ObjetTraduction_1.GTraductions.getValeur('ListeClouds.voirPDF') +
            '</ie-bouton>',
        );
        if (!IE.estMobile) {
          T.push(
            IE.jsx.str('ie-btnicon', {
              id: this.idBtnParams,
              title: ObjetTraduction_1.GTraductions.getValeur(
                'GenerationPDF.Titre',
              ),
              'ie-model': 'surParametrage',
              class: 'bt-activable bt-large icon_cog fix-bloc',
            }),
          );
        }
        T.push('</div>');
        T.push(
          '<div class="GrandEspaceHaut EspaceBas" id="',
          this.idTexteExplicatif,
          '" style="display:none">',
        );
        T.push(
          '<span> ',
          ObjetTraduction_1.GTraductions.getValeur(
            'ListeClouds.texteExplicatifClouds',
          ),
          '</span>',
        );
        T.push('</div>');
        T.push('</div>');
        T.push('</div>');
        T.push(
          '<div class="full-size" id="',
          this.getNomInstance(this.identListe),
          '">',
        );
        T.push('</div>');
        T.push('</div>');
        return T.join('');
      }
      setDonnees(aParams) {
        this.avecPDF =
          aParams.avecPDF === undefined || aParams.avecPDF === null
            ? this.avecPDF
            : aParams.avecPDF;
        this.avecClouds =
          aParams.avecClouds === undefined || aParams.avecClouds === null
            ? this.avecClouds
            : aParams.avecClouds;
        this.avecDepot =
          aParams.avecDepot === undefined || aParams.avecDepot === null
            ? this.avecDepot
            : aParams.avecDepot;
        this.callbackParametrage = aParams.callbackParametrage;
        this.callbackTelechargement = aParams.callbackTelechargement;
        this.callbackFermeture = aParams.callbackFermeture;
        this.actualiser();
        this.afficher();
        const lDisplayCtnBtn =
          this.avecPDF ||
          this.optionsFenetreSelectionClouds.avecMessage ||
          this.optionsFenetreSelectionClouds.avecBtnTelecharger;
        const lDisplaytexteExpliatif =
          (this.avecPDF && this.avecClouds) ||
          (this.optionsFenetreSelectionClouds.avecBtnTelecharger &&
            this.avecClouds);
        ObjetHtml_1.GHtml.setDisplay(this.idConteneurBouton, lDisplayCtnBtn);
        ObjetHtml_1.GHtml.setDisplay(
          this.idConteneurBoutonBas,
          !IE.estMobile && this.avecPDF,
        );
        ObjetHtml_1.GHtml.setDisplay(
          this.idTexteExplicatif,
          lDisplaytexteExpliatif,
        );
        ObjetHtml_1.GHtml.setDisplay(
          this.idBtnParams,
          !!this.callbackParametrage,
        );
        ObjetHtml_1.GHtml.setDisplay(
          this.idBtnTelecharger,
          !!this.callbackTelechargement,
        );
        ObjetHtml_1.GHtml.setDisplay(
          this.idConteneurMessage,
          !!this.optionsFenetreSelectionClouds.avecMessage,
        );
        ObjetHtml_1.GHtml.setDisplay(this.idConteneurBoutonPDF, this.avecPDF);
        if (this.avecClouds) {
          let lListe = this.avecDepot
            ? GEtatUtilisateur.listeCloudDepotServeur
            : GEtatUtilisateur.listeCloud;
          this.setBoutonActif(1, false);
          this.getInstance(this.identListe).setDonnees(
            new DonneesListe_SelectionCloud(lListe).setOptions({
              addCommandesMenuContextuel: (aParametres) => {
                this._addCommandesMenuContextuel({
                  idOAuth2: aParametres.article.idOAuth2,
                  menuContextuel: aParametres.menuContextuel,
                });
              },
            }),
          );
        }
      }
      surValidation() {
        const lNiveauSelectionne = this.getInstance(
          this.identListe,
        ).getElementSelection();
        this.fermer();
        if (!!lNiveauSelectionne) {
          this.callback.appel(
            !!lNiveauSelectionne ? lNiveauSelectionne.getNumero() : null,
          );
          this.avecActionEffectuee = true;
        }
        if (this.callbackFermeture) {
          this.callbackFermeture(this.avecActionEffectuee);
        }
      }
      evenementSurListe(aParametres) {
        switch (aParametres.genreEvenement) {
          case Enumere_EvenementListe_1.EGenreEvenementListe.Selection:
            this.fermer();
            this.callback.appel(aParametres.ligne, aParametres.article);
            this.avecActionEffectuee = true;
            if (this.callbackFermeture) {
              this.callbackFermeture(this.avecActionEffectuee);
            }
            break;
        }
      }
      _addCommandesMenuContextuel(aParametres) {
        aParametres.menuContextuel.add(
          ObjetTraduction_1.GTraductions.getValeur('ListeClouds.Deconnecter'),
          true,
          () => {
            UtilitaireOAuth2_1.UtilitaireOAuth2.revocation(
              aParametres.idOAuth2,
              this.setDonnees.bind(this, {}),
            );
          },
        );
        aParametres.menuContextuel.setDonnees();
      }
      _initialiserListe(aInstance) {
        aInstance.setOptionsListe({
          skin: ObjetListe_1.ObjetListe.skin.flatDesign,
          hauteurAdapteContenu: true,
          hauteurMaxAdapteContenu: 400,
        });
      }
    }
    exports.ObjetFenetre_SelectionClouds = ObjetFenetre_SelectionClouds;
    class DonneesListe_SelectionCloud extends ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign {
      constructor(aDonnees) {
        super(aDonnees);
        this.setOptions({
          avecContenuTronque: false,
          avecEvnt_Selection: true,
          flatDesignMinimal: true,
        });
      }
      _estConnecte(aArticle) {
        return !!aArticle && !!aArticle.idOAuth2;
      }
      _estCertifie(aArticle) {
        return aArticle.aveccertification;
      }
      getControleur(aInstanceDonneesListe, aInstanceListe) {
        return $.extend(
          true,
          super.getControleur(aInstanceDonneesListe, aInstanceListe),
          {
            btnInfo: {
              event(aGenre) {
                const lFenetre =
                  ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
                    ObjetFenetre_1.ObjetFenetre,
                    {
                      pere: this,
                      initialiser(aInstanceFenetre) {
                        aInstanceFenetre.setOptionsFenetre({
                          avecTailleSelonContenu: true,
                          largeur: 350,
                          listeBoutons: [
                            ObjetTraduction_1.GTraductions.getValeur('Fermer'),
                          ],
                          titre: ObjetTraduction_1.GTraductions.getValeur(
                            'ListeClouds.documentCertifies',
                          ),
                        });
                      },
                    },
                  );
                const lListeElement =
                  aInstanceListe && aInstanceListe.getListeArticles();
                const lCloud =
                  lListeElement && lListeElement.getElementParGenre(aGenre);
                lFenetre.afficher(
                  IE.jsx.str(
                    'div',
                    null,
                    lCloud && lCloud.detailscertification
                      ? lCloud.detailscertification
                      : '',
                  ),
                );
              },
            },
          },
        );
      }
      getTitreZonePrincipale(aParams) {
        return aParams.article.getLibelle();
      }
      getInfosSuppZonePrincipale(aParams) {
        const lInfosSupp = [];
        const lEstConnecte = this._estConnecte(aParams.article);
        if (lEstConnecte) {
          lInfosSupp.push(
            ObjetTraduction_1.GTraductions.getValeur('ListeClouds.Connecte'),
          );
        }
        if (this._estCertifie(aParams.article)) {
          if (lEstConnecte) {
            lInfosSupp.push(' - ');
          }
          lInfosSupp.push(
            ObjetTraduction_1.GTraductions.getValeur(
              'ListeClouds.documentCertifies',
            ),
            ' ',
            IE.jsx.str('i', {
              class: ['icon_doc_certifie', 'i-medium'],
              'ie-hint': ObjetTraduction_1.GTraductions.getValeur(
                'ListeClouds.documentCertifies',
              ),
            }),
          );
        }
        const lhtml = lInfosSupp.join('');
        return lhtml.length > 0 ? lhtml : '&nbsp;';
      }
      getZoneComplementaire(aParams) {
        const lIcones = [];
        if (this._estCertifie(aParams.article)) {
          lIcones.push(
            IE.jsx.str('ie-btnicon', {
              'ie-model': (0, jsx_1.jsxFuncAttr)(
                'btnInfo',
                aParams.article.getGenre(),
              ),
              title: ObjetTraduction_1.GTraductions.getValeur(
                'ListeClouds.infoDocumentCertifies',
              ),
              class: ['bt-activable', 'icon_info_widget'],
            }),
          );
        }
        return lIcones.join('');
      }
      avecBoutonActionLigne(aParams) {
        return this._estConnecte(aParams.article);
      }
      getIconeGaucheContenuFormate(aParams) {
        if (aParams.article.logoBase64) {
          return {
            css: 'icon-cloud-logoBase64 ',
            html: IE.jsx.str('img', {
              src: `data:image/png;base64, ${aParams.article.logoBase64}`,
              'aria-hidden': 'true',
            }),
          };
        }
        if (aParams.article.nomIcone) {
          return `Image_Icone_${aParams.article.nomIcone}`;
        }
        switch (aParams.article.typeClientRest) {
          case TypeClientRest_1.TypeClientRest.crSupprime01:
            return 'Image_Icone_LogoBox';
          case TypeClientRest_1.TypeClientRest.crDropBox:
            return 'Image_Icone_LogoDropBox';
          case TypeClientRest_1.TypeClientRest.crGoogleDrive:
            return 'Image_Icone_LogoGoogleDrive';
          case TypeClientRest_1.TypeClientRest.crClientNextCloud:
            return 'Image_Icone_LogoGoogleDrive';
          case TypeClientRest_1.TypeClientRest.crOneDrive:
            return 'Image_Icone_LogoOneDrive';
          case TypeClientRest_1.TypeClientRest.crDigiposte:
            return 'Image_Icone_LogoDigiposte';
          case TypeClientRest_1.TypeClientRest.crDigiposteCertifie:
            return 'Image_Icone_LogoDigiposte';
          case TypeClientRest_1.TypeClientRest.crCloudIndex:
            return 'Image_Icone_LogoCloudPronote';
          case TypeClientRest_1.TypeClientRest.crPentila:
            return 'Image_Icone_LogoPentila';
          default:
            return '';
        }
      }
      initialisationObjetContextuel(aParametres) {
        if (!aParametres.menuContextuel) {
          return;
        }
        this.options.addCommandesMenuContextuel(aParametres);
        aParametres.menuContextuel.setDonnees(aParametres.id);
      }
    }
  },
  fn: 'objetfenetre_selectionclouds.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeFormatPublication = exports.TTypeElementCloud = void 0;
    var TTypeElementCloud;
    (function (TTypeElementCloud) {
      TTypeElementCloud[(TTypeElementCloud['tec_Fichier'] = 0)] = 'tec_Fichier';
      TTypeElementCloud[(TTypeElementCloud['tec_Dossier'] = 1)] = 'tec_Dossier';
    })(
      TTypeElementCloud || (exports.TTypeElementCloud = TTypeElementCloud = {}),
    );
    var TypeFormatPublication;
    (function (TypeFormatPublication) {
      TypeFormatPublication[(TypeFormatPublication['FP_NonPublie'] = 0)] =
        'FP_NonPublie';
      TypeFormatPublication[(TypeFormatPublication['FP_Natif'] = 1)] =
        'FP_Natif';
      TypeFormatPublication[(TypeFormatPublication['FP_Pdf'] = 2)] = 'FP_Pdf';
    })(
      TypeFormatPublication ||
        (exports.TypeFormatPublication = TypeFormatPublication = {}),
    );
  },
  fn: 'ttypeelementcloud.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.DonneesListe_FichiersCloud = void 0;
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    const ObjetTri_1 = require('ObjetTri');
    const TTypeElementCloud_1 = require('TTypeElementCloud');
    const TTypeElementCloud_2 = require('TTypeElementCloud');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Enumere_FormatDocJoint_1 = require('Enumere_FormatDocJoint');
    const ObjetChaine_1 = require('ObjetChaine');
    const tag_1 = require('tag');
    const ObjetDonneesListeFlatDesign_1 = require('ObjetDonneesListeFlatDesign');
    const ObjetListeElements_1 = require('ObjetListeElements');
    class DonneesListe_FichiersCloud extends ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign {
      constructor(aDonnees) {
        const lListe = new ObjetListeElements_1.ObjetListeElements().add(
          aDonnees || new ObjetListeElements_1.ObjetListeElements(),
        );
        super(lListe);
        this.setOptions({
          avecBoutonActionLigne: false,
          avecEvnt_Selection: true,
          repertoirePere: null,
          estMonoSelection: false,
          uniquementRepertoireVisible: false,
          avecSelectionRepertoire: true,
          avecFormat: false,
        });
      }
      getIconeGaucheContenuFormate(aParams) {
        if (
          aParams.article.getGenre() ===
          TTypeElementCloud_1.TTypeElementCloud.tec_Fichier
        ) {
          return Enumere_FormatDocJoint_1.EFormatDocJointUtil.getClassIconDeGenre(
            Enumere_FormatDocJoint_1.EFormatDocJointUtil.getGenreDeFichier(
              ObjetChaine_1.GChaine.extraireExtensionFichier(
                aParams.article.getLibelle(),
              ),
            ),
          );
        }
        return 'icon_folder_close';
      }
      getHintIconeGaucheContenuFormate(aParams) {
        if (
          aParams.article.getGenre() ===
          TTypeElementCloud_1.TTypeElementCloud.tec_Dossier
        ) {
          return ObjetTraduction_1.GTraductions.getValeur(
            'FenetreCloud.Hint_Repertoire',
          );
        }
        return '';
      }
      getZoneComplementaire(aParams) {
        if (
          aParams.article.getGenre() ===
          TTypeElementCloud_1.TTypeElementCloud.tec_Fichier
        ) {
          return ObjetChaine_1.GChaine.tailleOctetsToStr(
            aParams.article.taille,
          );
        }
        return '';
      }
      getAriaLabelZoneCellule(aParams, aZone) {
        if (
          aZone ===
          ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign
            .ZoneCelluleFlatDesign.zoneComplementaire
        ) {
          const lStr = this.getZoneComplementaire(aParams);
          if (lStr) {
            return `${ObjetTraduction_1.GTraductions.getValeur('FenetreCloud.TailleFichierCloud')} : ${lStr}`;
          }
        }
        return ``;
      }
      getZoneMessage(aParams) {
        if (
          this.options.avecFormat &&
          aParams.article.getGenre() ===
            TTypeElementCloud_1.TTypeElementCloud.tec_Fichier
        ) {
          const lVal =
            aParams.article.formatPub ===
            TTypeElementCloud_2.TypeFormatPublication.FP_Natif
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'FenetreCloud.FormatOrigine',
                )
              : aParams.article.formatPub ===
                  TTypeElementCloud_2.TypeFormatPublication.FP_Pdf
                ? ObjetTraduction_1.GTraductions.getValeur(
                    'FenetreCloud.FormatPdf',
                  )
                : '-';
          return (0, tag_1.tag)(
            'p',
            { class: 'color-theme-foncee' },
            `${ObjetTraduction_1.GTraductions.getValeur('FenetreCloud.FormatPublication')} : ${lVal}`,
          );
        }
        return '';
      }
      avecSelection(aParams) {
        return (
          aParams.article.getGenre() ===
          TTypeElementCloud_1.TTypeElementCloud.tec_Dossier
        );
      }
      avecCB(aParams) {
        if (
          aParams.article.getGenre() ===
          TTypeElementCloud_1.TTypeElementCloud.tec_Dossier
        ) {
          return !!this.options.avecSelectionRepertoire;
        }
        return true;
      }
      setValueCB(aParams, aValue) {
        if (aValue && this.options.estMonoSelection) {
          this.Donnees.parcourir((aArticle) => {
            if (aArticle.estCoche) {
              aArticle.estCoche = false;
            }
          });
        }
        aParams.article.estCoche = aValue;
      }
      getVisible(aArticle) {
        return this.options.uniquementRepertoireVisible
          ? aArticle.getGenre() ===
              TTypeElementCloud_1.TTypeElementCloud.tec_Dossier
          : true;
      }
      getTri() {
        return [
          ObjetTri_1.ObjetTri.init(
            'Genre',
            Enumere_TriElement_1.EGenreTriElement.Decroissant,
          ),
          ObjetTri_1.ObjetTri.init('Libelle'),
        ];
      }
    }
    exports.DonneesListe_FichiersCloud = DonneesListe_FichiersCloud;
  },
  fn: 'donneesliste_fichierscloud.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeStatutInterrogationCloud = void 0;
    var TypeStatutInterrogationCloud;
    (function (TypeStatutInterrogationCloud) {
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_Inconnu'] = 0)
      ] = 'sic_Inconnu';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_OK'] = 1)
      ] = 'sic_OK';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_TokenInvalide'] = 2)
      ] = 'sic_TokenInvalide';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_Timeout'] = 3)
      ] = 'sic_Timeout';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_ArretApplication'] = 4)
      ] = 'sic_ArretApplication';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_DossierTropGros'] = 5)
      ] = 'sic_DossierTropGros';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_DossierInconnu'] = 6)
      ] = 'sic_DossierInconnu';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_RacineInconnue'] = 7)
      ] = 'sic_RacineInconnue';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_ImpossibleDePartagerLeFichier'] = 8)
      ] = 'sic_ImpossibleDePartagerLeFichier';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_AdresseMailNonVerifiee'] = 9)
      ] = 'sic_AdresseMailNonVerifiee';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_ImpossibleDePartagerUnDossier'] = 10)
      ] = 'sic_ImpossibleDePartagerUnDossier';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_FichierDejaExistant'] = 11)
      ] = 'sic_FichierDejaExistant';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_FichierTropGros'] = 12)
      ] = 'sic_FichierTropGros';
      TypeStatutInterrogationCloud[
        (TypeStatutInterrogationCloud['sic_PlusDEspace'] = 13)
      ] = 'sic_PlusDEspace';
    })(
      TypeStatutInterrogationCloud ||
        (exports.TypeStatutInterrogationCloud = TypeStatutInterrogationCloud =
          {}),
    );
  },
  fn: 'typestatutinterrogationcloud.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireBoutonBandeau = void 0;
    const ObjetTraduction_1 = require('ObjetTraduction');
    exports.UtilitaireBoutonBandeau = {
      getHtmlBtnParametrer(aNomIEModel) {
        return IE.jsx.str('ie-btnicon', {
          'ie-model': aNomIEModel,
          class: 'bt-activable icon_cog',
          title: ObjetTraduction_1.GTraductions.getValeur(
            'VoirParametresAffichage',
          ),
          'aria-haspopup': 'dialog',
        });
      },
      getHtmlBtnAssistantSaisie(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_pencil mix-icon_star i-top"></ie-btnicon>`;
      },
      getHtmlBtnTriOrdreChronologique(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_ordre_chronologique"></ie-btnicon>`;
      },
      getHtmlBtnCompacterColonnes(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_table mix-icon_resize_horizontal i-top"></ie-btnicon>`;
      },
      getHtmlBtnCompacterLignes(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_table mix-icon_resize_vertical i-top"></ie-btnicon>`;
      },
      getHtmlBtnGrapheAraignee(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_graphe_araigne"></ie-btnicon>`;
      },
      getHtmlBtnAvecListeEleves(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_liste_etudiant"></ie-btnicon>`;
      },
      getHtmlBtnAfficherCoursAnnules(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_fiche_T i-small" ie-class="${aNomIEModel}.getClassesMixIcon"></ie-btnicon>`;
      },
      getClassesMixIconAfficherCoursAnnules(aAvecCoursAnnules) {
        const lClasses = ['i-top'];
        if (aAvecCoursAnnules) {
          lClasses.push('mix-icon_ok', 'i-green');
        } else {
          lClasses.push('mix-icon_remove', 'i-red');
        }
        return lClasses.join(' ');
      },
      getHtmlBtnAfficherCahiersDeTextesDetaches(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_Defaut_de_carnet"></ie-btnicon>`;
      },
      getHtmlBtnAfficherMasquerZone(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_pushpin"></ie-btnicon>`;
      },
      getHtmlBtnMonsieurFiche(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_question"></ie-btnicon>`;
      },
      getHtmlBtnSaisieHorizontalVertical(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_pencil i-small" ie-class="${aNomIEModel}.getClassesMixIcon"></ie-btnicon>`;
      },
      getClassesMixIconSaisieHorizontalVertical(aSaisieVerticale) {
        const lClasses = ['i-bottom'];
        if (aSaisieVerticale) {
          lClasses.push('mix-icon_arrow_down');
        } else {
          lClasses.push('mix-icon_arrow_right');
        }
        return lClasses.join(' ');
      },
      getHtmlBtnAfficherPhotoEleve(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_photo"></ie-btnicon>`;
      },
      getHtmlBtnAfficherFicheEleve(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_fiche_eleve"></ie-btnicon>`;
      },
      getHtmlBtnAfficherEmploiDuTemps(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_fiche_T_triple"></ie-btnicon>`;
      },
      getHtmlBtnChargeDeTravail(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_charge_travail"></ie-btnicon>`;
      },
      getHtmlBtnICal(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_ical"></ie-btnicon>`;
      },
      getHtmlBtnMiseEnFormeTexte(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_font"></ie-btnicon>`;
      },
      getHtmlBtnCloud(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_cloud"></ie-btnicon>`;
      },
      getHtmlBtnSitesInternet(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_globe"></ie-btnicon>`;
      },
      getHtmlBtnPiecesJointes(aNomIEModel, aId) {
        return `<ie-btnicon ${!!aId ? `id="${aId}"` : ''} ie-model="${aNomIEModel}" class="bt-activable icon_piece_jointe"></ie-btnicon>`;
      },
      getHtmlBtnQCM(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_qcm"></ie-btnicon>`;
      },
      getHtmlBtnKiosque(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_exercice_numerique"></ie-btnicon>`;
      },
      getHtmlBtnZoomPlusMoins(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable" ie-class="${aNomIEModel}.getClassesIcon"></ie-btnicon>`;
      },
      getClassesIconZoomPlusMoins(aEtatAgrandi) {
        const lClasses = [];
        if (aEtatAgrandi) {
          lClasses.push('icon_zoom_out');
        } else {
          lClasses.push('icon_zoom_in');
        }
        return lClasses.join(' ');
      },
      getHtmlBtnSupprimer(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_trash"></ie-btnicon>`;
      },
      getHtmlBtnCrayonMagique(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_magic"></ie-btnicon>`;
      },
      getHtmlBtnListesDiffusion(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_groupes_accompagnement_personnalise"></ie-btnicon>`;
      },
      getHtmlBtnDiffuserInformation(aNomIEModel, aLabel) {
        return IE.jsx.str('ie-btnicon', {
          'ie-model': aNomIEModel,
          'aria-label': aLabel,
          class: 'bt-activable icon_diffuser_information',
          'aria-haspopup': 'dialog',
        });
      },
      getHtmlBtnRecapitulatifAbsences(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_competence_absent"></ie-btnicon>`;
      },
      getHtmlBtnUniquementMesServices(aNomIEModel) {
        return `<ie-btnicon ie-model="${aNomIEModel}" class="bt-activable icon_autre_service"></ie-btnicon>`;
      },
      getHtmlBtnInformationsGrille(aNomIEModel) {
        return IE.jsx.str('ie-btnicon', {
          'ie-model': aNomIEModel,
          class: 'bt-activable icon_info_sign',
          'aria-haspopup': 'dialog',
          title: ObjetTraduction_1.GTraductions.getValeur(
            'ObjetGrille.TitreInfosDetails',
          ),
        });
      },
    };
  },
  fn: 'utilitaireboutonbandeau.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteCloudAttente = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    class ObjetRequeteCloudAttente extends ObjetRequeteJSON_1.ObjetRequeteConsultation {}
    exports.ObjetRequeteCloudAttente = ObjetRequeteCloudAttente;
    CollectionRequetes_1.Requetes.inscrire(
      'CloudAttente',
      ObjetRequeteCloudAttente,
    );
  },
  fn: 'objetrequetecloudattente.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireRequetesCloud = void 0;
    const ObjetRequeteCloudAttente_1 = require('ObjetRequeteCloudAttente');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const UtilitaireOAuth2_1 = require('UtilitaireOAuth2');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const TTypeElementCloud_1 = require('TTypeElementCloud');
    const TypeStatutInterrogationCloud_1 = require('TypeStatutInterrogationCloud');
    const c_TailleMaxUpload_cloud = 52428800;
    const UtilitaireRequetesCloud = {
      c_TailleMaxUpload_cloud: c_TailleMaxUpload_cloud,
      requetePartageListeFichiers(aListePJs) {
        const lListeATraiter = aListePJs.getListeElements((aEle) => {
          return (
            aEle.getGenre() ===
              Enumere_DocumentJoint_1.EGenreDocumentJoint.Cloud &&
            aEle.existe() &&
            aEle.service !== undefined &&
            !aEle.traite
          );
        });
        if (lListeATraiter.count() > 0) {
          const lElement = lListeATraiter.get(0);
          lElement.partageFichier = true;
          return new ObjetRequeteCloudAttente_1.ObjetRequeteCloudAttente()
            .lancerRequete({
              service: lElement.service,
              idPartage: lElement.idPartage,
              partageFichier: lElement.partageFichier,
              publiPdf: lElement.publiPdf,
            })
            .then((aJSON) => {
              if (
                aJSON.status ===
                TypeStatutInterrogationCloud_1.TypeStatutInterrogationCloud
                  .sic_OK
              ) {
                lElement.url = aJSON.urlPartage;
                lElement.traite = true;
                return;
              }
              if (
                aJSON.status ===
                TypeStatutInterrogationCloud_1.TypeStatutInterrogationCloud
                  .sic_TokenInvalide
              ) {
                if (lElement.avecTokenInvalide) {
                  return Promise.reject();
                }
                lElement.avecTokenInvalide = true;
                if (aJSON.idOAuth2) {
                  return UtilitaireOAuth2_1.UtilitaireOAuth2.authentificationPromise(
                    aJSON.idOAuth2,
                  );
                }
                return Promise.reject();
              }
              lElement.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
              lElement.traite = true;
              return GApplication.getMessage().afficher({
                type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
                message:
                  ObjetTraduction_1.GTraductions.getValeur('requete.erreur') +
                  ' : ' +
                  (aJSON.message || '') +
                  ' (' +
                  aJSON.status +
                  ')',
              });
            })
            .then(() => {
              return UtilitaireRequetesCloud.requetePartageListeFichiers(
                aListePJs,
              );
            })
            .catch((aError) => {});
        }
        return Promise.resolve();
      },
      requeteUploadVersCloudListFichiers(aParams) {
        const lParams = Object.assign(
          {
            idPartageDossier: null,
            service: null,
            listeFichiersATraiter: null,
            listeFichiersResultat: null,
          },
          aParams,
        );
        if (
          !MethodesObjet_1.MethodesObjet.isNumber(lParams.service) ||
          (!lParams.idPartageDossier && lParams.idPartageDossier !== '') ||
          !lParams.listeFichiersATraiter ||
          !lParams.listeFichiersATraiter.count ||
          !lParams.listeFichiersResultat
        ) {
          return Promise.reject();
        }
        if (lParams.listeFichiersATraiter.count() === 0) {
          return Promise.resolve(true);
        }
        const lIndiceFichierATraiter = 0;
        const lFichier = lParams.listeFichiersATraiter.get(
          lIndiceFichierATraiter,
        );
        return Promise.resolve()
          .then(() => {
            if (lFichier) {
              const lIdFichierBackup = lFichier.idFichier;
              return new ObjetRequeteCloudAttente_1.ObjetRequeteCloudAttente()
                .addUpload({
                  listeFichiers:
                    new ObjetListeElements_1.ObjetListeElements().add(lFichier),
                  annulerSurAbortUpload: true,
                  annulerSurErreurUpload: true,
                })
                .lancerRequete({
                  upload: true,
                  service: lParams.service,
                  idDossier: lParams.idPartageDossier,
                  nomFichier: lFichier.getLibelle(),
                  idFichier: lFichier.idFichier,
                })
                .then((aJSON) => {
                  if (aJSON.upload && aJSON.fichier) {
                    const lElementCloud = ObjetElement_1.ObjetElement.create({
                      Libelle: aJSON.fichier.getLibelle(),
                      Genre: Enumere_DocumentJoint_1.EGenreDocumentJoint.Cloud,
                      service: lParams.service,
                      idPartage: aJSON.fichier.idPartage,
                      publiPdf: aJSON.fichier.pubPdf
                        ? aJSON.fichier.formatPub
                        : TTypeElementCloud_1.TypeFormatPublication.FP_Natif,
                      url: aJSON.fichier.url,
                    });
                    lElementCloud.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
                    lParams.listeFichiersResultat.add(lElementCloud);
                    return;
                  }
                  if (
                    aJSON.status ===
                    TypeStatutInterrogationCloud_1.TypeStatutInterrogationCloud
                      .sic_TokenInvalide
                  ) {
                    if (lParams.avecTokenInvalide) {
                      return Promise.reject();
                    }
                    lParams.avecTokenInvalide = true;
                    if (aJSON.idOAuth2) {
                      return UtilitaireOAuth2_1.UtilitaireOAuth2.authentificationPromise(
                        aJSON.idOAuth2,
                      ).then(() => {
                        if (lIdFichierBackup) {
                          lFichier.idFichier = lIdFichierBackup;
                        }
                        return { refaireUpload: true };
                      });
                    }
                  }
                  if (aJSON.erreurCommunication) {
                    return null;
                  }
                  return GApplication.getMessage()
                    .afficher({
                      type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                        .Information,
                      message:
                        ObjetTraduction_1.GTraductions.getValeur(
                          'requete.erreur',
                        ) +
                        ' : ' +
                        (aJSON.message || '') +
                        ' (' +
                        aJSON.status +
                        ')',
                    })
                    .then(() => null);
                });
            }
          })
          .then((aParams) => {
            if (!aParams || !aParams.refaireUpload) {
              lParams.listeFichiersATraiter.remove(lIndiceFichierATraiter);
            }
            return UtilitaireRequetesCloud.requeteUploadVersCloudListFichiers(
              lParams,
            );
          });
      },
    };
    exports.UtilitaireRequetesCloud = UtilitaireRequetesCloud;
  },
  fn: 'utilitairerequetescloud.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_FichiersCloud = void 0;
    const DonneesListe_FichiersCloud_1 = require('DonneesListe_FichiersCloud');
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetListe_1 = require('ObjetListe');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const TTypeElementCloud_1 = require('TTypeElementCloud');
    const TypeStatutInterrogationCloud_1 = require('TypeStatutInterrogationCloud');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const Enumere_Action_1 = require('Enumere_Action');
    const UtilitaireBoutonBandeau_1 = require('UtilitaireBoutonBandeau');
    const ObjetRequeteCloudAttente_1 = require('ObjetRequeteCloudAttente');
    const UtilitaireOAuth2_1 = require('UtilitaireOAuth2');
    const UtilitaireRequetesCloud_1 = require('UtilitaireRequetesCloud');
    const Enumere_EvenementListe_1 = require('Enumere_EvenementListe');
    const jsx_1 = require('jsx');
    require('ObjetFenetre_FichiersCloud.css');
    class ObjetFenetre_FichiersCloud extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          titre: ObjetTraduction_1.GTraductions.getValeur(
            'FenetreCloud.TitreFichierCloud',
          ),
          hauteur: 700,
          heightMax_mobile: true,
          modale: true,
          listeBoutons: [
            {
              libelle:
                ObjetTraduction_1.GTraductions.getValeur('principal.fermer'),
              theme: Type_ThemeBouton_1.TypeThemeBouton.secondaire,
            },
            {
              theme: Type_ThemeBouton_1.TypeThemeBouton.primaire,
              estValider: true,
            },
          ],
          avecComposeBasInFooter: true,
          modeSelectionRepertoirePourUpload: false,
          estMonoSelection: false,
        });
      }
      construireInstances() {
        this.idListe = this.add(
          ObjetListe_1.ObjetListe,
          this._eventListe,
          (aInstance) => {
            aInstance.setOptionsListe({
              skin: ObjetListe_1.ObjetListe.skin.flatDesign,
              avecCBToutCocher: this.optionsFenetre
                .modeSelectionRepertoirePourUpload
                ? false
                : ObjetListe_1.ObjetListe.typeLibelleCocheCBEntete
                    .compteurSelec,
              boutons: [
                {
                  class: 'icon_refresh',
                  event: () => {
                    this._actualiserDossierDIdPartage(
                      this.idPartageDossierSelection,
                    );
                  },
                  getDisabled: () => {
                    return !this._estIdPartageValide(
                      this.idPartageDossierSelection,
                    );
                  },
                  title: ObjetTraduction_1.GTraductions.getValeur(
                    'FenetreCloud.ActualisationRepertoire',
                  ),
                },
                { genre: ObjetListe_1.ObjetListe.typeBouton.rechercher },
              ],
            });
          },
        );
      }
      setDonnees(aParam) {
        this.listeCloud = GEtatUtilisateur.listeCloud;
        this.idPartageDossierSelection = null;
        if (
          !aParam ||
          !MethodesObjet_1.MethodesObjet.isNumber(aParam.service)
        ) {
          return;
        }
        if (!aParam.inscriptionSeule) {
          this.afficher();
        }
        this.param = aParam;
        if (!aParam.inscriptionSeule) {
          this.setOptionsFenetre({
            titre: ObjetTraduction_1.GTraductions.getValeur(
              'FenetreCloud.TitreFichierCloud',
              [
                this.listeCloud
                  .getElementParNumeroEtGenre(null, aParam.service)
                  .getLibelle(),
              ],
            ),
          });
        }
        this.idPartageDossierSelection = null;
        new ObjetRequeteCloudAttente_1.ObjetRequeteCloudAttente(this)
          .lancerRequete({ service: aParam.service, recupFichiers: true })
          .then((aParams) => {
            this._surReponseCloudAttente(aParams);
          });
        this.$refreshSelf();
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          btnMrFiche: {
            event() {
              GApplication.getMessage().afficher({
                idRessource: 'mficheliencloud',
              });
            },
            getTitle() {
              return ObjetTraduction_1.GTraductions.getTitreMFiche(
                'mficheliencloud',
              );
            },
          },
          getHtmlFilAriane() {
            const H = [];
            const lTab = aInstance._getTabParentsDIdPartage(
              aInstance.idPartageDossierSelection,
            );
            lTab.forEach((aDossier, aIndex) => {
              H.push(
                IE.jsx.str(
                  'ie-chips',
                  {
                    'ie-model': (0, jsx_1.jsxFuncAttr)('chipsFilAriane', [
                      aDossier.idPartage,
                      aIndex === lTab.length - 1,
                    ]),
                    title: ObjetTraduction_1.GTraductions.getValeur(
                      'FenetreCloud.SelectionnerRepertoire_S',
                      [aDossier.getLibelle()],
                    ),
                  },
                  aDossier.getLibelle(),
                ),
              );
            });
            return H.join(IE.jsx.str('i', { class: 'icon_chevron_right' }));
          },
          chipsFilAriane: {
            event(aIdPartage) {
              aInstance._actualiserDossierDIdPartage(aIdPartage);
            },
            getSelected(aIdPartage, aDernierChips) {
              return aDernierChips;
            },
          },
          btnUpload: {
            getOptionsSelecFile() {
              return {
                maxSize:
                  UtilitaireRequetesCloud_1.UtilitaireRequetesCloud
                    .c_TailleMaxUpload_cloud,
                multiple: true,
                avecResizeImage: false,
                avecTransformationFlux: false,
              };
            },
            addFiles: function (aParams) {
              aInstance._uploadListeFichiersVersCloud(aParams.listeFichiers);
            },
            getClass() {
              return aInstance.param &&
                aInstance.param.service &&
                aInstance._estIdPartageValide(
                  aInstance.idPartageDossierSelection,
                )
                ? ''
                : 'hide';
            },
          },
          fenetreBtn: {
            getLibelle(aBoutonRepeat) {
              if (aBoutonRepeat.element.estValider) {
                return aInstance.optionsFenetre
                  .modeSelectionRepertoirePourUpload
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'FenetreCloud.ChoisirRepertoire_FichierCloud',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'FenetreCloud.PartagerFichierCloud',
                    );
              }
              return aBoutonRepeat.element.libelle;
            },
            getDisabled(aBoutonRepeat) {
              if (
                aBoutonRepeat.element.estValider &&
                aInstance.param &&
                aInstance.param.racineFichier
              ) {
                let lResult = 0;
                aInstance._parcoursDossiersRacine((aElement) => {
                  if (aElement.estCoche) {
                    lResult += 1;
                  }
                });
                return lResult === 0;
              }
              return false;
            },
          },
        });
      }
      surValidation(aGenreBouton) {
        const lBouton = this.getBoutonNumero(aGenreBouton);
        Promise.resolve()
          .then(() => {
            if (lBouton && lBouton.estValider && this.param.racineFichier) {
              const lListeSelection = this.getSelection(
                this.param.racineFichier,
              );
              const lListePubPDF = lListeSelection.getListeElements((aEle) => {
                return aEle.pubPdf;
              });
              if (
                this.listeCloud.getElementParNumeroEtGenre(
                  null,
                  this.param.service,
                ).avecChoixFormat &&
                lListePubPDF.count() > 0
              ) {
                return GApplication.getMessage()
                  .afficher({
                    type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                      .Confirmation,
                    titre: ObjetTraduction_1.GTraductions.getValeur(
                      'FenetreCloud.TitreFenetreFormat',
                    ),
                    message: this._composeMessage(lListePubPDF),
                    controleur: {
                      radioFormat: {
                        getValue: function (aIdPartage, aFormat) {
                          return (
                            lListeSelection
                              .getListeElements((aEle) => {
                                return aEle.idPartage === aIdPartage;
                              })
                              .get(0).formatPub === aFormat
                          );
                        },
                        setValue: function (aIdPartage, aFormat) {
                          lListeSelection
                            .getListeElements((aEle) => {
                              return aEle.idPartage === aIdPartage;
                            })
                            .get(0).formatPub = aFormat;
                        },
                      },
                    },
                  })
                  .then((aGenreAction) => {
                    if (
                      aGenreAction === Enumere_Action_1.EGenreAction.Valider
                    ) {
                      return lListeSelection;
                    }
                  });
              }
              return lListeSelection;
            }
          })
          .then((aListeSelection) => {
            if (aListeSelection && aListeSelection.count) {
              const lListeDocs = new ObjetListeElements_1.ObjetListeElements();
              if (
                lBouton &&
                lBouton.estValider &&
                aListeSelection.count() > 0
              ) {
                aListeSelection.parcourir((aElement) => {
                  const lNewElement = new ObjetElement_1.ObjetElement(
                    aElement.getLibelle(),
                    null,
                    Enumere_DocumentJoint_1.EGenreDocumentJoint.Cloud,
                  );
                  lNewElement.service = this.param.service;
                  lNewElement.idPartage = aElement.idPartage;
                  lNewElement.url = aElement.url;
                  lNewElement.publiPdf = aElement.pubPdf
                    ? aElement.formatPub
                    : TTypeElementCloud_1.TypeFormatPublication.FP_Natif;
                  lNewElement.setEtat(Enumere_Etat_1.EGenreEtat.Creation);
                  lListeDocs.add(lNewElement);
                });
              }
              this.callback.appel({
                bouton: aGenreBouton,
                estValider: !!(lBouton && lBouton.estValider),
                service: this.param.service,
                listeSelection: aListeSelection,
                listeNouveauxDocs: lListeDocs,
              });
            }
          })
          .finally(() => {
            this.fermer();
          });
      }
      composeContenu() {
        const T = [];
        T.push(
          IE.jsx.str(
            'div',
            { class: 'bloc' },
            IE.jsx.str(
              'div',
              { class: 'entete-cloud' },
              IE.jsx.str('div', {
                class: 'fil-ariane-cloud',
                'ie-html': 'getHtmlFilAriane',
              }),
            ),
            IE.jsx.str('div', {
              id: this.getNomInstance(this.idListe),
              class: 'liste-fichiers',
            }),
            !this.optionsFenetre.modeSelectionRepertoirePourUpload
              ? IE.estMobile
                ? IE.jsx.str(
                    'ie-bouton',
                    {
                      class: 'selecfile-button themeBoutonNeutre',
                      'ie-model': 'btnUpload',
                      'ie-selecfile': true,
                      'ie-class': 'btnUpload.getClass',
                    },
                    ObjetTraduction_1.GTraductions.getValeur(
                      'FenetreCloud.Deposer_Cloud',
                    ),
                  )
                : IE.jsx.str(
                    'div',
                    {
                      class: 'selecfile-droppable',
                      'ie-model': 'btnUpload',
                      'ie-selecfile': true,
                      'ie-class': 'btnUpload.getClass',
                      role: 'button',
                      tabindex: '0',
                    },
                    ObjetTraduction_1.GTraductions.getValeur(
                      'FenetreCloud.GlissezDeposer_Cloud',
                    ),
                  )
              : '',
          ),
        );
        return T.join('');
      }
      composeBas() {
        const T = [];
        if (!this.optionsFenetre.modeSelectionRepertoirePourUpload) {
          T.push(
            '<div>',
            UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getHtmlBtnMonsieurFiche(
              'btnMrFiche',
            ),
            '</div>',
          );
        }
        return T.join('');
      }
      getSelection(aRacine) {
        const lResult = new ObjetListeElements_1.ObjetListeElements();
        const lNb = aRacine.listeFichier ? aRacine.listeFichier.count() : 0;
        for (let i = 0; i < lNb; i++) {
          const lElement = aRacine.listeFichier.get(i);
          if (lElement.estCoche) {
            const lNewElement = new ObjetElement_1.ObjetElement(
              lElement.getLibelle(),
              lElement.getGenre(),
            );
            lNewElement.idPartage = lElement.idPartage;
            lNewElement.formatPub = lElement.formatPub;
            lNewElement.pubPdf = lElement.pubPdf;
            lResult.addElement(lNewElement);
          }
          if (
            lElement.getGenre() ===
            TTypeElementCloud_1.TTypeElementCloud.tec_Dossier
          ) {
            lResult.add(this.getSelection(lElement));
          }
        }
        return lResult;
      }
      _surReponseCloudAttente(aParamCloud, aEnAuthCloud = false) {
        if (
          'status' in aParamCloud &&
          aParamCloud.status ===
            TypeStatutInterrogationCloud_1.TypeStatutInterrogationCloud
              .sic_OK &&
          !aEnAuthCloud
        ) {
          if (!this.param.inscriptionSeule) {
            this.idPartageDossierSelection = null;
            if ('idPartage' in aParamCloud && aParamCloud.idPartage) {
              this.idPartageDossierSelection = aParamCloud.idPartage;
              const lDossier = this._getDossierDIdPartageDansRacine(
                this.idPartageDossierSelection,
              );
              if (lDossier && aParamCloud.racineFichier) {
                const lElementService =
                  this.listeCloud.getElementParNumeroEtGenre(
                    null,
                    aParamCloud.service,
                  );
                this._setDonneesListe(
                  new DonneesListe_FichiersCloud_1.DonneesListe_FichiersCloud(
                    aParamCloud.racineFichier.listeFichier,
                  ),
                  lElementService,
                );
                this.getInstance(this.idListe).focusSurPremierElement();
              }
            } else if (
              'racineFichier' in aParamCloud &&
              aParamCloud.racineFichier
            ) {
              const lElementService =
                this.listeCloud.getElementParNumeroEtGenre(
                  null,
                  aParamCloud.service,
                );
              this.param = aParamCloud;
              this.idPartageDossierSelection =
                aParamCloud.racineFichier.idPartage;
              this._setDonneesListe(
                new DonneesListe_FichiersCloud_1.DonneesListe_FichiersCloud(
                  this.param.racineFichier.listeFichier,
                ),
                lElementService,
              );
            } else {
            }
          } else {
            if (
              MethodesObjet_1.MethodesObjet.isFunction(
                this.param.callbackInscriptionSeule,
              )
            ) {
              this.param.callbackInscriptionSeule();
            }
            this.fermer();
          }
        } else if (
          'status' in aParamCloud &&
          aParamCloud.status ===
            TypeStatutInterrogationCloud_1.TypeStatutInterrogationCloud
              .sic_TokenInvalide &&
          !aEnAuthCloud
        ) {
          UtilitaireOAuth2_1.UtilitaireOAuth2.authentificationPromise(
            aParamCloud.idOAuth2,
          ).then(
            () => {
              new ObjetRequeteCloudAttente_1.ObjetRequeteCloudAttente(this)
                .lancerRequete(aParamCloud)
                .then((aParamsReponse) => {
                  let lService =
                    GEtatUtilisateur.listeCloud.getElementParNumeroEtGenre(
                      null,
                      aParamCloud.service,
                    );
                  if (!!lService) {
                    lService.idOAuth2 = aParamCloud.idOAuth2;
                  }
                  lService =
                    GEtatUtilisateur.listeCloudDepotServeur.getElementParNumeroEtGenre(
                      null,
                      aParamCloud.service,
                    );
                  if (!!lService) {
                    lService.idOAuth2 = aParamCloud.idOAuth2;
                  }
                  if (aParamCloud.partageFichier) {
                    this.valider(aParamsReponse);
                  } else {
                    this._surReponseCloudAttente(
                      aParamsReponse,
                      aParamCloud.oauth,
                    );
                  }
                });
            },
            () => {
              this.fermer();
            },
          );
        } else {
          GApplication.getMessage()
            .afficher({
              message:
                aParamCloud.message ||
                ObjetTraduction_1.GTraductions.getValeur('requete.erreur'),
            })
            .then(() => {
              this.fermer();
            });
        }
      }
      _eventListe(aParametres) {
        switch (aParametres.genreEvenement) {
          case Enumere_EvenementListe_1.EGenreEvenementListe.Selection: {
            if (
              aParametres.article.getGenre() ===
              TTypeElementCloud_1.TTypeElementCloud.tec_Dossier
            ) {
              this._actualiserDossierDIdPartage(aParametres.article.idPartage);
            }
            break;
          }
        }
      }
      _setDonneesListe(aDonneesListe, aElementService) {
        this.getInstance(this.idListe).setDonnees(
          aDonneesListe.setOptions({
            estMonoSelection: this.optionsFenetre.estMonoSelection,
            uniquementRepertoireVisible:
              this.optionsFenetre.modeSelectionRepertoirePourUpload,
            avecSelectionRepertoire:
              (aElementService && aElementService.avecPartageDossier) ||
              this.optionsFenetre.modeSelectionRepertoirePourUpload,
            avecFormat: aElementService && aElementService.avecChoixFormat,
          }),
        );
      }
      _requeteRecupFichiersDIdPartage(aIdPartage) {
        if (!this._estIdPartageValide(aIdPartage)) {
          return null;
        }
        return new ObjetRequeteCloudAttente_1.ObjetRequeteCloudAttente(this)
          .lancerRequete({
            service: this.param.service,
            idPartage: aIdPartage,
            recupFichiers: true,
          })
          .then((aParams) => {
            if (
              !aParams.racineFichier ||
              aIdPartage !== aParams.racineFichier.idPartage
            ) {
              return null;
            }
            this._parcoursDossiersRacine((aElement, aPere) => {
              if (aElement.idPartage === aIdPartage) {
                aElement.listeFichier = aParams.racineFichier.listeFichier;
                aElement.pere = aPere;
              }
            });
            return aParams;
          })
          .catch((e) => {
            return null;
          });
      }
      _actualiserDossierDIdPartage(aIdPartage) {
        this._requeteRecupFichiersDIdPartage(aIdPartage).then((aParams) => {
          this.getInstance(this.idListe).reset();
          this._deselectionnerTout(this.param.racineFichier);
          if (aParams) {
            aParams.idPartage = aIdPartage;
            return this._surReponseCloudAttente(aParams);
          }
        });
      }
      _composeMessage(aListeFichiers) {
        const H = [];
        H.push(
          '<div class="Gras">',
          ObjetTraduction_1.GTraductions.getValeur(
            'FenetreCloud.ExplicationFenetreFormat',
          ),
          '</div>',
        );
        H.push('<div class="EspaceHaut EspaceGauche">');
        aListeFichiers.parcourir((aEle) => {
          H.push(
            '<div><span>' +
              aEle.getLibelle() +
              '</span><ie-radio ie-model="radioFormat(\'' +
              aEle.idPartage +
              "'," +
              TTypeElementCloud_1.TypeFormatPublication.FP_Natif,
            ')" class="EspaceHaut">',
            ObjetTraduction_1.GTraductions.getValeur(
              'FenetreCloud.FormatOrigine',
            ),
            '</ie-radio><ie-radio ie-model="radioFormat(\'' +
              aEle.idPartage +
              "'," +
              TTypeElementCloud_1.TypeFormatPublication.FP_Pdf,
            ')" class="EspaceHaut">',
            ObjetTraduction_1.GTraductions.getValeur('FenetreCloud.FormatPdf'),
            '</ie-radio></div>',
          );
        });
        H.push('</div>');
        H.push(
          '<div class="GrandEspaceHaut">',
          ObjetTraduction_1.GTraductions.getValeur(
            'FenetreCloud.ConfirmationFenetreFormat',
          ),
          '</div>',
        );
        return H.join('');
      }
      _uploadListeFichiersVersCloud(aListeFichiers) {
        if (
          aListeFichiers &&
          aListeFichiers.count() > 0 &&
          this._estIdPartageValide(this.idPartageDossierSelection)
        ) {
          const lListeFichiersResultat =
            new ObjetListeElements_1.ObjetListeElements();
          return UtilitaireRequetesCloud_1.UtilitaireRequetesCloud.requeteUploadVersCloudListFichiers(
            {
              idPartageDossier: this.idPartageDossierSelection,
              service: this.param.service,
              listeFichiersATraiter: aListeFichiers,
              listeFichiersResultat: lListeFichiersResultat,
            },
          ).then(
            () => {
              if (lListeFichiersResultat.count() > 0) {
                return this._requeteRecupFichiersDIdPartage(
                  this.idPartageDossierSelection,
                ).then((aParams) => {
                  if (!aParams || !aParams.racineFichier) {
                    return;
                  }
                  this._parcoursDossiersRacine((aFichierSource) => {
                    if (
                      aFichierSource.selection &&
                      aFichierSource.getGenre() ===
                        TTypeElementCloud_1.TTypeElementCloud.tec_Fichier
                    ) {
                      aParams.racineFichier.listeFichier.parcourir(
                        (aFichier) => {
                          if (aFichier.idPartage === aFichierSource.idPartage) {
                            aFichier.selection = true;
                          }
                        },
                      );
                    }
                  });
                  lListeFichiersResultat.parcourir((aFichierUpload) => {
                    if (
                      aFichierUpload.idPartage &&
                      aParams.racineFichier &&
                      aParams.racineFichier.listeFichier
                    ) {
                      aParams.racineFichier.listeFichier.parcourir(
                        (aFichier) => {
                          if (
                            aFichier.idPartage === aFichierUpload.idPartage &&
                            aFichier.getGenre() ===
                              TTypeElementCloud_1.TTypeElementCloud.tec_Fichier
                          ) {
                            aFichier.selection = true;
                            return false;
                          }
                        },
                      );
                    }
                  });
                  aParams.idPartage = this.idPartageDossierSelection;
                  return this._surReponseCloudAttente(aParams);
                });
              }
            },
            () => {},
          );
        }
      }
      _parcoursDossiers(aDossier, aFunc, aParent) {
        if (aDossier) {
          if (aFunc(aDossier, aParent) === false) {
            return false;
          }
          if (
            aDossier.getGenre() ===
              TTypeElementCloud_1.TTypeElementCloud.tec_Dossier &&
            aDossier.listeFichier &&
            aDossier.listeFichier.parcourir
          ) {
            aDossier.listeFichier.parcourir((aElement) => {
              return this._parcoursDossiers(aElement, aFunc, aDossier);
            });
          }
        }
      }
      _parcoursDossiersRacine(aFunc) {
        return this._parcoursDossiers(this.param.racineFichier, aFunc);
      }
      _getDossierDIdPartageDansRacine(aIdPartage) {
        let lResult = null;
        if (!this._estIdPartageValide(aIdPartage)) {
          return null;
        }
        this._parcoursDossiersRacine((aDossier) => {
          if (aDossier.idPartage === aIdPartage) {
            lResult = aDossier;
            return false;
          }
        });
        return lResult;
      }
      _getTabParentsDIdPartage(aIdPartage) {
        const lTab = [];
        let lDossier = this._getDossierDIdPartageDansRacine(aIdPartage);
        if (lDossier) {
          lTab.push(lDossier);
          while (lDossier.pere) {
            lDossier = this._getDossierDIdPartageDansRacine(
              lDossier.pere.idPartage,
            );
            if (lDossier) {
              lTab.push(lDossier);
            }
          }
        }
        return lTab.reverse();
      }
      _deselectionnerTout(aElementArbre) {
        this._parcoursDossiers(aElementArbre, (aElement) => {
          if (aElement.estCoche) {
            aElement.estCoche = false;
          }
        });
      }
      _estIdPartageValide(aIdPartage) {
        return !!aIdPartage || aIdPartage === '';
      }
    }
    exports.ObjetFenetre_FichiersCloud = ObjetFenetre_FichiersCloud;
  },
  fn: 'objetfenetre_fichierscloud.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireGestionCloudEtPDF = void 0;
    const ObjetFenetre_SelectionClouds_1 = require('ObjetFenetre_SelectionClouds');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetFenetre_FichiersCloud_1 = require('ObjetFenetre_FichiersCloud');
    const ObjetTraduction_1 = require('ObjetTraduction');
    exports.UtilitaireGestionCloudEtPDF = {
      modeGestion: { PDF: 'pdf', Cloud: 'cloud', PDFEtCloud: 'pdfEtCloud' },
      creerFenetreGestion(aParams) {
        const lAvecCloudDisponible = aParams.avecDepot
          ? GEtatUtilisateur.listeCloudDepotServeur.count() > 0
          : GEtatUtilisateur.avecCloudDisponibles();
        let lAvecPDF = [
          exports.UtilitaireGestionCloudEtPDF.modeGestion.PDF,
          exports.UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,
        ].includes(aParams.modeGestion);
        const lAvecCloud =
          [
            exports.UtilitaireGestionCloudEtPDF.modeGestion.Cloud,
            exports.UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud,
          ].includes(aParams.modeGestion) && lAvecCloudDisponible;
        let lTitre;
        if (!!aParams.titre) {
          lTitre = aParams.titre;
        } else if (aParams.avecTitreSelonOnglet) {
          const lOnglet = GEtatUtilisateur.getOngletSelectionne();
          lTitre = lOnglet
            ? lOnglet.libelleLong
              ? lOnglet.libelleLong
              : lOnglet.getLibelle()
            : '';
        }
        if (!lTitre) {
          switch (aParams.modeGestion) {
            case exports.UtilitaireGestionCloudEtPDF.modeGestion.PDF:
            case exports.UtilitaireGestionCloudEtPDF.modeGestion.PDFEtCloud:
              lTitre = ObjetTraduction_1.GTraductions.getValeur(
                'ListeClouds.TitrePDF',
              );
              break;
            case exports.UtilitaireGestionCloudEtPDF.modeGestion.Cloud:
              lTitre = ObjetTraduction_1.GTraductions.getValeur(
                'ListeClouds.TitreCloud',
              );
              break;
            default:
              break;
          }
        }
        let lHauteur = 0;
        if (lAvecPDF) {
          lHauteur += 150;
        }
        if (lAvecCloud) {
          lHauteur += 250;
        }
        let lFenetre = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_SelectionClouds_1.ObjetFenetre_SelectionClouds,
          {
            pere: this,
            evenement: function (aLigne, aService) {
              aParams.callbaskEvenement.call(this, aLigne, aService);
            },
            initialiser: function (aInstance) {
              aInstance.setOptionsFenetre({
                titre: lTitre,
                largeur: 380,
                hauteurMaxContenu: 600,
                hauteur: lHauteur,
                avecScroll: true,
                listeBoutons: [],
              });
            },
          },
        );
        if (aParams.avecMessage && aParams.message && aParams.message !== '') {
          lFenetre.setOptionsFenetreSelectionClouds({
            avecMessage: aParams.avecMessage,
          });
          lFenetre.setMessage(aParams.message);
        }
        if (aParams.avecBtnTelecharger) {
          lFenetre.setOptionsFenetreSelectionClouds({
            avecBtnTelecharger: aParams.avecBtnTelecharger,
          });
        }
        lFenetre.setDonnees({
          avecPDF: lAvecPDF,
          avecClouds: lAvecCloud,
          callbackParametrage: aParams.callbackParametrage,
          callbackTelechargement: aParams.callbackTelechargement,
          callbackFermeture: aParams.callbackFermeture,
          avecDepot: aParams.avecDepot,
        });
        lFenetre.afficher();
        return lFenetre;
      },
      async ouvrirFenetreCloud(aParams) {
        const lParams = Object.assign(
          {
            instance: {},
            modeGestion: exports.UtilitaireGestionCloudEtPDF.modeGestion.Cloud,
          },
          aParams,
        );
        return await new Promise((aResolve) => {
          exports.UtilitaireGestionCloudEtPDF.creerFenetreGestion(
            Object.assign(lParams, {
              callbaskEvenement: (aLigne) => {
                if (aLigne >= 0) {
                  const lService = GEtatUtilisateur.listeCloud.get(aLigne);
                  ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
                    ObjetFenetre_FichiersCloud_1.ObjetFenetre_FichiersCloud,
                    {
                      pere: lParams.instance || {},
                      evenement(aParam) {
                        if (
                          aParam.listeNouveauxDocs &&
                          aParam.listeNouveauxDocs.count() > 0
                        ) {
                          aResolve(aParam.listeNouveauxDocs);
                        }
                      },
                    },
                  ).setDonnees({ service: lService.getGenre() });
                }
              },
            }),
          );
        });
      },
    };
  },
  fn: 'utilitairegestioncloudetpdf.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetSelecteurPJ = void 0;
    const ObjetSelecteurPJCP_1 = require('ObjetSelecteurPJCP');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const ObjetFenetre_PieceJointe = require('ObjetFenetre_PieceJointe');
    const UtilitaireGestionCloudEtPDF_1 = require('UtilitaireGestionCloudEtPDF');
    class ObjetSelecteurPJ extends ObjetSelecteurPJCP_1.ObjetSelecteurPJCP {
      _initialiserOptions() {
        super._initialiserOptions();
        Object.assign(this._options, {
          genreRessourcePJ:
            Enumere_Ressource_1.EGenreRessource.DocJointEtablissement,
        });
      }
      construireInstances() {
        super.construireInstances();
        if (ObjetFenetre_PieceJointe) {
          this.identEditionPJ = this.addFenetre(
            ObjetFenetre_PieceJointe,
            this.evntEditionPJ,
            this.initEditionPJ,
          );
        }
      }
      ouvrirFenetreChoixListeCloud(aCallbackParFichier, aCallbackFinal) {
        UtilitaireGestionCloudEtPDF_1.UtilitaireGestionCloudEtPDF.ouvrirFenetreCloud(
          { instance: this },
        ).then((aListeDocuments) => {
          aListeDocuments.parcourir((aElement) => {
            aCallbackParFichier(aElement);
          });
          aCallbackFinal();
        });
      }
    }
    exports.ObjetSelecteurPJ = ObjetSelecteurPJ;
  },
  fn: 'objetselecteurpj.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeHttpNotificationDonnes = void 0;
    var TypeHttpNotificationDonnes;
    (function (TypeHttpNotificationDonnes) {
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_ListeDocJointEtablissement'] = 0)
      ] = 'THND_ListeDocJointEtablissement';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_ListeClasse'] = 1)
      ] = 'THND_ListeClasse';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_ListeClasseNiveau'] = 2)
      ] = 'THND_ListeClasseNiveau';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_ListeGroupe'] = 3)
      ] = 'THND_ListeGroupe';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_ListeProfesseur'] = 4)
      ] = 'THND_ListeProfesseur';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_AutorisationProfesseur'] = 5)
      ] = 'THND_AutorisationProfesseur';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_AutorisationPersonnel'] = 6)
      ] = 'THND_AutorisationPersonnel';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_NombreDepotDocumentCasierNonLus'] = 7)
      ] = 'THND_NombreDepotDocumentCasierNonLus';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_NombreMessagesNonLus'] = 8)
      ] = 'THND_NombreMessagesNonLus';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_NombreActualitesNonLues'] = 9)
      ] = 'THND_NombreActualitesNonLues';
      TypeHttpNotificationDonnes[
        (TypeHttpNotificationDonnes['THND_Kiosque'] = 10)
      ] = 'THND_Kiosque';
    })(
      TypeHttpNotificationDonnes ||
        (exports.TypeHttpNotificationDonnes = TypeHttpNotificationDonnes = {}),
    );
  },
  fn: 'typehttpnotificationdonnes.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreDiscussion = void 0;
    var TypeGenreDiscussion;
    (function (TypeGenreDiscussion) {
      TypeGenreDiscussion[(TypeGenreDiscussion['GD_Discussion'] = 0)] =
        'GD_Discussion';
      TypeGenreDiscussion[(TypeGenreDiscussion['GD_ContactVS'] = 1)] =
        'GD_ContactVS';
      TypeGenreDiscussion[(TypeGenreDiscussion['GD_Conversation'] = 2)] =
        'GD_Conversation';
      TypeGenreDiscussion[(TypeGenreDiscussion['GD_Alerte'] = 3)] = 'GD_Alerte';
      TypeGenreDiscussion[(TypeGenreDiscussion['GD_Harcelement'] = 4)] =
        'GD_Harcelement';
    })(
      TypeGenreDiscussion ||
        (exports.TypeGenreDiscussion = TypeGenreDiscussion = {}),
    );
  },
  fn: 'typegenrediscussion.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeOrigineCreationEtiquetteMessageUtil =
      exports.TypeOrigineCreationEtiquetteMessage = void 0;
    var TypeOrigineCreationEtiquetteMessage;
    (function (TypeOrigineCreationEtiquetteMessage) {
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Utilisateur'] = 0)
      ] = 'OCEM_Utilisateur';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Reception'] = 1)
      ] = 'OCEM_Pre_Reception';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Archive'] = 2)
      ] = 'OCEM_Pre_Archive';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Envoye'] = 3)
      ] = 'OCEM_Pre_Envoye';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Brouillon'] = 4)
      ] = 'OCEM_Pre_Brouillon';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Poubelle'] = 5)
      ] = 'OCEM_Pre_Poubelle';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Signalement'] = 6)
      ] = 'OCEM_Pre_Signalement';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Expl_Bleu'] = 7)
      ] = 'OCEM_Expl_Bleu';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Expl_Vert'] = 8)
      ] = 'OCEM_Expl_Vert';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Expl_Rouge'] = 9)
      ] = 'OCEM_Expl_Rouge';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_CarnetLiaison'] = 10)
      ] = 'OCEM_Pre_CarnetLiaison';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Alerte'] = 11)
      ] = 'OCEM_Pre_Alerte';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_ContactVS'] = 12)
      ] = 'OCEM_Pre_ContactVS';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Conversation'] = 13)
      ] = 'OCEM_Pre_Conversation';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage[
          'OCEM_Pre_InvisiblePlageDesactivee'
        ] = 14)
      ] = 'OCEM_Pre_InvisiblePlageDesactivee';
      TypeOrigineCreationEtiquetteMessage[
        (TypeOrigineCreationEtiquetteMessage['OCEM_Pre_Harcelement'] = 15)
      ] = 'OCEM_Pre_Harcelement';
    })(
      TypeOrigineCreationEtiquetteMessage ||
        (exports.TypeOrigineCreationEtiquetteMessage =
          TypeOrigineCreationEtiquetteMessage =
            {}),
    );
    const TypeOrigineCreationEtiquetteMessageUtil = {
      estEtiquettePerso(aGenreEtiquette) {
        return (
          TypeOrigineCreationEtiquetteMessageUtil.tabEtiquetesPersos.indexOf(
            aGenreEtiquette,
          ) >= 0
        );
      },
      tabEtiquetesPersos: [
        TypeOrigineCreationEtiquetteMessage.OCEM_Utilisateur,
        TypeOrigineCreationEtiquetteMessage.OCEM_Expl_Bleu,
        TypeOrigineCreationEtiquetteMessage.OCEM_Expl_Vert,
        TypeOrigineCreationEtiquetteMessage.OCEM_Expl_Rouge,
      ],
    };
    exports.TypeOrigineCreationEtiquetteMessageUtil =
      TypeOrigineCreationEtiquetteMessageUtil;
  },
  fn: 'typeoriginecreationetiquettemessage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeHttpReponseMessage = void 0;
    var TypeHttpReponseMessage;
    (function (TypeHttpReponseMessage) {
      TypeHttpReponseMessage[(TypeHttpReponseMessage['rm_Envoi'] = 0)] =
        'rm_Envoi';
      TypeHttpReponseMessage[(TypeHttpReponseMessage['rm_EnvoiATous'] = 1)] =
        'rm_EnvoiATous';
      TypeHttpReponseMessage[(TypeHttpReponseMessage['rm_Relance'] = 2)] =
        'rm_Relance';
      TypeHttpReponseMessage[
        (TypeHttpReponseMessage['rm_EnvoiATousSaufParentEleve'] = 3)
      ] = 'rm_EnvoiATousSaufParentEleve';
      TypeHttpReponseMessage[
        (TypeHttpReponseMessage['rm_RelanceATousSaufParentEleve'] = 4)
      ] = 'rm_RelanceATousSaufParentEleve';
      TypeHttpReponseMessage[(TypeHttpReponseMessage['rm_ClotureAlerte'] = 5)] =
        'rm_ClotureAlerte';
    })(
      TypeHttpReponseMessage ||
        (exports.TypeHttpReponseMessage = TypeHttpReponseMessage = {}),
    );
  },
  fn: 'typehttpreponsemessage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreStatutConnexionUtil =
      exports.TypeGenreStatutConnexionBase =
      exports.TypeGenreStatutConnexion =
        void 0;
    var TypeGenreStatutConnexion;
    (function (TypeGenreStatutConnexion) {
      TypeGenreStatutConnexion[
        (TypeGenreStatutConnexion['GSC_Disponible'] = 0)
      ] = 'GSC_Disponible';
      TypeGenreStatutConnexion[(TypeGenreStatutConnexion['GSC_EnCours'] = 1)] =
        'GSC_EnCours';
      TypeGenreStatutConnexion[
        (TypeGenreStatutConnexion['GSC_NePasDeranger'] = 2)
      ] = 'GSC_NePasDeranger';
      TypeGenreStatutConnexion[
        (TypeGenreStatutConnexion['GSC_Deconnecte'] = 3)
      ] = 'GSC_Deconnecte';
    })(
      TypeGenreStatutConnexion ||
        (exports.TypeGenreStatutConnexion = TypeGenreStatutConnexion = {}),
    );
    var TypeGenreStatutConnexionBase;
    (function (TypeGenreStatutConnexionBase) {
      TypeGenreStatutConnexionBase[
        (TypeGenreStatutConnexionBase['SCB_Connecte'] = 0)
      ] = 'SCB_Connecte';
      TypeGenreStatutConnexionBase[
        (TypeGenreStatutConnexionBase['SCB_NePasDeranger'] = 1)
      ] = 'SCB_NePasDeranger';
      TypeGenreStatutConnexionBase[
        (TypeGenreStatutConnexionBase['SCB_Invisible'] = 2)
      ] = 'SCB_Invisible';
    })(
      TypeGenreStatutConnexionBase ||
        (exports.TypeGenreStatutConnexionBase = TypeGenreStatutConnexionBase =
          {}),
    );
    const ObjetTraduction_1 = require('ObjetTraduction');
    require('TypeStatutConnexion.css');
    const TypeGenreStatutConnexionUtil = {
      getClassIcon(aGenre) {
        switch (aGenre) {
          case TypeGenreStatutConnexion.GSC_Disponible:
            return 'TypeGenreStatutConnexion-GSC_Disponible';
          case TypeGenreStatutConnexion.GSC_EnCours:
            return 'TypeGenreStatutConnexion-GSC_EnCours';
          case TypeGenreStatutConnexion.GSC_NePasDeranger:
            return 'TypeGenreStatutConnexion-GSC_NePasDeranger';
          default:
            return 'TypeGenreStatutConnexion-GSC_Deconnecte';
        }
      },
      toLibelle(aGenre, aAvecLibelleInvisible) {
        switch (aGenre) {
          case TypeGenreStatutConnexion.GSC_Disponible:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.Connectee',
            );
          case TypeGenreStatutConnexion.GSC_EnCours:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.EnClasse',
            );
          case TypeGenreStatutConnexion.GSC_NePasDeranger:
            return ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.NePasDeranger',
            );
          default:
            return aAvecLibelleInvisible
              ? ObjetTraduction_1.GTraductions.getValeur('Messagerie.Invisible')
              : ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.NonConnectee',
                );
        }
      },
    };
    exports.TypeGenreStatutConnexionUtil = TypeGenreStatutConnexionUtil;
  },
  fn: 'typestatutconnexion.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports._Cache = void 0;
    class _Cache {
      constructor() {
        this._actif = true;
        this._donnees = {};
      }
      setActif(aActif) {
        this._actif = aActif;
      }
      getActif() {
        const lApp = GApplication;
        if (lApp.getOptionsDebug() && lApp.getOptionsDebug().desactiver_Cache) {
          return false;
        }
        return this._actif;
      }
      getCle(aTableauElements) {
        let lCle = '';
        for (let i = 0; i < aTableauElements.length; i++) {
          lCle += aTableauElements[i].getCle();
        }
        return lCle;
      }
      vider(aCle) {
        if (aCle) {
          if (this.existeDonnee(aCle)) {
            this.effacer(aCle);
          }
        } else {
          this._donnees = {};
        }
      }
      effacer(aCle) {
        const tmpArray = {};
        for (const x in this._donnees) {
          if (x !== aCle) {
            tmpArray[x] = this._donnees[x];
          }
        }
        this._donnees = tmpArray;
      }
      existeDonnee(aCle) {
        const lApp = GApplication;
        if (lApp.getOptionsDebug() && lApp.getOptionsDebug().desactiver_Cache) {
          return false;
        }
        if (!this.getActif()) {
          return false;
        }
        return this._donnees[aCle] !== undefined;
      }
      getDonnee(aCle) {
        return this._donnees[aCle];
      }
      setDonnee(aCle, aObjetDonnee) {
        this._donnees[aCle] = aObjetDonnee;
      }
    }
    exports._Cache = _Cache;
  },
  fn: '_cache.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.GCache = void 0;
    const _Cache_1 = require('_Cache');
    class Cache extends _Cache_1._Cache {
      constructor() {
        super();
        this._init();
      }
      _init() {
        this.general = new _Cache_1._Cache();
        this.ficheScolaire = new _Cache_1._Cache();
        this.resultatsClasses = new _Cache_1._Cache();
        this.dossierVS = new _Cache_1._Cache();
        this.agenda = new _Cache_1._Cache();
        this.livretScolaire = new _Cache_1._Cache();
        this.creneauxLibres = new _Cache_1._Cache();
      }
      reset() {
        this._init();
      }
    }
    exports.GCache = new Cache();
  },
  fn: 'cache.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeGenreNiveauResponsabiliteUtil =
      exports.TypeGenreNiveauResponsabilite = void 0;
    var TypeGenreNiveauResponsabilite;
    (function (TypeGenreNiveauResponsabilite) {
      TypeGenreNiveauResponsabilite[
        (TypeGenreNiveauResponsabilite['gnrAucun'] = 0)
      ] = 'gnrAucun';
      TypeGenreNiveauResponsabilite[
        (TypeGenreNiveauResponsabilite['gnrLegal'] = 1)
      ] = 'gnrLegal';
      TypeGenreNiveauResponsabilite[
        (TypeGenreNiveauResponsabilite['gnrEnCharge'] = 2)
      ] = 'gnrEnCharge';
      TypeGenreNiveauResponsabilite[
        (TypeGenreNiveauResponsabilite['gnrContact'] = 3)
      ] = 'gnrContact';
    })(
      TypeGenreNiveauResponsabilite ||
        (exports.TypeGenreNiveauResponsabilite = TypeGenreNiveauResponsabilite =
          {}),
    );
    const C_GenreNiveauResponsabiliteLegauxEnCharge = [
      TypeGenreNiveauResponsabilite.gnrLegal,
      TypeGenreNiveauResponsabilite.gnrEnCharge,
    ];
    exports.TypeGenreNiveauResponsabiliteUtil = {
      estFiltreParDefautActif(aTypeFonction) {
        return C_GenreNiveauResponsabiliteLegauxEnCharge.includes(
          aTypeFonction,
        );
      },
    };
  },
  fn: 'typegenreniveauresponsabilite.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteListePublics = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const TypeEnsembleNombre_1 = require('TypeEnsembleNombre');
    const Cache_1 = require('Cache');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetElement_1 = require('ObjetElement');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const TypeGenreNiveauResponsabilite_1 = require('TypeGenreNiveauResponsabilite');
    const MethodesObjet_1 = require('MethodesObjet');
    class ObjetRequeteListePublics extends ObjetRequeteJSON_1.ObjetRequeteConsultation {
      lancerRequete(aParam) {
        this.genres = aParam.genres;
        this.sansFiltreSurEleve = aParam.sansFiltreSurEleve || false;
        this.entreResponsables = aParam.entreResponsables;
        this.pourMessagerie = aParam.pourMessagerie;
        this.JSON = {
          genres: new TypeEnsembleNombre_1.TypeEnsembleNombre().add(
            aParam.genres,
          ),
          pourMessagerie: aParam.pourMessagerie,
          sansFiltreSurEleve: this.sansFiltreSurEleve,
          avecFonctionPersonnel: aParam.avecFonctionPersonnel || false,
          avecFiltreDelegues: aParam.avecFiltreDelegues,
          classe: aParam.classe,
          eleve: aParam.eleve,
          avecInfoRencontresSepareesDesResponsables:
            !!aParam.avecInfoRencontresSepareesDesResponsables,
          avecInfoResponsablePreferentiel:
            !!aParam.avecInfoResponsablePreferentiel,
        };
        const lCleCache = this._getCle();
        if (
          this.pourMessagerie &&
          Cache_1.GCache &&
          Cache_1.GCache.general._jetonViderCacheMessagerie &&
          Cache_1.GCache.general.existeDonnee(lCleCache)
        ) {
          delete Cache_1.GCache.general._jetonViderCacheMessagerie;
          Cache_1.GCache.general.vider(lCleCache);
        }
        if (
          Cache_1.GCache &&
          Cache_1.GCache.general._jetonViderCacheListePublics &&
          Cache_1.GCache.general.existeDonnee(lCleCache)
        ) {
          delete Cache_1.GCache.general._jetonViderCacheListePublics;
          Cache_1.GCache.general.vider(lCleCache);
        }
        if (Cache_1.GCache && Cache_1.GCache.general.existeDonnee(lCleCache)) {
          return new Promise((aResolve, aReject) => {
            this.reussitePromesse = aResolve;
            this.echecPromesse = aReject;
            this.executerCallbackReussite(
              aParam.genres,
              Cache_1.GCache.general.getDonnee(lCleCache),
            );
          });
        } else {
          return this.appelAsynchrone();
        }
      }
      _getCle() {
        return `listePublic_${this.genres.sort().join('_')}${this.sansFiltreSurEleve}_${this.entreResponsables}_${!!this.pourMessagerie}`;
      }
      actionApresRequete() {
        if (Cache_1.GCache) {
          Cache_1.GCache.general.setDonnee(this._getCle(), this.JSONReponse);
        }
        this.executerCallbackReussite(this.genres, this.JSONReponse);
      }
      executerCallbackReussite(aGenres, aDonneesJSON) {
        if (aDonneesJSON.listeFamilles) {
          if (aDonneesJSON.listePublics) {
            aDonneesJSON.listePublics.parcourir((aPublic) => {
              if (
                aPublic.listeNumerosSousFamille &&
                aPublic.listeNumerosSousFamille.length > 0
              ) {
                for (
                  let i = 0;
                  i < aPublic.listeNumerosSousFamille.length;
                  i++
                ) {
                  const lNumeroSousFamilleRecherche =
                    aPublic.listeNumerosSousFamille[i].N;
                  const lGenreSousFamilleRecherche =
                    aPublic.listeNumerosSousFamille[i].G;
                  const lObjFamilleSousFamilleTrouve =
                    this._getFamilleEtSousFamille(
                      aDonneesJSON.listeFamilles,
                      lNumeroSousFamilleRecherche,
                      lGenreSousFamilleRecherche,
                    );
                  if (
                    lObjFamilleSousFamilleTrouve &&
                    lObjFamilleSousFamilleTrouve.famille
                  ) {
                    if (!aPublic.listeFamilles) {
                      aPublic.listeFamilles =
                        new ObjetListeElements_1.ObjetListeElements();
                    }
                    let lFamilleDePublic =
                      aPublic.listeFamilles.getElementParElement(
                        lObjFamilleSousFamilleTrouve.famille,
                      );
                    if (!lFamilleDePublic) {
                      lFamilleDePublic = new ObjetElement_1.ObjetElement(
                        lObjFamilleSousFamilleTrouve.famille.getLibelle(),
                        lObjFamilleSousFamilleTrouve.famille.getNumero(),
                        lObjFamilleSousFamilleTrouve.famille.getGenre(),
                      );
                      aPublic.listeFamilles.add(lFamilleDePublic);
                    }
                    if (lObjFamilleSousFamilleTrouve.sousFamille) {
                      if (!lFamilleDePublic.listeSousFamilles) {
                        lFamilleDePublic.listeSousFamilles =
                          new ObjetListeElements_1.ObjetListeElements();
                      }
                      let lSousFamilleDePublic =
                        lFamilleDePublic.listeSousFamilles.getElementParElement(
                          lObjFamilleSousFamilleTrouve.sousFamille,
                        );
                      if (!lSousFamilleDePublic) {
                        lSousFamilleDePublic = new ObjetElement_1.ObjetElement(
                          lObjFamilleSousFamilleTrouve.sousFamille.getLibelle(),
                          lObjFamilleSousFamilleTrouve.sousFamille.getNumero(),
                          lObjFamilleSousFamilleTrouve.sousFamille.getGenre(),
                        );
                        lFamilleDePublic.listeSousFamilles.add(
                          lSousFamilleDePublic,
                        );
                      }
                    }
                  }
                }
              }
            });
          }
        }
        if (aDonneesJSON.niveauResponsabilite) {
          if (aDonneesJSON.listePublics) {
            const lNiveauLegal =
              aDonneesJSON.niveauResponsabilite.getElementParGenre(
                TypeGenreNiveauResponsabilite_1.TypeGenreNiveauResponsabilite
                  .gnrLegal,
              );
            aDonneesJSON.listePublics.parcourir((aPublic) => {
              if (
                aPublic.getGenre() ===
                  Enumere_Ressource_1.EGenreRessource.Responsable &&
                aPublic.eleves
              ) {
                let lNiveauResponsable;
                aPublic.eleves.parcourir((aEleve) => {
                  if (aEleve.nr === undefined) {
                    aEleve.niveauResponsabilite = lNiveauLegal;
                    if (
                      !lNiveauResponsable ||
                      lNiveauResponsable.getGenre() > lNiveauLegal.getGenre() ||
                      lNiveauResponsable.getGenre() ===
                        TypeGenreNiveauResponsabilite_1
                          .TypeGenreNiveauResponsabilite.gnrAucun
                    ) {
                      lNiveauResponsable = lNiveauLegal;
                    }
                  } else {
                    const lNiveau =
                      aDonneesJSON.niveauResponsabilite.getElementParGenre(
                        aEleve.nr,
                      );
                    if (!!lNiveau) {
                      aEleve.niveauResponsabilite = lNiveau;
                    }
                    if (
                      !lNiveauResponsable ||
                      lNiveauResponsable.getGenre() > lNiveau.getGenre() ||
                      lNiveauResponsable.getGenre() ===
                        TypeGenreNiveauResponsabilite_1
                          .TypeGenreNiveauResponsabilite.gnrAucun
                    ) {
                      lNiveauResponsable = lNiveau;
                    }
                  }
                });
                if (lNiveauResponsable) {
                  aPublic.niveauResponsabilite = lNiveauResponsable;
                }
              }
            });
          }
          aDonneesJSON.niveauResponsabilite.parcourir(
            (aNiveauResponsabilite) => {
              aNiveauResponsabilite.actif =
                TypeGenreNiveauResponsabilite_1.TypeGenreNiveauResponsabiliteUtil.estFiltreParDefautActif(
                  aNiveauResponsabilite.getGenre(),
                );
            },
          );
        }
        if (aDonneesJSON.listePublics) {
          aDonneesJSON.listePublics.parcourir((aPublic) => {
            if (aPublic.eleves) {
              const lListeClasses =
                new ObjetListeElements_1.ObjetListeElements();
              const lListeGroupes =
                new ObjetListeElements_1.ObjetListeElements();
              const lListeElevesResponsablePreferentiel = [];
              aPublic.eleves.parcourir((aEleve) => {
                var _a;
                if (aEleve.classe) {
                  const lMaClasse = lListeClasses.getElementParElement(
                    aEleve.classe,
                  );
                  if (!lMaClasse) {
                    lListeClasses.add(
                      MethodesObjet_1.MethodesObjet.dupliquer(aEleve.classe),
                    );
                  } else if (
                    aEleve.classe.estClasseMN &&
                    ((_a = aEleve.classe.classesNiv) === null || _a === void 0
                      ? void 0
                      : _a.count())
                  ) {
                    for (const lMaClasseNiv of aEleve.classe.classesNiv) {
                      if (
                        !lMaClasse.classesNiv
                          .getTableauNumeros()
                          .includes(lMaClasseNiv.getNumero())
                      ) {
                        lMaClasse.classesNiv.add(lMaClasseNiv);
                      }
                    }
                  }
                }
                if (aEleve.groupes) {
                  aEleve.groupes.parcourir((aGroupe) => {
                    if (!lListeGroupes.getElementParElement(aGroupe)) {
                      lListeGroupes.add(aGroupe);
                    }
                  });
                }
                if (aEleve.estPreferentiel) {
                  lListeElevesResponsablePreferentiel.push(aEleve.getNumero());
                  delete aEleve.estPreferentiel;
                }
              });
              aPublic.classes = lListeClasses;
              aPublic.groupes = lListeGroupes;
              if (lListeElevesResponsablePreferentiel.length > 0) {
                aPublic.listeNumElevesResponsablePreferentiel =
                  lListeElevesResponsablePreferentiel;
              }
            }
          });
        }
        this.callbackReussite.appel({
          genres: aGenres,
          listePublic: aDonneesJSON.listePublics,
          listeFamilles: aDonneesJSON.listeFamilles,
          listeServicesPeriscolaire: aDonneesJSON.listeServicesPeriscolaire,
          listeProjetsAcc: aDonneesJSON.listeProjetsAcc,
          listeNiveauxResponsabilite: aDonneesJSON.niveauResponsabilite,
        });
      }
      _getFamilleEtSousFamille(
        aListeFamilles,
        aNumeroSousFamille,
        aGenreSousFamille,
      ) {
        const lResult = { famille: null, sousFamille: null };
        if (aListeFamilles) {
          aListeFamilles.parcourir((aFamille) => {
            if (aFamille.listeSousFamilles) {
              aFamille.listeSousFamilles.parcourir((aSousFamille) => {
                if (
                  aSousFamille.egalParNumeroEtGenre(
                    aNumeroSousFamille,
                    aGenreSousFamille,
                  )
                ) {
                  lResult.sousFamille = aSousFamille;
                  return false;
                }
              });
              if (lResult.sousFamille) {
                lResult.famille = aFamille;
                return false;
              }
            }
          });
        }
        return lResult;
      }
    }
    exports.ObjetRequeteListePublics = ObjetRequeteListePublics;
    CollectionRequetes_1.Requetes.inscrire(
      'ListePublics',
      ObjetRequeteListePublics,
    );
  },
  fn: 'objetrequetelistepublics.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteListeRessourcesPourCommunication = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    class ObjetRequeteListeRessourcesPourCommunication extends ObjetRequeteJSON_1.ObjetRequeteConsultation {}
    exports.ObjetRequeteListeRessourcesPourCommunication =
      ObjetRequeteListeRessourcesPourCommunication;
    CollectionRequetes_1.Requetes.inscrire(
      'ListeRessourcesPourCommunication',
      ObjetRequeteListeRessourcesPourCommunication,
    );
  },
  fn: 'objetrequetelisteressourcespourcommunication.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.DonneesListe_SelectionRessource = void 0;
    const ObjetStyle_1 = require('ObjetStyle');
    const ObjetDonneesListe_1 = require('ObjetDonneesListe');
    class DonneesListe_SelectionRessource extends ObjetDonneesListe_1.ObjetDonneesListe {
      constructor(aDonnees) {
        super(aDonnees);
        this.setOptions({
          avecSuppression: false,
          avecDeploiement: true,
          avecEtatSaisie: false,
        });
      }
      avecEdition(aParams) {
        return aParams.colonne === 0 && !aParams.article.nonEditable;
      }
      getColonneTransfertEdition(aParams) {
        if (!this.avecSelection(aParams) && !this.avecEdition(aParams)) {
          return 0;
        }
      }
      avecEvenementApresEdition(aParams) {
        return true;
      }
      surEdition(aParams, V) {
        switch (aParams.colonne) {
          case 0:
            if (aParams.article.estUnDeploiement) {
              this.Donnees.parcourir((aFils) => {
                if (aFils.pere === aParams.article) {
                  aFils.selectionne = V;
                }
              });
            } else {
              aParams.article.selectionne = V;
            }
            break;
        }
      }
      getValeur(aParams) {
        switch (aParams.colonne) {
          case 0:
            if (aParams.article.estUnDeploiement) {
              return this.getEtatCocheSelonFils(aParams.article, aParams);
            }
            return aParams.article.selectionne;
          case 1:
            return aParams.article.getLibelle();
        }
        return '';
      }
      getTypeValeur(aParams) {
        switch (aParams.colonne) {
          case 0:
            return ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Coche;
          case 1:
            return ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Texte;
        }
        return ObjetDonneesListe_1.ObjetDonneesListe.ETypeCellule.Texte;
      }
      getStyle(aParams) {
        switch (aParams.colonne) {
          case 1:
            return aParams.article.getActif()
              ? ''
              : ObjetStyle_1.GStyle.composeCouleurTexte(GCouleur.rouge);
        }
        return '';
      }
      getClass(aParams) {
        switch (aParams.colonne) {
          case 1:
            return this._options && this._options.getClassRessource
              ? this._options.getClassRessource(aParams.article)
              : aParams.article && aParams.article.estUnDeploiement
                ? 'Gras'
                : '';
        }
        return '';
      }
      getCouleurCellule(aParams) {
        if (aParams.article.estUnDeploiement && aParams.colonne !== 0) {
          return ObjetDonneesListe_1.ObjetDonneesListe.ECouleurCellule
            .Deploiement;
        }
      }
      getHintForce(aParams) {
        switch (aParams.colonne) {
          case 1:
            return this._options && this._options.getHintRessource
              ? this._options.getHintRessource(aParams.article)
              : '';
        }
        return '';
      }
      getVisible(D) {
        if (!this._options || !this._options.filtres) {
          return true;
        }
        let lVisible = true;
        for (const i in this._options.filtres) {
          const lFiltre = this._options.filtres[i];
          lVisible = lVisible && lFiltre.filtre(D, lFiltre.checked);
          if (!lVisible) {
            D.selectionne = false;
            return false;
          }
        }
        return lVisible;
      }
      avecImageSurColonneDeploiement(aParams) {
        return aParams.colonne === 1;
      }
      getIndentationCellule(aParams) {
        if (aParams.colonne === 1) {
          return this.getIndentationCelluleSelonParente(aParams);
        }
        return 0;
      }
    }
    exports.DonneesListe_SelectionRessource = DonneesListe_SelectionRessource;
  },
  fn: 'donneesliste_selectionressource.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.DonneesListe_SelectionRessource_fd = void 0;
    const ObjetDonneesListeFlatDesign_1 = require('ObjetDonneesListeFlatDesign');
    class DonneesListe_SelectionRessource_fd extends ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign {
      constructor(aDonnees) {
        super(aDonnees);
        this.setOptions({
          avecBoutonActionLigne: false,
          avecCB: true,
          avecCocheCBSurLigne: true,
          avecSelection: false,
        });
      }
      getValueCB(aParams) {
        return aParams.article.selectionne;
      }
      setValueCB(aParams, aValue) {
        aParams.article.selectionne = aValue;
      }
      getDisabledCB(aParams) {
        return aParams.article.nonEditable;
      }
      estLigneOff(aParams) {
        return aParams.article.nonEditable;
      }
      getStyle(aParams) {
        return aParams.article.getActif() ? '' : `color:${GCouleur.rouge};`;
      }
      getClass(aParams) {
        return this._options && this._options.getClassRessource
          ? this._options.getClassRessource(aParams.article)
          : '';
      }
      getHintForce(aParams) {
        return this._options && this._options.getHintRessource
          ? this._options.getHintRessource(aParams.article)
          : '';
      }
      getVisible(D) {
        if (!this._options || !this._options.filtres) {
          return true;
        }
        let lVisible = true;
        for (const i in this._options.filtres) {
          const lFiltre = this._options.filtres[i];
          lVisible = lVisible && lFiltre.filtre(D, lFiltre.checked);
          if (!lVisible) {
            D.selectionne = false;
            return false;
          }
        }
        return lVisible;
      }
    }
    exports.DonneesListe_SelectionRessource_fd =
      DonneesListe_SelectionRessource_fd;
  },
  fn: 'donneesliste_selectionressource_fd.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_SelectionRessource = void 0;
    const GUID_1 = require('GUID');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_EvenementListe_1 = require('Enumere_EvenementListe');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetListe_1 = require('ObjetListe');
    const DonneesListe_SelectionRessource_1 = require('DonneesListe_SelectionRessource');
    const DonneesListe_SelectionRessource_fd_1 = require('DonneesListe_SelectionRessource_fd');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const tag_1 = require('tag');
    class ObjetFenetre_SelectionRessource extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          largeur: 350,
          heightMax_mobile: true,
          hauteur: 500,
          listeBoutons: [ObjetTraduction_1.GTraductions.getValeur('Valider')],
        });
        this.indexBtnValider = 0;
        const lId = GUID_1.GUID.getId();
        this.idConteneurFiltre = lId + '_Cfiltre';
        this.classFiltres = GUID_1.GUID.getClassCss();
        this._options = {
          selectionObligatoire: false,
          autoriseEltAucun: false,
          listeElementsAPositionnerEnPremier: null,
          filtres: null,
          gestionCumulRessource: null,
          avecBoutonRechercher: true,
          triListe: null,
          avecCocheRessources: true,
          getClassRessource: null,
          getHintRessource: null,
          optionsDonneesListe: null,
          avecBarreTitre: true,
          listeFlatDesign: false,
          selectionCumul: null,
          optionsListe: null,
        };
      }
      getOptions() {
        return this._options;
      }
      setOptionsFenetreSelectionRessource(aOptions) {
        $.extend(this._options, aOptions);
      }
      setSelectionObligatoire(aValeur) {
        this.setOptionsFenetreSelectionRessource({
          selectionObligatoire: aValeur,
        });
      }
      setAutoriseEltAucun(aValeur) {
        this.setOptionsFenetreSelectionRessource({ autoriseEltAucun: aValeur });
      }
      setListeElementsAPositionnerEnPremier(aValeur) {
        this.setOptionsFenetreSelectionRessource({
          listeElementsAPositionnerEnPremier: aValeur,
        });
      }
      setDonnees(aParam) {
        if (aParam.titre) {
          this.setOptionsFenetre({ titre: aParam.titre });
        }
        this.listeRessourcesSelectionnees = aParam.listeRessourcesSelectionnees;
        this.genreRessource = aParam.genreRessource;
        this.construireListeRessource(
          aParam.listeRessources,
          aParam.listeRessourcesSelectionnees,
        );
        this._initialiserListe(this.getInstance(this.identListe));
        this.afficher();
        this._construireFiltres();
        if (!this.optionsFenetre.avecTailleSelonContenu) {
          this.surFixerTaille();
        }
        this._actualiserListe();
        if (this.optionsFenetre.avecTailleSelonContenu) {
          this.positionnerFenetre();
        }
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          cbFiltre: {
            getValue(aIndice) {
              const lFiltre = aInstance._options.filtres[aIndice];
              return lFiltre.checked;
            },
            setValue(aIndice, aValue) {
              aInstance._mettreAJourFiltre(aIndice, aValue);
            },
          },
        });
      }
      _construireFiltres() {
        if (!this._options.filtres || this._options.filtres.length === 0) {
          return;
        }
        const T = [];
        if (this._options.filtres) {
          for (const i in this._options.filtres) {
            const lFiltre = this._options.filtres[i];
            T.push('<div>');
            T.push(
              (0, tag_1.tag)(
                'ie-checkbox',
                { 'ie-model': tag_1.tag.funcAttr('cbFiltre', i) },
                lFiltre.libelle,
              ),
            );
            T.push('</div>');
          }
        }
        ObjetHtml_1.GHtml.setHtml(this.idConteneurFiltre, T.join(''), {
          instance: this,
        });
        ObjetHtml_1.GHtml.setDisplay(this.idConteneurFiltre, true);
      }
      _mettreAJourFiltre(aNumeroFiltre, aChecked) {
        const lFiltre = this._options.filtres[aNumeroFiltre];
        lFiltre.checked = aChecked;
        if (lFiltre.callbackChecked) {
          lFiltre.callbackChecked(aChecked);
        }
        this._actualiserListe();
      }
      forcerMajListeSelection() {
        this._majListeSelection();
      }
      surValidation(ANumeroBouton) {
        if (ANumeroBouton === this.indexBtnValider) {
          this._majListeSelection();
        }
        this.fermer();
        this.callback.appel(
          this.genreRessource,
          this.listeRessourcesSelectionnees,
          ANumeroBouton,
          null,
        );
      }
      construireInstances() {
        this.identListe = this.add(
          ObjetListe_1.ObjetListe,
          this._evenementSurListe,
          this._initialiserListe,
        );
      }
      composeContenu() {
        return (0, tag_1.tag)(
          'div',
          { class: 'flex-contain cols full-height' },
          (T) => {
            T.push(
              '<div id="',
              this.idConteneurFiltre,
              '" class="fix-bloc p-bottom" style="display:none"></div>',
            );
            T.push(
              '<div id="' +
                this.getNomInstance(this.identListe) +
                '" class="fluid-bloc"></div>',
            );
          },
        );
      }
      construireListeRessource(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        if (aListeRessources) {
          let lRessource;
          const lNbr = aListeRessources.count();
          for (let i = 0; i < lNbr; i++) {
            const lElt = aListeRessources.get(i);
            if (
              (this._options.autoriseEltAucun || lElt.existeNumero()) &&
              !lElt.nePasAfficher
            ) {
              if (this._options.gestionCumulRessource) {
                this._options.gestionCumulRessource(lElt, this.listeRessources);
              }
              if (lElt.estUnDeploiement) {
                lRessource = lElt;
              } else {
                lRessource = MethodesObjet_1.MethodesObjet.dupliquer(
                  lElt,
                  true,
                );
                const lEltResSel =
                  aListeRessourcesSelectionnees.getElementParElement(
                    lRessource,
                  );
                if (lEltResSel) {
                  lRessource.selectionne = true;
                  lRessource.avecReponse = !!lEltResSel.avecReponse;
                  lRessource.nonModifiable = !!lEltResSel.nonModifiable;
                  lRessource.nonEditable = !!lEltResSel.nonEditable;
                } else {
                  lRessource.selectionne = false;
                }
              }
              this.listeRessources.addElement(lRessource);
            }
          }
        }
        if (this._options.triListe) {
          this.listeRessources.setTri(this._options.triListe);
        } else {
          this.listeRessources.setTri([
            ObjetTri_1.ObjetTri.initRecursif('pere', [
              ObjetTri_1.ObjetTri.init('Position'),
              ObjetTri_1.ObjetTri.init('Libelle'),
            ]),
          ]);
        }
        this.listeRessources.trier();
      }
      _initialiserListe(aInstance) {
        const lOptions = {};
        if (this._options.listeFlatDesign) {
          Object.assign(lOptions, {
            skin: ObjetListe_1.ObjetListe.skin.flatDesign,
            avecCBToutCocher: !!(
              this._options.avecCocheRessources &&
              this._options.selectionCumul !== false
            ),
          });
        } else {
          Object.assign(lOptions, {
            colonnes: [
              {
                taille: 20,
                titre:
                  this._options.avecBarreTitre &&
                  this._options.avecCocheRessources &&
                  this._options.selectionCumul !== false
                    ? { estCoche: true }
                    : '',
              },
              {
                taille: '100%',
                titre: this._options.avecBarreTitre
                  ? ObjetTraduction_1.GTraductions.getValeur('Nom')
                  : null,
              },
            ],
          });
        }
        if (this._options.optionsListe) {
          $.extend(lOptions, this._options.optionsListe);
        }
        aInstance.setOptionsListe(lOptions);
      }
      _evenementSurListe(aParametres) {
        switch (aParametres.genreEvenement) {
          case Enumere_EvenementListe_1.EGenreEvenementListe
            .ModificationCBLigne:
          case Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition: {
            this.setBoutonActif(
              this.indexBtnValider,
              !this._options.selectionObligatoire ||
                this._nbRessourcesCochees() > 0,
            );
            break;
          }
        }
      }
      _creerObjetDonneesListe() {
        return this._options.listeFlatDesign
          ? new DonneesListe_SelectionRessource_fd_1.DonneesListe_SelectionRessource_fd(
              this.listeRessources,
            )
          : new DonneesListe_SelectionRessource_1.DonneesListe_SelectionRessource(
              this.listeRessources,
            );
      }
      _actualiserListe() {
        this.setBoutonActif(
          this.indexBtnValider,
          !this._options.selectionObligatoire ||
            this._nbRessourcesCochees() > 0,
        );
        const lDonneesListe = this._creerObjetDonneesListe();
        lDonneesListe._options = this._options;
        if (this._options.optionsDonneesListe) {
          lDonneesListe.setOptions(this._options.optionsDonneesListe);
        }
        const lBoutons = [];
        if (this._options.avecBoutonRechercher) {
          lBoutons.push({
            genre: ObjetListe_1.ObjetListe.typeBouton.rechercher,
          });
        }
        if (this._options.gestionCumulRessource) {
          lBoutons.push({ genre: ObjetListe_1.ObjetListe.typeBouton.deployer });
        }
        this.getInstance(this.identListe)
          .setOptionsListe({ boutons: lBoutons })
          .setDonnees(lDonneesListe);
        if (this.optionsFenetre.avecTailleSelonContenu) {
          this.positionnerFenetre();
          this.setCoordonnees();
        }
      }
      _nbRessourcesCochees() {
        let lNombre = 0;
        for (let i = 0, lNb = this.listeRessources.count(); i < lNb; i++) {
          if (this.listeRessources.get(i).selectionne) {
            lNombre++;
          }
        }
        return lNombre;
      }
      _getNbRessourcesSelectionnables() {
        let lCompteur = 0;
        for (let i = 0, lNb = this.listeRessources.count(); i < lNb; i++) {
          if (!this.listeRessources.get(i).estUnDeploiement) {
            lCompteur++;
          }
        }
        return lCompteur;
      }
      _majListeSelection() {
        this.listeRessourcesSelectionnees.vider();
        const lHashCache = new Map();
        const lNb = this.listeRessources.count();
        for (let i = 0; i < lNb; i++) {
          const lRessource = this.listeRessources.get(i);
          const lCle = lRessource.getCleHash();
          if (
            lRessource.selectionne &&
            !lRessource.estUnDeploiement &&
            !lHashCache.has(lCle)
          ) {
            this.listeRessourcesSelectionnees.addElement(
              MethodesObjet_1.MethodesObjet.dupliquer(lRessource),
            );
            lHashCache.set(lCle, true);
          }
        }
      }
    }
    exports.ObjetFenetre_SelectionRessource = ObjetFenetre_SelectionRessource;
  },
  fn: 'objetfenetre_selectionressource.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.DonneesListe_SelectionPublic = void 0;
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetDonneesListeFlatDesign_1 = require('ObjetDonneesListeFlatDesign');
    class DonneesListe_SelectionPublic extends ObjetDonneesListeFlatDesign_1.ObjetDonneesListeFlatDesign {
      constructor(aDonnees) {
        aDonnees.parcourir((D) => {
          if (!D.estUnDeploiement && D.selectionne && D.pere) {
            D.pere.selectionne = true;
          }
        });
        super(aDonnees);
        this.setOptions({
          avecSelection: false,
          avecSuppression: false,
          avecEtatSaisie: false,
          avecTri: false,
          avecCB: true,
          avecEvnt_CB: true,
          avecCocheCBSurLigne: true,
          avecEvnt_Deploiement: true,
          avecEventDeploiementSurCellule: true,
          avecEvnt_ApresEdition: true,
          avecBoutonActionLigne: false,
        });
        this._cacheDoublonArticles = null;
      }
      avecSelection(aParams) {
        return (
          super.avecSelection(aParams) && !aParams.article.estUnDeploiement
        );
      }
      getDisabledCB(aParams) {
        let D = aParams.article;
        return (
          D.avecReponse ||
          D.nonModifiable ||
          D.refusMess ||
          (D.estUnDeploiement &&
            !(this._options && this._options.selectionCumul))
        );
      }
      getValueCB(aParams) {
        if (
          this._options.avecMonoSelectionSurResponsablesAvecRencontreSeparee &&
          this._options.avecInformationEleveDansListeResponsable
        ) {
          if (
            aParams.article.avecRencontresSepareesDesResponsables &&
            aParams.article.estUnDeploiement
          ) {
            const lFils = this.getArrayFilsVisiblesDePere(aParams.article);
            return (
              lFils.filter(
                (aFils) =>
                  'selectionne' in aFils.article && aFils.article.selectionne,
              ).length === 1
            );
          }
        }
        return aParams.article ? aParams.article.selectionne : false;
      }
      avecCB(aParams) {
        if (this._options.avecMonoSelectionDeFamille) {
          const lEstUnDeploimentClasse =
            '__sansClasse__' in aParams.article &&
            aParams.article.getGenre() === 0 &&
            aParams.article.estUnDeploiement;
          const lEstUnDeploimentGroupe =
            '__sans__' in aParams.article &&
            aParams.article.getGenre() === 9 &&
            aParams.article.estUnDeploiement;
          return (
            super.avecCB(aParams) &&
            !lEstUnDeploimentClasse &&
            !lEstUnDeploimentGroupe
          );
        }
        return super.avecCB(aParams);
      }
      estCocheSelonFilsSurLigneDeploiement(aArticle) {
        if (
          this._options.avecMonoSelectionSurResponsablesAvecRencontreSeparee &&
          this._options.avecInformationEleveDansListeResponsable
        ) {
          if (
            !!aArticle.avecRencontresSepareesDesResponsables &&
            aArticle.estUnDeploiement
          ) {
            return false;
          }
        }
        return super.estCocheSelonFilsSurLigneDeploiement(aArticle);
      }
      setValueCB(aParams, aValue) {
        aParams.article.selectionne = aValue;
        if (this._options.avecInformationEleveDansListeResponsable) {
          if (aParams.article.eleves && aParams.article.pere) {
            aParams.article.eleves.parcourir((aEleve) => {
              if (aEleve.getNumero() === aParams.article.pere.getNumero()) {
                aParams.article.eleveConcerne = aValue ? aEleve : undefined;
              }
            });
          }
        }
        if (this._options.avecMonoSelectionDeFamille) {
          this.handleMonoSelectionDeFamille(aParams);
        }
        this.gestionCacheDoublon(aParams.article, aValue);
        if (
          this._options.avecMonoSelectionSurResponsablesAvecRencontreSeparee
        ) {
          this.handleRencontresSepararees(aParams, aValue);
        }
      }
      gestionCacheDoublon(aArticle, aValue) {
        if (this._options.avecCacheDoublonArticles) {
          if (!this._cacheDoublonArticles) {
            this._cacheDoublonArticles = {};
            this.Donnees.parcourir((aElt) => {
              const lKey = _getKeyCache(aElt);
              if (!this._cacheDoublonArticles[lKey]) {
                this._cacheDoublonArticles[lKey] = [];
              }
              this._cacheDoublonArticles[lKey].push(aElt);
            });
          }
          const lTab = this._cacheDoublonArticles[_getKeyCache(aArticle)];
          if (lTab && lTab.forEach) {
            lTab.forEach((aElement) => {
              var _a, _b, _c;
              if (this._options.avecInformationEleveDansListeResponsable) {
                if (
                  (aArticle === null || aArticle === void 0
                    ? void 0
                    : aArticle.pere) &&
                  ((_a =
                    aArticle === null || aArticle === void 0
                      ? void 0
                      : aArticle.pere) === null || _a === void 0
                    ? void 0
                    : _a.getNumero()) ===
                    ((_c =
                      (_b =
                        aElement === null || aElement === void 0
                          ? void 0
                          : aElement.pere) === null || _b === void 0
                        ? void 0
                        : _b.getNumero) === null || _c === void 0
                      ? void 0
                      : _c.call(_b))
                ) {
                  aElement.selectionne = aArticle.selectionne;
                }
                return;
              }
              aElement.selectionne = aValue;
            });
          }
        }
      }
      handleRencontresSepararees(aParams, aValue) {
        var _a, _b, _c, _d, _e, _f, _g;
        if (
          !((_b =
            (_a = aParams.article) === null || _a === void 0
              ? void 0
              : _a.pere) === null || _b === void 0
            ? void 0
            : _b.avecRencontresSepareesDesResponsables) &&
          !((_c = aParams.article) === null || _c === void 0
            ? void 0
            : _c.avecRencontresSepareesDesResponsables)
        ) {
          return;
        }
        if (!this._options.avecInformationEleveDansListeResponsable) {
          return;
        }
        const lEleveAvecRencontresSepareesDesResponsables = (
          (_e =
            (_d = aParams.article) === null || _d === void 0
              ? void 0
              : _d.pere) === null || _e === void 0
            ? void 0
            : _e.avecRencontresSepareesDesResponsables
        )
          ? aParams.article.pere
          : aParams.article;
        const lResponsables = this.getArrayFilsVisiblesDePere(
          lEleveAvecRencontresSepareesDesResponsables,
        );
        let lResponsablePreferentiel = null;
        for (let i = 0; i < lResponsables.length; i++) {
          const lResponsable = lResponsables[i].article;
          const lEstResponsablePreferentiel =
            (_g =
              (_f =
                lResponsable === null || lResponsable === void 0
                  ? void 0
                  : lResponsable.listeNumElevesResponsablePreferentiel) ===
                null || _f === void 0
                ? void 0
                : _f.includes(
                    lEleveAvecRencontresSepareesDesResponsables.getNumero(),
                  )) !== null && _g !== void 0
              ? _g
              : false;
          if (lEstResponsablePreferentiel) {
            lResponsablePreferentiel = lResponsable;
          }
          lResponsable.selectionne = false;
          this.gestionCacheDoublon(lResponsable, false);
        }
        if (!aValue) {
          return;
        }
        const lEstSelectionSurResponsable =
          lEleveAvecRencontresSepareesDesResponsables.getNumero() !==
          aParams.article.getNumero();
        if (lEstSelectionSurResponsable) {
          aParams.article.selectionne = true;
          this.gestionCacheDoublon(aParams.article, true);
          return;
        }
        if (!!lResponsablePreferentiel) {
          lResponsablePreferentiel.selectionne = true;
          this.gestionCacheDoublon(lResponsablePreferentiel, true);
        } else {
          lResponsables[0].article.selectionne = true;
          this.gestionCacheDoublon(lResponsables[0].article, true);
        }
      }
      handleMonoSelectionDeFamille(aParams) {
        const lPere = aParams.article.pere;
        if (!lPere && aParams.article.estUnDeploiement) {
          return;
        }
        this.Donnees.parcourir((aElt) => {
          if (aElt.selectionne && aElt.pere) {
            if (aElt.pere.getNumero() !== lPere.getNumero()) {
              aElt.selectionne = false;
            }
          }
        });
      }
      avecDeploiement() {
        return true;
      }
      surDeploiement(I, J, D) {
        if (this._options.avecFiltreDelegues) {
          return;
        }
        D.estDeploye = !D.estDeploye;
      }
      avecEvenementDeploiement() {
        return !this._options.avecFiltreDelegues;
      }
      avecEventDeploiementSurCellule() {
        return !this._options.avecFiltreDelegues;
      }
      getTitreZonePrincipale(aParams) {
        var _a, _b;
        let D = aParams.article;
        let lLibelleMatieres = '';
        if (!D.estUnDeploiement && D.pere && D.eleves) {
          const lEleve = D.eleves.getElementParNumero(D.pere.getNumero());
          if (lEleve && lEleve.matieres) {
            lLibelleMatieres =
              '<div>' +
              lEleve.matieres.getTableauLibelles().join(', ') +
              '</div>';
          }
        }
        let lIconDetaches = '';
        if (
          this._options.avecIconElevesDetaches &&
          !D.estUnDeploiement &&
          D.estElevesDetachesDuCours
        ) {
          lIconDetaches =
            '<i class="icon_eleve_detache EspaceGauche EspaceDroite"></i>';
        }
        let lLibelle =
          (this._options &&
          this._options.avecIndicationDiscussionInterdit &&
          D.discussionInterdit
            ? '<span style="line-height: 18px; vertical-align: middle;">' +
              D.getLibelle() +
              '</span><div style="float:right;" class="EspaceGauche Image_MessagerieBloquee AlignementMilieuVertical" title="' +
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.HintReponseDicussionInterdite',
              ) +
              '"></div>'
            : D.libelleAffichage !== null && D.libelleAffichage !== undefined
              ? D.libelleAffichage
              : D.getLibelle()) +
          lIconDetaches +
          lLibelleMatieres;
        if (D.listeNumElevesResponsablePreferentiel) {
          if (
            D.listeNumElevesResponsablePreferentiel.includes(
              (_b =
                (_a = D.pere) === null || _a === void 0
                  ? void 0
                  : _a.getNumero) === null || _b === void 0
                ? void 0
                : _b.call(_a),
            )
          ) {
            lLibelle = `${lLibelle} (${ObjetTraduction_1.GTraductions.getValeur('Fenetre_SelectionPublic.Preferentiel')})`;
          }
        }
        if (D.refusMess) {
          lLibelle = `${lLibelle} - ${ObjetTraduction_1.GTraductions.getValeur('Messagerie.RefuseDiscussions')}`;
        }
        return lLibelle;
      }
      getInfosSuppZonePrincipale(aParams) {
        if (this._options && this._options.getInfosSuppZonePrincipale) {
          return this._options.getInfosSuppZonePrincipale(aParams);
        }
        return '';
      }
      getZoneMessage(aParams) {
        if (this._options && this._options.getZoneMessage) {
          return this._options.getZoneMessage(aParams);
        }
        return '';
      }
      getHintForce(aParams) {
        if (this._options && this._options.getHintRessource) {
          return this._options.getHintRessource(aParams.article);
        }
        return '';
      }
      getClass(aParams) {
        if (this._options && this._options.getClassRessource) {
          return this._options.getClassRessource(aParams.article);
        }
        return '';
      }
      getVisible(D) {
        let lVisible = true;
        if (this._options && this._options.filtres) {
          for (const i in this._options.filtres) {
            const lFiltre = this._options.filtres[i];
            lVisible = lVisible && lFiltre.filtre(D, lFiltre.checked);
            if (!lVisible) {
              D.selectionne = false;
              return false;
            }
          }
        }
        if (this.options && this.options.funcFiltreVisible) {
          if (D.estUnDeploiement) {
            lVisible = this.avecFilsVisibleDePere(D);
          } else {
            lVisible = this.options.funcFiltreVisible(D, this.Donnees);
          }
          if (!lVisible) {
            return false;
          }
        }
        if (this._options && this._options.avecFiltreSelonAcceptRdv) {
          if (D.estUnDeploiement) {
            lVisible = this.avecFilsVisibleDePere(D);
          } else {
            lVisible = D.acceptRdv;
          }
          if (!lVisible) {
            return false;
          }
        }
        if (this._options && this._options.avecFiltreAucunAccesEspace) {
          if (D.estUnDeploiement) {
            lVisible = this.avecFilsVisibleDePere(D);
          } else {
            lVisible = D.accesParEspace === true;
          }
          if (!lVisible) {
            return false;
          }
        }
        if (D.estDirEnseignant === true) {
          lVisible = false;
          if (this._options && this._options.avecDirEnseignant === true) {
            lVisible = true;
          }
        }
        return lVisible;
      }
      construireFiltres() {
        if (!this.options.funcFiltreVisible || !this.options.htmlFiltre) {
          return '';
        }
        return this.options.htmlFiltre;
      }
      getControleurFiltres(aDonneesListe) {
        const lOptions = aDonneesListe.options;
        if (!lOptions.funcFiltreVisible && !lOptions.filtreControleur) {
          return {};
        }
        return lOptions.filtreControleur;
      }
      estFiltresParDefaut() {
        if (!this.options.funcFiltreVisible || !this.options.filtreParDefaut) {
          return true;
        }
        return this.options.filtreParDefaut();
      }
      reinitFiltres() {
        if (this.options.funcFiltreVisible && this.options.reinitFiltres) {
          this.options.reinitFiltres();
        }
      }
      getEtatCocheSelonFils(
        aElementPere,
        aParams,
        aMethodeAvecEdition,
        aPourCocheTout,
      ) {
        const lEtat = super.getEtatCocheSelonFils(
          aElementPere,
          aParams,
          aMethodeAvecEdition,
          aPourCocheTout,
        );
        if (
          this._options.avecMonoSelectionSurResponsablesAvecRencontreSeparee
        ) {
          if (aElementPere.avecRencontresSepareesDesResponsables) {
            if (
              lEtat ===
              ObjetDonneesListeFlatDesign_1.ObjetDonneesListe.EGenreCoche.Grise
            ) {
              return ObjetDonneesListeFlatDesign_1.ObjetDonneesListe.EGenreCoche
                .Verte;
            }
          }
        }
        return lEtat;
      }
    }
    exports.DonneesListe_SelectionPublic = DonneesListe_SelectionPublic;
    function _getKeyCache(aElement) {
      return `${aElement.getNumero()}___${aElement.getGenre()}`;
    }
  },
  fn: 'donneesliste_selectionpublic.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_SelectionPublic =
      exports.TypeGenreCumulSelectionPublic = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_EvenementObjetSaisie_1 = require('Enumere_EvenementObjetSaisie');
    const ObjetFenetre_SelectionRessource_1 = require('ObjetFenetre_SelectionRessource');
    const ObjetListe_1 = require('ObjetListe');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const ObjetHtml_1 = require('ObjetHtml');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const DonneesListe_SelectionPublic_1 = require('DonneesListe_SelectionPublic');
    const tag_1 = require('tag');
    var TypeGenreCumulSelectionPublic;
    (function (TypeGenreCumulSelectionPublic) {
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['sans'] = 0)
      ] = 'sans';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['classe'] = 1)
      ] = 'classe';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['initial'] = 2)
      ] = 'initial';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['nomEleves'] = 3)
      ] = 'nomEleves';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['lieuEnseignement'] = 4)
      ] = 'lieuEnseignement';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['attendusEnCours'] = 5)
      ] = 'attendusEnCours';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['respDelegues'] = 6)
      ] = 'respDelegues';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['famille'] = 7)
      ] = 'famille';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['servicesPeriscolaire'] = 8)
      ] = 'servicesPeriscolaire';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['groupe'] = 9)
      ] = 'groupe';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['presentielEleve'] = 10)
      ] = 'presentielEleve';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['fonction'] = 11)
      ] = 'fonction';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['projetsAccompagnement'] = 12)
      ] = 'projetsAccompagnement';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['nomElevesClasse'] = 13)
      ] = 'nomElevesClasse';
      TypeGenreCumulSelectionPublic[
        (TypeGenreCumulSelectionPublic['nomElevesGroupe'] = 14)
      ] = 'nomElevesGroupe';
    })(
      TypeGenreCumulSelectionPublic ||
        (exports.TypeGenreCumulSelectionPublic = TypeGenreCumulSelectionPublic =
          {}),
    );
    class ObjetFenetre_SelectionPublic extends ObjetFenetre_SelectionRessource_1.ObjetFenetre_SelectionRessource {
      constructor(...aParams) {
        super(...aParams);
        this.idMessage = this.Nom + '_message';
        this.setOptionsFenetre({
          largeur: 400,
          hauteur: 650,
          listeBoutons: [
            {
              libelle: ObjetTraduction_1.GTraductions.getValeur('Annuler'),
              theme: Type_ThemeBouton_1.TypeThemeBouton.secondaire,
            },
            {
              libelle: ObjetTraduction_1.GTraductions.getValeur('Valider'),
              theme: Type_ThemeBouton_1.TypeThemeBouton.primaire,
            },
          ],
          listeBoutonsInactifs: [],
          heightMax_mobile: true,
          masquerListeSiVide: true,
        });
        this.setSelectionObligatoire(true);
        this.indexBtnValider = 1;
        this.listeRessourcesSelectionneesAvecInfoEleve = null;
        this.donnees = { listeCumuls: null, cumulActif: null };
        this._options = {
          afficherUtilisateurCourant: true,
          selectionCumul: true,
          avecIndicationDiscussionInterdit: false,
          avecFiltreDelegues: false,
          estDeploye: false,
          avecElevesDetaches: false,
          avecBoutonRechercher: true,
          avecCacheDoublonArticles: true,
          avecInformationEleveDansListeResponsable: false,
          avecMonoSelectionDeFamille: false,
          avecMonoSelectionSurResponsablesAvecRencontreSeparee: false,
          avecFiltreSelonAcceptRdv: false,
          avecFiltreAucunAccesEspace: false,
          avecDirEnseignant: false,
        };
      }
      estPourPrimaire() {
        return false;
      }
      setOptions(aOptions) {
        this.setOptionsFenetreSelectionRessource(aOptions);
        return this;
      }
      getGenreCumul() {
        return this.donnees.cumulActif
          ? this.donnees.cumulActif.getGenre()
          : TypeGenreCumulSelectionPublic.sans;
      }
      setGenreCumulActif(aGenreCumul) {
        if (aGenreCumul) {
          let lCumulDepuisListe = null;
          if (!!this.donnees.listeCumuls) {
            lCumulDepuisListe =
              this.donnees.listeCumuls.getElementParGenre(aGenreCumul);
          }
          if (!lCumulDepuisListe) {
            lCumulDepuisListe = new ObjetElement_1.ObjetElement(
              '',
              0,
              aGenreCumul,
              0,
            );
          }
          this.setCumulActif(lCumulDepuisListe);
        }
      }
      setCumulActif(aCumul) {
        this.donnees.cumulActif = aCumul;
      }
      setListeCumuls(aListeCumuls) {
        this.donnees.listeCumuls = aListeCumuls;
      }
      construireInstances() {
        this.identListe = this.add(
          ObjetListe_1.ObjetListe,
          this._evenementSurListe,
          this._initialiserListe,
        );
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          comboCumul: {
            init(aCombo) {
              aInstance.comboCumul = aCombo;
              aCombo.setOptionsObjetSaisie({
                longueur: 160,
                texteEdit: ObjetTraduction_1.GTraductions.getValeur(
                  'Fenetre_SelectionPublic.Cumul.Label',
                ),
              });
            },
            event(aParams) {
              if (
                aParams.genreEvenement ===
                Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
                  .selection
              ) {
                aInstance.setCumulActif(aParams.element);
                aInstance.forcerMajListeSelection();
                aInstance.actualiserAffichage();
              }
            },
          },
        });
      }
      composeContenu() {
        return (0, tag_1.tag)(
          'div',
          { class: 'flex-contain cols full-height' },
          (T) => {
            T.push(
              '<div class="m-top-l fix-bloc" id="',
              this.idConteneurFiltre,
              '" style="display:none"></div>',
            );
            T.push(
              (0, tag_1.tag)(
                'div',
                { class: 'fix-bloc' },
                (0, tag_1.tag)('ie-combo', {
                  'ie-model': 'comboCumul',
                  class: [
                    'PetitEspaceBas',
                    IE.estMobile ? '' : 'GrandEspaceGauche',
                  ],
                  style: 'display:none',
                }),
              ),
            );
            T.push(
              '<div id="' +
                this.getNomInstance(this.identListe) +
                '" class="fluid-bloc"></div>',
            );
            T.push(
              '<div style="display:none" class="Espace" id="',
              this.idMessage,
              '">',
              ObjetTraduction_1.GTraductions.getValeur(
                'Fenetre_SelectionPublic.AucunDestinataire',
              ),
              '</div>',
            );
          },
        );
      }
      setDonnees(aParam) {
        this.titre = aParam.titre;
        this.estGenreRessourceDUtilisateurConnecte =
          aParam.estGenreRessourceDUtilisateurConnecte;
        this._options.avecIndicationDiscussionInterdit =
          aParam.avecIndicationDiscussionInterdit;
        this.listeRessourcesT = aParam.listeRessources;
        this.listeRessourcesSelectionnees = aParam.listeRessourcesSelectionnees;
        this.genreRessource = aParam.genreRessource;
        this.parametresFiltre = aParam.parametresFiltre;
        this.listeNiveauxResponsabilite = aParam.listeNiveauxResponsabilite;
        if (this._options.avecInformationEleveDansListeResponsable) {
          this.listeRessourcesSelectionneesAvecInfoEleve =
            new ObjetListeElements_1.ObjetListeElements();
        }
        this._formatterDonneesSelonOptions();
        const lBoutons = [];
        if (this._options.avecBoutonRechercher) {
          lBoutons.push({
            genre: ObjetListe_1.ObjetListe.typeBouton.rechercher,
          });
        }
        if (this.parametresFiltre) {
          lBoutons.push({ genre: ObjetListe_1.ObjetListe.typeBouton.filtrer });
        }
        if (this.getGenreCumul() !== TypeGenreCumulSelectionPublic.sans) {
          lBoutons.push({ genre: ObjetListe_1.ObjetListe.typeBouton.deployer });
        }
        this.getInstance(this.identListe).setOptionsListe({
          avecCBToutCocher: !!this._options.avecCocheRessources,
          boutons: lBoutons,
          nonEditable: false,
          avecCelluleEditableTriangle: false,
          avecFiltresVisibles: !!aParam.avecFiltresVisibles,
          messageContenuVide:
            this._options && this._options.avecFiltreSelonAcceptRdv
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'Fenetre_SelectionPublic.AucunAccepteRdv',
                )
              : '',
        });
        this.actualiserAffichage();
        if (this.donnees.listeCumuls && this.donnees.listeCumuls.count() > 0) {
          let lIndice = 0;
          if (this.estPourPrimaire()) {
            if (this.donnees.cumulActif) {
              const lIndiceActif = this.donnees.listeCumuls.getIndiceParElement(
                this.donnees.cumulActif,
              );
              if (lIndiceActif > 0) {
                lIndice = lIndiceActif;
              }
            }
          }
          this.comboCumul.setDonnees(this.donnees.listeCumuls, lIndice);
          $('#' + this.comboCumul.getNom().escapeJQ()).show();
        } else {
          $('#' + this.comboCumul.getNom().escapeJQ()).hide();
        }
        if (this._options.avecFiltreDelegues) {
          $('#' + this.comboCumul.getNom().escapeJQ()).hide();
        }
      }
      _formatterDonneesSelonOptions() {
        const lSelf = this;
        const lNumeroUtilisateur =
          GEtatUtilisateur.getUtilisateur().getNumero();
        this.listeRessourcesT.parcourir((D) => {
          if (
            lSelf._options.afficherUtilisateurCourant === false &&
            lSelf.estGenreRessourceDUtilisateurConnecte &&
            D.getNumero() === lNumeroUtilisateur
          ) {
            D.nePasAfficher = true;
          } else {
            delete D.nePasAfficher;
          }
        });
      }
      actualiserAffichage() {
        switch (this.getGenreCumul()) {
          case TypeGenreCumulSelectionPublic.sans:
            this.construireListeRessource(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.classe:
            this._construireListeRessourceAvecCumulClasse(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.initial:
            this._construireListeRessourceAvecCumulInitial(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.nomEleves:
            this._construireListeRessourceAvecCumulEleves(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.lieuEnseignement:
            this._construireListeRessourceAvecCumulLieuEnseignement(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.attendusEnCours:
            this._construireListeRessourceAvecCumulAttendusEnCours(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.respDelegues:
            this._construireListeRessourceAvecCumulRespDelegues(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.famille: {
            const lFamilleConcernee = this.donnees.cumulActif
              ? this.donnees.cumulActif.famille
              : null;
            this._construireListeRessourceAvecCumulFamille(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
              lFamilleConcernee,
            );
            break;
          }
          case TypeGenreCumulSelectionPublic.servicesPeriscolaire: {
            this._construireListeRessourceAvecCumulServicePeriscolaire(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          }
          case TypeGenreCumulSelectionPublic.groupe:
            this._construireListeRessourceAvecCumulGroupe(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.presentielEleve: {
            this._construireListeRessourceAvecCumulPresentielEleve(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          }
          case TypeGenreCumulSelectionPublic.fonction: {
            this._construireListeRessourceAvecCumulFonction(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          }
          case TypeGenreCumulSelectionPublic.projetsAccompagnement: {
            this._construireListeRessourceAvecCumulProjAcc(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          }
          case TypeGenreCumulSelectionPublic.nomElevesClasse:
            this._construireListeRessourceAvecCumulElevesClasse(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          case TypeGenreCumulSelectionPublic.nomElevesGroupe:
            this._construireListeRessourceAvecCumulElevesGroupe(
              this.listeRessourcesT,
              this.listeRessourcesSelectionnees,
            );
            break;
          default:
            break;
        }
        if (
          this._options.autoriseEltAucun &&
          this._options.listeElementsAPositionnerEnPremier
        ) {
          if (this._options.listeElementsAPositionnerEnPremier.count() > 0) {
            this._options.listeElementsAPositionnerEnPremier.parcourir(
              (aElement, aIndex) => {
                this.listeRessources.insererElement(aElement, aIndex);
              },
            );
          }
        }
        if (this.titre) {
          this.setOptionsFenetre({ titre: this.titre });
        }
        this.afficher();
        this._construireFiltres();
        this._actualiserListe();
      }
      surValidation(ANumeroBouton) {
        if (ANumeroBouton === this.indexBtnValider) {
          this._majListeSelection();
          if (this._options.avecInformationEleveDansListeResponsable) {
            this._formatListeRessourcesSelectionneesAvecInfoEleve(
              this.listeRessourcesSelectionnees,
            );
          }
        }
        this.fermer();
        this.callback.appel(
          this.genreRessource,
          this.listeRessourcesSelectionnees,
          ANumeroBouton,
          this.listeRessourcesSelectionneesAvecInfoEleve,
        );
      }
      _majListeSelection() {
        this.listeRessourcesSelectionnees.vider();
        const lHashCache = new Map();
        const lNb = this.listeRessources.count();
        for (let i = 0; i < lNb; i++) {
          const lRessource = this.listeRessources.get(i);
          let lCle =
            this.getCleHashElementAvecInformationEleveDansResponsable(
              lRessource,
            );
          if (
            lRessource.selectionne &&
            !lRessource.estUnDeploiement &&
            (!lHashCache.has(lCle) || !this._options.avecCacheDoublonArticles)
          ) {
            this.listeRessourcesSelectionnees.addElement(
              MethodesObjet_1.MethodesObjet.dupliquer(lRessource),
            );
            lHashCache.set(lCle, true);
          }
        }
      }
      _formatListeRessourcesSelectionneesAvecInfoEleve(aListe) {
        this.listeRessourcesSelectionneesAvecInfoEleve.vider();
        const lListe = aListe;
        const lListeEleves = new Set();
        for (let i = 0; i < lListe.count(); i++) {
          const lRessource = lListe.get(i);
          if (!lRessource.eleves) {
            continue;
          }
          const lEleveConcerne = lRessource.eleveConcerne || lRessource.pere;
          const lObjetElementRessource = new ObjetElement_1.ObjetElement(
            lRessource.getLibelle(),
            lRessource.getNumero(),
            lRessource.getGenre(),
          );
          if (lEleveConcerne) {
            if (lListeEleves.has(lEleveConcerne.getNumero())) {
              const lRessourceSelectionnee =
                this.listeRessourcesSelectionneesAvecInfoEleve.getElementParFiltre(
                  (aRessource) =>
                    aRessource.eleveConcerne &&
                    aRessource.eleveConcerne.getNumero() ===
                      lEleveConcerne.getNumero(),
                );
              if (
                lRessourceSelectionnee &&
                lRessourceSelectionnee.responsables
              ) {
                lRessourceSelectionnee.responsables.add(lObjetElementRessource);
              }
            } else {
              const lRessourceSelectionnee = ObjetElement_1.ObjetElement.create(
                {
                  eleveConcerne:
                    MethodesObjet_1.MethodesObjet.dupliquer(lEleveConcerne),
                  responsables:
                    new ObjetListeElements_1.ObjetListeElements().add(
                      lObjetElementRessource,
                    ),
                },
              );
              this.listeRessourcesSelectionneesAvecInfoEleve.add(
                lRessourceSelectionnee,
              );
              lListeEleves.add(lEleveConcerne.getNumero());
            }
          }
        }
      }
      _initialiserListe(aInstance) {
        let lOptions = {
          skin: ObjetListe_1.ObjetListe.skin.flatDesign,
          avecCBToutCocher: !!this._options.avecCocheRessources,
        };
        if (this._options.optionsListe) {
          $.extend(lOptions, this._options.optionsListe);
        }
        aInstance.setOptionsListe(lOptions);
      }
      _actualiserListe() {
        this.setBoutonActif(
          this.indexBtnValider,
          !this.selectionObligatoire || this._nbRessourcesCochees() > 0,
        );
        const lDonneesListe =
          new DonneesListe_SelectionPublic_1.DonneesListe_SelectionPublic(
            this.listeRessources,
          );
        if (this.parametresFiltre) {
          lDonneesListe.setOptions(this.parametresFiltre);
        }
        lDonneesListe._options = this._options;
        lDonneesListe._options.avecIconElevesDetaches =
          this._options.avecElevesDetaches;
        if (this._options.optionsDonneesListe) {
          lDonneesListe.setOptions(this._options.optionsDonneesListe);
        }
        if (
          this.listeRessources.count() > 0 ||
          !this.optionsFenetre.masquerListeSiVide
        ) {
          this.getInstance(this.identListe).setDonnees(lDonneesListe);
          if (this._options.forcerDeploiementSurElementSelectionne) {
            this.forcerDeploiementSurElementSelectionne();
          }
        } else {
          ObjetHtml_1.GHtml.setDisplay(this.idMessage, true);
          ObjetHtml_1.GHtml.setDisplay(
            this.getNomInstance(this.identListe),
            false,
          );
        }
      }
      getCleHashElementAvecInformationEleveDansResponsable(aElement) {
        let lCle = aElement.getCleHash();
        if (this._options.avecInformationEleveDansListeResponsable) {
          if ('pere' in aElement) {
            return `${lCle}_${aElement.pere.getCleHash()}`;
          }
          if ('eleveConcerne' in aElement) {
            return `${lCle}_${aElement.eleveConcerne.getCleHash()}`;
          }
        }
        return lCle;
      }
      forcerDeploiementSurElementSelectionne() {}
      _construireListeRessourceAvecCumulClasse(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lCumulGroupe = new ObjetElement_1.ObjetElement(
          ObjetTraduction_1.GTraductions.getValeur(
            'Fenetre_SelectionPublic.SansClasse',
          ),
          0,
          0,
        );
        lCumulGroupe.estDeploye = this._options.estDeploye || false;
        lCumulGroupe.estUnDeploiement = true;
        lCumulGroupe.__sansClasse__ = true;
        lCumulGroupe.setActif(true);
        const lListeCumulClasses =
          new ObjetListeElements_1.ObjetListeElements();
        const lListeCumulClassesMN =
          new ObjetListeElements_1.ObjetListeElements();
        let lAvecGroupe = false;
        const lCacheRessSelec = new Map();
        aListeRessourcesSelectionnees.parcourir((aElement) => {
          if (aElement && aElement.existe()) {
            lCacheRessSelec.set(aElement.getCleHash(), aElement);
          }
        });
        const lAjouterRessourceALaListe = (aRessource, aPere) => {
          const lMaRessource =
            MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
          lMaRessource.pere = aPere;
          const lEltResSel = lCacheRessSelec.get(aRessource.getCleHash());
          if (lEltResSel) {
            lMaRessource.selectionne = true;
            lMaRessource.avecReponse = !!lEltResSel.avecReponse;
            aRessource.nonModifiable = !!lEltResSel.nonModifiable;
          } else {
            lMaRessource.selectionne = false;
          }
          this.listeRessources.addElement(lMaRessource);
        };
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        for (let i = 0, lNbr = aListeRessources.count(); i < lNbr; i++) {
          if (aListeRessources.get(i).existeNumero()) {
            const lRessource = MethodesObjet_1.MethodesObjet.dupliquer(
              aListeRessources.get(i),
            );
            const lCleMap = lRessource.getCleHash();
            if (!lRessource.classes || lRessource.classes.count() === 0) {
              lAvecGroupe = true;
              lRessource.pere = lCumulGroupe;
              const lEltResSel = lCacheRessSelec.get(lCleMap);
              if (lEltResSel) {
                lRessource.selectionne = true;
                lRessource.avecReponse = !!lEltResSel.avecReponse;
                lRessource.nonModifiable = !!lEltResSel.nonModifiable;
              } else {
                lRessource.selectionne = false;
              }
              this.listeRessources.addElement(lRessource);
            } else {
              for (
                let j = 0, lNbr2 = lRessource.classes.count();
                j < lNbr2;
                j++
              ) {
                const lClasse = lRessource.classes.get(j);
                let lNiveau = lListeCumulClasses.get(
                  lListeCumulClasses.getIndiceParNumeroEtGenre(
                    lClasse.getNumero(),
                  ),
                );
                if (!lNiveau) {
                  const lSansClasse = !lClasse.getLibelle();
                  lNiveau = new ObjetElement_1.ObjetElement(
                    lClasse.getLibelle() ||
                      ObjetTraduction_1.GTraductions.getValeur(
                        'Fenetre_SelectionPublic.SansClasse',
                      ),
                    lClasse.getNumero(),
                    0,
                  );
                  lNiveau.estUnDeploiement = true;
                  lNiveau.estDeploye = this._options.estDeploye || false;
                  if (lClasse.estClasseMN) {
                    lNiveau.estClasseMN = true;
                  }
                  lNiveau.__sansClasse__ = lSansClasse;
                  lListeCumulClasses.addElement(lNiveau);
                }
                if (lClasse.estClasseMN && lClasse.classesNiv) {
                  lClasse.classesNiv.parcourir((aNiv) => {
                    let lClasseNiv = lListeCumulClassesMN.get(
                      lListeCumulClassesMN.getIndiceParNumeroEtGenre(
                        aNiv.getNumero(),
                      ),
                    );
                    if (!lClasseNiv) {
                      lClasseNiv = ObjetElement_1.ObjetElement.create({
                        Libelle: aNiv.getLibelle(),
                        Numero: aNiv.getNumero(),
                        Genre: 0,
                        estUnDeploiement: true,
                        estDeploye: this._options.estDeploye || false,
                        __sansClasse__: !aNiv.getLibelle(),
                        pere: lNiveau,
                      });
                      lListeCumulClassesMN.add(lClasseNiv);
                    }
                    lAjouterRessourceALaListe(lRessource, lClasseNiv);
                  });
                } else {
                  lAjouterRessourceALaListe(lRessource, lNiveau);
                }
              }
            }
          }
        }
        if (lAvecGroupe) {
          this.listeRessources.addElement(lCumulGroupe);
        }
        for (let i = 0, lNbr = lListeCumulClasses.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumulClasses.get(i));
        }
        for (let i = 0, lNbr = lListeCumulClassesMN.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumulClassesMN.get(i));
        }
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.initRecursif('pere', [
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.__sansClasse__;
            }),
            ObjetTri_1.ObjetTri.init('Position'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulGroupe(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lCumulGroupe = new ObjetElement_1.ObjetElement(
          ObjetTraduction_1.GTraductions.getValeur(
            'Fenetre_SelectionPublic.SansGroupe',
          ),
          0,
          TypeGenreCumulSelectionPublic.groupe,
        );
        lCumulGroupe.estDeploye = this._options.estDeploye || false;
        lCumulGroupe.estUnDeploiement = true;
        lCumulGroupe.__sans__ = true;
        lCumulGroupe.setActif(true);
        const lListeCumul = new ObjetListeElements_1.ObjetListeElements();
        let lAvecGroupe = false;
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        let lEltResSel;
        for (let i = 0, lNbr = aListeRessources.count(); i < lNbr; i++) {
          if (aListeRessources.get(i).existeNumero()) {
            const lRessource = MethodesObjet_1.MethodesObjet.dupliquer(
              aListeRessources.get(i),
            );
            if (!lRessource.groupes || lRessource.groupes.count() === 0) {
              lAvecGroupe = true;
              lRessource.pere = lCumulGroupe;
              lEltResSel =
                aListeRessourcesSelectionnees.getElementParElement(lRessource);
              if (lEltResSel) {
                lRessource.selectionne = true;
                lRessource.avecReponse = !!lEltResSel.avecReponse;
                lRessource.nonModifiable = !!lEltResSel.nonModifiable;
              } else {
                lRessource.selectionne = false;
              }
              this.listeRessources.addElement(lRessource);
            } else {
              for (
                let j = 0, lNbr2 = lRessource.groupes.count();
                j < lNbr2;
                j++
              ) {
                const lMaRessource =
                  MethodesObjet_1.MethodesObjet.dupliquer(lRessource);
                let lNiveau = lListeCumul.get(
                  lListeCumul.getIndiceParNumeroEtGenre(
                    lRessource.groupes.getNumero(j),
                  ),
                );
                if (!lNiveau) {
                  const lSansClasse = !lRessource.groupes.getLibelle(j);
                  lNiveau = new ObjetElement_1.ObjetElement(
                    lRessource.groupes.getLibelle(j) ||
                      ObjetTraduction_1.GTraductions.getValeur(
                        'Fenetre_SelectionPublic.SansGroupe',
                      ),
                    lRessource.groupes.getNumero(j),
                    TypeGenreCumulSelectionPublic.groupe,
                  );
                  lNiveau.estUnDeploiement = true;
                  lNiveau.estDeploye = this._options.estDeploye || false;
                  lNiveau.__sans__ = lSansClasse;
                  lListeCumul.addElement(lNiveau);
                }
                lMaRessource.pere = lNiveau;
                lEltResSel =
                  aListeRessourcesSelectionnees.getElementParElement(
                    lRessource,
                  );
                if (lEltResSel) {
                  lMaRessource.selectionne = true;
                  lMaRessource.avecReponse = !!lEltResSel.avecReponse;
                  lRessource.nonModifiable = !!lEltResSel.nonModifiable;
                } else {
                  lMaRessource.selectionne = false;
                }
                this.listeRessources.addElement(lMaRessource);
              }
            }
          }
        }
        if (lAvecGroupe) {
          this.listeRessources.addElement(lCumulGroupe);
        }
        for (let i = 0, lNbr = lListeCumul.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumul.get(i));
        }
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.initRecursif('pere', [
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.__sans__;
            }),
            ObjetTri_1.ObjetTri.init('Position'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulInitial(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lCumulGroupe = new ObjetElement_1.ObjetElement(' ', 0, 0);
        lCumulGroupe.estDeploye = this._options.estDeploye || false;
        lCumulGroupe.estUnDeploiement = true;
        lCumulGroupe.setActif(true);
        lCumulGroupe.__sansInitiale__ = true;
        const lListeCumul = new ObjetListeElements_1.ObjetListeElements();
        let lAvecGroupe = false;
        const lCacheRessSelec = new Map();
        aListeRessourcesSelectionnees.parcourir((aElement) => {
          if (aElement && aElement.existe()) {
            lCacheRessSelec.set(aElement.getCleHash(), aElement);
          }
        });
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        for (let i = 0, lNbr = aListeRessources.count(); i < lNbr; i++) {
          if (aListeRessources.get(i).existeNumero()) {
            const lRessource = MethodesObjet_1.MethodesObjet.dupliquer(
              aListeRessources.get(i),
            );
            if (!lRessource.ini) {
              lAvecGroupe = true;
              lRessource.pere = lCumulGroupe;
            } else {
              let lNiveau = lListeCumul.get(
                lListeCumul.getIndiceParLibelle(lRessource.ini),
              );
              if (!lNiveau) {
                lNiveau = new ObjetElement_1.ObjetElement(
                  lRessource.ini,
                  ObjetElement_1.ObjetElement.getNumeroCreation(),
                  0,
                );
                lNiveau.estUnDeploiement = true;
                lNiveau.estDeploye = this._options.estDeploye || false;
                lListeCumul.addElement(lNiveau);
              }
              lRessource.pere = lNiveau;
            }
            const lEltResSel = lCacheRessSelec.get(lRessource.getCleHash());
            if (lEltResSel) {
              lRessource.selectionne = true;
              lRessource.avecReponse = !!lEltResSel.avecReponse;
              lRessource.nonModifiable = !!lEltResSel.nonModifiable;
            } else {
              lRessource.selectionne = false;
            }
            this.listeRessources.addElement(lRessource);
          }
        }
        if (lAvecGroupe) {
          this.listeRessources.addElement(lCumulGroupe);
        }
        for (let i = 0, lNbr = lListeCumul.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumul.get(i));
        }
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.init((D) => {
            return D.pere ? !!D.pere.__sansInitiale__ : !!D.__sansInitiale__;
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return D.pere ? D.pere.getLibelle() : D.getLibelle();
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return !!D.pere;
          }),
          ObjetTri_1.ObjetTri.init('Position'),
          ObjetTri_1.ObjetTri.init('Libelle'),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulPresentielEleve(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {}
      _construireListeRessourceAvecCumulFonction(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lListeRessources = new ObjetListeElements_1.ObjetListeElements();
        let lTestElmAucuneExiste = false;
        if (aListeRessources && aListeRessources.count() > 0) {
          const lCumulAucun = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'actualites.Cumul.sansFonction',
            ),
            0,
            -1,
            1,
          );
          lCumulAucun.estUnDeploiement = true;
          lCumulAucun.estDeploye = false;
          aListeRessources.parcourir((aRessource) => {
            const lRessource =
              MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
            if (
              !!aListeRessourcesSelectionnees.getElementParElement(aRessource)
            ) {
              lRessource.selectionne = true;
            }
            if (lRessource.fonction) {
              let lCumulFonction = lListeRessources.getElementParElement(
                lRessource.fonction,
              );
              if (!lCumulFonction) {
                lCumulFonction = lRessource.fonction;
                lCumulFonction.estUnDeploiement = true;
                lCumulFonction.estDeploye = false;
                lListeRessources.add(lCumulFonction);
              }
              const lRessourceDupliquee =
                MethodesObjet_1.MethodesObjet.dupliquer(lRessource);
              lRessourceDupliquee.pere = lCumulFonction;
              lListeRessources.addElement(lRessourceDupliquee);
            } else {
              lTestElmAucuneExiste =
                lTestElmAucuneExiste ||
                !!lListeRessources.getElementParElement(lCumulAucun);
              if (!lTestElmAucuneExiste) {
                lListeRessources.add(lCumulAucun);
              }
              lRessource.pere = lCumulAucun;
              lListeRessources.addElement(lRessource);
            }
          });
          this.listeRessources = lListeRessources;
          this.listeRessources.setTri([
            ObjetTri_1.ObjetTri.initRecursif('pere', [
              ObjetTri_1.ObjetTri.init('Position'),
              ObjetTri_1.ObjetTri.init('Libelle'),
            ]),
          ]);
          this.listeRessources.trier();
        }
      }
      _construireListeRessourceAvecCumulEleves(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        aListeRessources.parcourir((aRessource) => {
          if (aRessource.eleves) {
            aRessource.eleves.parcourir((aEleve) => {
              let lCumulEleve =
                this.listeRessources.getElementParElement(aEleve);
              if (!lCumulEleve) {
                lCumulEleve = MethodesObjet_1.MethodesObjet.dupliquer(aEleve);
                this.listeRessources.addElement(lCumulEleve);
                lCumulEleve.estUnDeploiement = true;
                lCumulEleve.estDeploye = this._options.estDeploye || false;
              }
              const lRessource =
                MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
              if (aEleve.niveauResponsabilite) {
                lRessource.afficherResponsabilite = true;
                lRessource.niveauResponsabilite =
                  MethodesObjet_1.MethodesObjet.dupliquer(
                    aEleve.niveauResponsabilite,
                  );
              }
              this.listeRessources.addElement(lRessource);
              lRessource.pere = lCumulEleve;
              let lEltResSel = this.getElementDansListeRessourcesSelectionnees(
                aListeRessourcesSelectionnees,
                lRessource,
              );
              lRessource.selectionne = !!lEltResSel;
              if (lEltResSel) {
                lRessource.avecReponse = !!lEltResSel.avecReponse;
                lRessource.nonModifiable = !!lEltResSel.nonModifiable;
              }
            });
          }
        });
        this.listeRessources
          .setTri([
            ObjetTri_1.ObjetTri.initRecursif('pere', [
              ObjetTri_1.ObjetTri.init('Position'),
              ObjetTri_1.ObjetTri.init('Libelle'),
            ]),
          ])
          .trier();
      }
      getElementDansListeRessourcesSelectionnees(
        aListeRessourcesSelectionnees,
        aRessource,
      ) {
        var _a, _b;
        if (this._options.avecInformationEleveDansListeResponsable) {
          const lNumeroEleve =
            ((_a =
              aRessource === null || aRessource === void 0
                ? void 0
                : aRessource.eleveConcerne) === null || _a === void 0
              ? void 0
              : _a.getNumero()) ||
            ((_b =
              aRessource === null || aRessource === void 0
                ? void 0
                : aRessource.pere) === null || _b === void 0
              ? void 0
              : _b.getNumero());
          if (lNumeroEleve) {
            return aListeRessourcesSelectionnees.getElementParFiltre(
              (aRessourceSelectionnee) => {
                var _a, _b;
                const lEstLaMemeRessource =
                  aRessourceSelectionnee.getNumero() === aRessource.getNumero();
                const lConcerneLeMemeEleve = [
                  (_a =
                    aRessourceSelectionnee === null ||
                    aRessourceSelectionnee === void 0
                      ? void 0
                      : aRessourceSelectionnee.pere) === null || _a === void 0
                    ? void 0
                    : _a.getNumero(),
                  (_b =
                    aRessourceSelectionnee === null ||
                    aRessourceSelectionnee === void 0
                      ? void 0
                      : aRessourceSelectionnee.eleveConcerne) === null ||
                  _b === void 0
                    ? void 0
                    : _b.getNumero(),
                ].includes(lNumeroEleve);
                return lEstLaMemeRessource && lConcerneLeMemeEleve;
              },
            );
          }
        }
        return aListeRessourcesSelectionnees.getElementParElement(aRessource);
      }
      _construireListeRessourceAvecCumulRespDelegues(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lEstDeployeParDefaut = this._options.estDeploye || false;
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        aListeRessources.parcourir((aCumul) => {
          if (aCumul.listeResp.count() > 0) {
            const lCumul = new ObjetElement_1.ObjetElement(aCumul.getLibelle());
            lCumul.estUnDeploiement = true;
            lCumul.estDeploye = lEstDeployeParDefaut;
            this.listeRessources.addElement(lCumul);
            aCumul.listeResp.parcourir((aRessource) => {
              const lRessource =
                MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
              if (
                !!aListeRessourcesSelectionnees.getElementParElement(aRessource)
              ) {
                lRessource.selectionne = true;
              }
              if (lRessource.delegueDesClasses) {
                lRessource.setLibelle(
                  lRessource.getLibelle() +
                    ' (' +
                    lRessource.delegueDesClasses +
                    ')',
                );
              }
              lRessource.pere = lCumul;
              this.listeRessources.addElement(lRessource);
            });
          }
        });
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.initRecursif('pere', [
            ObjetTri_1.ObjetTri.init('Position'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulServicePeriscolaire(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lEstDeployeParDefaut = this._options.estDeploye || false;
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        let lTestElmAucuneExiste = false;
        if (aListeRessources && aListeRessources.count() > 0) {
          const lCumulAucun = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.CumulServicePeriscolaire.Sans',
            ),
            0,
            -1,
            1,
          );
          lCumulAucun.estUnDeploiement = true;
          lCumulAucun.estDeploye = false;
          aListeRessources.parcourir((aRessource) => {
            if (
              !!aRessource.listeServicesPeriscolaire &&
              aRessource.listeServicesPeriscolaire.count() > 0
            ) {
              aRessource.listeServicesPeriscolaire.parcourir(
                (aServicePeriscolaire) => {
                  let lRessource =
                    MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
                  if (
                    !!aListeRessourcesSelectionnees.getElementParElement(
                      aRessource,
                    )
                  ) {
                    lRessource.selectionne = true;
                  }
                  let lCumulSP =
                    this.listeRessources.getElementParElement(
                      aServicePeriscolaire,
                    );
                  if (!lCumulSP) {
                    lCumulSP =
                      MethodesObjet_1.MethodesObjet.dupliquer(
                        aServicePeriscolaire,
                      );
                    this.listeRessources.addElement(lCumulSP);
                    lCumulSP.estUnDeploiement = true;
                    lCumulSP.estDeploye = lEstDeployeParDefaut;
                  }
                  lRessource.pere = lCumulSP;
                  this.listeRessources.addElement(lRessource);
                },
              );
            } else {
              let lRessource =
                MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
              if (
                !!aListeRessourcesSelectionnees.getElementParElement(aRessource)
              ) {
                lRessource.selectionne = true;
              }
              lTestElmAucuneExiste =
                lTestElmAucuneExiste ||
                !!this.listeRessources.getElementParElement(lCumulAucun);
              if (!lTestElmAucuneExiste) {
                this.listeRessources.add(lCumulAucun);
              }
              lRessource.pere = lCumulAucun;
              this.listeRessources.addElement(lRessource);
            }
          });
        }
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.initRecursif('pere', [
            ObjetTri_1.ObjetTri.init('Position'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulProjAcc(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lEstDeployeParDefaut = this._options.estDeploye || false;
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        let lTestElmAucuneExiste = false;
        if (aListeRessources && aListeRessources.count() > 0) {
          const lCumulAucun = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.CumulProjetsAccompagnement.Sans',
            ),
            0,
            -1,
            1,
          );
          lCumulAucun.estUnDeploiement = true;
          lCumulAucun.estDeploye = false;
          aListeRessources.parcourir((aRessource) => {
            if (
              !!aRessource.listeProjetsAcc &&
              aRessource.listeProjetsAcc.count() > 0
            ) {
              aRessource.listeProjetsAcc.parcourir((aProjetAcc) => {
                let lRessource =
                  MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
                if (
                  !!aListeRessourcesSelectionnees.getElementParElement(
                    aRessource,
                  )
                ) {
                  lRessource.selectionne = true;
                }
                let lCumulSP =
                  this.listeRessources.getElementParElement(aProjetAcc);
                if (!lCumulSP) {
                  lCumulSP =
                    MethodesObjet_1.MethodesObjet.dupliquer(aProjetAcc);
                  this.listeRessources.addElement(lCumulSP);
                  lCumulSP.estUnDeploiement = true;
                  lCumulSP.estDeploye = lEstDeployeParDefaut;
                }
                lRessource.pere = lCumulSP;
                this.listeRessources.addElement(lRessource);
              });
            } else {
              let lRessource =
                MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
              if (
                !!aListeRessourcesSelectionnees.getElementParElement(aRessource)
              ) {
                lRessource.selectionne = true;
              }
              lTestElmAucuneExiste =
                lTestElmAucuneExiste ||
                !!this.listeRessources.getElementParElement(lCumulAucun);
              if (!lTestElmAucuneExiste) {
                this.listeRessources.add(lCumulAucun);
              }
              lRessource.pere = lCumulAucun;
              this.listeRessources.addElement(lRessource);
            }
          });
        }
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.initRecursif('pere', [
            ObjetTri_1.ObjetTri.init('Position'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulFamille(
        aListeRessources,
        aListeRessourcesSelectionnees,
        aFamilleConcernee,
      ) {
        const lListeRessources = new ObjetListeElements_1.ObjetListeElements();
        let lTestElmAucuneExiste = false;
        if (aListeRessources && aListeRessources.count() > 0) {
          const lCumulAucun = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.CumulFamille.SansRubrique',
            ),
            0,
            -1,
            1,
          );
          lCumulAucun.estUnDeploiement = true;
          lCumulAucun.estDeploye = false;
          aListeRessources.parcourir((aRessource) => {
            const lRessource =
              MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
            if (
              !!aListeRessourcesSelectionnees.getElementParElement(aRessource)
            ) {
              lRessource.selectionne = true;
            }
            let lAppartientAAuMoinsUneSousFamille = false;
            if (lRessource.listeFamilles) {
              const lFamilleTrouvee =
                lRessource.listeFamilles.getElementParElement(
                  aFamilleConcernee,
                );
              if (
                lFamilleTrouvee &&
                lFamilleTrouvee.listeSousFamilles &&
                lFamilleTrouvee.listeSousFamilles.count() > 0
              ) {
                lAppartientAAuMoinsUneSousFamille = true;
                lFamilleTrouvee.listeSousFamilles.parcourir((aSousFamille) => {
                  let lCumulSousFamille =
                    lListeRessources.getElementParElement(aSousFamille);
                  if (!lCumulSousFamille) {
                    lCumulSousFamille = aSousFamille;
                    lCumulSousFamille.estUnDeploiement = true;
                    lCumulSousFamille.estDeploye = false;
                    lListeRessources.add(lCumulSousFamille);
                  }
                  if (lListeRessources.getElementParElement(lRessource)) {
                    const lRessourceDupliquee =
                      MethodesObjet_1.MethodesObjet.dupliquer(lRessource);
                    lRessourceDupliquee.pere = lCumulSousFamille;
                    lListeRessources.addElement(lRessourceDupliquee);
                  } else {
                    lRessource.pere = lCumulSousFamille;
                    lListeRessources.addElement(lRessource);
                  }
                });
              }
            }
            if (!lAppartientAAuMoinsUneSousFamille) {
              lTestElmAucuneExiste =
                lTestElmAucuneExiste ||
                !!lListeRessources.getElementParElement(lCumulAucun);
              if (!lTestElmAucuneExiste) {
                lListeRessources.add(lCumulAucun);
              }
              lRessource.pere = lCumulAucun;
              lListeRessources.addElement(lRessource);
            }
          });
          this.listeRessources = lListeRessources;
          this.listeRessources.setTri([
            ObjetTri_1.ObjetTri.initRecursif('pere', [
              ObjetTri_1.ObjetTri.init('Position'),
              ObjetTri_1.ObjetTri.init('Libelle'),
            ]),
          ]);
          this.listeRessources.trier();
        }
      }
      _construireListeRessourceAvecCumulAttendusEnCours(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lThis = this;
        const lEstDeployeParDefaut = this._options.estDeploye || false;
        const lGenresCumuls = { detaches: 0, attendus: 1 };
        const lListeCumulsPossibles =
          new ObjetListeElements_1.ObjetListeElements();
        lListeCumulsPossibles.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.CumulAttendusEnCours.Detaches',
            ),
            lGenresCumuls.detaches,
            -1,
            1,
          ),
        );
        lListeCumulsPossibles.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.CumulAttendusEnCours.Attendus',
            ),
            lGenresCumuls.attendus,
            -1,
            2,
          ),
        );
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        aListeRessources.parcourir((aRessource) => {
          const lRessource =
            MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
          if (
            !!aListeRessourcesSelectionnees.getElementParElement(aRessource)
          ) {
            lRessource.selectionne = true;
          }
          let lPere;
          if (!!lRessource.estElevesDetachesDuCours) {
            lPere = lListeCumulsPossibles.getElementParNumero(
              lGenresCumuls.detaches,
            );
          } else {
            lPere = lListeCumulsPossibles.getElementParNumero(
              lGenresCumuls.attendus,
            );
          }
          lPere.estUnDeploiement = true;
          lPere.estDeploye = lEstDeployeParDefaut;
          lRessource.pere = lPere;
          lThis.listeRessources.addElement(lRessource);
        });
        lListeCumulsPossibles.parcourir((aCumul) => {
          if (aCumul.estUnDeploiement) {
            lThis.listeRessources.addElement(aCumul);
          }
        });
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.initRecursif('pere', [
            ObjetTri_1.ObjetTri.init('Position'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulLieuEnseignement(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lThis = this;
        const lEstDeployeParDefaut = this._options.estDeploye || false;
        const LieuEnseignement = { ALEtablissement: 0, ALaMaison: 1 };
        const lListeCumulsPossibles =
          new ObjetListeElements_1.ObjetListeElements();
        lListeCumulsPossibles.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.CumulLieuEnseignement.Etablissement',
            ),
            LieuEnseignement.ALEtablissement,
          ),
        );
        lListeCumulsPossibles.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.CumulLieuEnseignement.ALaMaison',
            ),
            LieuEnseignement.ALaMaison,
          ),
        );
        this.listeRessources = new ObjetListeElements_1.ObjetListeElements();
        aListeRessources.parcourir((aRessource) => {
          const lRessource =
            MethodesObjet_1.MethodesObjet.dupliquer(aRessource);
          if (
            !!aListeRessourcesSelectionnees.getElementParElement(aRessource)
          ) {
            lRessource.selectionne = true;
          }
          let lPere;
          if (!!lRessource.estEnEnseignementADistance) {
            lPere = lListeCumulsPossibles.getElementParNumero(
              LieuEnseignement.ALaMaison,
            );
          } else {
            lPere = lListeCumulsPossibles.getElementParNumero(
              LieuEnseignement.ALEtablissement,
            );
          }
          lPere.estUnDeploiement = true;
          lPere.estDeploye = lEstDeployeParDefaut;
          lRessource.pere = lPere;
          lThis.listeRessources.addElement(lRessource);
        });
        lListeCumulsPossibles.parcourir((aCumul) => {
          if (aCumul.estUnDeploiement) {
            lThis.listeRessources.addElement(aCumul);
          }
        });
        this.listeRessources.setTri([
          ObjetTri_1.ObjetTri.initRecursif('pere', [
            ObjetTri_1.ObjetTri.init('Position'),
            ObjetTri_1.ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulElevesClasse(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {}
      _construireListeRessourceAvecCumulElevesGroupe(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {}
    }
    exports.ObjetFenetre_SelectionPublic = ObjetFenetre_SelectionPublic;
  },
  fn: 'objetfenetre_selectionpublic.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const {
      ObjetFenetre_SelectionPublic,
      TypeGenreCumulSelectionPublic,
    } = require('ObjetFenetre_SelectionPublic.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    const { EGenreEspace } = require('Enumere_Espace.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { MethodesObjet } = require('MethodesObjet.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { ObjetTri } = require('ObjetTri.js');
    const { TypeDroits } = require('ObjetDroitsPN.js');
    const { tag } = require('tag.js');
    const {
      TypeGenreNiveauResponsabiliteUtil,
    } = require('TypeGenreNiveauResponsabilite.js');
    const { EGenreEvenementListe } = require('Enumere_EvenementListe.js');
    const {
      TypeGenreNiveauResponsabilite,
    } = require('TypeGenreNiveauResponsabilite.js');
    class ObjetFenetre_SelectionPublic_PN extends ObjetFenetre_SelectionPublic {
      constructor(...aParams) {
        super(...aParams);
        this.avecFiltreSurProfs = ![
          EGenreEspace.Eleve,
          EGenreEspace.PrimEleve,
          EGenreEspace.Mobile_Eleve,
          EGenreEspace.Mobile_PrimEleve,
          EGenreEspace.Parent,
          EGenreEspace.PrimParent,
          EGenreEspace.Mobile_Parent,
          EGenreEspace.Mobile_PrimParent,
          EGenreEspace.Accompagnant,
          EGenreEspace.PrimAccompagnant,
          EGenreEspace.Mobile_Accompagnant,
          EGenreEspace.Mobile_PrimAccompagnant,
        ].includes(GEtatUtilisateur.GenreEspace);
      }
      estPourPrimaire() {
        return GEtatUtilisateur.pourPrimaire();
      }
      setDonnees(aParam) {
        _construireFiltresListe.call(this, aParam);
        super.setDonnees(aParam);
      }
      forcerDeploiementSurElementSelectionne() {
        const lElements = this.listeRessources.getListeElements(
          (aElem) => aElem.selectionne,
        );
        lElements.parcourir((aElement) => {
          const lIndice =
            this.listeRessources.getIndiceExisteParElement(aElement);
          if (MethodesObjet.isNumeric(lIndice)) {
            if (aElement.pere && aElement.pere.estUnDeploiement) {
              aElement.pere.estDeploye = true;
            }
            this.getInstance(this.identListe).actualiser();
            this.getInstance(this.identListe).selectionnerLigne({
              ligne: lIndice,
              avecEvenementModificationSelection: false,
              avecScroll: true,
            });
          }
        });
      }
      _evenementSurListe(aParametres) {
        switch (aParametres.genreEvenement) {
          case EGenreEvenementListe.Selection: {
            if (aParametres.article.estUnDeploiement) {
              return;
            }
            const lRessource = this.listeRessources.getElementParNumero(
              aParametres.article.getNumero(),
            );
            if (lRessource && !lRessource.estUnDeploiement) {
              this.listeRessourcesSelectionnees.vider();
              this.listeRessourcesSelectionnees.add(lRessource);
              this.validationAuto();
            }
            break;
          }
          default:
            super._evenementSurListe(aParametres);
        }
      }
      validationAuto() {
        this.fermer();
        this.callback.appel(
          this.genreRessource,
          this.listeRessourcesSelectionnees,
          this.indexBtnValider,
          this.listeRessourcesSelectionneesAvecInfoEleve,
        );
      }
      _construireListeRessourceAvecCumulPresentielEleve(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lEstDeployeParDefaut = this._options.estDeploye || false;
        this.listeRessources = new ObjetListeElements();
        let lCumulPresent;
        let lCumulAbsent;
        aListeRessources.parcourir((aEleve) => {
          const lEleve = MethodesObjet.dupliquer(aEleve);
          this.listeRessources.add(lEleve);
          if (!!aListeRessourcesSelectionnees.getElementParElement(lEleve)) {
            lEleve.selectionne = true;
          }
          let lCumul;
          if (lEleve.estAbsent) {
            if (!lCumulAbsent) {
              lCumulAbsent = new ObjetElement({
                Numero: 0,
                estUnDeploiement: true,
                estDeploye: lEstDeployeParDefaut,
                nb: 0,
                cumulAbsent: false,
              });
              this.listeRessources.add(lCumulAbsent);
            }
            lCumul = lCumulAbsent;
          } else {
            if (!lCumulPresent) {
              lCumulPresent = new ObjetElement({
                Numero: 0,
                estUnDeploiement: true,
                estDeploye: lEstDeployeParDefaut,
                nb: 0,
                cumulAbsent: false,
              });
              this.listeRessources.add(lCumulPresent);
            }
            lCumul = lCumulPresent;
          }
          lCumul.nb += 1;
          lEleve.pere = lCumul;
        });
        if (lCumulPresent) {
          lCumulPresent.setLibelle(
            GTraductions.getValeur(
              'Messagerie.Filtre_AbsencePresenceEleve_SansAbsence_S',
              [lCumulPresent.nb],
            ),
          );
          if (!lCumulAbsent) {
            lCumulPresent.estDeploye = true;
          }
        }
        if (lCumulAbsent) {
          lCumulAbsent.setLibelle(
            GTraductions.getValeur(
              'Messagerie.Filtre_AbsencePresenceEleve_AvecAbsence_S',
              [lCumulAbsent.nb],
            ),
          );
          if (!lCumulPresent) {
            lCumulAbsent.estDeploye = true;
          }
        }
        this.listeRessources
          .setTri([
            ObjetTri.initRecursif('pere', [
              ObjetTri.init('cumulAbsent'),
              ObjetTri.init('Position'),
              ObjetTri.init('Libelle'),
            ]),
          ])
          .trier();
      }
      _construireListeRessourceAvecCumulElevesClasse(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lCumulGroupe = new ObjetElement(
          GTraductions.getValeur('Fenetre_SelectionPublic.SansClasse'),
          0,
          0,
        );
        lCumulGroupe.estDeploye = this._options.estDeploye || false;
        lCumulGroupe.estUnDeploiement = true;
        lCumulGroupe.__sansClasse__ = true;
        lCumulGroupe.setActif(true);
        const lCacheRessSelec = new Map();
        aListeRessourcesSelectionnees.parcourir((aElement) => {
          if (aElement && aElement.existe()) {
            let lCle =
              this.getCleHashElementAvecInformationEleveDansResponsable(
                aElement,
              );
            lCacheRessSelec.set(lCle, aElement);
          }
        });
        let lAvecGroupe = false;
        this.listeRessources = new ObjetListeElements();
        const lListeCumulClasse = new ObjetListeElements();
        const lListeCumulEleve = new ObjetListeElements();
        for (let i = 0; i < aListeRessources.count(); i++) {
          const lRessource = MethodesObjet.dupliquer(aListeRessources.get(i));
          if (!lRessource.existeNumero() || !lRessource.eleves) {
            continue;
          }
          for (let i = 0; i < lRessource.eleves.count(); i++) {
            const lEleve = MethodesObjet.dupliquer(lRessource.eleves.get(i));
            let lCumulEleve = lListeCumulEleve.getElementParElement(lEleve);
            if (!lCumulEleve) {
              lCumulEleve = MethodesObjet.dupliquer(lEleve);
              lCumulEleve.estUnDeploiement = true;
              lCumulEleve.estDeploye = this._options.estDeploye || false;
              if (!lRessource.classes || lRessource.classes.count() === 0) {
                lAvecGroupe = true;
                lCumulEleve.pere = lCumulGroupe;
              } else if (lEleve.classe) {
                const lClasse = lEleve.classe;
                let lNiveau = lListeCumulClasse.getElementParNumero(
                  lClasse.getNumero(),
                );
                if (!lNiveau) {
                  const lSansClasse = !lClasse.getLibelle();
                  lNiveau = new ObjetElement(
                    lClasse.getLibelle() ||
                      GTraductions.getValeur(
                        'Fenetre_SelectionPublic.SansClasse',
                      ),
                    lClasse.getNumero(),
                    0,
                  );
                  lNiveau.estUnDeploiement = true;
                  lNiveau.estDeploye = this._options.estDeploye || false;
                  if (lClasse.estClasseMN) {
                    lNiveau.estClasseMN = true;
                  }
                  lNiveau.__sansClasse__ = lSansClasse;
                  lListeCumulClasse.addElement(lNiveau);
                }
                lCumulEleve.pere = lNiveau;
                if (lClasse.estClasseMN && lClasse.classesNiv) {
                  lCumulEleve.classesNiv = lClasse.classesNiv;
                }
              }
              lListeCumulEleve.addElement(lCumulEleve);
            }
            const lCopieRessource = MethodesObjet.dupliquer(lRessource);
            lCopieRessource.pere = lCumulEleve;
            lCopieRessource.estDeploye = this._options.estDeploye || false;
            let lEltSelec = lCacheRessSelec.get(
              this.getCleHashElementAvecInformationEleveDansResponsable(
                lCopieRessource,
              ),
            );
            lCopieRessource.selectionne = !!lEltSelec;
            if (lEltSelec) {
              lCopieRessource.avecReponse = !!lEltSelec.avecReponse;
              lCopieRessource.nonModifiable = !!lEltSelec.nonModifiable;
            }
            this.listeRessources.add(lCopieRessource);
          }
        }
        if (lAvecGroupe) {
          this.listeRessources.addElement(lCumulGroupe);
        }
        for (let i = 0, lNbr = lListeCumulClasse.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumulClasse.get(i));
        }
        for (let i = 0, lNbr = lListeCumulEleve.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumulEleve.get(i));
        }
        this.listeRessources.setTri([
          ObjetTri.initRecursif('pere', [
            ObjetTri.init((D) => {
              return !D.__sansClasse__;
            }),
            ObjetTri.init('Position'),
            ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
      _construireListeRessourceAvecCumulElevesGroupe(
        aListeRessources,
        aListeRessourcesSelectionnees,
      ) {
        const lCumulSansGroupe = new ObjetElement(
          GTraductions.getValeur('Fenetre_SelectionPublic.SansGroupe'),
          0,
          TypeGenreCumulSelectionPublic.groupe,
        );
        lCumulSansGroupe.estDeploye = this._options.estDeploye || false;
        lCumulSansGroupe.estUnDeploiement = true;
        lCumulSansGroupe.__sans__ = true;
        lCumulSansGroupe.setActif(true);
        const lCacheRessSelec = new Map();
        aListeRessourcesSelectionnees.parcourir((aElement) => {
          if (aElement && aElement.existe()) {
            let lCle =
              this.getCleHashElementAvecInformationEleveDansResponsable(
                aElement,
              );
            lCacheRessSelec.set(lCle, aElement);
          }
        });
        const lAjouterRessource = (aParams) => {
          let lCumulEleve = lListeCumulEleve.getElementParFiltre((aElem) => {
            return (
              aElem.getNumero() === aParams.eleve.getNumero() &&
              aElem.pere &&
              aElem.pere === aParams.cumulGroupe
            );
          });
          if (!lCumulEleve) {
            lCumulEleve = MethodesObjet.dupliquer(aParams.eleve);
            lCumulEleve.estUnDeploiement = true;
            lCumulEleve.estDeploye = !!this._options.estDeploye;
            lCumulEleve.pere = aParams.cumulGroupe;
            lListeCumulEleve.addElement(lCumulEleve);
          }
          const lCopieRessource = MethodesObjet.dupliquer(aParams.responsable);
          lCopieRessource.pere = lCumulEleve;
          lCopieRessource.estDeploye = !!this._options.estDeploye;
          let lEltSelec = lCacheRessSelec.get(
            this.getCleHashElementAvecInformationEleveDansResponsable(
              lCopieRessource,
            ),
          );
          lCopieRessource.selectionne = !!lEltSelec;
          this.listeRessources.add(lCopieRessource);
        };
        let lAvecCumulSansGroupe = false;
        this.listeRessources = new ObjetListeElements();
        const lListeCumulGroupe = new ObjetListeElements();
        const lListeCumulEleve = new ObjetListeElements();
        for (let i = 0; i < aListeRessources.count(); i++) {
          const lRessource = MethodesObjet.dupliquer(aListeRessources.get(i));
          if (!lRessource.existeNumero() || !lRessource.eleves) {
            continue;
          }
          for (let i = 0; i < lRessource.eleves.count(); i++) {
            const lEleve = MethodesObjet.dupliquer(lRessource.eleves.get(i));
            if (!lEleve.groupes || lEleve.groupes.count() === 0) {
              lAvecCumulSansGroupe = true;
              lAjouterRessource({
                cumulGroupe: lCumulSansGroupe,
                eleve: lEleve,
                responsable: lRessource,
              });
            } else {
              for (let j = 0, lNbr2 = lEleve.groupes.count(); j < lNbr2; j++) {
                const lGroupe = MethodesObjet.dupliquer(lEleve.groupes.get(j));
                let lCumulGroupe = lListeCumulGroupe.getElementParNumero(
                  lGroupe.getNumero(),
                );
                if (!lCumulGroupe) {
                  const lSansClasse = !lEleve.groupes.getLibelle(j);
                  lCumulGroupe = new ObjetElement(
                    lEleve.groupes.getLibelle(j) ||
                      GTraductions.getValeur(
                        'Fenetre_SelectionPublic.SansGroupe',
                      ),
                    lEleve.groupes.getNumero(j),
                    TypeGenreCumulSelectionPublic.groupe,
                  );
                  lCumulGroupe.estUnDeploiement = true;
                  lCumulGroupe.estDeploye = !!this._options.estDeploye;
                  lCumulGroupe.__sans__ = lSansClasse;
                  lListeCumulGroupe.addElement(lCumulGroupe);
                }
                lAjouterRessource({
                  cumulGroupe: lCumulGroupe,
                  eleve: lEleve,
                  responsable: lRessource,
                });
              }
            }
          }
        }
        if (lAvecCumulSansGroupe) {
          this.listeRessources.addElement(lCumulSansGroupe);
        }
        for (let i = 0, lNbr = lListeCumulGroupe.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumulGroupe.get(i));
        }
        for (let i = 0, lNbr = lListeCumulEleve.count(); i < lNbr; i++) {
          this.listeRessources.addElement(lListeCumulEleve.get(i));
        }
        this.listeRessources.setTri([
          ObjetTri.initRecursif('pere', [
            ObjetTri.init((D) => {
              return !D.__sans__;
            }),
            ObjetTri.init('Position'),
            ObjetTri.init('Libelle'),
          ]),
        ]);
        this.listeRessources.trier();
      }
    }
    function _construireFiltresListe(aParam) {
      const lEvnFiltre = () => {
        this.getInstance(this.identListe)
          .getDonneesListe()
          .paramsListe.actualiserListe();
      };
      if (
        aParam.genreRessource === EGenreRessource.Enseignant &&
        this.avecFiltreSurProfs
      ) {
        const H = [];
        H.push(
          `<fieldset>\n      <legend>${GTraductions.getValeur('Fenetre_SelectionRessource.filtreAfficher')}</legend>`,
        );
        H.push(
          `<div class="m-top-l"><ie-checkbox ie-model="cbPrincipaux">${GApplication.estPrimaire ? GTraductions.getValeur('Fenetre_SelectionRessource.filtreProfReferents') : GTraductions.getValeur('Fenetre_SelectionRessource.filtreProfPrincipaux')}</ie-checkbox></div>`,
        );
        if (!GApplication.estPrimaire) {
          H.push(
            `<div class="m-top-l"><ie-checkbox ie-model="cbTuteurs">${GTraductions.getValeur('Fenetre_SelectionRessource.filtreProfTuteurs')}</ie-checkbox></div>`,
          );
        }
        H.push(`</fieldset>`);
        let lProfsPrincipaux = false;
        let lProfsTuteurs = false;
        const lParamsFiltre = {
          funcFiltreVisible: (aArticle) => {
            const lAvecProfsPrincipaux =
              lProfsPrincipaux && aArticle.estProfPrincipal;
            const lAvecProfsTuteurs = lProfsTuteurs && aArticle.estProfTuteur;
            return (
              lAvecProfsPrincipaux ||
              lAvecProfsTuteurs ||
              (!lProfsPrincipaux && !lProfsTuteurs)
            );
          },
          htmlFiltre: H.join(''),
          filtreControleur: {
            cbPrincipaux: {
              getValue() {
                return lProfsPrincipaux;
              },
              setValue(aValue) {
                lProfsPrincipaux = aValue;
                lEvnFiltre();
              },
            },
            cbTuteurs: {
              getValue() {
                return lProfsTuteurs;
              },
              setValue(aValue) {
                lProfsTuteurs = aValue;
                lEvnFiltre();
              },
            },
          },
          filtreParDefaut: () => {
            return !lProfsPrincipaux && !lProfsTuteurs;
          },
          reinitFiltres: () => {
            lProfsPrincipaux = false;
            lProfsTuteurs = false;
            lEvnFiltre();
          },
        };
        aParam.parametresFiltre = lParamsFiltre;
        return;
      }
      if (
        aParam.genreRessource === EGenreRessource.Eleve &&
        GEtatUtilisateur.getUtilisateur().getGenre() ===
          EGenreRessource.Enseignant &&
        GApplication.droits.get(TypeDroits.communication.toutesClasses)
      ) {
        let lUniquementEnseigne = false;
        const lParamsFiltre = {
          funcFiltreVisible: (aArticle) => {
            return !lUniquementEnseigne || !!aArticle.enseigne;
          },
          htmlFiltre: tag(
            'ie-checkbox',
            { 'ie-model': 'cb' },
            GTraductions.getValeur(
              'Fenetre_SelectionRessource.FiltreUniquementElevesEnseigne',
            ),
          ),
          filtreControleur: {
            cb: {
              getValue() {
                return lUniquementEnseigne;
              },
              setValue(aValue) {
                lUniquementEnseigne = aValue;
                lEvnFiltre();
              },
            },
          },
          filtreParDefaut: () => {
            return !lUniquementEnseigne;
          },
          reinitFiltres: () => {
            lUniquementEnseigne = false;
            lEvnFiltre();
          },
        };
        aParam.parametresFiltre = lParamsFiltre;
      }
      if (
        aParam.genreRessource === EGenreRessource.Responsable &&
        aParam.listeNiveauxResponsabilite &&
        aParam.listeNiveauxResponsabilite.count() > 1
      ) {
        const H = [];
        const llisteNiveauxResponsabilite = aParam.listeNiveauxResponsabilite;
        llisteNiveauxResponsabilite.parcourir(
          (aNiveauResponsabilite, aIndex) => {
            const lClass = [];
            const lEstEspaceParent = [
              EGenreEspace.Parent,
              EGenreEspace.Mobile_Parent,
            ].includes(GEtatUtilisateur.GenreEspace);
            const lEstAutreContacts =
              aNiveauResponsabilite.getGenre() ===
              TypeGenreNiveauResponsabilite.gnrContact;
            if (lEstEspaceParent && lEstAutreContacts) {
              return;
            }
            if (aIndex < llisteNiveauxResponsabilite.count() - 1) {
              lClass.push('p-bottom');
            }
            H.push(
              tag(
                'div',
                { class: lClass },
                tag(
                  'ie-checkbox',
                  {
                    'ie-model': tag.funcAttr('cb', [
                      aNiveauResponsabilite.getGenre(),
                    ]),
                  },
                  aNiveauResponsabilite.getLibelle(),
                ),
              ),
            );
          },
        );
        const lParamsFiltre = {
          funcFiltreVisible: (aArticle) => {
            let lVisible = false;
            if (aArticle.getGenre() !== EGenreRessource.Responsable) {
              return true;
            }
            if (this._options.avecInformationEleveDansListeResponsable) {
              const lEleveDuResponsable =
                aArticle.eleves &&
                aArticle.eleves.getElementParNumero(aArticle.pere.getNumero());
              if (
                lEleveDuResponsable &&
                lEleveDuResponsable.niveauResponsabilite
              ) {
                const lNivResponsablilite =
                  llisteNiveauxResponsabilite.getElementParElement(
                    lEleveDuResponsable.niveauResponsabilite,
                  );
                if (lNivResponsablilite) {
                  lVisible =
                    'actif' in lNivResponsablilite
                      ? lNivResponsablilite.actif
                      : true;
                }
              }
            } else if (aArticle.niveauResponsabilite) {
              llisteNiveauxResponsabilite.parcourir((aNiveauResponsabilite) => {
                if (
                  aNiveauResponsabilite.getGenre() ===
                  aArticle.niveauResponsabilite.getGenre()
                ) {
                  lVisible =
                    aNiveauResponsabilite.actif === undefined
                      ? true
                      : aNiveauResponsabilite.actif;
                  return false;
                }
              });
            }
            return lVisible;
          },
          htmlFiltre: H.join(''),
          filtreControleur: {
            cb: {
              getValue(aGenreNiveauResponsabilite) {
                const lElmNiveauResponsabilite =
                  llisteNiveauxResponsabilite.getElementParGenre(
                    aGenreNiveauResponsabilite,
                  );
                let lActif = false;
                if (lElmNiveauResponsabilite) {
                  if (lElmNiveauResponsabilite.actif === undefined) {
                    lElmNiveauResponsabilite.actif =
                      TypeGenreNiveauResponsabiliteUtil.estFiltreParDefautActif(
                        lElmNiveauResponsabilite.getGenre(),
                      );
                  }
                  lActif = lElmNiveauResponsabilite.actif;
                }
                return lActif;
              },
              setValue(aGenreNiveauResponsabilite, aValue) {
                const lElmNiveauResponsabilite =
                  llisteNiveauxResponsabilite.getElementParGenre(
                    aGenreNiveauResponsabilite,
                  );
                if (lElmNiveauResponsabilite) {
                  lElmNiveauResponsabilite.actif = aValue;
                }
                lEvnFiltre();
              },
            },
          },
          filtreParDefaut: () => {
            let lFilteDef = true;
            llisteNiveauxResponsabilite.parcourir((aNiveauResponsabilite) => {
              if (lFilteDef) {
                if (
                  TypeGenreNiveauResponsabiliteUtil.estFiltreParDefautActif(
                    aNiveauResponsabilite.getGenre(),
                  )
                ) {
                  lFilteDef = aNiveauResponsabilite.actif;
                } else {
                  lFilteDef = !aNiveauResponsabilite.actif;
                }
                if (!lFilteDef) {
                  return false;
                }
              }
            });
            return lFilteDef;
          },
          reinitFiltres: () => {
            llisteNiveauxResponsabilite.parcourir((aNiveauResponsabilite) => {
              aNiveauResponsabilite.actif =
                TypeGenreNiveauResponsabiliteUtil.estFiltreParDefautActif(
                  aNiveauResponsabilite.getGenre(),
                );
            });
            lEvnFiltre();
          },
        };
        aParam.parametresFiltre = lParamsFiltre;
        if (!('avecFiltresVisibles' in aParam)) {
          aParam.avecFiltresVisibles = true;
        }
      }
    }
    module.exports = { ObjetFenetre_SelectionPublic_PN };
  },
  fn: 'objetfenetre_selectionpublic_pn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const {
      TypeGenreCumulSelectionPublic,
    } = require('ObjetFenetre_SelectionPublic.js');
    const { EGenreRessource } = require('Enumere_Ressource.js');
    module.exports.getCumulPourFenetrePublic = function (
      aGenre,
      aChecked,
      aNombre,
    ) {
      switch (aGenre) {
        case EGenreRessource.Eleve:
          return aChecked === true
            ? TypeGenreCumulSelectionPublic.initial
            : TypeGenreCumulSelectionPublic.classe;
        case EGenreRessource.Responsable:
          return aNombre > 200
            ? TypeGenreCumulSelectionPublic.initial
            : TypeGenreCumulSelectionPublic.sans;
        case EGenreRessource.Enseignant:
        case EGenreRessource.Personnel:
        case EGenreRessource.MaitreDeStage:
        case EGenreRessource.InspecteurPedagogique:
          return TypeGenreCumulSelectionPublic.sans;
        default:
          return;
      }
    };
  },
  fn: 'utilitairefenetreselectionpublic.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { ObjetRequeteConsultation } = require('ObjetRequeteJSON.js');
    const { Requetes } = require('CollectionRequetes.js');
    class ObjetRequeteListeDiffusion extends ObjetRequeteConsultation {}
    Requetes.inscrire('ListeDiffusion', ObjetRequeteListeDiffusion);
    module.exports = { ObjetRequeteListeDiffusion };
  },
  fn: 'objetrequetelistediffusion.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_Liste = void 0;
    const Enumere_EvenementListe_1 = require('Enumere_EvenementListe');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetListe_1 = require('ObjetListe');
    const ObjetIdentite_1 = require('ObjetIdentite');
    class ObjetFenetre_Liste extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.modeActivationBtnValider = {
          surModification: 1,
          auMoinsUnEltSelectionne: 2,
          toujoursActifs: 3,
          autre: 4,
        };
        this.valeurFiltre = false;
        this.fermerSurValidation = true;
        this.setOptionsFenetre({
          heightMax_mobile: true,
          modeActivationBtnValider:
            this.modeActivationBtnValider.surModification,
          avecVerificationLigneSelectionne: false,
        });
      }
      construireInstances() {
        this.identListe = this.add(
          ObjetListe_1.ObjetListe,
          this.evenementSurListe,
          this.initialiserListe,
        );
      }
      verifierActivationBtnValider(aBouton) {
        return false;
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          fenetreBtn: {
            getDisabled: function (aBoutonRepeat) {
              if (
                aInstance.optionsFenetre.modeActivationBtnValider ===
                aInstance.modeActivationBtnValider.autre
              ) {
                return !aInstance.verifierActivationBtnValider(aBoutonRepeat);
              }
              if (
                aInstance.optionsFenetre.modeActivationBtnValider ===
                aInstance.modeActivationBtnValider.toujoursActifs
              ) {
                return false;
              }
              if (
                aInstance.optionsFenetre.modeActivationBtnValider ===
                  aInstance.modeActivationBtnValider.auMoinsUnEltSelectionne &&
                aBoutonRepeat.element.index === 1
              ) {
                let lDisabled = true;
                aInstance
                  .getInstance(aInstance.identListe)
                  .getListeArticles()
                  .parcourir((aArticle) => {
                    if (aArticle.cmsActif) {
                      lDisabled = false;
                      return false;
                    }
                  });
                return lDisabled;
              } else {
                return (
                  aInstance.optionsFenetre.listeBoutonsInactifs[
                    aBoutonRepeat.element.index
                  ] === true
                );
              }
            },
          },
          filtre: {
            visible: function () {
              return aInstance.paramsListe
                ? !!aInstance.paramsListe.callbckFiltre
                : false;
            },
            check: {
              getValue: function () {
                return aInstance.valeurFiltre;
              },
              setValue: function (aValue) {
                aInstance._evenementSurCB(aValue);
              },
            },
            label: function () {
              return aInstance.paramsListe && aInstance.paramsListe.labelFiltre
                ? aInstance.paramsListe.labelFiltre
                : '';
            },
          },
        });
      }
      initialiserListe(aInstance) {
        const lOptions = {
          listeCreations:
            this.paramsListe.creations !== null
              ? this.paramsListe.creations
              : undefined,
          avecLigneCreation:
            this.paramsListe.avecLigneCreation !== null
              ? this.paramsListe.avecLigneCreation
              : undefined,
          titreCreation:
            this.paramsListe.titreCreation !== null
              ? this.paramsListe.titreCreation
              : undefined,
        };
        if (Array.isArray(this.paramsListe.tailles)) {
          lOptions.colonnes = [];
          this.paramsListe.tailles.forEach((aVal) => {
            lOptions.colonnes.push({ taille: aVal });
          });
        }
        if (Array.isArray(this.paramsListe.titres)) {
          this.paramsListe.titres.forEach((aVal, aIndex) => {
            if (lOptions.colonnes[aIndex]) {
              lOptions.colonnes[aIndex].titre = aVal;
            }
          });
        }
        if (Array.isArray(this.paramsListe.hintTitres)) {
          this.paramsListe.hintTitres.forEach((aVal, aIndex) => {
            if (lOptions.colonnes[aIndex]) {
              lOptions.colonnes[aIndex].hint = aVal;
            }
          });
        }
        aInstance.setOptionsListe(lOptions);
        if (this.paramsListe.colonnesCachees) {
          aInstance.setOptionsListe({
            colonnesCachees: this.paramsListe.colonnesCachees,
          });
        }
        if (this.paramsListe.editable !== undefined) {
          aInstance.setOptionsListe({
            nonEditable: !this.paramsListe.editable,
          });
        }
        if (this.paramsListe.optionsListe) {
          aInstance.setOptionsListe(this.paramsListe.optionsListe);
        }
      }
      setDonnees(
        aObjetDonneesListe,
        aAvecValidation,
        aLigneSelectionnee,
        aParamsSetDonneesListe,
      ) {
        this.afficher();
        this.avecValidation = aAvecValidation;
        this.setBoutonActif(1, false);
        if (this.avecValidation) {
          this.setBoutonVisible(1, false);
        }
        this.getInstance(this.identListe).setDonnees(
          aObjetDonneesListe,
          aLigneSelectionnee,
          aParamsSetDonneesListe,
        );
        if (
          !!this.paramsListe &&
          this.paramsListe.optionsListe &&
          this.paramsListe.optionsListe.hauteurAdapteContenu
        ) {
          this.positionnerFenetre();
        }
      }
      actualiserListe(aConserverSelection, aActivationBouton) {
        this.getInstance(this.identListe).actualiser(aConserverSelection);
        if (aActivationBouton) {
          this.setBoutonActif(1, aActivationBouton);
        }
      }
      annulerCreation() {
        this.getInstance(this.identListe).annulerCreation();
      }
      composeContenu() {
        const T = [];
        T.push(`<div class="flex-contain cols full-size flex-gap-l">`);
        T.push(
          `  <div class="fix-bloc m-left-s" ie-display="filtre.visible"><ie-checkbox ie-model="filtre.check" ie-html="filtre.label"></ie-checkbox></div>`,
        );
        T.push(
          `  <div class="fluid-bloc" id="${this.getNomInstance(this.identListe)}"></div>`,
        );
        T.push(`</div>`);
        return T.join('');
      }
      evenementSurListe(aParametres) {
        switch (aParametres.genreEvenement) {
          case Enumere_EvenementListe_1.EGenreEvenementListe.Selection:
          case Enumere_EvenementListe_1.EGenreEvenementListe.SelectionClick:
            if (
              this.optionsFenetre.modeActivationBtnValider !==
              this.modeActivationBtnValider.autre
            ) {
              this.setBoutonActif(
                1,
                aParametres.ligne !== -1 ||
                  !this.optionsFenetre.avecVerificationLigneSelectionne,
              );
            }
            if (this.avecValidation) {
              this.surValidation(1);
            }
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe.SelectionDblClick:
            this.surValidation(1);
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe.Suppression:
            if (
              this.optionsFenetre.modeActivationBtnValider !==
              this.modeActivationBtnValider.autre
            ) {
              this.setBoutonActif(1, false);
            }
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe.Creation:
            if (this.paramsListe.avecLigneCreation) {
              if (this.paramsListe.callbckCreation) {
                this.changementListe = true;
                return this.paramsListe.callbckCreation(
                  aParametres.colonne,
                  aParametres.ligne,
                );
              }
            }
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe.ApresCreation:
            if (
              this.optionsFenetre.modeActivationBtnValider !==
              this.modeActivationBtnValider.autre
            ) {
              this.setBoutonActif(1, true);
            }
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition:
            this.setBoutonActif(1, true);
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe.Edition:
            if (this.paramsListe.callbckEdition) {
              this.changementListe = true;
              return this.paramsListe.callbckEdition(aParametres);
            }
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe
            .ModificationCBLigne:
            this.setBoutonActif(1, true);
            break;
          case Enumere_EvenementListe_1.EGenreEvenementListe.ApresSuppression:
            this.setBoutonActif(1, true);
            break;
        }
        if (
          [
            Enumere_EvenementListe_1.EGenreEvenementListe.Creation,
            Enumere_EvenementListe_1.EGenreEvenementListe.Edition,
            Enumere_EvenementListe_1.EGenreEvenementListe.ApresEdition,
            Enumere_EvenementListe_1.EGenreEvenementListe.Suppression,
            Enumere_EvenementListe_1.EGenreEvenementListe.ApresSuppression,
            Enumere_EvenementListe_1.EGenreEvenementListe.ModificationCBLigne,
          ].includes(aParametres.genreEvenement)
        ) {
          this.changementListe = true;
        }
      }
      surValidation(aNumeroBouton) {
        const lMaSelection = this.getInstance(this.identListe).getSelection();
        if (this.fermerSurValidation) {
          this.fermer();
        }
        if (this.optionsFenetre.callback) {
          this.optionsFenetre.callback(
            aNumeroBouton,
            lMaSelection,
            this.changementListe,
          );
        }
        this.callback.appel(aNumeroBouton, lMaSelection, this.changementListe);
        if (
          this.Pere &&
          this.Pere instanceof ObjetIdentite_1.Identite &&
          this.Pere.$refreshSelf
        ) {
          this.Pere.$refreshSelf();
        }
      }
      _evenementSurCB(aValue) {
        this.valeurFiltre = !!aValue;
        if (this.paramsListe.callbckFiltre) {
          this.paramsListe.callbckFiltre(this.valeurFiltre, this);
        }
      }
      setFermerSurValidation(aFermer) {
        this.fermerSurValidation = aFermer;
      }
      setListeElementsSelection(aListeElements) {
        this.getInstance(this.identListe).setListeElementsSelection(
          aListeElements,
        );
      }
    }
    exports.ObjetFenetre_Liste = ObjetFenetre_Liste;
  },
  fn: 'objetfenetre_liste.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { GChaine } = require('ObjetChaine.js');
    const { ObjetFenetre_Liste } = require('ObjetFenetre_Liste.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const { ObjetListe } = require('ObjetListe.js');
    class ObjetFenetre_SelectionListeDiffusion extends ObjetFenetre_Liste {
      constructor(...aParams) {
        super(...aParams);
        this.uniquementMesListes =
          GApplication.parametresUtilisateur.get(
            'listeDiffusion.uniquementMesListes',
          ) || false;
        this.setOptionsFenetre({
          modale: true,
          titre: GTraductions.getValeur('listeDiffusion.titre'),
          largeur: 300,
          hauteur: 470,
          listeBoutons: [
            GTraductions.getValeur('Annuler'),
            GTraductions.getValeur('Valider'),
          ],
        });
      }
      initialiserListe(aInstance) {
        aInstance.setOptionsListe({ skin: ObjetListe.skin.flatDesign });
      }
      getControleur() {
        return $.extend(true, super.getControleur(this), {
          cbLesMiens: {
            getValue: function () {
              return GApplication.parametresUtilisateur.get(
                'listeDiffusion.uniquementMesListes',
              );
            },
            setValue: function (aValue) {
              _evenementSurCB.call(this.instance, aValue);
            },
          },
        });
      }
      composeContenu() {
        const T = [];
        T.push('<div class="flex-contain cols full-size">');
        T.push(
          '<div class="fix-bloc p-all-l">',
          '<ie-checkbox ie-model="cbLesMiens">',
          GChaine.insecable(GTraductions.getValeur('listeDiffusion.lesMiens')),
          '</ie-checkbox>',
          '</div>',
        );
        T.push(
          '<div class="fluid-bloc" id="' +
            this.getNomInstance(this.identListe) +
            '">',
          '</div>',
        );
        T.push('</div>');
        return T.join('');
      }
    }
    function _evenementSurCB(aValue) {
      this.uniquementMesListes = !!aValue;
      GApplication.parametresUtilisateur.set(
        'listeDiffusion.uniquementMesListes',
        this.uniquementMesListes,
      );
      if (
        this.getInstance(this.identListe) &&
        this.getInstance(this.identListe).getDonneesListe()
      ) {
        this.getInstance(this.identListe)
          .getDonneesListe()
          .setUniquementMesListes(this.uniquementMesListes);
        this.getInstance(this.identListe).actualiser(true, false);
      }
    }
    module.exports = { ObjetFenetre_SelectionListeDiffusion };
  },
  fn: 'objetfenetre_selectionlistediffusion.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const {
      ObjetDonneesListeFlatDesign,
    } = require('ObjetDonneesListeFlatDesign.js');
    class DonneesListe_SelectionDiffusion extends ObjetDonneesListeFlatDesign {
      constructor(aDonnees) {
        super(aDonnees);
        this.uniquementMesListes =
          GApplication.parametresUtilisateur.get(
            'listeDiffusion.uniquementMesListes',
          ) || false;
        this.setOptions({
          avecCB: true,
          avecCocheCBSurLigne: true,
          avecBoutonActionLigne: false,
          avecEvnt_Selection: true,
        });
      }
      setUniquementMesListes(aUniquementMesListes) {
        this.uniquementMesListes = aUniquementMesListes;
      }
      getVisible(D) {
        return !this.uniquementMesListes || D.estAuteur;
      }
      getValueCB(aParams) {
        return aParams.article ? !!aParams.article.cmsActif : false;
      }
      setValueCB(aParams, aValue) {
        aParams.article.cmsActif = aValue;
      }
    }
    module.exports = { DonneesListe_SelectionDiffusion };
  },
  fn: 'donneesliste_selectiondiffusion.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireMessagerie = UtilitaireMessagerie;
    require('UtilitaireMessagerie.css');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetStyle_1 = require('ObjetStyle');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const ObjetTri_1 = require('ObjetTri');
    const TypeGenreDiscussion_1 = require('TypeGenreDiscussion');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const TypeOrigineCreationEtiquetteMessage_1 = require('TypeOrigineCreationEtiquetteMessage');
    const ObjetDroitsPN_1 = require('ObjetDroitsPN');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const Enumere_Action_1 = require('Enumere_Action');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const TypeHttpReponseMessage_1 = require('TypeHttpReponseMessage');
    const ObjetSupport_1 = require('ObjetSupport');
    const TypeStatutConnexion_1 = require('TypeStatutConnexion');
    const tag_1 = require('tag');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const UtilitaireUrl_1 = require('UtilitaireUrl');
    const ObjetRequeteListePublics_1 = require('ObjetRequeteListePublics');
    const ObjetRequeteListeRessourcesPourCommunication_1 = require('ObjetRequeteListeRessourcesPourCommunication');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetFenetre_SelectionPublic_1 = require('ObjetFenetre_SelectionPublic');
    const ObjetFenetre_SelectionPublic_PN_1 = require('ObjetFenetre_SelectionPublic_PN');
    const UtilitaireFenetreSelectionPublic_1 = require('UtilitaireFenetreSelectionPublic');
    const Cache_1 = require('Cache');
    const ObjetRequeteListeDiffusion_1 = require('ObjetRequeteListeDiffusion');
    const ObjetFenetre_SelectionListeDiffusion_1 = require('ObjetFenetre_SelectionListeDiffusion');
    const DonneesListe_SelectionDiffusion_1 = require('DonneesListe_SelectionDiffusion');
    const MethodesObjet_1 = require('MethodesObjet');
    const GUID_1 = require('GUID');
    const jsx_1 = require('jsx');
    const C_TailleObjetMessage = 200;
    function UtilitaireMessagerie() {}
    UtilitaireMessagerie.palierNbMessages = 20;
    UtilitaireMessagerie.C_TailleObjetMessage = C_TailleObjetMessage;
    UtilitaireMessagerie.getDiscussion = function (aParam) {
      const H = [];
      let J;
      const lParams = Object.assign(
        {
          listeMessages: null,
          controleur: null,
          pere: null,
          callbackCommandesMessage: null,
          callbackBtnSignalantPourSupp: null,
          callbackAfficherSuivants: null,
        },
        aParam,
      );
      const lGUIDSyntheseVocale = GUID_1.GUID.getId();
      const lControleur = {};
      let lAvecCommandes = false;
      if (
        lParams.callbackCommandesMessage &&
        lParams.controleur &&
        !GApplication.droits.get(
          ObjetDroitsPN_1.TypeDroits.communication.discussionInterdit,
        )
      ) {
        lAvecCommandes = true;
        Object.assign(lControleur, {
          lireTexte: function (aIndice) {
            const lResult = [];
            const lMessage = lParams.listeMessages.get(aIndice);
            const lNextIndice = aIndice > 0 ? aIndice - 1 : undefined;
            if (lMessage.estUnAparte) {
              lResult.push(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.HintSousDiscussion',
                ),
              );
            }
            const lChaine =
              UtilitaireMessagerie.getLibelleParticipantsSyntheseVocale(
                lParams.pere,
                lMessage,
                this.node,
              );
            lResult.push(lChaine);
            if (lMessage.messageSignale) {
              lResult.push(lMessage.messageSignale + '. ');
            }
            if (lMessage.contenu) {
              let lContenu;
              if (lMessage.estHTML) {
                const lJNode = $(lMessage.contenu);
                lContenu = lJNode.text() || lJNode.val();
              } else {
                lContenu = lMessage.contenu.enleverEntites();
              }
              lResult.push(lContenu + '. ');
            }
            if (
              lMessage.listeDocumentsJoints &&
              lMessage.listeDocumentsJoints.count() > 0
            ) {
              lResult.push(
                lMessage.listeDocumentsJoints.getTableauLibelles().length > 1
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.DocumentsJoints',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.DocumentJoint',
                    ),
                ' : ',
                lMessage.listeDocumentsJoints.getTableauLibelles().join(', '),
              );
            }
            if (lMessage.listeMessagesPourContexte) {
              const lNbMessagsContexte =
                lMessage.listeMessagesPourContexte.count();
              for (J = lNbMessagsContexte - 1; J >= 0; J--) {
                const lMessagePourContexte =
                  lMessage.listeMessagesPourContexte.get(J);
                let lArrDocs = [];
                if (
                  lMessagePourContexte.listeDocumentsJoints &&
                  lMessagePourContexte.listeDocumentsJoints.count() > 0
                ) {
                  lArrDocs = lArrDocs.concat(
                    lMessagePourContexte.listeDocumentsJoints.getTableauLibelles(),
                  );
                }
                if (lArrDocs.length > 0) {
                  lResult.push(
                    lArrDocs.length > 1
                      ? ObjetTraduction_1.GTraductions.getValeur(
                          'Messagerie.DocumentsJoints',
                        )
                      : ObjetTraduction_1.GTraductions.getValeur(
                          'Messagerie.DocumentJoint',
                        ),
                    ' : ',
                    lArrDocs.join(', '),
                  );
                }
              }
            }
            const lID = lGUIDSyntheseVocale + aIndice.toString();
            const lObj = { text: lResult.join(' '), idCourant: lID };
            if (lNextIndice !== undefined) {
              lObj.idSuivant = lGUIDSyntheseVocale + lNextIndice.toString();
            }
            return lObj;
          },
          nodeCommande: function (aIndice) {
            $(this.node).on('contextmenu', function (aEvent) {
              const lNodeCopie = $(this).find('.visu_contenu').get(0);
              lParams.callbackCommandesMessage({
                indice: aIndice,
                messageVisu: lParams.listeMessages.get(aIndice),
                event: aEvent,
                elementCibleCopie: lNodeCopie,
                surMenuContextuel: true,
              });
            });
          },
          btnCommande: {
            event: function (aIndice, aEvent) {
              const lNodeCopie = $(this.node)
                .closest('li.message')
                .find('.visu_contenu')
                .get(0);
              lParams.callbackCommandesMessage({
                node: this.node,
                indice: aIndice,
                messageVisu: lParams.listeMessages.get(aIndice),
                event: aEvent,
                elementCibleCopie: lNodeCopie,
              });
            },
          },
        });
      }
      if (lParams.callbackBtnSignalantPourSupp && lParams.controleur) {
        Object.assign(lControleur, {
          btnSignalantSupp: {
            event: function (aIndice) {
              const lMessageVisu = lParams.listeMessages.get(aIndice);
              if (lMessageVisu && lMessageVisu.messConfirmSupp) {
                GApplication.getMessage()
                  .afficher({
                    type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                      .Confirmation,
                    message: lMessageVisu.messConfirmSupp,
                  })
                  .then((aGenreAction) => {
                    if (
                      aGenreAction === Enumere_Action_1.EGenreAction.Valider
                    ) {
                      lParams.callbackBtnSignalantPourSupp({
                        commande: 'supprimerMessageGraphe',
                        message: lMessageVisu,
                      });
                    }
                  });
              }
            },
            getDisabled: function () {
              return GApplication.droits.get(
                ObjetDroitsPN_1.TypeDroits.estEnConsultation,
              );
            },
          },
        });
      }
      if (lParams.callbackAfficherSuivants) {
        Object.assign(lControleur, {
          onview: function (aNbMessages, aVisible) {
            if (aVisible) {
              lParams.callbackAfficherSuivants(aNbMessages);
              return false;
            }
          },
          lienAfficherSuivants: function (aNbMessages) {
            $(this.node).eventValidation(() => {
              lParams.callbackAfficherSuivants(aNbMessages);
            });
          },
        });
      }
      if (lParams.controleur) {
        lParams.controleur.__visuMessage__ = lControleur;
      }
      const lNbMessages = aParam.listeMessages.count();
      if (
        lParams.callbackAfficherSuivants &&
        aParam.nbMessagesTotal > 0 &&
        lNbMessages < aParam.nbMessagesTotal
      ) {
        H.push(
          '<div style="padding-top:5px;"',
          ObjetHtml_1.GHtml.composeAttr(
            'ie-visibility-observer',
            '__visuMessage__.onview',
            [lNbMessages + UtilitaireMessagerie.palierNbMessages],
          ),
          '>',
        );
        if (
          lNbMessages + UtilitaireMessagerie.palierNbMessages <
          aParam.nbMessagesTotal
        ) {
          H.push(
            '<div style="padding-top:5px; text-align:center;">',
            '<a tabindex="-1"',
            ObjetHtml_1.GHtml.composeAttr(
              'ie-node',
              '__visuMessage__.lienAfficherSuivants',
              [lNbMessages + UtilitaireMessagerie.palierNbMessages],
            ),
            ' class="LienAccueil AvecMain">',
            ObjetChaine_1.GChaine.format(
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.AfficherMessagesSuivants_D',
              ),
              [
                Math.min(
                  UtilitaireMessagerie.palierNbMessages,
                  aParam.nbMessagesTotal - lNbMessages,
                ),
              ],
            ),
            '</a>',
            '</div>',
          );
        }
        H.push('</div>');
      }
      H.push(
        (0, tag_1.tag)('ul', { class: 'utilMess_visu_messages' }, (H) => {
          for (let I = lNbMessages - 1; I >= 0; I--) {
            const lMessage = aParam.listeMessages.get(I);
            H.push(
              (0, tag_1.tag)(
                'li',
                {
                  class: [
                    'AvecSelectionTexte',
                    'message',
                    lMessage.brouillon ? 'brouillon' : '',
                    lMessage.emetteur ? 'emetteur' : '',
                    lMessage.estUnAparte ? 'aparte' : '',
                  ],
                  tabindex: 0,
                  'ie-synthesevocale': tag_1.tag.funcAttr(
                    '__visuMessage__.lireTexte',
                    I,
                  ),
                  'ie-node': lAvecCommandes
                    ? tag_1.tag.funcAttr('__visuMessage__.nodeCommande', I)
                    : '',
                },
                (H) => {
                  if (lMessage.estUnAparte) {
                    H.push(
                      (0, tag_1.tag)('i', {
                        class: 'aparte icon_sous_discussion',
                        title: ObjetTraduction_1.GTraductions.getValeur(
                          'Messagerie.HintSousDiscussion',
                        ),
                      }),
                    );
                  }
                  H.push(
                    (0, tag_1.tag)(
                      'div',
                      { class: 'message_titre' },
                      UtilitaireMessagerie.getLibelleParticipants(
                        lMessage,
                        false,
                        aParam.btnModel,
                      ),
                      (0, tag_1.tag)(
                        'div',
                        { class: 'message_titre_droite' },
                        lMessage.libelleDate,
                        (0, tag_1.tag)(
                          'div',
                          UtilitaireMessagerie.dessinListeEtiquettes(
                            lMessage.listeEtiquettes,
                            true,
                          ),
                        ),
                      ),
                      lAvecCommandes
                        ? (0, tag_1.tag)('ie-btnicon', {
                            'ie-model': tag_1.tag.funcAttr(
                              '__visuMessage__.btnCommande',
                              I,
                            ),
                            class: 'icon_ellipsis_vertical noSpeechSynthes',
                            title:
                              ObjetTraduction_1.GTraductions.getValeur(
                                'liste.BtnAction',
                              ),
                          })
                        : '',
                    ),
                  );
                  H.push(
                    (0, tag_1.tag)(
                      'div',
                      {
                        class: [
                          'visu_contenu',
                          lMessage.estHTML ? 'tiny-view' : '',
                        ],
                      },
                      lMessage.messageSignale
                        ? IE.jsx.str(
                            'div',
                            { class: 'visu_signale' },
                            lMessage.messageSignale,
                          )
                        : '',
                      lMessage.estHTML
                        ? lMessage.contenu
                        : ObjetChaine_1.GChaine.replaceRCToHTML(
                            lMessage.contenu,
                          ),
                      lMessage.estSignalantPourSuppr &&
                        lParams.callbackBtnSignalantPourSupp &&
                        lParams.controleur
                        ? (0, tag_1.tag)(
                            'ie-bouton',
                            {
                              'ie-model': tag_1.tag.funcAttr(
                                '__visuMessage__.btnSignalantSupp',
                                I,
                              ),
                              class: Type_ThemeBouton_1.TypeThemeBouton.neutre,
                            },
                            ObjetTraduction_1.GTraductions.getValeur(
                              'Messagerie.BoutonSupprimerGraphe',
                            ),
                          )
                        : '',
                    ),
                  );
                  if (
                    lMessage.listeDocumentsJoints &&
                    lMessage.listeDocumentsJoints.count() > 0
                  ) {
                    H.push(_construirePJs(lMessage));
                  }
                  if (lMessage.listeMessagesPourContexte) {
                    const lNbMessagsContexte =
                      lMessage.listeMessagesPourContexte.count();
                    H.push((0, tag_1.tag)('hr'));
                    for (J = lNbMessagsContexte - 1; J >= 0; J--) {
                      const lMessagePourContexte =
                        lMessage.listeMessagesPourContexte.get(J);
                      H.push(
                        (0, tag_1.tag)(
                          'div',
                          { class: 'visu_transfert' },
                          (H) => {
                            H.push(
                              UtilitaireMessagerie.getLibelleParticipants(
                                lMessagePourContexte,
                                true,
                                aParam.btnModel,
                              ),
                            );
                            const lClass =
                              lMessage.estMessageTransferant ||
                              lMessage.estSignalantPourSuppr ||
                              !lMessagePourContexte.emetteur
                                ? 'visu_transfert_indent'
                                : '';
                            H.push(
                              (0, tag_1.tag)(
                                'div',
                                { class: lClass },
                                lMessagePourContexte.contenu,
                              ),
                            );
                            if (
                              lMessagePourContexte.listeDocumentsJoints &&
                              lMessagePourContexte.listeDocumentsJoints.count() >
                                0
                            ) {
                              H.push(
                                (0, tag_1.tag)(
                                  'div',
                                  { class: lClass },
                                  _construirePJs(lMessagePourContexte),
                                ),
                              );
                            }
                            if (J > 0) {
                              H.push((0, tag_1.tag)('hr'));
                            }
                          },
                        ),
                      );
                    }
                  }
                  let lLibelleSupplementaireDuMessage = null;
                  if (!!lMessage.estCarnetLiaison && !!lMessage.avecDirecteur) {
                    lLibelleSupplementaireDuMessage =
                      '<span class="Image_CocheVerte as-icon InlineBlock AlignementHaut"></span><span class="PetitEspaceGauche">' +
                      ObjetTraduction_1.GTraductions.getValeur(
                        'MessagerieCarnetLiaison.DirecteurAjoute',
                      ) +
                      '</span>';
                  }
                  if (!!lLibelleSupplementaireDuMessage) {
                    const lStyles = [
                      'position: absolute;',
                      'right: 5px;',
                      'bottom: 0;',
                      'background-color: #FFF;',
                      'border: solid 1px #E4E4E4;',
                      'border-radius: 1em;',
                      'padding: 0 5px;',
                      'transform: translateY(50%);',
                      'height: 1.5em;',
                      'line-height: 1.5em;',
                    ];
                    H.push(
                      '<div style="',
                      lStyles.join(''),
                      '">',
                      lLibelleSupplementaireDuMessage,
                      '</div>',
                    );
                  }
                },
              ),
            );
          }
        }),
      );
      return H.join('');
    };
    UtilitaireMessagerie.estMessageNonEditable = function (aMessage) {
      return (
        !aMessage ||
        aMessage.ferme ||
        aMessage.estSorti ||
        aMessage.estSignalantContenu ||
        aMessage.estSignalantPourSuppr ||
        (!aMessage.estUneDiscussion &&
          aMessage.pere &&
          UtilitaireMessagerie.estMessageNonEditable(
            UtilitaireMessagerie.getDiscussionRacine(aMessage),
          ))
      );
    };
    function _construirePJs(aMessage) {
      return UtilitaireUrl_1.UtilitaireUrl.construireListeUrls(
        aMessage.listeDocumentsJoints,
      );
    }
    UtilitaireMessagerie.getLibelleObjetDiscussion = function (aDiscussion) {
      const H = [];
      if (aDiscussion !== null && aDiscussion !== undefined) {
        H.push(
          (aDiscussion.profondeur ? '' : aDiscussion.objet + '&nbsp;') +
            '(' +
            aDiscussion.nombreMessages +
            ')',
        );
      }
      return H.join('');
    };
    UtilitaireMessagerie.getTitreFenetreDeMessage = function (aMessage) {
      if (aMessage && aMessage.objet) {
        let lStrPublic = '';
        if (aMessage.nbPublic > 1) {
          lStrPublic = ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.NParticipants',
            [aMessage.nbPublic],
          );
        } else if (aMessage.public) {
          lStrPublic = aMessage.public;
        }
        return aMessage.objet + (lStrPublic ? ` - ${lStrPublic}` : '');
      }
      return '';
    };
    UtilitaireMessagerie.getLibelleDiscussionAccessible = function (
      aDiscussion,
    ) {
      const H = [];
      if (aDiscussion) {
        H.push(UtilitaireMessagerie.getLibelleObjetDiscussion(aDiscussion));
        H.push('&nbsp;-&nbsp;' + aDiscussion.libelleDate);
      }
      return H.join('');
    };
    UtilitaireMessagerie.getDetailDiscussionAccessible = function (
      aDiscussion,
    ) {
      const H = [];
      if (aDiscussion) {
        if (aDiscussion.public) {
          H.push('<div>', aDiscussion.public, '</div>');
        } else {
        }
        if (aDiscussion.documentsJoints) {
          H.push('<div>', aDiscussion.documentsJoints, '</div>');
        }
      }
      return H.join('');
    };
    UtilitaireMessagerie.getLibelleParticipants = function (
      aMessage,
      aPourVisuTransfert = false,
      aBtnModel,
    ) {
      const H = [];
      if (aMessage.estMessageTransferant) {
        H.push(
          '<div>',
          aMessage.nbTransfert > 1
            ? ObjetChaine_1.GChaine.format(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.NMessagestransferes',
                ),
                [aMessage.nbTransfert],
              )
            : ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.1Messagetransfere',
              ),
          '</div>',
        );
      } else {
        H.push(
          '<div class="utilMessParticipants',
          aPourVisuTransfert ? ' transfert' : '',
          '">',
        );
        if (aMessage.brouillon) {
          H.push(
            '<div style="',
            ObjetStyle_1.GStyle.composeCouleurTexte('red'),
            '">[',
            ObjetTraduction_1.GTraductions.getValeur('Messagerie.Brouillon'),
            ']</div>',
          );
          if (aPourVisuTransfert) {
            H.push('<div>&nbsp;' + aMessage.libelleDate + '</div>');
          }
        } else {
          if (aMessage.estCarnetLiaison) {
            H.push(
              '<div ie-ellipsis style="max-width:250px;">',
              aMessage.public_gauche,
              '</div>',
            );
          } else {
            const lAvecBtn = aBtnModel && aMessage.nbPublic > 1;
            H.push(
              aMessage.public_gauche
                ? '<span class="participants_public" ' +
                    (aMessage.hint_gauche && !IE.estMobile
                      ? ObjetHtml_1.GHtml.composeAttr(
                          'ie-hint',
                          ObjetChaine_1.GChaine.replaceRCToHTML(
                            aMessage.hint_gauche,
                          ),
                        )
                      : '') +
                    ' ie-ellipsis >' +
                    aMessage.public_gauche +
                    '</span>'
                : IE.jsx.str('ie-btnicon', {
                    class: 'icon_intervenants message-btn-dest',
                    'ie-model': lAvecBtn
                      ? (0, jsx_1.jsxFuncAttr)(aBtnModel, [
                          aMessage.getNumero(),
                          true,
                        ])
                      : false,
                    'aria-haspopup': lAvecBtn ? 'dialog' : false,
                    'aria-label': lAvecBtn
                      ? ObjetTraduction_1.GTraductions.getValeur(
                          'Messagerie.WAI_AfficherPart',
                        )
                      : false,
                    'ie-hint':
                      !IE.estMobile && lAvecBtn
                        ? (0, jsx_1.jsxFuncAttr)(aBtnModel + '.hintPublic', [
                            aMessage.getNumero(),
                            true,
                          ])
                        : false,
                  }),
            );
            H.push(
              IE.jsx.str(
                'i',
                {
                  class: ['icone', 'icon_fleche_droite'],
                  'aria-label': ObjetTraduction_1.GTraductions.getValeur('A'),
                  role: 'img',
                },
                ' ',
              ),
            );
            if (aMessage.public_droite) {
              H.push(
                '<span class="participants_public"' +
                  (aMessage.hint_droite && !IE.estMobile
                    ? ObjetHtml_1.GHtml.composeAttr(
                        'ie-hint',
                        ObjetChaine_1.GChaine.replaceRCToHTML(
                          aMessage.hint_droite,
                        ),
                      )
                    : '') +
                  ' ie-ellipsis >' +
                  aMessage.public_droite +
                  ' </span>',
              );
            } else {
              if (!aMessage.brouillon && aMessage.nbPublic > 1) {
                H.push(
                  IE.jsx.str('ie-btnicon', {
                    class: 'icon_intervenants message-btn-dest',
                    'aria-label': ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.WAI_AfficherDest',
                    ),
                    'ie-model': lAvecBtn
                      ? (0, jsx_1.jsxFuncAttr)(aBtnModel, [
                          aMessage.getNumero(),
                          false,
                        ])
                      : false,
                    'aria-haspopup': lAvecBtn ? 'dialog' : false,
                    'ie-hint':
                      !IE.estMobile && lAvecBtn
                        ? (0, jsx_1.jsxFuncAttr)(aBtnModel + '.hintPublic', [
                            aMessage.getNumero(),
                            false,
                          ])
                        : false,
                  }),
                );
              }
            }
          }
          if (aPourVisuTransfert) {
            H.push(
              '<div class="regular m-left-l">' +
                aMessage.libelleDate +
                '</div>',
            );
          }
        }
        if (aPourVisuTransfert) {
          H.push(
            UtilitaireMessagerie.dessinListeEtiquettes(
              aMessage.listeEtiquettes,
              true,
            ),
          );
        }
        H.push('</div>');
      }
      return H.join('');
    };
    UtilitaireMessagerie.getLibelleParticipantsSyntheseVocale = function (
      aInstance,
      aMessage,
      aNode,
    ) {
      const H = [];
      if (aMessage.estMessageTransferant) {
        H.push(
          aMessage.nbTransfert > 1
            ? ObjetChaine_1.GChaine.format(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.NMessagestransferes',
                ),
                [aMessage.nbTransfert],
              )
            : ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.1Messagetransfere',
              ),
        );
      } else {
        if (aMessage.brouillon) {
          H.push(
            ObjetTraduction_1.GTraductions.getValeur('Messagerie.Brouillon') +
              '. ',
          );
          H.push(aMessage.libelleDate + '. ');
        } else {
          if (aMessage.estCarnetLiaison) {
            H.push(aMessage.public_gauche + '. ');
          } else {
            if (aMessage.public_gauche) {
              H.push(aMessage.public_gauche);
            } else {
              const lPublicG =
                UtilitaireMessagerie.getStrHintPublicMessagePromise(
                  aInstance,
                  aMessage.getNumero(),
                  true,
                  false,
                  aNode,
                );
              H.push(lPublicG);
            }
            H.push(ObjetTraduction_1.GTraductions.getValeur('A'));
            if (aMessage.public_droite) {
              H.push(aMessage.public_droite + '. ');
            } else {
              if (!aMessage.brouillon && aMessage.nbPublic > 1) {
                const lPublicD = ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.NDestinataires',
                  [aMessage.nbPublic],
                );
                H.push(lPublicD + '. ');
              }
            }
          }
          H.push(aMessage.libelleDate + '. ');
        }
      }
      return H.join(' ');
    };
    async function getListePublicMessagePromise(
      aInstance,
      aNumeroMessage,
      aEstPublicParticipant,
      aEstDestinatairesReponse,
    ) {
      const lParams = {
        message: new ObjetElement_1.ObjetElement('', aNumeroMessage),
        estPublicParticipant: aEstPublicParticipant,
        estDestinatairesReponse: aEstDestinatairesReponse,
      };
      const lReponse = await new ObjetRequeteSaisiePublicMessage(aInstance)
        .setOptions({ avecControleModeExclusif: false, messageDetail: '' })
        .lancerRequete(lParams);
      if (
        lReponse.genreReponse !== ObjetRequeteJSON_1.EGenreReponseSaisie.succes
      ) {
        return;
      }
      let lListeDest = lReponse.JSONReponse.listeDest;
      if (
        !lListeDest &&
        lReponse.JSONRapportSaisie &&
        lReponse.JSONRapportSaisie.listeDest
      ) {
        lListeDest = lReponse.JSONRapportSaisie.listeDest;
        lListeDest.avecConnection = true;
      }
      if (lListeDest) {
        lListeDest
          .setTri([
            ObjetTri_1.ObjetTri.init('Genre'),
            ObjetTri_1.ObjetTri.init('Position'),
          ])
          .trier();
      }
      return lListeDest;
    }
    UtilitaireMessagerie.afficherFenetreDestinatairesDeMessage =
      async function (
        aNumeroMessage,
        aEstPublicParticipant,
        aEstDestinatairesReponse,
      ) {
        const lListeDest = await getListePublicMessagePromise(
          this,
          aNumeroMessage,
          aEstPublicParticipant,
          aEstDestinatairesReponse,
        );
        if (!lListeDest || lListeDest.count() === 0) {
          return;
        }
        const lHtml = IE.jsx.str(
          'ul',
          { class: 'liste-destinataires' },
          (aTab) => {
            lListeDest.parcourir((aDest) => {
              const lLibelleSupp =
                UtilitaireMessagerie.getStrHintDetailDePublic(aDest);
              aTab.push(
                IE.jsx.str(
                  'li',
                  null,
                  lListeDest.avecConnection
                    ? UtilitaireMessagerie.contruirePublicConnecte(
                        aDest,
                        lLibelleSupp,
                      )
                    : aDest.getLibelle() + lLibelleSupp,
                ),
              );
            });
          },
        );
        ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_1.ObjetFenetre,
          { pere: this },
          {
            titre: aEstPublicParticipant
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.NParticipants',
                  [lListeDest.count()],
                )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.ListeDestinataires',
                ),
            largeur: 450,
            hauteur: !IE.estMobile ? 200 : null,
            hauteurMaxContenu: !IE.estMobile ? 600 : null,
            avecScroll: !IE.estMobile,
            fermerFenetreSurClicHorsFenetre: true,
            listeBoutons: [ObjetTraduction_1.GTraductions.getValeur('Fermer')],
          },
        ).afficher(lHtml);
      };
    UtilitaireMessagerie.getStrHintPublicMessagePromise = async function (
      aInstance,
      aNumeroMessage,
      aEstPublicParticipant,
      aEstDestinatairesReponse,
      aNode,
    ) {
      const lKey = 'strHint' + !!aEstPublicParticipant;
      if (aNode) {
        const lData = $(aNode).data(lKey);
        if (lData) {
          return lData;
        }
      }
      const lListePublics = await getListePublicMessagePromise(
        aInstance,
        aNumeroMessage,
        aEstPublicParticipant,
        aEstDestinatairesReponse,
      );
      let lStr = '&nbsp;';
      if (lListePublics) {
        const lTab = [];
        lListePublics.parcourir((aPublic) => {
          let lLibelleSupp =
            UtilitaireMessagerie.getStrHintDetailDePublic(aPublic);
          if (lListePublics.avecConnection) {
            lTab.push(
              UtilitaireMessagerie.contruirePublicConnecte(
                aPublic,
                lLibelleSupp,
              ),
            );
          } else {
            lTab.push(aPublic.getLibelle() + lLibelleSupp);
          }
        });
        lStr = lTab.join(lListePublics.avecConnection ? '' : '<br>');
        const lNb = lListePublics.count();
        if (lNb > 0) {
          lStr =
            (0, tag_1.tag)(
              'b',
              aEstPublicParticipant
                ? ObjetTraduction_1.GTraductions.getValeur(
                    'Messagerie.NParticipants',
                    [lNb],
                  )
                : lNb > 1
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.NDestinataires',
                      [lNb],
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.NDestinataire',
                      [lNb],
                    ),
            ) +
            (0, tag_1.tag)('br') +
            lStr;
        }
      }
      if (aNode) {
        $(aNode).data(lKey, lStr);
      }
      return lStr;
    };
    UtilitaireMessagerie.getStrHintDetailDePublic = function (aPublic) {
      let lLibelle = '';
      if (aPublic.estSorti) {
        lLibelle +=
          '&nbsp;<i class="icon_sortir_reintegrer_conversation" style="font-size:1.1em;"></i>&nbsp;' +
          ObjetTraduction_1.GTraductions.getValeur('Messagerie.Retire');
      }
      if (aPublic.refusMess) {
        lLibelle = ` - ${ObjetTraduction_1.GTraductions.getValeur('Messagerie.RefuseDiscussions')}`;
      }
      return lLibelle;
    };
    UtilitaireMessagerie.getIndiceDiscussion = function (
      aListeMessagerie,
      aMessage,
    ) {
      if (aMessage && aMessage.listePossessionsMessages) {
        for (let I = 0; I < aMessage.listePossessionsMessages.count(); I++) {
          const lPossessionMessage = aMessage.listePossessionsMessages.get(I);
          for (let J = 0; J < aListeMessagerie.count(); J++) {
            const lDiscussion = aListeMessagerie.get(J);
            for (
              let K = 0;
              K < lDiscussion.listePossessionsMessages.count();
              K++
            ) {
              if (
                lPossessionMessage.getNumero() ===
                  lDiscussion.listePossessionsMessages.getNumero(K) &&
                aMessage.estUneDiscussion === lDiscussion.estUneDiscussion &&
                ((aMessage.pere && lDiscussion.pere) ||
                  (!aMessage.pere && !lDiscussion.pere))
              ) {
                return J;
              }
            }
          }
        }
      }
      return null;
    };
    UtilitaireMessagerie.getIndiceDiscussionDeMessageVisu = function (
      aListeMessagerie,
      aMessageVisu,
    ) {
      if (
        !aMessageVisu ||
        !aMessageVisu.possessionMessage ||
        !aListeMessagerie
      ) {
        return;
      }
      const lNumeroPossessionMessage =
        aMessageVisu.possessionMessage.existeNumero()
          ? aMessageVisu.possessionMessage
          : new ObjetElement_1.ObjetElement('', aMessageVisu.getNumero());
      const lMessage = new ObjetElement_1.ObjetElement();
      lMessage.listePossessionsMessages =
        new ObjetListeElements_1.ObjetListeElements();
      lMessage.listePossessionsMessages.addElement(lNumeroPossessionMessage);
      lMessage.estUneDiscussion = false;
      lMessage.pere = true;
      return UtilitaireMessagerie.getIndiceDiscussion(
        aListeMessagerie,
        lMessage,
      );
    };
    UtilitaireMessagerie.getIndicePere = function (aListeMessagerie, aMessage) {
      if (aMessage.indicePere >= 0) {
        return this.getIndicePere(
          aListeMessagerie,
          aListeMessagerie.get(aMessage.indicePere),
        );
      } else {
        return aMessage.indice;
      }
    };
    UtilitaireMessagerie.getDiscussionRacine = function (aMessage) {
      if (aMessage.pere) {
        return UtilitaireMessagerie.getDiscussionRacine(aMessage.pere);
      } else {
        return aMessage;
      }
    };
    UtilitaireMessagerie.estEgal = function (aMessage1, aMessage2) {
      if (aMessage1 && aMessage2) {
        if (aMessage1.estUneDiscussion && aMessage2.estUneDiscussion) {
          return (
            aMessage1.profondeur === aMessage2.profondeur &&
            aMessage1.objet === aMessage2.objet &&
            aMessage1.listePossessionsMessages.count() ===
              aMessage2.listePossessionsMessages.count() &&
            (aMessage1.listePossessionsMessages.count() === 0 ||
              aMessage1.listePossessionsMessages.getNumero(0) ===
                aMessage2.listePossessionsMessages.getNumero(0))
          );
        } else if (!aMessage1.estUneDiscussion && !aMessage2.estUneDiscussion) {
          return aMessage1.getNumero() === aMessage2.getNumero();
        }
      }
      return false;
    };
    UtilitaireMessagerie.avecPossessionPartageeEntreMessages = function (
      aMessage1,
      aMessage2,
    ) {
      let lResult = false;
      if (
        aMessage1 &&
        aMessage2 &&
        aMessage1.listePossessionsMessages &&
        aMessage2.listePossessionsMessages
      ) {
        aMessage1.listePossessionsMessages.parcourir((aPossession) => {
          if (
            aMessage2.listePossessionsMessages.getElementParElement(aPossession)
          ) {
            lResult = true;
            return false;
          }
        });
      }
      return lResult;
    };
    UtilitaireMessagerie.dessinCouleurEtiquette = function (aEtiquette) {
      if (!aEtiquette.couleur) {
        return '';
      }
      return [
        '<div class="utilMess_etiquette" style="',
        ObjetStyle_1.GStyle.composeCouleur(
          aEtiquette.couleur,
          GCouleur.getCouleurCorrespondance(aEtiquette.couleur),
        ),
        '"',
        ' title="',
        ObjetChaine_1.GChaine.toTitle(aEtiquette.getLibelle()),
        '">',
        aEtiquette.abr || '',
        '</div>',
      ].join('');
    };
    UtilitaireMessagerie.dessinListeEtiquettes = function (
      aListeEtiquettes,
      aAvecEspaceGaucheDebut = false,
    ) {
      if (!aListeEtiquettes || !aListeEtiquettes.parcourir) {
        return '';
      }
      const H = [];
      aListeEtiquettes.parcourir((aEtiquette, aIndex) => {
        const lHtml = UtilitaireMessagerie.dessinCouleurEtiquette(aEtiquette);
        if (lHtml) {
          H.push(
            '<div class="InlineBlock AlignementMilieuVertical Maigre',
            aAvecEspaceGaucheDebut && aIndex === 0 ? ' PetitEspaceGauche' : '',
            aIndex < aListeEtiquettes.count() - 1 ? ' PetitEspaceDroit' : '',
            '">',
            lHtml,
            '</div>',
          );
        }
      });
      return H.join('');
    };
    UtilitaireMessagerie.estMessageVisuChat = function (aMessageVisu) {
      if (aMessageVisu) {
        if (aMessageVisu.estChat) {
          return true;
        }
        switch (aMessageVisu.getGenre()) {
          case TypeGenreDiscussion_1.TypeGenreDiscussion.GD_ContactVS:
          case TypeGenreDiscussion_1.TypeGenreDiscussion.GD_Conversation:
          case TypeGenreDiscussion_1.TypeGenreDiscussion.GD_Alerte:
            return true;
        }
      }
      return false;
    };
    UtilitaireMessagerie.contruirePublicConnecte = function (
      aPublic,
      aLibelleSupp,
      aAvecStatutConexion = true,
    ) {
      if (!aPublic) {
        return '';
      }
      return [
        '<div class="utilMess_dest',
        aPublic.refusMess ? ' dest-refus' : '',
        '">',
        aPublic.refusMess
          ? ''
          : '<i class="' +
            TypeStatutConnexion_1.TypeGenreStatutConnexionUtil.getClassIcon(
              aPublic.statutConnexion,
            ) +
            '" aria-hidden="true"></i>',
        '<div class="utilMess_texte" ie-ellipsis>',
        aPublic.getLibelle(),
        aAvecStatutConexion
          ? (0, tag_1.tag)(
              'label',
              '&nbsp;-&nbsp;' +
                UtilitaireMessagerie.contruirePublicConnecteStatutConnexion(
                  aPublic,
                ),
            )
          : '',
        aLibelleSupp || '',
        '</div>',
        '</div>',
      ].join('');
    };
    UtilitaireMessagerie.contruirePublicConnecteStatutConnexion = function (
      aPublic,
    ) {
      if (!aPublic) {
        return '';
      }
      return aPublic.refusMess
        ? ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.RefuseDiscussions',
          )
        : TypeStatutConnexion_1.TypeGenreStatutConnexionUtil.toLibelle(
            aPublic.statutConnexion,
          );
    };
    UtilitaireMessagerie.getIconeDEtiquette = function (aEtiquette) {
      if (!aEtiquette || !aEtiquette.getGenre) {
        return '';
      }
      const lPrimParent =
        GEtatUtilisateur.GenreEspace ===
          Enumere_Espace_1.EGenreEspace.PrimParent ||
        GEtatUtilisateur.GenreEspace ===
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent;
      if (aEtiquette.toutes) {
        return lPrimParent ? 'icon_discussion_cours' : 'icon_inbox';
      }
      if (aEtiquette.enCours) {
        return 'icon_discussion_cours';
      }
      if (aEtiquette.estFiltreDiscussionMesEleves) {
        return 'icon_utilisateur';
      }
      switch (aEtiquette.getGenre()) {
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive:
          return 'icon_archiver_discussion';
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte:
          return 'icon_alerte_ppms';
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS:
          return 'icon_conversation_contact_vie_sco';
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation:
          return 'icon_conversation_cours';
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon:
          return 'icon_brouillon_discussion';
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle:
          return 'icon_trash';
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison:
          return 'icon_carnet_liaison';
        case TypeOrigineCreationEtiquetteMessage_1
          .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Harcelement:
          return 'icon_stop_harcelement';
      }
      return '';
    };
    UtilitaireMessagerie.construireImageEtiquette = function (aEtiquette) {
      const lResult = { icone: '', avecCompteurNonLu: true };
      const lIcone = UtilitaireMessagerie.getIconeDEtiquette(aEtiquette);
      if (lIcone) {
        lResult.icone = (0, tag_1.tag)('i', { class: lIcone });
      }
      if (
        TypeOrigineCreationEtiquetteMessage_1.TypeOrigineCreationEtiquetteMessageUtil.estEtiquettePerso(
          aEtiquette.getGenre(),
        )
      ) {
        lResult.icone = (0, tag_1.tag)(
          'div',
          {
            class: 'utilMess_etiquette utilMess_etiquette_liste',
            style: [
              tag_1.tag.styleToStr('background-color', aEtiquette.couleur),
              tag_1.tag.styleToStr(
                'color',
                GCouleur.getCouleurCorrespondance(aEtiquette.couleur),
              ),
            ],
          },
          aEtiquette.abr || '',
        );
        lResult.estImage = true;
      }
      if (
        aEtiquette.getGenre() ===
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon ||
        aEtiquette.getGenre() ===
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle
      ) {
        lResult.avecCompteurNonLu = false;
      }
      return lResult;
    };
    UtilitaireMessagerie.getNbNonlusDEtiquette = function (
      aEtiquette,
      aListeMessagerie,
    ) {
      let lNb = 0;
      if (aListeMessagerie && aEtiquette) {
        aListeMessagerie.parcourir((D) => {
          if (
            UtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(
              D,
              aEtiquette,
            )
          ) {
            if (D.estUneDiscussion && D.profondeur === 0) {
              lNb += D.nbNonLus || 0;
            }
          }
        });
      }
      return lNb;
    };
    UtilitaireMessagerie.getIconeMessage = function (aMessage) {
      const lMessage = UtilitaireMessagerie.getDiscussionRacine(aMessage);
      let lResult = aMessage.estDiscussionEleve
        ? 'icon_utilisateur'
        : 'icon_discussion_cours';
      if (
        lMessage &&
        lMessage.listeEtiquettes &&
        lMessage.listeEtiquettes.count() > 0
      ) {
        lMessage.listeEtiquettes.parcourir((aEtiquette) => {
          const lIcone = UtilitaireMessagerie.getIconeDEtiquette(aEtiquette);
          if (lIcone) {
            lResult = lIcone;
            return false;
          }
        });
      }
      return lResult;
    };
    UtilitaireMessagerie.estDiscussionVisibleSelonEtiquette = function (
      aDiscussion,
      aEtiquette,
    ) {
      if (!aEtiquette) {
        return true;
      }
      if (aEtiquette.nonSelectionnable) {
        return false;
      }
      let lExclusions = [];
      let lAvecEtiquettes = [];
      let lEtiquetteFiltre = null;
      let lVisible = true;
      const lEstPrimParent =
        GEtatUtilisateur.GenreEspace ===
          Enumere_Espace_1.EGenreEspace.PrimParent ||
        GEtatUtilisateur.GenreEspace ===
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent;
      if (aEtiquette.toutes) {
        lExclusions = [
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
        ];
        if (lEstPrimParent) {
          lExclusions.push(
            TypeOrigineCreationEtiquetteMessage_1
              .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison,
          );
        }
      } else if (aEtiquette.enCours) {
        lExclusions = [
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive,
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte,
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS,
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation,
        ];
      } else if (aEtiquette.estFiltreDiscussionMesEleves) {
        if (!aDiscussion.estDiscussionEleve) {
          return false;
        }
        lExclusions = [
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
        ];
      } else if (aEtiquette.estSansEtiquette) {
        lExclusions = [
          ...TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessageUtil.tabEtiquetesPersos,
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
        ];
      } else if (
        TypeOrigineCreationEtiquetteMessage_1.TypeOrigineCreationEtiquetteMessageUtil.estEtiquettePerso(
          aEtiquette.getGenre(),
        )
      ) {
        lExclusions = [
          TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
        ];
        lEtiquetteFiltre = aEtiquette;
      } else {
        switch (aEtiquette.getGenre()) {
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison:
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive:
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation:
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte:
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS:
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Harcelement:
            lExclusions = [
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
            ];
            lEtiquetteFiltre = aEtiquette;
            break;
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon:
            lAvecEtiquettes = [
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon,
            ];
            lExclusions = [
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
            ];
            break;
          case TypeOrigineCreationEtiquetteMessage_1
            .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle:
            lExclusions = [];
            lAvecEtiquettes = [
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
            ];
            break;
          default:
        }
      }
      lExclusions.forEach((aGenreExclu) => {
        aDiscussion.listeEtiquettes.parcourir((D) => {
          if (D.getGenre() === aGenreExclu) {
            lVisible = false;
            return false;
          }
        });
      });
      if (lVisible && lEtiquetteFiltre) {
        lVisible = false;
        aDiscussion.listeEtiquettes.parcourir((D) => {
          if (lEtiquetteFiltre.getNumero() === D.getNumero()) {
            lVisible = true;
            return false;
          }
        });
        if (
          lVisible &&
          lEstPrimParent &&
          lEtiquetteFiltre.getGenre() ===
            TypeOrigineCreationEtiquetteMessage_1
              .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison
        ) {
          if (!!aDiscussion.contexte && !!lEtiquetteFiltre.contexte) {
            lVisible =
              aDiscussion.contexte.getNumero() ===
              lEtiquetteFiltre.contexte.getNumero();
          }
        }
      }
      if (lVisible) {
        lAvecEtiquettes.forEach((aGenreEtiquette) => {
          lVisible = false;
          aDiscussion.listeEtiquettes.parcourir((D) => {
            if (D.getGenre() === aGenreEtiquette) {
              lVisible = true;
              return false;
            }
          });
        });
      }
      if (lVisible && aDiscussion.pere) {
        lVisible = UtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(
          aDiscussion.pere,
          aEtiquette,
        );
      }
      return lVisible;
    };
    UtilitaireMessagerie.getEtiquetteInitSelonMessage = function (
      aListeEtiquettes,
      aEtiquetteOriginal,
      aAvecSelecteurEtiquette,
      aMessageSelectionne,
    ) {
      let lEtiquette = aEtiquetteOriginal;
      if (!aListeEtiquettes) {
        return lEtiquette;
      }
      if (lEtiquette) {
        lEtiquette = aListeEtiquettes.getElementParNumero(
          lEtiquette.getNumero(),
        );
      }
      let lEtiquetteToutes = null;
      aListeEtiquettes.parcourir((D) => {
        if (D.toutes) {
          lEtiquetteToutes = D;
          return false;
        }
      });
      if (!lEtiquette) {
        lEtiquette = lEtiquetteToutes;
        if (
          aAvecSelecteurEtiquette &&
          GApplication.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionAvancee,
          )
        ) {
          aListeEtiquettes.parcourir((D) => {
            if (D.enCours) {
              lEtiquette = D;
              return false;
            }
          });
        }
      }
      if (
        lEtiquette &&
        aAvecSelecteurEtiquette &&
        lEtiquette.enCours &&
        aMessageSelectionne &&
        lEtiquetteToutes &&
        !UtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(
          aMessageSelectionne,
          lEtiquette,
        )
      ) {
        lEtiquette = lEtiquetteToutes;
      }
      if (
        lEtiquette &&
        aAvecSelecteurEtiquette &&
        aMessageSelectionne &&
        !UtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(
          aMessageSelectionne,
          lEtiquette,
        )
      ) {
        aListeEtiquettes.parcourir((D) => {
          if (
            !D.enCours &&
            !D.toutes &&
            UtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(
              aMessageSelectionne,
              D,
            )
          ) {
            lEtiquette = D;
            return false;
          }
        });
      }
      return lEtiquette;
    };
    UtilitaireMessagerie.getGenreReponse = function (
      aGenre,
      aAvecInclureParentsEleves,
    ) {
      if (
        aGenre ===
          TypeHttpReponseMessage_1.TypeHttpReponseMessage
            .rm_EnvoiATousSaufParentEleve &&
        aAvecInclureParentsEleves
      ) {
        return TypeHttpReponseMessage_1.TypeHttpReponseMessage.rm_EnvoiATous;
      }
      if (
        aGenre ===
          TypeHttpReponseMessage_1.TypeHttpReponseMessage
            .rm_RelanceATousSaufParentEleve &&
        aAvecInclureParentsEleves
      ) {
        return TypeHttpReponseMessage_1.TypeHttpReponseMessage.rm_Relance;
      }
      return aGenre;
    };
    UtilitaireMessagerie.estGenreDestinataireAutorise = function (
      aGenreRessource,
    ) {
      const lApp = GApplication;
      switch (aGenreRessource) {
        case Enumere_Ressource_1.EGenreRessource.Eleve:
          return lApp.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionEleves,
          );
        case Enumere_Ressource_1.EGenreRessource.Responsable:
          return lApp.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionParents,
          );
        case Enumere_Ressource_1.EGenreRessource.Enseignant:
          return lApp.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionProfesseurs,
          );
        case Enumere_Ressource_1.EGenreRessource.Personnel:
          return lApp.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionPersonnels,
          );
        default:
      }
      return false;
    };
    UtilitaireMessagerie.interdireReponseParentEleve = () => {
      return [
        Enumere_Espace_1.EGenreEspace.PrimEleve,
        Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
      ].includes(GEtatUtilisateur.GenreEspace);
    };
    UtilitaireMessagerie.unMessageContientLeDirecteur = function (
      aListeMessages,
    ) {
      let result = false;
      if (!!aListeMessages) {
        aListeMessages.parcourir((D) => {
          if (D.avecDirecteur) {
            result = true;
            return false;
          }
        });
      }
      return result;
    };
    UtilitaireMessagerie.avecEditionHtmlMessage = function () {
      return GApplication.droits.get(
        ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionAvancee,
      );
    };
    UtilitaireMessagerie.avecEditeurTiny = function () {
      return (
        GNavigateur.withContentEditable &&
        ObjetSupport_1.Support.contentEditable &&
        UtilitaireMessagerie.avecEditionHtmlMessage()
      );
    };
    UtilitaireMessagerie.avecAjoutPieceJointeMessage = function () {
      return (
        ObjetSupport_1.Support.avecSupportFileUpload &&
        ![
          Enumere_Espace_1.EGenreEspace.Eleve,
          Enumere_Espace_1.EGenreEspace.Mobile_Eleve,
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          Enumere_Espace_1.EGenreEspace.PrimEleve,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
        ].includes(GEtatUtilisateur.GenreEspace)
      );
    };
    UtilitaireMessagerie.getListeDestCarnetLiaisonDElevePrimParent = function (
      aNumeroEleve,
    ) {
      const lEleve =
        GEtatUtilisateur.Identification.ListeRessources.getElementParNumero(
          aNumeroEleve,
        );
      if (!lEleve || !lEleve.destinatairesCarnetLiaison) {
        return new ObjetListeElements_1.ObjetListeElements();
      }
      return lEleve.destinatairesCarnetLiaison;
    };
    UtilitaireMessagerie.getBrouillonDefaut = function () {
      const lBrouillon = new ObjetElement_1.ObjetElement();
      lBrouillon.contenu = '';
      lBrouillon.objet = '';
      lBrouillon.listeFichiers = new ObjetListeElements_1.ObjetListeElements();
      return lBrouillon;
    };
    UtilitaireMessagerie.avecListeDiffusionSelonEspace = function () {
      return (
        [
          Enumere_Espace_1.EGenreEspace.Professeur,
          Enumere_Espace_1.EGenreEspace.Mobile_Professeur,
          Enumere_Espace_1.EGenreEspace.PrimProfesseur,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimProfesseur,
          Enumere_Espace_1.EGenreEspace.Administrateur,
          Enumere_Espace_1.EGenreEspace.Mobile_Administrateur,
          Enumere_Espace_1.EGenreEspace.PrimDirection,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimDirection,
          Enumere_Espace_1.EGenreEspace.Etablissement,
          Enumere_Espace_1.EGenreEspace.Mobile_Etablissement,
          Enumere_Espace_1.EGenreEspace.PrimMairie,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimMairie,
        ].indexOf(GEtatUtilisateur.GenreEspace) >= 0
      );
    };
    UtilitaireMessagerie.getLibelleSuppListePublics = function (aArticle) {
      const H = [];
      if (aArticle) {
        switch (aArticle.getGenre()) {
          case Enumere_Ressource_1.EGenreRessource.Enseignant:
            if (aArticle.estPrincipal) {
              H.push(
                `<p><i class="icon_star m-right-s"></i>${ObjetTraduction_1.GTraductions.getValeur('Messagerie.ProfPrincipal')}</p>`,
              );
            }
            if (aArticle.estTuteur) {
              H.push(
                `<p><i class="icon_star m-right-s"></i>${ObjetTraduction_1.GTraductions.getValeur('Messagerie.Tuteur')}</p>`,
              );
            }
            if (aArticle.listeRessources) {
              H.push(
                aArticle.listeRessources.getTableauLibelles().join('<br>'),
              );
            }
            break;
          case Enumere_Ressource_1.EGenreRessource.Personnel:
            if (aArticle.estMonCpe) {
              H.push(
                `<p><i class="icon_star m-right-s"></i>${ObjetTraduction_1.GTraductions.getValeur('Messagerie.monCPE')}</p>`,
              );
            }
            if (aArticle.fonction) {
              H.push(`<p>${aArticle.fonction.getLibelle()}</p>`);
            }
            break;
          case Enumere_Ressource_1.EGenreRessource.Eleve:
          case Enumere_Ressource_1.EGenreRessource.Responsable:
            if (aArticle.classesNiv) {
              H.push(
                `<p>${aArticle.classesNiv.getTableauLibelles().join(', ')}</p>`,
              );
            }
            break;
        }
      }
      return H.join('');
    };
    UtilitaireMessagerie.getLibelleSuppListePublicsGenreCumulFonction = (
      aArticle,
    ) => {
      if (aArticle) {
        switch (aArticle.getGenre()) {
          case Enumere_Ressource_1.EGenreRessource.Personnel:
            if (aArticle.estMonCpe) {
              return `<p class="m-bottom"><i class="icon_star m-right-s"></i>${ObjetTraduction_1.GTraductions.getValeur('Messagerie.monCPE')}</p>`;
            }
            break;
        }
        return '';
      }
    };
    UtilitaireMessagerie.selectionnerListePublics = async (aParams) => {
      const lParams = Object.assign(
        {
          instance: null,
          genreRessource: null,
          avecIndicationDiscussionInterdit: true,
          listeRessourcesSelectionnees:
            new ObjetListeElements_1.ObjetListeElements(),
          uniquementAjouterDest: false,
          listeRessourcesInvisibles: null,
          estAlertePPMS: false,
        },
        aParams,
      );
      let lDonnees;
      let lListeRessources;
      if (
        GApplication.droits.get(
          ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionAvancee,
        )
      ) {
        lDonnees =
          await new ObjetRequeteListePublics_1.ObjetRequeteListePublics(
            lParams.instance,
          ).lancerRequete({
            pourMessagerie: true,
            genres: [lParams.genreRessource],
            sansFiltreSurEleve: GApplication.droits.get(
              ObjetDroitsPN_1.TypeDroits.communication.toutesClasses,
            ),
            avecFonctionPersonnel: true,
          });
        lListeRessources = lDonnees.listePublic;
      } else {
        const lParametresRequete = {
          onglet: new ObjetElement_1.ObjetElement(
            '',
            0,
            lParams.genreRessource,
          ),
          filtreElement: GEtatUtilisateur.getMembre(),
        };
        if (
          [
            Enumere_Espace_1.EGenreEspace.Parent,
            Enumere_Espace_1.EGenreEspace.Mobile_Parent,
          ].includes(GEtatUtilisateur.GenreEspace) &&
          lParams.genreRessource ===
            Enumere_Ressource_1.EGenreRessource.Responsable
        ) {
          $.extend(lParametresRequete, {
            filtreElement: new ObjetElement_1.ObjetElement('', 0, 6),
          });
        }
        lDonnees =
          await new ObjetRequeteListeRessourcesPourCommunication_1.ObjetRequeteListeRessourcesPourCommunication(
            lParams.instance,
          ).lancerRequete(lParametresRequete);
        lListeRessources = lDonnees.listeRessourcesPourCommunication;
      }
      const lGenreRessource = lParams.genreRessource;
      if (lParams.uniquementAjouterDest) {
        if (lParams.listeRessourcesInvisibles) {
          lListeRessources = lListeRessources.getListeElements((aElement) => {
            return !lParams.listeRessourcesInvisibles.getElementParNumero(
              aElement.getNumero(),
            );
          });
        }
        if (lListeRessources.count() === 0) {
          let lMessage = '';
          switch (lParams.genreRessource) {
            case Enumere_Ressource_1.EGenreRessource.Enseignant:
              lMessage = ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.TousLesProfesseursDejaDestinataires',
              );
              break;
            case Enumere_Ressource_1.EGenreRessource.Personnel:
              lMessage = ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.TousLesPersonnelsDejaDestinataires',
              );
              break;
            case Enumere_Ressource_1.EGenreRessource.Eleve:
              lMessage = ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.TousLesElevesDejaDestinataires',
              );
              break;
            case Enumere_Ressource_1.EGenreRessource.Responsable:
              lMessage = ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.TousLesResponsablesDejaDestinataires',
              );
              break;
            default:
          }
          await GApplication.getMessage().afficher({ message: lMessage });
          return null;
        }
      }
      let lGenreCumul = (0,
      UtilitaireFenetreSelectionPublic_1.getCumulPourFenetrePublic)(
        lParams.genreRessource,
        lDonnees.checked,
        lListeRessources.count(),
      );
      let lEstCasRespToResp = false;
      if (
        [
          Enumere_Ressource_1.EGenreRessource.Enseignant,
          Enumere_Ressource_1.EGenreRessource.Personnel,
        ].includes(lGenreRessource) &&
        [
          Enumere_Espace_1.EGenreEspace.Eleve,
          Enumere_Espace_1.EGenreEspace.Mobile_Eleve,
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
        ].includes(GEtatUtilisateur.GenreEspace)
      ) {
        lListeRessources = lListeRessources.getListeElements((D) => {
          return D.avecDiscussion === true;
        });
      }
      if (
        [Enumere_Ressource_1.EGenreRessource.Responsable].includes(
          lGenreRessource,
        ) &&
        [
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
        ].includes(GEtatUtilisateur.GenreEspace)
      ) {
        lEstCasRespToResp = true;
        lGenreCumul =
          ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic
            .respDelegues;
      }
      let lListeCumuls = new ObjetListeElements_1.ObjetListeElements();
      if (
        lGenreRessource === Enumere_Ressource_1.EGenreRessource.Eleve ||
        (lGenreRessource === Enumere_Ressource_1.EGenreRessource.Responsable &&
          !lEstCasRespToResp)
      ) {
        lListeCumuls.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur('actualites.Cumul.Classe'),
            0,
            ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.classe,
            0,
          ),
        );
        lListeCumuls.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur('actualites.Cumul.Groupe'),
            0,
            ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.groupe,
            1,
          ),
        );
        lListeCumuls.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'actualites.Cumul.Alphabetique',
            ),
            0,
            ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.initial,
            2,
          ),
        );
        if (
          lGenreRessource === Enumere_Ressource_1.EGenreRessource.Responsable
        ) {
          lListeCumuls.addElement(
            new ObjetElement_1.ObjetElement(
              ObjetTraduction_1.GTraductions.getValeur(
                'actualites.Cumul.NomDesEleves',
              ),
              0,
              ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.nomEleves,
            ),
          );
        }
        if (lDonnees.listeServicesPeriscolaire) {
          lListeCumuls.addElement(
            new ObjetElement_1.ObjetElement(
              ObjetTraduction_1.GTraductions.getValeur(
                'actualites.Cumul.ServicesPeriscolaire',
              ),
              0,
              ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.servicesPeriscolaire,
            ),
          );
        }
        if (lDonnees.listeProjetsAcc) {
          lListeCumuls.addElement(
            new ObjetElement_1.ObjetElement(
              ObjetTraduction_1.GTraductions.getValeur(
                'actualites.Cumul.ProjetsAccompagnement',
              ),
              0,
              ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.projetsAccompagnement,
            ),
          );
        }
        if (
          lGenreRessource === Enumere_Ressource_1.EGenreRessource.Eleve &&
          lListeRessources &&
          lListeRessources.count() > 0 &&
          MethodesObjet_1.MethodesObjet.isBoolean(
            lListeRessources.get(0).estAbsent,
          )
        ) {
          lListeCumuls.addElement(
            new ObjetElement_1.ObjetElement(
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.Filtre_AbsencePresenceEleve',
              ),
              0,
              ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.presentielEleve,
            ),
          );
        }
        if (
          lGenreRessource === Enumere_Ressource_1.EGenreRessource.Eleve ||
          lGenreRessource === Enumere_Ressource_1.EGenreRessource.Responsable
        ) {
          if (lDonnees.listeFamilles) {
            lDonnees.listeFamilles.parcourir((aFamille) => {
              const lFiltreFamille = new ObjetElement_1.ObjetElement(
                aFamille.getLibelle(),
                0,
                ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.famille,
              );
              lFiltreFamille.famille = aFamille;
              lListeCumuls.addElement(lFiltreFamille);
            });
          }
        }
      } else if (
        lGenreRessource === Enumere_Ressource_1.EGenreRessource.Enseignant &&
        [
          Enumere_Espace_1.EGenreEspace.Accompagnant,
          Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Tuteur,
          Enumere_Espace_1.EGenreEspace.Mobile_Tuteur,
        ].includes(GEtatUtilisateur.GenreEspace) &&
        GEtatUtilisateur.Identification.ListeRessources.count() > 1
      ) {
        lListeCumuls.addElement(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'actualites.Cumul.NomDesEleves',
            ),
            0,
            ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.nomEleves,
          ),
        );
      } else if (
        lGenreRessource === Enumere_Ressource_1.EGenreRessource.Personnel
      ) {
        lListeCumuls.add(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Fenetre_SelectionPublic.Cumul.Aucun',
            ),
            0,
            ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.sans,
            0,
          ),
        );
        lListeCumuls.add(
          new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'actualites.Cumul.Fonction',
            ),
            0,
            ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.fonction,
            1,
          ),
        );
      }
      if (lDonnees.listeNiveauxResponsabilite) {
        lParams.listeNiveauxResponsabilite =
          lDonnees.listeNiveauxResponsabilite;
      }
      return UtilitaireMessagerie.fenetreSelectionnerListePublics(
        Object.assign(
          {
            listeRessources: lListeRessources,
            listeCumuls: lListeCumuls,
            genreCumul: lGenreCumul,
          },
          lParams,
        ),
      );
    };
    UtilitaireMessagerie.fenetreSelectionnerListePublics = async (aParams) => {
      const lParams = Object.assign(
        {
          instance: null,
          genreRessource: null,
          listeRessources: new ObjetListeElements_1.ObjetListeElements(),
          listeRessourcesSelectionnees:
            new ObjetListeElements_1.ObjetListeElements(),
          avecIndicationDiscussionInterdit: false,
          uniquementAjouterDest: false,
          listeCumuls: null,
          genreCumul: null,
          estAlertePPMS: false,
        },
        aParams,
      );
      return await new Promise((aResolve) => {
        const lInstance = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          lParams.estAlertePPMS
            ? ObjetFenetre_SelectionPublic_1.ObjetFenetre_SelectionPublic
            : ObjetFenetre_SelectionPublic_PN_1.ObjetFenetre_SelectionPublic_PN,
          {
            pere: lParams.instance,
            evenement: function (aGenre, aListe, aNumeroBouton) {
              if (aNumeroBouton === 1) {
                aResolve(aListe);
              } else {
                aResolve(null);
              }
            },
          },
        );
        lInstance.setOptionsFenetreSelectionRessource({
          avecCocheRessources: true,
          afficherUtilisateurCourant: !lParams.uniquementAjouterDest,
        });
        if (lParams.listeCumuls && lParams.listeCumuls.count() > 0) {
          lInstance.setListeCumuls(lParams.listeCumuls);
        }
        if (lParams.genreCumul) {
          lInstance.setGenreCumulActif(lParams.genreCumul);
        }
        lInstance.setOptions({
          getInfosSuppZonePrincipale(aParams) {
            return UtilitaireMessagerie[
              lInstance.getGenreCumul() !==
              ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic
                .fonction
                ? 'getLibelleSuppListePublics'
                : 'getLibelleSuppListePublicsGenreCumulFonction'
            ](aParams.article);
          },
        });
        lInstance.setSelectionObligatoire(false);
        lInstance.setDonnees({
          listeRessources: lParams.listeRessources,
          listeRessourcesSelectionnees: lParams.listeRessourcesSelectionnees,
          genreRessource: lParams.genreRessource,
          avecIndicationDiscussionInterdit:
            lParams.avecIndicationDiscussionInterdit,
          titre:
            Enumere_Ressource_1.EGenreRessourceUtil.getTitreFenetreSelectionRessource(
              lParams.genreRessource,
            ),
          listeNiveauxResponsabilite: lParams.listeNiveauxResponsabilite,
        });
      });
    };
    UtilitaireMessagerie.selectionnerListeDiffusions = (aInstance) => {
      let lListeDiffusions = null;
      if (
        Cache_1.GCache &&
        Cache_1.GCache.general.existeDonnee('listeDiffusion_messagerie')
      ) {
        lListeDiffusions = Cache_1.GCache.general.getDonnee(
          'listeDiffusion_messagerie',
        );
      }
      return Promise.resolve()
        .then(() => {
          if (!lListeDiffusions) {
            return new ObjetRequeteListeDiffusion_1.ObjetRequeteListeDiffusion(
              aInstance,
            )
              .lancerRequete({ pourMessagerie: true })
              .then((aJSON) => {
                if (aJSON && aJSON.liste) {
                  lListeDiffusions = aJSON.liste;
                  if (Cache_1.GCache) {
                    Cache_1.GCache.general.setDonnee(
                      'listeDiffusion_messagerie',
                      lListeDiffusions,
                    );
                  }
                }
              });
          }
        })
        .then(() => {
          return new Promise((aResolve) => {
            if (!lListeDiffusions) {
              return null;
            }
            lListeDiffusions.parcourir((aElement) => {
              aElement.cmsActif = false;
            });
            ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
              ObjetFenetre_SelectionListeDiffusion_1.ObjetFenetre_SelectionListeDiffusion,
              {
                pere: aInstance,
                evenement: (aGenreBouton) => {
                  let lListeDiffusionsSelection =
                    new ObjetListeElements_1.ObjetListeElements();
                  if (aGenreBouton === 1) {
                    lListeDiffusionsSelection =
                      lListeDiffusions.getListeElements(
                        (aElement) => !!aElement.cmsActif,
                      );
                  }
                  aResolve(lListeDiffusionsSelection);
                },
              },
            ).setDonnees(
              new DonneesListe_SelectionDiffusion_1.DonneesListe_SelectionDiffusion(
                lListeDiffusions,
              ),
              false,
            );
          });
        });
    };
    UtilitaireMessagerie.avecListeDestinatairesProfsStatique = function () {
      return [
        Enumere_Espace_1.EGenreEspace.PrimEleve,
        Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
      ].includes(GEtatUtilisateur.GenreEspace);
    };
    UtilitaireMessagerie.getListeDestProfsDiscussionPrimEleveFormat = () => {
      let lListe = null;
      const lListeDest =
        GEtatUtilisateur.getUtilisateur().listeDestProfsDiscussionPrimEleve;
      if (lListeDest) {
        lListe = MethodesObjet_1.MethodesObjet.dupliquer(lListeDest);
        lListe
          .setTri([
            ObjetTri_1.ObjetTri.init('estPrincipal', -1),
            ObjetTri_1.ObjetTri.init('Position'),
          ])
          .trier()
          .parcourir((aProf) => {
            if (
              !aProf.estPrincipal &&
              aProf.listeRessources &&
              aProf.listeRessources.count() > 0 &&
              aProf.listeRessources.getTableauLibelles
            ) {
              aProf.setLibelle(
                `${aProf.getLibelle()} (${aProf.listeRessources.getTableauLibelles().join(', ')})`,
              );
            }
          });
      }
      return lListe;
    };
    UtilitaireMessagerie.getLibelleRaccourciMessPrimEleve = () => {
      const lListeDest =
        GEtatUtilisateur.getUtilisateur().listeDestProfsDiscussionPrimEleve;
      if (lListeDest && lListeDest.count() > 0) {
        return lListeDest.count() > 1
          ? ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.EcrireUnMessage',
            )
          : ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.EcrireUnMessageA_S',
              [lListeDest.getLibelle(0)],
            );
      }
      return '';
    };
    UtilitaireMessagerie.composeMettreEnCopie = (aParams) => {
      const H = [];
      H.push('<fieldset class="Gras">');
      H.push(
        '<legend>',
        ObjetTraduction_1.GTraductions.getValeur(
          'fenetreCommunication.mettreEnCopie',
        ),
        '</legend>',
      );
      if (aParams && aParams.avecDirection) {
        H.push(
          '<div><ie-checkbox ie-model="cbDestinataireDirecteur" class="m-left-xl m-top-l">',
          ObjetTraduction_1.GTraductions.getValeur(
            'fenetreCommunication.directionEcole',
          ),
          '</ie-checkbox></div>',
        );
      }
      if (aParams && aParams.avecEnseigantDEleve) {
        H.push(
          '<div><ie-checkbox ie-model="cbDestinataireEnseignant" class="m-left-xl m-top-l">',
          ObjetTraduction_1.GTraductions.getValeur(
            'fenetreCommunication.enseignantDEleve',
          ),
          '</ie-checkbox></div>',
        );
      }
      H.push('</fieldset>');
      return H.join('');
    };
    UtilitaireMessagerie.creerDiscussionAvecMairie = (
      aObjetFenetre,
      aInstance,
    ) => {
      if (!UtilitaireMessagerie.controleMessagerieDesactivee()) {
        return;
      }
      const lFenetreMessage = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
        aObjetFenetre,
        { pere: aInstance },
      );
      lFenetreMessage.setOptionsFenetre({
        titre: ObjetTraduction_1.GTraductions.getValeur(
          'fenetreCommunication.nouveauMessageMairie',
        ),
      });
      lFenetreMessage.setDonnees({
        ListeRessources:
          GEtatUtilisateur.Identification.ressource
            .destinatairePersonnelsMairie,
        listeSelectionnee: new ObjetListeElements_1.ObjetListeElements(),
        genreRessource: Enumere_Ressource_1.EGenreRessource.Personnel,
        message: { destinataireMairie: true },
      });
    };
    UtilitaireMessagerie.controleMessagerieDesactivee = () => {
      const lDroits = GApplication.droits;
      if (
        !lDroits.get(ObjetDroitsPN_1.TypeDroits.communication.avecDiscussion)
      ) {
        GApplication.getMessage().afficher({
          message: ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.DiscussionsDesactivees',
          ),
        });
        return false;
      }
      if (
        lDroits.get(
          ObjetDroitsPN_1.TypeDroits.communication
            .discussionDesactiveeSelonHoraire,
        )
      ) {
        GApplication.getMessage().afficher({
          message: lDroits.get(
            ObjetDroitsPN_1.TypeDroits.communication
              .messageDiscussionDesactiveeSelonHoraire,
          ),
        });
        return false;
      }
      return true;
    };
    class ObjetRequeteSaisiePublicMessage extends ObjetRequeteJSON_1.ObjetRequeteSaisie {}
    CollectionRequetes_1.Requetes.inscrire(
      'SaisiePublicMessage',
      ObjetRequeteSaisiePublicMessage,
    );
  },
  fn: 'utilitairemessagerie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TinyInit = exports.ObjetTinyInit = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetPosition_1 = require('ObjetPosition');
    const DeferLoadingScript_1 = require('DeferLoadingScript');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetChaine_1 = require('ObjetChaine');
    const ThemesCouleurs_1 = require('ThemesCouleurs');
    require('TinyIndex.css');
    class ObjetTinyInit {
      constructor() {
        this.optionsInitTiny = {
          avecMessageNettoyageHtml: true,
          optionsDOMPurify: null,
        };
        this.plugins = [
          'autolink',
          'charmap',
          'directionality',
          'fullscreen',
          'hr',
          'insertdatetime',
          'link',
          'lists',
          'media',
          'noneditable',
          'nonbreaking',
          'pagebreak',
          'paste',
          'preview',
          'print',
          'save',
          'searchreplace',
          'template',
          'visualchars',
        ];
        this.toolbar_std_1 = [
          'bold',
          'italic',
          'underline',
          '|',
          'alignleft',
          'aligncenter',
          'alignright',
          'alignjustify',
          '|',
          'fontselect',
          'fontsizeselect',
          '|',
          'cut',
          'copy',
          'paste',
          'pastetext',
        ];
        this.toolbar_std_2 = [
          'hr',
          'removeformat',
          '|',
          'bullist',
          'numlist',
          '|',
          'indent',
          'outdent',
          '|',
          'undo',
          'redo',
          '|',
          'forecolor',
          'backcolor',
          '|',
          'subscript',
          'superscript',
          '|',
          'charmap',
          '|',
          'link',
          'unlink',
        ];
        this.toolbar_qcm_1 = [
          'bold',
          'italic',
          'underline',
          '|',
          'alignleft',
          'aligncenter',
          'alignright',
          'alignjustify',
          '|',
          'fontselect',
          'fontsizeselect',
          '|',
          'forecolor',
          'backcolor',
          '|',
          'subscript',
          'superscript',
          '|',
          'charmap',
          '|',
          'bullist',
          'numlist',
        ];
        this.toolbar_mail_1 = [
          'bold',
          'italic',
          'underline',
          '|',
          'alignleft',
          'aligncenter',
          'alignright',
          'alignjustify',
          '|',
          'fontselect',
          'fontsizeselect',
          '|',
          'forecolor',
          'backcolor',
          '|',
          'link',
          'unlink',
          '|',
          'removeformat',
        ];
        this.fontFamily = 'Arial';
        this.fontSize = 13;
        this.fontSizeQCM = 13;
        this.genreMessage = { imageInterdite: 0 };
        this.globaleTinymce = null;
      }
      setOptionsInitTiny(aOptions) {
        Object.assign(this.optionsInitTiny, aOptions);
        return this;
      }
      async init(aParam) {
        await this._loadTiny();
        if (!aParam.id) {
          throw new Error();
        }
        const lGlobaleTinymce = this.globaleTinymce;
        if (!lGlobaleTinymce) {
          throw new Error();
        }
        let lJDOM = $('#' + aParam.id.escapeJQ());
        if (lJDOM.length === 0) {
          throw new Error();
        }
        lJDOM.on('destroyed', { instance: this }, (aEvent) => {
          aEvent.data.instance._detruireInstanceTiny(
            lGlobaleTinymce,
            aParam.id,
          );
        });
        this._detruireInstanceTiny(lGlobaleTinymce, aParam.id);
        let lParamDef = this.getParametresInitParDefaut(aParam);
        if (aParam.toolbar === undefined) {
          delete aParam.toolbar;
        }
        if (aParam.plugins) {
          delete aParam.plugins;
        }
        let lParam = Object.assign(lParamDef, aParam);
        lParam.selector = '#' + lParam.id.escapeJQ();
        lParam.setup = (aEditor) => {
          if (
            aParam.setup &&
            MethodesObjet_1.MethodesObjet.isFunction(aParam.setup)
          ) {
            aParam.setup(aEditor);
          }
          if (
            aEditor &&
            (!aEditor.settings || !aEditor.settings.avecImageDataUri)
          ) {
            aEditor.on(
              'GetContent',
              this.supprimerImageEtVide.bind(this, true),
            );
            aEditor.on(
              'BeforeSetContent',
              this.supprimerImageEtVide.bind(this, false),
            );
          }
          if (this.optionsInitTiny.setupParDefaut) {
            this.optionsInitTiny.setupParDefaut(aEditor);
          }
        };
        if (lParam.clientLourd) {
          lGlobaleTinymce.Env.clientLourd = true;
        }
        if (lParam.filePickerOpener && lParam.filePickerTypes) {
          lParam.file_picker_types = lParam.filePickerTypes;
          lParam.file_picker_callback = function (aCallback, aValue, aMeta) {
            $('.tox-tinymce-aux').hide();
            this.callbackFilePicker = aCallback;
            lParam.filePickerOpener({ value: aValue, meta: aMeta });
          };
          lParam.filePickerReturn = function (aUrl) {
            const lEditor = lGlobaleTinymce.get(this.id);
            if (
              aUrl &&
              lEditor.callbackFilePicker &&
              MethodesObjet_1.MethodesObjet.isFunction(
                lEditor.callbackFilePicker,
              )
            ) {
              lEditor.callbackFilePicker(aUrl);
            }
            lEditor.callbackFilePicker = null;
            $('.tox-tinymce-aux').show();
          };
        }
        await lGlobaleTinymce.init(lParam);
        if (lParam.labelWAI) {
          $(`#${lParam.id.escapeJQ()}`)
            .siblings('.tox-tinymce')
            .find('iframe.tox-edit-area__iframe')
            .attr('title', lParam.labelWAI)
            .attr('aria-label', lParam.labelWAI);
        }
        return lGlobaleTinymce.get(lParam.id);
      }
      get(aId) {
        if (aId && this.globaleTinymce && this.globaleTinymce.get) {
          return this.globaleTinymce.get(aId);
        }
        return null;
      }
      getParametresInitParDefaut(aParam) {
        var _a;
        const lDarkMode =
          (_a =
            ThemesCouleurs_1.ThemesCouleurs === null ||
            ThemesCouleurs_1.ThemesCouleurs === void 0
              ? void 0
              : ThemesCouleurs_1.ThemesCouleurs.getDarkMode) === null ||
          _a === void 0
            ? void 0
            : _a.call(ThemesCouleurs_1.ThemesCouleurs);
        let lOptions = {
          cache_suffix: '?v=5.10.9.index1',
          toolbar_mode: 'wrap',
          mobile: { toolbar_mode: 'sliding' },
          clientLourd: false,
          editeurEquation: false,
          labelWAI: ObjetTraduction_1.GTraductions.getValeur('Tiny.WAITitre'),
          plugins: this.getPlugins(aParam),
          branding: false,
          elementpath: false,
          height: 100,
          min_height: 100,
          max_height: 100,
          skin_url: lDarkMode ? 'skins/ui/oxide-dark' : 'skins/ui/oxide',
          content_css: lDarkMode ? 'dark' : null,
          theme_url: 'themes/silver/theme.min.js',
          menubar: false,
          resize: false,
          statusbar: false,
          toolbar: this.getToolbar(aParam),
          contextmenu:
            !aParam.clientLourd || aParam.toolbar === false
              ? ''
              : 'spellchecker | cut copy paste | link',
          content_style:
            'html {height:100%} body {min-height:calc(100% - 10px);} .mce-content-body {margin:5px;}' +
            '.mce-content-body[data-mce-placeholder]::before {' +
            `color: ${lDarkMode ? '#f6f6f6' : '#6b6e77'} !important;` +
            'opacity: 0.9;' +
            'font-style: italic;' +
            'font-weight: 500;' +
            'content: attr(data-mce-placeholder);' +
            'position: absolute;' +
            `font-size:${IE.estMobile ? 14 : 13}px;` +
            '}',
          force_hex_style_colors: true,
          forced_root_block: 'div',
          forced_root_block_attrs: {
            style:
              'font-family:' +
              (aParam.fontFamily ? aParam.fontFamily : this.fontFamily) +
              ';font-size:' +
              (aParam.fontSize
                ? aParam.fontSize
                : aParam.modeQCM
                  ? this.fontSizeQCM
                  : this.fontSize) +
              'px;',
          },
          font_formats:
            'Andale Mono=andale mono,times;' +
            'Arial=arial,helvetica,sans-serif;' +
            'Arial Black=arial black,avant garde;' +
            'Book Antiqua=book antiqua,palatino;' +
            'Comic Sans MS=comic sans ms,sans-serif;' +
            'Courier New=courier new,courier;' +
            'Georgia=georgia,palatino;' +
            'Helvetica=helvetica;' +
            'Impact=impact,chicago;' +
            'Symbol=symbol;' +
            'Tahoma=tahoma,arial,helvetica,sans-serif;' +
            'Terminal=terminal,monaco;' +
            'Times New Roman=times new roman,times;' +
            'Trebuchet MS=trebuchet ms,geneva;' +
            'Verdana=verdana,geneva;' +
            'Webdings=webdings;' +
            'Wingdings=wingdings,zapf dingbats',
          fontsize_formats:
            '5px 6px 7px 8px 9px 10px 11px 12px 13px 14px 16px 18px 20px 24px',
          browser_spellcheck: !aParam.clientLourd,
          language: this._getLanguage(aParam.langueIndex),
          paste_data_image: false,
          paste_as_text: false,
          paste_enable_default_filters: true,
          paste_filter_drop: true,
          paste_preprocess: function (plugin, args) {
            args.content = args.content.replace(/<\/?pre[^>]*>/gi, '');
          },
          paste_retain_style_properties:
            'padding,margin,margin-left,font-size,font-weight,font-family,font-style,font-variant,border-width,border-style,border,border-color,color,background,background-color,text-align,align,textformat,text-decoration,mso-border-alt,mso-highlight,b,u,i,ul,ol,li',
          spellchecker_languages:
            'anglais=en_US,français=fr_FR,italien=it,espagnol=es',
          spellchecker_rpc_url: 'index_action:DictionnaireIndex',
          spellchecker_wordchar_pattern:
            /[^\s!"#$%&()*+,-.\/:;<=>?@[\]^_{|}`§©«®±¶·¸»¼½¾¿×÷¤”“„    ']+/g,
          assumeExternalTargets: true,
          default_link_target: '_blank',
          target_list: false,
          anchor_bottom: '',
          anchor_top: '',
        };
        if (aParam.placeholder) {
          lOptions.placeholder = aParam.placeholder;
        }
        if (!aParam.clientLourd && !IE.estMobile) {
          lOptions.help_tabs = ['shortcuts'];
        }
        if (IE.DOMPurifyDisabled) {
          lOptions.valid_elements =
            '@[id|class|style|title|dir<ltr?rtl|lang|xml::lang],' +
            'a[rel|rev|charset|hreflang|tabindex|accesskey|type|' +
            'name|href|target|title|class],strong/b,em/i,strike,u,' +
            '#p,-ol[type|compact],-ul[type|compact],-li,br,img[longdesc|usemap|' +
            'src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,' +
            '-blockquote,-table[border=0|cellspacing|cellpadding|width|frame|rules|' +
            'height|align|summary|bgcolor|background|bordercolor],-tr[rowspan|width|' +
            'height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,' +
            '#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor' +
            '|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,#div,' +
            '-span,-code,address,-h1,-h2,-h3,-h4,-h5,-h6,hr[size|noshade],-font[face' +
            '|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],' +
            'object[classid|width|height|codebase|*],param[name|value|_value],embed[type|width' +
            '|height|src|*],map[name],area[shape|coords|href|alt|target],bdo,' +
            'button,col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|' +
            'valign|width],dfn,fieldset,kbd,label[for],legend,noscript,q[cite],samp,small,tt,var,big';
        }
        return lOptions;
      }
      async onLoadEnd(aIdTiny) {
        let lId;
        let lTiny = null;
        if (typeof aIdTiny === 'string') {
          lTiny = this.get(aIdTiny);
          lId = aIdTiny;
        } else if (aIdTiny && aIdTiny.id) {
          lId = aIdTiny.id;
          lTiny = aIdTiny;
        }
        const lParams = { avecConteneurTiny: false, timeout: null, nb: 0 };
        const _onLoadTiny = async () => {
          lParams.timeout = null;
          if (!lParams.avecConteneurTiny) {
            const lJConteneurTiny = $(`#${lId.escapeJQ()}`);
            if (lJConteneurTiny.length > 1) {
              return { ok: false };
            }
            if (lJConteneurTiny.length === 1) {
              lParams.avecConteneurTiny = true;
              lJConteneurTiny.on('destroyed.onload', () => {
                if (lParams.timeout) {
                  clearTimeout(lParams.timeout);
                }
              });
            }
          }
          if (!lTiny) {
            lTiny = this.get(lId);
          }
          if (lTiny && lTiny.initialized) {
            return { ok: true, tiny: lTiny };
          }
          if (lParams.nb > 1000) {
            throw new Error();
          }
          await new Promise((aResolve) => {
            lParams.timeout = setTimeout(() => {
              lParams.nb += 1;
              aResolve();
            }, 10);
          });
          return await _onLoadTiny();
        };
        return await _onLoadTiny();
      }
      async setReadonly(aIdTiny, aReadonly) {
        const lResult = await this.onLoadEnd(aIdTiny);
        if (lResult.tiny) {
          lResult.tiny.mode.set(aReadonly ? 'readonly' : 'design');
        }
      }
      getPlugins(aParam) {
        return this.plugins
          .concat(
            aParam && aParam.plugins && aParam.plugins.length
              ? aParam.plugins
              : [],
            aParam && aParam.editeurEquation === true ? ['iEMathquill'] : [],
            aParam &&
              !!aParam.filePickerOpener &&
              aParam.filePickerTypes.indexOf('image') > -1
              ? ['image']
              : [],
            aParam && aParam.clientLourd === true ? ['spellchecker'] : [],
            aParam && aParam.clientLourd !== true && !IE.estMobile
              ? ['help']
              : [],
          )
          .join(' ');
      }
      getToolbar(aParam) {
        let lToolBar = [];
        if (aParam.toolbar === false) {
          return false;
        }
        if (aParam.buttons && aParam.buttons.length) {
          lToolBar = aParam.buttons.concat(lToolBar);
        }
        if (aParam.modeQCM) {
          lToolBar = lToolBar.concat(this.toolbar_qcm_1);
        } else if (aParam.modeMail) {
          lToolBar = lToolBar.concat(this.toolbar_mail_1);
        } else {
          lToolBar = lToolBar.concat(this.toolbar_std_1);
          lToolBar = lToolBar.concat('|', this.toolbar_std_2);
        }
        if (aParam.editeurEquation === true) {
          lToolBar.push('|ieMathquill');
        }
        if (!!aParam.filePickerOpener && aParam.filePickerTypes) {
          if (aParam.filePickerTypes.indexOf('image') > -1) {
            lToolBar.push('|image');
          }
        }
        if (aParam.clientLourd === true) {
          lToolBar.push('|spellchecker');
        } else if (!IE.estMobile) {
          lToolBar.push('|help');
        }
        return lToolBar.join(' ');
      }
      setHeight(aEditorID, aHeight, aNbrToolbars) {
        ObjetPosition_1.GPosition.setHeight(
          aEditorID + '_ifr',
          aHeight - aNbrToolbars * 28,
        );
        ObjetPosition_1.GPosition.setHeight(aEditorID + '_tbl', aHeight);
      }
      estContenuVide(aHtml) {
        function _estNoeudBR(aNode) {
          return (
            ObjetHtml_1.GHtml.estElement(aNode) &&
            ObjetHtml_1.GHtml.estNoeudDeType(aNode, 'br') &&
            (!aNode.childNodes || aNode.childNodes.length === 0)
          );
        }
        function _estNoeudTexteVide(aNode) {
          return (
            ObjetHtml_1.GHtml.estTextNode(aNode) &&
            aNode.nodeValue &&
            aNode.nodeValue.trim &&
            aNode.nodeValue.trim() === ''
          );
        }
        if (!aHtml) {
          return true;
        }
        let lDOM = ObjetHtml_1.GHtml.htmlToDOM(aHtml);
        let lChaines = [];
        if (!MethodesObjet_1.MethodesObjet.isArray(lDOM)) {
          lChaines = ObjetHtml_1.GHtml.getTextesDeNode(lDOM);
        } else {
          for (let i = 0; i < lDOM.length; i++) {
            lChaines = lChaines.concat(
              ObjetHtml_1.GHtml.getTextesDeNode(lDOM[i]),
            );
          }
        }
        if (lChaines.join('').trim() !== '') {
          return false;
        }
        if (_estNoeudBR(lDOM)) {
          return true;
        }
        if (_estNoeudTexteVide(lDOM)) {
          return true;
        }
        if (
          lDOM &&
          ObjetHtml_1.GHtml.estElement(lDOM) &&
          ObjetHtml_1.GHtml.estNoeudDeType(lDOM, 'div') &&
          lDOM.childNodes &&
          lDOM.childNodes.length === 1
        ) {
          let lFils = lDOM.childNodes[0];
          if (_estNoeudBR(lFils)) {
            return true;
          }
          if (_estNoeudTexteVide(lFils)) {
            return true;
          }
        }
        return false;
      }
      supprimerImageEtVide(aSurGetContent, ed) {
        const lContent = $('<div>' + ed.content + '</div>');
        const lAvecNettoyage = ObjetHtml_1.GHtml.nettoyerEditeurRiche(
          lContent,
          ed.target.settings.editeurEquationMaxFileSize,
        );
        if (
          !aSurGetContent &&
          lAvecNettoyage &&
          this.optionsInitTiny.avecMessageNettoyageHtml
        ) {
          this.optionsInitTiny.afficherMessage(
            this.genreMessage.imageInterdite,
          );
        }
        ed.content = lContent.html();
        if (!ed.selection) {
          if (
            lContent.text().trim() === '' &&
            lContent.find('img').length === 0
          ) {
            ed.content = '';
          }
        }
        const lUnSafeHtml = ed.content;
        if (lUnSafeHtml) {
          if (
            !aSurGetContent &&
            lContent.find('#mce_marker[data-mce-type="bookmark"]').length > 0
          ) {
            return;
          }
          const lSafeHtml = ObjetChaine_1.GChaine.htmlDOMPurify(
            lUnSafeHtml,
            this.optionsInitTiny.optionsDOMPurify,
          );
          if (lUnSafeHtml !== lSafeHtml) {
            ed.content = lSafeHtml;
          }
        }
      }
      async _loadTiny() {
        if (this.globaleTinymce || global.tinymce) {
          this._setupTinymce();
          return;
        }
        await DeferLoadingScript_1.deferLoadingScript.loadAsync(['tiny']);
        if (!global.tinymce) {
          throw new Error();
        }
        this._setupTinymce();
      }
      _setupTinymce() {
        if (!this.globaleTinymce) {
          this.globaleTinymce = global.tinymce;
          if (this.globaleTinymce) {
            this.globaleTinymce.suffix = '.min';
          }
        }
      }
      _detruireInstanceTiny(aTinymce, aID) {
        const lInstanceTiny = aTinymce.get(aID);
        if (lInstanceTiny) {
          if (!lInstanceTiny.initialized) {
            IE.log.addLog(
              'tiny id ' +
                aID +
                " doit etre detruit, mais n'est pas initialized",
            );
          }
          try {
            lInstanceTiny._enCoursDestruction = true;
            $('#' + aID.escapeJQ()).focus();
            try {
              aTinymce.get(aID).destroy();
            } catch (e) {}
            $('#' + aID.escapeJQ()).focus();
          } finally {
            delete lInstanceTiny._enCoursDestruction;
          }
        }
      }
      _getLanguage(aLangueIndex) {
        var _a, _b, _c;
        const lLangue =
          aLangueIndex ||
          ((_c =
            (_b =
              (_a = global.GApplication) === null || _a === void 0
                ? void 0
                : _a.getObjetParametres) === null || _b === void 0
              ? void 0
              : _b.call(_a)) === null || _c === void 0
            ? void 0
            : _c.langue) ||
          'fr';
        switch (lLangue) {
          case 'en':
          case 'it':
          case 'nl':
          case 'es':
            return lLangue;
        }
        return 'fr_FR';
      }
    }
    exports.ObjetTinyInit = ObjetTinyInit;
    exports.TinyInit = new ObjetTinyInit();
  },
  fn: 'tinyinit.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteListeMessagerie = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTri_1 = require('ObjetTri');
    const TypeOrigineCreationEtiquetteMessage_1 = require('TypeOrigineCreationEtiquetteMessage');
    const Enumere_Espace_1 = require('Enumere_Espace');
    class ObjetRequeteListeMessagerie extends ObjetRequeteJSON_1.ObjetRequeteConsultation {
      lancerRequete(aParametres) {
        const lParametres = $.extend({}, aParametres);
        $.extend(this.JSON, lParametres);
        if (!!this.JSON.listeRessources) {
          this.JSON.listeRessources.setSerialisateurJSON({
            ignorerEtatsElements: true,
          });
        }
        return this.appelAsynchrone();
      }
      actionApresRequete() {
        const lTriEtiquette = [
          ObjetTri_1.ObjetTri.init((D) => {
            switch (D.getGenre()) {
              case 1000:
                return -1;
              case TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive:
                return 1;
              case TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon:
                return 2;
              default:
                return 100;
            }
          }),
          ObjetTri_1.ObjetTri.init('Libelle'),
        ];
        this.JSONReponse.listeEtiquettes.setTri(lTriEtiquette).trier();
        for (let I = 0; I < this.JSONReponse.listeMessagerie.count(); I++) {
          const lLigne = this.JSONReponse.listeMessagerie.get(I);
          lLigne.indice = I;
          lLigne.estUneDiscussion = !!lLigne.estUneDiscussion;
          if (lLigne.indicePere >= 0) {
            lLigne.pere = this.JSONReponse.listeMessagerie.get(
              lLigne.indicePere,
            );
            if (lLigne.estUneDiscussion) {
              lLigne.pere.estUnDeploiement = true;
              lLigne.pere.estDeploye = true;
            }
            if (!!lLigne.contexte && !!lLigne.pere && !lLigne.pere.contexte) {
              lLigne.pere.contexte = lLigne.contexte;
            }
          }
          if (this.JSONReponse.listeEtiquettes) {
            if (!lLigne.listeEtiquettes) {
              lLigne.listeEtiquettes =
                new ObjetListeElements_1.ObjetListeElements();
            } else {
              lLigne.listeEtiquettes.parcourir((aEtiquette) => {
                const lTrouve =
                  this.JSONReponse.listeEtiquettes.getElementParNumero(
                    aEtiquette.getNumero(),
                  );
                Object.assign(aEtiquette, lTrouve);
                if (
                  aEtiquette.getGenre() ===
                  TypeOrigineCreationEtiquetteMessage_1
                    .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive
                ) {
                  lLigne.archive = true;
                } else if (
                  aEtiquette.getGenre() ===
                  TypeOrigineCreationEtiquetteMessage_1
                    .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle
                ) {
                  lLigne.poubelle = true;
                }
              });
            }
            lLigne.listeEtiquettes.setTri(lTriEtiquette).trier();
          }
        }
        if (
          GEtatUtilisateur.GenreEspace ===
            Enumere_Espace_1.EGenreEspace.PrimParent ||
          GEtatUtilisateur.GenreEspace ===
            Enumere_Espace_1.EGenreEspace.Mobile_PrimParent
        ) {
          const lFuncChangerNumero = function (aEtiquette, aContexte) {
            if (!!aContexte) {
              aEtiquette.Numero =
                aEtiquette.Numero + '_' + aContexte.getNumero();
            }
          };
          this.JSONReponse.listeEtiquettes.parcourir((D) => {
            if (
              D.getGenre() ===
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison
            ) {
              lFuncChangerNumero(D, D.contexte);
            }
          });
          this.JSONReponse.listeMessagerie.parcourir((aMessage) => {
            if (!!aMessage.listeEtiquettes) {
              aMessage.listeEtiquettes.parcourir((D) => {
                if (
                  D.getGenre() ===
                  TypeOrigineCreationEtiquetteMessage_1
                    .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison
                ) {
                  lFuncChangerNumero(D, aMessage.contexte);
                }
              });
            }
          });
        }
        this.callbackReussite.appel(this.JSONReponse);
      }
    }
    exports.ObjetRequeteListeMessagerie = ObjetRequeteListeMessagerie;
    CollectionRequetes_1.Requetes.inscrire(
      'ListeMessagerie',
      ObjetRequeteListeMessagerie,
    );
  },
  fn: 'objetrequetelistemessagerie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteListeMessages = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const Enumere_Onglet_1 = require('Enumere_Onglet');
    const Invocateur_1 = require('Invocateur');
    class ObjetRequeteListeMessages extends ObjetRequeteJSON_1.ObjetRequeteConsultation {
      lancerRequete(aParametres) {
        const lParametres = $.extend({}, aParametres);
        Object.assign(this.JSON, lParametres);
        this.JSON.marquerCommeLu = aParametres.marquerCommeLu;
        this.JSON.estNonPossede = lParametres.message.estNonPossede;
        lParametres.message.listePossessionsMessages.setSerialisateurJSON({
          ignorerEtatsElements: true,
          nePasTrierPourValidation: true,
          methodeSerialisation: function (aElement) {
            if (aElement.ignorerSerialisation === true) {
              return false;
            }
          },
        });
        this.JSON.listePossessionsMessages =
          lParametres.message.listePossessionsMessages;
        if (
          lParametres.message.estUneDiscussion &&
          lParametres.message.profondeur > 0
        ) {
          this.JSON.estSousDiscussion = true;
        }
        return this.appelAsynchrone();
      }
      actionApresRequete() {
        this.callbackReussite.appel(this.JSONReponse);
        if (this.JSONReponse.nbMarquerLu > 0) {
          Invocateur_1.Invocateur.evenement(
            'modifier_notification_communication',
            Enumere_Onglet_1.EGenreOnglet.Messagerie,
            -this.JSONReponse.nbMarquerLu,
          );
        }
      }
    }
    exports.ObjetRequeteListeMessages = ObjetRequeteListeMessages;
    CollectionRequetes_1.Requetes.inscrire(
      'ListeMessages',
      ObjetRequeteListeMessages,
    );
  },
  fn: 'objetrequetelistemessages.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeChaineHtml = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_ChampsJSON_1 = require('Enumere_ChampsJSON');
    const TypeHttpVariable_1 = require('TypeHttpVariable');
    class TypeChaineHtml {
      constructor(aChaineHtml) {
        this.chaineHtml = MethodesObjet_1.MethodesObjet.isString(aChaineHtml)
          ? aChaineHtml
          : '';
      }
      toJSON() {
        const lJSON = {};
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.type] =
          TypeHttpVariable_1.TypeHttpVariable.TypeHttpHtml;
        lJSON[Enumere_ChampsJSON_1.TypeChampsJSON.valeur] = this.chaineHtml;
        return lJSON;
      }
    }
    exports.TypeChaineHtml = TypeChaineHtml;
  },
  fn: 'typechainehtml.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetRequeteSaisieMessage = void 0;
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const Invocateur_1 = require('Invocateur');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const TypeChaineHtml_1 = require('TypeChaineHtml');
    const TypeGenreDiscussion_1 = require('TypeGenreDiscussion');
    const Toast_1 = require('Toast');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const tag_1 = require('tag');
    class ObjetRequeteSaisieMessage extends ObjetRequeteJSON_1.ObjetRequeteSaisie {
      async lancerRequete(aParam) {
        const lParam = Object.assign({ avecHtml: false }, aParam);
        this.JSON.commande = aParam.commande;
        switch (aParam.commande) {
          case 'viderCorbeille':
          case 'recupererMessageDesactivation':
            break;
          case 'signalement':
          case 'supprimerMessageGraphe':
            this.JSON.message = aParam.message;
            break;
          case 'purger':
            this.JSON.listeMessagesPurge =
              aParam.listeMessagesPurge.setSerialisateurJSON({
                ignorerEtatsElements: true,
              });
            this.JSON.nbMaxMessages = aParam.nbMaxMessages;
            break;
          case 'corbeille':
            this._serialiserlistePossessions(aParam.listePossessionsMessages);
            break;
          case 'entrerSortirConversation':
            this.JSON.possessionMessage = aParam.possessionMessage;
            this.JSON.entrer = aParam.entrer;
            break;
          case 'entrerSortirDiscussion':
            this.JSON.possessionMessage = aParam.possessionMessage;
            this.JSON.estSorti = aParam.estSorti;
            break;
          case 'modificationObjetDiscussion':
            this.JSON.possessionMessage = aParam.possessionMessage;
            this.JSON.objet = aParam.objet;
            break;
          case 'signalementSuppression':
          case 'suppression':
          case 'restauration':
          case 'pourLu':
          case 'archive':
          case 'pourOuvrirFermer':
            this.JSON.lu = aParam.lu;
            this.JSON.archiver = aParam.archiver;
            this.JSON.ouvrir = aParam.ouvrir;
            this._serialiserlistePossessions(
              lParam.message.listePossessionsMessages,
            );
            break;
          default:
            if (aParam.commande === 'brouillon') {
              this.JSON.brouillon = lParam.brouillon;
              if (lParam.brouillon && lParam.brouillon.ignorerPJ) {
                this.JSON.ignorerPJBrouillon = true;
              }
              this._serialiserTransferts(aParam);
            } else if (aParam.commande === 'transfert') {
              this._serialiserTransferts(aParam);
            } else {
              this.JSON.bouton = lParam.bouton;
              this.JSON.estCreationCarnetLiaison =
                lParam.estCreationCarnetLiaison;
              this.JSON.genreDiscussion = lParam.genreDiscussion;
              if (lParam.estCreationCarnetLiaison) {
                this.JSON.eleveCarnetLiaison = lParam.eleveCarnetLiaison;
              }
              if (
                lParam.genreDiscussion ===
                TypeGenreDiscussion_1.TypeGenreDiscussion.GD_Alerte
              ) {
                this.JSON.modeleAlerte = lParam.modeleAlerte;
                this.JSON.estExercice = lParam.estExercice;
              }
              if (lParam.brouillon && lParam.brouillon.existeNumero()) {
                this.JSON.brouillon = lParam.brouillon;
                if (lParam.brouillon.ignorerPJ) {
                  this.JSON.ignorerPJBrouillon = true;
                }
              }
            }
            this.JSON.messagePourReponse = lParam.messagePourReponse;
            this.JSON.objet = lParam.objet;
            if (lParam.avecHtml) {
              this.JSON.contenu = new TypeChaineHtml_1.TypeChaineHtml(
                lParam.contenu,
              );
            } else {
              this.JSON.contenu = lParam.contenu;
            }
            this.JSON.listeDestinataires = lParam.listeDestinataires;
            if (lParam.listeEtiquettes) {
              this.JSON.listeEtiquettes =
                lParam.listeEtiquettes.setSerialisateurJSON({
                  ignorerEtatsElements: true,
                });
            }
            if (lParam.listeFichiers) {
              this.JSON.listeFichiers =
                lParam.listeFichiers.setSerialisateurJSON({
                  methodeSerialisation: this._surValidationFichier,
                });
            }
        }
        Invocateur_1.Invocateur.evenement(
          'requeteSaisieMessage',
          false,
          this.callbackReussite.pere,
        );
        const lParams = await this.appelAsynchrone();
        return this._afficherMessagesSaisie(lParams);
      }
      actionApresRequete(aGenreReponse) {
        super.actionApresRequete(aGenreReponse);
        if (
          aGenreReponse === ObjetRequeteJSON_1.EGenreReponseSaisie.succes &&
          this.JSON
        ) {
          const lMessage = this._getMessageToast();
          if (lMessage) {
            Toast_1.Toast.afficher({
              type: Toast_1.ETypeToast.succes,
              msg: lMessage,
            });
          }
        }
      }
      apresReponseRequete() {
        Invocateur_1.Invocateur.evenement(
          'requeteSaisieMessage',
          true,
          this.callbackReussite.pere,
          this.JSONRapportSaisie,
        );
      }
      _serialiserlistePossessions(aListe) {
        aListe.setSerialisateurJSON({
          ignorerEtatsElements: true,
          nePasTrierPourValidation: true,
        });
        this.JSON.listePossessionsMessages = aListe;
      }
      _getMessageToast() {
        switch (this.JSON.commande) {
          case 'corbeille':
            return ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.ToastCorbeille',
            );
          case 'viderCorbeille':
          case 'suppression':
            return ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.ToastSuppression',
            );
          case 'archive':
            return this.JSON.archiver
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.ToastArchivage',
                )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.ToastDesarchivage',
                );
          case 'pourOuvrirFermer':
            return this.JSON.ouvrir
              ? ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.ToastReouverture',
                )
              : ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.ToastFermeture',
                );
          case 'signalement':
            return ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.ToastSignalement',
            );
          case 'signalementSuppression':
            return ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.ToastDemandeSuppression',
            );
        }
        if (this.JSONRapportSaisie && this.JSONRapportSaisie.messageToast) {
          return this.JSONRapportSaisie.messageToast;
        }
        return '';
      }
      async _afficherMessagesSaisie(aParams) {
        if (aParams.JSONRapportSaisie && aParams.JSONRapportSaisie.EDTMessage) {
          await GApplication.getMessage().afficher({
            message: aParams.JSONRapportSaisie.EDTMessage,
          });
        }
        if (
          aParams.JSONRapportSaisie &&
          aParams.JSONRapportSaisie.listeMessagesDesactivation &&
          aParams.JSONRapportSaisie.listeMessagesDesactivation.length > 0
        ) {
          const H = [];
          aParams.JSONRapportSaisie.listeMessagesDesactivation.forEach(
            (aMess) => {
              H.push(
                '<div style="font-weight:600">' + aMess.titre + '</div>',
                '<div style="padding: 5px; font-style: italic">«' +
                  aMess.message +
                  '»</div>',
              );
            },
          );
          await GApplication.getMessage().afficher({ message: H.join('<br>') });
        }
        if (
          aParams.JSONRapportSaisie &&
          aParams.JSONRapportSaisie.messageRefusDest
        ) {
          await GApplication.getMessage().afficher({
            message:
              (0, tag_1.tag)(
                'div',
                aParams.JSONRapportSaisie.messageRefusDest.titre,
              ) +
              (0, tag_1.tag)('br') +
              (0, tag_1.tag)(
                'div',
                aParams.JSONRapportSaisie.messageRefusDest.message,
              ),
          });
        }
        return aParams;
      }
      _serialiserTransferts(aParam) {
        this.JSON.listeMessagesTransfert = aParam.listeMessagesTransfert;
        if (this.JSON.listeMessagesTransfert) {
          this.JSON.listeMessagesTransfert.setSerialisateurJSON({
            ignorerEtatsElements: true,
            nePasTrierPourValidation: true,
          });
        }
      }
      _surValidationFichier(aElement, aJSON) {
        const lIdFichier =
          aElement.idFichier !== undefined
            ? aElement.idFichier
            : aElement.Fichier !== undefined
              ? aElement.Fichier.idFichier
              : null;
        if (lIdFichier !== null) {
          aJSON.idFichier = '' + lIdFichier;
        }
        aJSON.nomFichier = aElement.nomFichier;
        aJSON.url = aElement.url;
      }
    }
    exports.ObjetRequeteSaisieMessage = ObjetRequeteSaisieMessage;
    CollectionRequetes_1.Requetes.inscrire(
      'SaisieMessage',
      ObjetRequeteSaisieMessage,
    );
  },
  fn: 'objetrequetesaisiemessage.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeCommandeMessagerie = void 0;
    var TypeCommandeMessagerie;
    (function (TypeCommandeMessagerie) {
      TypeCommandeMessagerie['lu'] = 'lu';
      TypeCommandeMessagerie['nonLu'] = 'nonLu';
      TypeCommandeMessagerie['supprimer'] = 'supprimer';
      TypeCommandeMessagerie['archiver'] = 'archiver';
      TypeCommandeMessagerie['desarchiver'] = 'desarchiver';
      TypeCommandeMessagerie['transferer'] = 'transferer';
      TypeCommandeMessagerie['signaler'] = 'signaler';
      TypeCommandeMessagerie['modifierCategories'] = 'modifierCategories';
      TypeCommandeMessagerie['fermerDiscussion'] = 'fermerDiscussion';
      TypeCommandeMessagerie['ouvrirDiscussion'] = 'ouvrirDiscussion';
      TypeCommandeMessagerie['signalerSuppression'] = 'signalerSuppression';
      TypeCommandeMessagerie['corbeille'] = 'corbeille';
      TypeCommandeMessagerie['restaurer'] = 'restaurer';
      TypeCommandeMessagerie['plus'] = 'plus';
      TypeCommandeMessagerie['purger'] = 'purger';
      TypeCommandeMessagerie['discussionEnFenetre'] = 'discussionEnFenetre';
      TypeCommandeMessagerie['entrerSortirDiscussion'] =
        'entrerSortirDiscussion';
      TypeCommandeMessagerie['modificationObjetDiscussion'] =
        'modificationObjetDiscussion';
      TypeCommandeMessagerie['afficherDestinataires'] = 'afficherDestinataires';
      TypeCommandeMessagerie['copierContenuVisu'] = 'copierContenuVisu';
      TypeCommandeMessagerie['repondreMessage'] = 'repondreMessage';
      TypeCommandeMessagerie['afficherDiscussion'] = 'afficherDiscussion';
    })(
      TypeCommandeMessagerie ||
        (exports.TypeCommandeMessagerie = TypeCommandeMessagerie = {}),
    );
  },
  fn: 'typecommandemessagerie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetMenuCtxMixte = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetMenuContextuel_1 = require('ObjetMenuContextuel');
    const Enumere_MenuCtxModeMixte_1 = require('Enumere_MenuCtxModeMixte');
    const ObjetHtml_1 = require('ObjetHtml');
    const IEZoneFenetre_1 = require('IEZoneFenetre');
    const ObjetPosition_1 = require('ObjetPosition');
    const ObjetTraduction_1 = require('ObjetTraduction');
    require('ObjetMenuCtxMixte.css');
    class ObjetMenuCtxMixte extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.menuContextuel = ObjetIdentite_1.Identite.creerInstance(
          ObjetMenuContextuel_1.ObjetMenuContextuel,
          { pere: this },
        );
        IEZoneFenetre_1.ZoneFenetre.ajouterFenetre(
          this.menuContextuel.getNom(),
        );
        this.menuContextuel.setOptions({ estModeMixte: true });
        this.setOptions({
          callbackAddCommandes: null,
          avecBoutonEllipsis: true,
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          cmdMenuCtxMixte: {
            event: function (aGenre, aIndex) {
              const lCmd = aInstance._getListeCmdDeGenre(aGenre).get(aIndex);
              if (
                lCmd &&
                MethodesObjet_1.MethodesObjet.isFunction(
                  lCmd.callbackValidation,
                )
              ) {
                lCmd.callbackValidation.call(aInstance.Pere || aInstance, lCmd);
              } else {
                aInstance.callback.appel(lCmd);
              }
            },
            getDisabled: function (aGenre, aIndex) {
              const lCmd = aInstance._getListeCmdDeGenre(aGenre).get(aIndex);
              return !lCmd.actif;
            },
          },
          cmdEllipsis: {
            event: function () {
              const lPosBtn = ObjetPosition_1.GPosition.getClientRect(
                this.node,
              );
              aInstance.menuContextuel.afficher({
                x: lPosBtn.left,
                y: lPosBtn.bottom + 10,
              });
            },
            getDisabled: function () {
              return false;
            },
          },
        });
      }
      construireAffichage() {
        if (
          this.options.callbackAddCommandes &&
          MethodesObjet_1.MethodesObjet.isFunction(
            this.options.callbackAddCommandes,
          )
        ) {
          this.menuContextuel.vider();
          this.options.callbackAddCommandes(this.menuContextuel);
        }
        const lListeBtn = this._getListeCmdDeGenre(
          Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.bouton,
        );
        const lListeIcones = this._getListeCmdDeGenre(
          Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.icon,
        );
        const lListeEllipsis = this._getListeCmdDeGenre(
          Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.ellipsis,
        );
        const H = [];
        H.push('<div class="ObjetMenuCtxMixte">');
        lListeBtn.parcourir((D, aIndex) => {
          H.push(
            '<ie-bouton ',
            ObjetHtml_1.GHtml.composeAttr('ie-model', 'cmdMenuCtxMixte', [
              Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.bouton,
              aIndex,
            ]),
            ' class="eltBouton themeBoutonPrimaire">',
            D.getLibelle(),
            '</ie-bouton>',
          );
        });
        lListeIcones.parcourir((D, aIndex) => {
          H.push(
            '<ie-btnicon ',
            ObjetHtml_1.GHtml.composeAttr('ie-model', 'cmdMenuCtxMixte', [
              Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.icon,
              aIndex,
            ]),
            ' class="avecFond ',
            D.icon,
            '" title="',
            D.getLibelle(),
            '"></ie-btnicon>',
          );
        });
        if (lListeEllipsis.count() > 0 && this.options.avecBoutonEllipsis) {
          H.push(
            IE.jsx.str('ie-btnicon', {
              'ie-model': 'cmdEllipsis',
              class: 'icon_ellipsis_vertical',
              title:
                ObjetTraduction_1.GTraductions.getValeur('liste.BtnAction'),
            }),
          );
        }
        H.push('</div>');
        return H.join('');
      }
      actualiser() {
        return this.afficher();
      }
      _getListeCmdDeGenre(aGenre) {
        return this.menuContextuel.getListeLignes().getListeElements((D) => {
          if (
            aGenre === Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.ellipsis
          ) {
            return (
              D.typeAffEnModeMixte !==
              Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.bouton
            );
          }
          return D.typeAffEnModeMixte === aGenre;
        });
      }
    }
    exports.ObjetMenuCtxMixte = ObjetMenuCtxMixte;
  },
  fn: 'objetmenuctxmixte.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ETypeSwitch =
      exports.EGenreDestinataire =
      exports.EListeIds =
      exports.EGenreTelephone =
      exports.EGenreTypeContenu =
      exports.TypeFiltreAffichage =
        void 0;
    var TypeFiltreAffichage;
    (function (TypeFiltreAffichage) {
      TypeFiltreAffichage['securisation'] = 'securisation';
      TypeFiltreAffichage['coords'] = 'coords';
      TypeFiltreAffichage['communication'] = 'communication';
      TypeFiltreAffichage['notification'] = 'notification';
      TypeFiltreAffichage['droitImage'] = 'droitImage';
      TypeFiltreAffichage['signature'] = 'signature';
      TypeFiltreAffichage['autorisationSortie'] = 'autorisationSortie';
      TypeFiltreAffichage['documentsAFournir'] = 'documentsAFournir';
      TypeFiltreAffichage['autresContacts'] = 'autresContacts';
      TypeFiltreAffichage['profilPrimEnfant'] = 'profilPrimEnfant';
      TypeFiltreAffichage['parametres'] = 'parametres';
      TypeFiltreAffichage['style'] = 'style';
      TypeFiltreAffichage['deconnexion'] = 'deconnexion';
      TypeFiltreAffichage['cahierDeTexte'] = 'cahierDeTexte';
      TypeFiltreAffichage['generalites'] = 'generalites';
      TypeFiltreAffichage['interTitre'] = 'interTitre';
      TypeFiltreAffichage['messagerieSignature'] = 'messagerieSignature';
      TypeFiltreAffichage['iCal'] = 'calendrierICal';
    })(
      TypeFiltreAffichage ||
        (exports.TypeFiltreAffichage = TypeFiltreAffichage = {}),
    );
    var EGenreTypeContenu;
    (function (EGenreTypeContenu) {
      EGenreTypeContenu[(EGenreTypeContenu['Notifications'] = 0)] =
        'Notifications';
      EGenreTypeContenu[(EGenreTypeContenu['Autorisations'] = 1)] =
        'Autorisations';
      EGenreTypeContenu[(EGenreTypeContenu['DroitImage'] = 2)] = 'DroitImage';
      EGenreTypeContenu[(EGenreTypeContenu['DerniereConnexion'] = 3)] =
        'DerniereConnexion';
      EGenreTypeContenu[(EGenreTypeContenu['MotDePasse'] = 4)] = 'MotDePasse';
      EGenreTypeContenu[(EGenreTypeContenu['Identifiant'] = 5)] = 'Identifiant';
      EGenreTypeContenu[(EGenreTypeContenu['Informations'] = 6)] =
        'Informations';
      EGenreTypeContenu[(EGenreTypeContenu['InfosCompteEnfant'] = 7)] =
        'InfosCompteEnfant';
      EGenreTypeContenu[(EGenreTypeContenu['INE'] = 8)] = 'INE';
      EGenreTypeContenu[(EGenreTypeContenu['AutorisationSortie'] = 9)] =
        'AutorisationSortie';
      EGenreTypeContenu[(EGenreTypeContenu['ProjetsAccompagnement'] = 10)] =
        'ProjetsAccompagnement';
      EGenreTypeContenu[(EGenreTypeContenu['__InformationsMedicales'] = 11)] =
        '__InformationsMedicales';
      EGenreTypeContenu[
        (EGenreTypeContenu['__RestrictionsAlimentaires'] = 12)
      ] = '__RestrictionsAlimentaires';
      EGenreTypeContenu[(EGenreTypeContenu['Coordonnees'] = 13)] =
        'Coordonnees';
      EGenreTypeContenu[(EGenreTypeContenu['PreferencesContact'] = 14)] =
        'PreferencesContact';
      EGenreTypeContenu[
        (EGenreTypeContenu['AutorisationsSupplementaires'] = 15)
      ] = 'AutorisationsSupplementaires';
      EGenreTypeContenu[(EGenreTypeContenu['AutorisationsMessages'] = 17)] =
        'AutorisationsMessages';
      EGenreTypeContenu[(EGenreTypeContenu['DepotDocuments'] = 18)] =
        'DepotDocuments';
      EGenreTypeContenu[(EGenreTypeContenu['CommunicationParents'] = 19)] =
        'CommunicationParents';
      EGenreTypeContenu[
        (EGenreTypeContenu['ContenuCommunicationParents'] = 20)
      ] = 'ContenuCommunicationParents';
      EGenreTypeContenu[(EGenreTypeContenu['Medecin'] = 21)] = 'Medecin';
      EGenreTypeContenu[(EGenreTypeContenu['Allergies'] = 22)] = 'Allergies';
      EGenreTypeContenu['sourcesConnexions'] = 'sourcesConnexions';
      EGenreTypeContenu['Signature'] = 'signature';
      EGenreTypeContenu['Accessibilite'] = 'Accessibilite';
      EGenreTypeContenu['Personnalisation'] = 'Personnalisation';
      EGenreTypeContenu['CahierDeTexte'] = 'CahierDeTexte';
      EGenreTypeContenu['Deconnexion'] = 'Deconnexion';
      EGenreTypeContenu['Generalites'] = 'Generalites';
      EGenreTypeContenu['messagerieSignature'] = 'messagerieSignature';
      EGenreTypeContenu['iCal'] = 'CalendrierICal';
    })(
      EGenreTypeContenu || (exports.EGenreTypeContenu = EGenreTypeContenu = {}),
    );
    var EGenreTelephone;
    (function (EGenreTelephone) {
      EGenreTelephone[(EGenreTelephone['mail'] = 1)] = 'mail';
      EGenreTelephone[(EGenreTelephone['telFixe'] = 2)] = 'telFixe';
      EGenreTelephone[(EGenreTelephone['telPort'] = 3)] = 'telPort';
      EGenreTelephone[(EGenreTelephone['fax'] = 4)] = 'fax';
    })(EGenreTelephone || (exports.EGenreTelephone = EGenreTelephone = {}));
    var EListeIds;
    (function (EListeIds) {
      EListeIds['identifiant'] = '_ident';
      EListeIds['mdp'] = '_mdp';
      EListeIds['email'] = '_email';
      EListeIds['cbSMS'] = 'cbSMS';
      EListeIds['cbMail'] = 'cbMail';
      EListeIds['cbMailEtab'] = 'cbMailEtab';
      EListeIds['cbParent'] = 'cbParent';
      EListeIds['cbCourrier'] = 'cbCourrier';
      EListeIds['cbMsgParent'] = 'cbMsgParent';
      EListeIds['cbMsgEleve'] = 'cbMsgEleve';
      EListeIds['cbMsgProfsPerso'] = 'cbMsgProfsPerso';
      EListeIds['cbMsgContactVS'] = 'cbMsgContactVS';
      EListeIds['cbNotifs'] = 'cbNotif';
      EListeIds['comboDelai'] = 'comboNotif';
      EListeIds['cbNotifsTravaux'] = 'cbNotifTravaux';
      EListeIds['comboDelaiTravaux'] = 'comboNotifTravaux';
      EListeIds['cbDroitImage'] = 'cbDroitImage';
      EListeIds['cbExposerDossierMedical'] = 'cbExposerDosierMedical';
      EListeIds['cbAutoriserHospitalisation'] = 'cbAutoriserHospitalisation';
      EListeIds['cbAutoriserAllergies'] = 'cbAutoriserAllergies';
      EListeIds['cbDestinataireBulletin'] = 'cbDestinataireBulletin';
      EListeIds['cbDestinataireInfosEleve'] = 'cbDestinataireInfosEleve';
      EListeIds['cbDestinataireInfosProf'] = 'cbDestinataireInfosProf';
      EListeIds['cbDestinataireInfosGen'] = 'cbDestinataireInfosGen';
      EListeIds['mdpEnfant'] = 'mdp_enfant';
      EListeIds['sideNav'] = '_idSideNav';
      EListeIds['sideInterlocuteurs'] = '_idSideNavInterlocuteurs';
      EListeIds['sidePreferences'] = '_idSideNavPreferences';
      EListeIds['sideInformations'] = '_idSideNavInformations';
      EListeIds['sideCommunicationParents'] = 'idsideCommunicationParents';
      EListeIds['autoriserSignature'] = 'idAutoriserSignature';
      EListeIds['bntAjouterSignature'] = 'idBtnAjoutSignature';
      EListeIds['cbAcceptDemandeRdv'] = 'cbAcceptDemandeRdv';
    })(EListeIds || (exports.EListeIds = EListeIds = {}));
    var EGenreDestinataire;
    (function (EGenreDestinataire) {
      EGenreDestinataire[(EGenreDestinataire['SMS'] = 1)] = 'SMS';
      EGenreDestinataire[(EGenreDestinataire['Email'] = 2)] = 'Email';
      EGenreDestinataire[(EGenreDestinataire['Courrier'] = 3)] = 'Courrier';
    })(
      EGenreDestinataire ||
        (exports.EGenreDestinataire = EGenreDestinataire = {}),
    );
    var ETypeSwitch;
    (function (ETypeSwitch) {
      ETypeSwitch[(ETypeSwitch['Bulletin'] = 1)] = 'Bulletin';
      ETypeSwitch[(ETypeSwitch['InfosEleve'] = 2)] = 'InfosEleve';
      ETypeSwitch[(ETypeSwitch['InfosProfesseur'] = 3)] = 'InfosProfesseur';
      ETypeSwitch[(ETypeSwitch['InfosGenerales'] = 4)] = 'InfosGenerales';
    })(ETypeSwitch || (exports.ETypeSwitch = ETypeSwitch = {}));
  },
  fn: 'enumere_donneespersonnelles.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.MoteurMessagerie = void 0;
    const UtilitaireMessagerie_1 = require('UtilitaireMessagerie');
    const ObjetDroitsPN_1 = require('ObjetDroitsPN');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const ObjetElement_1 = require('ObjetElement');
    const TypeOrigineCreationEtiquetteMessage_1 = require('TypeOrigineCreationEtiquetteMessage');
    const ObjetTri_1 = require('ObjetTri');
    const ObjetRequeteListeMessagerie_1 = require('ObjetRequeteListeMessagerie');
    const ObjetRequeteListeMessages_1 = require('ObjetRequeteListeMessages');
    const ObjetRequeteSaisieMessage_1 = require('ObjetRequeteSaisieMessage');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const Enumere_Action_1 = require('Enumere_Action');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_TriElement_1 = require('Enumere_TriElement');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_EvenementObjetSaisie_1 = require('Enumere_EvenementObjetSaisie');
    const ObjetDate_1 = require('ObjetDate');
    const tag_1 = require('tag');
    const Invocateur_1 = require('Invocateur');
    const Enumere_Onglet_1 = require('Enumere_Onglet');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const TypeCommandeMessagerie_1 = require('TypeCommandeMessagerie');
    const Enumere_MenuCtxModeMixte_1 = require('Enumere_MenuCtxModeMixte');
    const TypeGenreDiscussion_1 = require('TypeGenreDiscussion');
    const ObjetFenetre_ListeCategoriesDiscussion = require('ObjetFenetre_ListeCategoriesDiscussion');
    const ToucheClavier_1 = require('ToucheClavier');
    const ObjetMenuCtxMixte_1 = require('ObjetMenuCtxMixte');
    const ObjetListe_1 = require('ObjetListe');
    const Enumere_DonneesPersonnelles_1 = require('Enumere_DonneesPersonnelles');
    let uFenetreAvertissementASignaler = null;
    let uFenetreAvertissement = null;
    class MoteurMessagerie {
      constructor() {
        this.applicationSco = GApplication;
        this.options = {
          instance: null,
          avecCategoriesListeEtiquettes: true,
          estChat: false,
          discussionSelectionneeUniquementVisible: false,
          estDiscussionCommune: false,
          avecFiltreNonLues: false,
          avecTiny:
            UtilitaireMessagerie_1.UtilitaireMessagerie.avecEditeurTiny(),
          callbackBrouillonAvantSaisie: null,
          callbackAvantSaisie: null,
          callbackApresSaisie: function () {},
        };
        this.donneesListeMessagerie = {};
      }
      setOptions(aOptions) {
        Object.assign(this.options, aOptions);
        return this;
      }
      async requeteListeMessagerie(aDonnees) {
        const lReponse =
          await new ObjetRequeteListeMessagerie_1.ObjetRequeteListeMessagerie(
            this.options.instance,
          ).lancerRequete(aDonnees);
        this.donneesListeMessagerie = lReponse;
        this._traiterListeEtiquette(
          this.donneesListeMessagerie.listeEtiquettes,
          this.options.avecCategoriesListeEtiquettes,
        );
        return this.donneesListeMessagerie;
      }
      async requeteMessagesVisu(aDonnees) {
        const lDonnees = Object.assign(
          { message: null, marquerCommeLu: false, nbMessagesVus: undefined },
          aDonnees,
        );
        if (!lDonnees.message) {
          return Promise.reject();
        }
        const lReponse =
          await new ObjetRequeteListeMessages_1.ObjetRequeteListeMessages(
            this.options.instance,
          ).lancerRequete(lDonnees);
        if (lReponse.listeBoutons) {
          lReponse.listeBoutons
            .setTri([
              ObjetTri_1.ObjetTri.init(
                'Genre',
                Enumere_TriElement_1.EGenreTriElement.Decroissant,
              ),
            ])
            .trier();
        }
        return lReponse;
      }
      requeteSaisieMessage(
        aMessage,
        aAvecSauvegardeBrouillon,
        aParamsCallbackApresSaisie,
      ) {
        if (!this.options.instance) {
          return Promise.reject();
        }
        return Promise.resolve()
          .then(() => {
            if (
              aAvecSauvegardeBrouillon &&
              this.options.callbackBrouillonAvantSaisie
            ) {
              return this.options.callbackBrouillonAvantSaisie(
                aAvecSauvegardeBrouillon,
              );
            }
          })
          .then(() => {
            if (aMessage) {
              return this._controleUtilisateurDansDestinataires(aMessage)
                .then(() => {
                  let lListeFichiers =
                    aMessage.listeFichiers ||
                    new ObjetListeElements_1.ObjetListeElements();
                  if (
                    !lListeFichiers &&
                    aMessage.brouillon &&
                    aMessage.brouillon.listeFichiers
                  ) {
                    lListeFichiers = aMessage.brouillon.listeFichiers;
                  }
                  aMessage.avecHtml =
                    UtilitaireMessagerie_1.UtilitaireMessagerie.avecEditionHtmlMessage();
                  if (
                    aMessage.avecHtml &&
                    aMessage.contenu &&
                    !IE.estMobile &&
                    !this.options.avecTiny
                  ) {
                    aMessage.contenu = ObjetChaine_1.GChaine.replaceRCToHTML(
                      aMessage.contenu,
                    );
                  }
                  if (this.options.callbackAvantSaisie) {
                    this.options.callbackAvantSaisie();
                  }
                  return new ObjetRequeteSaisieMessage_1.ObjetRequeteSaisieMessage(
                    this.options.instance,
                  )
                    .addUpload({
                      listeFichiers: lListeFichiers,
                      listeDJCloud: lListeFichiers,
                    })
                    .lancerRequete(aMessage)
                    .then(() => {
                      if (aParamsCallbackApresSaisie) {
                        return this.options.callbackApresSaisie(
                          aParamsCallbackApresSaisie,
                        );
                      }
                    })
                    .then(() => {
                      return { saisieMessageOK: true };
                    });
                })
                .catch(() => {});
            } else {
              return Promise.reject();
            }
          });
      }
      saisieViderCorbeille(aNbMessages) {
        this.applicationSco
          .getMessage()
          .afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
            message: ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.Menu_ConfirmationViderCorbeille',
              [aNbMessages],
            ),
          })
          .then((aGenreAction) => {
            if (aGenreAction === Enumere_Action_1.EGenreAction.Valider) {
              return this.requeteSaisieMessage(
                { commande: 'viderCorbeille' },
                true,
                MoteurMessagerie.TypeApresSaisieMessage.vider,
              );
            }
          });
      }
      saisieBrouillon(aBrouillon, aMessagePourReponse) {
        return this.requeteSaisieMessage({
          commande: 'brouillon',
          brouillon: aBrouillon,
          messagePourReponse: aMessagePourReponse,
          objet: aBrouillon.objet,
          contenu: aBrouillon.contenu,
          listeDestinataires: aBrouillon.listeDestinataires,
          listeFichiers: aBrouillon.listeFichiers,
        });
      }
      supprimerBrouillonConfirmationPromise(aBrouillon) {
        const lMessage = MethodesObjet_1.MethodesObjet.dupliquer(aBrouillon);
        lMessage.listePossessionsMessages =
          new ObjetListeElements_1.ObjetListeElements();
        lMessage.listePossessionsMessages.addElement(
          MethodesObjet_1.MethodesObjet.dupliquer(aBrouillon),
        );
        return this.applicationSco
          .getMessage()
          .afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
            message: ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.ConfirmationSupressionBrouillon',
            ),
          })
          .then((aAccepte) => {
            if (aAccepte === Enumere_Action_1.EGenreAction.Valider) {
              return this.requeteSaisieMessage({
                commande: 'suppression',
                message: lMessage,
              });
            }
          });
      }
      sauvegarderCreationBrouillon(aMessage) {
        if (
          this.avecSauvegardeBrouillonAutorise() &&
          this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionAvancee,
          ) &&
          ((aMessage.listeDestinataires &&
            aMessage.listeDestinataires.count() > 0) ||
            aMessage.contenu ||
            (!aMessage.listeMessagesTransfert && aMessage.objet) ||
            (aMessage.listeFichiers && aMessage.listeFichiers.count() > 0))
        ) {
          return this.applicationSco
            .getMessage()
            .afficher({
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
              message: ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.ConfirmationEnregistrerBrouillon',
              ),
            })
            .then((aAccepte) => {
              if (aAccepte === Enumere_Action_1.EGenreAction.Valider) {
                return this.requeteSaisieMessage({
                  commande: aMessage.listeMessagesTransfert
                    ? 'transfert'
                    : 'brouillon',
                  brouillon: null,
                  messagePourReponse: null,
                  objet: aMessage.objet,
                  contenu: aMessage.contenu,
                  listeDestinataires: aMessage.listeDestinataires,
                  listeMessagesTransfert: aMessage.listeMessagesTransfert,
                  listeFichiers: aMessage.listeFichiers,
                });
              }
            });
        } else {
          return Promise.resolve();
        }
      }
      avecSauvegardeBrouillonAutorise() {
        return (
          !this.options.estChat &&
          !this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.estEnConsultation,
          )
        );
      }
      autoriserAjoutPJ() {
        return (
          !this.options.estChat &&
          UtilitaireMessagerie_1.UtilitaireMessagerie.avecAjoutPieceJointeMessage()
        );
      }
      avecIconeAvertissementListeMessagerie() {
        const lResult = this._avecAvertissementListeMessagerie();
        if (lResult) {
          if (uFenetreAvertissementASignaler === null) {
            uFenetreAvertissementASignaler = true;
          }
        }
        return lResult;
      }
      ouvrirFenetreAvertissement(aSurInitialisation) {
        if (
          aSurInitialisation &&
          !uFenetreAvertissementASignaler &&
          !uFenetreAvertissement
        ) {
          return;
        }
        if (uFenetreAvertissement) {
          uFenetreAvertissement.fermer();
          uFenetreAvertissement = null;
        }
        if (!this._avecAvertissementListeMessagerie()) {
          return;
        }
        uFenetreAvertissementASignaler = false;
        uFenetreAvertissement =
          ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
            ObjetFenetre_1.ObjetFenetre,
            { pere: this.options.instance },
            {
              largeur: 500,
              modale: false,
              cssFenetre: 'fenetre-messagerie-avertissement',
              titre:
                (0, tag_1.tag)('i', { class: 'icon_warning_sign' }) +
                ' ' +
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.TitreFenetreAvertissement',
                ),
              listeBoutons: [
                ObjetTraduction_1.GTraductions.getValeur('Fermer'),
              ],
              callbackFermer: function () {
                uFenetreAvertissement = null;
              },
              identConservationCoordonnees: 'FenetreAvertissMotMess',
            },
          );
        uFenetreAvertissement.afficher(this._construirePanelAvertissement());
      }
      addCommandesMenuContextuelDiscussion(aParams) {
        const lParams = Object.assign(
          {
            moteur: this,
            message: null,
            listeMessages: null,
            listeMessagerie: this.donneesListeMessagerie.listeMessagerie,
            listeEtiquettes: this.donneesListeMessagerie.listeEtiquettes,
            menuContextuel: null,
            strSuperAdministrateurs:
              this.donneesListeMessagerie.strSuperAdministrateurs,
            callback: null,
            avecListeDestinataires: IE.estMobile,
            avecCommandes: true,
          },
          aParams,
        );
        if (lParams.avecListeDestinataires) {
          const lMessage =
            aParams.message.messagePourParticipants ||
            aParams.message.messagePourReponse;
          if (
            lMessage &&
            !this.applicationSco.droits.get(
              ObjetDroitsPN_1.TypeDroits.estEnConsultation,
            ) &&
            !this.applicationSco.droits.get(
              ObjetDroitsPN_1.TypeDroits.communication.discussionInterdit,
            )
          ) {
            this._addCommandeMenuContextuel(
              Object.assign(
                {
                  genre:
                    TypeCommandeMessagerie_1.TypeCommandeMessagerie
                      .afficherDestinataires,
                  numeroMessage: lMessage.getNumero(),
                  estPublicParticipant: false,
                  estDestinatairesReponse: true,
                },
                lParams,
              ),
            );
            lParams.menuContextuel.avecSeparateurSurSuivant();
          }
        }
        if (!lParams.avecCommandes) {
          return;
        }
        this._addCommandeMenuContextuel(
          Object.assign(
            { genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.lu },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            { genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.nonLu },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            { genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.archiver },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie.desarchiver,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.transferer,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .modifierCategories,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .discussionEnFenetre,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .modificationObjetDiscussion,
            },
            lParams,
          ),
        );
        lParams.menuContextuel.avecSeparateurSurSuivant();
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .fermerDiscussion,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .ouvrirDiscussion,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.restaurer,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.corbeille,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            { genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.purger },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.supprimer,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .entrerSortirDiscussion,
            },
            lParams,
          ),
        );
        lParams.menuContextuel.avecSeparateurSurSuivant();
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .signalerSuppression,
            },
            lParams,
          ),
        );
      }
      addCommandesMenuContextuelVisuMessage(aParams) {
        const lParams = Object.assign(
          {
            moteur: this,
            messageListeSelection: null,
            messageVisu: null,
            listeMessages:
              new ObjetListeElements_1.ObjetListeElements().addElement(
                aParams.messageVisu,
              ),
            elementCibleCopie: null,
            listeMessagerie: this.donneesListeMessagerie.listeMessagerie,
            listeEtiquettes: this.donneesListeMessagerie.listeEtiquettes,
            menuContextuel: null,
            strSuperAdministrateurs:
              this.donneesListeMessagerie.strSuperAdministrateurs,
            callback: null,
            avecListeDestinataires: IE.estMobile,
          },
          aParams,
        );
        if (!lParams.messageVisu || !lParams.listeMessagerie) {
          return;
        }
        lParams.indiceListeMessagerie =
          UtilitaireMessagerie_1.UtilitaireMessagerie.getIndiceDiscussionDeMessageVisu(
            lParams.listeMessagerie,
            lParams.messageVisu,
          );
        lParams.message = lParams.listeMessagerie.get(
          lParams.indiceListeMessagerie,
        );
        if (!lParams.message) {
          return;
        }
        if (lParams.avecListeDestinataires && lParams.messageVisu) {
          this._addCommandeMenuContextuel(
            Object.assign(
              {
                genre:
                  TypeCommandeMessagerie_1.TypeCommandeMessagerie
                    .afficherDestinataires,
                numeroMessage: lParams.messageVisu.getNumero(),
                estPublicParticipant: false,
                estDestinatairesReponse: false,
              },
              lParams,
            ),
          );
          lParams.menuContextuel.avecSeparateurSurSuivant();
        }
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .afficherDiscussion,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie.repondreMessage,
            },
            lParams,
          ),
        );
        if (lParams.message.brouillon) {
          this._addCommandeMenuContextuel(
            Object.assign(
              {
                genre:
                  TypeCommandeMessagerie_1.TypeCommandeMessagerie.supprimer,
              },
              lParams,
            ),
          );
        }
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .copierContenuVisu,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.transferer,
            },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            { genre: TypeCommandeMessagerie_1.TypeCommandeMessagerie.signaler },
            lParams,
          ),
        );
        this._addCommandeMenuContextuel(
          Object.assign(
            {
              genre:
                TypeCommandeMessagerie_1.TypeCommandeMessagerie
                  .modifierCategories,
            },
            lParams,
          ),
        );
      }
      ouvrirFenetreListeCategoriesDiscussion(
        aListeMessages,
        aListeEtiquettes,
        aCallback,
      ) {
        let lAvecModif = false;
        ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_ListeCategoriesDiscussion,
          { pere: this.options.instance },
          {
            surSaisieEtiquette: function () {
              lAvecModif = true;
            },
            callbackFermer: function () {
              if (lAvecModif) {
                aCallback();
              }
            },
          },
        ).setDonnees({
          listeEtiquettes: aListeEtiquettes,
          listeMessages: aListeMessages,
        });
      }
      getInfosTitreDroite(aMessage) {
        if (!aMessage || !this.donneesListeMessagerie.listeMessagerie) {
          return { titre: '' };
        }
        let lTitre = '';
        if (aMessage.estUneDiscussion) {
          if (
            aMessage.nbBrouillons === 1 &&
            aMessage.nbBrouillons === aMessage.nombreMessages
          ) {
            lTitre = this._getLibelleBrouillonNonEnvoye(
              aMessage,
              this.donneesListeMessagerie.listeMessagerie,
            );
          }
        } else {
          if (
            aMessage.brouillon &&
            aMessage.pere.nbBrouillons === 1 &&
            aMessage.pere.nbBrouillons === aMessage.pere.nombreMessages
          ) {
            lTitre = this._getLibelleBrouillonNonEnvoye(
              aMessage,
              this.donneesListeMessagerie.listeMessagerie,
              aMessage,
            );
          }
        }
        let lInitiateur = '';
        if (lTitre === '') {
          const lDiscussionRacine =
            UtilitaireMessagerie_1.UtilitaireMessagerie.getDiscussionRacine(
              aMessage,
            );
          if (this._estMessageDetiquetteChat(aMessage)) {
            lTitre =
              lDiscussionRacine.initiateur ||
              ObjetTraduction_1.GTraductions.getValeur('Messagerie.Moi');
            lInitiateur = lDiscussionRacine.initiateur;
          } else {
            lTitre =
              lDiscussionRacine.objet ||
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.ObjetVideDiscussion',
              );
          }
        }
        if (
          this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.discussionInterdit,
          )
        ) {
          lTitre +=
            ' (' +
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.InfoBandeauDicussionInterdite',
            ).ucfirst() +
            ')';
        }
        return { titre: lTitre, initiateur: lInitiateur };
      }
      composeTitreBandeauDeMessageVisu(aMessage, aOptions) {
        if (!aMessage || !this.donneesListeMessagerie.listeMessagerie) {
          return '';
        }
        const lOptions = Object.assign(
          {
            instance: null,
            avecMenuActions: false,
            avecMenuPublic: false,
            callbackMenu: null,
          },
          aOptions,
        );
        const lThis = this;
        const lInstance = lOptions.instance || this.options.instance;
        const lControleur = lInstance.controleur;
        if (!lControleur) {
          return '';
        }
        const lInfosTitre = this.getInfosTitreDroite(aMessage);
        let lSousTitre = '';
        let lAvecInfosParticipants = false;
        if (aMessage.estUneDiscussion) {
          if (aMessage.public) {
            lSousTitre = aMessage.public;
            if (lSousTitre === lInfosTitre.initiateur) {
              lSousTitre =
                ObjetTraduction_1.GTraductions.getValeur('Messagerie.Moi');
            }
          } else if (aMessage.nbPublic > 1) {
            lSousTitre = ObjetChaine_1.GChaine.format(
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.NParticipants',
              ),
              [aMessage.nbPublic || 0],
            );
            if (aMessage.messagePourParticipants) {
              lAvecInfosParticipants = true;
            }
          }
        }
        if (aMessage.strPublicLong) {
          lSousTitre = aMessage.strPublicLong;
        }
        const lIcone =
          UtilitaireMessagerie_1.UtilitaireMessagerie.getIconeMessage(aMessage);
        const H = [];
        if (lIcone) {
          H.push(
            IE.jsx.str('i', {
              class: [lIcone, 'icon-titre'],
              'aria-hidden': 'true',
            }),
          );
        }
        H.push(
          (0, tag_1.tag)(
            'div',
            { class: 'titre' },
            (0, tag_1.tag)('h2', { 'ie-ellipsis': true }, lInfosTitre.titre),
            lSousTitre
              ? (0, tag_1.tag)(
                  'div',
                  {
                    class: 'ie-sous-titre',
                    'ie-ellipsis': true,
                    'ie-hint':
                      lAvecInfosParticipants && !lOptions.ieNodeSousTitre
                        ? tag_1.tag.funcAttr(
                            'moteurMessagerie.hintPublicBandeauDroite',
                          )
                        : false,
                    'ie-node':
                      lAvecInfosParticipants && lOptions.ieNodeSousTitre
                        ? tag_1.tag.funcAttr(
                            'moteurMessagerie.nodePublicBandeauDroite',
                          )
                        : false,
                  },
                  lSousTitre,
                )
              : '',
          ),
        );
        if (
          lOptions.callbackMenu &&
          (lOptions.avecMenuPublic || lOptions.avecMenuActions)
        ) {
          H.push(
            (0, tag_1.tag)('div', {
              'ie-identite': tag_1.tag.funcAttr(
                'moteurMessagerie.getCtxMixteBandeauDroite',
              ),
            }),
          );
        }
        if (!lControleur.moteurMessagerie) {
          lControleur.moteurMessagerie = {};
        }
        lControleur.moteurMessagerie.hintPublicBandeauDroite = function () {
          return UtilitaireMessagerie_1.UtilitaireMessagerie.getStrHintPublicMessagePromise(
            lInstance,
            aMessage.messagePourParticipants.getNumero(),
            true,
            false,
            this.node,
          );
        };
        if (lOptions.ieNodeSousTitre) {
          lControleur.moteurMessagerie.nodePublicBandeauDroite = function () {
            return lOptions.ieNodeSousTitre(
              this.node,
              aMessage.messagePourParticipants.getNumero(),
            );
          };
        }
        lControleur.moteurMessagerie.getCtxMixteBandeauDroite = function () {
          return {
            class: ObjetMenuCtxMixte_1.ObjetMenuCtxMixte,
            pere: lInstance,
            init: function (aMenuCtxMixte) {
              lThis.menuCtxMixteBandeauDroite = aMenuCtxMixte;
              aMenuCtxMixte.setOptions({
                callbackAddCommandes: function (aMenu) {
                  lThis.addCommandesMenuContextuelDiscussion({
                    avecListeDestinataires: lOptions.avecMenuPublic,
                    avecCommandes: lOptions.avecMenuActions,
                    message: aMessage,
                    menuContextuel: aMenu,
                    callback: function (aParams, aCommande) {
                      lOptions.callbackMenu(aParams, aCommande);
                    },
                  });
                },
              });
            },
            destroy: function () {
              lThis.menuCtxMixteBandeauDroite = null;
            },
          };
        };
        return H.join('');
      }
      actualiserMenuCtxMixteBandeauDroite() {
        if (this.menuCtxMixteBandeauDroite) {
          this.menuCtxMixteBandeauDroite.actualiser();
        }
      }
      modifierVisibiliteListeMessagerie(aMessageSelectionne) {
        let lEtatVisible = true;
        let lIndicePere = null;
        if (
          this.options.discussionSelectionneeUniquementVisible &&
          aMessageSelectionne
        ) {
          lIndicePere =
            UtilitaireMessagerie_1.UtilitaireMessagerie.getIndiceDiscussion(
              this.donneesListeMessagerie.listeMessagerie,
              aMessageSelectionne,
            );
        }
        const lVoirUniquementNonLues =
          this.applicationSco.parametresUtilisateur.get(
            'Communication.DiscussionNonLues',
          );
        for (
          let i = 0;
          i < this.donneesListeMessagerie.listeMessagerie.count();
          i++
        ) {
          const lMessage = this.donneesListeMessagerie.listeMessagerie.get(i);
          lMessage.visible = true;
          lEtatVisible = true;
          if (this.options.avecFiltreNonLues) {
            if (
              lMessage.estUneDiscussion &&
              lVoirUniquementNonLues &&
              !this._selectionEstMessageOuMessageFilsDeDiscussion(
                aMessageSelectionne,
                lMessage,
              )
            ) {
              lEtatVisible = !lMessage.lu;
            }
            if (lVoirUniquementNonLues) {
              lMessage.visible = lEtatVisible;
            }
          }
          if (
            this.options.discussionSelectionneeUniquementVisible &&
            lIndicePere !== null
          ) {
            if (
              lIndicePere !==
              UtilitaireMessagerie_1.UtilitaireMessagerie.getIndicePere(
                this.donneesListeMessagerie.listeMessagerie,
                lMessage,
              )
            ) {
              lMessage.visible = false;
            }
          }
          if (this.options.estDiscussionCommune) {
            const lUniquementLesCommunes = this.uniquementLesCommunes;
            if (lUniquementLesCommunes && lMessage.visibleFiltre === false) {
              lMessage.visible = false;
            }
            if (lMessage.listePossessionsMessages) {
              lMessage.listePossessionsMessages.parcourir((D) => {
                D.ignorerSerialisation =
                  lUniquementLesCommunes && D.visibleFiltre === false;
              });
            }
          }
        }
      }
      getNbMessagesSupprimablesPoubelle() {
        let lCpt = 0;
        if (
          this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionAvancee,
          ) &&
          this.donneesListeMessagerie.listeMessagerie
        ) {
          const lEtiquette = new ObjetElement_1.ObjetElement(
            '',
            0,
            TypeOrigineCreationEtiquetteMessage_1.TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle,
          );
          this.donneesListeMessagerie.listeMessagerie.parcourir((D) => {
            if (
              UtilitaireMessagerie_1.UtilitaireMessagerie.estDiscussionVisibleSelonEtiquette(
                D,
                lEtiquette,
              )
            ) {
              if (!D.estUneDiscussion) {
                lCpt += 1;
              }
            }
          });
        }
        return lCpt;
      }
      static saisieSortirConversation(aInstance, aMessage, aPossessionMessage) {
        let lPossessionMessage = aPossessionMessage;
        if (
          !lPossessionMessage &&
          aMessage &&
          aMessage.listePossessionsMessages
        ) {
          lPossessionMessage = aMessage.listePossessionsMessages.get(
            aMessage.listePossessionsMessages.count() - 1,
          );
        }
        if (lPossessionMessage) {
          return new ObjetRequeteSaisieMessage_1.ObjetRequeteSaisieMessage(
            aInstance,
          ).lancerRequete({
            commande: 'entrerSortirConversation',
            entrer: false,
            possessionMessage: lPossessionMessage,
          });
        }
        return Promise.reject();
      }
      _selectionEstMessageOuMessageFilsDeDiscussion(
        aMessageSelectionne,
        aDiscussion,
      ) {
        if (aMessageSelectionne && aDiscussion) {
          if (aMessageSelectionne.estUneDiscussion) {
            return (
              UtilitaireMessagerie_1.UtilitaireMessagerie.getIndiceDiscussion(
                this.donneesListeMessagerie.listeMessagerie,
                aMessageSelectionne,
              ) ===
              UtilitaireMessagerie_1.UtilitaireMessagerie.getIndiceDiscussion(
                this.donneesListeMessagerie.listeMessagerie,
                aDiscussion,
              )
            );
          }
          if (!aMessageSelectionne.estUneDiscussion) {
            return (
              UtilitaireMessagerie_1.UtilitaireMessagerie.getIndicePere(
                this.donneesListeMessagerie.listeMessagerie,
                aMessageSelectionne,
              ) ===
              UtilitaireMessagerie_1.UtilitaireMessagerie.getIndicePere(
                this.donneesListeMessagerie.listeMessagerie,
                aDiscussion,
              )
            );
          }
        }
        return false;
      }
      _addCommandeMenuContextuel(aParams) {
        const lCallback = function (aCommande) {
          aParams.callback(aParams, aCommande);
        };
        const lSaisie = function (aCommande, aNePasSauvegarderBrouillons) {
          aParams.moteur
            .requeteSaisieMessage(aCommande, !aNePasSauvegarderBrouillons)
            .then((aResult) => {
              if (aResult && aResult.saisieMessageOK === true) {
                return lCallback();
              }
            });
        };
        function _add(aTrad, aFunc, aExtendMenu, aActif) {
          aParams.menuContextuel.add(
            aTrad,
            aActif !== false,
            () => {
              if (aFunc) {
                aFunc();
              } else {
                lCallback();
              }
            },
            aExtendMenu,
          );
        }
        const lEnConsult =
          this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.estEnConsultation,
          ) ||
          this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.discussionInterdit,
          );
        const lDiscussionAvancee = this.applicationSco.droits.get(
          ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionAvancee,
        );
        const lEstBrouillon =
          (!aParams.message.estUneDiscussion && aParams.message.brouillon) ||
          (aParams.message.estUneDiscussion &&
            (aParams.message.nbBrouillons || 0) >=
              aParams.message.nombreMessages);
        switch (aParams.genre) {
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .afficherDestinataires:
            _add(
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.ListeDestinataires',
              ),
              lCallback,
              { icon: 'icon_intervenants' },
            );
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.archiver:
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.desarchiver: {
            const lArchiver =
              aParams.genre ===
              TypeCommandeMessagerie_1.TypeCommandeMessagerie.archiver;
            if (
              !lEnConsult &&
              lDiscussionAvancee &&
              aParams.message &&
              aParams.message.estUneDiscussion &&
              lArchiver === !aParams.message.archive &&
              !aParams.message.poubelle &&
              !aParams.message.estNonPossede
            ) {
              _add(
                lArchiver
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Archiver',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Desarchiver',
                    ),
                () => {
                  lSaisie({
                    commande: 'archive',
                    archiver: lArchiver,
                    message: aParams.message,
                  });
                },
                {
                  icon: 'icon_archiver_discussion',
                  typeAffEnModeMixte:
                    Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.icon,
                },
              );
            }
            break;
          }
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.transferer:
            if (
              !IE.estMobile &&
              !lEnConsult &&
              lDiscussionAvancee &&
              aParams.message &&
              !aParams.message.estNonPossede &&
              !UtilitaireMessagerie_1.UtilitaireMessagerie.estMessageNonEditable(
                aParams.message,
              ) &&
              !lEstBrouillon
            ) {
              _add(
                aParams.message.estUneDiscussion
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_TransfererLaDiscussion',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_TransfererLeMessage',
                    ),
                null,
                { icon: 'icon_transferer_discussion' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.signaler:
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .signalerSuppression:
            if (
              !lEnConsult &&
              lDiscussionAvancee &&
              !lEstBrouillon &&
              aParams.strSuperAdministrateurs &&
              !UtilitaireMessagerie_1.UtilitaireMessagerie.estMessageNonEditable(
                aParams.message,
              ) &&
              !aParams.message.estNonPossede
            ) {
              const lPourSignaler =
                aParams.genre ===
                TypeCommandeMessagerie_1.TypeCommandeMessagerie.signaler;
              const lActif = lPourSignaler
                ? !aParams.message.estUneDiscussion
                : !!aParams.message.estUneDiscussion &&
                  aParams.message.profondeur === 0;
              _add(
                lPourSignaler
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_SignalerLeMessage',
                      [aParams.strSuperAdministrateurs],
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_SignalerPourSuppr',
                      [aParams.strSuperAdministrateurs],
                    ),
                () => {
                  let lStrObjetDiscussion = '';
                  const lDiscussionRacine =
                    UtilitaireMessagerie_1.UtilitaireMessagerie.getDiscussionRacine(
                      aParams.message,
                    );
                  if (lDiscussionRacine && lDiscussionRacine.objet) {
                    lStrObjetDiscussion = `"${lDiscussionRacine.objet}"`;
                  }
                  this.applicationSco
                    .getMessage()
                    .afficher({
                      type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                        .Confirmation,
                      message: lPourSignaler
                        ? ObjetTraduction_1.GTraductions.getValeur(
                            'Messagerie.ConfirmationSignalerContenu',
                            [lStrObjetDiscussion],
                          )
                        : ObjetTraduction_1.GTraductions.getValeur(
                            'Messagerie.ConfirmationSignalerPourSuppr',
                            [lStrObjetDiscussion],
                          ),
                    })
                    .then((aGenreAction) => {
                      if (
                        aGenreAction === Enumere_Action_1.EGenreAction.Valider
                      ) {
                        lSaisie({
                          commande: lPourSignaler
                            ? 'signalement'
                            : 'signalementSuppression',
                          message: aParams.message,
                        });
                      }
                    });
                },
                { icon: 'icon_warning_sign' },
                lActif,
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .modifierCategories:
            if (
              !lEnConsult &&
              lDiscussionAvancee &&
              aParams.message &&
              !aParams.message.estNonPossede &&
              aParams.listeEtiquettes &&
              aParams.listeMessagerie &&
              !!ObjetFenetre_ListeCategoriesDiscussion
            ) {
              _add(
                aParams.message.listeEtiquettes &&
                  aParams.message.listeEtiquettes
                    .getListeElements((D) => {
                      return TypeOrigineCreationEtiquetteMessage_1.TypeOrigineCreationEtiquetteMessageUtil.estEtiquettePerso(
                        D.getGenre(),
                      );
                    })
                    .count() > 0
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu.ModifierCategories',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu.AjouterCategories',
                    ),
                () => {
                  let lListeMessages =
                    aParams.listeMessages ||
                    new ObjetListeElements_1.ObjetListeElements();
                  if (!aParams.listeMessages) {
                    if (aParams.message.estUneDiscussion) {
                      lListeMessages = aParams.listeMessagerie.getListeElements(
                        (D) => {
                          return D.pere === aParams.message;
                        },
                      );
                    } else {
                      lListeMessages.add(aParams.message);
                    }
                  }
                  aParams.moteur.ouvrirFenetreListeCategoriesDiscussion(
                    lListeMessages,
                    aParams.listeEtiquettes,
                    () => {
                      lCallback();
                    },
                  );
                },
                { icon: 'icon_classer_discussion' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.corbeille:
            if (
              !lEnConsult &&
              aParams.message &&
              aParams.message.estUneDiscussion &&
              aParams.message.profondeur === 0 &&
              !aParams.message.poubelle &&
              !aParams.message.estNonPossede
            ) {
              _add(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.Menu.Supprimer',
                ),
                () => {
                  lSaisie({
                    commande: 'corbeille',
                    listePossessionsMessages: aParams.message
                      ? aParams.message.listePossessionsMessages
                      : new ObjetListeElements_1.ObjetListeElements(),
                  });
                },
                {
                  icon: 'icon_trash',
                  typeAffEnModeMixte:
                    Enumere_MenuCtxModeMixte_1.ETypeAffEnModeMixte.icon,
                },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.restaurer:
            if (!lEnConsult && aParams.message && aParams.message.poubelle) {
              _add(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.Menu_Restaurer',
                ),
                () => {
                  lSaisie({
                    commande: 'restauration',
                    message: aParams.message,
                  });
                },
                { icon: 'icon_undo' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.purger:
            if (
              !lEnConsult &&
              aParams.message &&
              aParams.message.messagePurge
            ) {
              _add(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.Menu_Purger',
                ),
                () => {
                  this._getCommandePurgerMessagesPromise(
                    true,
                    new ObjetListeElements_1.ObjetListeElements().add(
                      aParams.message,
                    ),
                  ).then((aParams) => {
                    if (aParams) {
                      lSaisie(aParams);
                    }
                  });
                },
                { icon: 'icon_purger_messages' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.supprimer:
            if (
              !lEnConsult &&
              aParams.message &&
              ((aParams.message.estUneDiscussion && aParams.message.poubelle) ||
                lEstBrouillon) &&
              !aParams.message.estNonPossede
            ) {
              _add(
                aParams.message.estUneDiscussion
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_SupprimerDefinitivement',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.MenuVisu_SupprimerBrouillon',
                    ),
                () => {
                  return this.applicationSco
                    .getMessage()
                    .afficher({
                      type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                        .Confirmation,
                      message: ObjetTraduction_1.GTraductions.getValeur(
                        'Messagerie.ConfirmationSuppression',
                      ),
                    })
                    .then((aAccepte) => {
                      if (aAccepte === Enumere_Action_1.EGenreAction.Valider) {
                        lSaisie({
                          commande: 'suppression',
                          message: aParams.message,
                        });
                      }
                    });
                },
                { icon: 'icon_trash' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.lu:
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.nonLu: {
            const lLu =
              aParams.genre ===
              TypeCommandeMessagerie_1.TypeCommandeMessagerie.lu;
            if (
              !lEnConsult &&
              aParams.message &&
              !aParams.message.estNonPossede &&
              lLu === !aParams.message.lu
            ) {
              _add(
                lLu
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu.Lu',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu.NonLu',
                    ),
                () => {
                  lSaisie({
                    commande: 'pourLu',
                    lu: lLu,
                    message: aParams.message,
                  });
                },
                { icon: lLu ? 'icon_eye_open' : 'icon_eye_close' },
              );
            }
            break;
          }
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.fermerDiscussion:
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .ouvrirDiscussion: {
            const lOuvrir =
              aParams.genre ===
              TypeCommandeMessagerie_1.TypeCommandeMessagerie.ouvrirDiscussion;
            if (
              !lEnConsult &&
              lDiscussionAvancee &&
              aParams.message &&
              ((lOuvrir && aParams.message.ouvrable) ||
                (!lOuvrir && aParams.message.fermable)) &&
              !aParams.message.estNonPossede &&
              !aParams.message.estSorti
            ) {
              _add(
                lOuvrir
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_OuvrirDiscussion',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_FermerDiscussion',
                    ),
                () => {
                  return this.applicationSco
                    .getMessage()
                    .afficher({
                      type: Enumere_BoiteMessage_1.EGenreBoiteMessage
                        .Confirmation,
                      message: lOuvrir
                        ? ObjetTraduction_1.GTraductions.getValeur(
                            'Messagerie.ConfirmationOuvertureDiscussion',
                          )
                        : ObjetTraduction_1.GTraductions.getValeur(
                            'Messagerie.ConfirmationFermetureDiscussion',
                          ),
                    })
                    .then((aGenreAction) => {
                      if (
                        aGenreAction === Enumere_Action_1.EGenreAction.Valider
                      ) {
                        lSaisie({
                          commande: 'pourOuvrirFermer',
                          ouvrir: lOuvrir,
                          message: aParams.message,
                        });
                      }
                    });
                },
                { icon: 'icon_discussion_terminee' },
              );
            }
            break;
          }
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .entrerSortirDiscussion:
            if (
              !lEnConsult &&
              aParams.message &&
              aParams.message.avecIODicussion &&
              !lEstBrouillon &&
              aParams.message.dernierPossessionMessage
            ) {
              _add(
                aParams.message.estSorti
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_Entrer',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_Sortir',
                    ),
                () => {
                  lSaisie({
                    commande: 'entrerSortirDiscussion',
                    estSorti: aParams.message.estSorti,
                    possessionMessage: aParams.message.dernierPossessionMessage,
                  });
                },
                { icon: 'icon_sortir_reintegrer_conversation' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .modificationObjetDiscussion:
            if (
              !lEnConsult &&
              aParams.message &&
              aParams.message.avecModifObjet &&
              aParams.message.dernierPossessionMessage
            ) {
              _add(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.Menu_ModifierObjet',
                ),
                () => {
                  return this._editerObjetDiscussionPromise(
                    aParams.moteur,
                    aParams.message,
                  ).then((aParams) => {
                    if (aParams && aParams.commande) {
                      lSaisie(aParams);
                    }
                  });
                },
                { icon: 'icon_edit' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .discussionEnFenetre:
            if (
              !IE.estMobile &&
              !lEnConsult &&
              aParams.message &&
              aParams.message.messageFenetre &&
              aParams.message.dernierPossessionMessage &&
              !aParams.message.estNonPossede
            ) {
              _add(
                aParams.message.messageFenetre.getGenre() ===
                  TypeGenreDiscussion_1.TypeGenreDiscussion.GD_Conversation
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_FenetreConversation',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.Menu_FenetreDiscussion',
                    ),
                null,
                { icon: 'icon_affichage_widget' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .copierContenuVisu:
            if (
              aParams.messageVisu &&
              aParams.elementCibleCopie &&
              global.getSelection &&
              global.getSelection() &&
              global.getSelection().selectAllChildren
            ) {
              _add(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.MenuVisu_Copier',
                ),
                () => {
                  window
                    .getSelection()
                    .selectAllChildren(aParams.elementCibleCopie);
                  try {
                    document.execCommand('copy');
                  } catch (e) {}
                },
                { icon: 'icon_copier_liste' },
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie.repondreMessage:
            if (
              !this.applicationSco.droits.get(
                ObjetDroitsPN_1.TypeDroits.communication.discussionInterdit,
              ) &&
              aParams.messageListeSelection &&
              aParams.message &&
              !aParams.message.estNonPossede &&
              !aParams.message.estCarnetLiaison &&
              aParams.messageListeSelection.estUneDiscussion &&
              !UtilitaireMessagerie_1.UtilitaireMessagerie.estMessageNonEditable(
                aParams.message,
              )
            ) {
              _add(
                aParams.message.brouillon
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.MenuVisu_ReprendreBrouillon',
                    )
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.MenuVisu_Repondre',
                    ),
                lCallback,
                { icon: 'icon_discussion_repondu' },
                !lEnConsult,
              );
            }
            break;
          case TypeCommandeMessagerie_1.TypeCommandeMessagerie
            .afficherDiscussion:
            if (
              !this.applicationSco.droits.get(
                ObjetDroitsPN_1.TypeDroits.communication.discussionInterdit,
              ) &&
              aParams.messageListeSelection &&
              aParams.message &&
              !aParams.message.estNonPossede &&
              !aParams.message.brouillon &&
              !aParams.messageListeSelection.estUneDiscussion
            ) {
              _add(
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.MenuVisu_AfficherDiscussion',
                ),
                lCallback,
                { icon: 'icon_eye_open' },
                !lEnConsult,
              );
            }
            break;
          default:
        }
      }
      _estMessageDetiquetteChat(aMessage) {
        let lEstChat = false;
        if (aMessage && aMessage.listeEtiquettes) {
          aMessage.listeEtiquettes.parcourir((aEtiquette) => {
            if (
              [
                TypeOrigineCreationEtiquetteMessage_1
                  .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte,
                TypeOrigineCreationEtiquetteMessage_1
                  .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS,
                TypeOrigineCreationEtiquetteMessage_1
                  .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation,
              ].indexOf(aEtiquette.getGenre()) >= 0
            ) {
              lEstChat = true;
              return false;
            }
          });
        }
        return lEstChat;
      }
      _getLibelleBrouillonNonEnvoye(
        aDiscussion,
        aListeMessagerie,
        aMessageBrouillon,
      ) {
        let lMessageBrouillon = aMessageBrouillon;
        if (!lMessageBrouillon && aListeMessagerie) {
          const lNumeroPossession =
            aDiscussion.listePossessionsMessages.getNumero(0);
          aListeMessagerie.parcourir((aMessage) => {
            if (
              !aMessage.estUneDiscussion &&
              aMessage.brouillon &&
              aMessage.listePossessionsMessages &&
              aMessage.listePossessionsMessages.getNumero(0) ===
                lNumeroPossession
            ) {
              lMessageBrouillon = aMessage;
              return false;
            }
          });
        }
        if (lMessageBrouillon && lMessageBrouillon.transferant) {
          return ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.BrouillonDiscussionTransfert',
          );
        }
        return ObjetTraduction_1.GTraductions.getValeur(
          'Messagerie.BrouillonDiscussion',
        );
      }
      async _getCommandePurgerMessagesPromise(aPurgeSelection, aListeMessages) {
        const lListeMessagesPurge =
          new ObjetListeElements_1.ObjetListeElements();
        aListeMessages.parcourir((aMessage) => {
          if (aMessage.messagePurge) {
            lListeMessagesPurge.addElement(aMessage.messagePurge);
          }
        });
        if (
          !lListeMessagesPurge ||
          !lListeMessagesPurge.count ||
          lListeMessagesPurge.count() === 0
        ) {
          return null;
        }
        const H = [];
        H.push(
          '<b>',
          ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.ConfirmationRaccourcir_Titre',
          ),
          '</b>',
          '<br>',
          '<br>',
          '<div class="listeMessagerie_messConfirm">',
          '<div class="Insecable">',
          ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.ConfirmationRaccourcir_SeulsLes',
          ),
          '</div>',
          '<div><ie-combo ie-model="combo"></ie-combo></div>',
          '<div>',
          ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.ConfirmationRaccourcir_DerniersMessages',
          ),
          '</div>',
          '</div>',
          aPurgeSelection
            ? ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.ConfirmationRaccourcir_DiscussionSel',
              )
            : ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.ConfirmationRaccourcir_DiscussionToutes',
              ),
          '<br><br>',
          ObjetChaine_1.GChaine.replaceRCToHTML(
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.ConfirmationRaccourcir_3',
            ),
          ),
        );
        const lChoix = [10, 20, 50, 100];
        const lIndiceSelection = 1;
        let lNbMaxMessages = lChoix[lIndiceSelection];
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        lChoix.forEach((aVal) => {
          lListe.addElement(new ObjetElement_1.ObjetElement(aVal + '', aVal));
        });
        const lControleur = {
          combo: {
            init: function (aCombo) {
              aCombo.setOptionsObjetSaisie({ longueur: 35 });
              aCombo.setDonnees(lListe, lIndiceSelection);
            },
            event: function (aParametres) {
              if (
                aParametres.genreEvenement ===
                  Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
                    .selection &&
                aParametres.element
              ) {
                lNbMaxMessages = aParametres.element.getNumero();
              }
            },
          },
        };
        const lAction = await this.applicationSco.getMessage().afficher({
          type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
          message: H.join(''),
          controleur: lControleur,
          width: 430,
        });
        if (lAction === Enumere_Action_1.EGenreAction.Valider) {
          return {
            commande: 'purger',
            listeMessagesPurge: lListeMessagesPurge,
            nbMaxMessages: lNbMaxMessages,
          };
        }
        return null;
      }
      _editerObjetDiscussionPromise(aMoteur, aMessage) {
        let lObjet = aMessage.objet;
        const lFenetre = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_1.ObjetFenetre,
          { pere: aMoteur.options.instance },
          {
            titre: ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.Menu_ModifierObjet',
            ),
            listeBoutons: [
              ObjetTraduction_1.GTraductions.getValeur('Annuler'),
              {
                valider: true,
                libelle: ObjetTraduction_1.GTraductions.getValeur('Valider'),
              },
            ],
            largeur: 300,
          },
        );
        lFenetre.controleur.input = {
          getValue: function () {
            return lObjet;
          },
          setValue: function (aValue) {
            lObjet = aValue;
          },
          node: function () {
            $(this.node).on('keyup', (aEvent) => {
              if (
                aEvent.which === ToucheClavier_1.ToucheClavier.RetourChariot
              ) {
                lFenetre.setBoutonFocus({ valider: true });
              }
            });
          },
        };
        lFenetre.controleur.fenetreBtn.getDisabled = function (aBoutonRepeat) {
          return aBoutonRepeat.element.valider && !lObjet;
        };
        return lFenetre
          .afficher(
            (0, tag_1.tag)(
              'span',
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.SaisieObjetDiscussion',
              ),
            ) +
              (0, tag_1.tag)('br') +
              (0, tag_1.tag)('br') +
              (0, tag_1.tag)('input', {
                class: IE.estMobile ? '' : 'round-style',
                'ie-model': 'input',
                'ie-trim': true,
                maxlength:
                  UtilitaireMessagerie_1.UtilitaireMessagerie
                    .C_TailleObjetMessage,
                style: 'width:100%;',
              }),
          )
          .then((aParams) => {
            if (aParams.bouton && aParams.bouton.valider && lObjet) {
              return {
                commande: 'modificationObjetDiscussion',
                possessionMessage: aMessage.dernierPossessionMessage,
                objet: lObjet,
              };
            }
          });
      }
      _avecAvertissementListeMessagerie() {
        return !!(
          this.donneesListeMessagerie &&
          (this.donneesListeMessagerie.avertissements ||
            this.donneesListeMessagerie.messagerieDesactivee)
        );
      }
      _construirePanelAvertissement() {
        const lAvertissements = this.donneesListeMessagerie
          ? this.donneesListeMessagerie.avertissements
          : null;
        const lThis = this;
        uFenetreAvertissement.controleur._panelAvert_ = {
          nodeAvertissements: function (aGenre) {
            $(this.node).eventValidation(() => {
              switch (aGenre) {
                case TypeCommandeAvertissementsMessage.purger:
                  lThis
                    ._getCommandePurgerMessagesPromise(
                      false,
                      lThis.donneesListeMessagerie.listeMessagerie,
                    )
                    .then((aCommandePurger) => {
                      if (aCommandePurger) {
                        return lThis.requeteSaisieMessage(
                          aCommandePurger,
                          true,
                        );
                      }
                    });
                  break;
                case TypeCommandeAvertissementsMessage.viderCorbeille:
                  lThis.saisieViderCorbeille(lAvertissements.nbCorbeille);
                  break;
                case TypeCommandeAvertissementsMessage.corbeilleInactif:
                  lThis._discussionsInactivesDansCorbeille();
                  break;
                default:
              }
            });
          },
          btnRecupererMessageDesactivation: {
            event: () => {
              lThis.requeteSaisieMessage(
                { commande: 'recupererMessageDesactivation' },
                true,
              );
            },
          },
          btnModifierPreferencesDesactivation: {
            event: function () {
              GEtatUtilisateur.setGenreAffichageCompteSelectionne(
                Enumere_DonneesPersonnelles_1.TypeFiltreAffichage.deconnexion,
              );
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.navigationOnglet,
                Enumere_Onglet_1.EGenreOnglet.InfosPerso,
              );
            },
          },
        };
        const H = [];
        H.push('<div class="panelAvert-conteneur">');
        if (lAvertissements) {
          H.push('<div>');
          H.push(
            '<b>',
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.TropMessage_Titre',
              [lAvertissements.nbMax],
            ),
            '</b>',
            '<br><br>',
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.TropMessage_Conseil',
            ),
            '<ul>',
            '<li>',
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.TropMessage_Trier',
            ),
            '</li>',
            '<li>',
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.TropMessage_MettreFin',
            ),
            '</li>',
          );
          if (lAvertissements.avecPurge) {
            H.push(
              '<li><a class="Lien link"',
              ObjetHtml_1.GHtml.composeAttr(
                'ie-node',
                '_panelAvert_.nodeAvertissements',
                [TypeCommandeAvertissementsMessage.purger],
              ),
              ' tabindex="0">',
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.TropMessage_Raccourcir',
              ),
              '</a></li>',
            );
          }
          H.push(
            '<li><a class="Lien link"',
            ObjetHtml_1.GHtml.composeAttr(
              'ie-node',
              '_panelAvert_.nodeAvertissements',
              [TypeCommandeAvertissementsMessage.corbeilleInactif],
            ),
            ' tabindex="0">',
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.TropMessage_CorbeilleInactive',
            ),
            '</a></li>',
          );
          if (lAvertissements.nbCorbeille > 0) {
            H.push(
              '<li><a class="Lien link"',
              ObjetHtml_1.GHtml.composeAttr(
                'ie-node',
                '_panelAvert_.nodeAvertissements',
                [TypeCommandeAvertissementsMessage.viderCorbeille],
              ),
              ' tabindex="0">',
              ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.TropMessage_ViderCorbeille',
              ),
              '</a></li>',
            );
          }
          H.push('</ul>');
          H.push('</div>');
        }
        if (this.donneesListeMessagerie.messagerieDesactivee) {
          H.push(
            (0, tag_1.tag)(
              'div',
              { class: 'panelAvert-conteneur-desactive' },
              (0, tag_1.tag)(
                'b',
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.MessagerieDesactivee',
                ),
              ),
              (0, tag_1.tag)(
                'ie-bouton',
                {
                  'ie-model': '_panelAvert_.btnRecupererMessageDesactivation',
                  class: [
                    Type_ThemeBouton_1.TypeThemeBouton.neutre,
                    'small-bt',
                  ],
                },
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.RecupererMessageDesactivation',
                ),
              ),
              (0, tag_1.tag)(
                'ie-bouton',
                {
                  'ie-model':
                    '_panelAvert_.btnModifierPreferencesDesactivation',
                  class: [
                    Type_ThemeBouton_1.TypeThemeBouton.neutre,
                    'small-bt',
                  ],
                },
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.ModifierPreferencesDesactivation',
                ),
              ),
            ),
          );
        }
        H.push('</div>');
        return H.join('');
      }
      _discussionsInactivesDansCorbeille() {
        const H = [];
        H.push(
          '<b>',
          ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.ConfirmationCorbeilleInactive_Titre',
          ),
          '</b>',
          '<br>',
          '<br>',
          ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.ConfirmationCorbeilleInactive_1',
          ),
          '<div class="listeMessagerie_messConfirm">',
          '<div class="Insecable">',
          ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.ConfirmationCorbeilleInactive_2',
          ),
          '</div>',
          '<div><ie-combo ie-model="combo"></ie-combo></div>',
          '<div>',
          ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.ConfirmationCorbeilleInactive_3',
          ),
          '</div>',
          '</div>',
        );
        const lChoix = [15, 30, 60];
        const lIndiceSelection = 0;
        let lNbJours = lChoix[lIndiceSelection];
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        lChoix.forEach((aVal) => {
          lListe.addElement(new ObjetElement_1.ObjetElement(aVal + '', aVal));
        });
        const lControleur = {
          combo: {
            init: function (aCombo) {
              aCombo.setOptionsObjetSaisie({ longueur: 25 });
              aCombo.setDonnees(lListe, lIndiceSelection);
            },
            event: function (aParametres) {
              if (
                aParametres.genreEvenement ===
                  Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
                    .selection &&
                aParametres.element
              ) {
                lNbJours = aParametres.element.getNumero();
              }
            },
          },
        };
        this.applicationSco
          .getMessage()
          .afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
            message: H.join(''),
            controleur: lControleur,
            width: 370,
          })
          .then((aAccepte) => {
            if (aAccepte !== Enumere_Action_1.EGenreAction.Valider) {
              return;
            }
            const lNow = new Date();
            const lListePossessionsMessages =
              new ObjetListeElements_1.ObjetListeElements();
            this.donneesListeMessagerie.listeMessagerie.parcourir(
              (aMessage) => {
                if (
                  aMessage &&
                  aMessage.dateActivite &&
                  aMessage.listePossessionsMessages &&
                  ObjetDate_1.GDate.getNbrJoursEntreDeuxDates(
                    aMessage.dateActivite,
                    lNow,
                  ) > lNbJours
                ) {
                  lListePossessionsMessages.add(
                    aMessage.listePossessionsMessages,
                  );
                }
              },
            );
            if (lListePossessionsMessages.count() > 0) {
              return this.requeteSaisieMessage(
                {
                  commande: 'corbeille',
                  listePossessionsMessages: lListePossessionsMessages,
                },
                true,
                MoteurMessagerie.TypeApresSaisieMessage.vider,
              );
            }
          });
      }
      async _controleNbDestinatairesResponEleve(aMessage) {
        if (
          aMessage.commande !== 'brouillon' &&
          aMessage.listeDestinataires &&
          aMessage.avecControleNbDest !== false
        ) {
          const lNbEleves = aMessage.listeDestinataires
            .getListeElements((D) => {
              return D.getGenre() === Enumere_Ressource_1.EGenreRessource.Eleve;
            })
            .count();
          const lNbResponsables = aMessage.listeDestinataires
            .getListeElements((D_1) => {
              return (
                D_1.getGenre() ===
                Enumere_Ressource_1.EGenreRessource.Responsable
              );
            })
            .count();
          if (lNbEleves + lNbResponsables > 100) {
            const lGenreAction = await this.applicationSco
              .getMessage()
              .afficher({
                type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
                message:
                  !aMessage.message &&
                  (!aMessage.messagePourReponse ||
                    !aMessage.messagePourReponse.existeNumero())
                    ? ObjetTraduction_1.GTraductions.getValeur(
                        'Messagerie.ConfirmationDestinatairesParentsElevesNouvelle',
                        [lNbEleves, lNbResponsables],
                      )
                    : ObjetTraduction_1.GTraductions.getValeur(
                        'Messagerie.ConfirmationDestinatairesParentsElevesAjout',
                        [lNbEleves, lNbResponsables],
                      ),
              });
            if (lGenreAction === Enumere_Action_1.EGenreAction.NePasValider) {
              throw new ErrorControleNbDest();
            }
          }
        }
      }
      async _controleUtilisateurDansDestinataires(aMessage) {
        await this._controleNbDestinatairesResponEleve(aMessage);
        if (
          aMessage.commande !== 'brouillon' &&
          aMessage.listeDestinataires &&
          aMessage.listeDestinataires.count() >= 1 &&
          aMessage.listeDestinataires.getElementParElement(
            GEtatUtilisateur.getUtilisateur(),
          )
        ) {
          const lGenreAction = await this.applicationSco.getMessage().afficher({
            type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
            message: ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.ConfirmationAuteurDansDestinataires',
            ),
          });
          if (lGenreAction === Enumere_Action_1.EGenreAction.NePasValider) {
            aMessage.listeDestinataires.remove(
              aMessage.listeDestinataires.getIndiceParElement(
                GEtatUtilisateur.getUtilisateur(),
              ),
            );
          }
        }
      }
      _traiterListeEtiquette(aListeEtiquettes, aAvecCategories) {
        let lNumeroBidon = 1;
        const lGetNumeroBidon = () => {
          const lResult = lNumeroBidon;
          lNumeroBidon += 1;
          return lResult;
        };
        const lAvecDiscussionAvancee = this.applicationSco.droits.get(
          ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionAvancee,
        );
        const lAvecCategories =
          aAvecCategories !== false && lAvecDiscussionAvancee;
        let lLibelleEtiquetteToutes =
          ObjetTraduction_1.GTraductions.getValeur('Messagerie.Toutes');
        if (
          GEtatUtilisateur.GenreEspace ===
            Enumere_Espace_1.EGenreEspace.PrimParent ||
          GEtatUtilisateur.GenreEspace ===
            Enumere_Espace_1.EGenreEspace.Mobile_PrimParent
        ) {
          lLibelleEtiquetteToutes = ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.LesMiennes',
          );
        }
        let lElement = new ObjetElement_1.ObjetElement(
          lLibelleEtiquetteToutes,
          lGetNumeroBidon(),
        );
        lElement.toutes = true;
        aListeEtiquettes.addElement(lElement);
        if (lAvecDiscussionAvancee) {
          lElement = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur('Messagerie.EnCours'),
            lGetNumeroBidon(),
          );
          lElement.enCours = true;
          aListeEtiquettes.insererElement(lElement, 1);
        }
        let lCumulEtiquettesPerso = null;
        if (lAvecCategories) {
          lCumulEtiquettesPerso = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.Titre.Categories',
            ),
            lGetNumeroBidon(),
          );
          lCumulEtiquettesPerso.cumulEtiquettePerso = true;
          lCumulEtiquettesPerso.estUnDeploiement = true;
          lCumulEtiquettesPerso.estDeploye = false;
          lCumulEtiquettesPerso.nonSelectionnable = true;
          aListeEtiquettes.addElement(lCumulEtiquettesPerso);
          aListeEtiquettes.add(
            ObjetElement_1.ObjetElement.create({
              pere: lCumulEtiquettesPerso,
              Libelle: ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.SansCategorie',
              ),
              estSansEtiquette: true,
            }),
          );
          lElement = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.categorie.EditerCategorieEtiquette',
            ),
            lGetNumeroBidon(),
          );
          lElement.categories = true;
          lElement.pere = lCumulEtiquettesPerso;
          lElement.nonSelectionnable = true;
          aListeEtiquettes.addElement(lElement);
          lElement = new ObjetElement_1.ObjetElement(
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.Titre.Historiques',
            ),
          );
          lElement.estInterTitreHistorique = true;
          lElement.estInterTitre = ObjetListe_1.ObjetListe.typeInterTitre.h5;
          lElement.nonSelectionnable = true;
          aListeEtiquettes.addElement(lElement);
        }
        if (
          [
            Enumere_Espace_1.EGenreEspace.PrimProfesseur,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimProfesseur,
          ].includes(GEtatUtilisateur.GenreEspace) &&
          this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.communication.avecDiscussionEleves,
          )
        ) {
          aListeEtiquettes.add(
            ObjetElement_1.ObjetElement.create({
              Libelle: ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.MesEleves',
              ),
              Numero: lGetNumeroBidon(),
              estFiltreDiscussionMesEleves: true,
            }),
          );
        }
        aListeEtiquettes.parcourir((aEtiquette) => {
          if (
            TypeOrigineCreationEtiquetteMessage_1.TypeOrigineCreationEtiquetteMessageUtil.estEtiquettePerso(
              aEtiquette.getGenre(),
            )
          ) {
            if (lCumulEtiquettesPerso) {
              aEtiquette.pere = lCumulEtiquettesPerso;
            }
            if (aEtiquette.couleur) {
              aEtiquette.libelleHtml =
                '<div class="InlineBlock AlignementMilieuVertical PetitEspaceDroit">' +
                UtilitaireMessagerie_1.UtilitaireMessagerie.dessinCouleurEtiquette(
                  aEtiquette,
                ) +
                '</div>' +
                '<div class="InlineBlock AlignementMilieuVertical">' +
                aEtiquette.getLibelle() +
                '</div>';
            }
          }
        });
        const lEstPrimParent =
          GEtatUtilisateur.GenreEspace ===
            Enumere_Espace_1.EGenreEspace.PrimParent ||
          GEtatUtilisateur.GenreEspace ===
            Enumere_Espace_1.EGenreEspace.Mobile_PrimParent;
        const lTriEtiquettes = [];
        if (lEstPrimParent) {
          lTriEtiquettes.push(
            ObjetTri_1.ObjetTri.init((D) => {
              return (
                D.getGenre() !==
                TypeOrigineCreationEtiquetteMessage_1
                  .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison
              );
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.toutes;
            }),
          );
        } else {
          lTriEtiquettes.push(
            ObjetTri_1.ObjetTri.init((D) => {
              return lAvecDiscussionAvancee ? !D.enCours : !D.toutes;
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return (
                D.getGenre() !==
                TypeOrigineCreationEtiquetteMessage_1
                  .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Brouillon
              );
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.cumulEtiquettePerso;
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.estSansEtiquette;
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return !TypeOrigineCreationEtiquetteMessage_1.TypeOrigineCreationEtiquetteMessageUtil.estEtiquettePerso(
                D.getGenre(),
              );
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.categories;
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.estInterTitreHistorique;
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return (
                D.getGenre() !==
                TypeOrigineCreationEtiquetteMessage_1
                  .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_CarnetLiaison
              );
            }),
            ObjetTri_1.ObjetTri.init((D) => {
              return !D.estFiltreDiscussionMesEleves;
            }),
          );
        }
        lTriEtiquettes.push(
          ObjetTri_1.ObjetTri.init((D) => {
            return (
              D.getGenre() !==
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Conversation
            );
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return (
              D.getGenre() !==
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Alerte
            );
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return (
              D.getGenre() !==
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_ContactVS
            );
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return (
              D.getGenre() !==
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Harcelement
            );
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return !D.toutes;
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return (
              D.getGenre() !==
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Archive
            );
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return (
              D.getGenre() !==
              TypeOrigineCreationEtiquetteMessage_1
                .TypeOrigineCreationEtiquetteMessage.OCEM_Pre_Poubelle
            );
          }),
          ObjetTri_1.ObjetTri.init('Libelle'),
        );
        aListeEtiquettes.setTri(lTriEtiquettes).trier();
      }
    }
    exports.MoteurMessagerie = MoteurMessagerie;
    (function (MoteurMessagerie) {
      let TypeApresSaisieMessage;
      (function (TypeApresSaisieMessage) {
        TypeApresSaisieMessage['vider'] = 'vider';
      })(
        (TypeApresSaisieMessage =
          MoteurMessagerie.TypeApresSaisieMessage ||
          (MoteurMessagerie.TypeApresSaisieMessage = {})),
      );
    })(MoteurMessagerie || (exports.MoteurMessagerie = MoteurMessagerie = {}));
    class ErrorControleNbDest extends Error {
      constructor() {
        super(...arguments);
        this.refus = true;
        this.refus_controleNbDest = true;
      }
    }
    var TypeCommandeAvertissementsMessage;
    (function (TypeCommandeAvertissementsMessage) {
      TypeCommandeAvertissementsMessage['purger'] = 'purger';
      TypeCommandeAvertissementsMessage['viderCorbeille'] = 'viderCorbeille';
      TypeCommandeAvertissementsMessage['corbeilleInactif'] =
        'corbeilleInactif';
    })(
      TypeCommandeAvertissementsMessage ||
        (TypeCommandeAvertissementsMessage = {}),
    );
  },
  fn: 'moteurmessagerie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetDestinatairesMessagerie = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const UtilitaireBoutonBandeau_1 = require('UtilitaireBoutonBandeau');
    const UtilitaireMessagerie_1 = require('UtilitaireMessagerie');
    class ObjetDestinatairesMessagerie extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.etatUtilisateurSco = GApplication.getEtatUtilisateur();
        this._parametres = {
          genres: {},
          genresRessources: [],
          avecDirecteur: false,
        };
      }
      setDonnees(
        aGenresRessources,
        aAvecIndicationDiscussionInterdit,
        aAvecListeDiffusion,
      ) {
        let lLibelle;
        this.avecIndicationDiscussionInterdit =
          aAvecIndicationDiscussionInterdit;
        this.avecListeDiffusion = aAvecListeDiffusion;
        this._parametres.genresRessources = aGenresRessources;
        this._parametres.genres = {};
        if (aGenresRessources && aGenresRessources.length) {
          for (let i = 0; i < aGenresRessources.length; i++) {
            const lParam = aGenresRessources[i];
            lLibelle = '';
            switch (lParam.genre) {
              case Enumere_Ressource_1.EGenreRessource.Eleve:
                lLibelle = ObjetTraduction_1.GTraductions.getValeur('Eleves');
                break;
              case Enumere_Ressource_1.EGenreRessource.Responsable:
                lLibelle =
                  ObjetTraduction_1.GTraductions.getValeur(
                    'Messagerie.Parents',
                  );
                break;
              case Enumere_Ressource_1.EGenreRessource.Enseignant:
                lLibelle =
                  ObjetTraduction_1.GTraductions.getValeur('Professeurs');
                break;
              case Enumere_Ressource_1.EGenreRessource.Personnel:
                lLibelle =
                  ObjetTraduction_1.GTraductions.getValeur('Personnels');
                break;
              default:
            }
            this._parametres.genres[lParam.genre] = $.extend(
              {
                genre: null,
                libelle: lLibelle,
                listeDestinataires:
                  lParam.listeDestinataires ||
                  new ObjetListeElements_1.ObjetListeElements(),
                getDisabled: null,
              },
              lParam,
            );
            if (this._getDisabledParGenre(lParam.genre)) {
              this._parametres.genres[lParam.genre].listeDestinataires =
                new ObjetListeElements_1.ObjetListeElements();
            }
          }
        }
        this._parametres;
        this.afficher();
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          styleLibellesBouton: function (aGenre) {
            return {
              color: aInstance._getDisabledParGenre(aGenre)
                ? GCouleur.grisFonce
                : '',
            };
          },
          bouton: {
            event: function (aGenreRessource) {
              UtilitaireMessagerie_1.UtilitaireMessagerie.selectionnerListePublics(
                {
                  instance: aInstance,
                  genreRessource: aGenreRessource,
                  avecIndicationDiscussionInterdit:
                    aInstance.avecIndicationDiscussionInterdit,
                  listeRessourcesSelectionnees:
                    aInstance._parametres.genres[aGenreRessource]
                      .listeDestinataires,
                },
              ).then((aListe) => {
                if (aListe) {
                  aInstance.callback.appel(
                    aGenreRessource,
                    aListe,
                    aInstance.getListeDestinataires(),
                  );
                }
              });
            },
            getDisabled: function (aGenre) {
              return aInstance._getDisabledParGenre(aGenre);
            },
          },
          dest: {
            html: function (aGenre) {
              return aInstance._parametres.genres[
                aGenre
              ].listeDestinataires.count();
            },
            hint: function (aGenre) {
              return aInstance._parametres.genres[aGenre].listeDestinataires
                .getTableauLibelles()
                .join('\n');
            },
          },
          btnAfficherListesDiffusion: {
            event() {
              aInstance._evenementSurBoutonListeDiffusion();
            },
            getTitle() {
              return ObjetTraduction_1.GTraductions.getValeur(
                'actualites.public.chargerListeDiffusion',
              );
            },
          },
          btnSupprimerDestinataires: {
            event() {
              aInstance._evenementSurBoutonSupprimer();
            },
            getTitle() {
              return ObjetTraduction_1.GTraductions.getValeur(
                'actualites.public.supprimer',
              );
            },
            getDisabled() {
              return !aInstance._existeDestinataires();
            },
          },
          cbDestinataireDirecteur: {
            getValue() {
              return aInstance._parametres.avecDirecteur;
            },
            setValue(aValue) {
              aInstance._parametres.avecDirecteur = aValue;
            },
          },
        });
      }
      construireAffichage() {
        return this._compose();
      }
      setListeDestinataires(aListeDestinataires) {
        for (const i in this._parametres.genres) {
          const lListe = this._parametres.genres[i].listeDestinataires;
          const lGenre = this._parametres.genres[i].genre;
          aListeDestinataires.parcourir((aElement) => {
            if (aElement.getGenre() === lGenre) {
              const lIndice = lListe.getIndiceParElement(aElement);
              if (lIndice === null || lIndice === undefined) {
                const lElement = new ObjetElement_1.ObjetElement(
                  '',
                  aElement.getNumero(),
                  lGenre,
                );
                lElement.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
                lListe.addElement(lElement);
              }
            }
          });
          this.callback.appel(lGenre, lListe, this.getListeDestinataires());
        }
      }
      getListeDestinataires() {
        const lListe = new ObjetListeElements_1.ObjetListeElements();
        function _ajouterElement(aGenreRessource, D) {
          const lElement = new ObjetElement_1.ObjetElement(
            '',
            D.getNumero(),
            aGenreRessource,
          );
          lElement.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
          lListe.addElement(lElement);
        }
        for (const i in this._parametres.genres) {
          this._parametres.genres[i].listeDestinataires.parcourir(
            _ajouterElement.bind(this, this._parametres.genres[i].genre),
          );
        }
        if (this.etatUtilisateurSco.pourPrimaire()) {
          if (this._parametres.avecDirecteur) {
            _ajouterElement(
              Enumere_Ressource_1.EGenreRessource.Personnel,
              new ObjetElement_1.ObjetElement('', 0),
            );
          }
        }
        return lListe;
      }
      _existeDestinataires() {
        let lNombre = 0;
        for (const i in this._parametres.genres) {
          lNombre +=
            this._parametres.genres[
              i
            ].listeDestinataires.getNbrElementsExistes();
        }
        return lNombre > 0;
      }
      _toutesDestinataires() {
        const lResult = this.avecListeDiffusion;
        return lResult;
      }
      _getDisabledParGenre(aGenre) {
        return this._parametres &&
          this._parametres.genres &&
          this._parametres.genres[aGenre] &&
          this._parametres.genres[aGenre].getDisabled
          ? this._parametres.genres[aGenre].getDisabled()
          : false;
      }
      _composeRessource(aParams) {
        const H = [];
        const lLibelleBouton = '...';
        const lId = `${this.Nom}_dest_${aParams.genre}`;
        if (!this._getDisabledParGenre(aParams.genre)) {
          H.push(
            IE.jsx.str(
              'li',
              { class: 'contenu-item' },
              IE.jsx.str(
                'label',
                {
                  for: lId,
                  'ie-style': `styleLibellesBouton(${aParams.genre})`,
                },
                aParams.libelle,
              ),
              IE.jsx.str(
                'ie-bouton',
                { id: lId, 'ie-model': `bouton(${aParams.genre})` },
                lLibelleBouton,
              ),
              IE.jsx.str('span', {
                'ie-html': `dest.html(${aParams.genre})`,
                'ie-title': `dest.hint(${aParams.genre})`,
                'ie-style': `styleLibellesBouton(${aParams.genre})`,
              }),
            ),
          );
        }
        return H.join('');
      }
      _compose() {
        const H = [];
        H.push(`<div class="flex-contain">`);
        if (this._toutesDestinataires()) {
          H.push(
            `<div class="fix-bloc m-right-l flex-contain cols flex-center" style="width:2.4rem;">\n                  <div class="fix-bloc" style="height:2.4rem;">\n                    ${UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getHtmlBtnListesDiffusion('btnAfficherListesDiffusion')}\n                  </div>\n                  <div class="fix-bloc m-top-l" style="height:2.4rem;">\n                    ${UtilitaireBoutonBandeau_1.UtilitaireBoutonBandeau.getHtmlBtnSupprimer('btnSupprimerDestinataires')}\n                  </div>\n              </div>`,
          );
        }
        H.push(`   <div class="fluid-bloc flex-contain cols">`);
        if (
          this._parametres.genresRessources &&
          this._parametres.genresRessources.length
        ) {
          H.push(
            `    <div class="conteneur-tabs" >\n                      <div class="menu-tabs">\n                        <div class="tab-item">\n                          <div tabindex="0" class="tab-content selected">\n                              <div class="libelle BordureNavigationInactive sel">${ObjetTraduction_1.GTraductions.getValeur('Messagerie.Destinataires')}</div>\n                          </div>\n                        </div>\n                      </div>\n                  </div>`,
          );
          H.push(`    <div class="tabs-contenu with-border">`);
          H.push(`<ul class="ul-contenu-item">`);
          for (let i = 0; i < this._parametres.genresRessources.length; i++) {
            H.push(
              this._composeRessource(
                this._parametres.genres[
                  this._parametres.genresRessources[i].genre
                ],
              ),
            );
          }
          H.push(`</ul>`);
          if (this.etatUtilisateurSco.pourPrimaire()) {
            H.push(
              UtilitaireMessagerie_1.UtilitaireMessagerie.composeMettreEnCopie({
                avecDirection: true,
              }),
            );
          }
          H.push(`    </div>\n                </div>`);
        }
        H.push(`   </div>\n            </div>`);
        return H.join('');
      }
      _evenementSurBoutonListeDiffusion() {
        UtilitaireMessagerie_1.UtilitaireMessagerie.selectionnerListeDiffusions(
          this,
        ).then((aListeSelec) => {
          if (aListeSelec && aListeSelec.count() > 0) {
            const lListe = new ObjetListeElements_1.ObjetListeElements();
            aListeSelec.parcourir((aDiffusion) => {
              aDiffusion.listePublicIndividu.parcourir((aElement) => {
                const lIndice = lListe.getIndiceParElement(aElement);
                const lGenreDisabled = this._getDisabledParGenre(
                  aElement.getGenre(),
                );
                if (
                  (lIndice === null || lIndice === undefined) &&
                  !lGenreDisabled
                ) {
                  lListe.addElement(
                    MethodesObjet_1.MethodesObjet.dupliquer(aElement),
                  );
                }
              });
            });
            this.setListeDestinataires(lListe);
          }
        });
      }
      _evenementSurBoutonSupprimer() {
        this._viderPublic();
      }
      _viderPublic() {
        for (const i in this._parametres.genres) {
          this._parametres.genres[i].listeDestinataires =
            new ObjetListeElements_1.ObjetListeElements();
          const lGenre = this._parametres.genres[i].genre;
          this.callback.appel(
            lGenre,
            new ObjetListeElements_1.ObjetListeElements(),
            this.getListeDestinataires(),
          );
        }
      }
    }
    exports.ObjetDestinatairesMessagerie = ObjetDestinatairesMessagerie;
  },
  fn: 'objetdestinatairesmessagerie.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_Message = void 0;
    const ObjetDroitsPN_1 = require('ObjetDroitsPN');
    const GUID_1 = require('GUID');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const Enumere_Etat_1 = require('Enumere_Etat');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetTri_1 = require('ObjetTri');
    const UtilitaireUrl_1 = require('UtilitaireUrl');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const ObjetSelecteurPJ_1 = require('ObjetSelecteurPJ');
    const TypeHttpNotificationDonnes_1 = require('TypeHttpNotificationDonnes');
    const UtilitaireMessagerie_1 = require('UtilitaireMessagerie');
    const Type_ThemeBouton_1 = require('Type_ThemeBouton');
    const TinyInit_1 = require('TinyInit');
    const MoteurMessagerie_1 = require('MoteurMessagerie');
    const ObjetDestinatairesMessagerie_1 = require('ObjetDestinatairesMessagerie');
    const ObjetFenetre_SelectionPublic_1 = require('ObjetFenetre_SelectionPublic');
    const jsx_1 = require('jsx');
    class ObjetFenetre_Message extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.applicationSco = GApplication;
        this.etatUtilisateurSco = this.applicationSco.getEtatUtilisateur();
        this.idEntete = GUID_1.GUID.getId();
        this.idCopieAutresResp = GUID_1.GUID.getId();
        this.idContenuMsg = GUID_1.GUID.getId();
        this.id_destinataires_conteneur = GUID_1.GUID.getId();
        this.id_destinataires = GUID_1.GUID.getId();
        this.idTypesDestinataire = {
          eleve: 1,
          responsable1: 2,
          responsable2: 3,
          profsprincipaux: 4,
          tuteurs: 5,
          equipePedagogique: 6,
        };
        this.idDiscussion = GUID_1.GUID.getId();
        this.idLibellePJ = GUID_1.GUID.getId();
        this.idLibelleCloud = GUID_1.GUID.getId();
        this.estAvecDirecteur = false;
        this.estAvecEnseignant = false;
        this.setOptionsFenetre({
          titre: ObjetTraduction_1.GTraductions.getValeur(
            'Messagerie.TitreFenetre',
          ),
          largeur: 630,
          avecTailleSelonContenu: true,
          listeBoutons: [
            {
              libelle: ObjetTraduction_1.GTraductions.getValeur('Annuler'),
              theme: Type_ThemeBouton_1.TypeThemeBouton.secondaire,
            },
            {
              libelle: ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.BtnEnvoyer',
              ),
              theme: Type_ThemeBouton_1.TypeThemeBouton.primaire,
            },
          ],
          avecPieceJointe:
            UtilitaireMessagerie_1.UtilitaireMessagerie.avecAjoutPieceJointeMessage(),
          avecTiny:
            UtilitaireMessagerie_1.UtilitaireMessagerie.avecEditeurTiny(),
          avecSauvegardeBrouillon: false,
        });
        this.moteurMessagerie =
          new MoteurMessagerie_1.MoteurMessagerie().setOptions({
            instance: this,
            avecTiny: this.optionsFenetre.avecTiny,
          });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          estVisibleInclureResponsables: function () {
            return aInstance.avecCBInclureDelegues;
          },
          cbInclureResponsables: {
            getValue: function () {
              return aInstance.inclureResponsablesDeleguesClasse
                ? aInstance.inclureResponsablesDeleguesClasse
                : false;
            },
            setValue: function (aValue) {
              aInstance.inclureResponsablesDeleguesClasse = aValue;
            },
          },
          afficherLegende: function () {
            return !!(aInstance.message && aInstance.message.legende);
          },
          getLegende: function () {
            return aInstance.message && aInstance.message.legende
              ? aInstance.message.legende
              : '';
          },
          getObjetTexte: function () {
            return aInstance.message && aInstance.message.objet
              ? aInstance.message.objet || ''
              : '';
          },
          inputObjet: {
            getValue: function () {
              return aInstance.message && aInstance.message.objet
                ? aInstance.message.objet || ''
                : '';
            },
            setValue: function (aValue) {
              if (aInstance.message) {
                aInstance.message.objet = aValue;
              }
            },
          },
          chipsFichierCloud: {
            eventBtn: function (aIndice) {
              const lElement = aInstance.message.listeFichiers.get(aIndice);
              if (lElement) {
                lElement.setEtat(Enumere_Etat_1.EGenreEtat.Suppression);
                aInstance._actualiserSelecteurPJ();
                aInstance.actualiserListeCloud();
                aInstance.message.setEtat(
                  Enumere_Etat_1.EGenreEtat.Modification,
                );
              }
            },
          },
          textareaSansTiny: {
            getValue: function () {
              return aInstance.message ? aInstance.message.contenu : '';
            },
            setValue: function (aValue) {
              aInstance.message.contenu = aValue;
            },
          },
          visuMessage: {
            btnPublic: {
              event(aNumeroMessage, aGauche) {
                UtilitaireMessagerie_1.UtilitaireMessagerie.afficherFenetreDestinatairesDeMessage(
                  aNumeroMessage,
                  aGauche,
                  false,
                );
              },
              hintPublic(aNumeroMessage, aGauche) {
                return UtilitaireMessagerie_1.UtilitaireMessagerie.getStrHintPublicMessagePromise(
                  aInstance,
                  aNumeroMessage,
                  aGauche,
                  false,
                  this.node,
                );
              },
            },
          },
          cbDestProfsUniquement: {
            getValue: function (aNumeroArticle) {
              return !!aInstance.listeSelectionDestProfsUniquement.getElementParNumero(
                aNumeroArticle,
              );
            },
            setValue: function (aNumeroArticle, aGenre, aValue) {
              if (!aValue) {
                if (aInstance.listeSelectionDestProfsUniquement.count() === 1) {
                  return;
                }
                const lIndice =
                  aInstance.listeSelectionDestProfsUniquement.getIndiceParNumeroEtGenre(
                    aNumeroArticle,
                  );
                if (lIndice >= 0) {
                  aInstance.listeSelectionDestProfsUniquement.remove(lIndice);
                }
              } else {
                if (
                  !aInstance.listeSelectionDestProfsUniquement.getElementParNumero(
                    aNumeroArticle,
                  )
                ) {
                  aInstance.listeSelectionDestProfsUniquement.add(
                    new ObjetElement_1.ObjetElement('', aNumeroArticle, aGenre),
                  );
                }
              }
            },
          },
          cbTypeDestinatairePourEleve: {
            getValue: function (aIdTypeDestinataire) {
              return aInstance._estDestinatairePossibleEstCocheEtActif(
                aIdTypeDestinataire,
              );
            },
            setValue: function (aIdTypeDestinataire, aValue) {
              const lTypeDestinataire =
                aInstance._getTypeDestinatairesPossiblesPourEleve(
                  aIdTypeDestinataire,
                );
              if (!!lTypeDestinataire && !!lTypeDestinataire.actif) {
                lTypeDestinataire.estCoche = aValue;
              }
            },
            getDisabled: function (aIdTypeDestinataire) {
              const lTypeDestinataire =
                aInstance._getTypeDestinatairesPossiblesPourEleve(
                  aIdTypeDestinataire,
                );
              return !lTypeDestinataire || !lTypeDestinataire.actif;
            },
            getLibelle: function (aIdTypeDestinataire) {
              const lTexte = [];
              const lTypeDestinataire =
                aInstance._getTypeDestinatairesPossiblesPourEleve(
                  aIdTypeDestinataire,
                );
              if (!!lTypeDestinataire) {
                lTexte.push(lTypeDestinataire.label);
                if (lTypeDestinataire.nb) {
                  lTexte.push(' (', lTypeDestinataire.nb, ')');
                }
              }
              return lTexte.join('');
            },
          },
          cbDestinataireDirecteur: {
            getValue() {
              return !!aInstance.estAvecDirecteur;
            },
            setValue(aValue) {
              aInstance.estAvecDirecteur = aValue;
            },
          },
          cbDestinataireEnseignant: {
            getValue() {
              return !!aInstance.estAvecEnseignant;
            },
            setValue(aValue) {
              aInstance.estAvecEnseignant = aValue;
            },
          },
          cbInclureResp2: {
            getValue() {
              let lListe = aInstance.param.ListeRessources;
              let lActif = false;
              lListe.parcourir((aDest) => {
                if (
                  aDest.getGenre() ===
                  Enumere_Ressource_1.EGenreRessource.Responsable
                ) {
                  lActif = aDest.Actif;
                }
              });
              return lActif;
            },
            setValue(aValue) {
              let lListe = aInstance.param.ListeRessources;
              lListe.parcourir((aDest) => {
                if (
                  aDest.getGenre() ===
                  Enumere_Ressource_1.EGenreRessource.Responsable
                ) {
                  aDest.Actif = aValue;
                }
              });
            },
          },
          btnSelectionPersonnel: {
            event() {
              const lFenetreSelectionPublic =
                ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
                  ObjetFenetre_SelectionPublic_1.ObjetFenetre_SelectionPublic,
                  {
                    pere: aInstance,
                    evenement: function (
                      aGenreRessource,
                      aListeRessourcesSelectionnees,
                      aNumeroBouton,
                    ) {
                      if (aNumeroBouton === 1) {
                        aInstance.param.listeSelectionnee =
                          aListeRessourcesSelectionnees;
                      }
                    },
                    initialiser: function (aInstance) {
                      const lListeCumuls =
                        new ObjetListeElements_1.ObjetListeElements();
                      lListeCumuls.add(
                        new ObjetElement_1.ObjetElement(
                          ObjetTraduction_1.GTraductions.getValeur(
                            'Fenetre_SelectionPublic.Cumul.Aucun',
                          ),
                          0,
                          ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.sans,
                          0,
                        ),
                      );
                      lListeCumuls.add(
                        new ObjetElement_1.ObjetElement(
                          ObjetTraduction_1.GTraductions.getValeur(
                            'actualites.Cumul.Fonction',
                          ),
                          0,
                          ObjetFenetre_SelectionPublic_1.TypeGenreCumulSelectionPublic.fonction,
                          1,
                        ),
                      );
                      aInstance.setListeCumuls(lListeCumuls);
                      aInstance.setOptionsFenetreSelectionRessource({
                        avecCocheRessources: true,
                      });
                    },
                  },
                );
              lFenetreSelectionPublic.setDonnees({
                listeRessources: aInstance.param.ListeRessources,
                listeRessourcesSelectionnees: aInstance.param.listeSelectionnee,
                genreRessource: Enumere_Ressource_1.EGenreRessource.Personnel,
                titre:
                  Enumere_Ressource_1.EGenreRessourceUtil.getTitreFenetreSelectionRessource(
                    Enumere_Ressource_1.EGenreRessource.Personnel,
                  ),
              });
            },
          },
          getNbrDest() {
            return aInstance.param.listeSelectionnee.count();
          },
          btnSignature: {
            event() {
              let lMessage = aInstance._getContent();
              aInstance.message.contenu =
                lMessage +
                aInstance.etatUtilisateurSco.messagerieSignature.signature;
              if (aInstance._autoriseTiny()) {
                const lEditor = TinyInit_1.TinyInit.get(aInstance.idContenuMsg);
                if (lEditor) {
                  lEditor.setContent(aInstance.message.contenu);
                }
              }
            },
          },
        });
      }
      setGenreDiscussion(aGenreDiscussion) {
        this.genreDiscussion = aGenreDiscussion;
      }
      _autorisePJ() {
        return this.optionsFenetre.avecPieceJointe;
      }
      _autoriseTiny() {
        return this.optionsFenetre.avecTiny && GNavigateur.withContentEditable;
      }
      construireInstances() {
        if (this._autorisePJ()) {
          this.identSelecteurPJ = this.add(
            ObjetSelecteurPJ_1.ObjetSelecteurPJ,
            this._evntSelecteurPJ.bind(this),
            this._initSelecteurPJ.bind(this),
          );
        }
        if (this.optionsFenetre.avecChoixDestinataires) {
          this.identDestinataire = this.add(
            ObjetDestinatairesMessagerie_1.ObjetDestinatairesMessagerie,
            null,
            null,
          );
        }
      }
      recupererDonnees() {
        this.listePJ =
          this._autorisePJ() && this.etatUtilisateurSco.listeDonnees
            ? MethodesObjet_1.MethodesObjet.dupliquer(
                this.etatUtilisateurSco.listeDonnees[
                  TypeHttpNotificationDonnes_1.TypeHttpNotificationDonnes
                    .THND_ListeDocJointEtablissement
                ],
              )
            : new ObjetListeElements_1.ObjetListeElements();
      }
      _infosDest(aNb, aHint) {
        return {
          nbDest: aNb,
          arrHint: aHint,
          hintDest: () => aHint.join('\r'),
        };
      }
      _formatterDonneesPourAffichage() {
        if (!this.optionsFenetre.avecChoixDestinataires) {
          return this._formatterDonneesParGenreRessource();
        }
      }
      _formatterDonneesParGenreRessource() {
        let lNb = 0;
        const lHint = [];
        switch (this.param.genreRessource) {
          case Enumere_Ressource_1.EGenreRessource.Classe:
          case Enumere_Ressource_1.EGenreRessource.Groupe: {
            const lEquipe = this._getListeDestinataires();
            let lNbEquipe = 0;
            let lHintEquipe = [];
            if (lEquipe) {
              lEquipe.setTri([
                ObjetTri_1.ObjetTri.init('Genre'),
                ObjetTri_1.ObjetTri.init('Position'),
              ]);
              lEquipe.trier();
              lNbEquipe = lEquipe.count();
              lHintEquipe = lEquipe.getTableauLibelles();
            }
            return { destinataires: this._infosDest(lNbEquipe, lHintEquipe) };
          }
          case Enumere_Ressource_1.EGenreRessource.Eleve: {
            const lThis = this;
            let lNbResp1 = 0,
              lNbResp2 = 0,
              lNbPP = 0,
              lNbTuteurs = 0,
              lNbEquipePeda = 0;
            let lHintResp1 = [],
              lHintResp2 = [],
              lHintPP = [],
              lHintTuteurs = [],
              lHintEquipePeda = [];
            for (
              let i = 0, lNbr = this.param.listeSelectionnee.count();
              i < lNbr;
              i++
            ) {
              const lElt = this.param.listeSelectionnee.get(i);
              if (lElt.avecDiscussion) {
                this.donneesDest.eleves.addElement(lElt);
                lNb++;
                lHint.push(lElt.getLibelle());
              }
              if (lElt.listeRessources) {
                for (
                  let j = 0, lNbrJ = lElt.listeRessources.count();
                  j < lNbrJ;
                  j++
                ) {
                  const lEltJ = lElt.listeRessources.get(j);
                  if (lEltJ.existeNumero() && lEltJ.avecDiscussion) {
                    switch (j) {
                      case 0:
                        if (
                          !this.donneesDest.respLegal1.getElementParNumero(
                            lEltJ.getNumero(),
                          )
                        ) {
                          lNbResp1++;
                          lHintResp1.push(lEltJ.getLibelle());
                          this.donneesDest.respLegal1.addElement(lEltJ);
                        }
                        break;
                      case 1:
                        if (
                          !this.donneesDest.respLegal2.getElementParNumero(
                            lEltJ.getNumero(),
                          )
                        ) {
                          lNbResp2++;
                          lHintResp2.push(lEltJ.getLibelle());
                          this.donneesDest.respLegal2.addElement(lEltJ);
                        }
                        break;
                    }
                    if (
                      !this.donneesDest.respLegaux.getElementParNumero(
                        lEltJ.getNumero(),
                      )
                    ) {
                      this.donneesDest.respLegaux.addElement(lEltJ);
                    }
                  }
                }
              }
              if (lElt.listePP) {
                lElt.listePP.parcourir((aPP) => {
                  if (
                    aPP.existeNumero() &&
                    aPP.avecDiscussion &&
                    !lThis.donneesDest.profsprincipaux.getElementParNumero(
                      aPP.getNumero(),
                    )
                  ) {
                    lThis.donneesDest.profsprincipaux.addElement(aPP);
                  }
                });
              }
              if (!!lElt.listeTuteurs) {
                lElt.listeTuteurs.parcourir((aTuteurEleve) => {
                  if (
                    aTuteurEleve.existeNumero() &&
                    aTuteurEleve.avecDiscussion &&
                    !lThis.donneesDest.tuteurs.getElementParNumero(
                      aTuteurEleve.getNumero(),
                    )
                  ) {
                    lThis.donneesDest.tuteurs.addElement(aTuteurEleve);
                  }
                });
              }
              if (!!lElt.listeEquipePeda) {
                lElt.listeEquipePeda.parcourir((aMembreEquipePeda) => {
                  if (
                    aMembreEquipePeda.existeNumero() &&
                    aMembreEquipePeda.avecDiscussion &&
                    !lThis.donneesDest.equipePeda.getElementParNumero(
                      aMembreEquipePeda.getNumero(),
                    )
                  ) {
                    lThis.donneesDest.equipePeda.addElement(aMembreEquipePeda);
                  }
                });
              }
            }
            if (
              !!this.donneesDest.profsprincipaux &&
              this.donneesDest.profsprincipaux.count() > 0
            ) {
              this.donneesDest.profsprincipaux.trier();
              lNbPP = this.donneesDest.profsprincipaux.count();
              lHintPP = this.donneesDest.profsprincipaux.getTableauLibelles();
            }
            if (
              !!this.donneesDest.tuteurs &&
              this.donneesDest.tuteurs.count() > 0
            ) {
              this.donneesDest.tuteurs.trier();
              lNbTuteurs = this.donneesDest.tuteurs.count();
              lHintTuteurs = this.donneesDest.tuteurs.getTableauLibelles();
            }
            if (
              !!this.donneesDest.equipePeda &&
              this.donneesDest.equipePeda.count() > 0
            ) {
              this.donneesDest.equipePeda.trier();
              lNbEquipePeda = this.donneesDest.equipePeda.count();
              lHintEquipePeda =
                this.donneesDest.equipePeda.getTableauLibelles();
            }
            return {
              eleves: this._infosDest(lNb, lHint),
              resp1: this._infosDest(lNbResp1, lHintResp1),
              resp2: this._infosDest(lNbResp2, lHintResp2),
              pp: this._infosDest(lNbPP, lHintPP),
              tuteurs: this._infosDest(lNbTuteurs, lHintTuteurs),
              equipePeda: this._infosDest(lNbEquipePeda, lHintEquipePeda),
            };
          }
          case Enumere_Ressource_1.EGenreRessource.Responsable:
          case Enumere_Ressource_1.EGenreRessource.Enseignant:
          case Enumere_Ressource_1.EGenreRessource.Personnel:
            if (
              [
                Enumere_Espace_1.EGenreEspace.Eleve,
                Enumere_Espace_1.EGenreEspace.Parent,
              ].includes(this.etatUtilisateurSco.GenreEspace)
            ) {
              for (
                let i = 0, lNbr = this.param.listeSelectionnee.count();
                i < lNbr;
                i++
              ) {
                const lElt = this.param.listeSelectionnee.get(i);
                if (lElt.avecDiscussion) {
                  lNb++;
                  lHint.push(lElt.getLibelle());
                  this.donneesDest.destinataires.addElement(lElt);
                }
              }
            } else {
              for (
                let i = 0, lNbr = this.param.listeSelectionnee.count();
                i < lNbr;
                i++
              ) {
                const lElt = this.param.listeSelectionnee.get(i);
                lNb++;
                lHint.push(lElt.getLibelle());
              }
            }
            return { destinataires: this._infosDest(lNb, lHint) };
          default:
            break;
        }
      }
      _setDestinataires() {
        if (!this.optionsFenetre.avecChoixDestinataires) {
          this._setDestinatairesParGenreRessource();
        } else {
          const lInstanceDest = this.getInstance(this.identDestinataire);
          lInstanceDest.setDonnees(
            this.param.genresRessources,
            this.avecIndicationDiscussionInterdit,
            this.param.avecListeDiffusion,
          );
        }
      }
      _getListeTypeDestinatairesPossiblesPourEleve() {
        const lListeTypesDestinataires = [];
        if (
          this.param.genreRessource ===
          Enumere_Ressource_1.EGenreRessource.Eleve
        ) {
          let lDestinataireEleve;
          const lAutresDestinataires = [];
          const lAvecEleves =
            UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
              Enumere_Ressource_1.EGenreRessource.Eleve,
            );
          const lAvecParents =
            UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
              Enumere_Ressource_1.EGenreRessource.Responsable,
            );
          const lAvecPP =
            UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
              Enumere_Ressource_1.EGenreRessource.Enseignant,
            );
          const lAvecTuteurs =
            UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
              Enumere_Ressource_1.EGenreRessource.Enseignant,
            );
          const lAvecEquipePeda =
            UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
              Enumere_Ressource_1.EGenreRessource.Enseignant,
            );
          if (this.destinataires.eleves.nbDest > 1) {
            lDestinataireEleve = {
              hint: lAvecEleves
                ? this.destinataires.eleves.hintDest()
                : ObjetTraduction_1.GTraductions.getValeur(
                    'Messagerie.CommEleveInactif',
                  ),
              nb: this.destinataires.eleves.nbDest,
              id: this.idTypesDestinataire.eleve,
              label:
                ObjetTraduction_1.GTraductions.getValeur('Messagerie.Eleves'),
              actif: lAvecEleves,
              estCoche: false,
            };
            if (this.destinataires.resp1.nbDest > 0) {
              lAutresDestinataires.push({
                hint: lAvecParents
                  ? this.destinataires.resp1.hintDest()
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.CommParentInactif',
                    ),
                nb: this.destinataires.resp1.nbDest,
                id: this.idTypesDestinataire.responsable1,
                label: ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.Resp1Legal',
                ),
                actif: lAvecParents,
                estCoche: false,
              });
            }
            if (this.destinataires.resp2.nbDest > 0) {
              lAutresDestinataires.push({
                hint: lAvecParents
                  ? this.destinataires.resp2.hintDest()
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.CommParentInactif',
                    ),
                nb: this.destinataires.resp2.nbDest,
                id: this.idTypesDestinataire.responsable2,
                label: ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.Resp2Legal',
                ),
                actif: lAvecParents,
                estCoche: false,
              });
            }
          } else {
            lDestinataireEleve = {
              hint: lAvecEleves
                ? ''
                : ObjetTraduction_1.GTraductions.getValeur(
                    'Messagerie.CommEleveInactif',
                  ),
              nb: null,
              id: this.idTypesDestinataire.eleve,
              label: this.destinataires.eleves.hintDest(),
              actif: lAvecEleves,
              estCoche: false,
            };
            if (this.destinataires.resp1.nbDest > 0) {
              lAutresDestinataires.push({
                hint: lAvecParents
                  ? ''
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.CommParentInactif',
                    ),
                nb: null,
                id: this.idTypesDestinataire.responsable1,
                label: this.destinataires.resp1.hintDest(),
                actif: lAvecParents,
                estCoche: false,
              });
            }
            if (this.destinataires.resp2.nbDest > 0) {
              lAutresDestinataires.push({
                hint: lAvecParents
                  ? ''
                  : ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.CommParentInactif',
                    ),
                nb: null,
                id: this.idTypesDestinataire.responsable2,
                label: this.destinataires.resp2.hintDest(),
                actif: lAvecParents,
                estCoche: false,
              });
            }
          }
          let lALaLigneAuProchain = true;
          if (
            lAvecPP &&
            this.destinataires.pp &&
            this.destinataires.pp.nbDest > 0
          ) {
            let lHintPP,
              lLabelPP,
              lNbPP = null;
            if (this.destinataires.pp.nbDest > 1) {
              lHintPP = this.destinataires.pp.hintDest();
              lLabelPP = ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.ProfsPrincipaux',
              );
              lNbPP = this.destinataires.pp.nbDest;
            } else {
              lHintPP = ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.ProfPrincipal',
              );
              lLabelPP =
                this.destinataires.pp.hintDest() +
                ' (' +
                ObjetTraduction_1.GTraductions.getValeur('Messagerie.abbrPP') +
                ')';
            }
            lAutresDestinataires.push({
              hint: lHintPP,
              nb: lNbPP,
              id: this.idTypesDestinataire.profsprincipaux,
              label: lLabelPP,
              actif: lAvecPP,
              estCoche: false,
              aLaLigne: lALaLigneAuProchain,
            });
            lALaLigneAuProchain = false;
          }
          if (
            lAvecTuteurs &&
            this.destinataires.tuteurs &&
            this.destinataires.tuteurs.nbDest > 0
          ) {
            let lHintTuteur,
              lLabelTuteur,
              lNbTuteur = null;
            if (this.destinataires.tuteurs.nbDest > 1) {
              lHintTuteur = this.destinataires.tuteurs.hintDest();
              lLabelTuteur =
                ObjetTraduction_1.GTraductions.getValeur('Messagerie.Tuteurs');
              lNbTuteur = this.destinataires.tuteurs.nbDest;
            } else {
              lHintTuteur =
                ObjetTraduction_1.GTraductions.getValeur('Messagerie.Tuteur');
              lLabelTuteur =
                this.destinataires.tuteurs.hintDest() +
                ' (' +
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.abbrTuteur',
                ) +
                ')';
            }
            lAutresDestinataires.push({
              hint: lHintTuteur,
              nb: lNbTuteur,
              id: this.idTypesDestinataire.tuteurs,
              label: lLabelTuteur,
              actif: lAvecTuteurs,
              estCoche: false,
              aLaLigne: lALaLigneAuProchain,
            });
          }
          if (
            lAvecEquipePeda &&
            this.destinataires.equipePeda &&
            this.destinataires.equipePeda.nbDest > 0
          ) {
            lALaLigneAuProchain = true;
            lAutresDestinataires.push({
              hint: this.destinataires.equipePeda.hintDest(),
              nb: this.destinataires.equipePeda.nbDest,
              id: this.idTypesDestinataire.equipePedagogique,
              label: ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.EquipePeda',
              ),
              actif: lAvecEquipePeda,
              estCoche: false,
              aLaLigne: lALaLigneAuProchain,
            });
          }
          lListeTypesDestinataires.push(lDestinataireEleve);
          lListeTypesDestinataires.push(lAutresDestinataires);
        }
        return lListeTypesDestinataires;
      }
      _getTypeDestinatairesPossiblesPourEleve(aIdTypeDestinataire) {
        let lResult = null;
        if (
          this.param.genreRessource ===
          Enumere_Ressource_1.EGenreRessource.Eleve
        ) {
          if (!this.cache_listDestPourEleves) {
            return lResult;
          }
          const lListeDestinatairesPossibles = this.cache_listDestPourEleves;
          let lListeCompletesAPlat = [];
          lListeCompletesAPlat.push(lListeDestinatairesPossibles[0]);
          lListeCompletesAPlat = lListeCompletesAPlat.concat(
            lListeDestinatairesPossibles[1],
          );
          for (let i = 0; i < lListeCompletesAPlat.length; i++) {
            if (lListeCompletesAPlat[i].id === aIdTypeDestinataire) {
              lResult = lListeCompletesAPlat[i];
              break;
            }
          }
        }
        return lResult;
      }
      _estDestinatairePossibleEstCocheEtActif(aIdTypeDestinataire) {
        const lTypeDestinataire =
          this._getTypeDestinatairesPossiblesPourEleve(aIdTypeDestinataire);
        return (
          !!lTypeDestinataire &&
          lTypeDestinataire.estCoche &&
          lTypeDestinataire.actif
        );
      }
      _setDestinatairesParGenreRessource() {
        function _getTraducGenreRessource(aGenreRessource) {
          switch (aGenreRessource) {
            case Enumere_Ressource_1.EGenreRessource.Classe:
            case Enumere_Ressource_1.EGenreRessource.Groupe:
              return ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.EquipePeda',
              );
            case Enumere_Ressource_1.EGenreRessource.Responsable:
              return ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.Parents',
              );
            case Enumere_Ressource_1.EGenreRessource.Enseignant:
              return ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.Profs',
              );
            case Enumere_Ressource_1.EGenreRessource.Personnel:
              return ObjetTraduction_1.GTraductions.getValeur(
                'Messagerie.Personnels',
              );
            default:
              return '';
          }
        }
        this.listeSelectionDestProfsUniquement =
          new ObjetListeElements_1.ObjetListeElements();
        this.cache_listDestPourEleves = null;
        let lAvecChoixResponsable2 = this.optionsFenetre.avecChoixResponsable2;
        const T = [];
        if (this.etatUtilisateurSco.pourPrimaire()) {
          if (this.message.destinataireMairie) {
            T.push(
              '<div class="m-left-xl m-bottom-l">',
              ObjetTraduction_1.GTraductions.getValeur(
                'fenetreCommunication.personnelMairie',
              ),
              ' : <ie-bouton class="small-bt" ie-model="btnSelectionPersonnel">...</ie-bouton> <span ie-html="getNbrDest"></span></div>',
            );
            T.push(
              '<div class="m-bottom-l">',
              UtilitaireMessagerie_1.UtilitaireMessagerie.composeMettreEnCopie({
                avecDirection: true,
                avecEnseigantDEleve: true,
              }),
              '</div>',
            );
          } else {
            if (
              UtilitaireMessagerie_1.UtilitaireMessagerie.avecListeDestinatairesProfsStatique()
            ) {
              const lListeUtil =
                UtilitaireMessagerie_1.UtilitaireMessagerie.getListeDestProfsDiscussionPrimEleveFormat();
              if (lListeUtil && lListeUtil.count() > 0) {
                T.push(
                  IE.jsx.str(
                    'div',
                    { class: 'flex-contain cols m-left-xl m-top-l' },
                    (H) => {
                      const lNb = lListeUtil.count();
                      lListeUtil.parcourir((aProf) => {
                        if (lNb === 1 || aProf.estPrincipal) {
                          this.listeSelectionDestProfsUniquement.add(aProf);
                        }
                        H.push(
                          IE.jsx.str(
                            'ie-checkbox',
                            {
                              'ie-model': (0, jsx_1.jsxFuncAttr)(
                                'cbDestProfsUniquement',
                                [aProf.getNumero(), aProf.getGenre()],
                              ),
                              disabled: lNb === 1 ? 'disabled' : false,
                              class: 'p-bottom',
                            },
                            aProf.getLibelle(),
                          ),
                        );
                      });
                    },
                  ),
                );
              } else {
                T.push(
                  IE.jsx.str(
                    'span',
                    null,
                    ObjetTraduction_1.GTraductions.getValeur(
                      'Fenetre_SelectionPublic.AucunDestinataire',
                    ),
                  ),
                );
              }
            }
            if (!!this.param.ListeRessources) {
              T.push('<div class="flex-contain cols m-bottom-l flex-gap">');
              let lListeDestinatairesAAfficher = this.param.ListeRessources;
              let lListeChoixProfs = null;
              if (
                this.etatUtilisateurSco.GenreEspace ===
                Enumere_Espace_1.EGenreEspace.PrimParent
              ) {
                lListeChoixProfs = this.param.ListeRessources.getListeElements(
                  (D) => {
                    return (
                      D.getGenre() ===
                      Enumere_Ressource_1.EGenreRessource.Enseignant
                    );
                  },
                );
                if (lListeChoixProfs.count() === 1) {
                  lListeChoixProfs = null;
                } else {
                  this.listeSelectionDestProfsUniquement.add(
                    lListeChoixProfs.get(0),
                  );
                  lListeDestinatairesAAfficher =
                    this.param.ListeRessources.getListeElements((D) => {
                      return (
                        D.getGenre() !==
                        Enumere_Ressource_1.EGenreRessource.Enseignant
                      );
                    });
                }
              }
              if (lListeChoixProfs) {
                T.push(
                  '<div class="flex-contain flex-wrap flex-gap m-left-xl m-top-l">',
                );
                lListeChoixProfs.parcourir((D) => {
                  T.push(
                    '<ie-checkbox',
                    ObjetHtml_1.GHtml.composeAttr(
                      'ie-model',
                      'cbDestProfsUniquement',
                      [D.getNumero(), D.getGenre()],
                    ),
                    '>',
                    D.getLibelle(),
                    '</ie-checkbox>',
                  );
                });
                T.push('</div>');
              }
              lListeDestinatairesAAfficher.parcourir((D) => {
                if (
                  lAvecChoixResponsable2 &&
                  D.getGenre() ===
                    Enumere_Ressource_1.EGenreRessource.Responsable
                ) {
                  T.push(
                    '<ie-checkbox ',
                    ObjetHtml_1.GHtml.composeAttr('ie-model', 'cbInclureResp2'),
                    ' class="PetitEspaceHaut">',
                    D.getLibelle(),
                    '</ie-checkbox>',
                  );
                } else {
                  T.push('<label class="m-left-xl">');
                  T.push(D.getLibelle());
                  T.push('</label>');
                }
              });
              T.push('</div>');
            }
            if (
              UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
                Enumere_Ressource_1.EGenreRessource.Personnel,
              )
            ) {
              T.push(
                UtilitaireMessagerie_1.UtilitaireMessagerie.composeMettreEnCopie(
                  { avecDirection: true },
                ),
              );
            }
          }
        } else {
          switch (this.param.genreRessource) {
            case Enumere_Ressource_1.EGenreRessource.Eleve: {
              this.cache_listDestPourEleves =
                this._getListeTypeDestinatairesPossiblesPourEleve();
              const lAffEleve = this.cache_listDestPourEleves[0];
              const lAffAutres = this.cache_listDestPourEleves[1];
              T.push('<div class="NoWrap" style="width:100%;">');
              T.push(this._composeBlockGenreDestinataire(lAffEleve));
              T.push('<div class="InlineBlock AlignementHaut">');
              for (let i = 0; i < lAffAutres.length; i++) {
                T.push(this._composeBlockGenreDestinataire(lAffAutres[i]));
              }
              T.push('</div>');
              T.push('</div>');
              break;
            }
            case Enumere_Ressource_1.EGenreRessource.Responsable:
            case Enumere_Ressource_1.EGenreRessource.Enseignant:
            case Enumere_Ressource_1.EGenreRessource.Personnel:
              if (this.destinataires.destinataires.nbDest > 1) {
                T.push(
                  '<div title="',
                  this.destinataires.destinataires.hintDest(),
                  '">',
                  _getTraducGenreRessource(this.param.genreRessource),
                  ' (',
                  this.destinataires.destinataires.nbDest,
                  ')',
                  '</div>',
                );
              } else {
                T.push(
                  '<div>',
                  this.destinataires.destinataires.hintDest(),
                  '</div>',
                );
              }
              break;
            case Enumere_Ressource_1.EGenreRessource.Classe:
            case Enumere_Ressource_1.EGenreRessource.Groupe:
              if (this.destinataires.destinataires.nbDest > 1) {
                T.push(
                  '<div title="',
                  this.destinataires.destinataires.hintDest(),
                  '">',
                  _getTraducGenreRessource(this.param.genreRessource),
                  ' (',
                  this.destinataires.destinataires.nbDest,
                  ')',
                  '</div>',
                );
              } else {
                T.push(
                  '<div>',
                  _getTraducGenreRessource(this.param.genreRessource),
                  ' (',
                  this.destinataires.destinataires.hintDest(),
                  ')',
                  '</div>',
                );
              }
              break;
            default:
              break;
          }
        }
        ObjetHtml_1.GHtml.setHtml(this.id_destinataires, T.join(''), {
          controleur: this.controleur,
        });
      }
      _getListeDestinataires() {
        if (this.optionsFenetre.avecChoixDestinataires) {
          return this.getInstance(
            this.identDestinataire,
          ).getListeDestinataires();
        }
        let lNbr;
        let lListe = new ObjetListeElements_1.ObjetListeElements();
        switch (this.param.genreRessource) {
          case Enumere_Ressource_1.EGenreRessource.Eleve: {
            const lAvecEleves = this._estDestinatairePossibleEstCocheEtActif(
              this.idTypesDestinataire.eleve,
            );
            const lAvecResp1 = this._estDestinatairePossibleEstCocheEtActif(
              this.idTypesDestinataire.responsable1,
            );
            const lAvecResp2 = this._estDestinatairePossibleEstCocheEtActif(
              this.idTypesDestinataire.responsable2,
            );
            const lAvecPP = this._estDestinatairePossibleEstCocheEtActif(
              this.idTypesDestinataire.profsprincipaux,
            );
            const lAvecTuteurs = this._estDestinatairePossibleEstCocheEtActif(
              this.idTypesDestinataire.tuteurs,
            );
            const lAvecEquipePeda =
              this._estDestinatairePossibleEstCocheEtActif(
                this.idTypesDestinataire.equipePedagogique,
              );
            if (lAvecEleves) {
              lListe.add(this.donneesDest.eleves);
            }
            if (lAvecResp1 && lAvecResp2) {
              lListe.add(this.donneesDest.respLegaux);
            } else {
              if (lAvecResp1) {
                lListe.add(this.donneesDest.respLegal1);
              }
              if (lAvecResp2) {
                lListe.add(this.donneesDest.respLegal2);
              }
            }
            if (lAvecPP) {
              lListe.add(this.donneesDest.profsprincipaux);
            }
            if (lAvecTuteurs) {
              lListe.add(this.donneesDest.tuteurs);
            }
            if (lAvecEquipePeda) {
              lListe.add(this.donneesDest.equipePeda);
            }
            break;
          }
          case Enumere_Ressource_1.EGenreRessource.Responsable:
          case Enumere_Ressource_1.EGenreRessource.Enseignant:
          case Enumere_Ressource_1.EGenreRessource.Personnel:
            if (
              this.param.genreRessource ===
                Enumere_Ressource_1.EGenreRessource.Enseignant &&
              UtilitaireMessagerie_1.UtilitaireMessagerie.avecListeDestinatairesProfsStatique() &&
              this.listeSelectionDestProfsUniquement &&
              this.listeSelectionDestProfsUniquement.count() > 0
            ) {
              lListe.add(this.listeSelectionDestProfsUniquement);
            } else if (
              [
                Enumere_Espace_1.EGenreEspace.Eleve,
                Enumere_Espace_1.EGenreEspace.Parent,
              ].includes(this.etatUtilisateurSco.GenreEspace)
            ) {
              lListe.add(this.donneesDest.destinataires);
              if (this.inclureResponsablesDeleguesClasse) {
                lListe.add(this.donneesDest.delegues);
              }
            } else if (
              [Enumere_Espace_1.EGenreEspace.PrimParent].includes(
                this.etatUtilisateurSco.GenreEspace,
              ) &&
              this.param.genreRessource ===
                Enumere_Ressource_1.EGenreRessource.Enseignant
            ) {
              if (
                this.listeSelectionDestProfsUniquement &&
                this.listeSelectionDestProfsUniquement.count() > 0
              ) {
                this.param.listeSelectionnee.removeFilter((D) => {
                  if (
                    D.getGenre() ===
                      Enumere_Ressource_1.EGenreRessource.Enseignant &&
                    !this.listeSelectionDestProfsUniquement.getElementParNumero(
                      D.getNumero(),
                    )
                  ) {
                    return true;
                  }
                  return false;
                });
              }
              lListe.add(this.param.listeSelectionnee);
            } else {
              lListe.add(this.param.listeSelectionnee);
            }
            break;
          case Enumere_Ressource_1.EGenreRessource.Classe:
          case Enumere_Ressource_1.EGenreRessource.Groupe:
            lListe = this.param.listeSelectionnee
              .get(0)
              .listeRessources.getListeElements((aElement) => {
                return !!(aElement && aElement.avecDiscussion);
              });
            lNbr = lListe.count();
            lListe = lListe.getListeElements((aElement) => {
              return (
                ![
                  Enumere_Espace_1.EGenreEspace.Professeur,
                  Enumere_Espace_1.EGenreEspace.Etablissement,
                  Enumere_Espace_1.EGenreEspace.Administrateur,
                  Enumere_Espace_1.EGenreEspace.PrimProfesseur,
                  Enumere_Espace_1.EGenreEspace.PrimDirection,
                ].includes(this.etatUtilisateurSco.GenreEspace) ||
                lNbr === 1 ||
                this.etatUtilisateurSco.getUtilisateur().getNumero() !==
                  aElement.getNumero()
              );
            });
            break;
          default:
            break;
        }
        if (this.etatUtilisateurSco.pourPrimaire()) {
          if (this.estAvecDirecteur) {
            lListe.addElement(
              new ObjetElement_1.ObjetElement(
                '',
                0,
                Enumere_Ressource_1.EGenreRessource.Personnel,
              ),
            );
          }
          if (this.estAvecEnseignant) {
            lListe.addElement(
              new ObjetElement_1.ObjetElement(
                '',
                0,
                Enumere_Ressource_1.EGenreRessource.Enseignant,
              ),
            );
          }
        }
        for (let i = 0, lNbr = lListe.count(); i < lNbr; i++) {
          lListe.get(i).setEtat(Enumere_Etat_1.EGenreEtat.Modification);
        }
        return lListe;
      }
      setDonnees(aParam) {
        if (
          !UtilitaireMessagerie_1.UtilitaireMessagerie.controleMessagerieDesactivee()
        ) {
          this.fermer();
          return;
        }
        this.message = new ObjetElement_1.ObjetElement();
        $.extend(this.message, {
          objet: '',
          destinataires: new ObjetListeElements_1.ObjetListeElements(),
          contenu: '',
          placeholder: '',
          estMsgInitial: true,
        });
        if (aParam.message) {
          $.extend(this.message, aParam.message);
        }
        this.avecIndicationDiscussionInterdit =
          aParam.avecIndicationDiscussionInterdit;
        this.donneesDest = {
          eleves: new ObjetListeElements_1.ObjetListeElements(),
          respLegal1: new ObjetListeElements_1.ObjetListeElements(),
          respLegal2: new ObjetListeElements_1.ObjetListeElements(),
          respLegaux: new ObjetListeElements_1.ObjetListeElements(),
          profsprincipaux: new ObjetListeElements_1.ObjetListeElements(),
          tuteurs: new ObjetListeElements_1.ObjetListeElements(),
          equipePeda: new ObjetListeElements_1.ObjetListeElements(),
        };
        if (
          [
            Enumere_Espace_1.EGenreEspace.Eleve,
            Enumere_Espace_1.EGenreEspace.Parent,
            Enumere_Espace_1.EGenreEspace.PrimParent,
          ].includes(this.etatUtilisateurSco.GenreEspace)
        ) {
          $.extend(this.donneesDest, {
            destinataires: new ObjetListeElements_1.ObjetListeElements(),
            delegues: aParam.listeDelegues,
          });
          this.avecCBInclureDelegues = aParam.avecCBInclureDelegues;
        }
        const $contenuMessage = $('#' + this.idContenuMsg.escapeJQ());
        if (!!this.message.placeholder) {
          $contenuMessage.attr('placeholder', this.message.placeholder);
        }
        $contenuMessage.val(this.message.contenu);
        this.param = aParam;
        if (this._autoriseTiny()) {
          this._initTiny();
        }
        this.destinataires = this._formatterDonneesPourAffichage();
        this.setOptionsFenetre({ largeur: 600 });
        this.afficher();
        this._setDestinataires();
        if (this.param.avecAffichageChampDestinataires === false) {
          $('#' + this.id_destinataires_conteneur.escapeJQ()).hide();
        }
        if (this._autorisePJ()) {
          this.message.listeFichiers =
            new ObjetListeElements_1.ObjetListeElements();
          this.getInstance(this.identSelecteurPJ).setDonnees({
            listePJ: this.message.listeFichiers,
            listeTotale: this.listePJ,
            idContextFocus: this.Nom,
          });
          this._actualiserSelecteurPJ();
        }
        if (this.optionsFenetre.transfertMessage && this.param.transfert) {
          this.message.objet = this.param.transfert.objet;
          $('#' + this.idDiscussion.escapeJQ())
            .show()
            .ieHtml(
              UtilitaireMessagerie_1.UtilitaireMessagerie.getDiscussion({
                listeMessages: this.param.transfert.listeMessages,
                btnModel: 'visuMessage.btnPublic',
              }),
              { controleur: this.controleur },
            );
        }
        this.$refreshSelf();
        this.positionnerFenetre();
      }
      actualiserListeCloud() {
        if (this.etatUtilisateurSco.avecCloudDisponibles()) {
          ObjetHtml_1.GHtml.setHtml(
            this.idLibelleCloud,
            UtilitaireUrl_1.UtilitaireUrl.construireListeUrls(
              this.message.listeFichiers,
              {
                genreFiltre: Enumere_DocumentJoint_1.EGenreDocumentJoint.Cloud,
                genreRessource: Enumere_Ressource_1.EGenreRessource.Evaluation,
                separateur: ' ',
                IEModelChips: 'chipsFichierCloud',
              },
            ),
            { controleur: this.controleur },
          );
        }
      }
      composeContenu() {
        const T = [];
        T.push(this._composeZoneEnteteMsg());
        T.push(this._composeZoneContenuMsg());
        if (this.optionsFenetre.transfertMessage) {
          T.push(
            '<div class="EspaceHaut">',
            '<div id="',
            this.idDiscussion,
            '" style="overflow-y: auto; max-height:200px; width:100%;"></div>',
            '</div>',
          );
        }
        return T.join('');
      }
      controlerSaisieMsg(aListeDestinataires) {
        const lResult = {
          estOk: true,
          destinatairesKo: false,
          contenuKo: false,
          content: '',
        };
        if (this.message.avecControleNbDest !== false) {
          if (!aListeDestinataires || aListeDestinataires.count() === 0) {
            $.extend(lResult, { estOk: false, destinatairesKo: true });
          }
        }
        lResult.content = this._getContent();
        if (lResult.content.trim() === '') {
          $.extend(lResult, { estOk: false, contenuKo: true });
        }
        return lResult;
      }
      surValidation(aNumeroBouton) {
        const lListeDest = this._getListeDestinataires();
        const lControle = this.controlerSaisieMsg(lListeDest);
        this.message.contenu = lControle.content;
        this.message.destinataires = lListeDest;
        let lMessageDestinatairesFiltree =
          this.message.destinataires.getListeElements((aElt) => {
            return aElt.Actif;
          });
        const lParametres = {
          objet: this.message.objet,
          contenu: this.message.contenu,
          listeDestinataires: this.optionsFenetre.avecChoixResponsable2
            ? lMessageDestinatairesFiltree
            : this.message.destinataires,
          listeFichiers: this.message.listeFichiers,
          avecControleNbDest: this.message.avecControleNbDest,
          commande: this.message.commande,
          estCreationCarnetLiaison: this.message.estCreationCarnetLiaison,
          estCreationDossierDecrochage:
            this.message.estCreationDossierDecrochage,
          eleveCarnetLiaison: this.message.eleveCarnetLiaison,
          dossier: this.message.dossier,
          listeMessagesTransfert: this.message.listeMessagesTransfert,
          genreDiscussion: this.genreDiscussion,
        };
        if (aNumeroBouton === 1) {
          if (lControle.estOk) {
            this.moteurMessagerie.requeteSaisieMessage(lParametres).then(
              (aResult) => {
                if (aResult && aResult.saisieMessageOK) {
                  this.fermer();
                  this.callback.appel(aNumeroBouton, this.message, this, true);
                }
              },
              () => {},
            );
          } else {
            GApplication.getMessage().afficher({
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Information,
              message: lControle.destinatairesKo
                ? ObjetTraduction_1.GTraductions.getValeur(
                    'Messagerie.MsgAucunDestinataire',
                  )
                : lControle.contenuKo
                  ? ObjetTraduction_1.GTraductions.getValeur(
                      'Messagerie.MsgAucunContenu',
                    )
                  : '',
            });
          }
        } else {
          Promise.resolve()
            .then(() => {
              if (this.optionsFenetre.avecSauvegardeBrouillon) {
                return this.moteurMessagerie.sauvegarderCreationBrouillon(
                  lParametres,
                );
              }
            })
            .finally(() => {
              this.fermer();
              this.callback.appel(aNumeroBouton, this.message, this, true);
            });
        }
      }
      static creerFenetreDiscussion(aInstance, aDonnees, aOptions) {
        if (
          !UtilitaireMessagerie_1.UtilitaireMessagerie.controleMessagerieDesactivee()
        ) {
          return;
        }
        const lOptions = Object.assign(
          {
            avecSauvegardeBrouillon: true,
            avecChoixDestinataires: [
              Enumere_Espace_1.EGenreEspace.Professeur,
              Enumere_Espace_1.EGenreEspace.Mobile_Professeur,
              Enumere_Espace_1.EGenreEspace.Etablissement,
              Enumere_Espace_1.EGenreEspace.Mobile_Etablissement,
              Enumere_Espace_1.EGenreEspace.Administrateur,
              Enumere_Espace_1.EGenreEspace.Mobile_Administrateur,
              Enumere_Espace_1.EGenreEspace.PrimDirection,
              Enumere_Espace_1.EGenreEspace.Mobile_PrimDirection,
              Enumere_Espace_1.EGenreEspace.Accompagnant,
              Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
              Enumere_Espace_1.EGenreEspace.PrimProfesseur,
              Enumere_Espace_1.EGenreEspace.Mobile_PrimProfesseur,
              Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
              Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
              Enumere_Espace_1.EGenreEspace.Tuteur,
              Enumere_Espace_1.EGenreEspace.Mobile_Tuteur,
            ].includes(GEtatUtilisateur.GenreEspace),
            listeEtiquettes: null,
            estCreationCarnetLiaison: false,
            estCreationDossierDecrochage: false,
            eleveCarnetLiaison: null,
            dossier: null,
          },
          aOptions,
        );
        const lDonnees = Object.assign(
          {
            genresRessources: [],
            message: {
              objet: '',
              contenu: '',
              placeholder: '',
              messageAvertissement: '',
              listeEtiquettes: lOptions.listeEtiquettes,
              estCreationCarnetLiaison: lOptions.estCreationCarnetLiaison,
              estCreationDossierDecrochage:
                lOptions.estCreationDossierDecrochage,
              eleveCarnetLiaison: lOptions.eleveCarnetLiaison,
              dossier: lOptions.dossier,
            },
            avecIndicationDiscussionInterdit: [
              Enumere_Espace_1.EGenreEspace.Professeur,
              Enumere_Espace_1.EGenreEspace.Etablissement,
              Enumere_Espace_1.EGenreEspace.Administrateur,
              Enumere_Espace_1.EGenreEspace.Accompagnant,
              Enumere_Espace_1.EGenreEspace.Tuteur,
            ].includes(GEtatUtilisateur.GenreEspace),
          },
          aDonnees,
        );
        if (
          UtilitaireMessagerie_1.UtilitaireMessagerie.avecListeDestinatairesProfsStatique()
        ) {
          lOptions.avecChoixDestinataires = false;
          lDonnees.genreRessource =
            Enumere_Ressource_1.EGenreRessource.Enseignant;
          lDonnees.listeSelectionnee =
            new ObjetListeElements_1.ObjetListeElements();
        }
        const lFenetre = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_Message,
          { pere: aInstance },
          { avecChoixDestinataires: lOptions.avecChoixDestinataires },
        );
        if (lOptions.avecSauvegardeBrouillon) {
          lFenetre.setOptionsFenetre({
            avecSauvegardeBrouillon: lOptions.avecSauvegardeBrouillon,
          });
        }
        if (lOptions.titreFenetre) {
          lFenetre.setOptionsFenetre({ titre: lOptions.titreFenetre });
        }
        lFenetre.setDonnees(lDonnees);
      }
      static getRessourcesDefaut() {
        return [
          {
            genre: Enumere_Ressource_1.EGenreRessource.Eleve,
            getDisabled: function () {
              return !UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
                Enumere_Ressource_1.EGenreRessource.Eleve,
              );
            },
          },
          {
            genre: Enumere_Ressource_1.EGenreRessource.Responsable,
            getDisabled: () => {
              return !(
                UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
                  Enumere_Ressource_1.EGenreRessource.Responsable,
                ) &&
                (GEtatUtilisateur.GenreEspace !==
                  Enumere_Espace_1.EGenreEspace.Parent ||
                  (GApplication.getObjetParametres()
                    .ActivationMessagerieEntreParents &&
                    GApplication.getEtatUtilisateur().Identification.ressource
                      .avecDiscussionResponsables))
              );
            },
          },
          {
            genre: Enumere_Ressource_1.EGenreRessource.Enseignant,
            getDisabled: function () {
              return !UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
                Enumere_Ressource_1.EGenreRessource.Enseignant,
              );
            },
          },
          {
            genre: Enumere_Ressource_1.EGenreRessource.Personnel,
            getDisabled: function () {
              return !UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
                Enumere_Ressource_1.EGenreRessource.Personnel,
              );
            },
          },
        ];
      }
      static creerDiscussionRaccourciPrimEleve() {
        ObjetFenetre_Message.creerFenetreDiscussion(
          {},
          {
            genresRessources: [
              {
                genre: Enumere_Ressource_1.EGenreRessource.Enseignant,
                getDisabled() {
                  return !UtilitaireMessagerie_1.UtilitaireMessagerie.estGenreDestinataireAutorise(
                    Enumere_Ressource_1.EGenreRessource.Enseignant,
                  );
                },
              },
            ],
            avecIndicationDiscussionInterdit: true,
            avecListeDiffusion: false,
          },
          { avecSauvegardeBrouillon: true, avecChoixDestinataires: true },
        );
      }
      _composeBlockGenreDestinataire(aElt) {
        const lResult = [];
        if (!!aElt.aLaLigne) {
          lResult.push('<br/>');
        }
        lResult.push(
          '<div class="InlineBlock AlignementHaut" title="',
          ObjetChaine_1.GChaine.toTitle(aElt.hint),
          '" style="padding-right:10px; padding-bottom: 5px;">',
        );
        lResult.push(
          '<ie-checkbox ie-model="cbTypeDestinatairePourEleve(',
          aElt.id,
          ')">',
        );
        lResult.push('</ie-checkbox>');
        lResult.push('</div>');
        return lResult.join('');
      }
      _initSelecteurPJ(aInstance) {
        aInstance.setOptions({
          genrePJ: Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
          title: ObjetTraduction_1.GTraductions.getValeur('Messagerie.HintPJ'),
          maxFiles: 0,
          multiple: true,
          avecMenuContextuel: false,
          maxSize: this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.tailleMaxDocJointEtablissement,
          ),
          ouvrirFenetreChoixTypesAjout: true,
          optionsCloud: {
            avecCloud: true,
            callbackChoixFichierParFichier:
              this.surAjoutUnFichierCloud.bind(this),
            callbackChoixFichierFinal:
              this.surAjoutFinalFichiersClouds.bind(this),
          },
          idLibellePJ: this.idLibellePJ,
          avecAjoutExistante: true,
          avecEtatSaisie: false,
          avecBoutonSupp: true,
        });
      }
      surAjoutUnFichierCloud(aNouvelElement) {
        this.message.listeFichiers.addElement(aNouvelElement);
        this.listePJ.addElement(aNouvelElement);
      }
      surAjoutFinalFichiersClouds() {
        this.actualiserListeCloud();
        this.message.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
      }
      _initTiny() {
        if (GNavigateur.withContentEditable) {
          TinyInit_1.TinyInit.init({
            id: this.idContenuMsg,
            labelWAI: ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.labelWAIMessage',
            ),
            modeMail: true,
            height: this.optionsFenetre.transfertMessage ? 180 : 310,
            min_height: this.optionsFenetre.transfertMessage ? 150 : 298,
            max_height: 600,
          });
        }
      }
      _getContent() {
        let lResult = '';
        if (this._autoriseTiny()) {
          const lEditor = TinyInit_1.TinyInit.get(this.idContenuMsg);
          lResult = lEditor ? lEditor.getContent() : '';
          if (TinyInit_1.TinyInit.estContenuVide(lResult)) {
            lResult = '';
          }
        } else {
          lResult = this.message.contenu;
        }
        return lResult;
      }
      _composeChampDestinataires() {
        const T = [];
        if (!this.optionsFenetre.avecChoixDestinataires) {
          T.push(
            '<div id="',
            this.id_destinataires_conteneur,
            '" class="field-contain Gras label-up" role="group" aria-label="',
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.DestinatairesMsg',
            ).toAttrValue(),
            '">',
            '<div>',
            ObjetTraduction_1.GTraductions.getValeur(
              'Messagerie.DestinatairesMsg',
            ),
            '</div>',
            '<div id="',
            this.id_destinataires,
            '" class="fluid-bloc"></div>',
            '</div>',
            '<div id="',
            this.idCopieAutresResp,
            '" class="m-top-l full-width">',
            '<ie-checkbox ie-model="cbInclureResponsables" ie-display="estVisibleInclureResponsables">',
            ObjetTraduction_1.GTraductions.getValeur(
              'fenetreCommunication.cb.inclureDelegues',
            ),
            '</ie-checkbox>',
            '</div>',
          );
        } else {
          T.push(
            '<div id="',
            this.getNomInstance(this.identDestinataire),
            '"></div>',
          );
        }
        return T.join('');
      }
      _composeChampObjet() {
        return IE.jsx.str(
          'label',
          { class: 'flex-contain cols m-top-l m-bottom-l' },
          IE.jsx.str(
            'span',
            { class: 'ie-titre-petit m-bottom' },
            ObjetTraduction_1.GTraductions.getValeur('Messagerie.ObjetMsg'),
          ),
          () => {
            if (this.optionsFenetre.transfertMessage) {
              return IE.jsx.str('div', { 'ie-html': 'getObjetTexte' });
            } else {
              return IE.jsx.str('input', {
                'ie-model': 'inputObjet',
                maxlength:
                  UtilitaireMessagerie_1.UtilitaireMessagerie
                    .C_TailleObjetMessage,
                type: 'text',
                class: 'round-style',
              });
            }
          },
        );
      }
      _composeChampPJ() {
        const T = [];
        T.push(
          `<div class="pj-global-conteneur" id="${this.getNomInstance(this.identSelecteurPJ)}"></div>`,
        );
        return T.join('');
      }
      _composeZoneEnteteMsg() {
        const T = [];
        T.push('<div id="', this.idEntete, '" class="full-width m-top">');
        T.push(this._composeChampDestinataires());
        T.push(
          IE.jsx.str('div', {
            'ie-html': 'getLegende',
            'ie-display': 'afficherLegende',
            class: 'm-bottom-xl',
          }),
        );
        T.push(this._composeChampObjet());
        T.push('</div>');
        return T.join('');
      }
      _composeZoneContenuMsg() {
        const T = [];
        const lAvecPJ = this._autorisePJ();
        const lAvecCloud = GEtatUtilisateur.listeCloud.count() > 0;
        T.push(`<div class="flex-contain">`);
        if (this._autorisePJ()) {
          T.push(`<div class="fix-bloc flex-contain cols">\n                ${this._composeChampPJ()}
            </div>`);
        }
        T.push(
          `<div class="fluid-bloc">\n              <textarea id="${this.idContenuMsg}" ${!this._autoriseTiny() ? ' ie-model="textareaSansTiny" maxlength="10000"' : ''} class="round-style" style="height:300px;width:100%;"></textarea>`,
          this.etatUtilisateurSco.messagerieSignature &&
            this.etatUtilisateurSco.messagerieSignature.signature
            ? IE.jsx.str(
                'ie-bouton',
                {
                  'ie-model': 'btnSignature',
                  'ie-icon': 'icon_signature',
                  class: 'themeBoutonNeutre m-top-l',
                },
                ObjetTraduction_1.GTraductions.getValeur(
                  'Messagerie.HintAjouterSignature',
                ),
              )
            : '',
          `</div>`,
        );
        T.push(`</div>`);
        if (lAvecPJ || lAvecCloud) {
          T.push('<div class="m-top-l">');
          if (lAvecPJ) {
            T.push(
              '<div id="',
              this.idLibellePJ,
              '" class="pj-liste-conteneur"></div>',
            );
          }
          if (lAvecCloud) {
            T.push(
              '<div id="',
              this.idLibelleCloud,
              '" class="pj-liste-conteneur"></div>',
            );
          }
          T.push('</div>');
        }
        const lContenu = T.join('');
        if (this._autoriseTiny() || this._autorisePJ()) {
          const lId = `${this.Nom}_labelcontenu`;
          return IE.jsx.str(
            'div',
            {
              role: 'group',
              class: 'flex-contain cols',
              'aria-labelledby': lId,
            },
            IE.jsx.str(
              'span',
              { class: 'ie-titre-petit m-bottom', id: lId },
              ObjetTraduction_1.GTraductions.getValeur('Messagerie.Contenu'),
            ),
            lContenu,
          );
        }
        return IE.jsx.str(
          'label',
          { class: 'flex-contain cols' },
          IE.jsx.str(
            'span',
            { class: 'ie-titre-petit m-bottom' },
            ObjetTraduction_1.GTraductions.getValeur('Messagerie.Contenu'),
          ),
          lContenu,
        );
      }
      _actualiserSelecteurPJ() {
        if (!this._autorisePJ()) {
          return;
        }
        const lInstance = this.getInstance(this.identSelecteurPJ);
        lInstance.setDonnees({
          listePJ: this.message.listeFichiers,
          listeTotale: this.listePJ,
          idContextFocus: this.Nom,
        });
      }
      _evntSelecteurPJ() {
        if (
          this.message.contenu !== '' ||
          this.message.listeFichiers.count() > 0
        ) {
          this.message.setEtat(Enumere_Etat_1.EGenreEtat.Modification);
        }
        this.$refreshSelf();
      }
    }
    exports.ObjetFenetre_Message = ObjetFenetre_Message;
  },
  fn: 'objetfenetre_message.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireContactReferents = void 0;
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetFenetre_Message_1 = require('ObjetFenetre_Message');
    const TypeGenreDiscussion_1 = require('TypeGenreDiscussion');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const UtilitaireContactReferents = {
      contacterReferentHarcelement(aPereFenetre, aReferent) {
        if (aReferent) {
          const lListeDestinataires =
            new ObjetListeElements_1.ObjetListeElements();
          lListeDestinataires.add(aReferent);
          ouvrirFenetreContactReferent(
            aPereFenetre,
            lListeDestinataires,
            aReferent.getGenre(),
            TypeGenreDiscussion_1.TypeGenreDiscussion.GD_Harcelement,
          );
        }
      },
      contacterReferentsVieScolaire(aPereFenetre, aListeReferentsVieScolaire) {
        const lListeDestinataires =
          new ObjetListeElements_1.ObjetListeElements();
        lListeDestinataires.add(aListeReferentsVieScolaire);
        ouvrirFenetreContactReferent(
          aPereFenetre,
          lListeDestinataires,
          Enumere_Ressource_1.EGenreRessource.Personnel,
          TypeGenreDiscussion_1.TypeGenreDiscussion.GD_Discussion,
        );
      },
      avecAffichageContactReferentsVieScolaire(aGenreEspace) {
        return [
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
        ].includes(aGenreEspace);
      },
      auMoinsUnReferentVieScolaireAccepteDiscussion(
        aListeReferentsVieScolaire,
      ) {
        let lAuMoinsUnReferentAvecDiscussion = false;
        if (aListeReferentsVieScolaire) {
          for (const lReferentVS of aListeReferentsVieScolaire) {
            if (lReferentVS && lReferentVS.avecDiscussion) {
              lAuMoinsUnReferentAvecDiscussion = true;
              break;
            }
          }
        }
        return lAuMoinsUnReferentAvecDiscussion;
      },
    };
    exports.UtilitaireContactReferents = UtilitaireContactReferents;
    function ouvrirFenetreContactReferent(
      aPereFenetre,
      aListeDestinataire,
      aGenreRessource,
      aGenreDiscussion,
    ) {
      const lFenetreMessage = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
        ObjetFenetre_Message_1.ObjetFenetre_Message,
        { pere: aPereFenetre },
      );
      lFenetreMessage.setDonnees({
        ListeRessources: aListeDestinataire,
        listeSelectionnee: aListeDestinataire,
        genreRessource: aGenreRessource,
      });
      lFenetreMessage.setGenreDiscussion(aGenreDiscussion);
    }
  },
  fn: 'utilitairecontactreferents.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFicheEtablissement = void 0;
    const ObjetFiche_1 = require('ObjetFiche');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const GUID_1 = require('GUID');
    const ObjetRequeteSaisieAccepterReglement_1 = require('ObjetRequeteSaisieAccepterReglement');
    const ObjetHtml_1 = require('ObjetHtml');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetChaine_1 = require('ObjetChaine');
    const TypeFichierExterneHttpSco_1 = require('TypeFichierExterneHttpSco');
    const Enumere_DocumentJoint_1 = require('Enumere_DocumentJoint');
    const UtilitaireContactReferents_1 = require('UtilitaireContactReferents');
    require('Fiche-Etablissement.css');
    class ObjetFicheEtablissement extends ObjetFiche_1.ObjetFiche {
      constructor(...aParams) {
        super(...aParams);
        this.etatUtilisateurPN = GApplication.getEtatUtilisateur();
        this.idInformation = GUID_1.GUID.getId();
        this.optionsFicheEtab = this.getOptionsParDefaut();
        this.setOptionsFenetre({
          fermerFenetreSurClicHorsFenetre: true,
          heightMax_mobile: true,
          titre: ObjetTraduction_1.GTraductions.getValeur(
            'FicheEtablissement.ContacterEtablissement',
          ),
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(this), {
          surSelection(I) {
            $(this.node).on('click', function () {
              if (aInstance.indiceEtablissementAffiche !== I) {
                aInstance.indiceEtablissementAffiche = I;
                $(this).siblings().removeClass('selectionne');
                $(this).addClass('selectionne');
                const lEtablissement = aInstance.listeEtablissements.get(I);
                ObjetHtml_1.GHtml.setHtml(
                  aInstance.idInformation,
                  aInstance.composeInformations(lEtablissement),
                  { controleur: aInstance.controleur },
                );
              }
            });
          },
          accepterReglement: {
            getValue() {
              const lEtablissement = aInstance.listeEtablissements.get(
                aInstance.indiceEtablissementAffiche,
              );
              return lEtablissement.relancerNotif;
            },
            setValue(aValue) {
              const lEtablissement = aInstance.listeEtablissements.get(
                aInstance.indiceEtablissementAffiche,
              );
              lEtablissement.relancerNotif = true;
              new ObjetRequeteSaisieAccepterReglement_1.ObjetRequeteSaisieAccepterReglement(
                aInstance,
              ).lancerRequete({
                etablissement: lEtablissement,
                accepterReglement: aValue,
              });
            },
            getDisabled() {
              const lEtablissement = aInstance.listeEtablissements.get(
                aInstance.indiceEtablissementAffiche,
              );
              return lEtablissement.relancerNotif;
            },
          },
          contacterReferentsVS: {
            event() {
              const lEtablissement = aInstance.listeEtablissements.get(
                aInstance.indiceEtablissementAffiche,
              );
              if (lEtablissement && lEtablissement.listeReferentsVieScolaire) {
                UtilitaireContactReferents_1.UtilitaireContactReferents.contacterReferentsVieScolaire(
                  aInstance,
                  lEtablissement.listeReferentsVieScolaire,
                );
              }
            },
          },
        });
      }
      setDonnees(aParams) {
        var _a, _b;
        this.optionsFicheEtab = Object.assign(this.optionsFicheEtab, aParams);
        let lListeEtab = null;
        if (this.optionsFicheEtab.estEspaceAvecMembre) {
          if (
            !!((_b =
              (_a = this.etatUtilisateurPN) === null || _a === void 0
                ? void 0
                : _a.getMembre()) === null || _b === void 0
              ? void 0
              : _b.Etablissement)
          ) {
            lListeEtab = new ObjetListeElements_1.ObjetListeElements();
            lListeEtab.add(
              this.optionsFicheEtab.listeInformationsEtablissements.getElementParNumero(
                this.etatUtilisateurPN.getMembre().Etablissement.getNumero(),
              ),
            );
          } else {
            lListeEtab = this.optionsFicheEtab.listeInformationsEtablissements;
          }
        } else {
          lListeEtab = this.optionsFicheEtab.listeInformationsEtablissements;
        }
        this.listeEtablissements =
          new ObjetListeElements_1.ObjetListeElements();
        if (lListeEtab) {
          for (let i = 0, lNbr = lListeEtab.count(); i < lNbr; i++) {
            if (lListeEtab.get(i).avecInformations) {
              this.listeEtablissements.add(lListeEtab.get(i));
            }
          }
        }
        if (this.listeEtablissements.count()) {
          this.indiceEtablissementAffiche = 0;
          this.afficherFiche({ centrerParDefaut: true });
        }
      }
      composeContenu() {
        const H = [];
        let lClass, lEtablissement;
        const lNbrEtablissement = this.listeEtablissements.count();
        H.push('<div class="fiche-etablissement onglet">');
        for (let i = 0; i < lNbrEtablissement; i++) {
          lClass = this.indiceEtablissementAffiche === i ? 'selectionne' : '';
          H.push(
            '<div class="' +
              lClass +
              ' Espace Gras AvecMain" ie-node="surSelection(' +
              i +
              ')">',
            this.listeEtablissements.get(i).getLibelle()
              ? this.listeEtablissements.get(i).getLibelle()
              : ObjetTraduction_1.GTraductions.getValeur(
                  'FicheEtablissement.Etablissement',
                ),
            '</div>',
          );
        }
        H.push('</div>');
        lEtablissement = this.listeEtablissements.get(
          this.indiceEtablissementAffiche,
        );
        H.push(
          '<div id="',
          this.idInformation,
          '" class="fiche-etablissement informations">',
        );
        H.push(this.composeInformations(lEtablissement));
        H.push('</div>');
        return H.join('');
      }
      getOptionsParDefaut() {
        var _a, _b;
        const lEstEspaceAvecMembre = [
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
          Enumere_Espace_1.EGenreEspace.Accompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
          Enumere_Espace_1.EGenreEspace.Entreprise,
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Tuteur,
        ].includes(
          (_a =
            this === null || this === void 0
              ? void 0
              : this.etatUtilisateurPN) === null || _a === void 0
            ? void 0
            : _a.GenreEspace,
        );
        const lAvecReglementAAccepte = [
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Eleve,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Eleve,
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          Enumere_Espace_1.EGenreEspace.PrimEleve,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
        ].includes(
          (_b =
            this === null || this === void 0
              ? void 0
              : this.etatUtilisateurPN) === null || _b === void 0
            ? void 0
            : _b.GenreEspace,
        );
        return {
          listeInformationsEtablissements: null,
          estSurMobile: IE.estMobile,
          estEspaceAvecMembre: lEstEspaceAvecMembre,
          avecReglementAAccepter: lAvecReglementAAccepte,
        };
      }
      composeInformations(aEtablissement) {
        const H = [];
        const lEtablissement = aEtablissement;
        if (lEtablissement.urlLogo) {
          H.push(
            '<img class="logo" src="',
            lEtablissement.urlLogo,
            '" alt="" onerror="$(this).remove();" />',
          );
        }
        if (
          lEtablissement.Coordonnees.Adresse1 ||
          lEtablissement.Coordonnees.Adresse2 ||
          lEtablissement.Coordonnees.Adresse3 ||
          lEtablissement.Coordonnees.Adresse4
        ) {
          H.push('<div class="infos-contain icon_map_marker">');
          H.push('<div>');
          if (lEtablissement.Coordonnees.Adresse1) {
            H.push('<p>', lEtablissement.Coordonnees.Adresse1, '</p>');
          }
          if (lEtablissement.Coordonnees.Adresse2) {
            H.push('<p>', lEtablissement.Coordonnees.Adresse2, '</p>');
          }
          if (lEtablissement.Coordonnees.Adresse3) {
            H.push('<p>', lEtablissement.Coordonnees.Adresse3, '</p>');
          }
          if (lEtablissement.Coordonnees.Adresse4) {
            H.push('<p>', lEtablissement.Coordonnees.Adresse4, '</p>');
          }
          H.push('<p>');
          if (
            lEtablissement.Coordonnees.CodePostal &&
            !lEtablissement.Coordonnees.LibellePostal
          ) {
            H.push('<span>', lEtablissement.Coordonnees.CodePostal, '</span>');
          }
          if (lEtablissement.Coordonnees.LibellePostal) {
            H.push(
              '<span>',
              lEtablissement.Coordonnees.LibellePostal,
              '</span>',
            );
          }
          if (lEtablissement.Coordonnees.LibelleVille) {
            H.push(
              '<span>',
              lEtablissement.Coordonnees.LibelleVille,
              '</span>',
            );
          }
          H.push('</p>');
          if (lEtablissement.Coordonnees.Province) {
            H.push('<p>', lEtablissement.Coordonnees.Province, '</p>');
          }
          if (lEtablissement.Coordonnees.Pays) {
            H.push('<p>', lEtablissement.Coordonnees.Pays, '</p>');
          }
          H.push('</div></div>');
        }
        if (
          lEtablissement.Coordonnees.NumPersonnalise1 &&
          lEtablissement.Coordonnees.NumPersonnalise1.Numero
        ) {
          H.push(
            '<div class="infos-contain icon_phone">',
            '<div class="telephone" >',
            '<p>',
            lEtablissement.Coordonnees.NumPersonnalise1.NomPersonnalise
              ? lEtablissement.Coordonnees.NumPersonnalise1.NomPersonnalise +
                  ' : '
              : '',
            '</p>',
            '<p>',
            this._getTelephoneAvecEspaces(
              lEtablissement.Coordonnees.NumPersonnalise1.Numero,
            ),
            '</p></div></div>',
          );
        }
        if (
          lEtablissement.Coordonnees.NumPersonnalise2 &&
          lEtablissement.Coordonnees.NumPersonnalise2.Numero
        ) {
          H.push(
            '<div class="infos-contain icon_phone">',
            '<div class="telephone" >',
            '<p>',
            lEtablissement.Coordonnees.NumPersonnalise2.NomPersonnalise
              ? lEtablissement.Coordonnees.NumPersonnalise2.NomPersonnalise +
                  ' : '
              : '',
            '</p>',
            '<p>',
            this._getTelephoneAvecEspaces(
              lEtablissement.Coordonnees.NumPersonnalise2.Numero,
            ),
            '</p></div></div>',
          );
        }
        if (
          lEtablissement.Coordonnees.NumPersonnalise3 &&
          lEtablissement.Coordonnees.NumPersonnalise3.Numero
        ) {
          H.push(
            '<div class="infos-contain icon_phone">',
            '<div>',
            '<p>',
            lEtablissement.Coordonnees.NumPersonnalise3.NomPersonnalise
              ? lEtablissement.Coordonnees.NumPersonnalise3.NomPersonnalise +
                  ' : '
              : '',
            '</p>',
            '<p>',
            this._getTelephoneAvecEspaces(
              lEtablissement.Coordonnees.NumPersonnalise3.Numero,
            ),
            '</p></div></div>',
          );
        }
        if (lEtablissement.Coordonnees.SiteInternet) {
          H.push(
            '<div class="infos-contain flex-center icon_curseur_souris">',
            '<a class="Souligne AvecMain" target="_blank" href="',
            ObjetChaine_1.GChaine.verifierURLHttp(
              lEtablissement.Coordonnees.SiteInternet,
            ),
            '">',
            lEtablissement.Coordonnees.SiteInternet,
            '</a>',
            '</div>',
          );
        }
        if (
          lEtablissement.Coordonnees.EMailPersonnalise1 &&
          lEtablissement.Coordonnees.EMailPersonnalise1.Mail
        ) {
          H.push(
            '<div class="infos-contain icon_envelope">',
            '<div>',
            '<p>',
            lEtablissement.Coordonnees.EMailPersonnalise1.NomPersonnalise
              ? lEtablissement.Coordonnees.EMailPersonnalise1.NomPersonnalise +
                  ' : '
              : '',
            '</p>',
            '<p>',
            this._composeEmail(
              lEtablissement.Coordonnees.EMailPersonnalise1.Mail,
            ),
            '</p></div></div>',
          );
        }
        if (
          lEtablissement.Coordonnees.EMailPersonnalise2 &&
          lEtablissement.Coordonnees.EMailPersonnalise2.Mail
        ) {
          H.push(
            '<div class="infos-contain icon_envelope">',
            '<div>',
            '<p>',
            lEtablissement.Coordonnees.EMailPersonnalise2.NomPersonnalise
              ? lEtablissement.Coordonnees.EMailPersonnalise2.NomPersonnalise +
                  ' : '
              : '',
            '</p>',
            '<p>',
            this._composeEmail(
              lEtablissement.Coordonnees.EMailPersonnalise2.Mail,
            ),
            '</p></div></div>',
          );
        }
        let lFichier;
        if (lEtablissement.avecFichierRI) {
          lFichier = new ObjetElement_1.ObjetElement(
            lEtablissement.LibelleFichierRI,
            lEtablissement.getNumero(),
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
          );
          H.push(
            '<div class="GrandEspaceHaut PetitEspaceBas">',
            ObjetChaine_1.GChaine.composerUrlLienExterne({
              documentJoint: lFichier,
              libelleEcran: ObjetTraduction_1.GTraductions.getValeur(
                'FicheEtablissement.ReglementInterieur',
              ),
              genreRessource:
                TypeFichierExterneHttpSco_1.TypeFichierExterneHttpSco
                  .EtablissementReglement,
              afficherIconeDocument: true,
              iconeOverride: 'icon_doc_telech',
            }),
            '</div>',
          );
        }
        if (lEtablissement.avecFichierCU) {
          lFichier = new ObjetElement_1.ObjetElement(
            lEtablissement.LibelleFichierCU,
            lEtablissement.getNumero(),
            Enumere_DocumentJoint_1.EGenreDocumentJoint.Fichier,
          );
          H.push(
            '<div class="EspaceHaut GrandEspaceBas">',
            ObjetChaine_1.GChaine.composerUrlLienExterne({
              documentJoint: lFichier,
              libelleEcran: ObjetTraduction_1.GTraductions.getValeur(
                'FicheEtablissement.CharteUtilisation',
              ),
              genreRessource:
                TypeFichierExterneHttpSco_1.TypeFichierExterneHttpSco
                  .EtablissementCharte,
              afficherIconeDocument: true,
              iconeOverride: 'icon_doc_telech',
            }),
            '</div>',
          );
        }
        if (
          (lEtablissement.avecFichierRI || lEtablissement.avecFichierCU) &&
          this.optionsFicheEtab.avecReglementAAccepter
        ) {
          H.push('<div class="GrandEspaceDroit">');
          H.push(
            '<ie-checkbox ie-model="accepterReglement">' +
              ObjetTraduction_1.GTraductions.getValeur(
                'FicheEtablissement.Accepter',
              ) +
              '</ie-checkbox>',
          );
          H.push('</div>');
        }
        if (
          this.optionsFicheEtab.avecReferentsHarcelement &&
          lEtablissement.avecReferentsHarcelementPublie
        ) {
          const lListeReferentsHarcelement =
            lEtablissement.listeReferentsHarcelement;
          if (
            lListeReferentsHarcelement &&
            lListeReferentsHarcelement.count() > 0
          ) {
            const lStrReferents = [];
            for (const lReferent of lListeReferentsHarcelement) {
              lStrReferents.push(
                IE.jsx.str(
                  IE.jsx.fragment,
                  null,
                  IE.jsx.str(
                    'p',
                    null,
                    lReferent.getLibelle(),
                    lReferent.discipline ? ` (${lReferent.discipline})` : '',
                  ),
                ),
              );
            }
            H.push(
              IE.jsx.str(
                IE.jsx.fragment,
                null,
                IE.jsx.str(
                  'div',
                  { class: 'infos-contain icon_stop_harcelement' },
                  IE.jsx.str(
                    'div',
                    null,
                    IE.jsx.str(
                      'p',
                      null,
                      ObjetTraduction_1.GTraductions.getValeur(
                        'FicheEtablissement.ReferentsHarcelement',
                        [lEtablissement.getLibelle()],
                      ),
                      ' :',
                    ),
                    lStrReferents.join(''),
                  ),
                ),
              ),
            );
          }
        }
        if (this.optionsFicheEtab.avecReferentsVieScolaire) {
          if (
            lEtablissement.listeReferentsVieScolaire &&
            lEtablissement.listeReferentsVieScolaire.count() > 0
          ) {
            if (
              UtilitaireContactReferents_1.UtilitaireContactReferents.auMoinsUnReferentVieScolaireAccepteDiscussion(
                lEtablissement.listeReferentsVieScolaire,
              )
            ) {
              H.push(
                IE.jsx.str(
                  IE.jsx.fragment,
                  null,
                  IE.jsx.str(
                    'div',
                    { class: 'infos-contain icon_envoyer' },
                    IE.jsx.str(
                      'div',
                      null,
                      IE.jsx.str(
                        'p',
                        null,
                        ObjetTraduction_1.GTraductions.getValeur(
                          'FicheEtablissement.ReferentsVieScolaire',
                        ),
                      ),
                      IE.jsx.str(
                        'p',
                        null,
                        IE.jsx.str(
                          'ie-bouton',
                          {
                            'ie-model': 'contacterReferentsVS',
                            'ie-icon': 'icon_envoyer',
                            class: 'themeBoutonNeutre small-bt',
                          },
                          ObjetTraduction_1.GTraductions.getValeur(
                            'FicheEtablissement.ContacterVS',
                          ),
                        ),
                      ),
                    ),
                  ),
                ),
              );
            }
          }
        }
        return H.join('');
      }
      _composeEmail(aParam) {
        if (this.optionsFicheEtab.estSurMobile) {
          return (
            '<a href="mailto:' + aParam + '" target="_blank">' + aParam + '</a>'
          );
        } else {
          return ObjetChaine_1.GChaine.composerEmail(aParam);
        }
      }
      _getTelephoneAvecEspaces(aNumeroTelephone) {
        if (!aNumeroTelephone || !aNumeroTelephone.length) {
          return '';
        }
        let lResult = '';
        let lCompteur = 0;
        for (let i = aNumeroTelephone.length - 1; i >= 0; i--) {
          if (lCompteur % 2 === 0) {
            lResult = ' ' + lResult;
          }
          lResult = aNumeroTelephone.charAt(i) + lResult;
          lCompteur++;
        }
        lResult = lResult.trim();
        if (this.optionsFicheEtab.estSurMobile) {
          return '<a href="tel:' + aNumeroTelephone + '">' + lResult + '</a>';
        } else {
          return lResult;
        }
      }
    }
    exports.ObjetFicheEtablissement = ObjetFicheEtablissement;
  },
  fn: 'objetficheetablissement.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    require('UtilitairePagePubliqueEtablissement.css');
    require('pages_connexion.css');
    const { GHtml } = require('ObjetHtml.js');
    const { GTraductions } = require('ObjetTraduction.js');
    const {
      UtilitaireMenuContextuelNatif,
    } = require('UtilitaireMenuContextuelNatif.js');
    const { UtilitaireRedirection } = require('UtilitaireRedirection.js');
    const { EGenreWidget } = require('Enumere_Widget.js');
    const MultipleWidgetMenu = require('WidgetMenu.js');
    const { WidgetLienUtile } = require('WidgetLienUtile.js');
    const { WidgetAgenda } = require('WidgetAgenda.js');
    const { WidgetActualites } = require('WidgetActualites.js');
    const { WidgetEdito } = require('WidgetEdito.js');
    const { GUID } = require('GUID.js');
    const { Identite } = require('ObjetIdentite.js');
    const { UtilitaireWidget } = require('UtilitaireWidget.js');
    const { Requetes } = require('CollectionRequetes.js');
    const { ObjetRequeteConsultation } = require('ObjetRequeteJSON.js');
    const { GDate } = require('ObjetDate.js');
    const { ObjetCycles } = require('ObjetCycles.js');
    const { ObjetDeserialiser } = require('ObjetDeserialiser.js');
    const { ObjetFenetre } = require('ObjetFenetre.js');
    const {
      ObjetRequeteMentionsLegales,
    } = require('ObjetRequeteMentionsLegales.js');
    const {
      ObjetFenetre_MentionsLegales,
    } = require('ObjetFenetre_MentionsLegales.js');
    const { ObjetGalerieCarrousel } = require('ObjetGalerieCarrousel.js');
    const { ObjetListeElements } = require('ObjetListeElements.js');
    const { ObjetElement } = require('ObjetElement.js');
    const { GChaine } = require('ObjetChaine.js');
    const { ObjetInvocateur, Invocateur } = require('Invocateur.js');
    const { ThemesCouleurs } = require('ThemesCouleurs.js');
    const {
      EGenreEvenementObjetSaisie,
    } = require('Enumere_EvenementObjetSaisie.js');
    const { EGenreEvenementWidget } = require('Enumere_EvenementWidget.js');
    const { IELocalStorage } = require('LocalStorage.js');
    const { TypeGenreMiniature } = require('TypeGenreMiniature.js');
    const { ObjetFicheEtablissement } = require('ObjetFicheEtablissement.js');
    const lCookieLocalStorage = 'etatAffichageCookiesInfo';
    class UtilitairePagePubliqueEtablissement {
      constructor(aOptions) {
        this.options = aOptions;
        this.genreCommandeRS = {
          twitter: 1,
          facebook: 2,
          youtube: 3,
          instagram: 4,
        };
      }
      getControleur(aInstance) {
        const lControleur = {
          getVisibiliteGaleriePhotos: function () {
            return (
              this.parametres.avecGaleriePhotos === true &&
              this.parametres.listePhotosGalerie !== null &&
              this.parametres.listePhotosGalerie !== undefined &&
              this.parametres.listePhotosGalerie.count() > 0
            );
          }.bind(aInstance),
          getVisibiliteSiteWeb: function () {
            return (
              this.parametres.avecSiteWeb === true &&
              this.parametres.SiteInternet !== ''
            );
          }.bind(aInstance),
          getVisibiliteContact: function () {
            return (
              this.parametres.avecContact === true &&
              this.parametres.listeInformationsEtablissements !== null &&
              this.parametres.listeInformationsEtablissements !== undefined
            );
          }.bind(aInstance),
          getNodeContact: function () {
            $(this.node).on({
              click: function () {
                ObjetFenetre.creerInstanceFenetre(
                  ObjetFicheEtablissement,
                  { pere: this },
                  { callbackFermer: function () {} },
                ).setDonnees({
                  estSurMobile: this.options.estSurMobile,
                  listeInformationsEtablissements:
                    this.parametres.listeInformationsEtablissements,
                  estEspaceAvecMembre: false,
                  avecReglementAAccepter: false,
                });
              }.bind(aInstance),
            });
          },
          getVisibiliteMentionsLegales: function () {
            return this.parametres.avecMentionsLegales === true;
          }.bind(aInstance),
          getNodeMentionsLegales: function () {
            $(this.node).on({
              click: function () {
                return new ObjetRequeteMentionsLegales(aInstance)
                  .lancerRequete()
                  .then((aParams) => {
                    let lFenetreMentionsLegales =
                      ObjetFenetre.creerInstanceFenetre(
                        ObjetFenetre_MentionsLegales,
                        { pere: this, initialiser: function () {} },
                      );
                    lFenetreMentionsLegales.setOptionsFenetre({
                      titre: GTraductions.getValeur(
                        'pagePubliqueEtab.mentionsLegales',
                      ),
                    });
                    lFenetreMentionsLegales.setDonnees(aParams);
                  });
              }.bind(aInstance),
            });
          },
          btnFermer: function () {
            $(this.node).eventValidation(function () {
              let lGenreEspace =
                global.GEtatUtilisateur !== undefined
                  ? '_' + GEtatUtilisateur.GenreEspace
                  : '';
              IELocalStorage.setItem(lCookieLocalStorage + lGenreEspace, false);
              $(this).parent().hide();
            });
          },
          getVisibiliteReseauxSociaux: function () {
            return (
              this.parametres.avecReseauxSociaux === true &&
              (this.parametres.avecFacebook ||
                this.parametres.avecTwitter ||
                this.parametres.avecInstagram ||
                this.parametres.avecYouTube)
            );
          }.bind(aInstance),
          btnReseauxSociaux: {
            event: function (aGenre) {
              switch (aGenre) {
                case this.genreCommandeRS.twitter:
                  if (this.parametres.urlTwitter !== '') {
                    window.open(this.parametres.urlTwitter);
                  }
                  break;
                case this.genreCommandeRS.facebook:
                  if (this.parametres.urlFacebook !== '') {
                    window.open(this.parametres.urlFacebook);
                  }
                  break;
                case this.genreCommandeRS.instagram:
                  if (this.parametres.urlInstagram !== '') {
                    window.open(this.parametres.urlInstagram);
                  }
                  break;
                case this.genreCommandeRS.youtube:
                  if (this.parametres.urlYoutube !== '') {
                    window.open(this.parametres.urlYoutube);
                  }
                  break;
              }
            }.bind(aInstance),
          },
          btnAccesEspaces: {
            getDisabled: function () {
              return false;
            },
            event: function () {
              _evntBtnAccesEspace.call(aInstance, { nodeBouton: this.node });
            },
          },
          comboAccesEspaces: {
            init: function (aCombo) {
              const lNomApp = this.options.estPrimaire
                ? 'PRONOTE PRIMAIRE'
                : 'PRONOTE';
              aCombo.setOptionsObjetSaisie({
                longueur: this.options.estPrimaire ? 320 : 260,
                labelWAICellule: GTraductions.getValeur(
                  'pagePubliqueEtab.accederEspace',
                  [lNomApp],
                ),
                placeHolder: GTraductions.getValeur(
                  'pagePubliqueEtab.accederEspace',
                  ['<span class="nomApp">' + lNomApp + '</span>'],
                ),
              });
            }.bind(aInstance),
            getDonnees: function () {
              let lListeEspaces = aInstance.parametres.espaces;
              if (lListeEspaces !== null && lListeEspaces !== undefined) {
                return lListeEspaces;
              }
            },
            event: function (aParametres) {
              if (
                aParametres.genreEvenement ===
                  EGenreEvenementObjetSaisie.selection &&
                !!aParametres.element
              ) {
                let lEspace = aParametres.element;
                window.location.assign(
                  _getURLRacine.call() +
                    lEspace.url +
                    new UtilitaireRedirection().getParametresUrl(),
                );
              }
            },
          },
          getWidthTitle: function () {
            let widthWrapper = $(this.node).innerWidth();
            let widthTitre = $(this.node)
              .find('section.identiteEtab')
              .innerWidth();
            let widthBouton = $(this.node)
              .find('section.accesEspaces')
              .innerWidth();
            return widthTitre + widthBouton > widthWrapper
              ? $(this.node).addClass('centered')
              : '';
          },
        };
        return lControleur;
      }
      construire(aParam, aDonneesRequete) {
        this.controleur = this.getControleur(this);
        this.parametres = Object.assign(
          {
            id: '',
            avecLiensUtilesFavoris: false,
            avecBanniere: false,
            avecEdito: false,
            avecInformations: false,
            avecAgenda: false,
            avecLiensUtiles: false,
            avecMenuCantine: false,
            avecGaleriePhotos: false,
            avecSiteWeb: false,
            avecContact: false,
            avecReseauxSociaux: false,
            avecTwitter: false,
            urlTwitter: '',
            avecFacebook: false,
            urlFacebook: '',
            avecYouTube: false,
            urlYoutube: '',
            avecInstagram: false,
            urlInstagram: '',
            NomEtablissementConnexion: '',
            urlLogo: null,
            espaces: null,
          },
          aParam,
        );
        this.donneesRequete = aDonneesRequete;
        if (this.parametres.agenda) {
          this.parametres.agenda.listeEvenements =
            new ObjetDeserialiser().getListeEvenements(
              this.parametres.agenda.listeEvenements,
              true,
            );
        }
        if (
          this.parametres.actualites &&
          this.parametres.actualites.listeModesAff
        ) {
          this.parametres.actualites.tabModeAff =
            this.parametres.actualites.listeModesAff;
        }
        this.widgets = this.declarerWidgets();
        this.instancesWidgets = [];
        this.instancierWidgets();
        if (this.parametres.avecGaleriePhotos) {
          this.identGalerie = Identite.creerInstance(ObjetGalerieCarrousel, {
            pere: this,
          });
        }
        GHtml.setHtml(this.parametres.id, _construire.call(this), {
          controleur: this.controleur,
        });
        this.construireHtmlWidgets();
        if (this.parametres.avecGaleriePhotos) {
          _initCarrousel.call(this, {
            instance: this.identGalerie,
            listePhotosGalerie: this.parametres.listePhotosGalerie,
          });
        }
        UtilitaireMenuContextuelNatif.desactiverSurElement($(document));
        if (this.parametres.avecGaleriePhotos) {
          Invocateur.abonner(
            ObjetInvocateur.events.resizeNavigateur,
            () => {
              _initCarrousel.call(this, {
                instance: this.identGalerie,
                listePhotosGalerie: this.parametres.listePhotosGalerie,
              });
            },
            this,
          );
        }
      }
      declarerWidgets() {
        return {
          menuDeLaCantine: {
            nomDonnees: 'menuDeLaCantine',
            genre: EGenreWidget.menuDeLaCantine,
            id: GUID.getId(),
            classWidget: MultipleWidgetMenu
              ? MultipleWidgetMenu.WidgetMenu
              : null,
            titre: GTraductions.getValeur('accueil.menu'),
            hint: GTraductions.getValeur('accueil.info.menu'),
            message: GTraductions.getValeur('accueil.pasDeMenu'),
            existeWidget() {
              return (
                !this.parametres ||
                (this.parametres.menuDeLaCantine.listeRepas !== null &&
                  this.parametres.menuDeLaCantine.listeRepas !== undefined)
              );
            },
            isCollapsible: false,
          },
          lienUtile: {
            nomDonnees: 'lienUtile',
            genre: EGenreWidget.lienUtile,
            id: GUID.getId(),
            classWidget: WidgetLienUtile,
            titre: GTraductions.getValeur('accueil.lienUtile.titre'),
            hint: GTraductions.getValeur('accueil.lienUtile.titre'),
            message: GTraductions.getValeur('accueil.lienUtile.message'),
            existeWidget() {
              let lExisteWidget = false;
              if (this.parametres) {
                const lListeLiens = this.parametres.lienUtile
                  ? this.parametres.lienUtile.listeLiens
                  : null;
                if (lListeLiens && lListeLiens.count() > 0) {
                  let lContientAuMoinsUnLienNonFavori = false;
                  lListeLiens.parcourir((aLien) => {
                    if (!aLien.estFavori) {
                      lContientAuMoinsUnLienNonFavori = true;
                      return false;
                    }
                  });
                  if (lContientAuMoinsUnLienNonFavori) {
                    lExisteWidget = true;
                  }
                }
              }
              return lExisteWidget;
            },
            isCollapsible: false,
          },
          agenda: {
            nomDonnees: 'agenda',
            genre: EGenreWidget.agenda,
            classWidget: WidgetAgenda,
            id: GUID.getId(),
            titre: GTraductions.getValeur('accueil.agenda.titre'),
            hint: GTraductions.getValeur('accueil.info.agenda'),
            message: GTraductions.getValeur('accueil.aucuneAgenda'),
            existeWidget() {
              return !this.parametres || this.parametres.agenda.listeEvenements;
            },
            isCollapsible: true,
          },
          actualites: {
            nomDonnees: 'actualites',
            genre: EGenreWidget.actualites,
            classWidget: WidgetActualites,
            id: GUID.getId(),
            titre: GTraductions.getValeur('accueil.actualites'),
            hint: '',
            message: GTraductions.getValeur('accueil.aucuneActualite'),
            existeWidget() {
              return (
                !this.parametres ||
                !this.parametres.actualites ||
                (this.parametres.actualites.tabModeAff &&
                  this.parametres.actualites.tabModeAff[0].listeActualites)
              );
            },
            isCollapsible: true,
            nbrItemsVisible: IE.estMobile ? 1 : 3,
          },
          edito: {
            nomDonnees: 'edito',
            genre: EGenreWidget.edito,
            classWidget: WidgetEdito,
            id: GUID.getId(),
            titre:
              this.parametres && this.parametres.edito
                ? this.parametres.edito.titre
                : '',
            hint: '',
            existeWidget() {
              return (
                !this.parametres ||
                !this.parametres.edito ||
                (this.parametres.edito.titre && this.parametres.edito.contenu)
              );
            },
            isCollapsible: false,
          },
        };
      }
      instancierWidgets() {
        if (_estVisible_MenuCantine.call(this, { estPublieUniquement: true })) {
          $.extend(
            true,
            this.widgets.menuDeLaCantine,
            this.parametres.menuDeLaCantine,
          );
          _construireInstanceWidget.call(this, this.widgets.menuDeLaCantine);
        }
        if (_estVisible_LiensUtiles.call(this, { estPublieUniquement: true })) {
          $.extend(true, this.widgets.lienUtile, this.parametres.lienUtile);
          _construireInstanceWidget.call(this, this.widgets.lienUtile);
        }
        if (_estVisible_Agenda.call(this, { estPublieUniquement: true })) {
          $.extend(true, this.widgets.agenda, this.parametres.agenda);
          _construireInstanceWidget.call(this, this.widgets.agenda);
        }
        if (
          _estVisible_Informations.call(this, { estPublieUniquement: true })
        ) {
          $.extend(true, this.widgets.actualites, this.parametres.actualites);
          _construireInstanceWidget.call(this, this.widgets.actualites);
        }
        if (_estVisible_Edito.call(this, { estPublieUniquement: true })) {
          $.extend(true, this.widgets.edito, this.parametres.edito);
          _construireInstanceWidget.call(this, this.widgets.edito);
        }
      }
      construireHtmlWidgets() {
        if (_estVisible_MenuCantine.call(this)) {
          _construireHtmlWidget.call(this, this.widgets.menuDeLaCantine);
        }
        if (_estVisible_LiensUtiles.call(this)) {
          _construireHtmlWidget.call(this, this.widgets.lienUtile);
        }
        if (_estVisible_Agenda.call(this)) {
          _construireHtmlWidget.call(this, this.widgets.agenda);
        }
        if (_estVisible_Informations.call(this)) {
          _construireHtmlWidget.call(this, this.widgets.actualites, {
            estModeSansAuth: true,
          });
        }
        if (_estVisible_Edito.call(this)) {
          _construireHtmlWidget.call(this, this.widgets.edito);
        }
      }
      construireWidget(aWidget) {
        const lInstanceWidget = this.instancesWidgets[aWidget.genre];
        GHtml.setHtml(
          aWidget.id,
          UtilitaireWidget.composeContenuWidget(aWidget),
          { instance: lInstanceWidget || this },
        );
        UtilitaireWidget.actualiserFooter(aWidget);
        UtilitaireWidget.afficherMasquerListe(aWidget);
      }
      recupererDonneesWidget(aTabWidgets) {
        const lActualiserUniquementWidget =
          aTabWidgets !== null && aTabWidgets !== undefined;
        if (lActualiserUniquementWidget) {
          this.donneesRequete.widgets = aTabWidgets;
        }
        Requetes.inscrire(
          'PagePubliqueEtablissement',
          ObjetRequeteConsultation,
        );
        Requetes('PagePubliqueEtablissement', this)
          .lancerRequete(this.donneesRequete)
          .then((aParam) => {
            $.extend(this.parametres, aParam);
            if (lActualiserUniquementWidget) {
              if (aTabWidgets.includes(EGenreWidget.menuDeLaCantine)) {
                _actualiserMenuDeLaCantine.call(this);
              }
            }
          });
      }
      initGlobales() {
        _initDatesEtCyclesCasPagePubliqueEtablissement.call(this);
      }
      initDonneesRequete() {
        return {
          menuDeLaCantine: {
            date: GApplication.getDateDemo()
              ? GApplication.getDateDemo()
              : GParametres.JourOuvre,
          },
        };
      }
      composeCookiesInfo() {
        const H = [];
        H.push(`<div class="cookies-disclaimer">`);
        H.push(
          `<p>${GTraductions.getValeur('PiedPage.CookieInfo_Message_1')} ${GTraductions.getValeur('PiedPage.CookieInfo_Message_2')} <span role="button" tabindex="0" class="as-link" ie-node="getNodeMentionsLegales" aria-haspopup="dialog">${GTraductions.getValeur('PiedPage.mentionsLegales')}.</span></p>`,
        );
        H.push(
          `<ie-bouton tabindex="0" aria-label="${GTraductions.getValeur('Fermer')}" ie-hint="${GTraductions.getValeur('Fermer')}" ie-node="btnFermer">${GTraductions.getValeur('Fermer')}</ie-bouton>`,
        );
        H.push(`</div>`);
        return H.join('');
      }
      afficherCookieInfo() {
        let lGenreEspace =
          global.GEtatUtilisateur !== undefined
            ? '_' + GEtatUtilisateur.GenreEspace
            : '';
        IELocalStorage.getItem(lCookieLocalStorage) === null
          ? IELocalStorage.setItem(lCookieLocalStorage + lGenreEspace, true)
          : IELocalStorage.getItem(lCookieLocalStorage + lGenreEspace);
        return (
          IELocalStorage.getItem(lCookieLocalStorage + lGenreEspace) === 'true'
        );
      }
    }
    function _construireInstanceWidget(aDonneesWidget) {
      if (this.instancesWidgets[aDonneesWidget.genre]) {
        this.instancesWidgets[aDonneesWidget.genre].free();
      }
      try {
        this.instancesWidgets[aDonneesWidget.genre] = Identite.creerInstance(
          aDonneesWidget.classWidget,
          { pere: this, evenement: _surEvenementWidget.bind(this) },
        );
      } catch (e) {
        this.instancesWidgets[aDonneesWidget.genre] = null;
        console.error(e);
        return '';
      }
      Object.assign(this.instancesWidgets[aDonneesWidget.genre], {
        donneesRequete: this.donneesRequete,
      });
      return '';
    }
    function _surEvenementWidget(aGenreWidgetSource, aGenreEvenement) {
      switch (aGenreEvenement) {
        case EGenreEvenementWidget.ActualiserWidget:
          this.recupererDonneesWidget([aGenreWidgetSource]);
          break;
        default:
          break;
      }
    }
    function _construireHtmlWidget(aDonneesWidget, aOptionsWidget) {
      try {
        this.instancesWidgets[aDonneesWidget.genre].construire({
          instance: this,
          donnees: aDonneesWidget,
          construireWidget: this.construireWidget.bind(this),
          options: aOptionsWidget,
        });
      } catch (e) {
        console.error(e);
      }
    }
    function _actualiserMenuDeLaCantine() {
      this.instancierWidgets();
      this.construireHtmlWidgets();
    }
    function _construire() {
      const H = [];
      H.push('<div class="utilPagePubliqueEtab">');
      H.push(_construireEntete.call(this));
      H.push(
        `<div class="tpl-3cols">\n  <div class="tpl-marge"></div>\n    <div class="tpl-main">`,
      );
      H.push(_construireCorps.call(this));
      H.push(`</div>\n          <div class="tpl-marge"></div>\n    </div>`);
      H.push(_construirePied.call(this));
      H.push('</div>');
      return H.join('');
    }
    function _construireSectionWidget(aParam) {
      const H = [];
      if (aParam.estVisible) {
        H.push(
          '<article class="widget' +
            (!IE.estMobile
              ? ' ' + ThemesCouleurs.getClassThemeCourant() + ' '
              : ' ') +
            aParam.classWidget,
          '">',
        );
        H.push('<header>' + '<h3>' + aParam.titre + '</h3>' + '</header>');
        H.push(
          '<div class="accueil-widget-content" id="' + aParam.id + '"><div>',
        );
        H.push('</article>');
      }
      return H.join('');
    }
    function _construireEntete() {
      const H = [];
      H.push(`<header>`);
      H.push(
        `<div class="tpl-3cols">\n            <div class="tpl-marge"></div>\n            <div class="tpl-main">`,
      );
      let lAvecLiensUtiles = _estVisible_LiensUtilesFavoris.call(this);
      H.push(
        `      <div class="bandeauHaut ${lAvecLiensUtiles ? ` avecSeparateur` : ``}" ie-node="getWidthTitle">`,
      );
      H.push(_construireIdentiteEtablissement.call(this));
      H.push(_construireAccesEspaces.call(this));
      H.push(`      </div>`);
      if (lAvecLiensUtiles) {
        H.push(_construireLiensUtilesFavoris.call(this));
      }
      H.push(`  </div>`);
      H.push(`  <div class="tpl-marge"></div>\n          </div>`);
      H.push(_construireBanniere.call(this));
      H.push(`</header>`);
      return H.join('');
    }
    function _construireIdentiteEtablissement() {
      const H = [];
      H.push('<section class="identiteEtab">');
      if (this.parametres.urlLogo) {
        H.push(
          '<img src="',
          this.parametres.urlLogo,
          '" alt="',
          GTraductions.getValeur('BandeauEspace.LogoEtablissement'),
          '" />',
        );
      }
      H.push('<h4>' + this.parametres.NomEtablissementConnexion + '</h4>');
      H.push('</section>');
      return H.join('');
    }
    function _construireAccesEspaces() {
      const lNomApp = this.options.estPrimaire ? 'PRONOTE PRIMAIRE' : 'PRONOTE';
      const H = [];
      H.push('<section class="accesEspaces">');
      let lUrlRedirectionChoixEspace = this.parametres.urlConnexionEspaces;
      if (
        lUrlRedirectionChoixEspace !== null &&
        lUrlRedirectionChoixEspace !== undefined
      ) {
        H.push(
          '<ie-bouton class="themeBoutonPrimaire" ie-model="btnAccesEspaces">',
          GTraductions.getValeur('pagePubliqueEtab.accederEspace', [
            '<span class="nomApp">' + lNomApp + '</span>',
          ]),
          '</ie-bouton>',
        );
      } else {
        H.push('<ie-combo ie-model="comboAccesEspaces" ></ie-combo>');
      }
      H.push('</section>');
      return H.join('');
    }
    function _estVisible_LiensUtilesFavoris() {
      return (
        this.parametres.avecLiensUtilesFavoris &&
        this.parametres.lienUtile.listeLiens &&
        this.parametres.lienUtile.listeLiens.count() > 0 &&
        this.parametres.lienUtile.listeLiens
          .getListeElements((aElement) => {
            return aElement.estFavori === true;
          })
          .count() > 0
      );
    }
    function _construireLiensUtilesFavoris() {
      const H = [];
      if (_estVisible_LiensUtilesFavoris.call(this)) {
        H.push('<nav class="liensFavoris">');
        const lListeFavoris =
          this.parametres.lienUtile.listeLiens.getListeElements((aElement) => {
            return aElement.estFavori === true;
          });
        lListeFavoris.parcourir((aLienUtile) => {
          H.push(
            '<ie-chips ie-ellipsis href="',
            GChaine.verifierURLHttp(aLienUtile.url),
            '" ',
            aLienUtile.commentaire
              ? ' ie-hint="' + aLienUtile.commentaire + '"'
              : '',
            '>',
            aLienUtile.getLibelle(),
            '</ie-chips>',
          );
        });
        H.push('</nav>');
      }
      return H.join('');
    }
    function _construireBanniere() {
      const H = [];
      if (this.parametres.avecBanniere) {
        let lUrlBanniere = '';
        if (
          this.parametres.listePhotosBanniere !== null &&
          this.parametres.listePhotosBanniere !== undefined &&
          this.parametres.listePhotosBanniere.count() === 1
        ) {
          lUrlBanniere = GChaine.creerUrlBruteLienExterne(
            this.parametres.listePhotosBanniere.get(0),
            { genreRessource: null },
          );
        }
        H.push(
          '<div class="banniere ',
          lUrlBanniere === ''
            ? this.options.estPrimaire
              ? 'imgParDefautPrimaire'
              : 'imgParDefaut'
            : '',
          ' " ',
          lUrlBanniere !== ''
            ? `style="background-image: url('${lUrlBanniere}');"`
            : '',
          '>',
        );
        if (this.parametres.texteBanniere !== '') {
          H.push(
            `<div class="tpl-3cols">\n                <div class="tpl-marge"></div>\n                <div class="tpl-main">\n                  <div class="conteneurTexte">\n                      <h1>${this.parametres.texteBanniere}</h1>\n                  </div>\n                </div>\n                <div class="tpl-marge"></div>\n              </div>`,
          );
        }
        H.push(`</div>`);
      }
      return H.join('');
    }
    function _construireCorps() {
      const H = [];
      let lZonePrincipaleHidden =
        !this.parametres.avecEdito && !this.parametres.avecInformations;
      let lZoneAsideHidden =
        !this.parametres.avecAgenda &&
        !this.parametres.avecLiensUtiles &&
        !this.parametres.avecMenuCantine;
      H.push(
        `<section class="corps${lZonePrincipaleHidden ? ` no-zone-principale` : ''}${lZoneAsideHidden ? ` no-zone-aside` : ''} ">`,
      );
      if (!lZonePrincipaleHidden) {
        H.push('<div class="zonePrincipale">');
        H.push(_construireEdito.call(this));
        H.push(_construireInformations.call(this));
        H.push('</div>');
      }
      if (!lZoneAsideHidden) {
        H.push('<div class="zoneAside">');
        H.push(_construireAgenda.call(this));
        H.push(_construireLiensUtiles.call(this));
        H.push(_construireMenuCantine.call(this));
        H.push('</div>');
      }
      H.push('<div class="zoneFooter">');
      H.push(_construireGaleriePhotos.call(this));
      H.push('</div>');
      H.push(`     </section>`);
      return H.join('');
    }
    function _construireEdito() {
      return _construireSectionWidget.call(this, {
        estVisible: _estVisible_Edito.call(this),
        classWidget: 'edito',
        titre:
          this.parametres && this.parametres.edito
            ? this.parametres.edito.titre
            : GTraductions.getValeur('pagePubliqueEtab.edito'),
        id: this.widgets.edito.id,
      });
    }
    function _estVisibleSectionWidget(aParam, aParamWidget) {
      const lEstPublie = aParamWidget.estPublie;
      if ((aParam && aParam.estPublieUniquement === true) || !lEstPublie) {
        return lEstPublie;
      }
      const lExisteDonnees =
        aParamWidget.data && aParamWidget.data.existeWidget.call(this);
      return lEstPublie && lExisteDonnees;
    }
    function _estVisible_Edito(aParam) {
      return _estVisibleSectionWidget.call(this, aParam, {
        estPublie: this.parametres.avecEdito === true,
        data: this.widgets.edito,
      });
    }
    function _estVisible_Informations(aParam) {
      return _estVisibleSectionWidget.call(this, aParam, {
        estPublie: this.parametres.avecInformations === true,
        data: this.widgets.actualites,
      });
    }
    function _construireInformations() {
      return _construireSectionWidget.call(this, {
        estVisible: _estVisible_Informations.call(this),
        classWidget: 'actualites',
        titre: GTraductions.getValeur('pagePubliqueEtab.informations'),
        id: this.widgets.actualites.id,
      });
    }
    function _estVisible_Agenda(aParam) {
      return _estVisibleSectionWidget.call(this, aParam, {
        estPublie: this.parametres.avecAgenda === true,
        data: this.widgets.agenda,
      });
    }
    function _construireAgenda() {
      return _construireSectionWidget.call(this, {
        estVisible: _estVisible_Agenda.call(this),
        classWidget: 'agenda fluid-mobile',
        titre: GTraductions.getValeur('accueil.agenda.titre'),
        id: this.widgets.agenda.id,
      });
    }
    function _estVisible_LiensUtiles(aParam) {
      return _estVisibleSectionWidget.call(this, aParam, {
        estPublie: this.parametres.avecLiensUtiles === true,
        data: this.widgets.lienUtile,
      });
    }
    function _construireLiensUtiles() {
      return _construireSectionWidget.call(this, {
        estVisible: _estVisible_LiensUtiles.call(this),
        classWidget: 'lienutile fluid-mobile',
        titre: GTraductions.getValeur('accueil.lienUtile.titre'),
        id: this.widgets.lienUtile.id,
      });
    }
    function _estVisible_MenuCantine(aParam) {
      return _estVisibleSectionWidget.call(this, aParam, {
        estPublie: this.parametres.avecMenuCantine === true,
        data: this.widgets.menuDeLaCantine,
      });
    }
    function _construireMenuCantine() {
      return _construireSectionWidget.call(this, {
        estVisible: _estVisible_MenuCantine.call(this),
        classWidget: 'menudelacantine fluid-mobile',
        titre: GTraductions.getValeur('accueil.menu'),
        id: this.widgets.menuDeLaCantine.id,
      });
    }
    function _construireGaleriePhotos() {
      const H = [];
      if (this.parametres.avecGaleriePhotos) {
        H.push(
          '<article class="widget ' +
            ThemesCouleurs.getClassThemeCourant() +
            ' galerie" ie-display="getVisibiliteGaleriePhotos">',
        );
        H.push(
          '<header>' +
            '<h3>' +
            GTraductions.getValeur('pagePubliqueEtab.galeriePhotos') +
            '</h3>' +
            '</header>',
        );
        H.push(
          '<div id="',
          this.identGalerie.getNom(),
          '" class="accueil-widget-content" ></div>',
        );
        H.push('</article>');
      }
      return H.join('');
    }
    function _initCarrousel(aParams) {
      aParams.instance.setOptions({
        dimensionPhoto: 300,
        nbMaxDiaposEnZoneVisible: 4,
        avecSuppression: false,
        avecEditionLegende: false,
        afficherNomFichierSiLibelleVide: false,
        altImage: GTraductions.getValeur('pagePubliqueEtab.altImgViewer'),
      });
      const lListeImages = aParams.listePhotosGalerie;
      const lListeDiapos = new ObjetListeElements();
      lListeImages.parcourir((aImgPE) => {
        let lDiapo = new ObjetElement();
        lDiapo.setLibelle(aImgPE.descriptif);
        aImgPE.miniature = TypeGenreMiniature.GM_600;
        lDiapo.documentCasier = aImgPE;
        lListeDiapos.add(lDiapo);
      });
      aParams.instance.initialiser();
      aParams.instance.setDonnees({
        listeDiapos: lListeDiapos,
        ressourceDocJoint: null,
      });
    }
    function _construirePied() {
      const H = [];
      this.afficherCookieInfo = this.afficherCookieInfo();
      if (this.afficherCookieInfo && !GApplication.getDemo()) {
        H.push(this.composeCookiesInfo());
      }
      H.push('<footer>');
      H.push(_construireLiensFooter.call(this));
      H.push(_construireCopyright.call(this));
      H.push('</footer>');
      return H.join('');
    }
    function _construireLiensFooter() {
      const H = [];
      let lLFooterEstVide =
        !this.parametres.avecContact &&
        (this.parametres.listeInformationsEtablissements === null ||
          this.parametres.listeInformationsEtablissements === undefined) &&
        !this.parametres.avecMentionsLegales &&
        (!this.parametres.avecSiteWeb || this.parametres.SiteInternet === '') &&
        !this.parametres.avecTwitter &&
        !this.parametres.avecFacebook &&
        !this.parametres.avecYouTube &&
        !this.parametres.avecInstagram;
      H.push(
        '<div class="liensFooter',
        lLFooterEstVide ? ' est-vide' : '',
        '">',
        '<nav class="liensInfosEtab">',
      );
      if (this.parametres.avecSiteWeb && this.parametres.SiteInternet !== '') {
        H.push(
          '<div ie-display="getVisibiliteSiteWeb" class="lien"><a href="',
          this.parametres.SiteInternet,
          '">',
          GTraductions.getValeur('pagePubliqueEtab.siteWeb'),
          '</a></div>',
        );
      }
      if (
        this.parametres.avecContact &&
        this.parametres.listeInformationsEtablissements !== null &&
        this.parametres.listeInformationsEtablissements !== undefined
      ) {
        H.push(
          '<div role="link" ie-node="getNodeContact" tabindex="0" ie-display="getVisibiliteContact" class="lien">',
          GTraductions.getValeur('pagePubliqueEtab.contact'),
          '</div>',
        );
      }
      if (this.parametres.avecMentionsLegales) {
        H.push(
          '<div role="link" ie-node="getNodeMentionsLegales" tabindex="0" ie-display="getVisibiliteMentionsLegales" class="lien">',
          GTraductions.getValeur('pagePubliqueEtab.mentionsLegales'),
          '</div>',
        );
      }
      H.push('</nav>');
      H.push(
        '<div class="liensReseauxSoc" ie-display="getVisibiliteReseauxSociaux">',
      );
      if (this.parametres.avecTwitter) {
        H.push(
          '<ie-btnimage ie-model="btnReseauxSociaux(' +
            this.genreCommandeRS.twitter +
            ')" class="icon_twitter btnImageIcon ibp-command" title="' +
            GTraductions.getValeur('pagePubliqueEtab.twitter') +
            '">' +
            '</ie-btnimage>',
        );
      }
      if (this.parametres.avecFacebook) {
        H.push(
          '<ie-btnimage ie-model="btnReseauxSociaux(' +
            this.genreCommandeRS.facebook +
            ')" class="icon_facebook btnImageIcon ibp-command" title="' +
            GTraductions.getValeur('pagePubliqueEtab.facebook') +
            '">' +
            '</ie-btnimage>',
        );
      }
      if (this.parametres.avecYouTube) {
        H.push(
          '<ie-btnimage ie-model="btnReseauxSociaux(' +
            this.genreCommandeRS.youtube +
            ')" class="icon_youtube btnImageIcon ibp-command" title="' +
            GTraductions.getValeur('pagePubliqueEtab.youtube') +
            '">' +
            '</ie-btnimage>',
        );
      }
      if (this.parametres.avecInstagram) {
        H.push(
          '<ie-btnimage ie-model="btnReseauxSociaux(' +
            this.genreCommandeRS.instagram +
            ')" class="icon_instagram btnImageIcon ibp-command" title="' +
            GTraductions.getValeur('pagePubliqueEtab.instagram') +
            '">' +
            '</ie-btnimage>',
        );
      }
      H.push('</div>');
      H.push('</div>');
      return H.join('');
    }
    function _construireCopyright() {
      const H = [];
      H.push('<section class="copyright">');
      if (this.parametres.estHebergeEnFrance) {
        H.push(
          '<div tabindex="0" role="link" class="host-france-container" onclick="window.open (\'',
          this.parametres.urlSiteInfosHebergement,
          '\');" onkeyup="if(GNavigateur.isToucheSelection())window.open (\'',
          this.parametres.urlSiteInfosHebergement,
          '\');">',
          '<span class="host-text">',
          GTraductions.getValeur('pagePubliqueEtab.hebergementDonneesFrance'),
          '</span>',
          '<div class="logo-index-contain"><span class="logo-index-inverse"></span></div>',
          _espacesISO27001.call(this)
            ? '<span class="certif-27001">' +
                GTraductions.getValeur('pagePubliqueEtab.certifISO27001') +
                '</span>'
            : '',
          '</div>',
        );
      }
      H.push(
        '<span tabindex="0" role="link" onclick="window.open (\'',
        this.parametres.urlSiteIndexEducation,
        '\');" onkeyup="if(GNavigateur.isToucheSelection())window.open (\'',
        this.parametres.urlSiteIndexEducation,
        '\');">',
        GTraductions.getValeur('pagePubliqueEtab.copyright', [
          this.parametres.millesime,
        ]),
        '</span>',
      );
      H.push('</section>');
      return H.join('');
    }
    function _espacesISO27001() {
      return !this.options.estPrimaire;
    }
    function _getURLRacine() {
      const lUrl = window.location.href.split('/');
      lUrl.pop();
      return lUrl.join('/') + '/';
    }
    function _evntBtnAccesEspace() {
      const lUrlRel = this.parametres.urlConnexionEspaces;
      if (lUrlRel !== null && lUrlRel !== undefined) {
        let lUrl =
          _getURLRacine.call() +
          lUrlRel +
          new UtilitaireRedirection().getParametresUrl();
        window.location.assign(lUrl);
      }
    }
    function _initDatesEtCyclesCasPagePubliqueEtablissement() {
      GDate.setDonnees(
        GParametres.PremierLundi,
        GParametres.PremiereDate,
        GParametres.DerniereDate,
        null,
        null,
        null,
        null,
        null,
        null,
        GParametres.JoursOuvres,
      );
      IE.Cycles = new ObjetCycles();
      IE.Cycles.init({
        premiereDate: GParametres.PremiereDate,
        derniereDate: GParametres.DerniereDate,
        joursOuvresParCycle: GParametres.joursDemiPension.count(),
        joursOuvres: GParametres.joursDemiPension,
      });
    }
    module.exports = { UtilitairePagePubliqueEtablissement };
  },
  fn: 'utilitairepagepubliqueetablissement.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.TypeArrierePlanAuthentification = void 0;
    var TypeArrierePlanAuthentification;
    (function (TypeArrierePlanAuthentification) {
      TypeArrierePlanAuthentification[
        (TypeArrierePlanAuthentification['Photo'] = 0)
      ] = 'Photo';
      TypeArrierePlanAuthentification[
        (TypeArrierePlanAuthentification['_Rebus'] = 1)
      ] = '_Rebus';
      TypeArrierePlanAuthentification[
        (TypeArrierePlanAuthentification['Neutre'] = 2)
      ] = 'Neutre';
      TypeArrierePlanAuthentification[
        (TypeArrierePlanAuthentification['PersonnaliseURL'] = 3)
      ] = 'PersonnaliseURL';
      TypeArrierePlanAuthentification[
        (TypeArrierePlanAuthentification['Louvre'] = 4)
      ] = 'Louvre';
      TypeArrierePlanAuthentification[
        (TypeArrierePlanAuthentification['Arbre'] = 5)
      ] = 'Arbre';
      TypeArrierePlanAuthentification[
        (TypeArrierePlanAuthentification['PersonnaliseFichier'] = 6)
      ] = 'PersonnaliseFichier';
    })(
      TypeArrierePlanAuthentification ||
        (exports.TypeArrierePlanAuthentification =
          TypeArrierePlanAuthentification =
            {}),
    );
  },
  fn: 'typearriereplanauthentification.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const {
      TypeArrierePlanAuthentification,
    } = require('TypeArrierePlanAuthentification.js');
    const { GDate } = require('ObjetDate.js');
    class ObjetImageConnexion {
      constructor() {
        this.definitionImages = [];
        this.definitionImagesExtra = {};
      }
      getClassImage() {
        return '';
      }
      getObjetImagePronote(aGenreImageConnexion) {
        let lDate = new Date();
        if (
          location &&
          location.search &&
          location.search.search(/dateCnx=[0-9]{4}-[0-9]{2}-[0-9]{2}/) > -1
        ) {
          const lDateMatch = location.search.match(
            /dateCnx=([0-9]{4}-[0-9]{2}-[0-9]{2})/,
          );
          lDate = new Date(lDateMatch[1]);
        }
        let lResult = {};
        try {
          switch (aGenreImageConnexion) {
            case TypeArrierePlanAuthentification.Photo:
              lResult =
                this.definitionImages[TypeArrierePlanAuthentification.Photo][
                  lDate.getMonth() %
                    this.definitionImages[TypeArrierePlanAuthentification.Photo]
                      .length
                ];
              break;
            case TypeArrierePlanAuthentification.Louvre:
              if (
                this.definitionImages[TypeArrierePlanAuthentification.Louvre]
                  .length === 12
              ) {
                lResult =
                  this.definitionImages[TypeArrierePlanAuthentification.Louvre][
                    lDate.getMonth() %
                      this.definitionImages[
                        TypeArrierePlanAuthentification.Louvre
                      ].length
                  ];
              } else if (
                this.definitionImages[TypeArrierePlanAuthentification.Louvre]
                  .length === 53
              ) {
                const lDatePourSemaine = new Date(lDate.getTime());
                lDatePourSemaine.setHours(0, 0, 0, 0);
                lDatePourSemaine.setDate(
                  lDatePourSemaine.getDate() +
                    3 -
                    ((lDatePourSemaine.getDay() + 6) % 7),
                );
                const lWeek1 = new Date(lDatePourSemaine.getFullYear(), 0, 4);
                const lSemaine =
                  1 +
                  Math.round(
                    ((lDatePourSemaine.getTime() - lWeek1.getTime()) /
                      86400000 -
                      3 +
                      ((lWeek1.getDay() + 6) % 7)) /
                      7,
                  );
                lResult =
                  this.definitionImages[TypeArrierePlanAuthentification.Louvre][
                    (lSemaine - 1) %
                      this.definitionImages[
                        TypeArrierePlanAuthentification.Louvre
                      ].length
                  ];
              } else {
                lResult =
                  this.definitionImages[TypeArrierePlanAuthentification.Louvre][
                    GDate.getNbrJoursEntreDeuxDates(
                      new Date(lDate.getFullYear(), 0, 1),
                      lDate,
                    ) %
                      this.definitionImages[
                        TypeArrierePlanAuthentification.Louvre
                      ].length
                  ];
              }
              if (
                this.definitionImagesExtra[
                  lDate.getMonth() + '-' + lDate.getDate()
                ]
              ) {
                lResult =
                  this.definitionImagesExtra[
                    lDate.getMonth() + '-' + lDate.getDate()
                  ];
                if (lResult.suiviLogo1) {
                  lResult.suiviLien = lResult.suiviLogo1;
                }
              }
              if (new Date() >= lResult.dateMaxLien) {
                lResult.lien = '';
                lResult.lienSuite = '';
              }
              break;
            case TypeArrierePlanAuthentification.Arbre:
              lDate.setFullYear(1900);
              if (lDate < new Date(1900, 2, 20)) {
                lResult =
                  this.definitionImages[
                    TypeArrierePlanAuthentification.Arbre
                  ][0];
              } else if (lDate < new Date(1900, 5, 21)) {
                lResult =
                  this.definitionImages[
                    TypeArrierePlanAuthentification.Arbre
                  ][1];
              } else if (lDate < new Date(1900, 8, 23)) {
                lResult =
                  this.definitionImages[
                    TypeArrierePlanAuthentification.Arbre
                  ][2];
              } else if (lDate < new Date(1900, 11, 21)) {
                lResult =
                  this.definitionImages[
                    TypeArrierePlanAuthentification.Arbre
                  ][3];
              } else {
                lResult =
                  this.definitionImages[
                    TypeArrierePlanAuthentification.Arbre
                  ][0];
              }
              break;
            default:
              lResult = {};
              break;
          }
        } catch (e) {
          lResult = {};
        }
        return lResult;
      }
      getClassFond() {
        return 'Image_Connexion_Fond Repeat';
      }
      setDefinitionImages(aArray) {
        this.definitionImages = aArray;
      }
      setDefinitionImagesExtra(aObjet) {
        this.definitionImagesExtra = aObjet;
      }
    }
    const GImageConnexion = new ObjetImageConnexion();
    module.exports = GImageConnexion;
  },
  fn: 'objetimageconnexion.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitaireChangementLangue = void 0;
    require('ChangementLangue.css');
    const LocalStorage_1 = require('LocalStorage');
    const MethodesObjet_1 = require('MethodesObjet');
    const ControleSaisieEvenement_1 = require('ControleSaisieEvenement');
    const Enumere_Action_1 = require('Enumere_Action');
    const Enumere_BoiteMessage_1 = require('Enumere_BoiteMessage');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const Enumere_EvenementObjetSaisie_1 = require('Enumere_EvenementObjetSaisie');
    const UtilitaireChangementLangueProduit_1 = require('UtilitaireChangementLangueProduit');
    exports.UtilitaireChangementLangue = Object.assign(
      {
        avecChoixLangues: function () {
          return (
            !GApplication.estAppliMobile &&
            GParametres.listeLangues &&
            GParametres.listeLangues.count() > 1
          );
        },
        getListeLangues: function () {
          const lListe = MethodesObjet_1.MethodesObjet.dupliquer(
            GParametres.listeLangues,
          );
          lListe.parcourir((D) => {
            D.Libelle = D.description;
            const lImage = exports.UtilitaireChangementLangue.getImageCss(
              D.langID,
            );
            D.imageDrapeau = lImage
              ? IE.jsx.str('div', {
                  class: exports.UtilitaireChangementLangue.getImageCss(
                    D.langID,
                  ),
                  role: 'img',
                  'aria-label': D.Libelle,
                })
              : '';
            D.libelleHtml = lImage
              ? IE.jsx.str(
                  'div',
                  { class: 'flag-img' },
                  IE.jsx.str('div', { 'aria-hidden': 'true' }, D.imageDrapeau),
                  IE.jsx.str(
                    'div',
                    {
                      class: 'flag-label',
                      'ie-ellipsis': true,
                      lang: exports.UtilitaireChangementLangue.getCodeLangueIso639(
                        D.langID,
                      ),
                    },
                    D.Libelle,
                  ),
                )
              : D.Libelle;
          });
          lListe.trier();
          return lListe;
        },
        modifierLangue: function (aLangue) {
          if (!LocalStorage_1.IELocalStorage.actif) {
            GApplication.getMessage().afficher({
              titre: ObjetTraduction_1.GTraductions.getValeur(
                'ChangementLangue.ChangerLangueImpossible',
              ),
              message: ObjetTraduction_1.GTraductions.getValeur(
                'ChangementLangue.ChangerLangueImpossibleDetail',
              ),
            });
            return;
          }
          if (!aLangue || !aLangue.langID) {
            return;
          }
          (0, ControleSaisieEvenement_1.ControleSaisieEvenement)(() => {
            GApplication.getMessage().afficher({
              type: Enumere_BoiteMessage_1.EGenreBoiteMessage.Confirmation,
              message: ObjetTraduction_1.GTraductions.getValeur(
                'ChangementLangue.MessageConfirmationChangerLangue',
              ),
              callback: function (aGenre) {
                if (aGenre === Enumere_Action_1.EGenreAction.Valider) {
                  exports.UtilitaireChangementLangue.affecterLangue(
                    aLangue.langID,
                  );
                }
              },
            });
          });
        },
        construire: function (aControleur, aOptions) {
          if (!aControleur) {
            return '';
          }
          if (!this.avecChoixLangues()) {
            return '';
          }
          let lIndiceSelection = -1;
          const lListe = exports.UtilitaireChangementLangue.getListeLangues();
          aControleur.comboChangementLangue = {
            init: function (aInstance) {
              aInstance.setOptionsObjetSaisie({
                iconeGauche: '',
                longueur: 22,
                largeurListe: 180,
                avecBouton: false,
                avecEventSurFermetureListe:
                  !!aOptions && !!aOptions.avecEventFermeture,
                getContenuCellule: function () {
                  const lElement = lListe.get(lIndiceSelection);
                  if (lElement) {
                    return { libelleHtml: lElement.imageDrapeau };
                  }
                },
                optionsBouton: {
                  avecBordures: false,
                  avecFocusVisibleTexte: false,
                  titleForce: ObjetTraduction_1.GTraductions.getValeur(
                    'ChangementLangue.ChangerLaLangue',
                  ),
                  classeZone: '',
                },
              });
              aInstance.setDonnees(lListe, lIndiceSelection);
            },
            event: function (aParametres, aCombo) {
              if (
                aParametres.genreEvenement ===
                  Enumere_EvenementObjetSaisie_1.EGenreEvenementObjetSaisie
                    .selection &&
                aCombo.InteractionUtilisateur &&
                aParametres.indice !== lIndiceSelection
              ) {
                exports.UtilitaireChangementLangue.modifierLangue(
                  aParametres.element,
                );
              }
            },
            getDisabled: function () {
              return lListe.count() < 2;
            },
          };
          lListe.parcourir((aElement, aIndex) => {
            if (aElement.langID === GParametres.langID) {
              lIndiceSelection = aIndex;
              return false;
            }
          });
          if (lIndiceSelection < 0) {
            lIndiceSelection = 0;
          }
          return '<ie-combo class="flag-conteneur" ie-model="comboChangementLangue"></ie-combo>';
        },
      },
      UtilitaireChangementLangueProduit_1.UtilitaireChangementLangueProduit,
    );
  },
  fn: 'utilitairechangementlangue.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetBandeauEspace = void 0;
    const ObjetIdentite_1 = require('ObjetIdentite');
    const UtilitaireChangementLangue_1 = require('UtilitaireChangementLangue');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetHtml_1 = require('ObjetHtml');
    const ToucheClavier_1 = require('ToucheClavier');
    const ObjetWAI_1 = require('ObjetWAI');
    const ObjetPosition_1 = require('ObjetPosition');
    const Invocateur_1 = require('Invocateur');
    require('ObjetBandeauEspace.css');
    class ObjetBandeauEspace extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.params = {
          labelConteneur: '',
          urlLogoEtab: GParametres.urlLogo,
          nomEtab: GParametres.NomEtablissementConnexion
            ? GParametres.NomEtablissementConnexion
            : GParametres.NomEtablissement,
          getNomUtil: null,
          attrUtil: '',
          ariaLabelUtil: '',
          classUtil: '',
          photo: null,
          logoProduitCss: GParametres.logoProduitCss || '',
          logoProduitUrl:
            GParametres.urlSiteIndexEducation ||
            'https://www.index-education.com',
          labelLienProduit: GParametres.labelLienProduit || '',
          logoDepartementImage: '',
          logoDepartementLien: '',
          mention: GParametres.lienMentions,
          avecLangue: true,
          getObjetSelecteurMembre: null,
          htmlBoutonFicheEleve: null,
          htmlBoutonsAvantNotif: null,
          getObjetNotification: null,
          getObjetAide: null,
          htmlBoutons: '',
          iconesADroite: false,
          clickUtilisateur: null,
          clickDeconnexion: null,
          clickAccesMobile: null,
          clickEtablissement: null,
          isEDT: false,
          controleur: null,
          avecFicheEtablissement: false,
          avecLiensEvitement: false,
          liensEvitement: {
            menuOnglet: false,
            urlDeclarationAccessibilite: null,
            clickPlanSite: null,
          },
        };
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          getNodeRacine: function () {
            $(window).on('resize.ObjetBandeauEspace', () => {
              aInstance._resize();
            });
            $(this.node).on('destroyed', () => {
              $(window).off('resize.ObjetBandeauEspace');
            });
          },
          getNodeCentre: function () {},
          getNodeNomEtab: function () {
            if (aInstance.params.clickEtab) {
              $(this.node).on('click keyup', (aEvent) => {
                if (
                  aEvent.type === 'keyup' &&
                  !(
                    aEvent.which === ToucheClavier_1.ToucheClavier.Espace ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.RetourChariot
                  )
                ) {
                  return;
                }
                aEvent.originalEvent.__clickZone__ = true;
                aInstance.params.clickEtab();
              });
              return;
            }
          },
          nodeEtablissement: function () {
            if (aInstance.params.clickEtablissement) {
              $(this.node).eventValidation((aEvent) => {
                aInstance.params.clickEtablissement();
                aEvent.stopPropagation();
              });
            }
          },
          util: {
            avecUtil: function () {
              return aInstance.params.getNomUtil
                ? !!aInstance.params.getNomUtil()
                : false;
            },
            getNodeUtil: function () {
              $(this.node).on('click keyup', function (aEvent) {
                if (
                  aEvent.type === 'keyup' &&
                  !(
                    aEvent.which === ToucheClavier_1.ToucheClavier.Espace ||
                    aEvent.which === ToucheClavier_1.ToucheClavier.RetourChariot
                  )
                ) {
                  return;
                }
                aEvent.originalEvent.__clickZone__ = true;
                aInstance.params.clickUtilisateur(aEvent, this);
              });
            },
            getHtmlUtil: function () {
              return aInstance.params.getNomUtil
                ? aInstance.params.getNomUtil()
                : '';
            },
            avecPhoto: function () {
              return aInstance.params.photo.getUrlPhoto
                ? aInstance.params.photo.getUrlPhoto() !== ''
                : false;
            },
            getNodeImgPhoto: function () {
              $(this.node).on('error', function () {
                $(this).parent().find('.ibe_util_photo_i').show();
                $(this).remove();
              });
            },
            getHtmlPhoto: function () {
              const lUrl = aInstance.params.photo.getUrlPhoto
                ? aInstance.params.photo.getUrlPhoto()
                : '';
              if (lUrl) {
                return [
                  IE.jsx.str('img', {
                    src: lUrl,
                    style: 'width:100%;',
                    'ie-node': 'util.getNodeImgPhoto',
                    alt: aInstance.params.getNomUtil
                      ? ObjetTraduction_1.GTraductions.getValeur('PhotoDe_S', [
                          aInstance.params.getNomUtil(),
                        ])
                      : '',
                  }),
                  '<div class="ibe_util_photo_i"',
                  lUrl ? ' style="display:none"' : '',
                  '>',
                  '<i class="icon_utilisateur"></i>',
                  '</div>',
                ].join('');
              }
              return '';
            },
            getAttrUtil: function () {
              const lNom = aInstance.params.getNomUtil
                ? aInstance.params.getNomUtil()
                : '';
              const lLabelUtil = aInstance.params.ariaLabelUtil;
              const lLibelle =
                (lNom ? lNom + (lLabelUtil ? ' - ' : '') : '') +
                (lLabelUtil ? lLabelUtil : '');
              return { 'aria-label': lLibelle };
            },
          },
          getNodeNotif: function () {
            $(this.node).eventValidation((aEvent) => {
              aEvent.originalEvent.__clickZone__ = true;
            });
          },
          getNodeAccesMobile: function () {
            $(this.node).eventValidation((aEvent) => {
              aEvent.originalEvent.__clickZone__ = true;
              aInstance.params.clickAccesMobile();
            });
          },
          getNodeDeconnexion: function () {
            $(this.node).eventValidation((aEvent) => {
              aEvent.originalEvent.__clickZone__ = true;
              aInstance.params.clickDeconnexion();
            });
          },
          getNodeImage: function () {
            $(this.node).on('load', () => {
              aInstance._resize();
            });
          },
          getObjetSelecteurMembre: function () {
            return aInstance.params.getObjetSelecteurMembre;
          },
          getObjetNotification: function () {
            return aInstance.params.getObjetNotification;
          },
          getObjetAide: function () {
            return aInstance.params.getObjetAide;
          },
          getAttrBanner() {
            return { tabindex: aInstance.params.avecLiensEvitement ? -1 : 0 };
          },
          nodeContenu() {
            $(this.node).eventValidation(() => {
              if (global.GInterface && GInterface.setFocusPremierObjet) {
                GInterface.setFocusPremierObjet();
              } else {
                ObjetHtml_1.GHtml.setFocus($('#breadcrumbBandeau').get(0));
              }
            });
          },
          nodeMenu() {
            $(this.node).eventValidation(() => {
              Invocateur_1.Invocateur.evenement('focus.menu_navigation');
            });
          },
          nodePlanSite() {
            $(this.node).eventValidation(() => {
              aInstance.params.liensEvitement.clickPlanSite();
            });
          },
        });
      }
      setParametres(aParams) {
        Object.assign(this.params, aParams);
        if (this.params.controleur) {
          Object.assign(this.controleur, this.params.controleur);
        }
      }
      construireAffichage() {
        const lParams = Object.assign({}, this.params);
        if (lParams.getNomUtil) {
          lParams.labelConteneur =
            ObjetChaine_1.GChaine.enleverEntites(lParams.getNomUtil()) +
            ' ' +
            lParams.labelConteneur;
        }
        const H = [];
        H.push(
          '<div class="ObjetBandeauEspace" ie-node="getNodeRacine" ie-attr="getAttrBanner" role="banner" aria-label="',
          ObjetChaine_1.GChaine.toTitle(lParams.labelConteneur),
          '">',
        );
        if (lParams.avecLiensEvitement) {
          H.push(
            lParams.liensEvitement.menuOnglet
              ? `<a class="evitement" tabindex="0" ie-node="nodeMenu">${ObjetTraduction_1.GTraductions.getValeur('BandeauEspace.LiensEvitement.Menu')}</a>`
              : '',
            `<a class="evitement" tabindex="0" ie-node="nodeContenu">${ObjetTraduction_1.GTraductions.getValeur('BandeauEspace.LiensEvitement.Contenu')}</a>`,
            lParams.liensEvitement.urlDeclarationAccessibilite
              ? `<a class="evitement" tabindex="0" href="${lParams.liensEvitement.urlDeclarationAccessibilite}">${ObjetTraduction_1.GTraductions.getValeur('PiedPage.declarationAccessibilite')}</a>`
              : '',
            lParams.liensEvitement.clickPlanSite
              ? `<a class="evitement" tabindex="0" ie-node="nodePlanSite">${ObjetTraduction_1.GTraductions.getValeur('PiedPage.planSite')}</a>`
              : '',
          );
        }
        H.push('<div class="ibe_gauche">');
        const lImageCollectiviteDepartement =
          lParams.logoCollectiviteImage || lParams.logoDepartementImage;
        if (!!lImageCollectiviteDepartement) {
          let lLienCollectiviteDepartement = lParams.logoDepartementLien;
          if (lParams.logoCollectiviteLien && lParams.logoCollectiviteImage) {
            lLienCollectiviteDepartement = lParams.logoCollectiviteLien;
          }
          H.push(
            '<a ',
            !!lLienCollectiviteDepartement
              ? 'href="' + lLienCollectiviteDepartement + '"'
              : '',
            ' target="_blank" class="ibe_image_dep" ',
            !!lParams.logoDepartementLien
              ? 'title="' +
                  ObjetTraduction_1.GTraductions.getValeur(
                    'BandeauEspace.AccederSiteDepartement',
                  ) +
                  '"'
              : '',
            '>',
            '<img src="',
            lImageCollectiviteDepartement,
            '" alt="',
            ObjetTraduction_1.GTraductions.getValeur(
              'BandeauEspace.LogoDepartement',
            ),
            '" onerror="$(this).parent().remove();" ie-node="getNodeImage" />',
            '</a>',
          );
        }
        if (lParams.urlLogoEtab) {
          H.push(
            '<div ie-node="getNodeNomEtab" class="ibe_image_etab',
            lParams.clickEtab ? ' ibe_actif' : '',
            '" role="presentation">',
            `<img src="${lParams.urlLogoEtab}" alt="${ObjetTraduction_1.GTraductions.getValeur('BandeauEspace.LogoEtablissement')}" onerror="$(this).remove();" ie-node="getNodeImage" />`,
            '</div>',
          );
        }
        H.push('</div>');
        H.push(
          '<div class="ibe_centre" ie-node="getNodeCentre"',
          lParams.getObjetSelecteurMembre ||
            (lParams.getObjetNotification && !lParams.iconesADroite)
            ? ''
            : ' style="overflow:hidden;"',
          '>',
        );
        if (lParams.photo) {
          H.push(
            '<div class="ibe_util_photo',
            lParams.clickUtilisateur ? ' ibe_actif' : '',
            '" ie-if="util.avecPhoto" ie-html="util.getHtmlPhoto" ie-node="util.getNodeUtil" ',
            lParams.attrUtil,
            lParams.ariaLabelUtil
              ? ObjetWAI_1.GObjetWAI.composeAttribut({
                  genre: ObjetWAI_1.EGenreAttribut.label,
                  valeur: lParams.ariaLabelUtil,
                })
              : '',
            ' aria-hidden="true"></div>',
          );
        }
        H.push(
          '<div class="ibe_etab_util">',
          lParams.nomEtab || lParams.avecFicheEtablissement
            ? [
                '<div class="AvecMain ibe_etab_cont" ie-node="nodeEtablissement">',
                '<div ',
                lParams.nomEtab
                  ? 'ie-node="getNodeNomEtab" class="ibe_etab' +
                    (lParams.clickEtab ? ' ibe_actif' : '') +
                    '"'
                  : '',
                '>',
                lParams.avecFicheEtablissement
                  ? '<ie-btnimage class="icon_uniF2C3 btnImageIcon InlineBlock EspaceDroit AvecMain" title="' +
                    ObjetTraduction_1.GTraductions.getValeur(
                      'FicheEtablissement.ContacterEtablissement',
                    ) +
                    '"></ie-btnimage>'
                  : '',
                lParams.nomEtab,
                '</div>',
                '</div>',
              ].join('')
            : '',
          '<div class="ibe_util" ie-if="util.avecUtil">',
          '<div class="ibe_util_texte',
          lParams.clickUtilisateur && !lParams.isEDT ? ' ibe_actif' : '',
          '" ie-html="util.getHtmlUtil" ie-node="util.getNodeUtil" tabindex="0" ie-attr="util.getAttrUtil" ',
          lParams.attrUtil,
          '></div>',
          lParams.iconesADroite ? '' : _construireIcones.call(this, lParams),
          '</div>',
          '</div>',
        );
        if (lParams.getObjetSelecteurMembre) {
          H.push('<div ie-identite="getObjetSelecteurMembre"></div>');
        }
        if (lParams.htmlBoutonFicheEleve) {
          H.push(
            '<div class="m-left-l">',
            lParams.htmlBoutonFicheEleve,
            '</div>',
          );
        }
        H.push('</div>');
        H.push(
          '<div class="ibe_droite',
          lParams.iconesADroite ? ' ibe_droite_fixe' : '',
          '">',
        );
        if (lParams.iconesADroite) {
          H.push(_construireIcones.call(this, lParams));
        }
        if (
          lParams.avecLangue &&
          UtilitaireChangementLangue_1.UtilitaireChangementLangue.avecChoixLangues()
        ) {
          H.push(
            '<div class="ibe_langue">' +
              UtilitaireChangementLangue_1.UtilitaireChangementLangue.construire(
                this.controleur,
                { avecEventFermeture: true },
              ) +
              '</div>',
          );
        }
        if (lParams.logoProduitCss) {
          H.push(
            '<div class="ibe_logo">',
            '<a href="',
            lParams.logoProduitUrl,
            '" target="_blank" class="ibe_logo_image ',
            lParams.logoProduitCss,
            '" title="' + lParams.labelLienProduit + '">',
            '<span class="sr-only">',
            lParams.labelLienProduit,
            '</span>',
            '</a>',
          );
          H.push('</div>');
        }
        H.push('</div>', '</div>');
        return H.join('');
      }
      focusSurPremierElement() {
        ObjetHtml_1.GHtml.setFocus(
          $('#' + this.Nom.escapeJQ() + ' .ObjetBandeauEspace').get(0),
        );
        clearTimeout(this._timeoutResize);
        this._timeoutResize = setTimeout(() => {
          this._resize();
        }, 100);
      }
      _resize() {
        const lSelec = '#' + this.Nom.escapeJQ();
        const lMaxWidthImage = Math.min(
          250,
          Math.round((GNavigateur.clientL * 20) / 100),
        );
        $(
          lSelec + ' .ibe_image_dep img,' + lSelec + ' .ibe_image_etab img',
        ).css('max-width', lMaxWidthImage);
        const lJCentre = $(lSelec + ' .ibe_centre');
        const lRectDroit = ObjetPosition_1.GPosition.getClientRect(
          $(lSelec + ' .ibe_droite').get(0),
        );
        const lWidthGauche = Math.round($(lSelec + ' .ibe_gauche').width() + 5);
        const lWidthDroit = Math.round(lRectDroit.width + 5);
        const lMax = Math.max(
          IE.estMobile ? 100 : 250,
          GNavigateur.clientL - lWidthGauche - lWidthDroit,
        );
        lJCentre.parent().css('justify-content', 'center');
        lJCentre.css({ 'max-width': lMax + 'px', 'margin-left': '' });
        const lRectCentre = ObjetPosition_1.GPosition.getClientRect(
          lJCentre.get(0),
        );
        if (
          lRectCentre.left < lWidthGauche ||
          lRectCentre.right > lRectDroit.left
        ) {
          lJCentre.parent().css('justify-content', 'flex-start');
          lJCentre.css({ 'margin-left': lWidthGauche });
        }
      }
    }
    exports.ObjetBandeauEspace = ObjetBandeauEspace;
    function _construireIcones(aParams) {
      const H = [];
      if (aParams.htmlBoutonsAvantNotif) {
        H.push(aParams.htmlBoutonsAvantNotif);
      }
      if (aParams.getObjetNotification) {
        H.push(
          '<div ie-identite="getObjetNotification" class="ibe_notification" ie-node="getNodeNotif"></div>',
        );
      }
      if (aParams.getObjetAide) {
        H.push(
          '<div ie-identite="getObjetAide" class="ibe_notification" ie-node="getNodeNotif"></div>',
        );
      }
      if (aParams.htmlBoutons) {
        H.push(aParams.htmlBoutons);
      }
      if (aParams.clickAccesMobile) {
        const lTitleQRCode = ObjetChaine_1.GChaine.toTitle(
          ObjetTraduction_1.GTraductions.getValeur('Commande.QRCode.Actif'),
        );
        H.push(
          '<div class="ibe_iconebtn ibe_actif" tabindex="0" role="button" ie-node="getNodeAccesMobile" aria-label="',
          ObjetTraduction_1.GTraductions.getValeur('Commande.QRCode.Actif'),
          '">',
          '<i class="icon_qr_code colorFoncee" title="',
          lTitleQRCode,
          '" aria-hidden="true"></i>',
          '</div>',
        );
      }
      if (aParams.clickDeconnexion && !aParams.isEDT) {
        const lTitleDeconnexion = ObjetChaine_1.GChaine.toTitle(
          ObjetTraduction_1.GTraductions.getValeur('connexion.SeDeconnecter'),
        );
        H.push(
          '<div class="ibe_iconebtn ibe_actif" tabindex="0" role="button" ie-node="getNodeDeconnexion" aria-label="',
          ObjetTraduction_1.GTraductions.getValeur('connexion.SeDeconnecter'),
          '">',
          '<i class="icon_off colorFoncee" title="',
          lTitleDeconnexion,
          '" aria-hidden="true"></i>',
          '</div>',
        );
      }
      return H.join('');
    }
  },
  fn: 'objetbandeauespace.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetFenetre_PlanSite = void 0;
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const Invocateur_1 = require('Invocateur');
    const MethodesObjet_1 = require('MethodesObjet');
    const jsx_1 = require('jsx');
    class ObjetFenetre_PlanSite extends ObjetFenetre_1.ObjetFenetre {
      constructor(...aParams) {
        super(...aParams);
        this.setOptionsFenetre({
          largeur: 450,
          hauteur: 320,
          hauteurMaxContenu: 720,
          avecScroll: true,
          listeBoutons: [ObjetTraduction_1.GTraductions.getValeur('Fermer')],
        });
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          naviguerVers(aGenreOnglet) {
            $(this.node).eventValidation(() => {
              Invocateur_1.Invocateur.evenement(
                Invocateur_1.ObjetInvocateur.events.navigationOnglet,
                aGenreOnglet,
              );
            });
          },
        });
      }
      setDonnees() {
        this.afficher();
      }
      composeContenu() {
        return IE.jsx.str('ul', { class: 'browser-default' }, (H) => {
          const lTabOnglet = this.getTabOngletsVisibles();
          lTabOnglet.parcourir((aOnglet) => {
            H.push(
              this._ajouterLigne(
                aOnglet,
                aOnglet.sousOnglets && aOnglet.sousOnglets.count() === 0,
              ),
            );
          });
        });
      }
      getTabOngletsVisibles() {
        const lListeOnglet = new ObjetListeElements_1.ObjetListeElements();
        GEtatUtilisateur.listeOnglets.parcourir((aOnglet) => {
          const lOnglet = MethodesObjet_1.MethodesObjet.dupliquer(aOnglet);
          if (
            lOnglet.Actif &&
            (lOnglet.estUnOnglet || lOnglet.profondeur === 0)
          ) {
            lOnglet.sousOnglets = new ObjetListeElements_1.ObjetListeElements();
            lOnglet.sousOnglets =
              GEtatUtilisateur.listeOnglets.getListeElements((aElement) => {
                if (aElement.Actif && aElement.onglet) {
                  return lOnglet.getGenre() === aElement.onglet.getGenre();
                }
                return false;
              });
            lOnglet.sousOnglets.parcourir((aSousOnglet) => {
              if (aSousOnglet.avecSousOnglet) {
                aSousOnglet.sousOnglets =
                  new ObjetListeElements_1.ObjetListeElements();
                aSousOnglet.sousOnglets =
                  GEtatUtilisateur.listeOnglets.getListeElements(
                    (aSousElement) => {
                      if (aSousElement.Actif && aSousElement.onglet) {
                        return (
                          aSousOnglet.getGenre() ===
                          aSousElement.onglet.getGenre()
                        );
                      }
                      return false;
                    },
                  );
              }
            });
            lListeOnglet.add(lOnglet);
          }
        });
        return lListeOnglet;
      }
      surValidation() {
        this.fermer();
      }
      _ajouterPere(aOnglet) {
        if (aOnglet.sousOnglets && aOnglet.sousOnglets.count() > 0) {
          return IE.jsx.str('ul', { class: 'browser-default' }, (aTab) => {
            aOnglet.sousOnglets.parcourir((aSousOnglet) => {
              aTab.push(
                this._ajouterLigne(
                  aSousOnglet,
                  !aSousOnglet.sousOnglets ||
                    aSousOnglet.sousOnglets.count() === 0,
                ),
              );
            });
          });
        }
        return '';
      }
      _ajouterLigne(aOnglet, aAvecLien) {
        if (aAvecLien) {
          return IE.jsx.str(
            'li',
            null,
            IE.jsx.str(
              'a',
              {
                class: 'AvecMain',
                tabindex: '0',
                'ie-node': (0, jsx_1.jsxFuncAttr)(
                  'naviguerVers',
                  aOnglet.getGenre(),
                ),
              },
              aOnglet.getLibelle(),
            ),
            this._ajouterPere(aOnglet),
          );
        }
        return IE.jsx.str(
          'li',
          null,
          aOnglet.getLibelle().replace('<br>', ' '),
          this._ajouterPere(aOnglet),
        );
      }
    }
    exports.ObjetFenetre_PlanSite = ObjetFenetre_PlanSite;
  },
  fn: 'objetfenetre_plansite.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports._ObjetAffichageBandeauPied = void 0;
    const ObjetIdentite_1 = require('ObjetIdentite');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const LocalStorage_1 = require('LocalStorage');
    const ObjetFenetre_1 = require('ObjetFenetre');
    const ObjetFenetre_MentionsLegales_1 = require('ObjetFenetre_MentionsLegales');
    const ObjetRequeteMentionsLegales_1 = require('ObjetRequeteMentionsLegales');
    const ObjetFenetre_PlanSite_1 = require('ObjetFenetre_PlanSite');
    const ObjetHtml_1 = require('ObjetHtml');
    require('ObjetBandeauPied.css');
    const lCleLocalStorage = 'etatAffichageFooter';
    const lCookieLocalStorage = 'etatAffichageCookiesInfo';
    class _ObjetAffichageBandeauPied extends ObjetIdentite_1.Identite {
      constructor(...aParams) {
        super(...aParams);
        this.etatUtilisateur = global.GEtatUtilisateur;
        this.hauteur = 20;
        this.genreCommande = {
          twitter: 'twitter',
          forum: 'forum',
          videos: 'videos',
          profil: 'pageprofil',
        };
        this.options = {
          mention: '',
          siteIndex: 'https://www.index-education.com',
          urlInfosHebergement: '',
          logoProduitCss: '',
          estHebergeEnFrance: '',
          avecBoutonMasquer: true,
          urlDeclarationAccessibilite: '',
        };
      }
      actionSurMentionsLegales(aParams) {
        let lFenetreMentionsLegales =
          ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
            ObjetFenetre_MentionsLegales_1.ObjetFenetre_MentionsLegales,
            { pere: this, initialiser: function () {} },
          );
        lFenetreMentionsLegales.setOptionsFenetre({
          titre: ObjetTraduction_1.GTraductions.getValeur(
            'PiedPage.mentionsLegales',
          ),
        });
        lFenetreMentionsLegales.setDonnees(aParams);
      }
      actionSurPlanSite() {
        let lFenetrePlanSite = ObjetFenetre_1.ObjetFenetre.creerInstanceFenetre(
          ObjetFenetre_PlanSite_1.ObjetFenetre_PlanSite,
          {
            pere: this,
            initialiser: function (aInstance) {
              aInstance.setOptionsFenetre({
                titre:
                  ObjetTraduction_1.GTraductions.getValeur('PiedPage.planSite'),
              });
            },
          },
        );
        lFenetrePlanSite.setDonnees();
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          btnPied: {
            event: function (aGenre) {
              aInstance.evenementBouton({ genreCmd: aGenre });
            },
          },
          btnFermer: function () {
            $(this.node).eventValidation(function () {
              let lGenreEspace = aInstance.etatUtilisateur
                ? '_' + aInstance.etatUtilisateur.GenreEspace
                : '';
              LocalStorage_1.IELocalStorage.setItem(
                lCookieLocalStorage + lGenreEspace,
                String(false),
              );
              $(this).parent().hide();
            });
          },
          btnMention: function () {
            $(this.node).eventValidation(() => {
              let lRequete =
                new ObjetRequeteMentionsLegales_1.ObjetRequeteMentionsLegales(
                  aInstance,
                  aInstance.actionSurMentionsLegales,
                );
              lRequete.lancerRequete();
            });
          },
          btnPlanSite: function () {
            $(this.node).eventValidation(() => {
              aInstance.actionSurPlanSite();
            });
          },
          nodePied: function (aGenre) {
            $(this.node).eventValidation(() => {
              aInstance.evenementBouton({ genreCmd: aGenre });
            });
          },
          showPied: function () {
            $(this.node).eventValidation(() => {
              if (aInstance.options.avecBoutonMasquer) {
                aInstance.masquerFooter = !aInstance.masquerFooter;
                LocalStorage_1.IELocalStorage.setItem(
                  lCleLocalStorage +
                    '_' +
                    aInstance.etatUtilisateur.GenreEspace,
                  String(aInstance.masquerFooter),
                );
                aInstance.showHideFooter.call(
                  this.node,
                  aInstance.masquerFooter,
                );
                this.controleur.$refreshSelf();
              }
            });
          },
          getAttrShowPied() {
            return {
              title: $('.footer-wrapper').hasClass('opened')
                ? ObjetTraduction_1.GTraductions.getValeur(
                    'PiedPage.btnMasquer',
                  )
                : ObjetTraduction_1.GTraductions.getValeur(
                    'PiedPage.btnAfficher',
                  ),
            };
          },
          getAttrFooter() {
            return { 'aria-expanded': $('.footer-wrapper').hasClass('opened') };
          },
        });
      }
      avecTwitter() {
        return false;
      }
      avecPlanSite() {
        return false;
      }
      avecBoutonAccesProfil() {
        return false;
      }
      avecBoutonPersonnaliseProduit() {
        return false;
      }
      avecBoutonPageEtablissement() {
        return false;
      }
      espacesISO27001() {
        return false;
      }
      composeCookiesInfo() {
        const H = [];
        H.push(`<div class="cookies-disclaimer">`);
        H.push(
          `<p>${ObjetTraduction_1.GTraductions.getValeur('PiedPage.CookieInfo_Message_1')} ${ObjetTraduction_1.GTraductions.getValeur('PiedPage.CookieInfo_Message_2')} <span role="button" tabindex="0" class="as-link" ie-node="btnMention" aria-haspopup="dialog">${ObjetTraduction_1.GTraductions.getValeur('PiedPage.mentionsLegales')}.</span></p>`,
        );
        H.push(
          `<ie-bouton tabindex="0" aria-label="${ObjetTraduction_1.GTraductions.getValeur('Fermer')}" ie-hint="${ObjetTraduction_1.GTraductions.getValeur('Fermer')}" ie-node="btnFermer">${ObjetTraduction_1.GTraductions.getValeur('Fermer')}</ie-bouton>`,
        );
        H.push(`</div>`);
        return H.join('');
      }
      evenementBouton(aParam, aGenreBouton) {
        if (aGenreBouton !== 1) {
          this.callback.appel(aParam);
        }
      }
      setDonnees(aParam) {
        if (!!aParam) {
          this.setOptions(aParam);
        }
        this.afficher(this.composePage());
      }
      composePage() {
        const lHtml = [];
        this.masquerFooter = this.masquerBandeauPied();
        if (this.afficherCookieInfo() && !GApplication.getDemo()) {
          lHtml.push(this.composeCookiesInfo());
        }
        lHtml.push(this._composeAffichage());
        return lHtml.join('');
      }
      showHideFooter(aMasquerPied) {
        const lParentContainer = $(this).closest('.interface_affV');
        const lFooterWrapper = lParentContainer.find('.footer-wrapper');
        if (aMasquerPied) {
          lFooterWrapper.toggleClass('opened closed');
          lParentContainer.removeClass('with-footer').addClass('no-footer');
          ObjetHtml_1.GHtml.getElementsFocusablesDElement(
            lFooterWrapper.get(0),
          ).forEach((aNode, aIndex) => {
            if (aIndex > 0) {
              $(aNode).attr('tabindex', -1);
            }
          });
        } else {
          lFooterWrapper.toggleClass('closed opened');
          lParentContainer.removeClass('no-footer').addClass('with-footer');
          ObjetHtml_1.GHtml.getElementsFocusablesDElement(
            lFooterWrapper.get(0),
          ).forEach((aNode, aIndex) => {
            if (aIndex > 0) {
              $(aNode).attr('tabindex', 0);
            }
          });
        }
        $(window).resize();
      }
      masquerBandeauPied() {
        return this.options.avecBoutonMasquer
          ? LocalStorage_1.IELocalStorage.getItem(
              lCleLocalStorage + '_' + this.etatUtilisateur.GenreEspace,
            ) === 'true'
          : false;
      }
      afficherCookieInfo() {
        let lGenreEspace =
          this.etatUtilisateur !== undefined
            ? '_' + this.etatUtilisateur.GenreEspace
            : '';
        LocalStorage_1.IELocalStorage.getItem(
          lCookieLocalStorage + lGenreEspace,
        ) === null
          ? LocalStorage_1.IELocalStorage.setItem(
              lCookieLocalStorage + lGenreEspace,
              String(true),
            )
          : LocalStorage_1.IELocalStorage.getItem(
              lCookieLocalStorage + lGenreEspace,
            );
        return (
          LocalStorage_1.IELocalStorage.getItem(
            lCookieLocalStorage + lGenreEspace,
          ) === 'true'
        );
      }
      _composeAffichage() {
        const H = [];
        H.push(
          '<footer id="',
          this.Nom,
          '_footer" class="ObjetBandeauPied disable-dark-mode ' +
            (this.avecBoutonPersonnaliseProduit() ? ' bpp-canope' : '') +
            '"  ie-attr="getAttrFooter">',
        );
        if (this.options.avecBoutonMasquer) {
          H.push(
            IE.jsx.str('div', {
              tabindex: '0',
              role: 'button',
              class: 'footer-toggler icon_angle_down',
              'ie-node': 'showPied()',
              'ie-attr': 'getAttrShowPied',
              title: ObjetTraduction_1.GTraductions.getValeur(
                'PiedPage.btnMasquer',
              ),
            }),
          );
        }
        const lAvecLibelleHeberge =
          this.options.siteIndex && this.options.estHebergeEnFrance;
        H.push(
          '<div class="ibp-bloc-left' +
            (!lAvecLibelleHeberge ? ' bloc-unique' : '') +
            '">',
        );
        if (this.avecTwitter()) {
          H.push(
            '<ie-btnimage ie-model="btnPied(' +
              this.getCommande(this.genreCommande.twitter) +
              ')" class="icon_twitter btnImageIcon ibp-command" title="' +
              ObjetTraduction_1.GTraductions.getValeur(
                'Commande.SuivrePronoteTwitter.Actif',
              ) +
              '">' +
              '</ie-btnimage>',
            '<hr />',
          );
        }
        if (this.options.mention) {
          H.push(
            '<div role="button" tabindex="0" class="ibp-command legal-notice" ie-node="btnMention">',
            ObjetTraduction_1.GTraductions.getValeur(
              'PiedPage.mentionsLegales',
            ),
            '</div>',
          );
          H.push('<hr />');
        }
        if (this.options.urlDeclarationAccessibilite) {
          H.push(
            IE.jsx.str(
              IE.jsx.fragment,
              null,
              IE.jsx.str(
                'a',
                {
                  class: 'accessibilite',
                  href: this.options.urlDeclarationAccessibilite,
                },
                ObjetTraduction_1.GTraductions.getValeur(
                  this.options.accessibiliteNonConforme
                    ? 'PiedPage.AccessibiliteNonConformite'
                    : 'PiedPage.AccessibiliteConformite',
                ),
              ),
              IE.jsx.str('hr', null),
            ),
          );
        }
        if (this.avecPlanSite()) {
          H.push(
            '<div role="button" tabindex="0" class="ibp-command site-map" ie-node="btnPlanSite">',
            ObjetTraduction_1.GTraductions.getValeur('PiedPage.planSite'),
            '</div>',
          );
          if (lAvecLibelleHeberge) {
            H.push('<hr />');
          }
        }
        H.push('</div>');
        if (lAvecLibelleHeberge) {
          const lOnClic = GNavigateur.isIOS
            ? ''
            : `onclick="window.open ('${this.options.urlInfosHebergement}');" onkeyup="if(GNavigateur.isToucheSelection())window.open ('${this.options.urlInfosHebergement}');"`;
          H.push(
            `<div role="link" tabindex="0" class="host-france-container ibp-command" ${lOnClic}>`,
            this.espacesISO27001()
              ? '<span class="certif-27001">' +
                  ObjetTraduction_1.GTraductions.getValeur(
                    'PiedPage.certifISO27001',
                  ) +
                  '</span>'
              : '',
            '<span class="host-text">',
            ObjetTraduction_1.GTraductions.getValeur(
              'PiedPage.hebergementDonneesFrance',
            ),
            '</span>',
            '<hr />',
            '<span class="logo-index-inverse" aria-hidden="true"></span>',
            `<div class="flex-contain cols text-start">${ObjetTraduction_1.GTraductions.getValeur('PiedPage.IndexEducation')}</div>`,
            '</div>',
          );
        }
        H.push('<div class="knowledge-container">');
        if (this.avecBoutonPersonnaliseProduit()) {
          H.push(this.composeBoutonPersonnaliseProduit());
        }
        if (this.avecBoutonAccesProfil()) {
          H.push(this.composeBoutonAccesProfil());
        }
        if (this.avecBoutonPageEtablissement()) {
          H.push(this.composeBoutonPageEtablissement());
        }
        H.push('</div>');
        H.push('</footer>');
        return H.join('');
      }
    }
    exports._ObjetAffichageBandeauPied = _ObjetAffichageBandeauPied;
  },
  fn: '_interfacebandeaupied.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.InterfaceBandeauPiedCommune = void 0;
    const _InterfaceBandeauPied_1 = require('_InterfaceBandeauPied');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const UtilitaireRedirection_1 = require('UtilitaireRedirection');
    class InterfaceBandeauPiedCommune extends _InterfaceBandeauPied_1._ObjetAffichageBandeauPied {
      constructor(...aParams) {
        super(...aParams);
        const lGParametres = GParametres;
        this.options = {
          mention: lGParametres.publierMentions,
          siteIndex:
            lGParametres.urlSiteIndexEducation ||
            'https://www.index-education.com',
          urlInfosHebergement: lGParametres.urlInfosHebergement,
          logoProduitCss: lGParametres.logoProduitCss || '',
          estHebergeEnFrance: lGParametres.estHebergeEnFrance,
          avecBoutonMasquer: false,
          pageEtablissement: lGParametres.PageEtablissement || '',
          urlDeclarationAccessibilite: lGParametres.urlDeclarationAccessibilite,
          accessibiliteNonConforme: lGParametres.accessibiliteNonConforme,
        };
      }
      getControleur(aInstance) {
        return $.extend(true, super.getControleur(aInstance), {
          nodePageEtab: function () {
            $(this.node).eventValidation(() => {
              let lUrl = window.location.href.split('/');
              lUrl.pop();
              lUrl = lUrl.join('/') + '/';
              window.open(
                lUrl +
                  aInstance.options.pageEtablissement +
                  new UtilitaireRedirection_1.UtilitaireRedirection().getParametresUrl(),
              );
            });
          },
        });
      }
      construireAffichage() {
        return this.composePage();
      }
      getCommande() {
        return false;
      }
      evenementBouton(aParam, aGenreBouton) {
        return super.evenementBouton(aParam, aGenreBouton);
      }
      avecTwitter() {
        return false;
      }
      avecBoutonAideContextuelle() {
        return false;
      }
      avecBoutonAccesProfil() {
        return false;
      }
      composeBoutonAccesProfil() {
        const H = [];
        return H.join('');
      }
      avecBoutonPersonnaliseProduit() {
        return false;
      }
      composeBoutonPersonnaliseProduit() {
        const H = [];
        return H.join('');
      }
      avecBoutonPageEtablissement() {
        return !!this.options.pageEtablissement;
      }
      composeBoutonPageEtablissement() {
        const H = [];
        H.push(
          '<div tabindex="0" role="button" class="ibp-pill icon_ecole" aria-label="',
          ObjetTraduction_1.GTraductions.getValeur(
            'PiedPage.PageEtablissement',
          ),
          '" ie-node="nodePageEtab" ie-hint="',
          ObjetTraduction_1.GTraductions.getValeur(
            'PiedPage.PageEtablissement',
          ),
          '"><p class="help-text">',
          ObjetTraduction_1.GTraductions.getValeur(
            'PiedPage.PageEtablissement',
          ),
          '</p></a></div>',
        );
        return H.join('');
      }
      espacesISO27001() {
        return true;
      }
    }
    exports.InterfaceBandeauPiedCommune = InterfaceBandeauPiedCommune;
  },
  fn: 'interfacebandeaupiedcommune.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.UtilitairePageCommune = void 0;
    const GUID_1 = require('GUID');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetHtml_1 = require('ObjetHtml');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const UtilitaireRedirection_1 = require('UtilitaireRedirection');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const GImageConnexion = require('ObjetImageConnexion');
    const TypeArrierePlanAuthentification_1 = require('TypeArrierePlanAuthentification');
    const ObjetBandeauEspace_1 = require('ObjetBandeauEspace');
    const InterfaceBandeauPiedCommune_1 = require('InterfaceBandeauPiedCommune');
    const UtilitaireMenuContextuelNatif_1 = require('UtilitaireMenuContextuelNatif');
    class UtilitairePageCommune {
      constructor() {
        this.application = GApplication;
        this.PositionFocus = 1;
        this.Id = GUID_1.GUID.getId();
        this.idWrapper = this.Id + '_wrapper';
        this.idBandeau = this.Id + '_bandeau';
        this.idWrapperLien = this.Id + '_wrapperlien';
        this.idConnect = this.Id + '_connect';
        this.idBouton = this.Id + '_bouton_';
        this.idImage = this.Id + '_image';
        this.idCarte = this.Id + '_carte';
        this.idImageSuite = this.Id + '_imageSuite';
        this.afficherSuite = false;
      }
      construire(aParam) {
        this.controleur = this._getControleur(this);
        this.parametres = Object.assign(
          {
            id: '',
            avecRedirectionUrl: true,
            evenementSurBouton: null,
            urlSiteIndexEducation: '',
            NomEtablissement: '',
            version: '',
            millesime: '',
            genreImageConnexion: -1,
            objetContenu: null,
            initBandeau: null,
          },
          aParam,
        );
        this.listeBoutons = aParam.espaces;
        this.urlImageFond =
          this.parametres.genreImageConnexion ===
          TypeArrierePlanAuthentification_1.TypeArrierePlanAuthentification
            .PersonnaliseURL
            ? aParam.urlImageConnexion
            : '';
        this.avecFondFichier =
          this.parametres.genreImageConnexion ===
          TypeArrierePlanAuthentification_1.TypeArrierePlanAuthentification
            .PersonnaliseFichier;
        ObjetHtml_1.GHtml.setHtml(this.parametres.id, this._construire(), {
          controleur: this.controleur,
        });
        if (this.parametres.objetContenu) {
          this.parametres.objetContenu.initialiser();
        }
        if (GNavigateur.getToucheAltNum) {
          $('body').on('keyup', { aObjet: this }, this._raccourciClavierEspace);
        }
        UtilitaireMenuContextuelNatif_1.UtilitaireMenuContextuelNatif.desactiverSurElement(
          $(document),
        );
        if (this.listeBoutons.count() > 0) {
          $('#' + this.idBouton.escapeJQ() + '0').focus();
        }
      }
      _getControleur(aInstance) {
        return {
          getIdentiteBandeau: function () {
            return {
              class: ObjetBandeauEspace_1.ObjetBandeauEspace,
              pere: {},
              init: function (aBandeau) {
                if (aInstance.parametres.initBandeau) {
                  aInstance.parametres.initBandeau(aBandeau);
                }
              },
            };
          },
          getIdentiteFooter: function () {
            return {
              pere: {},
              class: InterfaceBandeauPiedCommune_1.InterfaceBandeauPiedCommune,
            };
          },
          nodeBouton: function (aIndice) {
            if (
              MethodesObjet_1.MethodesObjet.isFunction(
                aInstance.parametres.evenementSurBouton,
              )
            ) {
              $(this.node).eventValidation(() => {
                aInstance.parametres.evenementSurBouton(
                  aInstance.listeBoutons.get(aIndice),
                  aIndice,
                );
              });
            }
          },
        };
      }
      _raccourciClavierEspace(event) {
        const J = GNavigateur.getToucheAltNum(
          1,
          event.data.aObjet.listeBoutons.count(),
        );
        const lBouton = event.data.aObjet.listeBoutons.get(J - 1);
        if (lBouton && lBouton.url) {
          window.location.assign(
            lBouton.url +
              new UtilitaireRedirection_1.UtilitaireRedirection().getParametresUrl(),
          );
        }
      }
      _construire() {
        const lHtml = [];
        let lObjetImage = {};
        lObjetImage =
          this.parametres.imageConnexion ||
          GImageConnexion.getObjetImagePronote(
            this.parametres.genreImageConnexion,
          );
        if (
          this.parametres.genreImageConnexion ===
          TypeArrierePlanAuthentification_1.TypeArrierePlanAuthentification
            .PersonnaliseURL
        ) {
          lObjetImage.couleurFond = '';
          lObjetImage.classImageFond = 'Cover';
          lObjetImage.couleurConnexion = '#ffffff';
        } else if (
          this.parametres.genreImageConnexion ===
          TypeArrierePlanAuthentification_1.TypeArrierePlanAuthentification
            .Louvre
        ) {
          lObjetImage.classWrapperBg = '';
        } else if (
          this.parametres.genreImageConnexion ===
          TypeArrierePlanAuthentification_1.TypeArrierePlanAuthentification
            .PersonnaliseFichier
        ) {
          lObjetImage.classImageFond = 'Cover';
        }
        lObjetImage.classeFond =
          lObjetImage.classeFond || GImageConnexion.getClassFond();
        lObjetImage.couleurFondBg =
          lObjetImage.couleurFond === ''
            ? ''
            : lObjetImage.couleurFond || 'white';
        lObjetImage.classImageFond =
          lObjetImage.classImageFond ||
          (lObjetImage.urlImageFond ? '' : GImageConnexion.getClassFond());
        lObjetImage.urlImageFond =
          lObjetImage.urlImageFond || this.urlImageFond;
        if (
          this.parametres.genreImageConnexion ===
          TypeArrierePlanAuthentification_1.TypeArrierePlanAuthentification
            .Louvre
        ) {
          if (this.application.estEDT) {
            lObjetImage.classImageFond = 'bg-espace-edt ';
            lObjetImage.applicationEstEDT = 'espace-edt ';
          } else {
            lObjetImage.lienLogo =
              lObjetImage.lienLogo || 'https://www.louvre.fr';
            lObjetImage.styleLogo =
              lObjetImage.styleLogo ||
              'background-image: url(images/Connexion/Louvre/logo-louvre.png);width: 110px;height: 33px;';
            lObjetImage.avecLienSuite = true;
            lObjetImage.texteLienSuite =
              lObjetImage.texteLienSuite ||
              ObjetTraduction_1.GTraductions.getValeur('Louvre.Lien', [
                '<b><em>' + lObjetImage.nomExpo + '</em></b>',
              ]);
            lObjetImage.lienSuite = lObjetImage.lienSuite || lObjetImage.lien;
            lObjetImage.suiviLogo =
              lObjetImage.suiviLogo || lObjetImage.suiviLogo1;
            lObjetImage.suiviLienSuite =
              lObjetImage.suiviLienSuite || lObjetImage.suiviLogo2;
          }
        }
        if (
          this.parametres.genreImageConnexion ===
          TypeArrierePlanAuthentification_1.TypeArrierePlanAuthentification
            .Arbre
        ) {
          lObjetImage.classImageFond = 'bg-espace-primaire ';
          lObjetImage.applicationNom = 'espace-primaire ';
        }
        if (lObjetImage.urlImageFond || lObjetImage.classImageFond) {
          lHtml.push(
            '<div class="ImageFond ' + lObjetImage.classImageFond + '" style="',
            lObjetImage.couleurFondBg
              ? 'background-color: ' + lObjetImage.couleurFondBg + '; '
              : '',
            lObjetImage.urlImageFond
              ? "background-image:url('" +
                  lObjetImage.urlImageFond +
                  "');background-repeat: repeat;"
              : '',
            'position:absolute;z-index:-15;width:100%;height:100%;min-height:calc(100% - 50px);',
            lObjetImage.widthImageSuite && lObjetImage.urlImageSuite
              ? GNavigateur.clientL > lObjetImage.widthImageSuite
                ? 'min-width:' + lObjetImage.widthImageSuite + 'px;'
                : ''
              : '',
            '"></div>',
          );
        }
        if (this.avecFondFichier) {
          lHtml.push(
            '<div class="ImageFond ' +
              lObjetImage.classImageFond +
              '" style="background-color:' +
              lObjetImage.couleurFondBg +
              ';',
          );
          lHtml.push(
            " background-image:url('" +
              (this.parametres.urlFondEcran || '') +
              "'); ",
          );
          lHtml.push(
            ' position:absolute;z-index:-15;width:100%;height:100%;">',
          );
          lHtml.push('</div>');
        }
        lHtml.push(
          '<div id="',
          this.idWrapper,
          '" class="' +
            (lObjetImage.classeImage || '') +
            '" style="position:absolute;width:100%;height:100%;min-height:650px;overflow:hidden;text-align:center;',
          lObjetImage.widthImageSuite && lObjetImage.urlImageSuite
            ? GNavigateur.clientL > lObjetImage.widthImageSuite
              ? 'min-width:' + lObjetImage.widthImageSuite + 'px;'
              : ''
            : '',
          '">',
        );
        lHtml.push(
          '<div ie-identite="getIdentiteBandeau" role="presentation" style="position:relative;width: 100%;z-index:101;"></div>',
        );
        if (lObjetImage.srcImage) {
          lHtml.push(
            '<div style="position:absolute;left: 0px; bottom: 0px;height:80%;z-index:0;">',
          );
          if (
            lObjetImage.avecLien &&
            lObjetImage.lien &&
            lObjetImage.texteLien &&
            lObjetImage.suiviLien
          ) {
            lHtml.push(
              '<a href="' +
                lObjetImage.lien +
                '" class="Texte12 LienLouvre" onclick="$.get(\'' +
                lObjetImage.suiviLien +
                '\');">',
            );
          }
          lHtml.push(
            '<img id="' +
              this.idImage +
              '" aria-hidden="true" ' +
              (lObjetImage.urlImageSuite
                ? 'onclick="$(\'#' +
                  this.idImageSuite +
                  '\').toggle();event.stopImmediatePropagation();return false;" class="AvecMain"'
                : '') +
              ' src="' +
              lObjetImage.srcImage +
              '" style="height:100%" alt="" />',
          );
          if (
            lObjetImage.avecLien &&
            lObjetImage.lien &&
            lObjetImage.texteLien &&
            lObjetImage.suiviLien
          ) {
            lHtml.push(
              '<div style="position: absolute;bottom:' +
                lObjetImage.bottomLien +
                ';left:' +
                lObjetImage.leftLien +
                ';color:' +
                lObjetImage.couleurLien +
                ';font-size:' +
                lObjetImage.tailleLien +
                ';">' +
                lObjetImage.texteLien +
                '</div></a>',
            );
          }
          lHtml.push('</div>');
        }
        if (this.parametres.objetContenu) {
          lHtml.push(
            '<div id="',
            this.parametres.objetContenu.getNom(),
            '" style="position:absolute;width:100%;height:100%;overflow:hidden;"></div>',
          );
        } else {
          if (!lObjetImage.couleurConnexion) {
            lObjetImage.couleurConnexion = '#FFF';
          }
          lHtml.push(
            '<div class="InlineBlock AlignementMilieuVertical full-height"></div>',
          );
          lHtml.push(
            '<div class="' +
              (this.application.estEDT || this.application.estPrimaire
                ? lObjetImage.applicationNom
                : '') +
              ' wrapper-connect-conteneur' +
              (lObjetImage.srcImage ? ' image-aside' : '') +
              '">',
          );
          lHtml.push(
            '<div class="logo-espace-edt bloc-elem"></div>',
            '<div class="illustration-container bloc-elem">',
            '<div class="illus-rond"></div>',
            '<div class="logo-pronote-primaire"></div>',
            '</div>',
          );
          lHtml.push(
            '<nav id="',
            this.idConnect,
            '" class="bloc-elem choix-profil-contain">',
            '<ul>',
          );
          for (let I = 0; I < this.listeBoutons.count(); I++) {
            const lBouton = this.listeBoutons.get(I);
            lHtml.push(
              '<li>',
              '<a id="',
              this.idBouton + I,
              '" ',
              this.parametres.avecRedirectionUrl
                ? 'href="' +
                    lBouton.url +
                    new UtilitaireRedirection_1.UtilitaireRedirection().getParametresUrl() +
                    '" '
                : '',
              ' target="_self" accessKey="',
              I + 1,
              '" ',
              'class="btn-connexion"',
              ObjetHtml_1.GHtml.composeAttr('ie-node', 'nodeBouton', [I]),
              '>',
              '<span class="img-btn ',
              this._getImageEspace(lBouton.Genre),
              '"></span>',
              '<span class="libelle">',
              lBouton.getLibelle(),
              '</span>',
              '</a>',
              '</li>',
            );
          }
          lHtml.push('</ul>', '</nav>', '</div>');
        }
        if (
          !!this.parametres.mentionsPagesPubliques &&
          !!this.parametres.mentionsPagesPubliques.lien
        ) {
          lHtml.push(
            '<div style="position:absolute; bottom:1rem; z-index:101; left:50%;">',
            this.parametres.mentionsPagesPubliques.lien,
            '</div>',
          );
        }
        lHtml.push(
          '<div ie-identite="getIdentiteFooter" role="presentation" style="position:absolute;width: 100%;z-index:101; bottom:0;"></div>',
        );
        lHtml.push('</div>');
        if (
          lObjetImage.urlImageFond &&
          lObjetImage.heightImageSuite &&
          lObjetImage.widthImageSuite &&
          lObjetImage.urlImageSuite
        ) {
          lHtml.push(
            '<div id="' +
              this.idImageSuite +
              '" onclick="$(\'#' +
              this.idImageSuite +
              '\').toggle();" class="AvecMain ' +
              (!lObjetImage.urlImageFond ? lObjetImage.classeFond : '') +
              '" style="display: none;position:absolute;width:100%;height:calc(100% - 50px);min-height:' +
              lObjetImage.heightImageSuite +
              'px;' +
              (GNavigateur.clientL > lObjetImage.widthImageSuite
                ? 'min-width:' + lObjetImage.widthImageSuite + 'px'
                : '') +
              ';padding-bottom:50px;z-index:1;background-image: url(' +
              lObjetImage.urlImageFond +
              ');">',
          );
          lHtml.push(
            '<div style="background-position:center center;background-repeat: no-repeat;width:100%;height:100%;background-image:url(' +
              lObjetImage.urlImageSuite +
              ');"></div>',
          );
          lHtml.push(
            '<div style="position:absolute; bottom: 10px;right:10px;">',
          );
          if (
            lObjetImage.lienLogo &&
            lObjetImage.styleLogo &&
            lObjetImage.suiviLogo
          ) {
            lHtml.push(
              '<a href="' +
                lObjetImage.lienLogo +
                '" style="float: right; margin-right: 10px;' +
                lObjetImage.styleLogo +
                '" onclick="$.get(\'' +
                lObjetImage.suiviLogo +
                '\');"></a>',
            );
          }
          if (
            lObjetImage.avecLienSuite &&
            lObjetImage.lienSuite &&
            lObjetImage.texteLienSuite &&
            lObjetImage.suiviLienSuite
          ) {
            lHtml.push(
              '<a href="' +
                lObjetImage.lienSuite +
                '" style="float: right; margin: 10px;" class="Texte12 LienLouvre" onclick="$.get(\'' +
                lObjetImage.suiviLienSuite +
                '\');">' +
                lObjetImage.texteLienSuite +
                '</a>',
            );
          }
          lHtml.push('</div>');
          lHtml.push('</div>');
        }
        return lHtml.join('');
      }
      _getImageEspace(aEspace) {
        let lImageEspace = 'Icone_EspaceInvite';
        switch (aEspace) {
          case Enumere_Espace_1.EGenreEspace.Professeur:
            lImageEspace = 'Icone_EspaceEnseignant';
            break;
          case Enumere_Espace_1.EGenreEspace.Eleve:
            lImageEspace = 'Icone_EspaceEtudiant';
            break;
          case Enumere_Espace_1.EGenreEspace.Etablissement:
            lImageEspace = 'Icone_EspaceSecretariat';
            break;
          case Enumere_Espace_1.EGenreEspace.Parent:
            lImageEspace = 'Icone_EspaceParent';
            break;
          case Enumere_Espace_1.EGenreEspace.Entreprise:
            lImageEspace = 'Icone_EspaceEntreprise';
            break;
          case Enumere_Espace_1.EGenreEspace.Academie:
            lImageEspace = 'Icone_EspaceAcademie';
            break;
          case Enumere_Espace_1.EGenreEspace.Administrateur:
            lImageEspace = 'Icone_EspaceAdministratif';
            break;
          case Enumere_Espace_1.EGenreEspace.PrimProfesseur:
            lImageEspace = 'Icone_EspaceEnseignant';
            break;
          case Enumere_Espace_1.EGenreEspace.PrimParent:
            lImageEspace = 'Icone_EspaceParent';
            break;
          case Enumere_Espace_1.EGenreEspace.PrimEleve:
            lImageEspace = 'Icone_EspaceEtudiant';
            break;
          case Enumere_Espace_1.EGenreEspace.Accompagnant:
            lImageEspace = 'Icone_EspaceAccompagnant';
            break;
          case Enumere_Espace_1.EGenreEspace.PrimAccompagnant:
            lImageEspace = 'Icone_EspaceAccompagnant';
            break;
          case Enumere_Espace_1.EGenreEspace.Inscription:
            lImageEspace = 'Icone_EspaceInscription';
            break;
          case Enumere_Espace_1.EGenreEspace.Tuteur:
            lImageEspace = 'Icone_EspaceTuteur';
            break;
          case Enumere_Espace_1.EGenreEspace.PrimPeriscolaire:
            lImageEspace = 'Icone_EspacePeriscolaire';
            break;
          case Enumere_Espace_1.EGenreEspace.PrimMairie:
            lImageEspace = 'Icone_EspaceMairie';
            break;
          case Enumere_Espace_1.EGenreEspace.PrimDirection:
            lImageEspace = 'Icone_EspaceAdministratif';
            break;
        }
        return lImageEspace;
      }
    }
    exports.UtilitairePageCommune = UtilitairePageCommune;
  },
  fn: 'utilitairepagecommune.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetEtatUtilisateurCP = void 0;
    const Invocateur_1 = require('Invocateur');
    const TypeEnsembleNombre_1 = require('TypeEnsembleNombre');
    const ThemesCouleurs_1 = require('ThemesCouleurs');
    global.GEtatUtilisateur = null;
    class ObjetEtatUtilisateurCP {
      constructor() {
        this.EtatSaisie = false;
        this.codePINFixe = false;
        this.IdCourant = '';
        this.reglesSaisieMotDePasse = {
          min: 0,
          max: 0,
          regles: new TypeEnsembleNombre_1.TypeEnsembleNombre(),
          init: false,
        };
        Invocateur_1.Invocateur.abonner(
          Invocateur_1.ObjetInvocateur.events.etatSaisie,
          this.setEtatSaisie.bind(this),
        );
      }
      get listeOnglets() {
        return this._listeOnglets;
      }
      set listeOnglets(aValeur) {
        this._listeOnglets = aValeur;
      }
      setEtatSaisie(aEtat) {
        this.EtatSaisie = aEtat;
      }
      estEspaceEleve() {
        return false;
      }
      estEspaceParent() {
        return false;
      }
      estEspacePourEleve() {
        return false;
      }
      estEspacePourProf() {
        return false;
      }
      avecImports() {
        return false;
      }
      avecFicheEtablissement() {
        return false;
      }
      estModeAccessible() {
        return false;
      }
      estAvecThemeAccessible() {
        return ThemesCouleurs_1.ThemesCouleurs.getModeAccessible();
      }
      getUtilisateur() {
        return null;
      }
      estEspaceAvecMembre() {
        return false;
      }
      avecPlusieursMembres() {
        return false;
      }
      getMembre() {
        return null;
      }
      setNumeroEleve(aNumeroMembre) {
        return null;
      }
      avecPageAccueil() {
        return false;
      }
      getNumeroGenreEspace() {
        return this.GenreEspace;
      }
      getGenreOnglet() {
        return null;
      }
      getLibelleLongOnglet() {
        return '';
      }
      setTriListe(aParams) {
        const lParams = Object.assign(
          {
            liste: null,
            tri: undefined,
            colonnesTriables: true,
            identifiant: 'id',
            onglet: '',
          },
          aParams,
        );
        if (
          !lParams.liste ||
          !lParams.liste.setOptionsListe ||
          !lParams.identifiant ||
          !lParams.colonnesTriables
        ) {
          return;
        }
        if (!this._trisListe_) {
          this._trisListe_ = {};
        }
        const lCle = lParams.onglet + '|' + lParams.identifiant;
        if (!this._trisListe_[lCle]) {
          this._trisListe_[lCle] = lParams.tri;
        }
        aParams.liste.setOptionsListe({
          colonnesTriables: lParams.colonnesTriables,
          numeroColonneTriDefaut: () => {
            return this._trisListe_[lCle];
          },
          evenementSurTri: (aColonnesTris) => {
            this._trisListe_[lCle] = aColonnesTris;
          },
        });
        return this;
      }
      setCodePINFixe(aVal) {
        this.codePINFixe = !!aVal;
      }
      getCodePINFixe() {
        return this.codePINFixe;
      }
      setReglesSaisieMotDePasse(aJSON) {
        if (aJSON && aJSON.reglesSaisieMDP) {
          $.extend(this.reglesSaisieMotDePasse, aJSON.reglesSaisieMDP);
          this.reglesSaisieMotDePasse.init = true;
        }
      }
      espacesAvecBoutonsTimeLine() {
        return true;
      }
      getUniquementNonLues() {
        if (
          this.uniquementNonLues !== null &&
          this.uniquementNonLues !== undefined
        ) {
          return this.uniquementNonLues;
        } else {
          return false;
        }
      }
      setUniquementNonLues(aBoolean) {
        this.uniquementNonLues = aBoolean;
      }
      avecCloudDisponibles() {
        return this.listeCloud && this.listeCloud.count() > 0;
      }
      avecGestionAppareilPhoto() {
        return (
          IE.estMobile &&
          !(GNavigateur.isAndroid && GApplication.estAppliMobile)
        );
      }
      getPageCourante() {
        return this.pageCourante;
      }
      setPageCourante(aInstancePage) {
        this.pageCourante = aInstancePage;
      }
      estAvecCodeCompetences() {
        return false;
      }
    }
    exports.ObjetEtatUtilisateurCP = ObjetEtatUtilisateurCP;
  },
  fn: 'objetetatutilisateurcp.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetIdentification = void 0;
    class ObjetIdentification {
      constructor(aRessource, aListeRessources) {
        this.ressource = aRessource;
        this.setListeRessources(aListeRessources);
      }
      getMembre() {
        return this.NumeroEleve
          ? this.ListeRessources.getElementParNumero(this.NumeroEleve)
          : this.ressource;
      }
      setListeRessources(AListeRessources) {
        this.ListeRessources = AListeRessources;
        this.NumeroEleve = null;
        for (
          let I = 0;
          I < this.ListeRessources.count() &&
          (this.NumeroEleve === null || this.NumeroEleve === undefined);
          I++
        ) {
          if (this.ListeRessources.get(I).AvecSelection !== false) {
            this.NumeroEleve = this.ListeRessources.getNumero(I);
          }
        }
      }
      getLibelleClasse() {
        const LEleve = this.getMembre();
        return LEleve && LEleve.Classe ? LEleve.Classe.getLibelle() : '';
      }
      getNumeroClasse() {
        const LEleve = this.getMembre();
        return LEleve && LEleve.Classe ? LEleve.Classe.getNumero() : '';
      }
      getLibelleGroupes() {
        const LEleve = this.getMembre();
        if (LEleve) {
          const LListeGroupes = LEleve.ListeGroupes;
          const N = !!LListeGroupes ? LListeGroupes.count() : 0;
          const T = [];
          for (let I = 0; I < N; I++) {
            T.push(LListeGroupes.getLibelle(I));
          }
          return T.join(', ');
        }
        return '';
      }
    }
    exports.ObjetIdentification = ObjetIdentification;
  },
  fn: 'objetidentification.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetNavigation = void 0;
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    class ObjetNavigation {
      constructor() {
        this.TableauxRessources = {};
        this.Classe = null;
        this.Groupe = null;
        this.Periode = null;
        this.Eleve = null;
        this.Service = null;
        this.Appreciation = null;
        this.avecCoursAnnule = true;
        this.Niveau = -1;
        this.NumeroMatiereCahierDeTextes = 0;
        this.afficherFicheService = true;
        this.triDevoirs = false;
      }
      setRessource(AGenreRessource, AParametre, ANumero, AGenre) {
        if (AParametre instanceof ObjetListeElements_1.ObjetListeElements) {
          this.TableauxRessources[AGenreRessource] =
            MethodesObjet_1.MethodesObjet.dupliquer(AParametre);
        } else if (MethodesObjet_1.MethodesObjet.isObject(AParametre)) {
          this.TableauxRessources[AGenreRessource] =
            new ObjetListeElements_1.ObjetListeElements().addElement(
              MethodesObjet_1.MethodesObjet.dupliquer(AParametre),
            );
        } else {
          this.TableauxRessources[AGenreRessource] =
            new ObjetListeElements_1.ObjetListeElements().addElement(
              new ObjetElement_1.ObjetElement(AParametre, ANumero, AGenre),
            );
        }
      }
      getRessource(AGenreRessource) {
        return this.TableauxRessources[AGenreRessource]
          ? this.TableauxRessources[AGenreRessource].get(0)
          : null;
      }
      getRessources(AGenreRessource) {
        return this.TableauxRessources[AGenreRessource];
      }
      getNumeroRessource(AGenreRessource) {
        return this.getRessource(AGenreRessource)
          ? this.getRessource(AGenreRessource).getNumero()
          : null;
      }
      getGenreRessource(AGenreRessource) {
        return this.getRessource(AGenreRessource)
          ? this.getRessource(AGenreRessource).getGenre()
          : null;
      }
      getLibelleRessource(AGenreRessource) {
        return this.getRessource(AGenreRessource)
          ? this.getRessource(AGenreRessource).getLibelle()
          : null;
      }
    }
    exports.ObjetNavigation = ObjetNavigation;
  },
  fn: 'objetnavigation.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.EGenreConnexion = void 0;
    var EGenreConnexion;
    (function (EGenreConnexion) {
      EGenreConnexion[(EGenreConnexion['Normale'] = 0)] = 'Normale';
      EGenreConnexion[(EGenreConnexion['Allegee'] = 1)] = 'Allegee';
    })(EGenreConnexion || (exports.EGenreConnexion = EGenreConnexion = {}));
  },
  fn: 'enumere_connexion.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetEtatUtilisateur = void 0;
    const ObjetEtatUtilisateurCP_1 = require('ObjetEtatUtilisateurCP');
    const MethodesObjet_1 = require('MethodesObjet');
    const ObjetElement_1 = require('ObjetElement');
    const ObjetListeElements_1 = require('ObjetListeElements');
    const ObjetChaine_1 = require('ObjetChaine');
    const ObjetTri_1 = require('ObjetTri');
    const ObjetIdentification_1 = require('ObjetIdentification');
    const ObjetTraduction_1 = require('ObjetTraduction');
    const ObjetNavigation_1 = require('ObjetNavigation');
    const Enumere_Ressource_1 = require('Enumere_Ressource');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const Enumere_Onglet_1 = require('Enumere_Onglet');
    const ObjetDroitsPN_1 = require('ObjetDroitsPN');
    const Enumere_Connexion_1 = require('Enumere_Connexion');
    const ObjetDate_1 = require('ObjetDate');
    const ThemesCouleurs_1 = require('ThemesCouleurs');
    class ObjetEtatUtilisateur extends ObjetEtatUtilisateurCP_1.ObjetEtatUtilisateurCP {
      constructor(aGenreEspace) {
        super();
        this.applicationSco = GApplication;
        this.derniereDate = null;
        this.existeGenreOnglet = (aGenreOnglet) => {
          const lGenreOnglet =
            this.listeOnglets.getElementParGenre(aGenreOnglet);
          return lGenreOnglet && lGenreOnglet.Actif;
        };
        this.GenreEspace = aGenreEspace;
        this.Navigation = new ObjetNavigation_1.ObjetNavigation();
        this.genreOnglet = null;
        this.accessibilite = { avecCodeCompetences: false };
      }
      get listeOngletsOriginal() {
        return super.listeOnglets;
      }
      get listeOnglets() {
        return this.getListeOngletsSelonContexte();
      }
      set listeOnglets(aValeur) {
        super.listeOnglets = aValeur;
      }
      initAuthentification(aParam) {
        this.avecRessourcesGranulaire = aParam.avecRessourcesGranulaire;
        this.avecRessourcesRenduTAF = aParam.avecRessourcesRenduTAF;
        this.avecRessourcesEnvoiNote = aParam.avecRessourcesEnvoiNote;
        this.activerKiosqueRenduTAF = aParam.activerKiosqueRenduTAF;
        this.activerKiosqueEnvoiNote =
          aParam.activerKiosqueEnvoiNote && !this.pourPrimaire();
        if (
          aParam.messagesDyn &&
          this.genreConnexion !== Enumere_Connexion_1.EGenreConnexion.Allegee
        ) {
          this.applicationSco.donneesCentraleNotifications.addMessagesDynamiques(
            aParam.messagesDyn,
          );
        }
        this.listeRessourcesRecherche = aParam.listeRessourcesRecherche;
        this.modeSecurisationParDefaut = aParam.modeSecurisationParDefaut;
        if (aParam.messagerieSignature) {
          this.messagerieSignature = aParam.messagerieSignature;
        }
        this.deserialiserOnglets(aParam);
        this.deserialiserRessources(aParam);
        this.deserialiserInfosSupp(aParam);
        this.deserialiserPage(aParam);
      }
      deserialiserOnglets(aParam) {
        this.listeOngletsInvisibles = aParam.listeOngletsInvisibles;
        this.listeGenreOngletsNotification = aParam.listeOngletsNotification;
        if (aParam.listeOnglets) {
          this.listeOnglets = new ObjetListeElements_1.ObjetListeElements();
          this.listeOngletsNotification =
            new ObjetListeElements_1.ObjetListeElements();
          for (let i = 0; i < aParam.listeOnglets.length; i++) {
            this._ajouterOnglet(aParam.listeOnglets[i], 0, null);
          }
        }
      }
      deserialiserRessources(aJSON) {
        const lRessource = new ObjetElement_1.ObjetElement().fromJSON(
          aJSON.ressource,
        );
        lRessource.libelleLong = lRessource.getLibelle();
        if (!!aJSON && !!aJSON.ressource) {
          lRessource.estDelegue = aJSON.ressource.estDelegue;
          lRessource.estMembreCA = aJSON.ressource.estMembreCA;
          lRessource.avecDiscussionResponsables =
            aJSON.ressource.avecDiscussionResponsables;
          lRessource.listeClassesDelegue = aJSON.ressource.listeClassesDelegue;
          lRessource.nbMaxJoursDeclarationAbsence =
            aJSON.ressource.nbMaxJoursDeclarationAbsence;
          lRessource.nbMaxJoursDeclarationDispCD =
            aJSON.ressource.nbMaxJoursDeclarationDispCD;
          lRessource.nbMaxJoursDeclarationDispLD =
            aJSON.ressource.nbMaxJoursDeclarationDispLD;
          if (aJSON.ressource.listeNumerosUtiles) {
            this.listeNumerosUtiles = aJSON.ressource.listeNumerosUtiles;
          }
          if (aJSON.ressource.destinatairePersonnelsMairie) {
            lRessource.destinatairePersonnelsMairie =
              aJSON.ressource.destinatairePersonnelsMairie;
          }
        }
        let lMembreJSON, lMembre;
        const lListeRessources = new ObjetListeElements_1.ObjetListeElements();
        if (!!aJSON && !!aJSON.ressource && !!aJSON.ressource.listeRessources) {
          for (let i = 0; i < aJSON.ressource.listeRessources.length; i++) {
            lMembreJSON = aJSON.ressource.listeRessources[i];
            lMembre = new ObjetElement_1.ObjetElement().fromJSON(lMembreJSON);
            this._traiterUtilisateur(lMembre, lMembreJSON, aJSON);
            lListeRessources.addElement(lMembre);
          }
        } else if (
          !!aJSON &&
          !!aJSON.ressource &&
          !!aJSON.ressource.listeDisciplines
        ) {
          for (let i = 0; i < aJSON.ressource.listeDisciplines.length; i++) {
            const lDisciplineJSON = aJSON.ressource.listeDisciplines[i];
            const lDiscipline = new ObjetElement_1.ObjetElement().fromJSON(
              lDisciplineJSON,
            );
            lListeRessources.addElement(lDiscipline);
            lDiscipline.ClassAffichage = 'Gras';
            lDiscipline.AvecSelection = false;
            lDiscipline.estGroupeDeRessource = true;
            lDiscipline.Numero = 0;
            if (!!lDisciplineJSON.listeRessources) {
              for (let j = 0; j < lDisciplineJSON.listeRessources.length; j++) {
                lMembreJSON = lDisciplineJSON.listeRessources[j];
                lMembre = new ObjetElement_1.ObjetElement().fromJSON(
                  lMembreJSON,
                );
                this._traiterUtilisateur(lMembre, lMembreJSON, aJSON);
                lListeRessources.addElement(lMembre);
                lMembre.pere = lDiscipline;
                lMembre.ClassAffichage = 'GrandEspaceGauche';
              }
            }
          }
        } else {
          this._traiterUtilisateur(lRessource, aJSON.ressource, aJSON);
        }
        lListeRessources.setTri([
          ObjetTri_1.ObjetTri.init((D) => {
            return !(
              D.Genre === Enumere_Ressource_1.EGenreRessource.Eleve &&
              D.Classe &&
              D.Classe.existeNumero()
            );
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return D.pere
              ? D.pere.getLibelle()
              : D.Position > 0
                ? D.Position
                : D.getLibelle();
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return !D.estGroupeDeRessource;
          }),
          ObjetTri_1.ObjetTri.init((D) => {
            return D.Position > 0 ? D.Position : D.getLibelle();
          }),
        ]);
        lListeRessources.trier();
        this.setIdentification(lRessource, lListeRessources);
      }
      _traiterUtilisateur(aUtilisateur, aUtilisateurJSON, aJSONReponse) {
        if (aUtilisateurJSON.destinatairesCarnetLiaison) {
          aUtilisateur.destinatairesCarnetLiaison =
            aUtilisateurJSON.destinatairesCarnetLiaison;
          aUtilisateur.destinatairesCarnetLiaison
            .setTri([
              ObjetTri_1.ObjetTri.init('Genre'),
              ObjetTri_1.ObjetTri.init('Libelle'),
            ])
            .trier();
        }
        if (
          !!aUtilisateurJSON.listeProfesseurs &&
          !!aJSONReponse.listeClasses
        ) {
          aUtilisateur.listeProfesseurs = aUtilisateurJSON.listeProfesseurs;
          aUtilisateur.listeProfesseurs.parcourir(
            this._traiterListeProfesseurs.bind(this, aJSONReponse.listeClasses),
          );
          aUtilisateur.listeProfesseurs.trier();
        }
        if (aUtilisateurJSON.Etablissement !== undefined) {
          aUtilisateur.Etablissement = aUtilisateurJSON.Etablissement;
        }
        if (aUtilisateurJSON.notificationsPush !== undefined) {
          aUtilisateur.notificationsPush = aUtilisateurJSON.notificationsPush;
        }
        if (aUtilisateurJSON.estEnseignant !== undefined) {
          aUtilisateur.estEnseignant = aUtilisateurJSON.estEnseignant;
          if (aUtilisateur.estEnseignant === true) {
            aUtilisateur.ressourceEnseignant =
              aUtilisateurJSON.ressourceEnseignant;
          }
        }
        if (aUtilisateurJSON.estDirecteur !== undefined) {
          aUtilisateur.estDirecteur = aUtilisateurJSON.estDirecteur;
        }
        if (aUtilisateurJSON.autoriserImage !== undefined) {
          aUtilisateur.autoriserImage = aUtilisateurJSON.autoriserImage;
        }
        aUtilisateur.avecPhoto = !!aUtilisateurJSON.avecPhoto;
        if (aUtilisateurJSON.listeDestProfsDiscussionPrimEleve) {
          aUtilisateur.listeDestProfsDiscussionPrimEleve =
            aUtilisateurJSON.listeDestProfsDiscussionPrimEleve;
        }
        if (aUtilisateurJSON.passeLeBrevet) {
          aUtilisateur.passeLeBrevet = aUtilisateurJSON.passeLeBrevet;
        }
        if (aUtilisateurJSON.listeMatieresDeclarationDispense) {
          aUtilisateur.listeMatieresDeclarationDispense =
            aUtilisateurJSON.listeMatieresDeclarationDispense;
        }
        if (aUtilisateurJSON.passeLeCFG) {
          aUtilisateur.passeLeCFG = aUtilisateurJSON.passeLeCFG;
        }
        if (this.estEspacePourEleve()) {
          aUtilisateur.Classe = new ObjetElement_1.ObjetElement().fromJSON(
            aUtilisateurJSON.classeDEleve,
          );
          aUtilisateur.libelleLong = aUtilisateur.getLibelle();
          let lTestClasseCourant = false;
          if (aUtilisateurJSON.listeClassesHistoriques !== undefined) {
            aUtilisateur.listeClasseHistorique =
              aUtilisateurJSON.listeClassesHistoriques;
            if (!aUtilisateurJSON.estClasseRattachementduJour) {
              aUtilisateur.listeClasseHistorique.parcourir((aClasse) => {
                if (aClasse.courant) {
                  lTestClasseCourant = true;
                  aUtilisateur.libelleLong += ' (' + aClasse.getLibelle() + ')';
                  return false;
                }
              });
            }
          }
          if (
            !lTestClasseCourant &&
            !!aUtilisateur.Classe &&
            aUtilisateur.Classe.getLibelle()
          ) {
            aUtilisateur.libelleLong +=
              ' (' + aUtilisateur.Classe.getLibelle() + ')';
          }
          if (aUtilisateurJSON.listeGroupes !== undefined) {
            aUtilisateur.ListeGroupes = aUtilisateurJSON.listeGroupes;
          }
          if (aUtilisateurJSON.autoriserImage !== undefined) {
            aUtilisateur.autoriserImage = aUtilisateurJSON.autoriserImage;
          }
          aUtilisateur.tableauOnglets = [];
          if (!!aUtilisateurJSON.listeOngletsPourPeriodes) {
            aUtilisateurJSON.listeOngletsPourPeriodes.parcourir((aOnglet) => {
              aUtilisateur.tableauOnglets[aOnglet.getGenre()] = aOnglet;
            });
          }
          if (!!aUtilisateurJSON.listeOngletsPourPiliers) {
            aUtilisateurJSON.listeOngletsPourPiliers.parcourir((aOnglet) => {
              aUtilisateur.tableauOnglets[aOnglet.getGenre()] = aOnglet;
            });
          }
        }
        if (!!aUtilisateurJSON.acces) {
          aUtilisateur.acces = aUtilisateurJSON.acces;
        }
      }
      deserialiserInfosSupp(aParam) {
        this.infosSupp = {};
        this.urlInstallClient = aParam.UrlInstallClient;
        this.urlParamClient = aParam.UrlParamClient;
        this.designationClient = aParam.designationClient;
        this.listeMotifsAbsences = aParam.listeMotifsAbsences;
        this.listeMotifsRetards = aParam.listeMotifsRetards;
        this.autorisationKiosque = !!aParam.autorisationKiosque;
        this.autorisationCloud = !!aParam.autorisationCloud;
        this.derniereConnexion = aParam.derniereConnexion;
        this.cloudIndexActif = !!aParam.cloudIndexActif;
        this.avecCloudIndex = !!aParam.avecCloudIndex;
        this.listeCloud =
          aParam.listeCloud || new ObjetListeElements_1.ObjetListeElements();
        this.listeCloudDepotServeur =
          aParam.listeCloudDepotServeur ||
          new ObjetListeElements_1.ObjetListeElements();
        this.listeClasses = aParam.listeClasses;
        this.listeMatieres = aParam.listeMatieres;
        this.listeNiveaux = aParam.listeNiveaux;
        this.existeCDTsDetaches = aParam.existeCDTsDetaches;
        this.tabEtablissementsModeleGrille =
          aParam.tabEtablissementsModeleGrille;
        this.listeInformationsEtablissements =
          aParam.listeInformationsEtablissements;
        this.joursOuvresServices = aParam.joursOuvresServices;
      }
      deserialiserPage(aParam) {
        const lPage = aParam.page;
        if (lPage && this.existeGenreOnglet) {
          if (this.existeGenreOnglet(lPage.Onglet)) {
            if (lPage.membre) {
              GEtatUtilisateur.setNumeroEleve(lPage.membre.getNumero());
            }
            if (lPage.cours || lPage.absenceRessource) {
              const lCours = lPage.cours || lPage.absenceRessource;
              this.setNavigationCours(lCours);
            }
            if (lPage.Date) {
              const lDate = ObjetDate_1.GDate.getDateJour(lPage.Date);
              this.setNavigationDate(lDate);
            }
            if (lPage.service) {
              this.Navigation.setRessource(
                Enumere_Ressource_1.EGenreRessource.Service,
                lPage.service.getLibelle(),
                lPage.service.getNumero(),
                lPage.service.getGenre(),
              );
            }
            if (lPage.palier) {
              this.Navigation.setRessource(
                Enumere_Ressource_1.EGenreRessource.Palier,
                lPage.palier.getLibelle(),
                lPage.palier.getNumero(),
                lPage.palier.getGenre(),
              );
            }
            if (lPage.competence) {
              this.Navigation.setRessource(
                Enumere_Ressource_1.EGenreRessource.Pilier,
                lPage.competence.getLibelle(),
                lPage.competence.getNumero(),
                lPage.competence.getGenre(),
              );
            }
            if (lPage.periode) {
              this.Navigation.setRessource(
                Enumere_Ressource_1.EGenreRessource.Periode,
                lPage.periode.getLibelle(),
                lPage.periode.getNumero(),
                lPage.periode.getGenre(),
              );
            }
            if (lPage.classe) {
              this.Navigation.setRessource(
                Enumere_Ressource_1.EGenreRessource.Classe,
                lPage.classe.getLibelle(),
                lPage.classe.getNumero(),
                lPage.classe.getGenre(),
              );
            }
            this.setPage(lPage);
          }
        }
      }
      setIdentification(aRessource, aListeRessources) {
        this.Identification = new ObjetIdentification_1.ObjetIdentification(
          aRessource,
          aListeRessources,
        );
        this.Identification.indiceEleve = 0;
        if (this.page && this.page.membre) {
          this.setNumeroEleve(this.page.membre.getNumero());
        }
      }
      getUtilisateur() {
        return this.Identification.ressource;
      }
      getMembre() {
        return this.Identification.getMembre();
      }
      avecPlusieursMembres() {
        return (
          this.Identification &&
          this.Identification.ListeRessources &&
          this.Identification.ListeRessources.count() > 1
        );
      }
      setNumeroEleve(aNumeroEleve) {
        let lIndice = false;
        for (let I = 0; I < this.Identification.ListeRessources.count(); I++) {
          const lEleve = this.Identification.ListeRessources.get(I);
          if (lEleve.getNumero() === aNumeroEleve) {
            lIndice = I;
          }
        }
        if (lIndice === false) {
          return;
        }
        this.Identification.indiceEleve = lIndice;
        this.Identification.NumeroEleve = aNumeroEleve;
        this.Navigation.setRessource(
          Enumere_Ressource_1.EGenreRessource.Eleve,
          this.getMembre().getLibelle(),
          aNumeroEleve,
        );
        this.Navigation.setRessource(
          Enumere_Ressource_1.EGenreRessource.Classe,
          this.Identification.getLibelleClasse(),
          this.Identification.getNumeroClasse(),
          Enumere_Ressource_1.EGenreRessource.Classe,
        );
      }
      getClasse() {
        return this.listeClasses.getElementParNumeroEtGenre(
          this.Navigation.getNumeroRessource(
            Enumere_Ressource_1.EGenreRessource.Classe,
          ),
          this.Navigation.getGenreRessource(
            Enumere_Ressource_1.EGenreRessource.Classe,
          ),
        );
      }
      setClasse(aClasse) {
        this.Navigation.setRessource(
          Enumere_Ressource_1.EGenreRessource.Classe,
          aClasse,
        );
      }
      getPage() {
        return this.page;
      }
      resetPage() {
        this.page = null;
      }
      setPage(aPage) {
        this.page = aPage;
        if (this.page && this.page.Onglet > 0) {
          this.setGenreOnglet(this.page.Onglet);
        }
        if (
          this.page &&
          this.page.ressource !== null &&
          this.page.ressource !== undefined
        ) {
          this.setGenreRessource(this.page.ressource);
        }
      }
      setGenreRessource(aGenreRessource) {}
      getGenreOnglet() {
        return this.genreOnglet;
      }
      setGenreOnglet(aGenreOnglet) {
        this.genreOnglet = aGenreOnglet;
      }
      getInfosSupp(aNomStockage) {
        if (!this.infosSupp) {
          return null;
        }
        if (!this.infosSupp[aNomStockage]) {
          this.infosSupp[aNomStockage] = {};
        }
        return this.infosSupp[aNomStockage];
      }
      getOngletSelectionne() {
        let lOngletSelectionne = null;
        if (this.listeOnglets) {
          let lGenreOngletActif = this.genreOnglet;
          if (lGenreOngletActif) {
            this.listeOnglets.parcourir((aOnglet) => {
              if (aOnglet.getGenre() === lGenreOngletActif) {
                lOngletSelectionne = aOnglet;
                return false;
              }
            });
          }
        }
        return lOngletSelectionne;
      }
      estOngletAutorise(aGenreOnglet) {
        let lOK = false;
        this.listeOnglets.parcourir((aOnglet) => {
          if (aOnglet.getGenre() === aGenreOnglet && aOnglet.Actif) {
            lOK = true;
            return false;
          }
        });
        return lOK;
      }
      estAvecCodeCompetences() {
        return this.accessibilite.avecCodeCompetences;
      }
      setAvecCodeCompetences(aActif) {
        this.accessibilite.avecCodeCompetences = aActif;
        if (this.applicationSco.getOptionsEspaceLocal()) {
          this.applicationSco
            .getOptionsEspaceLocal()
            .setAvecCodeCompetences(aActif);
        }
      }
      setAvecThemeAccessible(aActif) {
        if (this.applicationSco.getOptionsEspaceLocal()) {
          this.applicationSco
            .getOptionsEspaceLocal()
            .setAvecThemeAccessible(aActif);
        }
        ThemesCouleurs_1.ThemesCouleurs.setModeAccessible(aActif);
      }
      getDerniereDate() {
        if (this.derniereDate === null || this.derniereDate === undefined) {
          return ObjetDate_1.GDate.getDateCourante();
        } else {
          return this.derniereDate;
        }
      }
      setDerniereDate(aDate) {
        this.derniereDate = aDate;
      }
      getNavigationDate() {
        return null;
      }
      setNavigationDate(aDate) {}
      getNavigationCours() {
        return null;
      }
      setNavigationCours(aCours) {}
      getEtablissement() {
        if (
          [
            Enumere_Espace_1.EGenreEspace.Parent,
            Enumere_Espace_1.EGenreEspace.Mobile_Parent,
            Enumere_Espace_1.EGenreEspace.PrimParent,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
            Enumere_Espace_1.EGenreEspace.Accompagnant,
            Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
            Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
            Enumere_Espace_1.EGenreEspace.Tuteur,
            Enumere_Espace_1.EGenreEspace.Mobile_Tuteur,
            Enumere_Espace_1.EGenreEspace.Entreprise,
            Enumere_Espace_1.EGenreEspace.Academie,
          ].includes(this.GenreEspace)
        ) {
          return !!this.getMembre().Etablissement
            ? this.listeInformationsEtablissements.getElementParNumero(
                this.getMembre().Etablissement.getNumero(),
              )
            : null;
        } else {
          return !!this.getUtilisateur().Etablissement
            ? this.listeInformationsEtablissements.getElementParNumero(
                this.getUtilisateur().Etablissement.getNumero(),
              )
            : null;
        }
      }
      ongletEstVisible(aGenreOnglet) {
        return false;
      }
      desactiverPageAccueil() {
        this.sansPageAccueil = true;
      }
      avecPageAccueil() {
        if (this.sansPageAccueil) {
          return false;
        }
        const lOnglet = this.listeOnglets.getElementParGenre(
          Enumere_Onglet_1.EGenreOnglet.Accueil,
        );
        return (
          [
            Enumere_Espace_1.EGenreEspace.Parent,
            Enumere_Espace_1.EGenreEspace.Mobile_Parent,
            Enumere_Espace_1.EGenreEspace.Eleve,
            Enumere_Espace_1.EGenreEspace.Mobile_Eleve,
            Enumere_Espace_1.EGenreEspace.Professeur,
            Enumere_Espace_1.EGenreEspace.Mobile_Professeur,
            Enumere_Espace_1.EGenreEspace.Etablissement,
            Enumere_Espace_1.EGenreEspace.Mobile_Etablissement,
            Enumere_Espace_1.EGenreEspace.Administrateur,
            Enumere_Espace_1.EGenreEspace.Mobile_Administrateur,
            Enumere_Espace_1.EGenreEspace.PrimProfesseur,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimProfesseur,
            Enumere_Espace_1.EGenreEspace.PrimParent,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
            Enumere_Espace_1.EGenreEspace.PrimEleve,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
            Enumere_Espace_1.EGenreEspace.Accompagnant,
            Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
            Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
            Enumere_Espace_1.EGenreEspace.Tuteur,
            Enumere_Espace_1.EGenreEspace.Mobile_Tuteur,
            Enumere_Espace_1.EGenreEspace.PrimPeriscolaire,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimPeriscolaire,
            Enumere_Espace_1.EGenreEspace.PrimMairie,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimMairie,
            Enumere_Espace_1.EGenreEspace.PrimDirection,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimDirection,
          ].includes(this.GenreEspace) &&
          lOnglet &&
          lOnglet.Actif
        );
      }
      estOngletActif(aGenreOnglet) {
        const lOnglet = this.listeOnglets.getElementParGenre(aGenreOnglet);
        return lOnglet ? lOnglet.Actif : false;
      }
      espacesAvecBoutonsTimeLine() {
        return [
          Enumere_Espace_1.EGenreEspace.Professeur,
          Enumere_Espace_1.EGenreEspace.PrimProfesseur,
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.PrimEleve,
          Enumere_Espace_1.EGenreEspace.Administrateur,
          Enumere_Espace_1.EGenreEspace.PrimDirection,
        ].includes(this.GenreEspace);
      }
      estEspacePourEleve() {
        return [
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
          Enumere_Espace_1.EGenreEspace.Eleve,
          Enumere_Espace_1.EGenreEspace.Mobile_Eleve,
          Enumere_Espace_1.EGenreEspace.Entreprise,
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          Enumere_Espace_1.EGenreEspace.PrimEleve,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
          Enumere_Espace_1.EGenreEspace.Accompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
          Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Tuteur,
          Enumere_Espace_1.EGenreEspace.Mobile_Tuteur,
        ].includes(GEtatUtilisateur.GenreEspace);
      }
      estEspaceEleve() {
        return [
          Enumere_Espace_1.EGenreEspace.Eleve,
          Enumere_Espace_1.EGenreEspace.Mobile_Eleve,
          Enumere_Espace_1.EGenreEspace.PrimEleve,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
        ].includes(GEtatUtilisateur.GenreEspace);
      }
      estEspaceParent() {
        return [
          Enumere_Espace_1.EGenreEspace.Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
        ].includes(GEtatUtilisateur.GenreEspace);
      }
      estEspacePourProf() {
        return [
          Enumere_Espace_1.EGenreEspace.Professeur,
          Enumere_Espace_1.EGenreEspace.Mobile_Professeur,
          Enumere_Espace_1.EGenreEspace.Academie,
        ].includes(GEtatUtilisateur.GenreEspace);
      }
      estEspaceMobile() {
        return [
          Enumere_Espace_1.EGenreEspace.Mobile_Administrateur,
          Enumere_Espace_1.EGenreEspace.Mobile_Commun,
          Enumere_Espace_1.EGenreEspace.Mobile_Professeur,
          Enumere_Espace_1.EGenreEspace.Mobile_Eleve,
          Enumere_Espace_1.EGenreEspace.Mobile_Etablissement,
          Enumere_Espace_1.EGenreEspace.Mobile_Parent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimProfesseur,
          Enumere_Espace_1.EGenreEspace.Mobile_Accompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimPeriscolaire,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimMairie,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimDirection,
        ].includes(GEtatUtilisateur.GenreEspace);
      }
      estEspaceAvecMembre() {
        return GParametres.avecMembre;
      }
      pourPrimaire() {
        return [
          Enumere_Espace_1.EGenreEspace.PrimProfesseur,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimProfesseur,
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          Enumere_Espace_1.EGenreEspace.PrimEleve,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
          Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.PrimPeriscolaire,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimPeriscolaire,
          Enumere_Espace_1.EGenreEspace.PrimMairie,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimMairie,
          Enumere_Espace_1.EGenreEspace.PrimDirection,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimDirection,
        ].includes(this.GenreEspace);
      }
      pourThemePrimaire() {
        return [
          Enumere_Espace_1.EGenreEspace.PrimParent,
          Enumere_Espace_1.EGenreEspace.PrimEleve,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimEleve,
          Enumere_Espace_1.EGenreEspace.PrimAccompagnant,
          Enumere_Espace_1.EGenreEspace.Mobile_PrimAccompagnant,
        ].includes(this.GenreEspace);
      }
      estEspaceExecutionQCM() {
        return (
          this.estEspaceEleve() ||
          [
            Enumere_Espace_1.EGenreEspace.PrimParent,
            Enumere_Espace_1.EGenreEspace.Mobile_PrimParent,
          ].includes(GEtatUtilisateur.GenreEspace)
        );
      }
      getListeOngletsSelonContexte() {
        if (!this.Identification) {
          return super.listeOnglets;
        }
        const lListeOnglet = MethodesObjet_1.MethodesObjet.dupliquer(
          super.listeOnglets,
        );
        for (const lOnglet of lListeOnglet) {
          if (!lOnglet.Actif) {
            continue;
          }
          switch (lOnglet.Genre) {
            case Enumere_Onglet_1.EGenreOnglet.FicheBrevet: {
              const lRessource = this.estEspaceAvecMembre()
                ? this.getMembre()
                : this.getUtilisateur();
              if (
                lRessource === null || lRessource === void 0
                  ? void 0
                  : lRessource.passeLeBrevet
              ) {
                lOnglet.libelleLong = ObjetTraduction_1.GTraductions.getValeur(
                  'FicheBrevet.onglet.libelleLongBrevet',
                );
                lOnglet.setLibelle(
                  ObjetTraduction_1.GTraductions.getValeur(
                    'FicheBrevet.onglet.titreOngletBrevet',
                  ),
                );
                break;
              }
              if (
                lRessource === null || lRessource === void 0
                  ? void 0
                  : lRessource.passeLeCFG
              ) {
                lOnglet.libelleLong = ObjetTraduction_1.GTraductions.getValeur(
                  'FicheBrevet.onglet.libelleLongCFG',
                );
                lOnglet.setLibelle(
                  ObjetTraduction_1.GTraductions.getValeur(
                    'FicheBrevet.onglet.titreOngletCFG',
                  ),
                );
                break;
              }
              break;
            }
            default:
              break;
          }
        }
        return lListeOnglet;
      }
      getListeClasses(aParams) {
        if (
          this.applicationSco.droits.get(
            ObjetDroitsPN_1.TypeDroits.eleves.voirTousLesEleves,
          ) &&
          !this.applicationSco.parametresUtilisateur.get(
            'masquerDonneesAutresProfesseurs',
          )
        ) {
          aParams.uniquementClasseEnseignee = false;
        }
        const lListeClasses = new ObjetListeElements_1.ObjetListeElements();
        let lRecupererClasse = false;
        if (aParams.avecToutes) {
          lListeClasses.addElement(
            new ObjetElement_1.ObjetElement(
              ObjetTraduction_1.GTraductions.getValeur('toutes'),
              0,
            ),
          );
        }
        for (let I = 0; I < this.listeClasses.count(); I++) {
          const lClasse = this.listeClasses.get(I);
          if (
            (aParams.avecClasse &&
              (lClasse.getGenre() ===
                Enumere_Ressource_1.EGenreRessource.Classe ||
                (lClasse.estClasseMN && aParams.avecClasseMultiNiveau))) ||
            (aParams.avecGroupe &&
              lClasse.getGenre() ===
                Enumere_Ressource_1.EGenreRessource.Groupe &&
              !lClasse.estClasseMN)
          ) {
            lRecupererClasse = true;
            if (aParams.uniquementClassePrincipal) {
              lRecupererClasse = lClasse.estPrincipal;
            } else if (aParams.uniquementClasseEnseignee) {
              lRecupererClasse = lClasse.estResponsable || lClasse.enseigne;
            }
            if (aParams.sansClasseDeRegroupement && lClasse.dansRegroupement) {
              lRecupererClasse = false;
            }
            if (lRecupererClasse) {
              let lClasseExistant = lListeClasses.getElementParElement(lClasse);
              if (!lClasseExistant) {
                lListeClasses.addElement(lClasse);
              }
              if (
                !aParams.sansClasseDeRegroupement &&
                lClasse.listeComposantes &&
                lClasse.estClasseMN
              ) {
                for (let j = 0; j < lClasse.listeComposantes.count(); j++) {
                  let lComposante = lClasse.listeComposantes.get(j);
                  const lClasseDeComposante =
                    this.listeClasses.getElementParElement(lComposante);
                  lClasseExistant =
                    lListeClasses.getElementParElement(lClasseDeComposante);
                  if (!lClasseExistant && !!lClasseDeComposante) {
                    lClasseDeComposante.pere = lClasse;
                    lListeClasses.addElement(lClasseDeComposante);
                  }
                }
              }
            }
          }
        }
        return lListeClasses;
      }
      getCategorie() {
        return this.Navigation.categorie;
      }
      setCategorie(aCategorie) {
        this.Navigation.categorie = aCategorie;
      }
      getContexteBilletBlog() {
        return this.Navigation.contexteBillet;
      }
      setContexteBilletBlog(aBillet, aFenetreCommentairesOuverte = false) {
        if (!this.Navigation.contexteBillet) {
          this.Navigation.contexteBillet = {
            billet: null,
            fenetreCommentairesOuverte: false,
          };
        }
        this.Navigation.contexteBillet.billet = aBillet;
        this.Navigation.contexteBillet.fenetreCommentairesOuverte =
          aFenetreCommentairesOuverte;
      }
      getInfoSond() {
        return this.Navigation.infoSond;
      }
      setInfoSond(aInfoSond) {
        this.Navigation.infoSond = aInfoSond;
      }
      getContexteTAF() {
        return this.Navigation.contexteTAF;
      }
      setContexteTAF(aContexteTAF) {
        this.Navigation.contexteTAF = aContexteTAF;
      }
      getContexteCDT() {
        return this.Navigation.contexteCDT;
      }
      setContexteCDT(aContexteCDT) {
        this.Navigation.contexteCDT = aContexteCDT;
      }
      getGenreAffichageCompteSelectionne() {
        return this.Navigation.GenreAffichageCompteSelectionne;
      }
      setGenreAffichageCompteSelectionne(aGenreAffichageCompte) {
        this.Navigation.GenreAffichageCompteSelectionne = aGenreAffichageCompte;
      }
      getContexteRemplacementsEnseignant() {
        return this.Navigation.contexteRemplacementsEnseignant;
      }
      setContexteRemplacementsEnseignant(contexteRemplacementsEnseignant) {
        this.Navigation.contexteRemplacementsEnseignant =
          contexteRemplacementsEnseignant;
      }
      _ajouterOnglet(aJSON, aProfondeur, aOngletPere) {
        const lOnglet = new ObjetElement_1.ObjetElement().fromJSON(aJSON);
        if (
          this.listeOngletsInvisibles &&
          this.listeOngletsInvisibles.includes(lOnglet.getGenre())
        ) {
          lOnglet.Actif = false;
        }
        lOnglet.Libelle = ObjetChaine_1.GChaine.replaceRCToHTML(
          ObjetTraduction_1.GTraductions.getValeur('Onglet.Libelle')[
            lOnglet.getGenre()
          ],
        );
        lOnglet.libelleLong =
          ObjetTraduction_1.GTraductions.getValeur('Onglet.LibelleLong')[
            lOnglet.getGenre()
          ] !== ' '
            ? ObjetTraduction_1.GTraductions.getValeur('Onglet.LibelleLong')[
                lOnglet.getGenre()
              ]
            : lOnglet.Libelle;
        if (
          lOnglet.Actif !== false &&
          this.listeGenreOngletsNotification &&
          this.listeGenreOngletsNotification.includes(lOnglet.getGenre())
        ) {
          const lElementNotification =
            MethodesObjet_1.MethodesObjet.dupliquer(lOnglet);
          lElementNotification.profondeur = 0;
          lElementNotification.avecClic = true;
          this.listeOngletsNotification.addElement(lElementNotification);
        }
        lOnglet.profondeur = aProfondeur;
        if (aOngletPere) {
          lOnglet.onglet = aOngletPere;
        }
        this.listeOnglets.addElement(lOnglet);
        let lAvecFilsActifs = false;
        if (aJSON.Onglet) {
          for (let i = 0; i < aJSON.Onglet.length; i++) {
            lAvecFilsActifs =
              this._ajouterOnglet(aJSON.Onglet[i], aProfondeur + 1, lOnglet) ||
              lAvecFilsActifs;
          }
          if (!lAvecFilsActifs) {
            lOnglet.Actif = false;
          }
        }
        return lOnglet.Actif;
      }
      _traiterListeProfesseurs(aListeClasses, aProfesseur) {
        const lArrayClasse = aProfesseur.listeClasses;
        aProfesseur.listeClasses =
          new ObjetListeElements_1.ObjetListeElements();
        if (aProfesseur.getGenre() === 0) {
          aProfesseur.Position = 0;
        }
        if (lArrayClasse) {
          for (let i = 0; i < lArrayClasse.length; i++) {
            let lClasse = aListeClasses.get(lArrayClasse[i]);
            if (lClasse) {
              let lClasseCopie = new ObjetElement_1.ObjetElement(
                lClasse.getLibelle(),
                lClasse.getNumero(),
                lClasse.getGenre(),
              );
              lClasseCopie.estResponsable = lClasse.estResponsable;
              aProfesseur.listeClasses.addElement(lClasseCopie);
            }
          }
        }
      }
    }
    exports.ObjetEtatUtilisateur = ObjetEtatUtilisateur;
  },
  fn: 'objetetatutilisateur.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetApplicationCommunSco = void 0;
    require('NamespaceIE.js');
    require('DeclarationJQuery');
    require('Theme_Modele.css');
    require('Couleurs.css');
    require('Divers.css');
    require('Styles.css');
    require('Texte.css');
    require('DeclarationCurseurPN.js');
    require('Connexion.css');
    require('communEspace.css');
    require('pages_connexion.css');
    require('ObjetNavigateur.js');
    const ObjetApplicationProduit_1 = require('ObjetApplicationProduit');
    const ObjetRequetePageCommune_1 = require('ObjetRequetePageCommune');
    const Enumere_Espace_1 = require('Enumere_Espace');
    const CommunicationProduit_1 = require('CommunicationProduit');
    const Invocateur_1 = require('Invocateur');
    const CollectionRequetes_1 = require('CollectionRequetes');
    const ObjetRequeteJSON_1 = require('ObjetRequeteJSON');
    const ThemesCouleurs_1 = require('ThemesCouleurs');
    const _ObjetCouleur_1 = require('_ObjetCouleur');
    const UtilitairePagePubliqueEtablissement_1 = require('UtilitairePagePubliqueEtablissement');
    const UtilitairePageCommune_1 = require('UtilitairePageCommune');
    const ObjetEtatUtilisateur_1 = require('ObjetEtatUtilisateur');
    class ObjetApplicationCommunSco extends ObjetApplicationProduit_1.ObjetApplicationProduit {
      async lancer(aParametres) {
        this.setDemo(!!aParametres.d);
        const lNumeroSession = aParametres.h;
        this.numeroEspace =
          aParametres.a || Enumere_Espace_1.EGenreEspace.Commun;
        Invocateur_1.Invocateur.evenement(
          Invocateur_1.ObjetInvocateur.events.initChiffrement,
          aParametres,
        );
        this.setCommunication(
          new CommunicationProduit_1.CommunicationProduit(
            this.numeroEspace,
            lNumeroSession,
          ),
        );
        this.actionSurRecupererDonnees(
          await new ObjetRequetePageCommune_1.ObjetRequetePageCommune(
            this,
          ).lancerRequete(),
        );
      }
      actionSurRecupererDonnees(aParam) {
        global.GParametres = Object.assign({}, aParam);
        global.GEtatUtilisateur =
          new ObjetEtatUtilisateur_1.ObjetEtatUtilisateur(this.numeroEspace);
        ThemesCouleurs_1.ThemesCouleurs.setTheme(aParam.Theme);
        global.GCouleur = new _ObjetCouleur_1._ObjetCouleur();
        let lParam = Object.assign({ id: this.getIdConteneur() }, aParam);
        if (GParametres.avecPagePubliqueEtab === true) {
          this.utilitairePagePubliqueEtablissement =
            new UtilitairePagePubliqueEtablissement_1.UtilitairePagePubliqueEtablissement(
              { estSurMobile: false, estPrimaire: this.estPrimaire },
            );
          this.utilitairePagePubliqueEtablissement.initGlobales();
          this.donneesRequete =
            this.utilitairePagePubliqueEtablissement.initDonneesRequete();
          CollectionRequetes_1.Requetes.inscrire(
            'PagePubliqueEtablissement',
            ObjetRequeteJSON_1.ObjetRequeteConsultation,
          );
          (0, CollectionRequetes_1.Requetes)('PagePubliqueEtablissement', this)
            .lancerRequete(this.donneesRequete)
            .then((aParam) => {
              $.extend(lParam, aParam);
              this.utilitairePagePubliqueEtablissement.construire(
                lParam,
                this.donneesRequete,
              );
            });
        } else {
          $.extend(lParam, {
            initBandeau: function (aBandeau) {
              aBandeau.setParametres({
                logoDepartementImage: GParametres.logoDepartementImage,
                logoDepartementLien: GParametres.logoDepartementLien,
              });
            },
          });
          new UtilitairePageCommune_1.UtilitairePageCommune().construire(
            lParam,
          );
        }
      }
    }
    exports.ObjetApplicationCommunSco = ObjetApplicationCommunSco;
  },
  fn: 'objetapplicationcommunsco.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    require('Image.css');
  },
  fn: 'declarationimagecp.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('DeclarationImageCP.js');
    require('ImageEspacesCP.css');
  },
  fn: 'declarationimageespacescp.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('DeclarationImageEspacesCP.js');
    require('ImageSco.css');
  },
  fn: 'declarationimagesco.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    const LottiePatience_1 = require('LottiePatience');
    require('ImageEspacesHebergementPN.css');
    LottiePatience_1.LottiePatience.setUrl('./images/LoadingPN.json');
  },
  fn: 'declarationimageespaceshebergementpn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {},
  fn: 'declarationimageconnexionpn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {},
  fn: 'declarationimagefaviconpn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    require('LogoPN.css');
  },
  fn: 'declarationimagelogopn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    require('DeclarationImageSco.js');
    require('DeclarationImageEspacesHebergementPN.js');
    require('ImagePN.css');
    require('DeclarationImageConnexionPN.js');
    require('DeclarationImageFaviconPN.js');
    require('DeclarationImageLogoPN.js');
  },
  fn: 'declarationimagepn.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    const { MethodesObjet } = require('MethodesObjet.js');
    const GImageConnexion = require('ObjetImageConnexion.js');
    const imagesConnexion = require('imagesconnexion.js');
    try {
      if (MethodesObjet.isFunction(imagesConnexion)) {
        imagesConnexion(GImageConnexion);
      }
    } catch (e) {}
  },
  fn: 'declarationimagesconnexiondynamiques.js',
});
IE.fModule({
  f: function (exports, require, module, global) {
    'use strict';
    Object.defineProperty(exports, '__esModule', { value: true });
    exports.ObjetApplicationCommunPN = void 0;
    const ObjetApplicationCommunSco_1 = require('ObjetApplicationCommunSco');
    require('DeclarationImagePN.js');
    require('DeclarationImagesConnexionDynamiques.js');
    global.Start = function (aParametres) {
      GApplication = new ObjetApplicationCommunPN();
      GApplication.lancer(aParametres);
    };
    class ObjetApplicationCommunPN extends ObjetApplicationCommunSco_1.ObjetApplicationCommunSco {}
    exports.ObjetApplicationCommunPN = ObjetApplicationCommunPN;
  },
  fn: 'interfacepagecommune.js',
});
